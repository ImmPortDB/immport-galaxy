<tool id="runFlock" name="Run FLOCK" version="1.1">
  <description>using a FCS file that was converted/transformed to a text file.</description>
  <command interpreter="python">
    runFlockMFI.py -i $input -o $output -m $method -c $centroid -M $mfi -t $__tool_directory__
    #if $bins
      -b $bins
    #end if
    #if $density
      -d $density
    #end if
  </command>

  <inputs>
    <param format="flowtext" name="input" type="data" label="Source file"/>
    <param name="method" type="select" label="Method">
        <option value="flock1" selected="true">Flock Version 1</option>
        <option value="flock2">Flock Version 2</option>
    </param>
    <param name="bins" type="integer" min="6" max="30" optional="true" value="" label="bins (6-30)"/>
    <param name="density" type="integer" min="2" max="100" optional="true" value="" label="density (2-100)"/>
    <param name="mfi" type="select" label="Calculate centroids using:">
        <option value="mfi" selected="true">Mean Fluorescence Intensity</option>
        <option value="mdfi">Median Fluorescence Intensity</option>
        <option value="gmfi">Geometric Mean Fluorescence Intensity</option>
    </param>
  </inputs>

  <outputs>
    <data format="flowclr" name="output" label="${method} with ${mfi} on ${input.name}"/>
    <data format="flowmfi" name="centroid" label="${mfi} Centroids from ${method} on ${input.name}"/>
  </outputs>
   
 <help>
   This tool runs FLOCK using a FCS file that was converted to a text file.
   
-----

FLOCK (FLOw Clustering without K) is a computational approach to flow cytometry analysis which:

  1. Computationally determines the number of unique populations in high dimensional flow data using a rapid binning approach
  2. Can handle non-spherical hyper-shapes
  3. Maps populations across independent samples
  4. Calculates many useful summary statistics
  5. Finds the most informative parameters
  6. Reduces subjective factors in manual gating

-----

**Input**

FLOCK requires a text file, generated from a FCS file, as input.
In order to define the populations in a given dataset collection for a given set of markers, run FLOCK on a super-set of FCS file. You can use one of the merge tools to concatenate and/or downsample datasets, and remove, edit or rearrange markers before running FLOCK on your favorite set of markers.

**Output** 

*FLOCK*

FLOCK attributes each event to a population and generates a text file.

*Centroid file*

The centroid file is a table containing the mean, median or geometric mean fluorescent intensity values of each marker within each population defined by FLOCK, as determined by the user.

-----

**Example**

*Input* - fluorescence intensities per marker per event::

   Marker1 Marker2 Marker3
   34      45      12
   33      65      10
   19      62      98
   12      36      58

*FLOCK Output* - fluorescence intensities per marker and population ID per event::

   Marker1 Marker2 Marker3 Population
   34      45      12      1
   33      65      10      5
   19      62      98      2
   12      36      58      1

*Centroid file* - mean, geometric mean or median fluorescence intensity per marker per population::

   Population Marker1 Marker2 Marker3
   1          38      49      10
   2          21      63      100
   3          31      52      45
   4          11      78      25

-----

**Reference**

Elucidation of seventeen human peripheral blood B-cell subsets and quantification of the tetanus response using a density-based method for the automated identification of cell populations in multidimensional flow cytometry data Qian Y, Wei C, Eun-Hyung Lee F, Campbell J, Halliley J, Lee JA, Cai J, Kong YM, Sadat E, Thomson E, Dunn P, Seegmiller AC, Karandikar NJ, Tipton CM, Mosmann T, Sanz I, Scheuermann RH. Cytometry B Clin Cytom. 2010;78 Suppl 1:S69-82.
 </help>
</tool>
