define("mvc/visualization/chart/utilities/datasets",["exports","utils/utils","underscore"],function(a,t,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var r=function(a){return a&&a.__esModule?a:{default:a}}(t),s=function(a){if(a&&a.__esModule)return a;var t={};if(null!=a)for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(t[e]=a[e]);return t.default=a,t}(e),n={},o=function(a){var t=a.dataset_groups,e=a.dataset_id,o=[];t.each(function(a){s.each(a.get("__data_columns"),function(t,r){var s=a.get(r),u=l(e,s);-1!==o.indexOf(s)||n[u]||"auto"==s||"zero"==s||void 0===s||o.push(s)})}),0!==o.length?r.default.get({url:Galaxy.root+"api/datasets/"+e,data:{data_type:"raw_data",provider:"dataset-column",indeces:o.toString()},success:function(t){for(var r=o.length,s=new Array(r),c=0;c<s.length;c++)s[c]=[];for(var i in t.data){var d=t.data[i];for(var f in d){var v=d[f];void 0!==v&&2147483647!=v&&f<r&&s[f].push(v)}}console.debug("tabular-datasets::_fetch() - Fetching complete.");for(var h in s){var _=o[h],g=l(e,_);n[g]=s[h]}u(a)}}):u(a)},u=function(a){var t=a.dataset_groups,e=a.dataset_id;console.debug("tabular-datasets::_fillFromCache() - Filling request from cache.");var o=0;t.each(function(a){s.each(a.get("__data_columns"),function(t,r){var s=a.get(r),u=l(e,s),c=n[u];c&&(o=Math.max(o,c.length))})}),0===o&&(console.debug("tabular-datasets::_fillFromCache() - No data available."),a.chart&&a.chart.state("failed","No data available."));var u=[];t.each(function(a,t){for(var e=r.default.merge({key:t+":"+a.get("key"),values:[]},a.attributes),s=0;s<o;s++)e.values[s]={x:parseInt(s)};u.push(e)}),t.each(function(a,t){var r=u[t].values;s.each(a.get("__data_columns"),function(t,s){var u=a.get(s);switch(u){case"auto":for(var c=0;c<o;c++)r[c][s]=parseInt(c);break;case"zero":for(var i=0;i<o;i++)r[i][s]=0;break;default:for(var d=l(e,u),f=n[d],v=0;v<o;v++){var h=r[v],_=f[v];isNaN(_)&&!t.is_label&&(_=0),h[s]=_}}})}),a.success(u)},l=function(a,t){return a+"__"+t};a.default={request:o,requestPanels:function(a){var t=a.process,e=a.chart,r=a.render,s=a.targets,n=a.dataset_id||a.chart.get("dataset_id"),u=a.dataset_groups||a.chart.groups;o({chart:e,dataset_id:n,dataset_groups:u,success:function(a){try{if(s.length==a.length){var n=!0;for(var o in a){var u=a[o];if(!r(s[o],[u])){n=!1;break}}n&&e.state("ok","Multi-panel chart drawn.")}else 1==s.length?r(s[0],a)&&e.state("ok","Chart drawn."):e.state("failed","Invalid panel count.");t.resolve()}catch(a){console.debug("FAILED: tabular-utilities::panelHelper() - "+a),e.state("failed",a),t.reject()}}})}}});