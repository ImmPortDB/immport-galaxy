define("mvc/toolshed/repository-queue-view",["exports","utils/localization","mvc/toolshed/toolshed-model","mvc/toolshed/util"],function(e,t,o,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var r=s(t),a=s(o),l=s(i),n=Backbone.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new a.default.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,o=t.templateRepoQueue,i=t.model.models;t.$el.html(o({title:(0,r.default)("Repository Installation Queue"),repositories:i,queue:l.default.queueLength()})),$("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var e=this;$(".install_one").on("click",function(){var t=e.loadFromQueue($(this).attr("data-repokey"));e.installFromQueue(t,$(this).attr("data-repokey"))}),$(".remove_one").on("click",function(){var e=$(this).attr("data-repokey"),t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e)){var o=t[e].repository.id;delete t[e],$("#queued_repository_"+o).remove()}localStorage.repositories=JSON.stringify(t)}),$("#clear_queue").on("click",function(){localStorage.repositories="{}"}),$("#from_workflow").on("click",function(){Backbone.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(e,t){var o=Object();o.install_tool_dependencies=e.install_tool_dependencies,o.install_repository_dependencies=e.install_repository_dependencies,o.install_resolver_dependencies=e.install_resolver_dependencies,o.tool_panel_section=e.tool_panel_section,o.shed_tool_conf=e.shed_tool_conf,o.repositories=JSON.stringify([[e.repository.id,e.changeset_revision]]),o.tool_shed_repository_ids=JSON.stringify([e.repository.id]),o.tool_shed_url=t.split("|")[0],o.changeset=e.changeset_revision;var i=Galaxy.root+"api/tool_shed_repositories/install?async=True";if($("#queued_repository_"+e.repository.id).remove(),localStorage.repositories){void 0===t&&(t=l.default.queueKey(e));var s=JSON.parse(localStorage.repositories);s.hasOwnProperty(t)&&(delete s[t],localStorage.repositories=JSON.stringify(s))}$.post(i,o,function(e){var t=JSON.parse(e),o="status/r/"+t.repositories.join("|");$.post(Galaxy.root+"admin_toolshed/install_repositories",t,function(e){console.log("Initializing repository installation succeeded")}),Backbone.history.navigate(o,{trigger:!0,replace:!0})})},loadFromQueue:function(e){var t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e))return t[e]},reDraw:function(e){this.$el.empty(),this.initialize(e),this.model.fetch(),this.render(e)},templateRepoQueue:_.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))});e.default={RepoQueueView:n}});