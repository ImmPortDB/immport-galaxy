define("mvc/ui/ui-select",["exports","backbone","underscore","utils/utils"],function(t,e,i,s){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(t,"__esModule",{value:!0});var a=n(e),o=n(i),l=function(t){return t&&t.__esModule?t:{default:t}}(s),h=a.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,maximumTextLength:100,initialData:""},initialize:function(t){if(this.options=l.default.merge(t,this.optionsDefault),this.setElement(this._template(this.options)),this.options.container){if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var e=this;this.options.onchange&&this.$el.on("change",function(){e.options.onchange(e.value())})}}else console.log("ui-select::initialize() : container not specified.")},value:function(t){var e=this._getValue();void 0!==t&&this._setValue(t);var i=this._getValue();return i!=e&&this.options.onchange&&this.options.onchange(i),i},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(t){this.select_data.push({id:t.id,text:t.text}),this._refresh()},del:function(t){var e=this._getIndex(t);-1!=e&&(this.select_data.splice(e,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(t){this.select_data=[];for(var e in t.data)this.select_data.push(t.data[e]);this._refresh()},_refresh:function(){var t=this,e=void 0;if(this.options.multiple)e={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData},this.$el.select2(e);else{this.select_data&&this.select_data.map(function(e){var i=t.options.maximumTextLength+3;if(e.text&&e.text.length>i){var s=e.text.indexOf("("+e.id+")");s=-1!=s&&s<i?s:i;var n=e.text.substring(0,s).replace(/[\ \.]*$/,"");e.text=n+"...("+e.id+")"}});var i=this._getValue();e={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0},this.$el.select2(e),this._setValue(i)}},_getIndex:function(t){o.findIndex(this.select_data,{id:t})},_getValue:function(){return this.$el.select2("val")},_setValue:function(t){-1==this._getIndex(t)&&this.select_data.length>0&&(t=this.select_data[0].id),this.$el.select2("val",t)},_template:function(t){return'<input type="hidden" value="'+this.options.initialData+'"/>'}});t.default={View:h}});