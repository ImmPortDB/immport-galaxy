define("mvc/upload/upload-view",["exports","utils/localization","utils/utils","mvc/ui/ui-modal","mvc/ui/ui-tabs","mvc/upload/upload-utils","mvc/upload/upload-button","mvc/upload/default/default-view","mvc/upload/composite/composite-view","mvc/upload/collection/collection-view","mvc/upload/collection/rules-input-view"],function(e,t,i,l,o,s,a,u,n,d,r){"use strict";function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var c=f(t),_=f(i),p=f(l),h=f(o),m=f(s),w=f(a),g=f(u),v=f(n),b=f(d),y=f(r);e.default=Backbone.View.extend({options:{ftp_upload_site:"n/a",default_genome:m.default.DEFAULT_GENOME,default_extension:m.default.DEFAULT_EXTENSION,height:500,width:900,auto:m.default.AUTO_EXTENSION},list_extensions:[],list_genomes:[],initialize:function(e){var t=this;this.options=_.default.merge(e,this.options),this.ui_button=new w.default.View({onclick:function(e){e.preventDefault(),t.show()},onunload:function(){var e=t.ui_button.model.get("percentage",0);if(e>0&&e<100)return"Several uploads are queued."}}),this.setElement(this.ui_button.$el),m.default.getUploadDatatypes(function(e){t.list_extensions=e},this.options.datatypes_disable_auto,this.options.auto),m.default.getUploadGenomes(function(e){t.list_genomes=e},this.default_genome)},show:function(){var e=this;Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.model?(this.current_user=Galaxy.user.id,this.modal||(this.tabs=new h.default.View,this.default_view=new g.default(this),this.tabs.add({id:"regular",title:(0,c.default)("Regular"),$el:this.default_view.$el}),this.composite_view=new v.default(this),this.tabs.add({id:"composite",title:(0,c.default)("Composite"),$el:this.composite_view.$el}),this.collection_view=new b.default(this),this.tabs.add({id:"collection",title:(0,c.default)("Collection"),$el:this.collection_view.$el}),this.rule_based_view=new y.default(this),this.tabs.add({id:"rule-based",title:(0,c.default)("Rule-based"),$el:this.rule_based_view.$el}),this.modal=new p.default.View({title:(0,c.default)("Download from web or upload from disk"),body:this.tabs.$el,height:this.options.height,width:this.options.width,closing_events:!0,title_separator:!1})),this.modal.show()):window.setTimeout(function(){e.show()},500)},currentHistory:function(){return this.current_user&&Galaxy.currHistoryPanel.model.get("id")},currentFtp:function(){return this.current_user&&this.options.ftp_upload_site},toData:function(e,t){var i={payload:{tool_id:"upload1",history_id:t||this.currentHistory(),inputs:{}},files:[],error_message:null};if(e&&e.length>0){var l={file_count:e.length,dbkey:e[0].get("genome","?"),file_type:e[0].get("extension")||"auto"};for(var o in e){var s=e[o];if(s.set("status","running"),!(s.get("file_size")>0)){i.error_message="Upload content incomplete.",s.set("status","error"),s.set("info",i.error_message);break}var a="files_"+o+"|";switch(l[a+"type"]="upload_dataset",l[a+"space_to_tab"]=s.get("space_to_tab")&&"Yes"||null,l[a+"to_posix_lines"]=s.get("to_posix_lines")&&"Yes"||null,l[a+"dbkey"]=s.get("genome",null),l[a+"file_type"]=s.get("extension",null),s.get("file_mode")){case"new":l[a+"url_paste"]=s.get("url_paste");break;case"ftp":l[a+"ftp_files"]=s.get("file_path");break;case"local":i.files.push({name:a+"file_data",file:s.get("file_data")})}}i.payload.inputs=JSON.stringify(l)}return i}})});