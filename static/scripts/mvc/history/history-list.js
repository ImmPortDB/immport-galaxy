define("mvc/history/history-list",["exports","utils/localization","utils/ajax-queue","utils/utils","mvc/grid/grid-view","mvc/history/history-model","mvc/history/copy-dialog","ui/loading-indicator","backbone"],function(t,e,i,a,n,o,s,d,l){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(t,"__esModule",{value:!0});var u=r(e),c=r(i),f=r(a),y=r(n),h=r(o),v=r(s),p=r(d),_=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(l),w=y.default.extend({initialize:function(t){this.ajaxQueue=new c.default.AjaxQueue,y.default.prototype.initialize.call(this,t)},init_grid_elements:function(){var t=this.ajaxQueue;t.stop(),y.default.prototype.init_grid_elements.call(this),$.makeArray(this.$el.find(".delayed-value-datasets_by_state").map(function(t,e){return function(){var t=$(e).data("id"),i=Galaxy.root+"api/histories/"+t+"?keys=nice_size,contents_active,contents_states",a={};return a.url=i,a.type="GET",a.success=function(e){for(var i=e.contents_states,a="",n=["ok","running","queued","new","error"],o=0;o<n.length;o++){var s=n[o],d=i[s];d&&(a+='<div class="count-box state-color-'+s+'" title="Datasets in '+s+' state">'+d+"</div> ")}var l=e.contents_active,r=l.deleted;r&&(a+='<div class="count-box state-color-deleted" title="Deleted datasets">'+r+"</div> ");var u=l.hidden;u&&(a+='<div class="count-box state-color-hidden" title="Hidden datasets">'+u+"</div> "),$(".delayed-value-datasets_by_state[data-id='"+t+"']").html(a),$(".delayed-value-disk_size[data-id='"+t+"']").html(e.nice_size)},$.ajax(a)}})).forEach(function(e){return t.add(e)}),t.start()},_showCopyDialog:function(t){var e=new h.default.History({id:t});e.fetch().fail(function(){alert("History could not be fetched. Please contact an administrator")}).done(function(){(0,v.default)(e,{}).done(function(){window.parent&&window.parent.Galaxy&&window.parent.Galaxy.currHistoryPanel&&window.parent.Galaxy.currHistoryPanel.loadCurrentHistory(),window.location.reload(!0)})})},add_operation:function(t,e,i){var a=this;"Copy"==e.label&&(e.onclick=function(t){a._showCopyDialog(t)}),y.default.prototype.add_operation.call(this,t,e,i)}}),m=_.View.extend({title:(0,u.default)("Histories"),initialize:function(t){var e=this;p.default.markViewAsLoading(this),"list_published"==t.action_id?this.active_tab="shared":"list"==t.action_id&&(this.active_tab="user"),this.model=new _.Model,f.default.get({url:Galaxy.root+"history/"+t.action_id+"?"+$.param(Galaxy.params),success:function(t){e.model.set(t),e.render()}})},render:function(){var t=new w(this.model.attributes);this.$el.empty().append(t.$el)}});t.default={View:m}});