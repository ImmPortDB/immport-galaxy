define("mvc/history/copy-dialog",["exports","mvc/ui/ui-modal","mvc/ui/error-modal","utils/localization"],function(e,a,t,l){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});var n=o(a),i=o(t),r=o(l),s={defaultName:_.template("Copy of '<%- name %>'"),title:_.template((0,r.default)("Copying history")+' "<%- name %>"'),submitLabel:(0,r.default)("Copy"),errorMessage:(0,r.default)("History could not be copied."),progressive:(0,r.default)("Copying history"),activeLabel:(0,r.default)("Copy only the active, non-deleted datasets"),allLabel:(0,r.default)("Copy all datasets including deleted ones"),anonWarning:(0,r.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,r.default)("after copying this history. "),_template:_.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",(0,r.default)("You can"),' <a href="/user/login">',(0,r.default)("login here"),"</a> ",(0,r.default)("or")," ",' <a href="/user/create">',(0,r.default)("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',(0,r.default)("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',(0,r.default)("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",(0,r.default)("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var e='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(e).css({"margin-top":"8px"})},dialog:function(e,a,t){function l(){var t=e.$("#copy-modal-title").val();if(t){var l="copy-all"===e.$('input[name="copy-what"]:checked').val();e.$("button").prop("disabled",!0),o._showAjaxIndicator(),a.copy(!0,t,l).done(function(e){n.resolve(e)}).fail(function(e,r,s){var d={name:t,copyAllDatasets:l};i.default.ajaxErrorModal(a,e,d,o.errorMessage),n.rejectWith(n,arguments)}).done(function(){c&&e.hide()})}else e.$(".invalid-title").show()}t=t||{};var o=this,n=jQuery.Deferred(),s=(t.nameFn||this.defaultName)({name:a.get("name")}),d=t.allDatasets?"copy-all":"copy-non-deleted",u=!!_.isUndefined(t.allowAll)||t.allowAll,c=!!_.isUndefined(t.autoClose)||t.autoClose;this.modal=e;var p=t.closing_callback;return e.show(_.extend(t,{title:this.title({name:a.get("name")}),body:$(o._template({name:s,isAnon:Galaxy.user.isAnonymous(),allowAll:u,copyWhat:d,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:_.object([[(0,r.default)("Cancel"),function(){e.hide()}],[this.submitLabel,l]]),height:"auto",closing_events:!0,closing_callback:function(e){e&&n.reject({cancelled:!0}),p&&p(e)}})),e.$("#copy-modal-title").focus().select(),e.$("#copy-modal-title").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),l())}),n}},d=_.extend({},s,{defaultName:_.template("imported: <%- name %>"),title:_.template((0,r.default)("Importing history")+' "<%- name %>"'),submitLabel:(0,r.default)("Import"),errorMessage:(0,r.default)("History could not be imported."),progressive:(0,r.default)("Importing history"),activeLabel:(0,r.default)("Import only the active, non-deleted datasets"),allLabel:(0,r.default)("Import all datasets including deleted ones"),anonWarning:(0,r.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,r.default)("after importing this history. ")});e.default=function(e,a){a=a||{};var t=window.parent.Galaxy.modal||new n.default.View({});return a.useImport?d.dialog(t,e,a):s.dialog(t,e,a)}});