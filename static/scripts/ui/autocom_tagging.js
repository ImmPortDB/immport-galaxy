define("ui/autocom_tagging",["exports","jquery"],function(t,e){"use strict";function a(t,e){n(t).find(".tag-name").each(function(){n(this).click(function(){var t=n(this).text().split(":");return e(t[0],t[1]),!0})})}Object.defineProperty(t,"__esModule",{value:!0});var i=function(t){return t&&t.__esModule?t:{default:t}}(e),n=i.default;i.default.fn.autocomplete_tagging=function(t){function e(t){n(t).mouseenter(function(){n(this).attr("src",g.delete_tag_img_rollover)}),n(t).mouseleave(function(){n(this).attr("src",g.delete_tag_img)}),n(t).click(function(){var e=n(this).parent(),a=e.find(".tag-name").eq(0).text().split(":"),i=a[0],r=a[1],l=e.prev();e.remove(),delete g.tags[i];var s=g.get_toggle_link_text_fn(g.tags);return o.text(s),n.ajax({url:g.ajax_delete_tag_url,data:{tag_name:i},error:function(){g.tags[i]=r,l.hasClass("tag-button")?l.after(e):u.prepend(e),alert("Remove tag failed"),o.text(g.get_toggle_link_text_fn(g.tags)),t.mouseenter(function(){n(this).attr("src",g.delete_tag_img_rollover)}),t.mouseleave(function(){n(this).attr("src",g.delete_tag_img)})},success:function(){}}),!0})}function r(t){var a=n("<img/>").attr("src",g.delete_tag_img).addClass("delete-tag-img");e(a);var i=n("<span>").text(t).addClass("tag-name");i.click(function(){var e=t.split(":");return g.tag_click_fn(e[0],e[1]),!0});var r=n("<span></span>").addClass("tag-button");return r.append(i),g.editable&&r.append(a),r}var l={get_toggle_link_text_fn:function(t){var e=_.size(t);return e>0?e+(e>1?" Tags":" Tag"):"Add tags"},tag_click_fn:function(t,e){},editable:!0,input_size:20,in_form:!1,tags:{},use_toggle_link:!0,item_id:"",add_tag_img:"",add_tag_img_rollover:"",delete_tag_img:"",ajax_autocomplete_tag_url:"",ajax_retag_url:"",ajax_delete_tag_url:"",ajax_add_tag_url:""},g=i.default.extend(l,t),s=n(this),u=s.find(".tag-area"),o=s.find(".toggle-link"),d=s.find(".tag-input"),c=s.find(".add-tag-button");o.click(function(){var t;return t=u.is(":hidden")?function(){0===n(this).find(".tag-button").length&&u.click()}:function(){u.blur()},u.slideToggle("fast",t),n(this)}),g.editable&&d.hide(),d.keyup(function(t){if(27===t.keyCode)n(this).trigger("blur");else if(13===t.keyCode||188===t.keyCode||32===t.keyCode){var e=this.value;if(-1!==e.indexOf(": ",e.length-2))return this.value=e.substring(0,e.length-1),!1;if(188!==t.keyCode&&32!==t.keyCode||(e=e.substring(0,e.length-1)),(e=n.trim(e)).length<2)return!1;this.value="";var a=r(e),i=u.children(".tag-button");0!==i.length?i.slice(i.length-1).after(a):u.prepend(a);var l=e.split(":");g.tags[l[0]]=l[1];var s=g.get_toggle_link_text_fn(g.tags);o.text(s);var d=n(this);return n.ajax({url:g.ajax_add_tag_url,data:{new_tag:e},error:function(){a.remove(),delete g.tags[l[0]];var t=g.get_toggle_link_text_fn(g.tags);o.text(t),alert("Add tag failed")},success:function(){d.data("autocompleter").cacheFlush()}}),!1}});var f={selectFirst:!1,formatItem:function(t,e,a,i,n){var r=i.split(":");return 1===r.length?r[0]:r[1]},autoFill:!1,highlight:!1};d.autocomplete_verheul(g.ajax_autocomplete_tag_url,f),s.find(".delete-tag-img").each(function(){e(n(this))}),a(n(this),g.tag_click_fn),c.click(function(){return n(this).hide(),u.click(),!1}),g.editable&&(u.bind("blur",function(t){_.size(g.tags)>0&&(c.show(),d.hide(),u.removeClass("active-tag-area"))}),u.click(function(t){var e=n(this).hasClass("active-tag-area");if(n(t.target).hasClass("delete-tag-img")&&!e)return!1;if(n(t.target).hasClass("tag-name")&&!e)return!1;n(this).addClass("active-tag-area"),c.hide(),d.show(),d.focus();return n(window).bind("click.tagging_blur",function(t){!function(t,e){t.attr("id"),e!==t&&(t.blur(),n(window).unbind("click.tagging_blur"),n(this).addClass("tooltip"))}(u,n(t.target))}),!1})),g.use_toggle_link&&u.hide()},t.default=a});