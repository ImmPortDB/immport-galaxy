webpackJsonp([0,1],[,,,,,,,function(t,e,i){var a,n;(function(o,s){a=[i(4),i(51),i(54),i(22),i(50),i(13),i(8)],n=function(t,e,i,a,n,r,l){var h=o.View.extend({tagName:"label",initialize:function(t){this.model=t&&t.model||new o.Model(t),this.tagName=t.tagName||this.tagName,this.setElement(s("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},title:function(t){this.model.set("title",t)},value:function(){return this.model.get("title")},render:function(){return this.$el.removeClass().addClass("ui-label").addClass(this.model.get("cls")).html(this.model.get("title")),this}}),c=o.View.extend({initialize:function(t){this.model=t&&t.model||new o.Model({message:null,status:"info",cls:"",persistent:!1}).set(t),this.listenTo(this.model,"change",this.render,this),this.render()},update:function(t){this.model.set(t)},render:function(){this.$el.removeClass().addClass("ui-message").addClass(this.model.get("cls"));var t=this.model.get("status");if(this.model.get("large")?this.$el.addClass(("success"==t&&"done"||"danger"==t&&"error"||t)+"messagelarge"):this.$el.addClass("alert").addClass("alert-"+t),this.model.get("message")){if(this.$el.html(this.model.get("message")),this.$el.fadeIn(),this.timeout&&window.clearTimeout(this.timeout),!this.model.get("persistent")){var e=this;this.timeout=window.setTimeout(function(){e.$el.fadeOut()},3e3)}}else this.$el.fadeOut();return this}}),d=o.View.extend({initialize:function(t){this.model=t&&t.model||new o.Model({type:"text",placeholder:"",disabled:!1,visible:!0,cls:"",area:!1}).set(t),this.tagName=this.model.get("area")?"textarea":"input",this.setElement(s("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},events:{input:"_onchange"},value:function(t){return void 0!==t&&this.model.set("value","string"==typeof t?t:""),this.model.get("value")},render:function(){return this.$el.removeClass().addClass("ui-"+this.tagName).addClass(this.model.get("cls")).attr("id",this.model.id).attr("type",this.model.get("type")).attr("placeholder",this.model.get("placeholder")).val(this.model.get("value")),this.model.get("disabled")?this.$el.attr("disabled",!0):this.$el.removeAttr("disabled"),this.$el[this.model.get("visible")?"show":"hide"](),this},_onchange:function(){this.value(this.$el.val()),this.model.get("onchange")&&this.model.get("onchange")(this.model.get("value"))}}),u=o.View.extend({initialize:function(t){this.model=t&&t.model||new o.Model(t),this.setElement(s("<div/>").append(this.$info=s("<div/>")).append(this.$hidden=s("<div/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},value:function(t){return void 0!==t&&this.model.set("value",t),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.$hidden.val(this.model.get("value")),this.model.get("info")?this.$info.show().html(this.model.get("info")):this.$info.hide(),this}});return{Button:r.ButtonDefault,ButtonIcon:r.ButtonIcon,ButtonCheck:r.ButtonCheck,ButtonMenu:r.ButtonMenu,ButtonLink:r.ButtonLink,Input:d,Label:h,Message:c,Modal:l,RadioButton:a.RadioButton,Checkbox:a.Checkbox,Radio:a.Radio,Select:e,Hidden:u,Slider:i,Drilldown:n}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},,function(t,e,i){var a,n;(function(o,s){a=[i(4)],n=function(t){var e=o.View.extend({visible:!1,initialize:function(e){var i=this;this.options=t.merge(e,{id:t.uid(),title:"",icon:"",buttons:null,body:null,scrollable:!0,nopadding:!1,operations:null,placement:"bottom",cls:"ui-portlet",operations_flt:"right",collapsible:!1,collapsed:!1}),this.setElement(this._template(this.options)),this.$body=this.$(".portlet-body"),this.$title=this.$(".portlet-title-text"),this.$header=this.$(".portlet-header"),this.$content=this.$(".portlet-content"),this.$footer=this.$(".portlet-footer"),this.options.nopadding&&(this.$content.css("padding","0px"),this.$body.css("padding","0px")),this.$buttons=this.$(".portlet-buttons"),this.options.buttons?s.each(this.options.buttons,function(t,e){e.$el.prop("id",t),i.$buttons.append(e.$el)}):this.$buttons.remove(),this.$operations=this.$(".portlet-operations"),this.options.operations&&s.each(this.options.operations,function(t,e){e.$el.prop("id",t),i.$operations.append(e.$el)}),this.options.body&&this.append(this.options.body),this.collapsed=!1,this.options.collapsible&&(this.$title.addClass("no-highlight").css({cursor:"pointer","text-decoration":"underline"}),this.$title.on("click",function(){i.collapsed?i.expand():i.collapse()}),this.options.collapsed&&this.collapse())},append:function(t){this.$body.append(t)},empty:function(){this.$body.empty()},header:function(){return this.$header},body:function(){return this.$body},footer:function(){return this.$footer},show:function(){this.visible=!0,this.$el.fadeIn("fast")},hide:function(){this.visible=!1,this.$el.fadeOut("fast")},enableButton:function(t){this.$buttons.find("#"+t).prop("disabled",!1)},disableButton:function(t){this.$buttons.find("#"+t).prop("disabled",!0)},hideOperation:function(t){this.$operations.find("#"+t).hide()},showOperation:function(t){this.$operations.find("#"+t).show()},setOperation:function(t,e){var i=this.$operations.find("#"+t);i.off("click"),i.on("click",e)},title:function(t){var e=this.$title;return t&&e.html(t),e.html()},collapse:function(){this.collapsed=!0,this.$content.height("0%"),this.$body.hide(),this.$footer.hide(),this.trigger("collapsed")},expand:function(){this.collapsed=!1,this.$content.height("100%"),this.$body.fadeIn("fast"),this.$footer.fadeIn("fast"),this.trigger("expanded")},disable:function(){this.$(".portlet-backdrop").show()},enable:function(){this.$(".portlet-backdrop").hide()},_template:function(t){var e='<div id="'+t.id+'" class="'+t.cls+'">';return t.title&&(e+='<div class="portlet-header"><div class="portlet-operations" style="float: '+t.operations_flt+';"/><div class="portlet-title">',t.icon&&(e+='<i class="icon fa '+t.icon+'">&nbsp;</i>'),e+='<span class="portlet-title-text">'+t.title+"</span></div></div>"),e+='<div class="portlet-content">',"top"==t.placement&&(e+='<div class="portlet-buttons"/>'),e+='<div class="portlet-body"/>',"bottom"==t.placement&&(e+='<div class="portlet-buttons"/>'),e+='</div><div class="portlet-footer"/><div class="portlet-backdrop"/></div>'}});return{View:e}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},,function(t,e,i){var a,n;(function(o,s,r){a=[i(8),i(24),i(15)],n=function(t,e,i){var a=o.Model.extend({}),n=o.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new a;s.each(s.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var i=e.split("metadata_")[1];t.set(i,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),l=n.extend({defaults:s.extend({},n.prototype.defaults,{chunk_url:null,first_data_chunk:null,chunk_index:-1,at_eof:!1}),initialize:function(t){n.prototype.initialize.call(this),this.attributes.chunk_index=this.attributes.first_data_chunk?1:0,this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=r.Deferred();return r.getJSON(this.attributes.chunk_url,{chunk:t.attributes.chunk_index++}).success(function(i){var a;""!==i.ck_data?a=i:(t.attributes.at_eof=!0,a=null),e.resolve(a)}),e}}),h=o.Collection.extend({model:n}),c=o.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new g({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),r.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=r("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=r("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),i=r("<thead/>").appendTo(t),a=r("<tr/>").appendTo(i);if(e)a.append("<th>"+e.join("</th><th>")+"</th>");else for(var n=1;n<=this.model.get_metadata("columns");n++)a.append("<th>"+n+"</th>");var o=this,s=this.model.get("first_data_chunk");s?this._renderChunk(s):r.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,i){var a=r("<td>").text(t),n=this.model.get_metadata("column_types");return void 0!==i?a.attr("colspan",i).addClass("stringalign"):n&&e<n.length&&("str"!==n[e]&&"list"!==n[e]||a.addClass("stringalign")),a},_renderRow:function(t){var e=t.split("	"),i=r("<tr>"),a=this.model.get_metadata("columns");return this.row_count%2!==0&&i.addClass("dark_row"),e.length===a?s.each(e,function(t,e){i.append(this._renderCell(t,e))},this):e.length>a?(s.each(e.slice(0,a-1),function(t,e){i.append(this._renderCell(t,e))},this),i.append(this._renderCell(e.slice(a-1).join("	"),a-1))):a>5&&e.length===a-1?(s.each(e,function(t,e){i.append(this._renderCell(t,e))},this),i.append(r("<td>"))):i.append(this._renderCell(t,0,a)),this.row_count++,i},_renderChunk:function(t){var e=this.$el.find("table");s.each(t.ck_data.split("\n"),function(t,i){""!==t&&e.append(this._renderRow(t))},this)}}),d=c.extend({initialize:function(t){c.prototype.initialize.call(this,t),scroll_elt=s.find(this.$el.parents(),function(t){return"auto"===r(t).css("overflow")}),scroll_elt||(scroll_elt=window),this.scroll_elt=r(scroll_elt)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),u=c.extend({initialize:function(t){c.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),g=o.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){function e(t,e){for(var i=0;i<e.length;i++)if(e[i].match(t))return i;return-1}var a=parent.Galaxy;if(a&&a.modal&&(this.modal=a.modal),a&&a.frame&&(this.frame=a.frame),this.modal&&this.frame){var n=t.model,o=n.get("metadata");if(n.get("file_ext")){if(this.file_ext=n.get("file_ext"),"bed"==this.file_ext){if(!(o.get("chromCol")&&o.get("startCol")&&o.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=o.get("chromCol")-1,this.col.start=o.get("startCol")-1,this.col.end=o.get("endCol")-1}if("vcf"==this.file_ext&&(this.col.chrom=e("Chrom",o.get("column_names")),this.col.start=e("Pos",o.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start))return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.");if(void 0!==this.col.chrom){if(!n.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=n.id,!n.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=n.get("url_viz"),n.get("genome_build")&&(this.genome_build=n.get("genome_build"));var s=new i.IconButtonView({model:new i.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(s.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){function e(t){return!isNaN(parseFloat(t))&&isFinite(t)}if(null!==this.col.chrom){var i=r(t.target).parent(),a=i.children().eq(this.col.chrom).html(),n=i.children().eq(this.col.start).html(),o=this.col.end?i.children().eq(this.col.end).html():n;if(!a.match("^#")&&""!==a&&e(n)){var s={dataset_id:this.dataset_id,gene_region:a+":"+n+"-"+o},l=i.offset(),h=l.left-10,c=l.top-r(window).scrollTop()+3;r("#btn_viz").css({position:"fixed",top:c+"px",left:h+"px"}),r("#btn_viz").off("click"),r("#btn_viz").click(this.create_trackster_action(this.url_viz,s,this.genome_build)),r("#btn_viz").show()}else r("#btn_viz").hide()}},hide:function(){this.$el.find("#btn_viz").hide()},create_trackster_action:function(t,e,i){var a=this;return function(){var n={};return i&&(n["f-dbkey"]=i),r.ajax({url:t+"/list_tracks?"+r.param(n),dataType:"html",error:function(){a.modal.show({title:"Something went wrong!",body:"Unfortunately we could not add this dataset to the track browser. Please try again or contact us.",buttons:{Cancel:function(){a.modal.hide()}}})},success:function(i){a.modal.show({title:"View Data in a New or Saved Visualization",buttons:{Cancel:function(){a.modal.hide()},"View in saved visualization":function(){a.modal.show({title:"Add Data to Saved Visualization",body:i,buttons:{Cancel:function(){a.modal.hide()},"Add to visualization":function(){a.modal.hide(),a.modal.$el.find("input[name=id]:checked").each(function(){var i=r(this).val();e.id=i,a.frame.add({title:"Trackster",type:"url",content:t+"/trackster?"+r.param(e)})})}}})},"View in new visualization":function(){a.modal.hide(),a.frame.add({title:"Trackster",type:"url",content:t+"/trackster?"+r.param(e)})}}})}}),!1}}}),p=function(t){t.model||(t.model=new l(t.dataset_config));var e=t.parent_elt,i=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var a=i?new u(t):new d(t);return a.render(),e&&(e.append(a.$el),a.expand_to_container()),a};return{Dataset:n,TabularDataset:l,DatasetCollection:h,TabularDatasetChunkedView:c,createTabularDatasetChunkedView:p}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(3),i(1))},,function(t,e,i){var a,n;(function(o,s){a=[i(4)],n=function(t){var e=o.View.extend({initialize:function(e){this.options=t.merge(e,{id:t.uid(),title:"",floating:"right",icon:"",cls:"ui-button btn btn-default",cls_wait:"btn btn-info"}),this.setElement(this._template(this.options));var i=this;s(this.el).on("click",function(){s(".tooltip").hide(),e.onclick&&!i.disabled&&e.onclick()}),s(this.el).tooltip({title:e.tooltip,placement:"bottom"})},disable:function(){this.$el.addClass("disabled"),this.disabled=!0},enable:function(){this.$el.removeClass("disabled"),this.disabled=!1},wait:function(){this.$el.removeClass(this.options.cls).addClass(this.options.cls_wait).prop("disabled",!0),this.$(".icon").removeClass(this.options.icon).addClass("fa-spinner fa-spin"),this.$(".title").html("Sending...")},unwait:function(){this.$el.removeClass(this.options.cls_wait).addClass(this.options.cls).prop("disabled",!1),this.$(".icon").removeClass("fa-spinner fa-spin").addClass(this.options.icon),this.$(".title").html(this.options.title)},_template:function(t){var e='<button id="'+t.id+'" type="submit" style="float: '+t.floating+';" type="button" class="'+t.cls+'">';return t.icon&&(e+='<i class="icon fa '+t.icon+'"/>&nbsp;'),e+='<span class="title">'+t.title+"</span></button>"}}),i=e.extend({initialize:function(t){e.prototype.initialize.call(this,t)},_template:function(t){return'<a id="'+t.id+'" class="'+t.cls+'" href="'+(t.href||"javascript:void(0)")+'" title="'+t.title+'" target="'+(t.target||"_top")+'"><span class="'+t.icon+'"/></a>'}}),a=o.View.extend({initialize:function(e){this.options=t.merge(e,{title:"Select/Unselect all",icons:["fa fa-square-o","fa fa-minus-square-o","fa fa-check-square-o"],value:0}),this.setElement(this._template()),this.$title=this.$(".title"),this.$icon=this.$(".icon"),this.value(this.options.value),this.$title.html(this.options.title);var i=this;this.$el.on("click",function(){i.current=0===i.current&&2||0,i.value(i.current),i.options.onclick&&i.options.onclick()})},value:function(t,e){return void 0!==t&&(e&&0!==t&&(t=t!==e&&1||2),this.current=t,this.$icon.removeClass().addClass("icon").addClass(this.options.icons[t]),this.options.onchange&&this.options.onchange(t)),this.current},_template:function(){return'<div class="ui-button-check" ><span class="icon"/><span class="title"/></div>'}}),n=o.View.extend({initialize:function(e){this.options=t.merge(e,{id:t.uid(),title:"",floating:"right",cls:"ui-button-icon",icon:"",tooltip:"",onclick:null}),this.setElement(this._template(this.options)),this.$button=this.$el.find(".button");var i=this;s(this.el).on("click",function(){s(".tooltip").hide(),e.onclick&&!i.disabled&&e.onclick()}),this.$button.tooltip({title:e.tooltip,placement:"bottom"})},disable:function(){this.$button.addClass("disabled"),this.disabled=!0},enable:function(){this.$button.removeClass("disabled"),this.disabled=!1},setIcon:function(t){this.$("i").removeClass(this.options.icon).addClass(t),this.options.icon=t},_template:function(t){var e="";t.title&&(e="width: auto;");var i='<div id="'+t.id+'" style="float: '+t.floating+"; "+e+'" class="'+t.cls+'"><div class="button">';return i+=t.title?'<i class="icon fa '+t.icon+'"/>&nbsp;<span class="title">'+t.title+"</span>":'<i class="icon fa '+t.icon+'"/>',i+="</div></div>"}}),r=o.View.extend({$menu:null,initialize:function(e){this.options=t.merge(e,{id:"",title:"",floating:"right",pull:"right",icon:null,onclick:null,cls:"ui-button-icon ui-button-menu",tooltip:"",target:"",href:"",onunload:null,visible:!0,tag:""}),this.setElement(s(this._template(this.options)));var i=s(this.el).find(".root"),a=this;i.on("click",function(t){s(".tooltip").hide(),t.preventDefault(),a.options.onclick&&a.options.onclick()}),this.options.visible||this.hide(),i.tooltip({title:e.tooltip,placement:"bottom"})},show:function(){s(this.el).show()},hide:function(){s(this.el).hide()},addMenu:function(e){var i={title:"",target:"",href:"",onclick:null,divider:!1,icon:null,cls:"button-menu btn-group"};i=t.merge(e,i),this.$menu||(s(this.el).append(this._templateMenu()),this.$menu=s(this.el).find(".menu"));var a=s(this._templateMenuItem(i));a.on("click",function(t){i.onclick&&(t.preventDefault(),i.onclick())}),this.$menu.append(a),i.divider&&this.$menu.append(s(this._templateDivider()))},_templateMenuItem:function(t){var e='<li><a class="dropdown-item" href="'+t.href+'" target="'+t.target+'" ';return t.download&&(e+='download="'+t.download+'"'),e+=">",t.icon&&(e+='<i class="fa '+t.icon+'"/>'),e+=" "+t.title+"</a></li>"},_templateMenu:function(){return'<ul class="menu dropdown-menu pull-'+this.options.pull+'" role="menu"/>'},_templateDivider:function(){return'<li class="divider"/>'},_template:function(t){var e="",i="";t.title?e="width: auto;":i="margin: 0px;";var a='<div id="'+t.id+'" style="float: '+t.floating+"; "+e+'" class="dropdown '+t.cls+'"><div class="root button dropdown-toggle" data-toggle="dropdown" style="'+i+'"><i class="icon fa '+t.icon+'"/>';return t.title&&(a+='&nbsp;<span class="title">'+t.title+"</span>"),a+="</div></div>"}});return{ButtonDefault:e,ButtonLink:i,ButtonIcon:n,ButtonCheck:a,ButtonMenu:r}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},function(t,e,i){var a,n;(function(o,s){a=[i(4)],n=function(t){var e=o.View.extend({row:null,row_count:0,optionsDefault:{content:"No content available.",onchange:null,ondblclick:null,onconfirm:null,cls:"ui-table",cls_tr:""},events:{click:"_onclick",dblclick:"_ondblclick"},initialize:function(e){this.options=t.merge(e,this.optionsDefault);var i=s(this._template(this.options));this.$thead=i.find("thead"),this.$tbody=i.find("tbody"),this.$tmessage=i.find("tmessage"),this.setElement(i),this.row=this._row()},addHeader:function(t){var e=s("<th></th>");e.append(t),this.row.append(e)},appendHeader:function(){this.$thead.append(this.row),this.row=s("<tr></tr>")},add:function(t,e,i){var a=s("<td></td>");e&&a.css("width",e),i&&a.css("text-align",i),a.append(t),this.row.append(a)},append:function(t,e){this._commit(t,e,!1)},prepend:function(t,e){this._commit(t,e,!0)},get:function(t){return this.$el.find("#"+t)},del:function(t){var e=this.$tbody.find("#"+t);e.length>0&&(e.remove(),this.row_count--,this._refresh())},delAll:function(){this.$tbody.empty(),this.row_count=0,this._refresh()},value:function(t){this.before=this.$tbody.find(".current").attr("id"),void 0!==t&&(this.$tbody.find("tr").removeClass("current"),t&&this.$tbody.find("#"+t).addClass("current"));var e=this.$tbody.find(".current").attr("id");return void 0===e?null:(e!=this.before&&this.options.onchange&&this.options.onchange(t),e)},size:function(){return this.$tbody.find("tr").length},_commit:function(t,e,i){this.del(t),this.row.attr("id",t),i?this.$tbody.prepend(this.row):this.$tbody.append(this.row),e&&(this.row.hide(),this.row.fadeIn()),this.row=this._row(),this.row_count++,this._refresh()},_row:function(){return s('<tr class="'+this.options.cls_tr+'"></tr>')},_onclick:function(t){var e=this.value(),i=s(t.target).closest("tr").attr("id");""!=i&&i&&e!=i&&(this.options.onconfirm?this.options.onconfirm(i):this.value(i))},_ondblclick:function(t){var e=this.value();e&&this.options.ondblclick&&this.options.ondblclick(e)},_refresh:function(){0==this.row_count?this.$tmessage.show():this.$tmessage.hide()},_template:function(t){return'<div><table class="'+t.cls+'"><thead></thead><tbody></tbody></table><tmessage>'+t.content+"</tmessage><div>"}});return{View:e}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},function(t,e,i){var a,n;(function(i,o,s){a=[],n=function(){var t=i.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),e=i.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return o.isFunction(this.model.get("on_click"))?(this.model.get("on_click")(t),!1):!0},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",s(e)}}),a=i.Collection.extend({model:t}),n=i.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var i=s("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&i.tooltip(e.attributes.tooltip_config);var a=e.get("options");a&&make_popupmenu(i,a)}),this}}),r=function(e,i){i||(i={});var s=new a(o.map(e,function(e){return new t(o.extend(e,i))}));return new n({collection:s})};return{IconButton:t,IconButtonView:e,IconButtonCollection:a,IconButtonMenuView:n,create_icon_buttons_menu:r}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(3),i(1))},function(t,e,i){var a,n,o;!function(s){n=[i(1)],a=s,o="function"==typeof a?a.apply(e,n):a,!(void 0!==o&&(t.exports=o))}(function(t){"use_strict";var e=t;e.fn.make_text_editable=function(t){var i="num_cols"in t?t.num_cols:30,a="num_rows"in t?t.num_rows:4,n="use_textarea"in t?t.use_textarea:!1,o="on_finish"in t?t.on_finish:null,s="help_text"in t?t.help_text:null,r=e(this);return r.addClass("editable-text").click(function(s){if(!(e(this).children(":input").length>0)){r.removeClass("editable-text");var l,h,c=function(t){r.find(":input").remove(),""!==t?r.text(t):r.html("<br>"),r.addClass("editable-text"),o&&o(t)},d="cur_text"in t?t.cur_text:r.text();n?(l=e("<textarea/>").attr({rows:a,cols:i}).text(e.trim(d)).keyup(function(t){27===t.keyCode&&c(d)}),h=e("<button/>").text("Done").click(function(){return c(l.val()),!1})):l=e("<input type='text'/>").attr({value:e.trim(d),size:i}).blur(function(){c(d)}).keyup(function(t){27===t.keyCode?e(this).trigger("blur"):13===t.keyCode&&c(e(this).val()),t.stopPropagation()}),r.text(""),r.append(l),h&&r.append(h),l.focus(),l.select(),s.stopPropagation()}}),s&&r.attr("title",s).tooltip(),r}})},function(t,e,i){var a;(function(n,o){a=function(){function t(t){t+="";for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}var e=function(t){return"promise"in t},i=n.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(t){return!0}},go:function(){var t=o.Deferred(),e=this,i=e.get("ajax_settings"),a=e.get("success_fn"),n=e.get("interval"),s=function(){o.ajax(i).success(function(e){a(e)?t.resolve(e):setTimeout(s,n)})};return s(),t}}),a=function(t){t||(t="#ffffff"),"string"==typeof t&&(t=[t]);for(var e=0;e<t.length;e++)t[e]=parseInt(t[e].slice(1),16);var i,a,n,o,s,r,l,h,c,d,u,g=function(t,e,i){return(299*t+587*e+114*i)/1e3},p=function(t,e,i,a,n,o){return Math.max(t,a)-Math.min(t,a)+(Math.max(e,n)-Math.min(e,n))+(Math.max(i,o)-Math.min(i,o))},_=!1,f=0;do{for(i=Math.round(16777215*Math.random()),a=(16711680&i)>>16,n=(65280&i)>>8,o=255&i,c=g(a,n,o),_=!0,e=0;e<t.length;e++)if(s=t[e],r=(16711680&s)>>16,l=(65280&s)>>8,h=255&s,d=g(r,l,h),u=p(a,n,o,r,l,h),Math.abs(c-d)<40||200>u){_=!1;break}f++}while(!_&&10>=f);return"#"+(16777216+i).toString(16).substr(1,6)};return{commatize:t,is_deferred:e,ServerStateDeferred:i,get_random_color:a}}.call(e,i,e,t),!(void 0!==a&&(t.exports=a))}).call(e,i(2),i(1))},function(t,e,i){var a,n;(function(o){a=[i(28),i(6),i(5)],n=function(t,e,i){t=t||window.BibtexParser;var a="citation",n=o.Model.extend(e.LoggableMixin).extend({_logNamespace:a,initialize:function(){var e=this.get("content"),i=t(e).entries[0];this.entry=i,this._fields={};var a=i.Fields;for(var n in a){var o=a[n],s=n.toLowerCase();this._fields[s]=o}},entryType:function(){return this.entry.EntryType},fields:function(){return this._fields}}),s=o.Collection.extend(e.LoggableMixin).extend({_logNamespace:a,urlRoot:Galaxy.root+"api",partial:!0,model:n}),r=s.extend({url:function(){return this.urlRoot+"/histories/"+this.history_id+"/citations"}}),l=s.extend({url:function(){return this.urlRoot+"/tools/"+this.tool_id+"/citations"},partial:!1});return{Citation:n,HistoryCitationCollection:r,ToolCitationCollection:l}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2))},function(t,e,i){var a,n;a=[i(4),i(7),i(45),i(20)],n=function(t,e,i,a){var n=i.extend({initialize:function(a){var n=this;i.prototype.initialize.call(this,t.merge({customize:function(t){t.buttons={execute:execute_btn=new e.Button({icon:"fa-check",tooltip:"Execute: "+t.name+" ("+t.version+")",title:"Execute",cls:"btn btn-primary",floating:"clear",onclick:function(){execute_btn.wait(),n.portlet.disable(),n.submit(t,function(){execute_btn.unwait(),n.portlet.enable()})}})},t.job_id&&t.job_remap&&(t.inputs.rerun_remap_job_id={label:"Resume dependencies from this job",name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",t.job_id],["No","__ignore__"]],help:"The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run."})}},a))},submit:function(e,i){var n=this,o={tool_id:e.id,tool_version:e.version,inputs:this.data.create()};return this.trigger("reset"),n.validate(o)?(Galaxy.emit.debug("tool-form::submit()","Validation complete.",o),void t.request({type:"POST",url:Galaxy.root+"api/tools",data:o,success:function(t){i&&i(),n.$el.empty().append(a.success(t)),parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.refreshContents()},error:function(t){if(i&&i(),Galaxy.emit.debug("tool-form::submit","Submission failed.",t),t&&t.err_data){var e=n.data.matchResponse(t.err_data);for(var s in e){n.highlight(s,e[s]);break}}else n.modal.show({title:"Job submission failed",body:t&&t.err_msg||a.error(o),buttons:{Close:function(){n.modal.hide()}}})}})):(Galaxy.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(i&&i()))},validate:function(t){var e=t.inputs,i=-1,a=null;for(var n in e){var o=e[n],s=this.data.match(n),r=this.field_list[s],l=this.input_list[s];if(s&&l&&r){if(!l.optional&&null==o)return this.highlight(s),!1;if(o&&o.batch){var h=o.values.length,c=h>0&&o.values[0]&&o.values[0].src;if(c)if(null===a)a=c;else if(a!==c)return this.highlight(s,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===i)i=h;else if(i!==h)return this.highlight(s,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+h+"</b> selection(s) while a previous field contains <b>"+i+"</b>."),!1}}else Galaxy.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0}});return{View:n}}.apply(e,a),!(void 0!==n&&(t.exports=n))},function(t,e,i){var a,n;(function(i){a=[],n=function(){return{help:function(t){var e=i("<div/>").addClass("ui-form-help").append(t.help);return e.find("a").attr("target","_blank"),e},success:function(t){if(!t.jobs||!t.jobs.length)return this.error(t);var e=t.jobs.length,i="";i=1==e?"1 job has":e+" jobs have";var a='<div class="donemessagelarge"><p>'+i+" been successfully added to the queue - resulting in the following datasets:</p>";for(var n in t.outputs)a+='<p style="padding: 10px 20px;"><b>'+t.outputs[n].hid+": "+t.outputs[n].name+"</b></p>";return a+="<p>You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.</p></div>"},error:function(t){return'<div><p>The server could not complete the request. Please contact the Galaxy Team if this error persists.</p><textarea class="ui-textarea" disabled style="color: black; height: 300px !important;">'+JSON.stringify(t,void 0,4)+"</textarea></div>"},requirements:function(t){var e="This tool requires ";for(var i in t.requirements){var a=t.requirements[i];e+=a.name,a.version&&(e+=" (Version "+a.version+")"),i<t.requirements.length-2&&(e+=", "),i==t.requirements.length-2&&(e+=" and ")}return e+'. Click <a target="_blank" href="https://wiki.galaxyproject.org/Tools/Requirements">here</a> for more information.'}}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(1))},function(t,e,i){var a,n;(function(o,s){a=[i(4),i(9),i(7)],n=function(t,e,i){var a=o.View.extend({initialize:function(t){var a=this;this.options=t,this.name=t.name||"element",this.multiple=t.multiple||!1,this.message=new i.Message,this.portlet=new e.View({cls:"ui-portlet-section"}),this.select=new i.Select.View({optional:t.optional}),this.button=new i.ButtonIcon({icon:"fa fa-sign-in",floating:"left",tooltip:"Insert new "+this.name,onclick:function(){a.add({id:a.select.value(),name:a.select.text()})}}),this.setElement(this._template(t)),this.$(".ui-list-message").append(this.message.$el),this.$(".ui-list-portlet").append(this.portlet.$el),this.$(".ui-list-button").append(this.button.$el),this.$(".ui-list-select").append(this.select.$el)},value:function(t){if(void 0!==t){if(this.portlet.empty(),s.isArray(t))for(var e in t){var i=t[e],a=null,n=null;"string"!=s.type(i)?(a=i.id,n=i.name):a=n=i,null!=a&&this.add({id:a,name:n})}this._refresh()}var o=[];return this.$(".ui-list-id").each(function(){o.push({id:s(this).prop("id"),name:s(this).find(".ui-list-name").html()})}),0==o.length?null:o},add:function(e){var i=this;if(0===this.$('[id="'+e.id+'"]').length)if(t.validate(e.id)){var a=s(this._templateRow({id:e.id,name:e.name}));a.on("click",function(){a.remove(),i._refresh()}),a.on("mouseover",function(){a.addClass("portlet-highlight")}),a.on("mouseout",function(){
a.removeClass("portlet-highlight")}),this.portlet.append(a),this._refresh()}else this.message.update({message:"Please select a valid "+this.name+".",status:"danger"});else this.message.update({message:"This "+this.name+" is already in the list."})},update:function(t){this.select.update(t)},_refresh:function(){this.$(".ui-list-id").length>0?(!this.multiple&&this.button.disable(),this.$(".ui-list-portlet").show()):(this.button.enable(),this.$(".ui-list-portlet").hide()),this.options.onchange&&this.options.onchange()},_template:function(t){return'<div class="ui-list"><div class="ui-margin-top"><span class="ui-list-button"/><span class="ui-list-select"/></div><div class="ui-list-message"/><div class="ui-list-portlet"/></div>'},_templateRow:function(t){return'<div id="'+t.id+'" class="ui-list-id"><span class="ui-list-delete fa fa-trash"/><span class="ui-list-name">'+t.name+"</span></div>"}});return{View:a}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},function(t,e,i){var a,n;(function(o,s){a=[i(4),i(13)],n=function(t,e){var i=o.View.extend({initialize:function(i){var a=this;this.options=t.merge(i,{visible:!0,data:[],id:t.uid(),error_text:"No options available.",wait_text:"Please wait...",multiple:!1}),this.setElement('<div class="ui-options"/>'),this.$message=s("<div/>"),this.$options=s(this._template(i)),this.$menu=s('<div class="ui-options-menu"/>'),this.$el.append(this.$message),this.$el.append(this.$menu),this.$el.append(this.$options),this.options.multiple&&(this.all_button=new e.ButtonCheck({onclick:function(){a.$("input").prop("checked",0!==a.all_button.value()),a.trigger("change")}}),this.$menu.append(this.all_button.$el)),this.options.visible||this.$el.hide(),this.update(this.options.data),void 0!==this.options.value&&this.value(this.options.value),this.on("change",function(){this.options.onchange&&this.options.onchange(this.value())})},update:function(t){var e=this._getValue();if(this.$options.empty(),this._templateOptions)this.$options.append(this._templateOptions(t));else for(var i in t){var a=s(this._templateOption(t[i]));a.addClass("ui-option"),a.tooltip({title:t[i].tooltip,placement:"bottom"}),this.$options.append(a)}var n=this;this.$("input").on("change",function(){n.value(n._getValue()),n.trigger("change")}),this.value(e),this.unwait()},value:function(t){if(void 0!==t&&(this.$("input").prop("checked",!1),null!==t)){t instanceof Array||(t=[t]);for(var e in t)this.$('input[value="'+t[e]+'"]').first().prop("checked",!0)}var i=this._getValue();if(this.all_button){var a=i;a=a instanceof Array?a.length:0,this.all_button.value(a,this._size())}return i},exists:function(t){if(void 0!==t){t instanceof Array||(t=[t]);for(var e in t)if(this.$('input[value="'+t[e]+'"]').length>0)return!0}return!1},first:function(){var t=this.$("input").first();return t.length>0?t.val():null},wait:function(){0==this._size()&&(this._messageShow(this.options.wait_text,"info"),this.$options.hide(),this.$menu.hide())},unwait:function(){var t=this._size();0==t?(this._messageShow(this.options.error_text,"danger"),this.$options.hide(),this.$menu.hide()):(this._messageHide(),this.$options.css("display","inline-block"),this.$menu.show())},_getValue:function(){var e=[];return this.$(":checked").each(function(){e.push(s(this).val())}),t.validate(e)?this.options.multiple?e:e[0]:null},_size:function(){return this.$(".ui-option").length},_messageShow:function(t,e){this.$message.show(),this.$message.removeClass(),this.$message.addClass("ui-message alert alert-"+e),this.$message.html(t)},_messageHide:function(){this.$message.hide()},_template:function(){return'<div class="ui-options-list"/>'}}),a=i.extend({_templateOption:function(e){var i=t.uid();return'<div class="ui-option"><input id="'+i+'" type="'+this.options.type+'" name="'+this.options.id+'" value="'+e.value+'"/><label class="ui-options-label" for="'+i+'">'+e.label+"</label></div>"}}),n={};n.View=a.extend({initialize:function(t){t.type="radio",a.prototype.initialize.call(this,t)}});var r={};r.View=a.extend({initialize:function(t){t.multiple=!0,t.type="checkbox",a.prototype.initialize.call(this,t)}});var l={};return l.View=i.extend({initialize:function(t){i.prototype.initialize.call(this,t)},value:function(t){return void 0!==t&&(this.$("input").prop("checked",!1),this.$("label").removeClass("active"),this.$('[value="'+t+'"]').prop("checked",!0).closest("label").addClass("active")),this._getValue()},_templateOption:function(t){var e="fa "+t.icon;t.label||(e+=" no-padding");var i='<label class="btn btn-default">';return t.icon&&(i+='<i class="'+e+'"/>'),i+='<input type="radio" name="'+this.options.id+'" value="'+t.value+'"/>',t.label&&(i+=t.label),i+="</label>"},_template:function(){return'<div class="btn-group ui-radiobutton" data-toggle="buttons"/>'}}),{Base:i,BaseIcons:a,Radio:n,RadioButton:l,Checkbox:r}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},,,,,function(t,e,i){var a,n;(function(o,s,r){a=[i(4)],n=function(t){var e=o.View.extend({optionsDefault:{title_new:"",operations:null,onnew:null,max:null,onchange:null},initialize:function(e){this.visible=!1,this.$nav=null,this.$content=null,this.first_tab=null,this.current_id=null,this.options=t.merge(e,this.optionsDefault);var i=s(this._template(this.options));this.$nav=i.find(".tab-navigation"),this.$content=i.find(".tab-content"),this.setElement(i),this.list={};var a=this;if(this.options.operations&&s.each(this.options.operations,function(t,e){e.$el.prop("id",t),a.$nav.find(".operations").append(e.$el)}),this.options.onnew){var n=s(this._template_tab_new(this.options));this.$nav.append(n),n.tooltip({title:"Add a new tab",placement:"bottom",container:a.$el}),n.on("click",function(t){n.tooltip("hide"),a.options.onnew()})}},size:function(){return r.size(this.list)},current:function(){return this.$el.find(".tab-pane.active").attr("id")},add:function(t){var e=this,i=t.id,a=s(this._template_tab(t)),n=s(this._template_tab_content(t));if(this.list[i]=!!t.ondel,this.options.onnew?this.$nav.find("#new-tab").before(a):this.$nav.append(a),n.append(t.$el),this.$content.append(n),1==this.size()&&(a.addClass("active"),n.addClass("active"),this.first_tab=i),this.options.max&&this.size()>=this.options.max&&this.$el.find("#new-tab").hide(),t.ondel){var o=a.find("#delete");o.tooltip({title:"Delete this tab",placement:"bottom",container:e.$el}),o.on("click",function(){return o.tooltip("destroy"),e.$el.find(".tooltip").remove(),t.ondel(),!1})}a.on("click",function(a){a.preventDefault(),t.onclick?t.onclick():e.show(i)}),this.current_id||(this.current_id=i)},del:function(t){this.$el.find("#tab-"+t).remove(),this.$el.find("#"+t).remove(),this.first_tab==t&&(this.first_tab=null),null!=this.first_tab&&this.show(this.first_tab),this.list[t]&&delete this.list[t],this.size()<this.options.max&&this.$el.find("#new-tab").show()},delRemovable:function(){for(var t in this.list)this.del(t)},show:function(t){this.$el.fadeIn("fast"),this.visible=!0,t&&(this.$el.find("#tab-"+this.current_id).removeClass("active"),this.$el.find("#"+this.current_id).removeClass("active"),this.$el.find("#tab-"+t).addClass("active"),this.$el.find("#"+t).addClass("active"),this.current_id=t),this.options.onchange&&this.options.onchange(t)},hide:function(){this.$el.fadeOut("fast"),this.visible=!1},hideOperation:function(t){this.$nav.find("#"+t).hide()},showOperation:function(t){this.$nav.find("#"+t).show()},setOperation:function(t,e){var i=this.$nav.find("#"+t);i.off("click"),i.on("click",e)},title:function(t,e){var i=this.$el.find("#tab-title-text-"+t);return e&&i.html(e),i.html()},retitle:function(t){var e=0;for(var i in this.list)this.title(i,++e+": "+t)},_template:function(t){return'<div class="ui-tabs tabbable tabs-left"><ul id="tab-navigation" class="tab-navigation nav nav-tabs"><div class="operations" style="float: right; margin-bottom: 4px;"></div></ul><div id="tab-content" class="tab-content"/></div>'},_template_tab_new:function(t){return'<li id="new-tab"><a href="javascript:void(0);"><i class="ui-tabs-add fa fa-plus-circle"/>'+t.title_new+"</a></li>"},_template_tab:function(t){var e='<li id="tab-'+t.id+'" class="tab-element"><a id="tab-title-link-'+t.id+'" title="" href="#'+t.id+'" data-original-title=""><span id="tab-title-text-'+t.id+'" class="tab-title-text">'+t.title+"</span>";return t.ondel&&(e+='<i id="delete" class="ui-tabs-delete fa fa-minus-circle"/>'),e+="</a></li>"},_template_tab_content:function(t){return'<div id="'+t.id+'" class="tab-pane"/>'}});return{View:e}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1),i(3))},function(t,e){function i(t){function e(t){n.push(t)}if("string"==typeof t){var a={},n=[],o=i.call(a,e);return o.parse(t),{entries:n,errors:o.getErrors()}}if("function"!=typeof t)throw"Invalid parser construction.";return this.STATES_={ENTRY_OR_JUNK:0,OBJECT_TYPE:1,ENTRY_KEY:2,KV_KEY:3,EQUALS:4,KV_VALUE:5},this.DATA_={},this.CALLBACK_=t,this.CHAR_=0,this.LINE_=1,this.CHAR_IN_LINE_=0,this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.PARSETMP_={},this.SKIPTILLEOL_=!1,this.VALBRACES_=null,this.BRACETYPE_=null,this.BRACECOUNT_=0,this.STATE_=this.STATES_.ENTRY_OR_JUNK,this.ERRORS_=[],this.ENTRY_TYPES_={inproceedings:1,proceedings:2,article:3,techreport:4,misc:5,mastersthesis:6,book:7,phdthesis:8,incollection:9,unpublished:10,inbook:11,manual:12,periodical:13,booklet:14,masterthesis:15,conference:16,online:998,data:999},this.MACROS_={jan:"January",feb:"February",mar:"March",apr:"April",may:"May",jun:"June",jul:"July",aug:"August",sep:"September",oct:"October",nov:"November",dec:"December",Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"},this.getErrors=function(){return this.ERRORS_},this.parse=function(t){for(var e=0;e<t.length;e++)this.processCharacter_(t[e])},this.error_=function(t){this.ERRORS_.push([this.LINE_,this.CHAR_IN_LINE_,this.CHAR_,t])},this.processEntry_=function(){var t=this.DATA_;if(t.Fields)for(var e in t.Fields){for(var i=t.Fields[e],a=0;a<this.CHARCONV_.length;a++){var n=this.CHARCONV_[a][0],o=this.CHARCONV_[a][1];i=i.replace(n,o)}i=i.replace(/[\n\r\t]/g," ").replace(/\s\s+/g," ").replace(/^\s+|\s+$/g,"");for(var s=i.length,r="",a=0;s>a;a++){var l=i[a],h=!1;"\\"==l&&s-1>a?l=i[++a]:"{"!=l&&"}"!=l||(h=!0),h||(r+=l)}t.Fields[e]=r}if("string"==t.ObjectType)for(var e in t.Fields)this.MACROS_[e]=t.Fields[e];else this.CALLBACK_(t)},this.processCharacter_=function(t){if(this.CHAR_++,this.CHAR_IN_LINE_++,"\n"==t&&(this.LINE_++,this.CHAR_IN_LINE_=1),this.SKIPTILLEOL_)return void("\n"==t&&(this.SKIPTILLEOL_=!1));if(this.SKIPCOMMENT_&&"%"==t)return void(this.SKIPTILLEOL_=!0);if(!this.SKIPWS_||!/\s/.test(t)){this.SKIPWS_=!1,this.SKIPCOMMENT_=!1,this.SKIPTILLEOL_=!1;for(var e=!0;e;)switch(e=!1,this.STATE_){case this.STATES_.ENTRY_OR_JUNK:"@"==t&&(this.STATE_=this.STATES_.OBJECT_TYPE,this.DATA_={ObjectType:""}),this.BRACETYPE_=null,this.SKIPWS_=!0,this.SKIPCOMMENT_=!0;break;case this.STATES_.OBJECT_TYPE:if(/[A-Za-z]/.test(t))this.DATA_.ObjectType+=t.toLowerCase(),this.SKIPWS_=!0,this.SKIPCOMMENT_=!0;else{var i=this.DATA_.ObjectType;"comment"==i?this.STATE_=this.STATES_.ENTRY_OR_JUNK:"string"==i?(this.DATA_.ObjectType=i,this.DATA_.Fields={},this.BRACETYPE_=t,this.BRACECOUNT_=1,this.STATE_=this.STATES_.KV_KEY,this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.PARSETMP_={Key:""}):"preamble"==i?this.STATE_=this.STATES_.ENTRY_OR_JUNK:i in this.ENTRY_TYPES_?(this.DATA_.ObjectType="entry",this.DATA_.EntryType=i,this.DATA_.EntryKey="",this.STATE_=this.STATES_.ENTRY_KEY,e=!0):(this.error_('Unrecognized object type: "'+this.DATA_.ObjectType+'"'),this.STATE_=this.STATES_.ENTRY_OR_JUNK)}break;case this.STATES_.ENTRY_KEY:if(("{"===t||"("===t)&&null==this.BRACETYPE_){this.BRACETYPE_=t,this.BRACECOUNT_=1,this.SKIPWS_=!0,this.SKIPCOMMENT_=!0;break}/[,%\s]/.test(t)?this.DATA_.EntryKey.length<1?(this.SKIPWS_=!0,this.SKIPCOMMENT_=!0):null==this.BRACETYPE_?(this.error_("No opening brace for object."),this.STATE_=this.STATES_.ENTRY_OR_JUNK):(this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,e=!0,this.STATE_=this.STATES_.KV_KEY,this.PARSETMP_.Key="",this.DATA_.Fields={}):(this.DATA_.EntryKey+=t,this.SKIPWS_=!1,this.SKIPCOMMENT_=!1);break;case this.STATES_.KV_KEY:if("}"==t&&"{"==this.BRACETYPE_||")"==t&&"("==this.BRACETYPE_){this.processEntry_(),this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.STATE_=this.STATES_.ENTRY_OR_JUNK;break}/[\-A-Za-z:]/.test(t)?(this.PARSETMP_.Key+=t,this.SKIPWS_=!1,this.SKIPCOMMENT_=!1):this.PARSETMP_.Key.length<1?(this.SKIPWS_=!0,this.SKIPCOMMENT_=!0):(this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.STATE_=this.STATES_.EQUALS,e=!0);break;case this.STATES_.EQUALS:if("}"==t&&"{"==this.BRACETYPE_||")"==t&&"("==this.BRACETYPE_){this.error_('Key-value pair has key "'+this.PARSETMP_.Key+'", but no value.'),this.processEntry_(),this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.STATE_=this.STATES_.ENTRY_OR_JUNK;break}"="==t&&(this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.STATE_=this.STATES_.KV_VALUE,this.PARSETMP_.Value="",this.VALBRACES_={'"':[],"{":[]});break;case this.STATES_.KV_VALUE:var a=this.VALBRACES_,n=this.PARSETMP_.Value,o=!1;if('"'==t||"{"==t||"}"==t||","==t){if(","==t&&0===a['"'].length+a["{"].length){var s=this.PARSETMP_.Value.trim();s in this.MACROS_?this.PARSETMP_.Value=this.MACROS_[s]:this.error_("Reference to an undefined macro: "+s),o=!0}if('"'==t){if(0===a['"'].length+a["{"].length){a['"'].push(this.CHAR_),this.SKIPWS_=!1,this.SKIPCOMMENT_=!1;break}1!=a['"'].length||0!=a["{"].length||0!=n.length&&"\\"==n[n.length-1]||(o=!0)}if("{"==t&&(0!=n.length&&"\\"==n[n.length-1]||(a["{"].push(this.CHAR_),this.SKIPWS_=!1,this.SKIPCOMMENT_=!1)),"}"==t)if(0===a['"'].length+a["{"].length){var s=this.PARSETMP_.Value.trim();s in this.MACROS_?this.PARSETMP_.Value=this.MACROS_[s]:this.error_("Reference to an undefined macro: "+s),e=!0,o=!0}else 0!=n.length&&"\\"==n[n.length-1]||a["{"].length>0&&(a["{"].splice(a["{"].length-1,1),0==a["{"].length+a['"'].length&&(o=!0))}o?(this.SKIPWS_=!0,this.SKIPCOMMENT_=!0,this.STATE_=this.STATES_.KV_KEY,this.DATA_.Fields[this.PARSETMP_.Key]=this.PARSETMP_.Value,this.PARSETMP_={Key:""},this.VALBRACES_=null):this.PARSETMP_.Value+=t}}},this.CHARCONV_=[[/\\space /g," "],[/\\textdollar /g,"$"],[/\\textquotesingle /g,"'"],[/\\ast /g,"*"],[/\\textbackslash /g,"\\"],[/\\\^\{\}/g,"^"],[/\\textasciigrave /g,"`"],[/\\lbrace /g,"{"],[/\\vert /g,"|"],[/\\rbrace /g,"}"],[/\\textasciitilde /g,"~"],[/\\textexclamdown /g,"¡"],[/\\textcent /g,"¢"],[/\\textsterling /g,"£"],[/\\textcurrency /g,"¤"],[/\\textyen /g,"¥"],[/\\textbrokenbar /g,"¦"],[/\\textsection /g,"§"],[/\\textasciidieresis /g,"¨"],[/\\textcopyright /g,"©"],[/\\textordfeminine /g,"ª"],[/\\guillemotleft /g,"«"],[/\\lnot /g,"¬"],[/\\textregistered /g,"®"],[/\\textasciimacron /g,"¯"],[/\\textdegree /g,"°"],[/\\pm /g,"±"],[/\\textasciiacute /g,"´"],[/\\mathrm\{\\mu\}/g,"µ"],[/\\textparagraph /g,"¶"],[/\\cdot /g,"·"],[/\\c\{\}/g,"¸"],[/\\textordmasculine /g,"º"],[/\\guillemotright /g,"»"],[/\\textonequarter /g,"¼"],[/\\textonehalf /g,"½"],[/\\textthreequarters /g,"¾"],[/\\textquestiondown /g,"¿"],[/\\`\{A\}/g,"À"],[/\\'\{A\}/g,"Á"],[/\\\^\{A\}/g,"Â"],[/\\~\{A\}/g,"Ã"],[/\\"\{A\}/g,"Ä"],[/\\AA /g,"Å"],[/\\AE /g,"Æ"],[/\\c\{C\}/g,"Ç"],[/\\`\{E\}/g,"È"],[/\\'\{E\}/g,"É"],[/\\\^\{E\}/g,"Ê"],[/\\"\{E\}/g,"Ë"],[/\\`\{I\}/g,"Ì"],[/\\'\{I\}/g,"Í"],[/\\\^\{I\}/g,"Î"],[/\\"\{I\}/g,"Ï"],[/\\DH /g,"Ð"],[/\\~\{N\}/g,"Ñ"],[/\\`\{O\}/g,"Ò"],[/\\'\{O\}/g,"Ó"],[/\\\^\{O\}/g,"Ô"],[/\\~\{O\}/g,"Õ"],[/\\"\{O\}/g,"Ö"],[/\\texttimes /g,"×"],[/\\O /g,"Ø"],[/\\`\{U\}/g,"Ù"],[/\\'\{U\}/g,"Ú"],[/\\\^\{U\}/g,"Û"],[/\\"\{U\}/g,"Ü"],[/\\'\{Y\}/g,"Ý"],[/\\TH /g,"Þ"],[/\\ss /g,"ß"],[/\\`\{a\}/g,"à"],[/\\'\{a\}/g,"á"],[/\\\^\{a\}/g,"â"],[/\\~\{a\}/g,"ã"],[/\\"\{a\}/g,"ä"],[/\\aa /g,"å"],[/\\ae /g,"æ"],[/\\c\{c\}/g,"ç"],[/\\`\{e\}/g,"è"],[/\\'\{e\}/g,"é"],[/\\\^\{e\}/g,"ê"],[/\\"\{e\}/g,"ë"],[/\\`\{\\i\}/g,"ì"],[/\\'\{\\i\}/g,"í"],[/\\\^\{\\i\}/g,"î"],[/\\"\{\\i\}/g,"ï"],[/\\dh /g,"ð"],[/\\~\{n\}/g,"ñ"],[/\\`\{o\}/g,"ò"],[/\\'\{o\}/g,"ó"],[/\\\^\{o\}/g,"ô"],[/\\~\{o\}/g,"õ"],[/\\"\{o\}/g,"ö"],[/\\div /g,"÷"],[/\\o /g,"ø"],[/\\`\{u\}/g,"ù"],[/\\'\{u\}/g,"ú"],[/\\\^\{u\}/g,"û"],[/\\"\{u\}/g,"ü"],[/\\'\{y\}/g,"ý"],[/\\th /g,"þ"],[/\\"\{y\}/g,"ÿ"],[/\\=\{A\}/g,"Ā"],[/\\=\{a\}/g,"ā"],[/\\u\{A\}/g,"Ă"],[/\\u\{a\}/g,"ă"],[/\\k\{A\}/g,"Ą"],[/\\k\{a\}/g,"ą"],[/\\'\{C\}/g,"Ć"],[/\\'\{c\}/g,"ć"],[/\\\^\{C\}/g,"Ĉ"],[/\\\^\{c\}/g,"ĉ"],[/\\.\{C\}/g,"Ċ"],[/\\.\{c\}/g,"ċ"],[/\\v\{C\}/g,"Č"],[/\\v\{c\}/g,"č"],[/\\v\{D\}/g,"Ď"],[/\\v\{d\}/g,"ď"],[/\\DJ /g,"Đ"],[/\\dj /g,"đ"],[/\\=\{E\}/g,"Ē"],[/\\=\{e\}/g,"ē"],[/\\u\{E\}/g,"Ĕ"],[/\\u\{e\}/g,"ĕ"],[/\\.\{E\}/g,"Ė"],[/\\.\{e\}/g,"ė"],[/\\k\{E\}/g,"Ę"],[/\\k\{e\}/g,"ę"],[/\\v\{E\}/g,"Ě"],[/\\v\{e\}/g,"ě"],[/\\\^\{G\}/g,"Ĝ"],[/\\\^\{g\}/g,"ĝ"],[/\\u\{G\}/g,"Ğ"],[/\\u\{g\}/g,"ğ"],[/\\.\{G\}/g,"Ġ"],[/\\.\{g\}/g,"ġ"],[/\\c\{G\}/g,"Ģ"],[/\\c\{g\}/g,"ģ"],[/\\\^\{H\}/g,"Ĥ"],[/\\\^\{h\}/g,"ĥ"],[/\\Elzxh /g,"ħ"],[/\\~\{I\}/g,"Ĩ"],[/\\~\{\\i\}/g,"ĩ"],[/\\=\{I\}/g,"Ī"],[/\\=\{\\i\}/g,"ī"],[/\\u\{I\}/g,"Ĭ"],[/\\u\{\\i\}/g,"ĭ"],[/\\k\{I\}/g,"Į"],[/\\k\{i\}/g,"į"],[/\\.\{I\}/g,"İ"],[/\\i /g,"ı"],[/\\\^\{J\}/g,"Ĵ"],[/\\\^\{\\j\}/g,"ĵ"],[/\\c\{K\}/g,"Ķ"],[/\\c\{k\}/g,"ķ"],[/\\'\{L\}/g,"Ĺ"],[/\\'\{l\}/g,"ĺ"],[/\\c\{L\}/g,"Ļ"],[/\\c\{l\}/g,"ļ"],[/\\v\{L\}/g,"Ľ"],[/\\v\{l\}/g,"ľ"],[/\\L /g,"Ł"],[/\\l /g,"ł"],[/\\'\{N\}/g,"Ń"],[/\\'\{n\}/g,"ń"],[/\\c\{N\}/g,"Ņ"],[/\\c\{n\}/g,"ņ"],[/\\v\{N\}/g,"Ň"],[/\\v\{n\}/g,"ň"],[/\\NG /g,"Ŋ"],[/\\ng /g,"ŋ"],[/\\=\{O\}/g,"Ō"],[/\\=\{o\}/g,"ō"],[/\\u\{O\}/g,"Ŏ"],[/\\u\{o\}/g,"ŏ"],[/\\H\{O\}/g,"Ő"],[/\\H\{o\}/g,"ő"],[/\\OE /g,"Œ"],[/\\oe /g,"œ"],[/\\'\{R\}/g,"Ŕ"],[/\\'\{r\}/g,"ŕ"],[/\\c\{R\}/g,"Ŗ"],[/\\c\{r\}/g,"ŗ"],[/\\v\{R\}/g,"Ř"],[/\\v\{r\}/g,"ř"],[/\\'\{S\}/g,"Ś"],[/\\'\{s\}/g,"ś"],[/\\\^\{S\}/g,"Ŝ"],[/\\\^\{s\}/g,"ŝ"],[/\\c\{S\}/g,"Ş"],[/\\c\{s\}/g,"ş"],[/\\v\{S\}/g,"Š"],[/\\v\{s\}/g,"š"],[/\\c\{T\}/g,"Ţ"],[/\\c\{t\}/g,"ţ"],[/\\v\{T\}/g,"Ť"],[/\\v\{t\}/g,"ť"],[/\\~\{U\}/g,"Ũ"],[/\\~\{u\}/g,"ũ"],[/\\=\{U\}/g,"Ū"],[/\\=\{u\}/g,"ū"],[/\\u\{U\}/g,"Ŭ"],[/\\u\{u\}/g,"ŭ"],[/\\r\{U\}/g,"Ů"],[/\\r\{u\}/g,"ů"],[/\\H\{U\}/g,"Ű"],[/\\H\{u\}/g,"ű"],[/\\k\{U\}/g,"Ų"],[/\\k\{u\}/g,"ų"],[/\\\^\{W\}/g,"Ŵ"],[/\\\^\{w\}/g,"ŵ"],[/\\\^\{Y\}/g,"Ŷ"],[/\\\^\{y\}/g,"ŷ"],[/\\"\{Y\}/g,"Ÿ"],[/\\'\{Z\}/g,"Ź"],[/\\'\{z\}/g,"ź"],[/\\.\{Z\}/g,"Ż"],[/\\.\{z\}/g,"ż"],[/\\v\{Z\}/g,"Ž"],[/\\v\{z\}/g,"ž"],[/\\texthvlig /g,"ƕ"],[/\\textnrleg /g,"ƞ"],[/\\eth /g,"ƪ"],[/\\textdoublepipe /g,"ǂ"],[/\\'\{g\}/g,"ǵ"],[/\\Elztrna /g,"ɐ"],[/\\Elztrnsa /g,"ɒ"],[/\\Elzopeno /g,"ɔ"],[/\\Elzrtld /g,"ɖ"],[/\\Elzschwa /g,"ə"],[/\\varepsilon /g,"ɛ"],[/\\Elzpgamma /g,"ɣ"],[/\\Elzpbgam /g,"ɤ"],[/\\Elztrnh /g,"ɥ"],[/\\Elzbtdl /g,"ɬ"],[/\\Elzrtll /g,"ɭ"],[/\\Elztrnm /g,"ɯ"],[/\\Elztrnmlr /g,"ɰ"],[/\\Elzltlmr /g,"ɱ"],[/\\Elzltln /g,"ɲ"],[/\\Elzrtln /g,"ɳ"],[/\\Elzclomeg /g,"ɷ"],[/\\textphi /g,"ɸ"],[/\\Elztrnr /g,"ɹ"],[/\\Elztrnrl /g,"ɺ"],[/\\Elzrttrnr /g,"ɻ"],[/\\Elzrl /g,"ɼ"],[/\\Elzrtlr /g,"ɽ"],[/\\Elzfhr /g,"ɾ"],[/\\Elzrtls /g,"ʂ"],[/\\Elzesh /g,"ʃ"],[/\\Elztrnt /g,"ʇ"],[/\\Elzrtlt /g,"ʈ"],[/\\Elzpupsil /g,"ʊ"],[/\\Elzpscrv /g,"ʋ"],[/\\Elzinvv /g,"ʌ"],[/\\Elzinvw /g,"ʍ"],[/\\Elztrny /g,"ʎ"],[/\\Elzrtlz /g,"ʐ"],[/\\Elzyogh /g,"ʒ"],[/\\Elzglst /g,"ʔ"],[/\\Elzreglst /g,"ʕ"],[/\\Elzinglst /g,"ʖ"],[/\\textturnk /g,"ʞ"],[/\\Elzdyogh /g,"ʤ"],[/\\Elztesh /g,"ʧ"],[/\\textasciicaron /g,"ˇ"],[/\\Elzverts /g,"ˈ"],[/\\Elzverti /g,"ˌ"],[/\\Elzlmrk /g,"ː"],[/\\Elzhlmrk /g,"ˑ"],[/\\Elzsbrhr /g,"˒"],[/\\Elzsblhr /g,"˓"],[/\\Elzrais /g,"˔"],[/\\Elzlow /g,"˕"],[/\\textasciibreve /g,"˘"],[/\\textperiodcentered /g,"˙"],[/\\r\{\}/g,"˚"],[/\\k\{\}/g,"˛"],[/\\texttildelow /g,"˜"],[/\\H\{\}/g,"˝"],[/\\tone\{55\}/g,"˥"],[/\\tone\{44\}/g,"˦"],[/\\tone\{33\}/g,"˧"],[/\\tone\{22\}/g,"˨"],[/\\tone\{11\}/g,"˩"],[/\\cyrchar\\C/g,"̏"],[/\\Elzpalh /g,"̡"],[/\\Elzrh /g,"̢"],[/\\Elzsbbrg /g,"̪"],[/\\Elzxl /g,"̵"],[/\\Elzbar /g,"̶"],[/\\'\{A\}/g,"Ά"],[/\\'\{E\}/g,"Έ"],[/\\'\{H\}/g,"Ή"],[/\\'\{\}\{I\}/g,"Ί"],[/\\'\{\}O/g,"Ό"],[/\\mathrm\{'Y\}/g,"Ύ"],[/\\mathrm\{'\\Omega\}/g,"Ώ"],[/\\acute\{\\ddot\{\\iota\}\}/g,"ΐ"],[/\\Alpha /g,"Α"],[/\\Beta /g,"Β"],[/\\Gamma /g,"Γ"],[/\\Delta /g,"Δ"],[/\\Epsilon /g,"Ε"],[/\\Zeta /g,"Ζ"],[/\\Eta /g,"Η"],[/\\Theta /g,"Θ"],[/\\Iota /g,"Ι"],[/\\Kappa /g,"Κ"],[/\\Lambda /g,"Λ"],[/\\Xi /g,"Ξ"],[/\\Pi /g,"Π"],[/\\Rho /g,"Ρ"],[/\\Sigma /g,"Σ"],[/\\Tau /g,"Τ"],[/\\Upsilon /g,"Υ"],[/\\Phi /g,"Φ"],[/\\Chi /g,"Χ"],[/\\Psi /g,"Ψ"],[/\\Omega /g,"Ω"],[/\\mathrm\{\\ddot\{I\}\}/g,"Ϊ"],[/\\mathrm\{\\ddot\{Y\}\}/g,"Ϋ"],[/\\'\{\$\\alpha\$\}/g,"ά"],[/\\acute\{\\epsilon\}/g,"έ"],[/\\acute\{\\eta\}/g,"ή"],[/\\acute\{\\iota\}/g,"ί"],[/\\acute\{\\ddot\{\\upsilon\}\}/g,"ΰ"],[/\\alpha /g,"α"],[/\\beta /g,"β"],[/\\gamma /g,"γ"],[/\\delta /g,"δ"],[/\\epsilon /g,"ε"],[/\\zeta /g,"ζ"],[/\\eta /g,"η"],[/\\texttheta /g,"θ"],[/\\iota /g,"ι"],[/\\kappa /g,"κ"],[/\\lambda /g,"λ"],[/\\mu /g,"μ"],[/\\nu /g,"ν"],[/\\xi /g,"ξ"],[/\\pi /g,"π"],[/\\rho /g,"ρ"],[/\\varsigma /g,"ς"],[/\\sigma /g,"σ"],[/\\tau /g,"τ"],[/\\upsilon /g,"υ"],[/\\varphi /g,"φ"],[/\\chi /g,"χ"],[/\\psi /g,"ψ"],[/\\omega /g,"ω"],[/\\ddot\{\\iota\}/g,"ϊ"],[/\\ddot\{\\upsilon\}/g,"ϋ"],[/\\'\{o\}/g,"ό"],[/\\acute\{\\upsilon\}/g,"ύ"],[/\\acute\{\\omega\}/g,"ώ"],[/\\Pisymbol\{ppi022\}\{87\}/g,"ϐ"],[/\\textvartheta /g,"ϑ"],[/\\Upsilon /g,"ϒ"],[/\\phi /g,"ϕ"],[/\\varpi /g,"ϖ"],[/\\Stigma /g,"Ϛ"],[/\\Digamma /g,"Ϝ"],[/\\digamma /g,"ϝ"],[/\\Koppa /g,"Ϟ"],[/\\Sampi /g,"Ϡ"],[/\\varkappa /g,"ϰ"],[/\\varrho /g,"ϱ"],[/\\textTheta /g,"ϴ"],[/\\backepsilon /g,"϶"],[/\\cyrchar\\CYRYO /g,"Ё"],[/\\cyrchar\\CYRDJE /g,"Ђ"],[/\\cyrchar\{\\'\\CYRG\}/g,"Ѓ"],[/\\cyrchar\\CYRIE /g,"Є"],[/\\cyrchar\\CYRDZE /g,"Ѕ"],[/\\cyrchar\\CYRII /g,"І"],[/\\cyrchar\\CYRYI /g,"Ї"],[/\\cyrchar\\CYRJE /g,"Ј"],[/\\cyrchar\\CYRLJE /g,"Љ"],[/\\cyrchar\\CYRNJE /g,"Њ"],[/\\cyrchar\\CYRTSHE /g,"Ћ"],[/\\cyrchar\{\\'\\CYRK\}/g,"Ќ"],[/\\cyrchar\\CYRUSHRT /g,"Ў"],[/\\cyrchar\\CYRDZHE /g,"Џ"],[/\\cyrchar\\CYRA /g,"А"],[/\\cyrchar\\CYRB /g,"Б"],[/\\cyrchar\\CYRV /g,"В"],[/\\cyrchar\\CYRG /g,"Г"],[/\\cyrchar\\CYRD /g,"Д"],[/\\cyrchar\\CYRE /g,"Е"],[/\\cyrchar\\CYRZH /g,"Ж"],[/\\cyrchar\\CYRZ /g,"З"],[/\\cyrchar\\CYRI /g,"И"],[/\\cyrchar\\CYRISHRT /g,"Й"],[/\\cyrchar\\CYRK /g,"К"],[/\\cyrchar\\CYRL /g,"Л"],[/\\cyrchar\\CYRM /g,"М"],[/\\cyrchar\\CYRN /g,"Н"],[/\\cyrchar\\CYRO /g,"О"],[/\\cyrchar\\CYRP /g,"П"],[/\\cyrchar\\CYRR /g,"Р"],[/\\cyrchar\\CYRS /g,"С"],[/\\cyrchar\\CYRT /g,"Т"],[/\\cyrchar\\CYRU /g,"У"],[/\\cyrchar\\CYRF /g,"Ф"],[/\\cyrchar\\CYRH /g,"Х"],[/\\cyrchar\\CYRC /g,"Ц"],[/\\cyrchar\\CYRCH /g,"Ч"],[/\\cyrchar\\CYRSH /g,"Ш"],[/\\cyrchar\\CYRSHCH /g,"Щ"],[/\\cyrchar\\CYRHRDSN /g,"Ъ"],[/\\cyrchar\\CYRERY /g,"Ы"],[/\\cyrchar\\CYRSFTSN /g,"Ь"],[/\\cyrchar\\CYREREV /g,"Э"],[/\\cyrchar\\CYRYU /g,"Ю"],[/\\cyrchar\\CYRYA /g,"Я"],[/\\cyrchar\\cyra /g,"а"],[/\\cyrchar\\cyrb /g,"б"],[/\\cyrchar\\cyrv /g,"в"],[/\\cyrchar\\cyrg /g,"г"],[/\\cyrchar\\cyrd /g,"д"],[/\\cyrchar\\cyre /g,"е"],[/\\cyrchar\\cyrzh /g,"ж"],[/\\cyrchar\\cyrz /g,"з"],[/\\cyrchar\\cyri /g,"и"],[/\\cyrchar\\cyrishrt /g,"й"],[/\\cyrchar\\cyrk /g,"к"],[/\\cyrchar\\cyrl /g,"л"],[/\\cyrchar\\cyrm /g,"м"],[/\\cyrchar\\cyrn /g,"н"],[/\\cyrchar\\cyro /g,"о"],[/\\cyrchar\\cyrp /g,"п"],[/\\cyrchar\\cyrr /g,"р"],[/\\cyrchar\\cyrs /g,"с"],[/\\cyrchar\\cyrt /g,"т"],[/\\cyrchar\\cyru /g,"у"],[/\\cyrchar\\cyrf /g,"ф"],[/\\cyrchar\\cyrh /g,"х"],[/\\cyrchar\\cyrc /g,"ц"],[/\\cyrchar\\cyrch /g,"ч"],[/\\cyrchar\\cyrsh /g,"ш"],[/\\cyrchar\\cyrshch /g,"щ"],[/\\cyrchar\\cyrhrdsn /g,"ъ"],[/\\cyrchar\\cyrery /g,"ы"],[/\\cyrchar\\cyrsftsn /g,"ь"],[/\\cyrchar\\cyrerev /g,"э"],[/\\cyrchar\\cyryu /g,"ю"],[/\\cyrchar\\cyrya /g,"я"],[/\\cyrchar\\cyryo /g,"ё"],[/\\cyrchar\\cyrdje /g,"ђ"],[/\\cyrchar\{\\'\\cyrg\}/g,"ѓ"],[/\\cyrchar\\cyrie /g,"є"],[/\\cyrchar\\cyrdze /g,"ѕ"],[/\\cyrchar\\cyrii /g,"і"],[/\\cyrchar\\cyryi /g,"ї"],[/\\cyrchar\\cyrje /g,"ј"],[/\\cyrchar\\cyrlje /g,"љ"],[/\\cyrchar\\cyrnje /g,"њ"],[/\\cyrchar\\cyrtshe /g,"ћ"],[/\\cyrchar\{\\'\\cyrk\}/g,"ќ"],[/\\cyrchar\\cyrushrt /g,"ў"],[/\\cyrchar\\cyrdzhe /g,"џ"],[/\\cyrchar\\CYROMEGA /g,"Ѡ"],[/\\cyrchar\\cyromega /g,"ѡ"],[/\\cyrchar\\CYRYAT /g,"Ѣ"],[/\\cyrchar\\CYRIOTE /g,"Ѥ"],[/\\cyrchar\\cyriote /g,"ѥ"],[/\\cyrchar\\CYRLYUS /g,"Ѧ"],[/\\cyrchar\\cyrlyus /g,"ѧ"],[/\\cyrchar\\CYRIOTLYUS /g,"Ѩ"],[/\\cyrchar\\cyriotlyus /g,"ѩ"],[/\\cyrchar\\CYRBYUS /g,"Ѫ"],[/\\cyrchar\\CYRIOTBYUS /g,"Ѭ"],[/\\cyrchar\\cyriotbyus /g,"ѭ"],[/\\cyrchar\\CYRKSI /g,"Ѯ"],[/\\cyrchar\\cyrksi /g,"ѯ"],[/\\cyrchar\\CYRPSI /g,"Ѱ"],[/\\cyrchar\\cyrpsi /g,"ѱ"],[/\\cyrchar\\CYRFITA /g,"Ѳ"],[/\\cyrchar\\CYRIZH /g,"Ѵ"],[/\\cyrchar\\CYRUK /g,"Ѹ"],[/\\cyrchar\\cyruk /g,"ѹ"],[/\\cyrchar\\CYROMEGARND /g,"Ѻ"],[/\\cyrchar\\cyromegarnd /g,"ѻ"],[/\\cyrchar\\CYROMEGATITLO /g,"Ѽ"],[/\\cyrchar\\cyromegatitlo /g,"ѽ"],[/\\cyrchar\\CYROT /g,"Ѿ"],[/\\cyrchar\\cyrot /g,"ѿ"],[/\\cyrchar\\CYRKOPPA /g,"Ҁ"],[/\\cyrchar\\cyrkoppa /g,"ҁ"],[/\\cyrchar\\cyrthousands /g,"҂"],[/\\cyrchar\\cyrhundredthousands /g,"҈"],[/\\cyrchar\\cyrmillions /g,"҉"],[/\\cyrchar\\CYRSEMISFTSN /g,"Ҍ"],[/\\cyrchar\\cyrsemisftsn /g,"ҍ"],[/\\cyrchar\\CYRRTICK /g,"Ҏ"],[/\\cyrchar\\cyrrtick /g,"ҏ"],[/\\cyrchar\\CYRGUP /g,"Ґ"],[/\\cyrchar\\cyrgup /g,"ґ"],[/\\cyrchar\\CYRGHCRS /g,"Ғ"],[/\\cyrchar\\cyrghcrs /g,"ғ"],[/\\cyrchar\\CYRGHK /g,"Ҕ"],[/\\cyrchar\\cyrghk /g,"ҕ"],[/\\cyrchar\\CYRZHDSC /g,"Җ"],[/\\cyrchar\\cyrzhdsc /g,"җ"],[/\\cyrchar\\CYRZDSC /g,"Ҙ"],[/\\cyrchar\\cyrzdsc /g,"ҙ"],[/\\cyrchar\\CYRKDSC /g,"Қ"],[/\\cyrchar\\cyrkdsc /g,"қ"],[/\\cyrchar\\CYRKVCRS /g,"Ҝ"],[/\\cyrchar\\cyrkvcrs /g,"ҝ"],[/\\cyrchar\\CYRKHCRS /g,"Ҟ"],[/\\cyrchar\\cyrkhcrs /g,"ҟ"],[/\\cyrchar\\CYRKBEAK /g,"Ҡ"],[/\\cyrchar\\cyrkbeak /g,"ҡ"],[/\\cyrchar\\CYRNDSC /g,"Ң"],[/\\cyrchar\\cyrndsc /g,"ң"],[/\\cyrchar\\CYRNG /g,"Ҥ"],[/\\cyrchar\\cyrng /g,"ҥ"],[/\\cyrchar\\CYRPHK /g,"Ҧ"],[/\\cyrchar\\cyrphk /g,"ҧ"],[/\\cyrchar\\CYRABHHA /g,"Ҩ"],[/\\cyrchar\\cyrabhha /g,"ҩ"],[/\\cyrchar\\CYRSDSC /g,"Ҫ"],[/\\cyrchar\\cyrsdsc /g,"ҫ"],[/\\cyrchar\\CYRTDSC /g,"Ҭ"],[/\\cyrchar\\cyrtdsc /g,"ҭ"],[/\\cyrchar\\CYRY /g,"Ү"],[/\\cyrchar\\cyry /g,"ү"],[/\\cyrchar\\CYRYHCRS /g,"Ұ"],[/\\cyrchar\\cyryhcrs /g,"ұ"],[/\\cyrchar\\CYRHDSC /g,"Ҳ"],[/\\cyrchar\\cyrhdsc /g,"ҳ"],[/\\cyrchar\\CYRTETSE /g,"Ҵ"],[/\\cyrchar\\cyrtetse /g,"ҵ"],[/\\cyrchar\\CYRCHRDSC /g,"Ҷ"],[/\\cyrchar\\cyrchrdsc /g,"ҷ"],[/\\cyrchar\\CYRCHVCRS /g,"Ҹ"],[/\\cyrchar\\cyrchvcrs /g,"ҹ"],[/\\cyrchar\\CYRSHHA /g,"Һ"],[/\\cyrchar\\cyrshha /g,"һ"],[/\\cyrchar\\CYRABHCH /g,"Ҽ"],[/\\cyrchar\\cyrabhch /g,"ҽ"],[/\\cyrchar\\CYRABHCHDSC /g,"Ҿ"],[/\\cyrchar\\cyrabhchdsc /g,"ҿ"],[/\\cyrchar\\CYRpalochka /g,"Ӏ"],[/\\cyrchar\\CYRKHK /g,"Ӄ"],[/\\cyrchar\\cyrkhk /g,"ӄ"],[/\\cyrchar\\CYRNHK /g,"Ӈ"],[/\\cyrchar\\cyrnhk /g,"ӈ"],[/\\cyrchar\\CYRCHLDSC /g,"Ӌ"],[/\\cyrchar\\cyrchldsc /g,"ӌ"],[/\\cyrchar\\CYRAE /g,"Ӕ"],[/\\cyrchar\\cyrae /g,"ӕ"],[/\\cyrchar\\CYRSCHWA /g,"Ә"],[/\\cyrchar\\cyrschwa /g,"ә"],[/\\cyrchar\\CYRABHDZE /g,"Ӡ"],[/\\cyrchar\\cyrabhdze /g,"ӡ"],[/\\cyrchar\\CYROTLD /g,"Ө"],[/\\cyrchar\\cyrotld /g,"ө"],[/\\hspace\{0.6em\}/g," "],[/\\hspace\{1em\}/g," "],[/\\hspace\{0.33em\}/g," "],[/\\hspace\{0.25em\}/g," "],[/\\hspace\{0.166em\}/g," "],[/\\hphantom\{0\}/g," "],[/\\hphantom\{,\}/g," "],[/\\hspace\{0.167em\}/g," "],[/\\mkern1mu /g," "],[/\\textendash /g,"–"],[/\\textemdash /g,"—"],[/\\rule\{1em\}\{1pt\}/g,"―"],[/\\Vert /g,"‖"],[/\\Elzreapos /g,"‛"],[/\\textquotedblleft /g,"“"],[/\\textquotedblright /g,"”"],[/\\textdagger /g,"†"],[/\\textdaggerdbl /g,"‡"],[/\\textbullet /g,"•"],[/\\ldots /g,"…"],[/\\textperthousand /g,"‰"],[/\\textpertenthousand /g,"‱"],[/\\backprime /g,"‵"],[/\\guilsinglleft /g,"‹"],[/\\guilsinglright /g,"›"],[/\\mkern4mu /g," "],[/\\nolinebreak /g,"⁠"],[/\\ensuremath\{\\Elzpes\}/g,"₧"],[/\\mbox\{\\texteuro\} /g,"€"],[/\\dddot /g,"⃛"],[/\\ddddot /g,"⃜"],[/\\mathbb\{C\}/g,"ℂ"],[/\\mathscr\{g\}/g,"ℊ"],[/\\mathscr\{H\}/g,"ℋ"],[/\\mathfrak\{H\}/g,"ℌ"],[/\\mathbb\{H\}/g,"ℍ"],[/\\hslash /g,"ℏ"],[/\\mathscr\{I\}/g,"ℐ"],[/\\mathfrak\{I\}/g,"ℑ"],[/\\mathscr\{L\}/g,"ℒ"],[/\\mathscr\{l\}/g,"ℓ"],[/\\mathbb\{N\}/g,"ℕ"],[/\\cyrchar\\textnumero /g,"№"],[/\\wp /g,"℘"],[/\\mathbb\{P\}/g,"ℙ"],[/\\mathbb\{Q\}/g,"ℚ"],[/\\mathscr\{R\}/g,"ℛ"],[/\\mathfrak\{R\}/g,"ℜ"],[/\\mathbb\{R\}/g,"ℝ"],[/\\Elzxrat /g,"℞"],[/\\texttrademark /g,"™"],[/\\mathbb\{Z\}/g,"ℤ"],[/\\Omega /g,"Ω"],[/\\mho /g,"℧"],[/\\mathfrak\{Z\}/g,"ℨ"],[/\\ElsevierGlyph\{2129\}/g,"℩"],[/\\AA /g,"Å"],[/\\mathscr\{B\}/g,"ℬ"],[/\\mathfrak\{C\}/g,"ℭ"],[/\\mathscr\{e\}/g,"ℯ"],[/\\mathscr\{E\}/g,"ℰ"],[/\\mathscr\{F\}/g,"ℱ"],[/\\mathscr\{M\}/g,"ℳ"],[/\\mathscr\{o\}/g,"ℴ"],[/\\aleph /g,"ℵ"],[/\\beth /g,"ℶ"],[/\\gimel /g,"ℷ"],[/\\daleth /g,"ℸ"],[/\\textfrac\{1\}\{3\}/g,"⅓"],[/\\textfrac\{2\}\{3\}/g,"⅔"],[/\\textfrac\{1\}\{5\}/g,"⅕"],[/\\textfrac\{2\}\{5\}/g,"⅖"],[/\\textfrac\{3\}\{5\}/g,"⅗"],[/\\textfrac\{4\}\{5\}/g,"⅘"],[/\\textfrac\{1\}\{6\}/g,"⅙"],[/\\textfrac\{5\}\{6\}/g,"⅚"],[/\\textfrac\{1\}\{8\}/g,"⅛"],[/\\textfrac\{3\}\{8\}/g,"⅜"],[/\\textfrac\{5\}\{8\}/g,"⅝"],[/\\textfrac\{7\}\{8\}/g,"⅞"],[/\\leftarrow /g,"←"],[/\\uparrow /g,"↑"],[/\\rightarrow /g,"→"],[/\\downarrow /g,"↓"],[/\\leftrightarrow /g,"↔"],[/\\updownarrow /g,"↕"],[/\\nwarrow /g,"↖"],[/\\nearrow /g,"↗"],[/\\searrow /g,"↘"],[/\\swarrow /g,"↙"],[/\\nleftarrow /g,"↚"],[/\\nrightarrow /g,"↛"],[/\\arrowwaveright /g,"↜"],[/\\arrowwaveright /g,"↝"],[/\\twoheadleftarrow /g,"↞"],[/\\twoheadrightarrow /g,"↠"],[/\\leftarrowtail /g,"↢"],[/\\rightarrowtail /g,"↣"],[/\\mapsto /g,"↦"],[/\\hookleftarrow /g,"↩"],[/\\hookrightarrow /g,"↪"],[/\\looparrowleft /g,"↫"],[/\\looparrowright /g,"↬"],[/\\leftrightsquigarrow /g,"↭"],[/\\nleftrightarrow /g,"↮"],[/\\Lsh /g,"↰"],[/\\Rsh /g,"↱"],[/\\ElsevierGlyph\{21B3\}/g,"↳"],[/\\curvearrowleft /g,"↶"],[/\\curvearrowright /g,"↷"],[/\\circlearrowleft /g,"↺"],[/\\circlearrowright /g,"↻"],[/\\leftharpoonup /g,"↼"],[/\\leftharpoondown /g,"↽"],[/\\upharpoonright /g,"↾"],[/\\upharpoonleft /g,"↿"],[/\\rightharpoonup /g,"⇀"],[/\\rightharpoondown /g,"⇁"],[/\\downharpoonright /g,"⇂"],[/\\downharpoonleft /g,"⇃"],[/\\rightleftarrows /g,"⇄"],[/\\dblarrowupdown /g,"⇅"],[/\\leftrightarrows /g,"⇆"],[/\\leftleftarrows /g,"⇇"],[/\\upuparrows /g,"⇈"],[/\\rightrightarrows /g,"⇉"],[/\\downdownarrows /g,"⇊"],[/\\leftrightharpoons /g,"⇋"],[/\\rightleftharpoons /g,"⇌"],[/\\nLeftarrow /g,"⇍"],[/\\nLeftrightarrow /g,"⇎"],[/\\nRightarrow /g,"⇏"],[/\\Leftarrow /g,"⇐"],[/\\Uparrow /g,"⇑"],[/\\Rightarrow /g,"⇒"],[/\\Downarrow /g,"⇓"],[/\\Leftrightarrow /g,"⇔"],[/\\Updownarrow /g,"⇕"],[/\\Lleftarrow /g,"⇚"],[/\\Rrightarrow /g,"⇛"],[/\\rightsquigarrow /g,"⇝"],[/\\DownArrowUpArrow /g,"⇵"],[/\\forall /g,"∀"],[/\\complement /g,"∁"],[/\\partial /g,"∂"],[/\\exists /g,"∃"],[/\\nexists /g,"∄"],[/\\varnothing /g,"∅"],[/\\nabla /g,"∇"],[/\\in /g,"∈"],[/\\not\\in /g,"∉"],[/\\ni /g,"∋"],[/\\not\\ni /g,"∌"],[/\\prod /g,"∏"],[/\\coprod /g,"∐"],[/\\sum /g,"∑"],[/\\mp /g,"∓"],[/\\dotplus /g,"∔"],[/\\setminus /g,"∖"],[/\\circ /g,"∘"],[/\\bullet /g,"∙"],[/\\surd /g,"√"],[/\\propto /g,"∝"],[/\\infty /g,"∞"],[/\\rightangle /g,"∟"],[/\\angle /g,"∠"],[/\\measuredangle /g,"∡"],[/\\sphericalangle /g,"∢"],[/\\mid /g,"∣"],[/\\nmid /g,"∤"],[/\\parallel /g,"∥"],[/\\nparallel /g,"∦"],[/\\wedge /g,"∧"],[/\\vee /g,"∨"],[/\\cap /g,"∩"],[/\\cup /g,"∪"],[/\\int /g,"∫"],[/\\int\\!\\int /g,"∬"],[/\\int\\!\\int\\!\\int /g,"∭"],[/\\oint /g,"∮"],[/\\surfintegral /g,"∯"],[/\\volintegral /g,"∰"],[/\\clwintegral /g,"∱"],[/\\ElsevierGlyph\{2232\}/g,"∲"],[/\\ElsevierGlyph\{2233\}/g,"∳"],[/\\therefore /g,"∴"],[/\\because /g,"∵"],[/\\Colon /g,"∷"],[/\\ElsevierGlyph\{2238\}/g,"∸"],[/\\mathbin\{\{:\}\\!\\!\{\-\}\\!\\!\{:\}\}/g,"∺"],[/\\homothetic /g,"∻"],[/\\sim /g,"∼"],[/\\backsim /g,"∽"],[/\\lazysinv /g,"∾"],[/\\wr /g,"≀"],[/\\not\\sim /g,"≁"],[/\\ElsevierGlyph\{2242\}/g,"≂"],[/\\NotEqualTilde /g,"≂-00338"],[/\\simeq /g,"≃"],[/\\not\\simeq /g,"≄"],[/\\cong /g,"≅"],[/\\approxnotequal /g,"≆"],[/\\not\\cong /g,"≇"],[/\\approx /g,"≈"],[/\\not\\approx /g,"≉"],[/\\approxeq /g,"≊"],[/\\tildetrpl /g,"≋"],[/\\not\\apid /g,"≋-00338"],[/\\allequal /g,"≌"],[/\\asymp /g,"≍"],[/\\Bumpeq /g,"≎"],[/\\NotHumpDownHump /g,"≎-00338"],[/\\bumpeq /g,"≏"],[/\\NotHumpEqual /g,"≏-00338"],[/\\doteq /g,"≐"],[/\\not\\doteq/g,"≐-00338"],[/\\doteqdot /g,"≑"],[/\\fallingdotseq /g,"≒"],[/\\risingdotseq /g,"≓"],[/\\eqcirc /g,"≖"],[/\\circeq /g,"≗"],[/\\estimates /g,"≙"],[/\\ElsevierGlyph\{225A\}/g,"≚"],[/\\starequal /g,"≛"],[/\\triangleq /g,"≜"],[/\\ElsevierGlyph\{225F\}/g,"≟"],[/\\not =/g,"≠"],[/\\equiv /g,"≡"],[/\\not\\equiv /g,"≢"],[/\\leq /g,"≤"],[/\\geq /g,"≥"],[/\\leqq /g,"≦"],[/\\geqq /g,"≧"],[/\\lneqq /g,"≨"],[/\\lvertneqq /g,"≨-0FE00"],[/\\gneqq /g,"≩"],[/\\gvertneqq /g,"≩-0FE00"],[/\\ll /g,"≪"],[/\\NotLessLess /g,"≪-00338"],[/\\gg /g,"≫"],[/\\NotGreaterGreater /g,"≫-00338"],[/\\between /g,"≬"],[/\\not\\kern\-0.3em\\times /g,"≭"],[/\\not</g,"≮"],[/\\not>/g,"≯"],[/\\not\\leq /g,"≰"],[/\\not\\geq /g,"≱"],[/\\lessequivlnt /g,"≲"],[/\\greaterequivlnt /g,"≳"],[/\\ElsevierGlyph\{2274\}/g,"≴"],[/\\ElsevierGlyph\{2275\}/g,"≵"],[/\\lessgtr /g,"≶"],[/\\gtrless /g,"≷"],[/\\notlessgreater /g,"≸"],[/\\notgreaterless /g,"≹"],[/\\prec /g,"≺"],[/\\succ /g,"≻"],[/\\preccurlyeq /g,"≼"],[/\\succcurlyeq /g,"≽"],[/\\precapprox /g,"≾"],[/\\NotPrecedesTilde /g,"≾-00338"],[/\\succapprox /g,"≿"],[/\\NotSucceedsTilde /g,"≿-00338"],[/\\not\\prec /g,"⊀"],[/\\not\\succ /g,"⊁"],[/\\subset /g,"⊂"],[/\\supset /g,"⊃"],[/\\not\\subset /g,"⊄"],[/\\not\\supset /g,"⊅"],[/\\subseteq /g,"⊆"],[/\\supseteq /g,"⊇"],[/\\not\\subseteq /g,"⊈"],[/\\not\\supseteq /g,"⊉"],[/\\subsetneq /g,"⊊"],[/\\varsubsetneqq /g,"⊊-0FE00"],[/\\supsetneq /g,"⊋"],[/\\varsupsetneq /g,"⊋-0FE00"],[/\\uplus /g,"⊎"],[/\\sqsubset /g,"⊏"],[/\\NotSquareSubset /g,"⊏-00338"],[/\\sqsupset /g,"⊐"],[/\\NotSquareSuperset /g,"⊐-00338"],[/\\sqsubseteq /g,"⊑"],[/\\sqsupseteq /g,"⊒"],[/\\sqcap /g,"⊓"],[/\\sqcup /g,"⊔"],[/\\oplus /g,"⊕"],[/\\ominus /g,"⊖"],[/\\otimes /g,"⊗"],[/\\oslash /g,"⊘"],[/\\odot /g,"⊙"],[/\\circledcirc /g,"⊚"],[/\\circledast /g,"⊛"],[/\\circleddash /g,"⊝"],[/\\boxplus /g,"⊞"],[/\\boxminus /g,"⊟"],[/\\boxtimes /g,"⊠"],[/\\boxdot /g,"⊡"],[/\\vdash /g,"⊢"],[/\\dashv /g,"⊣"],[/\\top /g,"⊤"],[/\\perp /g,"⊥"],[/\\truestate /g,"⊧"],[/\\forcesextra /g,"⊨"],[/\\Vdash /g,"⊩"],[/\\Vvdash /g,"⊪"],[/\\VDash /g,"⊫"],[/\\nvdash /g,"⊬"],[/\\nvDash /g,"⊭"],[/\\nVdash /g,"⊮"],[/\\nVDash /g,"⊯"],[/\\vartriangleleft /g,"⊲"],[/\\vartriangleright /g,"⊳"],[/\\trianglelefteq /g,"⊴"],[/\\trianglerighteq /g,"⊵"],[/\\original /g,"⊶"],[/\\image /g,"⊷"],[/\\multimap /g,"⊸"],[/\\hermitconjmatrix /g,"⊹"],[/\\intercal /g,"⊺"],[/\\veebar /g,"⊻"],[/\\rightanglearc /g,"⊾"],[/\\ElsevierGlyph\{22C0\}/g,"⋀"],[/\\ElsevierGlyph\{22C1\}/g,"⋁"],[/\\bigcap /g,"⋂"],[/\\bigcup /g,"⋃"],[/\\diamond /g,"⋄"],[/\\cdot /g,"⋅"],[/\\star /g,"⋆"],[/\\divideontimes /g,"⋇"],[/\\bowtie /g,"⋈"],[/\\ltimes /g,"⋉"],[/\\rtimes /g,"⋊"],[/\\leftthreetimes /g,"⋋"],[/\\rightthreetimes /g,"⋌"],[/\\backsimeq /g,"⋍"],[/\\curlyvee /g,"⋎"],[/\\curlywedge /g,"⋏"],[/\\Subset /g,"⋐"],[/\\Supset /g,"⋑"],[/\\Cap /g,"⋒"],[/\\Cup /g,"⋓"],[/\\pitchfork /g,"⋔"],[/\\lessdot /g,"⋖"],[/\\gtrdot /g,"⋗"],[/\\verymuchless /g,"⋘"],[/\\verymuchgreater /g,"⋙"],[/\\lesseqgtr /g,"⋚"],[/\\gtreqless /g,"⋛"],[/\\curlyeqprec /g,"⋞"],[/\\curlyeqsucc /g,"⋟"],[/\\not\\sqsubseteq /g,"⋢"],[/\\not\\sqsupseteq /g,"⋣"],[/\\Elzsqspne /g,"⋥"],[/\\lnsim /g,"⋦"],[/\\gnsim /g,"⋧"],[/\\precedesnotsimilar /g,"⋨"],[/\\succnsim /g,"⋩"],[/\\ntriangleleft /g,"⋪"],[/\\ntriangleright /g,"⋫"],[/\\ntrianglelefteq /g,"⋬"],[/\\ntrianglerighteq /g,"⋭"],[/\\vdots /g,"⋮"],[/\\cdots /g,"⋯"],[/\\upslopeellipsis /g,"⋰"],[/\\downslopeellipsis /g,"⋱"],[/\\barwedge /g,"⌅"],[/\\perspcorrespond /g,"⌆"],[/\\lceil /g,"⌈"],[/\\rceil /g,"⌉"],[/\\lfloor /g,"⌊"],[/\\rfloor /g,"⌋"],[/\\recorder /g,"⌕"],[/\\mathchar"2208/g,"⌖"],[/\\ulcorner /g,"⌜"],[/\\urcorner /g,"⌝"],[/\\llcorner /g,"⌞"],[/\\lrcorner /g,"⌟"],[/\\frown /g,"⌢"],[/\\smile /g,"⌣"],[/\\langle /g,"〈"],[/\\rangle /g,"〉"],[/\\ElsevierGlyph\{E838\}/g,"⌽"],[/\\Elzdlcorn /g,"⎣"],[/\\lmoustache /g,"⎰"],[/\\rmoustache /g,"⎱"],[/\\textvisiblespace /g,"␣"],[/\\ding\{172\}/g,"①"],[/\\ding\{173\}/g,"②"],[/\\ding\{174\}/g,"③"],[/\\ding\{175\}/g,"④"],[/\\ding\{176\}/g,"⑤"],[/\\ding\{177\}/g,"⑥"],[/\\ding\{178\}/g,"⑦"],[/\\ding\{179\}/g,"⑧"],[/\\ding\{180\}/g,"⑨"],[/\\ding\{181\}/g,"⑩"],[/\\circledS /g,"Ⓢ"],[/\\Elzdshfnc /g,"┆"],[/\\Elzsqfnw /g,"┙"],[/\\diagup /g,"╱"],[/\\ding\{110\}/g,"■"],[/\\square /g,"□"],[/\\blacksquare /g,"▪"],[/\\fbox\{~~\}/g,"▭"],[/\\Elzvrecto /g,"▯"],[/\\ElsevierGlyph\{E381\}/g,"▱"],[/\\ding\{115\}/g,"▲"],[/\\bigtriangleup /g,"△"],[/\\blacktriangle /g,"▴"],[/\\vartriangle /g,"▵"],[/\\blacktriangleright /g,"▸"],[/\\triangleright /g,"▹"],[/\\ding\{116\}/g,"▼"],[/\\bigtriangledown /g,"▽"],[/\\blacktriangledown /g,"▾"],[/\\triangledown /g,"▿"],[/\\blacktriangleleft /g,"◂"],[/\\triangleleft /g,"◃"],[/\\ding\{117\}/g,"◆"],[/\\lozenge /g,"◊"],[/\\bigcirc /g,"○"],[/\\ding\{108\}/g,"●"],[/\\Elzcirfl /g,"◐"],[/\\Elzcirfr /g,"◑"],[/\\Elzcirfb /g,"◒"],[/\\ding\{119\}/g,"◗"],[/\\Elzrvbull /g,"◘"],[/\\Elzsqfl /g,"◧"],[/\\Elzsqfr /g,"◨"],[/\\Elzsqfse /g,"◪"],[/\\bigcirc /g,"◯"],[/\\ding\{72\}/g,"★"],[/\\ding\{73\}/g,"☆"],[/\\ding\{37\}/g,"☎"],[/\\ding\{42\}/g,"☛"],[/\\ding\{43\}/g,"☞"],[/\\rightmoon /g,"☾"],[/\\mercury /g,"☿"],[/\\venus /g,"♀"],[/\\male /g,"♂"],[/\\jupiter /g,"♃"],[/\\saturn /g,"♄"],[/\\uranus /g,"♅"],[/\\neptune /g,"♆"],[/\\pluto /g,"♇"],[/\\aries /g,"♈"],[/\\taurus /g,"♉"],[/\\gemini /g,"♊"],[/\\cancer /g,"♋"],[/\\leo /g,"♌"],[/\\virgo /g,"♍"],[/\\libra /g,"♎"],[/\\scorpio /g,"♏"],[/\\sagittarius /g,"♐"],[/\\capricornus /g,"♑"],[/\\aquarius /g,"♒"],[/\\pisces /g,"♓"],[/\\ding\{171\}/g,"♠"],[/\\diamond /g,"♢"],[/\\ding\{168\}/g,"♣"],[/\\ding\{170\}/g,"♥"],[/\\ding\{169\}/g,"♦"],[/\\quarternote /g,"♩"],[/\\eighthnote /g,"♪"],[/\\flat /g,"♭"],[/\\natural /g,"♮"],[/\\sharp /g,"♯"],[/\\ding\{33\}/g,"✁"],[/\\ding\{34\}/g,"✂"],[/\\ding\{35\}/g,"✃"],[/\\ding\{36\}/g,"✄"],[/\\ding\{38\}/g,"✆"],[/\\ding\{39\}/g,"✇"],[/\\ding\{40\}/g,"✈"],[/\\ding\{41\}/g,"✉"],[/\\ding\{44\}/g,"✌"],[/\\ding\{45\}/g,"✍"],[/\\ding\{46\}/g,"✎"],[/\\ding\{47\}/g,"✏"],[/\\ding\{48\}/g,"✐"],[/\\ding\{49\}/g,"✑"],[/\\ding\{50\}/g,"✒"],[/\\ding\{51\}/g,"✓"],[/\\ding\{52\}/g,"✔"],[/\\ding\{53\}/g,"✕"],[/\\ding\{54\}/g,"✖"],[/\\ding\{55\}/g,"✗"],[/\\ding\{56\}/g,"✘"],[/\\ding\{57\}/g,"✙"],[/\\ding\{58\}/g,"✚"],[/\\ding\{59\}/g,"✛"],[/\\ding\{60\}/g,"✜"],[/\\ding\{61\}/g,"✝"],[/\\ding\{62\}/g,"✞"],[/\\ding\{63\}/g,"✟"],[/\\ding\{64\}/g,"✠"],[/\\ding\{65\}/g,"✡"],[/\\ding\{66\}/g,"✢"],[/\\ding\{67\}/g,"✣"],[/\\ding\{68\}/g,"✤"],[/\\ding\{69\}/g,"✥"],[/\\ding\{70\}/g,"✦"],[/\\ding\{71\}/g,"✧"],[/\\ding\{73\}/g,"✩"],[/\\ding\{74\}/g,"✪"],[/\\ding\{75\}/g,"✫"],[/\\ding\{76\}/g,"✬"],[/\\ding\{77\}/g,"✭"],[/\\ding\{78\}/g,"✮"],[/\\ding\{79\}/g,"✯"],[/\\ding\{80\}/g,"✰"],[/\\ding\{81\}/g,"✱"],[/\\ding\{82\}/g,"✲"],[/\\ding\{83\}/g,"✳"],[/\\ding\{84\}/g,"✴"],[/\\ding\{85\}/g,"✵"],[/\\ding\{86\}/g,"✶"],[/\\ding\{87\}/g,"✷"],[/\\ding\{88\}/g,"✸"],[/\\ding\{89\}/g,"✹"],[/\\ding\{90\}/g,"✺"],[/\\ding\{91\}/g,"✻"],[/\\ding\{92\}/g,"✼"],[/\\ding\{93\}/g,"✽"],[/\\ding\{94\}/g,"✾"],[/\\ding\{95\}/g,"✿"],[/\\ding\{96\}/g,"❀"],[/\\ding\{97\}/g,"❁"],[/\\ding\{98\}/g,"❂"],[/\\ding\{99\}/g,"❃"],[/\\ding\{100\}/g,"❄"],[/\\ding\{101\}/g,"❅"],[/\\ding\{102\}/g,"❆"],[/\\ding\{103\}/g,"❇"],[/\\ding\{104\}/g,"❈"],[/\\ding\{105\}/g,"❉"],[/\\ding\{106\}/g,"❊"],[/\\ding\{107\}/g,"❋"],[/\\ding\{109\}/g,"❍"],[/\\ding\{111\}/g,"❏"],[/\\ding\{112\}/g,"❐"],[/\\ding\{113\}/g,"❑"],[/\\ding\{114\}/g,"❒"],[/\\ding\{118\}/g,"❖"],[/\\ding\{120\}/g,"❘"],[/\\ding\{121\}/g,"❙"],[/\\ding\{122\}/g,"❚"],[/\\ding\{123\}/g,"❛"],[/\\ding\{124\}/g,"❜"],[/\\ding\{125\}/g,"❝"],[/\\ding\{126\}/g,"❞"],[/\\ding\{161\}/g,"❡"],[/\\ding\{162\}/g,"❢"],[/\\ding\{163\}/g,"❣"],[/\\ding\{164\}/g,"❤"],[/\\ding\{165\}/g,"❥"],[/\\ding\{166\}/g,"❦"],[/\\ding\{167\}/g,"❧"],[/\\ding\{182\}/g,"❶"],[/\\ding\{183\}/g,"❷"],[/\\ding\{184\}/g,"❸"],[/\\ding\{185\}/g,"❹"],[/\\ding\{186\}/g,"❺"],[/\\ding\{187\}/g,"❻"],[/\\ding\{188\}/g,"❼"],[/\\ding\{189\}/g,"❽"],[/\\ding\{190\}/g,"❾"],[/\\ding\{191\}/g,"❿"],[/\\ding\{192\}/g,"➀"],[/\\ding\{193\}/g,"➁"],[/\\ding\{194\}/g,"➂"],[/\\ding\{195\}/g,"➃"],[/\\ding\{196\}/g,"➄"],[/\\ding\{197\}/g,"➅"],[/\\ding\{198\}/g,"➆"],[/\\ding\{199\}/g,"➇"],[/\\ding\{200\}/g,"➈"],[/\\ding\{201\}/g,"➉"],[/\\ding\{202\}/g,"➊"],[/\\ding\{203\}/g,"➋"],[/\\ding\{204\}/g,"➌"],[/\\ding\{205\}/g,"➍"],[/\\ding\{206\}/g,"➎"],[/\\ding\{207\}/g,"➏"],[/\\ding\{208\}/g,"➐"],[/\\ding\{209\}/g,"➑"],[/\\ding\{210\}/g,"➒"],[/\\ding\{211\}/g,"➓"],[/\\ding\{212\}/g,"➔"],[/\\ding\{216\}/g,"➘"],[/\\ding\{217\}/g,"➙"],[/\\ding\{218\}/g,"➚"],[/\\ding\{219\}/g,"➛"],[/\\ding\{220\}/g,"➜"],[/\\ding\{221\}/g,"➝"],[/\\ding\{222\}/g,"➞"],[/\\ding\{223\}/g,"➟"],[/\\ding\{224\}/g,"➠"],[/\\ding\{225\}/g,"➡"],[/\\ding\{226\}/g,"➢"],[/\\ding\{227\}/g,"➣"],[/\\ding\{228\}/g,"➤"],[/\\ding\{229\}/g,"➥"],[/\\ding\{230\}/g,"➦"],[/\\ding\{231\}/g,"➧"],[/\\ding\{232\}/g,"➨"],[/\\ding\{233\}/g,"➩"],[/\\ding\{234\}/g,"➪"],[/\\ding\{235\}/g,"➫"],[/\\ding\{236\}/g,"➬"],[/\\ding\{237\}/g,"➭"],[/\\ding\{238\}/g,"➮"],[/\\ding\{239\}/g,"➯"],[/\\ding\{241\}/g,"➱"],[/\\ding\{242\}/g,"➲"],[/\\ding\{243\}/g,"➳"],[/\\ding\{244\}/g,"➴"],[/\\ding\{245\}/g,"➵"],[/\\ding\{246\}/g,"➶"],[/\\ding\{247\}/g,"➷"],[/\\ding\{248\}/g,"➸"],[/\\ding\{249\}/g,"➹"],[/\\ding\{250\}/g,"➺"],[/\\ding\{251\}/g,"➻"],[/\\ding\{252\}/g,"➼"],[/\\ding\{253\}/g,"➽"],[/\\ding\{254\}/g,"➾"],[/\\longleftarrow /g,"⟵"],[/\\longrightarrow /g,"⟶"],[/\\longleftrightarrow /g,"⟷"],[/\\Longleftarrow /g,"⟸"],[/\\Longrightarrow /g,"⟹"],[/\\Longleftrightarrow /g,"⟺"],[/\\longmapsto /g,"⟼"],[/\\sim\\joinrel\\leadsto/g,"⟿"],[/\\ElsevierGlyph\{E212\}/g,"⤅"],[/\\UpArrowBar /g,"⤒"],[/\\DownArrowBar /g,"⤓"],[/\\ElsevierGlyph\{E20C\}/g,"⤣"],[/\\ElsevierGlyph\{E20D\}/g,"⤤"],[/\\ElsevierGlyph\{E20B\}/g,"⤥"],[/\\ElsevierGlyph\{E20A\}/g,"⤦"],[/\\ElsevierGlyph\{E211\}/g,"⤧"],[/\\ElsevierGlyph\{E20E\}/g,"⤨"],[/\\ElsevierGlyph\{E20F\}/g,"⤩"],[/\\ElsevierGlyph\{E210\}/g,"⤪"],[/\\ElsevierGlyph\{E21C\}/g,"⤳"],[/\\ElsevierGlyph\{E21D\}/g,"⤳-00338"],[/\\ElsevierGlyph\{E21A\}/g,"⤶"],[/\\ElsevierGlyph\{E219\}/g,"⤷"],[/\\Elolarr /g,"⥀"],[/\\Elorarr /g,"⥁"],[/\\ElzRlarr /g,"⥂"],[/\\ElzrLarr /g,"⥄"],[/\\Elzrarrx /g,"⥇"],[/\\LeftRightVector /g,"⥎"],[/\\RightUpDownVector /g,"⥏"],[/\\DownLeftRightVector /g,"⥐"],[/\\LeftUpDownVector /g,"⥑"],[/\\LeftVectorBar /g,"⥒"],[/\\RightVectorBar /g,"⥓"],[/\\RightUpVectorBar /g,"⥔"],[/\\RightDownVectorBar /g,"⥕"],[/\\DownLeftVectorBar /g,"⥖"],[/\\DownRightVectorBar /g,"⥗"],[/\\LeftUpVectorBar /g,"⥘"],[/\\LeftDownVectorBar /g,"⥙"],[/\\LeftTeeVector /g,"⥚"],[/\\RightTeeVector /g,"⥛"],[/\\RightUpTeeVector /g,"⥜"],[/\\RightDownTeeVector /g,"⥝"],[/\\DownLeftTeeVector /g,"⥞"],[/\\DownRightTeeVector /g,"⥟"],[/\\LeftUpTeeVector /g,"⥠"],[/\\LeftDownTeeVector /g,"⥡"],[/\\UpEquilibrium /g,"⥮"],[/\\ReverseUpEquilibrium /g,"⥯"],[/\\RoundImplies /g,"⥰"],[/\\ElsevierGlyph\{E214\}/g,"⥼"],[/\\ElsevierGlyph\{E215\}/g,"⥽"],[/\\Elztfnc /g,"⦀"],[/\\ElsevierGlyph\{3018\}/g,"⦅"],[/\\Elroang /g,"⦆"],[/\\ElsevierGlyph\{E291\}/g,"⦔"],[/\\Elzddfnc /g,"⦙"],[/\\Angle /g,"⦜"],[/\\Elzlpargt /g,"⦠"],[/\\ElsevierGlyph\{E260\}/g,"⦵"],[/\\ElsevierGlyph\{E61B\}/g,"⦶"],[/\\ElzLap /g,"⧊"],[/\\Elzdefas /g,"⧋"],[/\\LeftTriangleBar /g,"⧏"],[/\\NotLeftTriangleBar /g,"⧏-00338"],[/\\RightTriangleBar /g,"⧐"],[/\\NotRightTriangleBar /g,"⧐-00338"],[/\\ElsevierGlyph\{E372\}/g,"⧜"],[/\\blacklozenge /g,"⧫"],[/\\RuleDelayed /g,"⧴"],[/\\Elxuplus /g,"⨄"],[/\\ElzThr /g,"⨅"],[/\\Elxsqcup /g,"⨆"],[/\\ElzInf /g,"⨇"],[/\\ElzSup /g,"⨈"],[/\\ElzCint /g,"⨍"],[/\\clockoint /g,"⨏"],[/\\ElsevierGlyph\{E395\}/g,"⨐"],[/\\sqrint /g,"⨖"],[/\\ElsevierGlyph\{E25A\}/g,"⨥"],[/\\ElsevierGlyph\{E25B\}/g,"⨪"],[/\\ElsevierGlyph\{E25C\}/g,"⨭"],[/\\ElsevierGlyph\{E25D\}/g,"⨮"],[/\\ElzTimes /g,"⨯"],[/\\ElsevierGlyph\{E25E\}/g,"⨴"],[/\\ElsevierGlyph\{E25E\}/g,"⨵"],[/\\ElsevierGlyph\{E259\}/g,"⨼"],[/\\amalg /g,"⨿"],[/\\ElzAnd /g,"⩓"],[/\\ElzOr /g,"⩔"],[/\\ElsevierGlyph\{E36E\}/g,"⩕"],[/\\ElOr /g,"⩖"],[/\\perspcorrespond /g,"⩞"],[/\\Elzminhat /g,"⩟"],[/\\ElsevierGlyph\{225A\}/g,"⩣"],[/\\stackrel\{*\}\{=\}/g,"⩮"],[/\\Equal /g,"⩵"],[/\\leqslant /g,"⩽"],[/\\nleqslant /g,"⩽-00338"],[/\\geqslant /g,"⩾"],[/\\ngeqslant /g,"⩾-00338"],[/\\lessapprox /g,"⪅"],[/\\gtrapprox /g,"⪆"],[/\\lneq /g,"⪇"],[/\\gneq /g,"⪈"],[/\\lnapprox /g,"⪉"],[/\\gnapprox /g,"⪊"],[/\\lesseqqgtr /g,"⪋"],[/\\gtreqqless /g,"⪌"],[/\\eqslantless /g,"⪕"],[/\\eqslantgtr /g,"⪖"],[/\\Pisymbol\{ppi020\}\{117\}/g,"⪝"],[/\\Pisymbol\{ppi020\}\{105\}/g,"⪞"],[/\\NestedLessLess /g,"⪡"],[/\\NotNestedLessLess /g,"⪡-00338"],[/\\NestedGreaterGreater /g,"⪢"],[/\\NotNestedGreaterGreater /g,"⪢-00338"],[/\\preceq /g,"⪯"],[/\\not\\preceq /g,"⪯-00338"],[/\\succeq /g,"⪰"],[/\\not\\succeq /g,"⪰-00338"],[/\\precneqq /g,"⪵"],[/\\succneqq /g,"⪶"],[/\\precapprox /g,"⪷"],[/\\succapprox /g,"⪸"],[/\\precnapprox /g,"⪹"],[/\\succnapprox /g,"⪺"],[/\\subseteqq /g,"⫅"],[/\\nsubseteqq /g,"⫅-00338"],[/\\supseteqq /g,"⫆"],[/\\nsupseteqq/g,"⫆-00338"],[/\\subsetneqq /g,"⫋"],[/\\supsetneqq /g,"⫌"],[/\\ElsevierGlyph\{E30D\}/g,"⫫"],[/\\Elztdcol /g,"⫶"],[/\\ElsevierGlyph\{300A\}/g,"《"],[/\\ElsevierGlyph\{300B\}/g,"》"],[/\\ElsevierGlyph\{3018\}/g,"〘"],[/\\ElsevierGlyph\{3019\}/g,"〙"],[/\\openbracketleft /g,"〚"],[/\\openbracketright /g,"〛"]],
this}"undefined"!=typeof t&&t.exports&&(t.exports=i)},function(t,e,i){var a,n;(function(o){a=[i(6),i(18),i(5)],n=function(t,e,i){var a=o.View.extend({tagName:"div",className:"citations",render:function(){return this.$el.append("<p>"+this.formattedReference()+"</p>"),this},formattedReference:function(){var t=this.model,e=t.entryType(),i=t.fields(),a="",n=this._asSentence((i.author?i.author:"")+(i.year?" ("+i.year+")":""))+" ",o=i.title||"",s=i.pages?"pp. "+i.pages:"",r=i.address;if("article"==e){var l=(i.volume?i.volume:"")+(i.number?" ("+i.number+")":"")+(s?", "+s:"");a=n+this._asSentence(o)+(i.journal?"In <em>"+i.journal+", ":"")+this._asSentence(l)+this._asSentence(i.address)+"</em>"}else a="inproceedings"==e||"proceedings"==e?n+this._asSentence(o)+(i.booktitle?"In <em>"+i.booktitle+", ":"")+(s?s:"")+(r?", "+r:"")+".</em>":"mastersthesis"==e||"phdthesis"==e?n+this._asSentence(o)+(i.howpublished?i.howpublished+". ":"")+(i.note?i.note+".":""):"techreport"==e?n+this._asSentence(o)+this._asSentence(i.institution)+this._asSentence(i.number)+this._asSentence(i.type):"book"==e||"inbook"==e||"incollection"==e?n+" "+this._formatBookInfo(i):n+" "+this._asSentence(o)+this._asSentence(i.howpublished)+this._asSentence(i.note);var h="";i.doi&&(h="http://dx.doi.org/"+i.doi,a+='[<a href="'+h+'" target="_blank">doi:'+i.doi+"</a>]");var c=i.url||h;return c&&(a+='[<a href="'+c+'" target="_blank">Link</a>]'),a},_formatBookInfo:function(t){var e="";return t.chapter&&(e+=t.chapter+" in "),t.title&&(e+="<em>"+t.title+"</em>"),t.editor&&(e+=", Edited by "+t.editor+", "),t.publisher&&(e+=", "+t.publisher),t.pages&&(e+=", pp. "+t.pages),t.series&&(e+=", <em>"+t.series+"</em>"),t.volume&&(e+=", Vol."+t.volume),t.issn&&(e+=", ISBN: "+t.issn),e+"."},_asSentence:function(t){return t&&t.trim()?t+". ":""}}),n=o.View.extend({el:"#citations",initialize:function(){this.listenTo(this.collection,"add",this.renderCitation)},events:{"click .citations-to-bibtex":"showBibtex","click .citations-to-formatted":"showFormatted"},renderCitation:function(t){var e=new a({model:t});this.$(".citations-formatted").append(e.render().el);var i=this.$(".citations-bibtex-text");i.val(i.val()+"\n\r"+t.attributes.content)},render:function(){this.$el.html(this.citationsElement()),this.collection.each(function(t){this.renderCitation(t)},this),this.showFormatted()},showBibtex:function(){this.$(".citations-to-formatted").show(),this.$(".citations-to-bibtex").hide(),this.$(".citations-bibtex").show(),this.$(".citations-formatted").hide(),this.$(".citations-bibtex-text").select()},showFormatted:function(){this.$(".citations-to-formatted").hide(),this.$(".citations-to-bibtex").show(),this.$(".citations-bibtex").hide(),this.$(".citations-formatted").show()},partialWarningElement:function(){return this.collection.partial?['<div style="padding:5px 10px">',"<b>Warning: This is a experimental feature.</b> Most Galaxy tools will not annotate"," citations explicitly at this time. When writing up your analysis, please manually"," review your histories and find all references"," that should be cited in order to completely describe your work. Also, please remember to",' <a href="https://wiki.galaxyproject.org/CitingGalaxy">cite Galaxy</a>.',"</div>"].join(""):""},citationsElement:function(){return['<div class="toolForm">','<div class="toolFormTitle">',i("Citations"),' <button type="button" class="btn btn-xs citations-to-bibtex" title="Show all in BibTeX format."><i class="fa fa-pencil-square-o"></i> Show BibTeX</button>',' <button type="button" class="btn btn-xs citations-to-formatted" title="Return to formatted citation list."><i class="fa fa-times"></i> Hide BibTeX</button>',"</div>",'<div class="toolFormBody" style="padding:5px 10px">',this.partialWarningElement(),'<span class="citations-formatted" style="word-wrap: break-word;"></span>',"</div>",'<div class="citations-bibtex toolFormBody" style="padding:5px 10px">','<textarea style="width: 100%; height: 500px;" class="citations-bibtex-text"></textarea>',"</div>","</div>"].join("")}});return{CitationView:a,CitationListView:n}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2))},,,,,function(t,e,i){var a,n;(function(o,s,r){a=[i(4)],n=function(t){var e=o.Model.extend({initialize:function(t){this.app=t},checksum:function(){var t="",e=this;return this.app.section.$el.find(".section-row").each(function(){var i=s(this).attr("id"),a=e.app.field_list[i];a&&(t+=i+":"+JSON.stringify(a.value&&a.value())+":"+a.collapsed+";")}),t},create:function(){function t(t,e,i){a.flat_dict[t]=e,o[t]=i,a.app.element_list[e]&&a.app.element_list[e].$el.attr("tour_id",t)}function e(n,o){for(var s in o){var r=o[s];if(r.input){var l=r.input,h=n;switch(""!=n&&(h+="|"),h+=l.name,l.type){case"repeat":var c="section-",d=[],u=null;for(var g in r){var p=g.indexOf(c);-1!=p&&(p+=c.length,d.push(parseInt(g.substr(p))),u||(u=g.substr(0,p)))}d.sort(function(t,e){return t-e});var s=0;for(var _ in d)e(h+"_"+s++,r[u+d[_]]);break;case"conditional":var f=a.app.field_list[l.id].value();t(h+"|"+l.test_param.name,l.id,f);var v=i(l,f);-1!=v&&e(h,o[l.id+"-section-"+v]);break;case"section":e(!l.flat&&h||"",r);break;default:var m=a.app.field_list[l.id];if(m&&m.value){var f=m.value();if((void 0===l.ignore||l.ignore!=f)&&(m.collapsed&&l.collapsible_value&&(f=l.collapsible_value),t(h,l.id,f),l.payload))for(var b in l.payload)t(b,l.id,l.payload[b])}}}}}var a=this,n={};this._iterate(this.app.section.$el,n);var o={};return this.flat_dict={},e("",n),o},match:function(t){return this.flat_dict&&this.flat_dict[t]},matchCase:function(t,e){return i(t,e)},matchModel:function(t,e){return n(t.inputs,this.flat_dict,e)},matchResponse:function(t){function e(t,n){if("string"==typeof n){var o=a.flat_dict[t];o&&(i[o]=n)}else for(var s in n){var r=s;if(""!==t){var l="|";n instanceof Array&&(l="_"),r=t+l+r}e(r,n[s])}}var i={},a=this;return e("",t),i},_iterate:function(t,e){var i=this,a=s(t).children();a.each(function(){var t=this,a=s(t).attr("id");if(s(t).hasClass("section-row")){var n=i.app.input_list[a];e[a]=n&&{input:n}||{},i._iterate(t,e[a])}else i._iterate(t,e)})}}),i=function(t,e){"boolean"==t.test_param.type&&(e="true"==e?t.test_param.truevalue||"true":t.test_param.falsevalue||"false");for(var i in t.cases)if(t.cases[i].value==e)return i;return-1},a=function(t,e,i,n){n=s.extend(!0,{},n),r.each(t,function(t){t&&t.type&&(n[t.name]=t)}),r.each(t,function(t){r.isObject(t)&&(t.type&&n[t[e]]?i(t,n[t[e]]):a(t,e,i,n))})},n=function(t,e,a){function n(t,o){for(var s in o){var r=o[s],l=r.name;switch(""!=t&&(l=t+"|"+l),r.type){case"repeat":for(var h in r.cache)n(l+"_"+h,r.cache[h]);break;case"conditional":var c=i(r,r.test_param&&r.test_param.value);-1!=c&&n(l,r.cases[c].inputs);break;case"section":n(l,r.inputs);break;default:var d=e[l];d&&a(d,r)}}}var o={};return n("",t),o};return{Manager:e,matchIds:n,matchContext:a}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1),i(3))},function(t,e,i){var a,n;(function(i){a=[],n=function(){return i.View.extend({initialize:function(t,e){this.app=t,this.field=e.field,this.text_enable=t.options.text_enable||"Enable",this.text_disable=t.options.text_disable||"Disable",this.cls_enable=t.options.cls_enable||"fa fa-caret-square-o-down",this.cls_disable=t.options.cls_disable||"fa fa-caret-square-o-up",this.setElement(this._template(e)),this.$field=this.$(".ui-form-field"),this.$preview=this.$(".ui-form-preview"),this.$collapsible=this.$(".ui-form-collapsible"),this.$collapsible_icon=this.$(".ui-form-collapsible").find(".icon"),this.$error_text=this.$(".ui-form-error-text"),this.$error=this.$(".ui-form-error"),this.$backdrop=this.$(".ui-form-backdrop"),this.$field.prepend(this.field.$el),this.field.collapsed=void 0!==e.collapsible_value&&JSON.stringify(e.value)==JSON.stringify(e.collapsible_value),this._refresh();var i=this;this.$collapsible.on("click",function(){i.field.collapsed=!i.field.collapsed,i._refresh()})},disable:function(t){this.$backdrop.show(),t&&this.$backdrop.css({opacity:0,cursor:"default"})},error:function(t){this.$error_text.html(t),this.$error.show(),this.$el.addClass("ui-error")},reset:function(){this.$error.hide(),this.$el.removeClass("ui-error")},_refresh:function(){this.$collapsible_icon.removeClass().addClass("icon"),this.field.collapsed?(this.$field.hide(),this.$preview.show(),this._tooltip(this.text_enable,this.cls_enable)):(this.$field.fadeIn("fast"),this.$preview.hide(),this._tooltip(this.text_disable,this.cls_disable)),this.app.trigger("change")},_tooltip:function(t,e){this.$collapsible_icon.addClass(e).tooltip({placement:"bottom"}).attr("data-original-title",t).tooltip("fixTitle").tooltip("hide")},_template:function(t){var e='<div class="ui-form-element"><div class="ui-form-error ui-error"><span class="fa fa-arrow-down"/><span class="ui-form-error-text"/></div><div class="ui-form-title">';return e+=t.disabled||void 0===t.collapsible_value?t.label:'<div class="ui-form-collapsible"><i class="icon"/>'+t.label+"</div>",e+='</div><div class="ui-form-field">',e+='<div class="ui-form-info">',t.help&&(e+=t.help),t.argument&&-1==t.help.indexOf("("+t.argument+")")&&(e+=" ("+t.argument+")"),e+='</div><div class="ui-form-backdrop"/></div>',t.collapsible_preview&&(e+='<div class="ui-form-preview">'+t.text_value+"</div>"),e+="</div>"}})}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2))},function(t,e,i){var a,n;(function(o,s,r){a=[i(4),i(7),i(39),i(53),i(52),i(49)],n=function(t,e,i,a,n,l){return o.Model.extend({types:{text:"_fieldText",select:"_fieldSelect",data_column:"_fieldSelect",genomebuild:"_fieldSelect",data:"_fieldData",data_collection:"_fieldData",integer:"_fieldSlider","float":"_fieldSlider","boolean":"_fieldBoolean",drill_down:"_fieldDrilldown",color:"_fieldColor",hidden:"_fieldHidden",hidden_data:"_fieldHidden",baseurl:"_fieldHidden",library_data:"_fieldLibrary",ftpfile:"_fieldFtp"},initialize:function(t,e){this.app=t},create:function(t){var e=this.types[t.type],i="function"==typeof this[e]?this[e].call(this,t):null;return i||(this.app.incompatible=!0,i=t.options?this._fieldSelect(t):this._fieldText(t),Galaxy.emit.debug("form-parameters::_addRow()","Auto matched field type ("+t.type+").")),void 0===t.value&&(t.value=null),i.value(t.value),i},_fieldData:function(t){var e=this;return new i.View(this.app,{id:"field-"+t.id,extensions:t.extensions,optional:t.optional,multiple:t.multiple,type:t.type,data:t.options,onchange:function(){e.app.trigger("change")}})},_fieldSelect:function(t){if(t.is_workflow)return this._fieldText(t);"data_column"==t.type&&(t.error_text="Missing columns in referenced dataset.");var i=[];s.each(t.options,function(t){i.push({label:t[0],value:t[1]})});var a=e.Select;switch(t.display){case"checkboxes":a=e.Checkbox;break;case"radio":a=e.Radio}var n=this;return new a.View({id:"field-"+t.id,data:i,error_text:t.error_text||"No options available",multiple:t.multiple,optional:t.optional,searchable:t.searchable,onchange:function(){n.app.trigger("change")}})},_fieldDrilldown:function(t){if(t.is_workflow)return this._fieldText(t);var i=this;return new e.Drilldown.View({id:"field-"+t.id,data:t.options,display:t.display,onchange:function(){i.app.trigger("change")}})},_fieldText:function(i){if(i.options)if(i.area=i.multiple,t.validate(i.value)){if(r.isArray(i.value)){var a="";for(var n in i.value){if(a+=String(i.value[n]),!i.multiple)break;a+="\n"}i.value=a}}else i.value=null;var o=this;return new e.Input({id:"field-"+i.id,area:i.area,onchange:function(t){i.onchange?i.onchange(t):o.app.trigger("change")}})},_fieldSlider:function(t){var i=this;return new e.Slider.View({id:"field-"+t.id,precise:"float"==t.type,is_workflow:t.is_workflow,min:t.min,max:t.max,onchange:function(){i.app.trigger("change")}})},_fieldHidden:function(t){return new e.Hidden({id:"field-"+t.id,info:t.info})},_fieldBoolean:function(t){var i=this;return new e.RadioButton.View({id:"field-"+t.id,data:[{label:"Yes",value:"true"},{label:"No",value:"false"}],onchange:function(){i.app.trigger("change")}})},_fieldColor:function(t){var e=this;return new l({id:"field-"+t.id,onchange:function(){e.app.trigger("change")}})},_fieldLibrary:function(t){var e=this;return new a.View({id:"field-"+t.id,optional:t.optional,multiple:t.multiple,onchange:function(){e.app.trigger("change")}})},_fieldFtp:function(t){var e=this;return new n.View({id:"field-"+t.id,optional:t.optional,multiple:t.multiple,onchange:function(){e.app.trigger("change")}})}})}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(3),i(1))},function(t,e,i){var a,n;(function(o,s,r){a=[i(4),i(14),i(9),i(7)],n=function(t,e,i,a){var n=o.View.extend({initialize:function(i){this.options=t.merge(i,{title:"Section",empty_text:"Not available.",max:null,min:null}),this.setElement("<div/>"),this.button_new=new a.ButtonIcon({icon:"fa-plus",title:"Insert "+this.options.title_new,tooltip:"Add new "+this.options.title_new+" block",floating:"clear",onclick:function(){i.onnew&&i.onnew()}}),this.table=new e.View({cls:"ui-table-plain",content:""}),this.$el.append(this.table.$el),this.$el.append(s("<div/>").append(this.button_new.$el)),this.list={},this.n=0},size:function(){return this.n},add:function(t){if(!t.id||this.list[t.id])return void Galaxy.emit.debug("form-repeat::add()","Duplicate repeat block id.");this.n++;var e=new a.ButtonIcon({icon:"fa-trash-o",tooltip:"Delete this repeat block",cls:"ui-button-icon-plain",onclick:function(){t.ondel&&t.ondel()}}),n=new i.View({id:t.id,title:"placeholder",cls:"ui-portlet-repeat",operations:{button_delete:e}});n.append(t.$el),n.$el.addClass("section-row"),this.list[t.id]=n,this.table.add(n.$el),this.table.append("row_"+t.id,!0),this.options.max>0&&this.n>=this.options.max&&this.button_new.disable(),this._refresh()},del:function(t){if(!this.list[t])return void Galaxy.emit.debug("form-repeat::del()","Invalid repeat block id.");this.n--;var e=this.table.get("row_"+t);e.remove(),delete this.list[t],this.button_new.enable(),this._refresh()},hideOptions:function(){this.button_new.$el.hide(),r.each(this.list,function(t){t.hideOperation("button_delete")}),r.isEmpty(this.list)&&this.$el.append(s("<div/>").addClass("ui-form-info").html(this.options.empty_text))},_refresh:function(){var t=0;for(var e in this.list){var i=this.list[e];i.title(++t+": "+this.options.title),this.n>this.options.min?i.showOperation("button_delete"):i.hideOperation("button_delete")}}});return{View:n}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1),i(3))},function(t,e,i){var a,n;(function(o,s,r,l){a=[i(4),i(14),i(7),i(9),i(37),i(35),i(36)],n=function(t,e,i,a,n,h,c){var d=o.View.extend({initialize:function(t,i){this.app=t,this.inputs=i.inputs,i.cls="ui-table-plain",i.cls_tr="section-row",this.table=new e.View(i),this.parameters=new c(t,i),this.setElement(this.table.$el),this.render()},render:function(){this.table.delAll();for(var t in this.inputs)this.add(this.inputs[t])},add:function(e){var i=s.extend(!0,{},e);i.id=e.id=t.uid(),this.app.input_list[i.id]=i;var a=i.type;switch(a){case"conditional":this._addConditional(i);break;case"repeat":this._addRepeat(i);break;case"section":this._addSection(i);break;default:this._addRow(i)}},_addConditional:function(t){var e=this;t.test_param.id=t.id,this.app.options.sustain_conditionals&&(t.test_param.disabled=!0);var i=this._addRow(t.test_param);i.options.onchange=function(i){var a=e.app.data.matchCase(t,i);for(var n in t.cases){var o=t.cases[n],s=t.id+"-section-"+n,r=e.table.get(s),l=!1;for(var h in o.inputs)if(!o.inputs[h].hidden){l=!0;break}n==a&&l?r.fadeIn("fast"):r.hide()}e.app.trigger("change")};for(var a in t.cases){var n=t.id+"-section-"+a,o=new d(this.app,{inputs:t.cases[a].inputs});o.$el.addClass("ui-table-section"),this.table.add(o.$el),this.table.append(n)}i.trigger("change")},_addRepeat:function(t){function e(e){var n=t.id+"-section-"+a++,s=new d(i.app,{inputs:e});o.add({id:n,$el:s.$el,ondel:function(){o.del(n),i.app.trigger("change")}})}for(var i=this,a=0,o=new n.View({title:t.title||"Repeat",title_new:t.title||"",min:t.min,max:t.max,onnew:function(){e(t.inputs),i.app.trigger("change")}}),s=r.size(t.cache),l=0;l<Math.max(Math.max(s,t.min),t["default"]);l++)e(s>l?t.cache[l]:t.inputs);this.app.options.sustain_repeats&&o.hideOptions();var c=new h(this.app,{label:t.title||t.name,help:t.help,field:o});this.table.add(c.$el),this.table.append(t.id)},_addSection:function(t){var e=this,n=new d(e.app,{inputs:t.inputs}),o=new i.ButtonIcon({icon:"fa-eye-slash",tooltip:"Show/hide section",cls:"ui-button-icon-plain"}),s=new a.View({title:t.title||t.name,cls:"ui-portlet-section",collapsible:!0,collapsed:!0,operations:{button_visible:o}});s.append(n.$el),s.append(l("<div/>").addClass("ui-form-info").html(t.help)),s.setOperation("button_visible",function(){s.collapsed?s.expand():s.collapse()}),s.on("expanded",function(){o.setIcon("fa-eye")}),s.on("collapsed",function(){o.setIcon("fa-eye-slash")}),this.app.on("expand",function(t){s.$("#"+t).length>0&&s.expand()}),t.expanded&&s.expand(),this.table.add(s.$el),this.table.append(t.id)},_addRow:function(t){var e=t.id,i=this.parameters.create(t);this.app.field_list[e]=i;var a=new h(this.app,{name:t.name,label:t.label||t.name,value:t.value,text_value:t.text_value||t.value,collapsible_value:t.collapsible_value,collapsible_preview:t.collapsible_preview,help:t.help,argument:t.argument,disabled:t.disabled,field:i});return this.app.element_list[e]=a,this.table.add(a.$el),this.table.append(e),t.hidden&&this.table.get(e).hide(),i}});return{View:d}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1),i(3),i(1))},function(t,e,i){var a,n;(function(o,s,r){a=[i(4),i(7),i(27)],n=function(t,e,i){var a=o.View.extend({initialize:function(i,a){this.app=i,this.options=a,this.history={};var n=this;this.setElement('<div class="ui-select-content"/>'),this.list={};var o=[];"data_collection"==a.type?this.mode="collection":a.multiple?this.mode="multiple":this.mode="single",this.current=this.mode,this.list={};var l=t.textify(a.extensions),h="No dataset available.";l&&(h="No "+l+" dataset available.");var c="No dataset list available.";if(l&&(c="No "+l+" dataset collection available."),"single"==this.mode&&(o.push({icon:"fa-file-o",value:"single",tooltip:"Single dataset"}),this.select_single=new e.Select.View({optional:a.optional,error_text:h,onchange:function(){n.trigger("change")}}),this.list.single={field:this.select_single,type:"hda"}),"single"!=this.mode&&"multiple"!=this.mode||(o.push({icon:"fa-files-o",value:"multiple",tooltip:"Multiple datasets"}),this.select_multiple=new e.Select.View({multiple:!0,searchable:!1,optional:a.optional,error_text:h,onchange:function(){n.trigger("change")}}),this.list.multiple={field:this.select_multiple,type:"hda"}),"single"==this.mode||"multiple"==this.mode||"collection"==this.mode){o.push({icon:"fa-folder-o",value:"collection",tooltip:"Dataset collection"});var d="multiple"==this.mode;this.select_collection=new e.Select.View({error_text:c,multiple:d,searchable:!1,optional:a.optional,onchange:function(){n.trigger("change")}}),this.list.collection={field:this.select_collection,type:"hdca"}}this.button_type=new e.RadioButton.View({value:this.current,data:o,onchange:function(t){n.current=t,n.refresh(),n.trigger("change")}}),this.$batch=s(this.template_batch());var u=r.size(this.list),g=0;u>1&&(this.$el.append(this.button_type.$el),g=Math.max(0,35*r.size(this.list))+"px");for(var p in this.list)this.$el.append(this.list[p].field.$el.css({"margin-left":g}));this.$el.append(this.$batch.css({"margin-left":g})),this.update(a.data),void 0!==this.options.value&&this.value(this.options.value),this.refresh(),this.on("change",function(){a.onchange&&a.onchange(n.value())})},wait:function(){for(var t in this.list)this.list[t].field.wait()},unwait:function(){for(var t in this.list)this.list[t].field.unwait()},update:function(t){function e(t,e){if(t){var a=[];for(var n in e){var o=e[n];a.push({hid:o.hid,label:o.hid+": "+o.name,value:o.id}),i.history[o.id+"_"+o.src]=o}t.add(a,function(t,e){return e.hid-t.hid})}}var i=this;e(this.select_single,t.hda),e(this.select_multiple,t.hda),e(this.select_collection,t.hdca)},value:function(t){if(void 0!==t)if(t&&t.values)try{var e=[];for(var i in t.values)e.push(t.values[i].id);t&&t.values.length>0&&"hdca"==t.values[0].src?(this.current="collection",this.select_collection.value(e)):"multiple"==this.mode?(this.current="multiple",this.select_multiple.value(e)):(this.current="single",this.select_single.value(e[0]))}catch(a){Galaxy.emit.debug("tools-select-content::value()","Skipped.")}else for(var i in this.list)this.list[i].field.value(null);this.refresh();var n=this._select().value();if(null===n)return null;if(n instanceof Array||(n=[n]),0===n.length)return null;var o={batch:this._batch(),values:[]};for(var i in n){var s=this.history[n[i]+"_"+this.list[this.current].type];if(!s)return null;o.values.push(s)}return o.values.sort(function(t,e){return t.hid-e.hid}),o},refresh:function(){this.button_type.value(this.current);for(var t in this.list){var e=this.list[t].field.$el;this.current==t?e.show():e.hide()}this._batch()?this.$batch.show():this.$batch.hide()},_select:function(){return this.list[this.current].field},_batch:function(){if("collection"==this.current){var t=this.history[this._select().value()+"_hdca"];if(t&&t.map_over_type)return!0}return"single"!=this.current&&"single"==this.mode},template_batch:function(){return'<div class="ui-form-info"><i class="fa fa-sitemap" style="font-size: 1.2em; padding: 2px 5px;"/>This is a batch mode input field. A separate job will be triggered for each dataset.</div>'}});return{View:a}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1),i(3))},function(t,e,i){var a,n;(function(o,s,r){a=[i(4),i(9),i(7),i(38),i(34)],n=function(t,e,i,a,n){return o.View.extend({initialize:function(e){this.options=t.merge(e,{initial_errors:!1,cls:"ui-portlet-limited",icon:""}),this.modal=parent.Galaxy&&parent.Galaxy.modal||new i.Modal.View,this.setElement("<div/>"),this.render()},update:function(t){var e=this;this.data.matchModel(t,function(t,i){var a=e.input_list[t];if(a&&a.options&&!s.isEqual(a.options,i.options)){a.options=i.options;var n=e.field_list[t];if(n.update){var o=[];if(-1!=["data","data_collection","drill_down"].indexOf(a.type))o=a.options;else for(var r in i.options){var l=i.options[r];l.length>2&&o.push({label:l[0],value:l[1]})}n.update(o),n.trigger("change"),Galaxy.emit.debug("form-view::update()","Updating options for "+t)}}})},wait:function(t){for(var e in this.input_list){var i=this.field_list[e],a=this.input_list[e];a.is_dynamic&&i.wait&&i.unwait&&(t?i.wait():i.unwait())}},highlight:function(t,e,i){var a=this.element_list[t];if(a&&(a.error(e||"Please verify this parameter."),this.trigger("expand",t),!i))if(self==top){var n=this.$el.parents().filter(function(){return"auto"==r(this).css("overflow")}).first();n.animate({scrollTop:n.scrollTop()+a.$el.offset().top-50},500)}else r("html, body").animate({scrollTop:a.$el.offset().top-20},500)},errors:function(t){if(this.trigger("reset"),t&&t.errors){var e=this.data.matchResponse(t.errors);for(var i in this.element_list){this.element_list[i];e[i]&&this.highlight(i,e[i],!0)}}},render:function(){var t=this;this.off("change"),this.off("reset"),this.field_list={},this.input_list={},this.element_list={},this.data=new n.Manager(this),this._renderForm(),this.data.create(),this.options.initial_errors&&this.errors(this.options);var e=this.data.checksum();return this.on("change",function(){var i=t.data.checksum();i!=e&&(e=i,t.options.onchange&&t.options.onchange())}),this.on("reset",function(){for(var t in this.element_list)this.element_list[t].reset()}),this},_renderForm:function(){this.message=new i.Message,this.section=new a.View(this,{inputs:this.options.inputs}),r(".tooltip").remove(),this.portlet=new e.View({icon:this.options.icon,title:this.options.title,cls:this.options.cls,operations:this.options.operations,buttons:this.options.buttons,collapsible:this.options.collapsible,collapsed:this.options.collapsed}),this.portlet.append(this.message.$el),this.portlet.append(this.section.$el),this.$el.empty(),this.$el.append(this.portlet.$el),this.options.message&&this.message.update({persistent:!0,status:"warning",message:this.options.message}),Galaxy.emit.debug("form-view::initialize()","Completed")}})}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(3),i(1))},,,,,function(t,e,i){var a,n;(function(o){a=[i(4),i(57),i(7),i(40),i(20),i(18),i(29)],n=function(t,e,i,a,n,s,r){return a.extend({initialize:function(t){var i=this;a.prototype.initialize.call(this,t),this.deferred=new e,t.inputs?(this._buildForm(t),t.needs_update&&this.deferred.execute(function(t){i._updateModel(t)})):this.deferred.execute(function(e){i._buildModel(e,t,!0)})},remove:function(){var t=this;this.$el.hide(),this.deferred.execute(function(){a.prototype.remove.call(t),Galaxy.emit.debug("tool-form-base::remove()","Destroy view.")})},_buildForm:function(e){var i=this;this.options=t.merge(e,this.options),this.options=t.merge({icon:void 0===e.icon&&"fa-wrench"||"",title:"<b>"+e.name+"</b> "+e.description+" (Galaxy Version "+e.version+")",operations:this._operations(),onchange:function(){i.deferred.reset(),i.deferred.execute(function(t){i._updateModel(t)})}},this.options),this.options.customize&&this.options.customize(this.options),this.render(),this.options.collapsible||this.$el.append(o("<div/>").addClass("ui-margin-top-large").append(this._footer()))},_buildModel:function(e,a,n){var s=this;this.options.id=a.id,this.options.version=a.version;var r="",l={};a.job_id?r=Galaxy.root+"api/jobs/"+a.job_id+"/build_for_rerun":(r=Galaxy.root+"api/tools/"+a.id+"/build",Galaxy.params&&Galaxy.params.tool_id==a.id&&(l=o.extend({},Galaxy.params),a.version&&(l.tool_version=a.version))),t.request({type:"GET",url:r,data:l,success:function(t){s._buildForm(t.tool_model||t),!n&&s.message.update({status:"success",message:"Now you are using '"+s.options.name+"' version "+s.options.version+", id '"+s.options.id+"'.",persistent:!1}),Galaxy.emit.debug("tool-form-base::initialize()","Initial tool model ready.",t),e.resolve()},error:function(t){var a=t&&t.err_msg||"Uncaught error.";s.$el.is(":empty")?s.$el.prepend(new i.Message({message:a,status:"danger",persistent:!0,large:!0}).$el):Galaxy.modal.show({title:"Tool request failed",body:a,buttons:{Close:function(){Galaxy.modal.hide()}}}),Galaxy.emit.debug("tool-form::initialize()","Initial tool model request failed.",t),e.reject()}})},_updateModel:function(e){var i=this,a=this.options.update_url||Galaxy.root+"api/tools/"+this.options.id+"/build",n={tool_id:this.options.id,tool_version:this.options.version,inputs:o.extend(!0,{},i.data.create())};this.wait(!0),Galaxy.emit.debug("tool-form-base::_updateModel()","Sending current state.",n),t.request({type:"POST",url:a,data:n,success:function(t){i.update(t.tool_model||t),i.options.update&&i.options.update(t),i.wait(!1),Galaxy.emit.debug("tool-form-base::_updateModel()","Received new model.",t),e.resolve()},error:function(t){Galaxy.emit.debug("tool-form-base::_updateModel()","Refresh request failed.",t),e.reject()}})},_operations:function(){var t=this,e=this.options,a=new i.ButtonMenu({icon:"fa-cubes",title:!e.narrow&&"Versions"||null,tooltip:"Select another tool version"});if(!e.sustain_version&&e.versions&&e.versions.length>1)for(var o in e.versions){var s=e.versions[o];s!=e.version&&a.addMenu({title:"Switch to "+s,version:s,icon:"fa-cube",onclick:function(){var i=e.id.replace(e.version,this.version),a=this.version;t.deferred.reset(),t.deferred.execute(function(e){t._buildModel(e,{id:i,version:a})})}})}else a.$el.hide();var r=new i.ButtonMenu({icon:"fa-caret-down",title:!e.narrow&&"Options"||null,tooltip:"View available options"});return e.biostar_url&&(r.addMenu({icon:"fa-question-circle",title:"Question?",tooltip:"Ask a question about this tool (Biostar)",onclick:function(){window.open(e.biostar_url+"/p/new/post/")}}),r.addMenu({icon:"fa-search",title:"Search",tooltip:"Search help for this tool (Biostar)",onclick:function(){window.open(e.biostar_url+"/local/search/page/?q="+e.name)}})),r.addMenu({icon:"fa-share",title:"Share",tooltip:"Share this tool",onclick:function(){prompt("Copy to clipboard: Ctrl+C, Enter",window.location.origin+Galaxy.root+"root?tool_id="+e.id)}}),Galaxy.user&&Galaxy.user.get("is_admin")&&r.addMenu({icon:"fa-download",title:"Download",tooltip:"Download this tool",onclick:function(){window.location.href=Galaxy.root+"api/tools/"+e.id+"/download"}}),e.requirements&&e.requirements.length>0&&r.addMenu({icon:"fa-info-circle",title:"Requirements",tooltip:"Display tool requirements",onclick:function(){this.visible?(this.visible=!1,t.message.update({message:""})):(this.visible=!0,t.message.update({persistent:!0,message:n.requirements(e),status:"info"}))}}),e.sharable_url&&r.addMenu({icon:"fa-external-link",title:"See in Tool Shed",tooltip:"Access the repository",onclick:function(){window.open(e.sharable_url)}}),{menu:r,versions:a}},_footer:function(){var t=this.options,e=o("<div/>").append(n.help(t));if(t.citations){var i=o("<div/>"),a=new s.ToolCitationCollection;a.tool_id=t.id;var l=new r.CitationListView({el:i,collection:a});l.render(),a.fetch(),e.append(i)}return e}})}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(1))},function(t,e,i){var a,n;(function(o,s){a=[i(3),i(17),i(11),i(19)],n=function(t,e,i,a){"use strict";var n={hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}},r=o.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(t){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new r(this.toJSON())},set_value:function(t){this.set("value",t||"")}}),l=o.Collection.extend({model:r}),h=r.extend({}),c=r.extend({set_value:function(t){this.set("value",parseInt(t,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),d=c.extend({set_value:function(t){this.set("value",parseFloat(t))}}),u=r.extend({get_samples:function(){return t.map(this.get("options"),function(t){return t[0]})}});r.subModelTypes={integer:c,"float":d,data:h,select:u};var g=o.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(e){this.set("inputs",new l(t.map(e.inputs,function(t){var e=r.subModelTypes[t.type]||r;return new e(t)})))},toJSON:function(){var t=o.Model.prototype.toJSON.call(this);return t.inputs=this.get("inputs").map(function(t){return t.toJSON()}),t},remove_inputs:function(t){var e=this,i=e.get("inputs").filter(function(e){return-1!==t.indexOf(e.get("type"))});e.get("inputs").remove(i)},copy:function(t){var e=new g(this.toJSON());if(t){var i=new o.Collection;e.get("inputs").each(function(t){t.get_samples()&&i.push(t)}),e.set("inputs",i)}return e},apply_search_results:function(e){return-1!==t.indexOf(e,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(t,e){this.get("inputs").find(function(e){return e.get("name")===t}).set("value",e)},set_input_values:function(e){var i=this;t.each(t.keys(e),function(t){i.set_input_value(t,e[t])})},run:function(){return this._run()},rerun:function(t,e){return this._run({action:"rerun",target_dataset_id:t.id,regions:e})},get_inputs_dict:function(){var t={};return this.get("inputs").each(function(e){t[e.get("name")]=e.get("value")}),t},_run:function(a){var n=t.extend({tool_id:this.id,inputs:this.get_inputs_dict()},a),o=s.Deferred(),r=new e.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(n),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});return s.when(r.go()).then(function(t){o.resolve(new i.DatasetCollection(t))}),o}});t.extend(g.prototype,n);var p=(o.View.extend({}),o.Collection.extend({model:g})),_=o.Model.extend(n),f=o.Model.extend({
defaults:{elems:[],open:!1},clear_search_results:function(){t.each(this.attributes.elems,function(t){t.show()}),this.show(),this.set("open",!1)},apply_search_results:function(e){var i,a=!0;t.each(this.attributes.elems,function(t){t instanceof _?(i=t,i.hide()):t instanceof g&&t.apply_search_results(e)&&(a=!1,i&&i.show())}),a?this.hide():(this.show(),this.set("open",!0))}});t.extend(f.prototype,n);var v=o.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",search_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var t=this.attributes.query;if(t.length<this.attributes.min_chars_for_search)return void this.set("results",null);var e=t;this.timer&&clearTimeout(this.timer),s("#search-clear-btn").hide(),s("#search-spinner").show();var i=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+e),s.get(i.urlRoot,{q:e},function(t){i.set("results",t),s("#search-spinner").hide(),s("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});t.extend(v.prototype,n);var m=o.Model.extend({initialize:function(t){this.attributes.tool_search=t.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=t.tools,this.attributes.layout=new o.Collection(this.parse(t.layout))},parse:function(e){var i=this,a=function(e){var n=e.model_class;if(n.indexOf("Tool")===n.length-4)return i.attributes.tools.get(e.id);if("ToolSection"===n){var o=t.map(e.elems,a);return e.elems=o,new f(e)}return"ToolSectionLabel"===n?new _(e):void 0};return t.map(e,a)},clear_search_results:function(){this.get("layout").each(function(t){t instanceof f?t.clear_search_results():t.show()})},apply_search_results:function(){var t=this.get("tool_search").get("results");if(null===t)return void this.clear_search_results();var e=null;this.get("layout").each(function(i){i instanceof _?(e=i,e.hide()):i instanceof g?i.apply_search_results(t)&&e&&e.show():(e=null,i.apply_search_results(t))})}}),b=o.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),w=b.extend({tagName:"div",render:function(){var t=s("<div/>");if(t.append(S.tool_link(this.model.toJSON())),"upload1"===this.model.id)t.find("a").on("click",function(t){t.preventDefault(),Galaxy.upload.show()});else if("Tool"===this.model.get("model_class")){var e=this;t.find("a").on("click",function(t){t.preventDefault();var i=new a.View({id:e.model.id,version:e.model.get("version")});i.deferred.execute(function(){Galaxy.app.display(i)})})}return this.$el.append(t),this}}),y=b.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(s("<span/>").text(this.model.attributes.text)),this}}),x=b.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){b.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(S.panel_section(this.model.toJSON()));var e=this.$el.find(".toolSectionBody");return t.each(this.model.attributes.elems,function(t){if(t instanceof g){var i=new w({model:t,className:"toolTitle"});i.render(),e.append(i.$el)}else if(t instanceof _){var a=new y({model:t});a.render(),e.append(a.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),k=o.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(S.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(t){return this.model.attributes.clear_key&&this.model.attributes.clear_key===t.which?(this.clear(),!1):void this.model.set("query",this.$el.find(":input").val())}}),C=o.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var t=this,e=new k({model:this.model.get("tool_search")});return e.render(),t.$el.append(e.$el),this.model.get("layout").each(function(e){if(e instanceof f){var i=new x({model:e});i.render(),t.$el.append(i.$el)}else if(e instanceof g){var a=new w({model:e,className:"toolTitleNoSection"});a.render(),t.$el.append(a.$el)}else if(e instanceof _){var n=new y({model:e});n.render(),t.$el.append(n.$el)}}),t.$el.find("a.tool-link").click(function(e){var i=s(this).attr("class").split(/\s+/)[0],a=t.model.get("tools").get(i);t.trigger("tool_link_click",e,a)}),this},handle_search_results:function(){var t=this.model.get("tool_search").get("results");t&&0===t.length?s("#search-no-results").show():s("#search-no-results").hide()}}),T=o.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(S.tool_form(this.model.toJSON()))}}),S=(o.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new C({collection:this.collection}),this.tool_form_view=new T},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var t=this;this.tool_panel_view.on("tool_link_click",function(e,i){e.preventDefault(),t.show_tool(i)})},show_tool:function(t){var e=this;t.fetch().done(function(){e.tool_form_view.model=t,e.tool_form_view.render(),e.tool_form_view.$el.show(),s("#left").width("650px")})}}),{tool_search:t.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:t.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:t.template(['<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="label label-default label-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">',"<%- name %>","</a>"," <%- description %>"].join("")),tool_form:t.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});return{ToolParameter:r,IntegerToolParameter:c,SelectToolParameter:u,Tool:g,ToolCollection:p,ToolSearch:v,ToolPanel:m,ToolPanelView:C,ToolFormView:T}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},,,function(t,e,i){var a,n;(function(o,s){a=[i(4)],n=function(t){return o.View.extend({colors:{standard:["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],base:["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],theme:[["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7e","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"]]},initialize:function(e){this.options=t.merge(e,{}),this.setElement(this._template()),this.$panel=this.$(".ui-color-picker-panel"),this.$view=this.$(".ui-color-picker-view"),this.$value=this.$(".ui-color-picker-value"),this.$header=this.$(".ui-color-picker-header"),this._build(),this.visible=!1,this.value(this.options.value),this.$boxes=this.$(".ui-color-picker-box");var i=this;this.$boxes.on("click",function(){i.value(s(this).css("background-color")),i.$header.trigger("click")}),this.$header.on("click",function(){i.visible=!i.visible,i.visible?i.$view.fadeIn("fast"):i.$view.fadeOut("fast")})},value:function(t){return void 0!==t&&null!==t&&(this.$value.css("background-color",t),this.$(".ui-color-picker-box").empty(),this.$(this._getValue()).html(this._templateCheck()),this.options.onchange&&this.options.onchange(t)),this._getValue()},_getValue:function(){function t(t){return("0"+parseInt(t).toString(16)).slice(-2)}var e=this.$value.css("background-color");return e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),e?"#"+t(e[1])+t(e[2])+t(e[3]):null},_build:function(){this._content({label:"Theme Colors",colors:this.colors.base,padding:10});for(var t in this.colors.theme){var e={};0==t?e.bottom=!0:t!=this.colors.theme.length-1?(e.top=!0,e.bottom=!0):(e.top=!0,e.padding=5),e.colors=this.colors.theme[t],this._content(e)}this._content({label:"Standard Colors",colors:this.colors.standard,padding:5})},_content:function(t){var e=(t.label,t.colors),i=t.padding,a=t.top,n=t.bottom,o=s(this._templateContent()),r=o.find(".label");t.label?r.html(t.label):r.hide();var l=o.find(".line");this.$panel.append(o);for(var h in e){var c=s(this._templateBox(e[h]));a&&(c.css("border-top","none"),c.css("border-top-left-radius","0px"),c.css("border-top-right-radius","0px")),n&&(c.css("border-bottom","none"),c.css("border-bottom-left-radius","0px"),c.css("border-bottom-right-radius","0px")),l.append(c)}return i&&l.css("padding-bottom",i),o},_templateCheck:function(){return'<div class="ui-color-picker-check fa fa-check"/>'},_templateContent:function(){return'<div class="ui-color-picker-content"><div class="label"/><div class="line"/></div>'},_templateBox:function(t){return'<div id="'+t+'" class="ui-color-picker-box" style="background-color: #'+t+';"/>'},_template:function(){return'<div class="ui-color-picker"><div class="ui-color-picker-header"><div class="ui-color-picker-value"/><div class="ui-color-picker-label">Select a color</div></div><div class="ui-color-picker-view ui-input"><div class="ui-color-picker-panel"/></div>'}})}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},function(t,e,a){var n,o;(function(s){n=[a(4),a(22)],o=function(t,e){var a=e.BaseIcons.extend({initialize:function(t){t.type=t.display||"checkbox",t.multiple="checkbox"==t.display,e.BaseIcons.prototype.initialize.call(this,t),this.initial=!0},value:function(t){var i=e.BaseIcons.prototype.value.call(this,t);if(this.initial&&null!==i&&this.header_index){this.initial=!1;var a=i;s.isArray(a)||(a=[a]);for(var n in a){var o=this.header_index[a[n]];for(var r in o)this._setState(o[r],!0)}}return i},_setState:function(t,e){var i=this.$(".button-"+t),a=this.$(".subgroup-"+t);i.data("is_expanded",e),e?(a.fadeIn("fast"),i.removeClass("fa-plus-square"),i.addClass("fa-minus-square")):(a.hide(),i.removeClass("fa-minus-square"),i.addClass("fa-plus-square"))},_templateOptions:function(e){function a(t,e){var i=t.find(".button-"+e);i.on("click",function(){o._setState(e,!i.data("is_expanded"))})}function n(e,r,l){l=l||[];for(i in r){var h=r[i],c=h.options.length>0,d=l.slice(0);o.header_index[h.value]=d.slice(0);var u=s("<div/>");if(c){var g=t.uid(),p=s('<span class="button-'+g+' ui-drilldown-button fa fa-plus-square"/>'),_=s('<div class="subgroup-'+g+'" style="display: none; margin-left: 25px;"/>');d.push(g);var f=s("<div/>");f.append(p),f.append(o._templateOption({label:h.name,value:h.value})),u.append(f),n(_,h.options,d),u.append(_),a(u,g)}else u.append(o._templateOption({label:h.name,value:h.value}));e.append(u)}}var o=this;this.header_index={};var r=s("<div/>");return n(r,e),r},_template:function(t){return'<div class="ui-options-list drilldown-container" id="'+t.id+'"/>'}});return{View:a}}.apply(e,n),!(void 0!==o&&(t.exports=o))}).call(e,a(1))},function(t,e,i){var a,n;(function(o,s,r){a=[i(4),i(13)],n=function(t,e){var i=o.View.extend({optionsDefault:{id:t.uid(),cls:"ui-select",error_text:"No options available",empty_text:"Nothing selected",visible:!0,wait:!1,multiple:!1,searchable:!0,optional:!1},initialize:function(i){var a=this;this.model=new o.Model,this.options=t.merge(i,this.optionsDefault),this.setElement(this._template(this.options)),this.$select=this.$el.find(".select"),this.$icon_dropdown=this.$el.find(".icon-dropdown"),this.$icon_dropdown.on("click",function(){a.$select.select2&&a.$select.select2("open")});var n=null;this.$(".icon-resize").on("mousedown",function(t){var e=t.pageY,i=a.$select.height();n=n||i,s("#dd-helper").show().on("mousemove",function(t){a.$select.height(Math.max(i+(t.pageY-e),n))}).on("mouseup mouseleave",function(){s("#dd-helper").hide().off()})}),this.options.multiple&&(this.options.searchable?(this.all_button=new e.ButtonCheck({onclick:function(){var t=[];0!==a.all_button.value()&&(t=a._availableOptions()),a.value(t),a.trigger("change")}}),this.$el.prepend(this.all_button.$el)):this.$el.addClass("ui-select-multiple"),this.$select.prop("multiple",!0),this.$icon_dropdown.remove()),this.update(this.options.data),void 0!==this.options.value&&this.value(this.options.value),this.options.visible||this.hide(),this.options.wait?this.wait():this.show(),this.$select.on("change",function(){a.trigger("change")}),this.on("change",function(){a.options.onchange&&a.options.onchange(this.value())})},value:function(t){void 0!==t&&(null===t&&(t="__null__"),(this.exists(t)||this.options.multiple)&&(this.$select.val(t),this.$select.select2&&this.$select.select2("val",t)));var e=this._getValue();return this.all_button&&this.all_button.value(s.isArray(e)&&e.length||0,this._size()),e},first:function(){var t=this.$select.find("option").first();return t.length>0?t.val():null},text:function(){return this.$select.find("option:selected").text()},show:function(){this.unwait(),this.$select.show(),this.$el.show()},hide:function(){this.$el.hide()},wait:function(){this.$icon_dropdown.removeClass(),this.$icon_dropdown.addClass("icon-dropdown fa fa-spinner fa-spin")},unwait:function(){this.$icon_dropdown.removeClass(),this.$icon_dropdown.addClass("icon-dropdown fa fa-caret-down")},disabled:function(){return this.$select.is(":disabled")},enable:function(){this.$select.prop("disabled",!1)},disable:function(){this.$select.prop("disabled",!0)},add:function(t,e){r.each(this.model.get("options"),function(e){!r.findWhere(t,e)&&t.push(e)}),e&&t.sort(e),this.update(t)},update:function(t){var e=this._getValue();this.$select.find("option").remove(),!this.options.multiple&&this.options.optional&&this.$select.append(this._templateOption({value:"__null__",label:this.options.empty_text})),this.model.set("options",t);for(var i in t)this.$select.append(this._templateOption(t[i]));0==this._size()?(this.disable(),this.$select.append(this._templateOption({value:"__null__",label:this.options.error_text}))):this.enable(),this.options.searchable&&(this.$select.select2("destroy"),this.$select.select2({closeOnSelect:!this.options.multiple}),this.$(".select2-container .select2-search input").off("blur")),this.value(e),null!==this._getValue()||this.options.multiple&&this.options.optional||this.value(this.first())},setOnChange:function(t){this.options.onchange=t},exists:function(t){return this.$select.find('option[value="'+t+'"]').length>0},_getValue:function(){var e=this.$select.val();return t.validate(e)?e:null},_availableOptions:function(){var t=[];return this.$select.find("option").each(function(e,i){t.push(s(i).attr("value"))}),t},_size:function(){return this.$select.find("option").length},_templateOption:function(t){return'<option value="'+t.value+'">'+r.escape(t.label)+"</option>"},_template:function(t){return'<div id="'+t.id+'" class="'+t.cls+'"><select id="'+t.id+'_select" class="select"/><div class="icon-dropdown"/><div class="icon-resize"><i class="fa fa-angle-double-right fa-rotate-45"/></div></div>'}});return{View:i}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1),i(3))},function(t,e,i){var a,n;(function(o){a=[i(4),i(21)],n=function(t,e){var i=o.View.extend({initialize:function(i){var a=this;this.ftpfile_list=new e.View({name:"file",optional:i.optional,multiple:i.multiple,onchange:function(){i.onchange&&i.onchange(a.value())}}),this.setElement(this.ftpfile_list.$el),t.get({url:Galaxy.root+"api/remote_files",success:function(t){var e=[];for(var i in t)e.push({value:t[i].path,label:t[i].path});a.ftpfile_list.update(e)}})},value:function(t){return this.ftpfile_list.value(t)}});return{View:i}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2))},function(t,e,i){var a,n;(function(o){a=[i(4),i(7),i(14),i(21)],n=function(t,e,i,a){var n=o.Collection.extend({url:Galaxy.root+"api/libraries?deleted=false"}),s=o.Collection.extend({initialize:function(){var t=this;this.config=new o.Model({library_id:null}),this.config.on("change",function(){t.fetch({reset:!0})})},url:function(){return Galaxy.root+"api/libraries/"+this.config.get("library_id")+"/contents"}}),r=o.View.extend({initialize:function(t){var i=this;this.libraries=new n,this.datasets=new s,this.options=t,this.library_select=new e.Select.View({onchange:function(t){i.datasets.config.set("library_id",t)}}),this.dataset_list=new a.View({name:"dataset",optional:t.optional,multiple:t.multiple,onchange:function(){i.trigger("change")}}),this.libraries.on("reset",function(){var t=[];i.libraries.each(function(e){t.push({value:e.id,label:e.get("name")})}),i.library_select.update(t)}),this.datasets.on("reset",function(){var t=[],e=i.library_select.text();null!==e&&i.datasets.each(function(e){"file"===e.get("type")&&t.push({value:e.id,label:e.get("name")})}),i.dataset_list.update(t)}),this.on("change",function(){t.onchange&&t.onchange(i.value())}),this.setElement(this._template()),this.$(".library-select").append(this.library_select.$el),this.$el.append(this.dataset_list.$el),this.libraries.fetch({reset:!0,success:function(){i.library_select.trigger("change"),void 0!==i.options.value&&i.value(i.options.value)}})},value:function(t){return this.dataset_list.value(t)},_template:function(){return'<div class="ui-select-library"><div class="library ui-margin-bottom"><span class="library-title">Select Library</span><span class="library-select"/></div></div>'}});return{View:r}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2))},function(t,e,i){var a,n;(function(o,s){a=[i(4)],n=function(t){var e=o.View.extend({initialize:function(e){var i=this;this.options=t.merge(e,{id:t.uid(),min:null,max:null,step:null,precise:!1,split:1e4}),this.setElement(this._template(this.options)),this.useslider=null!==this.options.max&&null!==this.options.min&&this.options.max>this.options.min,null===this.options.step&&(this.options.step=1,this.options.precise&&this.useslider&&(this.options.step=(this.options.max-this.options.min)/this.options.split)),this.useslider?(this.$slider=this.$("#slider"),this.$slider.slider(this.options),this.$slider.on("slide",function(t,e){i.value(e.value)})):this.$(".ui-form-slider-text").css("width","100%"),this.$text=this.$("#text"),void 0!==this.options.value&&this.value(this.options.value);var a=[];this.$text.on("change",function(){i.value(s(this).val())}),this.$text.on("keyup",function(t){a[t.which]=!1,i.options.onchange&&i.options.onchange(s(this).val())}),this.$text.on("keydown",function(t){var e=t.which;a[e]=!0,i.options.is_workflow&&a[16]&&52==e?(i.value("$"),event.preventDefault()):8==e||9==e||13==e||37==e||39==e||e>=48&&57>=e&&!a[16]||e>=96&&105>=e||(190==e||110==e)&&-1==s(this).val().indexOf(".")&&i.options.precise||(189==e||109==e)&&-1==s(this).val().indexOf("-")||i._isParameter(s(this).val())||a[91]||a[17]||event.preventDefault()})},value:function(t){return void 0!==t&&(null===t||""===t||this._isParameter(t)||(isNaN(t)&&(t=0),null!==this.options.max&&(t=Math.min(t,this.options.max)),null!==this.options.min&&(t=Math.max(t,this.options.min))),this.$slider&&this.$slider.slider("value",t),this.$text.val(t),this.options.onchange&&this.options.onchange(t)),this.$text.val()},_isParameter:function(t){return this.options.is_workflow&&"$"===String(t).substring(0,1)},_template:function(t){return'<div id="'+t.id+'" class="ui-form-slider"><input id="text" type="text" class="ui-form-slider-text"/><div id="slider" class="ui-form-slider-element"/></div>'}});return{View:e}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},,function(t,e,i){var a,n;(function(o,s){a=[i(3),i(17),i(56)],n=function(t,e,i){var a=o.Model.extend({initialize:function(i){var n=this.get("key");this.set("id",n);var o=t.find(a.known_settings_defaults,function(t){return t.key===n});o&&this.set(t.extend({},o,i)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",e.get_random_color()))},set_value:function(t,e){var i=this.get("type");"float"===i?t=parseFloat(t):"int"===i&&(t=parseInt(t,10)),this.set({value:t},e)}},{known_settings_defaults:[{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0}]}),n=o.Collection.extend({model:a,to_key_value_dict:function(){var t={};return this.each(function(e){t[e.get("key")]=e.get("value")}),t},get_value:function(t){var e=this.get(t);return e?e.get("value"):void 0},set_value:function(t,e,i){var a=this.get(t);return a?a.set_value(e,i):void 0},set_default_value:function(t,e){var i=this.get(t);return i?i.set("default_value",e):void 0}},{from_models_and_saved_values:function(e,i){return i&&(e=t.map(e,function(e){return t.extend({},e,{value:i[e.key]})})),new n(e)}}),r=o.View.extend({className:"config-settings-view",render:function(){var i=this.$el;return this.collection.each(function(a,n){if(!a.get("hidden")){var o="param_"+n,r=a.get("type"),l=a.get("value"),h=s("<div class='form-row' />").appendTo(i);if(h.append(s("<label />").attr("for",o).text(a.get("label")+":")),"bool"===r)h.append(s('<input type="checkbox" />').attr("id",o).attr("name",o).attr("checked",l));else if("text"===r)h.append(s('<input type="text"/>').attr("id",o).val(l).click(function(){s(this).select()}));else if("select"===r){var c=s("<select />").attr("id",o);t.each(a.get("options"),function(t){s("<option/>").text(t.label).attr("value",t.value).appendTo(c)}),c.val(l),h.append(c)}else if("color"===r){var d=s("<div/>").appendTo(h),u=s("<input />").attr("id",o).attr("name",o).val(l).css("float","left").appendTo(d).click(function(t){s(".tooltip").removeClass("in");var e=s(this).siblings(".tooltip").addClass("in");e.css({left:s(this).position().left+s(this).width()+5,top:s(this).position().top-s(e).height()/2+s(this).height()/2}).show(),e.click(function(t){t.stopPropagation()}),s(document).bind("click.color-picker",function(){e.hide(),s(document).unbind("click.color-picker")}),t.stopPropagation()}),g=s("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(d).attr("title","Set new random color").tooltip(),p=s("<div class='tooltip right' style='position: absolute;' />").appendTo(d).hide(),_=s("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(p),f=(s("<div class='tooltip-arrow'></div>").appendTo(p),s.farbtastic(_,{width:100,height:100,callback:u,color:l}));d.append(s("<div/>").css("clear","both")),function(t){g.click(function(){t.setColor(e.get_random_color())})}(f)}else h.append(s("<input />").attr("id",o).attr("name",o).val(l));a.help&&h.append(s("<div class='help'/>").text(a.help))}}),this},render_in_modal:function(t){var e=this,i=function(){Galaxy.modal.hide(),s(window).unbind("keypress.check_enter_esc")},a=function(){Galaxy.modal.hide(),s(window).unbind("keypress.check_enter_esc"),e.update_from_form()},n=function(t){27===(t.keyCode||t.which)?i():13===(t.keyCode||t.which)&&a()};s(window).bind("keypress.check_enter_esc",n),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:t||"Configure",body:this.$el,buttons:{Cancel:i,OK:a}})},update_from_form:function(){var t=this;this.collection.each(function(e,i){if(!e.get("hidden")){var a="param_"+i,n=t.$el.find("#"+a).val();"bool"===e.get("type")&&(n=t.$el.find("#"+a).is(":checked")),e.set_value(n)}})}});return{ConfigSetting:a,ConfigSettingCollection:n,ConfigSettingCollectionView:r}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},function(t,e,i){var a,n;(function(o,s){a=[i(4)],n=function(t){return o.Model.extend({initialize:function(){this.active={},this.last=null},execute:function(e){var i=this,a=t.uid(),n=e.length>0;this.active[a]=!0;var o=s.Deferred();o.promise().always(function(){delete i.active[a],n&&Galaxy.emit.debug("deferred::execute()",this.state().charAt(0).toUpperCase()+this.state().slice(1)+" "+a)}),s.when(this.last).always(function(){i.active[a]?(n&&Galaxy.emit.debug("deferred::execute()","Running "+a),e(o),!n&&o.resolve()):o.reject()}),this.last=o.promise()},reset:function(){Galaxy.emit.debug("deferred::execute()","Reset");for(var t in this.active)this.active[t]=!1},ready:function(){return s.isEmptyObject(this.active)}})}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))},,function(t,e,i){var a,n;(function(o,s){a=[i(3),i(11),i(17),i(56)],n=function(t,e,i,a){var n={toJSON:function(){var e=this,i={};return t.each(e.constructor.to_json_keys,function(t){var a=e.get(t);t in e.constructor.to_json_mappers&&(a=e.constructor.to_json_mappers[t](a,e)),i[t]=a}),i}},r=function(t,e,i,a){o.ajax({url:t,data:i,error:function(){alert("Grid failed")},success:function(t){Galaxy.modal.show({title:"Select datasets for new tracks",body:t,buttons:{Cancel:function(){Galaxy.modal.hide()},Add:function(){var t=[];o("input[name=id]:checked,input[name=ldda_ids]:checked").each(function(){var i={data_type:"track_config",hda_ldda:"hda"},a=o(this).val();"id"!==o(this).attr("name")&&(i.hda_ldda="ldda"),t[t.length]=o.ajax({url:e+"/"+a,data:i,dataType:"json"})}),o.when.apply(o,t).then(function(){var t=arguments[0]instanceof Array?o.map(arguments,function(t){return t[0]}):[arguments[0]];a(t)}),Galaxy.modal.hide()}}})}})},l=function(t){this.default_font=void 0!==t?t:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};t.extend(l.prototype,{load_pattern:function(t,e){var i=this.patterns,a=this.dummy_context,n=new Image;n.src=Galaxy.root+"static/images"+e,n.onload=function(){i[t]=a.createPattern(n,"repeat")}},get_pattern:function(t){return this.patterns[t]},new_canvas:function(){var t=o("<canvas/>")[0];return t.manager=this,t}});var h=s.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(t){this.clear()},get_elt:function(e){var i=this.attributes.obj_cache,a=this.attributes.key_ary,n=e.toString(),o=t.indexOf(a,function(t){return t.toString()===n});return-1!==o&&(i[n].stale?(a.splice(o,1),delete i[n]):this.move_key_to_end(e,o)),i[n]},set_elt:function(t,e){var i=this.attributes.obj_cache,a=this.attributes.key_ary,n=t.toString(),o=this.attributes.num_elements;if(!i[n]){if(a.length>=o){var s=a.shift();delete i[s.toString()]}a.push(t)}return i[n]=e,e},move_key_to_end:function(t,e){this.attributes.key_ary.splice(e,1),this.attributes.key_ary.push(t)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),c=h.extend({defaults:t.extend({},h.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(t,e){return!0},can_subset:function(t){return!1}}),initialize:function(t){h.prototype.initialize.call(this);var e=this.get("init_data");e&&this.add_data(e)},add_data:function(e){this.get("num_elements")<e.length&&this.set("num_elements",e.length);var i=this;t.each(e,function(t){i.set_data(t.region,t)})},data_is_ready:function(){var t=this.get("dataset"),e=o.Deferred(),a="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",n=new i.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:t.get("hda_ldda"),data_type:a},dataType:"json"},interval:5e3,success_fn:function(t){return"pending"!==t}});return o.when(n.go()).then(function(t){e.resolve("ok"===t||"data"===t)}),e},search_features:function(t){var e=this.get("dataset"),i={query:t,hda_ldda:e.get("hda_ldda"),data_type:"features"};return o.getJSON(e.url(),i)},load_data:function(t,e,i,a){var n=this.get("dataset"),s={data_type:this.get("data_type"),chrom:t.get("chrom"),low:t.get("start"),high:t.get("end"),mode:e,resolution:i,hda_ldda:n.get("hda_ldda")};o.extend(s,a);var r=this.get("filters_manager");if(r){for(var l=[],h=r.filters,c=0;c<h.length;c++)l.push(h[c].name);s.filter_cols=JSON.stringify(l)}var d=this,u=o.getJSON(n.url(),s,function(e){e.region=t,d.set_data(t,e)});return this.set_data(t,u),u},get_data:function(t,e,a,n){var o=this.get_elt(t);if(o&&(i.is_deferred(o)||this.get("data_mode_compatible")(o,e)))return o;for(var s,r,l=this.get("key_ary"),h=this.get("obj_cache"),c=0;c<l.length;c++)if(s=l[c],s.contains(t)&&(r=!0,o=h[s.toString()],i.is_deferred(o)||this.get("data_mode_compatible")(o,e)&&this.get("can_subset")(o))){if(this.move_key_to_end(s,c),!i.is_deferred(o)){var d=this.subset_entry(o,t);this.set_data(t,d),o=d}return o}if(!r&&t.length()<this.attributes.min_region_size){
t=t.copy();var u=this.most_recently_added();!u||t.get("start")>u.get("start")?t.set("end",t.get("start")+this.attributes.min_region_size):t.set("start",t.get("end")-this.attributes.min_region_size),t.set("genome",this.attributes.genome),t.trim()}return this.load_data(t,e,a,n)},set_data:function(t,e){this.set_elt(t,e)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(t,e,i,a,n){var s=this._mark_stale(t);if(!s||!this.get("data_mode_compatible")(s,e))return void console.log("ERROR: problem with getting more data: current data is not compatible");var r=t.get("start");n===this.DEEP_DATA_REQ?o.extend(a,{start_val:s.data.length+1}):n===this.BROAD_DATA_REQ&&(r=(s.max_high?s.max_high:s.data[s.data.length-1][2])+1);var l=t.copy().set("start",r),h=this,c=this.load_data(l,e,i,a),d=o.Deferred();return this.set_data(t,d),o.when(c).then(function(e){e.data&&(e.data=s.data.concat(e.data),e.max_low&&(e.max_low=s.max_low),e.message&&(e.message=e.message.replace(/[0-9]+/,e.data.length))),h.set_data(t,e),d.resolve(e)}),d},can_get_more_detailed_data:function(t){var e=this.get_elt(t);return"bigwig"===e.dataset_type&&e.data.length<8e3},get_more_detailed_data:function(t,e,i,a,n){var o=this._mark_stale(t);return o?(n||(n={}),"bigwig"===o.dataset_type&&(n.num_samples=1e3*a),this.load_data(t,e,i,n)):void console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(t){var e=this.get_elt(t);return e||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),t.toString()),e.stale=!0,e},get_genome_wide_data:function(e){var i=this,a=!0,n=t.map(e.get("chroms_info").chrom_info,function(t){var e=i.get_elt(new g({chrom:t.chrom,start:0,end:t.len}));return e||(a=!1),e});if(a)return n;var s=o.Deferred();return o.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(t){i.add_data(t.data),s.resolve(t.data)}),s},subset_entry:function(e,i){var a={bigwig:function(e,i){return t.filter(e,function(t){return t[0]>=i.get("start")&&t[0]<=i.get("end")})},refseq:function(t,i){var a=i.get("start")-e.region.get("start");return e.data.slice(a,a+i.length())}},n=e.data;return!e.region.same(i)&&e.dataset_type in a&&(n=a[e.dataset_type](e.data,i)),{region:i,data:n,dataset_type:e.dataset_type}}}),d=c.extend({initialize:function(t){var e=new s.Model;e.urlRoot=t.data_url,this.set("dataset",e)},load_data:function(t,e,i,a){return t.length()<=1e5?c.prototype.load_data.call(this,t,e,i,a):{data:null,region:t}}}),u=s.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(t){this.id=t.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(e){var i=t.find(this.get_chroms_info(),function(t){return t.chrom===e});return new g({chrom:i.chrom,end:i.len})},get_chrom_len:function(e){return t.find(this.get_chroms_info(),function(t){return t.chrom===e}).len}}),g=s.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(t){return this.attributes.chrom===t.get("chrom")&&this.attributes.start===t.get("start")&&this.attributes.end===t.get("end")},initialize:function(t){if(t.from_str){var e=t.from_str.split(":"),i=e[0],a=e[1].split("-");this.set({chrom:i,start:parseInt(a[0],10),end:parseInt(a[1],10)})}this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end"),this.on("change",function(){this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end")},this)},copy:function(){return new g({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(t){var e,i=this.get("chrom"),a=t.get("chrom"),n=this.get("start"),o=t.get("start"),s=this.get("end"),r=t.get("end");return i&&a&&i!==a?g.overlap_results.DIF_CHROMS:e=o>n?o>s?g.overlap_results.BEFORE:r>s?g.overlap_results.OVERLAP_START:g.overlap_results.CONTAINS:n>o?n>r?g.overlap_results.AFTER:r>=s?g.overlap_results.CONTAINED_BY:g.overlap_results.OVERLAP_END:s>=r?g.overlap_results.CONTAINS:g.overlap_results.CONTAINED_BY},trim:function(t){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var e=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>e&&(this.attributes.end=e-1)}return this},contains:function(t){return this.compute_overlap(t)===g.overlap_results.CONTAINS},overlaps:function(e){return 0===t.intersection([this.compute_overlap(e)],[g.overlap_results.DIF_CHROMS,g.overlap_results.BEFORE,g.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),p=s.Collection.extend({model:g}),_=s.Model.extend({defaults:{region:null,note:""},initialize:function(t){this.set("region",new g(t.region))}}),f=s.Collection.extend({model:_}),v=s.Model.extend(n).extend({defaults:{mode:"Auto"},initialize:function(t){this.set("dataset",new e.Dataset(t.dataset));var i=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",a.ConfigSettingCollection.from_models_and_saved_values(i,t.prefs));var n=this.get("preloaded_data");n=n?n.data:[],this.set("data_manager",new c({dataset:this.get("dataset"),init_data:n}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(e,i){return 0===t.size(e)&&(e={name:i.get("config").get("name").get("value"),color:i.get("config").get("color").get("value")}),e},dataset:function(t){return{id:t.id,hda_ldda:t.get("hda_ldda")}}}}),m=s.Collection.extend({model:v}),b=s.Model.extend({defaults:{title:"",type:""},urlRoot:Galaxy.root+"api/visualizations",save:function(){return o.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),w=b.extend(n).extend({defaults:t.extend({},b.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(t){this.set("drawables",new m(t.tracks));var e=[];this.set("config",a.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs)),this.unset("tracks"),this.get("drawables").each(function(t){t.unset("preloaded_data")})},add_tracks:function(t){this.get("drawables").add(t)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(t,e){return{obj_type:"View",prefs:{name:e.get("title"),content_visible:!0},drawables:e.get("drawables")}}}}),y=s.Router.extend({initialize:function(t){this.view=t.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w\+]+\:[\d,]+-[\d,]+)$/,"change_location");var e=this;e.view.on("navigate",function(t){e.navigate(t)})},change_location:function(t){this.view.go_to(t)}});return{BackboneTrack:v,BrowserBookmark:_,BrowserBookmarkCollection:f,Cache:h,CanvasManager:l,Genome:u,GenomeDataManager:c,GenomeRegion:g,GenomeRegionCollection:p,GenomeVisualization:w,GenomeReferenceDataManager:d,TrackBrowserRouter:y,Visualization:b,select_datasets:r}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(1),i(2))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,a){var n,o;(function(s,r){var l=null,h=null;a.e(5,function(t){var e=[t(4),t(96),t(65),t(98),t(64),t(68),t(94),t(66),t(67),t(16)];(function(t,e){t.cssLoadFile("static/style/jquery.rating.css"),t.cssLoadFile("static/style/autocomplete_tagging.css"),t.cssLoadFile("static/style/jquery-ui/smoothness/jquery-ui.css"),t.cssLoadFile("static/style/library.css"),t.cssLoadFile("static/style/trackster.css")}).apply(null,e)}),n=[a(3),a(128),a(59),a(15),a(58)],o=function(t,e,a,n,o){var c=function(){this.initialize&&this.initialize.apply(this,arguments)};c.extend=s.Model.extend;var d=c.extend({initialize:function(t){this.baseURL=t},save_viz:function(){Galaxy.modal.show({title:"Saving...",body:"progress"});var t=[];r(".bookmark").each(function(){t.push({position:r(this).children(".position").text(),annotation:r(this).children(".annotation").text()})});var e=h.overview_drawable?h.overview_drawable.config.get_value("name"):null,i={view:h.to_dict(),viewport:{chrom:h.chrom,start:h.low,end:h.high,overview:e},bookmarks:t};return r.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:h.vis_id,title:h.config.get_value("name"),dbkey:h.dbkey,type:"trackster",vis_json:JSON.stringify(i)}}).success(function(t){Galaxy.modal.hide(),h.vis_id=t.vis_id,h.has_changes=!1,window.history.pushState({},"",t.url+window.location.hash)}).error(function(){Galaxy.modal.show({title:"Could Not Save",body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})},createButtonMenu:function(){var i=this,o=n.create_icon_buttons_menu([{icon_class:"plus-button",title:"Add tracks",on_click:function(){a.select_datasets(Galaxy.root+"visualization/list_current_history_datasets",Galaxy.root+"api/datasets",{"f-dbkey":h.dbkey},function(i){t.each(i,function(t){h.add_drawable(e.object_from_template(t,h,h))})})}},{icon_class:"block--plus",title:"Add group",on_click:function(){h.add_drawable(new e.DrawableGroup(h,h,{name:"New Group"}))}},{icon_class:"bookmarks",title:"Bookmarks",on_click:function(){force_right_panel("0px"==r("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:"Circster",on_click:function(){window.location=i.baseURL+"visualization/circster?id="+h.vis_id}},{icon_class:"disk--arrow",title:"Save",on_click:function(){i.save_viz()}},{icon_class:"cross-circle",title:"Close",on_click:function(){i.handle_unsaved_changes(h)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=o,o},add_bookmarks:function(){var t=this;this.baseURL;Galaxy.modal.show({title:"Select dataset for new bookmarks",body:"progress"}),r.ajax({url:this.baseURL+"/visualization/list_histories",data:{"f-dbkey":h.dbkey},error:function(){alert("Grid failed")},success:function(e){Galaxy.modal.show({title:"Select dataset for new bookmarks",body:e,buttons:{Cancel:function(){Galaxy.modal.hide()},Insert:function(){r("input[name=id]:checked,input[name=ldda_ids]:checked").first().each(function(){var e,a=r(this).val();e="id"===r(this).attr("name")?{hda_id:a}:{ldda_id:a},r.ajax({url:this.baseURL+"/visualization/bookmarks_from_dataset",data:e,dataType:"json"}).then(function(e){for(i=0;i<e.data.length;i++){var a=e.data[i];t.add_bookmark(a[0],a[1])}})}),Galaxy.modal.hide()}}})}})},add_bookmark:function(t,e,i){var a=r("#right .unified-panel-body"),n=r("<div/>").addClass("bookmark").appendTo(a),o=r("<div/>").addClass("position").appendTo(n),s=(r("<a href=''/>").text(t).appendTo(o).click(function(){return h.go_to(t),!1}),r("<div/>").text(e).appendTo(n));if(i){var l=r("<div/>").addClass("delete-icon-container").prependTo(n).click(function(){return n.slideUp("fast"),n.remove(),h.has_changes=!0,!1});r("<a href=''/>").addClass("icon-button delete").appendTo(l);s.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return h.has_changes=!0,n},create_visualization:function(i,a,n,o,s){var l=this,h=new e.TracksterView(t.extend(i,{header:!1}));return h.editor=!0,r.when(h.load_chroms_deferred).then(function(t){if(a){var i=a.chrom,r=a.start,c=a.end,d=a.overview;i&&void 0!==r&&c?h.change_chrom(i,r,c):h.change_chrom(t[0].chrom)}else h.change_chrom(t[0].chrom);if(n)for(var u=0;u<n.length;u++)h.add_drawable(e.object_from_template(n[u],h,h));for(var u=0;u<h.drawables.length;u++)if(h.drawables[u].config.get_value("name")===d){h.set_overview(h.drawables[u]);break}if(o)for(var g,u=0;u<o.length;u++)g=o[u],l.add_bookmark(g.position,g.annotation,s);h.has_changes=!1}),this.set_up_router({view:h}),h},set_up_router:function(t){new a.TrackBrowserRouter(t),s.history.start()},init_keyboard_nav:function(t){r(document).keyup(function(e){if(!r(e.srcElement).is(":input"))switch(e.which){case 37:t.move_fraction(.25);break;case 38:Math.round(t.viewport_container.height()/15);t.viewport_container.scrollTop(t.viewport_container.scrollTop()-20);break;case 39:t.move_fraction(-.25);break;case 40:Math.round(t.viewport_container.height()/15);t.viewport_container.scrollTop(t.viewport_container.scrollTop()+20)}})},handle_unsaved_changes:function(t){if(t.has_changes){var e=this;Galaxy.modal.show({title:"Close visualization",body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){Galaxy.modal.hide()},"Leave without Saving":function(){r(window).off("beforeunload"),window.location=Galaxy.root+"visualization"},Save:function(){r.when(e.save_viz()).then(function(){window.location=Galaxy.root+"visualization"})}}})}else window.location=Galaxy.root+"visualization"}}),u=s.View.extend({initialize:function(){l=new d(Galaxy.root),l.createButtonMenu(),l.buttonMenu.$el.attr("style","float: right"),r("#center .unified-panel-header-inner").append(l.buttonMenu.$el),r("#right .unified-panel-title").append("Bookmarks"),r("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),r("#right-border").click(function(){h.resize_window()}),force_right_panel("hide"),galaxy_config.app.id?this.view_existing():o.get("dataset_id")?this.choose_existing_or_new():this.view_new()},choose_existing_or_new:function(){var t=this,e=o.get("dbkey"),i={},a={dbkey:e,dataset_id:o.get("dataset_id"),hda_ldda:o.get("hda_ldda")};e&&(i["f-dbkey"]=e),r.ajax({url:Galaxy.root+"visualization/list_tracks?"+r.param(i),dataType:"html",error:function(){alert("Could not add this dataset to browser.")},success:function(i){function n(){Galaxy.modal.show({title:"Add Data to Saved Visualization",body:i,buttons:{Cancel:function(){o()},"Add to visualization":function(){r(parent.document).find("input[name=id]:checked").each(function(){var t=r(this).val();a.id=t,window.location=Galaxy.root+"visualization/trackster?"+r.param(a)})}}})}function o(){Galaxy.modal.show({title:"View Data in a New or Saved Visualization?",body:'<p><ul style="list-style: disc inside none">You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>'+e+"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>",buttons:{Cancel:function(){window.location=Galaxy.root+"visualization/list"},"View in saved visualization":function(){n()},"View in new visualization":function(){t.view_new()}}})}console.debug("success"),o()}})},view_existing:function(){var t=galaxy_config.app.viz_config;h=l.create_visualization({container:r("#center .unified-panel-body"),name:t.title,vis_id:t.vis_id,dbkey:t.dbkey},t.viewport,t.tracks,t.bookmarks,!0),this.init_editor()},view_new:function(){var e=this;r.ajax({url:Galaxy.root+"api/genomes?chrom_info=True",data:{},error:function(){alert("Couldn't create new browser.")},success:function(i){Galaxy.modal.show({title:"New Visualization",body:e.template_view_new(i),buttons:{Cancel:function(){window.location=Galaxy.root+"visualization/list"},Create:function(){e.create_browser(r("#new-title").val(),r("#new-dbkey").val()),Galaxy.modal.hide()}}});var a=i.map(function(t){return t[1]});galaxy_config.app.default_dbkey&&t.contains(a,galaxy_config.app.default_dbkey)&&r("#new-dbkey").val(galaxy_config.app.default_dbkey),r("#new-title").focus(),r("select[name='dbkey']").select2(),r("#overlay").css("overflow","auto")}})},template_view_new:function(t){for(var e='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',i=0;i<t.length;i++)e+='<option value="'+t[i][1]+'">'+t[i][0]+"</option>";return e+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'+Galaxy.root+'user/dbkeys?use_panels=True">Add a Custom Build</a></div></form>'},create_browser:function(t,e){r(document).trigger("convert_to_values"),h=l.create_visualization({container:r("#center .unified-panel-body"),name:t,dbkey:e},galaxy_config.app.gene_region),this.init_editor(),h.editor=!0},init_editor:function(){r("#center .unified-panel-title").text(h.config.get_value("name")+" ("+h.dbkey+")"),galaxy_config.app.add_dataset&&r.ajax({url:Galaxy.root+"api/datasets/"+galaxy_config.app.add_dataset,data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(t){h.add_drawable(e.object_from_template(t,h,h))}}),r("#add-bookmark-button").click(function(){var t=h.chrom+":"+h.low+"-"+h.high,e="Bookmark description";return l.add_bookmark(t,e,!0)}),l.init_keyboard_nav(h),r(window).on("beforeunload",function(){return h.has_changes?"There are unsaved changes to your visualization that will be lost if you leave this page.":void 0})}});return{TracksterUI:d,GalaxyApp:u}}.apply(e,n),!(void 0!==o&&(t.exports=o))}).call(e,a(2),a(1))},function(t,e,i){var a,n;(function(o){a=[i(3)],n=function(t){var e=t.extend,i=function(t){this.manager=null,this.name=t.name,this.index=t.index,this.tool_id=t.tool_id,this.tool_exp_name=t.tool_exp_name};e(i.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var a=function(t,e,i){return o("<a/>").attr("href","javascript:void(0);").attr("title",t).addClass("icon-button").addClass(e).tooltip().click(i)},n=function(t){i.call(this,t),this.low="low"in t?t.low:-Number.MAX_VALUE,this.high="high"in t?t.high:Number.MAX_VALUE,this.min="min"in t?t.min:Number.MAX_VALUE,this.max="max"in t?t.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var e=function(t,e,i){t.click(function(){var t=e.text(),a=parseFloat(i.slider("option","max")),n=1>=a?4:1e6>=a?a.toString().length:6,s=!1,r=o(this).parents(".slider-row");r.addClass("input"),i.slider("option","values")&&(n=2*n+1,s=!0),e.text(""),o("<input type='text'/>").attr("size",n).attr("maxlength",n).attr("value",t).appendTo(e).focus().select().click(function(t){t.stopPropagation()}).blur(function(){o(this).remove(),e.text(t),r.removeClass("input")}).keyup(function(t){if(27===t.keyCode)o(this).trigger("blur");else if(13===t.keyCode){var e=i.slider("option","min"),a=i.slider("option","max"),n=function(t){return isNaN(t)||t>a||e>t},l=o(this).val();if(s){if(l=l.split("-"),l=[parseFloat(l[0]),parseFloat(l[1])],n(l[0])||n(l[1]))return alert("Parameter value must be in the range ["+e+"-"+a+"]"),o(this)}else if(l=parseFloat(l),n(l))return alert("Parameter value must be in the range ["+e+"-"+a+"]"),o(this);i.slider(s?"values":"value",l),r.removeClass("input")}})})},n=this;n.parent_div=o("<div/>").addClass("filter-row slider-row");var s=o("<div/>").addClass("elt-label").appendTo(n.parent_div),r=(o("<span/>").addClass("slider-name").text(n.name+"  ").appendTo(s),o("<span/>").text(this.low+"-"+this.high)),l=o("<span/>").addClass("slider-value").appendTo(s).append("[").append(r).append("]");n.values_span=r;var h=o("<div/>").addClass("slider").appendTo(n.parent_div);n.control_element=o("<div/>").attr("id",n.name+"-filter-control").appendTo(h),n.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(t,e){n.slide(t,e)},change:function(t,e){n.control_element.slider("option","slide").call(n.control_element,t,e)}}),n.slider=n.control_element,n.slider_label=r,e(l,r,n.control_element);var c=o("<div/>").addClass("display-controls").appendTo(n.parent_div);this.transparency_icon=a("Use filter for data transparency","layer-transparent",function(){n.manager.alpha_filter!==n?(n.manager.alpha_filter=n,n.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),n.transparency_icon.addClass("active").show()):(n.manager.alpha_filter=null,n.transparency_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(c).hide(),this.height_icon=a("Use filter for data height","arrow-resize-090",function(){n.manager.height_filter!==n?(n.manager.height_filter=n,n.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),n.height_icon.addClass("active").show()):(n.manager.height_filter=null,n.height_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(c).hide(),n.parent_div.hover(function(){n.transparency_icon.show(),n.height_icon.show()},function(){n.manager.alpha_filter!==n&&n.transparency_icon.hide(),n.manager.height_filter!==n&&n.height_icon.hide()}),o("<div style='clear: both;'/>").appendTo(n.parent_div)};e(n.prototype,{to_dict:function(){var t=i.prototype.to_dict.call(this);return e(t,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new n({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(t,e){var i=e-t;return 2>=i?.01:1},slide:function(t,e){var i=e.values;this.values_span.text(i[0]+"-"+i[1]),this.low=i[0],this.high=i[1];var a=this;setTimeout(function(){i[0]===a.low&&i[1]===a.high&&a.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(t){return t.length>this.index},_keep_val:function(t){return isNaN(t)||t>=this.low&&t<=this.high},keep:function(t){if(!this.applies_to(t))return!0;var e=t[this.index];if(e instanceof Array){for(var i=!0,a=0;a<e.length;a++)if(!this._keep_val(e[a])){i=!1;break}return i}return this._keep_val(t[this.index])},update_attrs:function(t){var e=!1;if(!this.applies_to(t))return e;var i=t[this.index];i instanceof Array||(i=[i]);for(var a=0;a<i.length;a++){var n=i[a];n<this.min&&(this.min=Math.floor(n),e=!0),n>this.max&&(this.max=Math.ceil(n),e=!0)}return e},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var t=this.slider.slider("option","min"),e=this.slider.slider("option","max");(this.min<t||this.max>e)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var s=function(t,e){if(this.track=t,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=o("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}),e&&"filters"in e){for(var i,a=("alpha_filter"in e?e.alpha_filter:null),s=("height_filter"in e?e.height_filter:null),r=e.filters,l=0;l<r.length;l++)"number"===r[l].type?(i=new n(r[l]),this.add_filter(i),i.name===a&&(this.alpha_filter=i,i.transparency_icon.addClass("active").show()),i.name===s&&(this.height_filter=i,i.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",name,type);"visible"in e&&e.visible&&this.parent_div.show()}if(0!==this.filters.length){var h=o("<div/>").addClass("param-row").appendTo(this.parent_div),c=o("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(h),d=this;c.click(function(){d.run_on_dataset()})}};return e(s.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var t,e={},i=[],a=0;a<this.filters.length;a++)t=this.filters[a],i.push(t.to_dict());return e.filters=i,e.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,e.height_filter=this.height_filter?this.height_filter.name:null,e.visible=this.parent_div.is(":visible"),e},copy:function(t){for(var e=new s(t),i=0;i<this.filters.length;i++)e.add_filter(this.filters[i].copy());return e},add_filter:function(t){t.manager=this,this.parent_div.append(t.parent_div),this.filters.push(t)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.update_ui_elt()}},clear_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.slider.slider("option","values",[e.min,e.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var t,e,i=(function(t,e,i){return e in t||(t[e]=i),t[e]}),a={},n=0;n<this.filters.length;n++)t=this.filters[n],t.tool_id&&(t.min!==t.low&&(e=i(a,t.tool_id,[]),e[e.length]=t.tool_exp_name+" >= "+t.low),t.max!==t.high&&(e=i(a,t.tool_id,[]),e[e.length]=t.tool_exp_name+" <= "+t.high));var s=[];for(var r in a)s[s.length]=[r,a[r]];!function l(t,e){var i=e[0],a=i[0],n=i[1],s="("+n.join(") and (")+")",r={cond:s,input:t,target_dataset_id:t,tool_id:a};e=e.slice(1),o.getJSON(run_tool_url,r,function(t){t.error?Galaxy.modal.show({title:"Filter Dataset",body:"Error running tool "+a,buttons:{Close:Galaxy.modal.hide()}}):0===e.length?Galaxy.modal.show({title:"Filtering Dataset",body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:Galaxy.modal.hide()}}):l(t.dataset_id,e)})}(this.track.dataset_id,s)}}),{FiltersManager:s,NumberFilter:n}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(1))},function(t,e,i){var a,n;a=[i(3)],n=function(t){var e=1001,i=1002,a=1003,n=1004,o=1005,s=1006,r=function(t,r){var l,h=t[0],c=t[1],d=r[0],u=r[1];return l=d>h?d>=c?e:u>=c?a:i:h>u?s:u>=c?o:n},l=function(t,i){var a=r(t,i);return a!==e&&a!==s},h=function(t,e,i,a,n,o){void 0===o&&(o=4);var s,r=a-e,l=n-i,h=Math.floor(Math.sqrt(r*r+l*l)/o),c=r/h,d=l/h;for(s=0;h>s;s++,e+=c,i+=d)s%2===0&&t.fillRect(e,i,o,1)},c=function(t,e,i,a){var n=e-a/2,o=e+a/2,s=i-Math.sqrt(3*a/2);t.beginPath(),t.moveTo(n,s),t.lineTo(o,s),t.lineTo(e,i),t.lineTo(n,s),t.strokeStyle=this.fillStyle,t.fill(),t.stroke(),t.closePath()},d=function(t){this.default_val=t?t:1};d.prototype.gen_val=function(t){return this.default_val};var u=function(t){this.incomplete_features=t.incomplete_features,this.feature_mapper=t.feature_mapper},g=function(e,i,a,n,o){this.data=e,this.view_start=i,this.view_end=a,this.prefs=t.extend({},this.default_prefs,n),this.mode=o};g.prototype.default_prefs={},g.prototype.draw=function(t,e,i,a){},g.prototype.get_start_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,-.5)},g.prototype.get_end_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,.5)},g.prototype.get_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,0)},g.prototype._chrom_pos_to_draw_pos=function(t,e,i){return Math.floor(e*(Math.max(0,t-this.view_start)+i))};var p=function(e,i,a,n,o){g.call(this,e,i,a,n,o),void 0===this.prefs.min_value&&(this.prefs.min_value=t.min(t.map(this.data,function(t){return t[1]}))||0),void 0===this.prefs.max_value&&(this.prefs.max_value=t.max(t.map(this.data,function(t){return t[1]}))||0)};p.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"},p.prototype.draw=function(t,e,i,a){var n=!1,o=this.prefs.min_value,s=this.prefs.max_value,r=s-o,l=i,h=this.view_start,c=this.mode,d=this.data;t.save();var u=Math.round(i+o/r*i);"Intensity"!==c&&(t.fillStyle="#aaa",t.fillRect(0,u,e,1)),t.beginPath();var g,p,_;_=d.length>1?Math.ceil((d[1][0]-d[0][0])*a):10;for(var f=this.prefs.block_color||this.prefs.color,v=parseInt(f.slice(1),16),m=(16711680&v)>>16,b=(65280&v)>>8,w=255&v,y=!1,x=!1,k=0,C=d.length;C>k;k++)if(t.fillStyle=t.strokeStyle=f,y=x=!1,g=Math.ceil((d[k][0]-h)*a),p=d[k][1],null!==p){if(o>p?(x=!0,p=o):p>s&&(y=!0,p=s),"Histogram"===c)p=Math.round(p/r*l),t.fillRect(g,u,_,-p);else if("Intensity"===c){var T=(p-o)/r,S=Math.round(m+(255-m)*(1-T)),E=Math.round(b+(255-b)*(1-T)),$=Math.round(w+(255-w)*(1-T));t.fillStyle="rgb("+S+","+E+","+$+")",t.fillRect(g,0,_,l)}else p=Math.round(l-(p-o)/r*l),n?t.lineTo(g,p):(n=!0,"Filled"===c?(t.moveTo(g,l),t.lineTo(g,p)):t.moveTo(g,p));if(t.fillStyle=this.prefs.overflow_color,y||x){var R;"Histogram"===c||"Intensity"===c?R=_:(g-=2,R=4),y&&t.fillRect(g,0,R,3),x&&t.fillRect(g,l-3,R,3)}t.fillStyle=f}else n&&"Filled"===c&&t.lineTo(g,l),n=!1;"Filled"===c?(n&&(t.lineTo(g,u),t.lineTo(0,u)),t.fill()):t.stroke(),t.restore()};var _=function(t){this.feature_positions={},this.slot_height=t,this.translation=0,this.y_translation=0};_.prototype.map_feature_data=function(t,e,i,a){this.feature_positions[e]||(this.feature_positions[e]=[]),this.feature_positions[e].push({data:t,x_start:i,x_end:a})},_.prototype.get_feature_data=function(t,e){var i,a=Math.floor((e-this.y_translation)/this.slot_height);if(!this.feature_positions[a])return null;t+=this.translation;for(var n=0;n<this.feature_positions[a].length;n++)if(i=this.feature_positions[a][n],t>=i.x_start&&t<=i.x_end)return i.data};var f=function(t,e,i,a,n,o,s){g.call(this,t,e,i,a,n),this.alpha_scaler=o?o:new d,this.height_scaler=s?s:new d,this.max_label_length=200};f.prototype.default_prefs={block_color:"#FFF",connector_color:"#FFF"},t.extend(f.prototype,{get_required_height:function(t,e){var i=this.get_row_height(),a=i,n=this.mode;return"no_detail"!==n&&"Squish"!==n&&"Pack"!==n||(i=t*a),i+this.get_top_padding(e)},get_top_padding:function(t){return 0},draw:function(t,e,i,a,n){var o=this.data,s=this.view_start,r=this.view_end;t.save(),t.fillStyle=this.prefs.block_color,t.textAlign="right";for(var l,h=this.get_row_height(),c=new _(h),d=[],g=0,p=o.length;p>g;g++){var f=o[g],v=f[0],m=f[1],b=f[2],w=n&&void 0!==n[v]?n[v].slot:null;("Dense"===this.mode||null!==w)&&r>m&&b>s&&(l=this.draw_element(t,this.mode,f,w,s,r,a,h,e),c.map_feature_data(f,w,l[0],l[1]),(s>m||b>r)&&d.push(f))}return t.restore(),c.y_translation=this.get_top_padding(e),new u({incomplete_features:d,feature_mapper:c})},draw_element:function(t,e,i,a,n,o,s,r,l){return[0,0]}});var v=10,m=3,b=5,w=10,y=1,x=9,k=3,C=9,T=2,S="#ccc",E=function(t,e,i,a,n,o,s){f.call(this,t,e,i,a,n,o,s),this.draw_background_connector=!0,this.draw_individual_connectors=!1};t.extend(E.prototype,f.prototype,{get_row_height:function(){var t,e=this.mode;return t="Dense"===e?v:"no_detail"===e?m:"Squish"===e?b:w},draw_element:function(t,e,i,a,n,o,s,r,l){var h,c=(i[0],i[1]),d=i[2],u=i[3],g=i[4],p=Math.floor(Math.max(0,(c-n-.5)*s)),_=Math.ceil(Math.min(l,Math.max(0,(d-n-.5)*s))),f=p,v=_,h=("Dense"===e?0:0+a)*r+this.get_top_padding(l),m=null,b=null,w=g&&"+"!==g&&"."!==g?this.prefs.reverse_strand_color:this.prefs.block_color;if(label_color=this.prefs.label_color,t.globalAlpha=this.alpha_scaler.gen_val(i),"Dense"===e&&(a=1),"no_detail"===e)t.fillStyle=w,t.fillRect(p,h+5,_-p,y);else{var E=i[5],$=i[6],R=i[7],M=!0;E&&$&&(m=Math.floor(Math.max(0,(E-n)*s)),b=Math.ceil(Math.min(l,Math.max(0,($-n)*s))));var z,A;if("Squish"===e?(z=1,A=k,M=!1):"Dense"===e?(z=5,A=x):(z=5,A=C),R){var q,N;"Squish"===e||"Dense"===e?(q=h+Math.floor(k/2)+1,N=1):g?(q=h,N=A):(q+=k/2+1,N=1),this.draw_background_connector&&("Squish"===e||"Dense"===e?t.fillStyle=S:g?"+"===g?t.fillStyle=t.canvas.manager.get_pattern("right_strand"):"-"===g&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand")):t.fillStyle=S,t.fillRect(p,q,_-p,N));for(var V=0,O=R.length;O>V;V++){var G,P,D=R[V],I=Math.floor(Math.max(0,(D[0]-n-.5)*s)),Y=Math.ceil(Math.min(l,Math.max((D[1]-n-.5)*s)));if(!(I>Y)){if(t.fillStyle=w,t.fillRect(I,h+(A-z)/2+1,Y-I,z),void 0!==m&&$>E&&!(I>b||m>Y)){var B=Math.max(I,m),L=Math.min(Y,b);t.fillRect(B,h+1,L-B,A),1===R.length&&"Pack"===e&&("+"===g?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===g&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),L>B+14&&(B+=2,
L-=2),t.fillRect(B,h+1,L-B,A))}this.draw_individual_connectors&&G&&this.draw_connector(t,G,P,I,Y,h),G=I,P=Y}}if("Pack"===e){t.globalAlpha=1,t.fillStyle="white";var j=this.height_scaler.gen_val(i),F=Math.ceil(A*j),H=Math.round((A-F)/2);1!==j&&(t.fillRect(p,q+1,_-p,H),t.fillRect(p,q+A-H+1,_-p,H))}}else t.fillStyle=w,t.fillRect(p,h+1,_-p,A),g&&M&&("+"===g?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===g&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),t.fillRect(p,h+1,_-p,A));t.globalAlpha=1,u&&"Pack"===e&&c>n&&(t.fillStyle=label_color,0===n&&p-t.measureText(u).width<0?(t.textAlign="left",t.fillText(u,_+T,h+8,this.max_label_length),v+=t.measureText(u).width+T):(t.textAlign="right",t.fillText(u,p-T,h+8,this.max_label_length),f-=t.measureText(u).width+T))}return t.globalAlpha=1,[f,v]}});var $=function(t,e,i,a,n,o,s,r,l){f.call(this,t,e,i,a,n,o,s),this.ref_seq=r?r.data:null,this.base_color_fn=l};t.extend($.prototype,f.prototype,{get_row_height:function(){var t,e=this.mode;return"Dense"===e?t=v:"Squish"===e?t=b:(t=w,this.prefs.show_insertions&&(t*=2)),t},_parse_cigar:function(e){var i="MIDNSHP=X",a=[[0,0]],n=a[0],o=0,s=t.map(e.match(/[0-9]+[MIDNSHP=X]/g),function(t){var e=parseInt(t.slice(0,-1),10),s=t.slice(-1);return"N"===s?0!==n[1]&&(n=[o+e,o+e],a.push(n)):-1==="ISHP".indexOf(s)&&(n[1]+=e,o+=e),[i.indexOf(s),e]});return{blocks:a,cigar:s}},draw_read:function(t,e,s,h,d,u,g,p,_,f){var v=function(t,e,i){return-1!=="M=NXD".indexOf(e)&&(t+=i),t},m=function(t,e,i){return-1!=="IX".indexOf(e)&&(t+=i),t},b=function(t){return Math.floor(Math.max(0,(t-d-.5)*s))};t.textAlign="center";var w,y,T=[d,u],E=0,$=0,R=Math.round(s/2),M=t.canvas.manager.char_width_px,z="+"===_?this.prefs.detail_block_color:this.prefs.reverse_strand_color,A="Pack"===e,q=A?C:k,V=h+1,O=new N(t,q,s,e),G=[],P=[],D=this._parse_cigar(p);p=D.cigar,G=D.blocks;for(var I=0;I<G.length;I++){var Y=G[I];l([g+Y[0],g+Y[1]],T)&&(w=b(g+Y[0]),y=b(g+Y[1]),w===y&&(y+=1),t.fillStyle=z,t.fillRect(w,V,y-w,q))}for(var B=0,L=p.length;L>B;B++){var j=p[B],F="MIDNSHP=X"[j[0]],H=j[1],K=g+E;if(w=b(K),y=b(K+H),l([K,K+H],T))switch(w===y&&(y+=1),F){case"H":case"S":case"P":break;case"M":E+=H;break;case"=":case"X":var U="";"X"===F?U=f.slice($,$+H):this.ref_seq&&(U=this.ref_seq.slice(Math.max(0,K-d),Math.min(K-d+H,u-d)));for(var J=Math.max(K,d),X=0;X<U.length;X++)if(U&&!this.prefs.show_differences||"X"===F){var W=Math.floor(Math.max(0,(J+X-d)*s));t.fillStyle=this.base_color_fn(U[X]),A&&s>M?t.fillText(U[X],W,h+9):s>.05&&t.fillRect(W-R,V,Math.max(1,Math.round(s)),q)}"X"===F&&($+=H),E+=H;break;case"N":t.fillStyle=S,t.fillRect(w,V+(q-1)/2,y-w,1),E+=H;break;case"D":O.draw_deletion(w,V,H),E+=H;break;case"I":var Z=w-R;if(l([K,K+H],T)){var Q=f.slice($,$+H);if(this.prefs.show_insertions){var tt=w-(y-w)/2;if(("Pack"===e||"Auto"===this.mode)&&void 0!==f&&s>M){switch(t.fillStyle="yellow",t.fillRect(tt-R,h-9,y-w,9),P[P.length]={type:"triangle",data:[Z,h+4,5]},t.fillStyle=S,r([K,K+H],T)){case a:Q=Q.slice(d-K);break;case n:Q=Q.slice(0,K-u);break;case o:break;case i:Q=Q.slice(d-K,K-u)}for(var X=0,et=Q.length;et>X;X++){var W=Math.floor(Math.max(0,(K+X-d)*s));t.fillText(Q[X],W-(y-w)/2,h)}}else t.fillStyle="yellow",t.fillRect(tt,h+("Dense"!==this.mode?2:5),y-w,"Dense"!==e?k:x)}else("Pack"===e||"Auto"===this.mode)&&void 0!==f&&s>M&&P.push({type:"text",data:[Q.length,Z,h+9]})}$+=H}else E=v(E,F,H),$=m($,F,H)}t.fillStyle="yellow";for(var it,at,nt,I=0;I<P.length;I++)it=P[I],at=it.type,nt=it.data,"text"===at?(t.save(),t.font="bold "+t.font,t.fillText(nt[0],nt[1],nt[2]),t.restore()):"triangle"===at&&c(t,nt[0],nt[1],nt[2])},draw_element:function(t,e,i,a,n,o,s,r,l){var c=(i[0],i[1]),d=i[2],u=i[3],g=Math.floor(Math.max(-.5*s,(c-n-.5)*s)),p=Math.ceil(Math.min(l,Math.max(0,(d-n-.5)*s))),_=("Dense"===e?0:0+a)*r,f="Pack"===e?C:k;this.prefs.label_color;if(i[5]instanceof Array){var v=!0;i[4][1]>=n&&i[4][0]<=o&&i[4][2]?this.draw_read(t,e,s,_,n,o,i[4][0],i[4][2],i[4][3],i[4][4]):v=!1,i[5][1]>=n&&i[5][0]<=o&&i[5][2]?this.draw_read(t,e,s,_,n,o,i[5][0],i[5][2],i[5][3],i[5][4]):v=!1;var m=Math.ceil(Math.min(l,Math.max(-.5*s,(i[4][1]-n-.5)*s))),b=Math.floor(Math.max(-.5*s,(i[5][0]-n-.5)*s));if(v&&b>m){t.fillStyle=S;var w=_+1+(f-1)/2;h(t,m,w,b,w)}}else this.draw_read(t,e,s,_,n,o,c,i[4],i[5],i[6]);return"Pack"===e&&c>=n&&"."!==u&&(t.fillStyle=this.prefs.label_color,0===n&&g-t.measureText(u).width<0?(t.textAlign="left",t.fillText(u,p+T,_+9,this.max_label_length)):(t.textAlign="right",t.fillText(u,g-T,_+9,this.max_label_length))),[0,0]}});var R=function(t,e,i,a,n,o,s){E.call(this,t,e,i,a,n,o,s),this.longest_feature_length=this.calculate_longest_feature_length(),this.draw_background_connector=!1,this.draw_individual_connectors=!0};t.extend(R.prototype,f.prototype,E.prototype,{calculate_longest_feature_length:function(){for(var t=0,e=0,i=this.data.length;i>e;e++){var a=this.data[e],n=a[1],o=a[2];t=Math.max(t,o-n)}return t},get_top_padding:function(t){var e=this.view_end-this.view_start,i=t/e;return Math.min(128,Math.ceil(this.longest_feature_length/2*i))},draw_connector:function(t,e,i,a,n,o){var s=(i+a)/2,r=a-s;Math.PI;r>0&&(t.beginPath(),t.arc(s,o,a-s,Math.PI,0),t.stroke())}});var M=function(t,e){Array.isArray(t)?this.rgb=t:6==t.length?this.rgb=t.match(/.{2}/g).map(function(t){return parseInt(t,16)}):7==t.length?this.rgb=t.substring(1,7).match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=t.split("").map(function(t){return parseInt(t+t,16)}),this.alpha="number"==typeof e?e:1};M.prototype={eval:function(){return this},toCSS:function(){return this.alpha<1?"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(t){return t=Math.round(t),t=(t>255?255:0>t?0:t).toString(16),1===t.length?"0"+t:t}).join("")},toHSL:function(){var t,e,i=this.rgb[0]/255,a=this.rgb[1]/255,n=this.rgb[2]/255,o=this.alpha,s=Math.max(i,a,n),r=Math.min(i,a,n),l=(s+r)/2,h=s-r;if(s===r)t=e=0;else{switch(e=l>.5?h/(2-s-r):h/(s+r),s){case i:t=(a-n)/h+(n>a?6:0);break;case a:t=(n-i)/h+2;break;case n:t=(i-a)/h+4}t/=6}return{h:360*t,s:e,l:l,a:o}},toARGB:function(){var t=[Math.round(255*this.alpha)].concat(this.rgb);return"#"+t.map(function(t){return t=Math.round(t),t=(t>255?255:0>t?0:t).toString(16),1===t.length?"0"+t:t}).join("")},mix:function(t,e){color1=this;var i=e,a=2*i-1,n=color1.toHSL().a-t.toHSL().a,o=((a*n==-1?a:(a+n)/(1+a*n))+1)/2,s=1-o,r=[color1.rgb[0]*o+t.rgb[0]*s,color1.rgb[1]*o+t.rgb[1]*s,color1.rgb[2]*o+t.rgb[2]*s],l=color1.alpha*i+t.alpha*(1-i);return new M(r,l)}};var z=function(t,e,i,a){this.start_color=new M(t),this.end_color=new M(e),this.start_value=i,this.end_value=a,this.value_range=a-i};z.prototype.map_value=function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t=(t-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-t).toCSS()};var A=function(t,e,i,a,n){this.positive_ramp=new z(e,i,0,n),this.negative_ramp=new z(e,t,0,-a),this.start_value=a,this.end_value=n};A.prototype.map_value=function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t>=0?this.positive_ramp.map_value(t):this.negative_ramp.map_value(-t)};var q=function(t,e,i,a,n){g.call(this,t,e,i,a,n);var o,s;if(void 0===this.prefs.min_value){var r=1/0;for(o=0,s=this.data.length;s>o;o++)r=Math.min(r,this.data[o][6]);this.prefs.min_value=r}if(void 0===this.prefs.max_value){var l=-(1/0);for(o=0,s=this.data.length;s>o;o++)l=Math.max(l,this.data[o][6]);this.prefs.max_value=l}};q.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"},q.prototype.draw=function(t,e,i,a){var n,o,s,r,l,h,c=this.prefs.min_value,d=this.prefs.max_value,u=this.view_start,g=(this.mode,this.data),p=1/Math.sqrt(2),_=new A(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,c,d),f=function(t){return(t-u)*a};t.save(),t.rotate(-45*Math.PI/180),t.scale(p,p);for(var v=0,m=g.length;m>v;v++)n=g[v],o=f(n[1]),s=f(n[2]),r=f(n[4]),l=f(n[5]),h=n[6],t.fillStyle=_.map_value(h),t.fillRect(o,r,s-o,l-r);t.restore()};var N=function(t,e,i,a){this.ctx=t,this.row_height=e,this.px_per_base=i,this.draw_details=("Pack"===a||"Auto"===a)&&i>=t.canvas.manager.char_width_px,this.delete_details_thickness=.2};t.extend(N.prototype,{draw_deletion:function(t,e,i){this.ctx.fillStyle="black";var a=(this.draw_details?this.delete_details_thickness:1)*this.row_height;e+=.5*(this.row_height-a),this.ctx.fillRect(t,e,i*this.px_per_base,a)}});var V=function(t,e,i,a,n,o){g.call(this,t,e,i,a,n),this.base_color_fn=o,this.divider_height=1};return t.extend(V.prototype,g.prototype,{get_row_height:function(){var t,e=this.mode;return t="Dense"===e?v:"Squish"===e?b:w},get_required_height:function(t){var e=this.prefs.summary_height;return t>1&&this.prefs.show_sample_data&&(e+=this.divider_height+t*this.get_row_height()),e},draw:function(e,i,a,n){e.save();var o,s,r,l,h,c,d,u,g,p,_,f=function(t,e){var i=t.length,a=e.length,n=0,o=1,s=null;return"-"===e?(s="deletion",o=t.length):0===t.indexOf(e)&&i>a?(s="deletion",o=i-a,n=a):0===e.indexOf(t)&&a>i&&(s="insertion",o=a-i,n=a),null!==s?{type:s,start:n,len:o}:{}},v=Math.max(1,Math.floor(n)),m=this.data.length?this.data[0][7].split(",").length:0,y="Squish"===this.mode?b:w,x=.1>n?y:"Squish"===this.mode?k:C,T=!0,S=new N(e,y,n,this.mode);1===m&&(y=x=n<e.canvas.manager.char_width_px?this.prefs.summary_height:y,S.row_height=y,T=!1),this.prefs.show_sample_data&&T&&(e.fillStyle="#F3F3F3",e.globalAlpha=1,e.fillRect(0,this.prefs.summary_height-this.divider_height,i,this.divider_height)),e.textAlign="center";for(var E=0;E<this.data.length;E++)if(o=this.data[E],s=o[1],r=o[3],l=[o[4].split(",")],h=o[7].split(","),c=o.slice(8),l=t.map(t.flatten(l),function(e){var i={type:"snp",value:e,start:0},a=f(r,e);return t.extend(i,a)}),!(s<this.view_start||s>this.view_end)){if(T)for(e.fillStyle="#999999",e.globalAlpha=1,_=0;_<l.length;_++)for(u=this.get_start_draw_pos(s+l[_].start,n),e.fillRect(u,0,v,this.prefs.summary_height),g=this.prefs.summary_height,_=0;_<l.length;_++)e.fillStyle="deletion"===l[_].type?"black":this.base_color_fn(l[_].value),allele_frac=c/h.length,draw_height=Math.ceil(this.prefs.summary_height*allele_frac),e.fillRect(u,g-draw_height,v,draw_height),g-=draw_height;if(this.prefs.show_sample_data)for(g=T?this.prefs.summary_height+this.divider_height:0,_=0;_<h.length;_++,g+=y)if(p=h[_]?h[_].split(/\/|\|/):["0","0"],d=null,p[0]===p[1]?"."===p[0]||"0"!==p[0]&&(d=l[parseInt(p[0],10)-1],e.globalAlpha=1):(d="0"!==p[0]?p[0]:p[1],d=l[parseInt(d,10)-1],e.globalAlpha=.5),d)if(u=this.get_start_draw_pos(s+d.start,n),"snp"===d.type){var $=d.value;e.fillStyle=this.base_color_fn($),S.draw_details?e.fillText($,this.get_draw_pos(s,n),g+y):e.fillRect(u,g+1,v,x)}else"deletion"===d.type&&S.draw_deletion(u,g+1,d.len)}e.restore()}}),{Scaler:d,LinePainter:p,LinkedFeaturePainter:E,ReadPainter:$,ArcLinkedFeaturePainter:R,DiagonalHeatmapPainter:q,VariantPainter:V}}.apply(e,a),!(void 0!==n&&(t.exports=n))},function(t,e,i){var a,n;a=[i(3)],n=function(t){var e=t.extend,i=2,a=5,n=function(t,e){this.slot=t,this.feature=e},o=function(t,e,i,a){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=i,this.measureText=a};return e(o.prototype,{_get_draw_coords:function(t){var e,n=Math.floor(t[1]*this.w_scale),o=Math.ceil(t[2]*this.w_scale),s=t[3];if(void 0!==s&&this.include_label){var r=this.measureText(s).width+(i+a);n-r>=0?(n-=r,e="left"):(o+=r,e="right")}return[n,o]},_find_slot:function(t){for(var e=t[0],i=t[1],a=0;a<=this.max_rows;a++){var n=!1,o=this.start_end_dct[a];if(void 0!==o)for(var s=0,r=o.length;r>s;s++){var l=o[s];if(i>l[0]&&e<l[1]){n=!0;break}}if(!n)return a}return-1},slot_features:function(t){for(var e,i,a=this.start_end_dct,o=[],s=0,r=0,l=t.length;l>r;r++){e=t[r],i=e[0];var h=this.slots[i];if(h){if(e[1]<h.feature[1]||h.feature[2]<e[2])for(var c=this._get_draw_coords(h.feature),d=this._get_draw_coords(e),u=this.start_end_dct[h.slot],g=0;g<u.length;g++){var p=u[g];p[0]===c[0]&&p[1]===c[1]&&(u[g]=d)}s=Math.max(s,this.slots[i].slot)}else o.push(r)}for(var r=0,l=o.length;l>r;r++){e=t[o[r]],i=e[0];var _=this._get_draw_coords(e),f=this._find_slot(_);f>=0&&(void 0===a[f]&&(a[f]=[]),a[f].push(_),this.slots[i]=new n(f,e),s=Math.max(s,f))}return s+1}}),{FeatureSlotter:o}}.apply(e,a),!(void 0!==n&&(t.exports=n))},function(t,e,i){var a,n;(function(o,s){a=[i(3),i(59),i(129),i(17),i(127),i(126),i(125),i(11),i(46),i(56),i(16)],n=function(t,e,i,a,n,r,l,h,c,d){var u=t.extend,g={},p=function(t,e){g[t.attr("id")]=e},_=function(t,e,i,a){i=".group",g[t.attr("id")]=a,t.bind("drag",{handle:"."+e,relative:!0},function(t,e){var a,n,s,r,l,h=(o(this),o(this).parent()),c=h.children(".track,.group"),d=g[o(this).attr("id")];if(n=o(this).parents(i),0!==n.length){s=n.position().top,r=s+n.outerHeight();var u=g[n.attr("id")];if(e.offsetY<s)return o(this).insertBefore(n),u.remove_drawable(d),void u.container.add_drawable_before(d,u);if(e.offsetY>r)return o(this).insertAfter(n),u.remove_drawable(d),void u.container.add_drawable(d)}for(n=null,l=0;l<c.length;l++)if(a=o(c.get(l)),s=a.position().top,r=s+a.outerHeight(),a.is(i)&&this!==a.get(0)&&e.offsetY>=s&&e.offsetY<=r)return e.offsetY-s<r-e.offsetY?a.find(".content-div").prepend(this):a.find(".content-div").append(this),d.container&&d.container.remove_drawable(d),void g[a.attr("id")].add_drawable(d);for(l=0;l<c.length&&(a=o(c.get(l)),!(e.offsetY<a.position().top)||a.hasClass("reference-track")||a.hasClass("intro"));l++);l===c.length?this!==c.get(l-1)&&(h.append(this),g[h.attr("id")].move_drawable(d,l)):this!==c.get(l)&&(o(this).insertBefore(c.get(l)),g[h.attr("id")].move_drawable(d,e.deltaY>0?l-1:l))}).bind("dragstart",function(){o(this).addClass("dragging")}).bind("dragend",function(){o(this).removeClass("dragging")})},f=20,v=100,m=12e3,b=400,w=5e3,y=100,x="Cannot display dataset due to an error. ",k="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",C="No data for this chrom/contig.",T="Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background.",S="Tool cannot be rerun: ",E="Ready for display",$=10,R=["Histogram","Line","Filled","Intensity"],M=function(t,e,a){if(M.id_counter||(M.id_counter=0),this.id=M.id_counter++,this.view=t,this.container=e,this.drag_handle_class=a.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=d.ConfigSettingCollection.from_models_and_saved_values(this.config_params,a.prefs),this.config.get_value("name")||this.config.set_value("name",a.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,a.header!==!1){var n=new i.TrackHeaderView({model:this,id:this.id});this.header_div=n.$el,this.container_div.append(this.header_div);var o=n.icons_div;this.action_icons=n.action_icons,this.container_div.hover(function(){o.show()},function(){o.hide()})}};M.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(t){t.config.get_value("content_visible")?(t.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),t.hide_contents(),t.config.set_value("content_visible",!1)):(t.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),t.config.set_value("content_visible",!0),t.show_contents())}},{name:"settings_icon",title:"Edit settings",css_class:"gear",on_click_fn:function(t){var e=new d.ConfigSettingCollectionView({collection:t.config});e.render_in_modal("Configure Track")}},{name:"remove_icon",title:"Remove",css_class:"remove-icon",on_click_fn:function(t){o(".tooltip").remove(),t.remove()}}],u(M.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(t){},to_dict:function(){},set_name:function(t){this.old_name=this.config.get_value("name"),this.config.set_value("name",t)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var t=this.view;this.container_div.hide(0,function(){o(this).remove(),t.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var z=function(t,e,i){M.call(this,t,e,i),this.obj_type=i.obj_type,this.drawables=[]};u(z.prototype,M.prototype,{unpack_drawables:function(t){this.drawables=[];for(var e,i=0;i<t.length;i++)e=Z(t[i],this.view,this),this.add_drawable(e)},init:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].init()},_draw:function(t){for(var e=0;e<this.drawables.length;e++)this.drawables[e]._draw(t)},to_dict:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:t}},add_drawable:function(t){this.drawables.push(t),t.container=this,this.changed()},add_drawable_before:function(t,e){this.changed();var i=this.drawables.indexOf(e);return-1!==i?(this.drawables.splice(i,0,t),!0):!1},replace_drawable:function(t,e,i){var a=this.drawables.indexOf(t);return-1!==a&&(this.drawables[a]=e,i&&t.container_div.replaceWith(e.container_div),this.changed()),a},remove_drawable:function(t){var e=this.drawables.indexOf(t);return-1!==e?(this.drawables.splice(e,1),t.container=null,this.changed(),!0):!1},move_drawable:function(t,e){var i=this.drawables.indexOf(t);return-1!==i?(this.drawables.splice(i,1),this.drawables.splice(e,0,t),this.changed(),!0):!1},get_drawables:function(){return this.drawables},get_tracks:function(t){for(var e,i=this.drawables.slice(0),a=[];0!==i.length;)e=i.shift(),e instanceof t?a.push(e):e.drawables&&(i=i.concat(e.drawables));return a}});var A=function(t,e,i){if(u(i,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),z.call(this,t,e,i),this.content_div=o("<div/>").addClass("content-div").attr("id","group_"+this.id+"_content_div").appendTo(this.container_div),p(this.container_div,this),p(this.content_div,this),_(this.container_div,this.drag_handle_class,".group",this),this.filters_manager=new l.FiltersManager(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(o("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in i&&this.unpack_drawables(i.drawables),"filters"in i){var a=this.filters_manager;this.filters_manager=new l.FiltersManager(this,i.filters),a.parent_div.replaceWith(this.filters_manager.parent_div),i.filters.visible&&this.setup_multitrack_filtering()}};u(A.prototype,M.prototype,z.prototype,{action_icons_def:[M.prototype.action_icons_def[0],M.prototype.action_icons_def[1],{name:"composite_icon",title:"Show composite track",css_class:"layers-stack",on_click_fn:function(t){o(".tooltip").remove(),t.show_composite_track()}},{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?(t.filters_manager.clear_filters(),t._restore_filter_managers()):(t.setup_multitrack_filtering(),t.request_draw({clear_tile_cache:!0})),t.filters_manager.toggle()}},M.prototype.action_icons_def[2]],build_container_div:function(){var t=o("<div/>").addClass("group").attr("id","group_"+this.id);return this.container&&this.container.content_div.append(t),t},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var t=this.drawables.length;if(0===t)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===t)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof j),this.action_icons.filters_icon.hide();else{var e,i,a,n=!0,s=this.drawables[0].get_type(),r=0;for(e=0;t>e;e++){if(a=this.drawables[e],a.get_type()!==s){can_composite=!1;break}a instanceof U&&r++}if(n&&this.drawables[0]instanceof H?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),o(".tooltip").remove()),r>1&&r===this.drawables.length){var h,c={};for(a=this.drawables[0],i=0;i<a.filters_manager.filters.length;i++)h=a.filters_manager.filters[i],c[h.name]=[h];for(e=1;e<this.drawables.length;e++)for(a=this.drawables[e],i=0;i<a.filters_manager.filters.length;i++)h=a.filters_manager.filters[i],h.name in c&&c[h.name].push(h);this.filters_manager.remove_all();var d,u;for(var g in c)d=c[g],d.length===r&&(u=new l.NumberFilter({name:d[0].name,index:d[0].index}),this.filters_manager.add_filter(u));this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].filters_manager=this.saved_filters_managers[t];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var t=0;t<this.drawables.length;t++)drawable=this.drawables[t],this.saved_filters_managers.push(drawable.filters_manager),drawable.filters_manager=this.filters_manager}this.filters_manager.init_filters()},show_composite_track:function(){var t=new j(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,t,!0);t.request_draw()},add_drawable:function(t){z.prototype.add_drawable.call(this,t),this.update_icons()},remove_drawable:function(t){z.prototype.remove_drawable.call(this,t),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var t=u(z.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),t},request_draw:function(e){t.each(this.drawables,function(t){t.request_draw(e)})}});var q=s.View.extend({initialize:function(t){u(t,{obj_type:"View"}),z.call(this,"View",t.container,t),this.chrom=null,this.vis_id=t.vis_id,this.dbkey=t.dbkey,this.stand_alone=void 0!==t.stand_alone?t.stand_alone:!0,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new e.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=d.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:t.name})},render:function(){this.requested_redraw=!1;var i=this.container,a=this;this.top_container=o("<div/>").addClass("top-container").appendTo(i),this.browser_content_div=o("<div/>").addClass("content").appendTo(i),this.bottom_container=o("<div/>").addClass("bottom-container").appendTo(i),this.top_labeltrack=o("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=o("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,p(this.viewport_container,a),this.intro_div=o("<div/>").addClass("intro").appendTo(this.viewport_container);o("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){e.select_datasets(Galaxy.root+"visualization/list_current_history_datasets",Galaxy.root+"api/datasets",{"f-dbkey":a.dbkey},function(e){t.each(e,function(t){a.add_drawable(Z(t,a,a))})})});this.nav_container=o("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=o("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=o("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=o("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=o("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=o("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=o("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=o("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=o("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=o("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);var n=function(t){"focusout"!==t.type&&13!==(t.keyCode||t.which)&&27!==(t.keyCode||t.which)||(27!==(t.keyCode||t.which)&&a.go_to(o(this).val()),o(this).hide(),o(this).val(""),a.location_span.show(),a.chrom_select.show()),t.stopPropagation()};this.nav_input=o("<input/>").addClass("nav-input").hide().bind("keyup focusout",n).appendTo(this.nav_controls),this.location_span=o("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){a.location_span.hide(),a.chrom_select.hide(),a.nav_input.val(a.chrom+":"+a.low+"-"+a.high),a.nav_input.css("display","inline-block"),a.nav_input.select(),a.nav_input.focus(),a.nav_input.autocomplete({source:function(t,e){var i=[],n=o.map(a.get_tracks(U),function(e){return e.data_manager.search_features(t.term).success(function(t){i=i.concat(t)})});o.when.apply(o,n).done(function(){e(o.map(i,function(t){return{label:t[0],value:t[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=o("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=o("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){a.zoom_out()}).appendTo(this.nav_controls),this.zi_link=o("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){a.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){a.change_chrom(a.chrom_select.val())}),this.browser_content_div.click(function(t){o(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(t){a.zoom_in(t.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(t,e){this.current_x=e.offsetX}).bind("drag",function(t,e){var i=e.offsetX-this.current_x;this.current_x=e.offsetX;var n=Math.round(i/a.viewport_container.width()*(a.max_high-a.max_low));a.move_delta(-n)}),this.overview_close.click(function(){a.reset_overview()}),this.viewport_container.bind("draginit",function(t,e){return t.clientX>a.viewport_container.width()-16?!1:void 0}).bind("dragstart",function(t,e){e.original_low=a.low,e.current_height=t.clientY,e.current_x=e.offsetX}).bind("drag",function(t,e){var i=o(this),n=e.offsetX-e.current_x,s=i.scrollTop()-(t.clientY-e.current_height);i.scrollTop(s),e.current_height=t.clientY,e.current_x=e.offsetX;var r=Math.round(n/a.viewport_container.width()*(a.high-a.low));a.move_delta(r)}),this.top_labeltrack.bind("dragstart",function(t,e){return o("<div/>").addClass("zoom-area").css("height",a.browser_content_div.height()+a.top_labeltrack.height()+1).appendTo(o(this))}).bind("drag",function(t,e){o(e.proxy).css({left:Math.min(t.pageX,e.startX)-a.container.offset().left,width:Math.abs(t.pageX-e.startX)});var i=Math.min(t.pageX,e.startX)-a.container.offset().left,n=Math.max(t.pageX,e.startX)-a.container.offset().left,s=a.high-a.low,r=a.viewport_container.width();a.update_location(Math.round(i/r*s)+a.low,Math.round(n/r*s)+a.low)}).bind("dragend",function(t,e){var i=Math.min(t.pageX,e.startX),n=Math.max(t.pageX,e.startX),s=a.high-a.low,r=a.viewport_container.width(),l=a.low;a.low=Math.round(i/r*s)+l,a.high=Math.round(n/r*s)+l,o(e.proxy).remove(),a.request_redraw()}),this.add_label_track(new L(this,{content_div:this.top_labeltrack})),o(window).bind("resize",function(){this.resize_timer&&clearTimeout(this.resize_timer),this.resize_timer=setTimeout(function(){a.resize_window()},500)}),o(document).bind("redraw",function(){a.redraw()}),this.reset(),o(window).trigger("resize")},get_base_color:function(t){return this.config.get_value(t.toLowerCase()+"_color")||this.config.get_value("n_color")}});u(q.prototype,z.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(t,e,i,a){if(this.timer&&clearTimeout(this.timer),a){var n=this;this.timer=setTimeout(function(){n.trigger("navigate",t+":"+e+"-"+i)},500)}else view.trigger("navigate",t+":"+e+"-"+i)},update_location:function(t,e){this.location_span.text(a.commatize(t)+" - "+a.commatize(e)),this.nav_input.val(this.chrom+":"+a.commatize(t)+"-"+a.commatize(e));var i=this.chrom_select.val();""!==i&&this.trigger_navigate(i,this.low,this.high,!0)},load_chroms:function(t){t.num=y;var e=this,i=o.Deferred();return o.ajax({url:Galaxy.root+"api/genomes/"+this.dbkey,data:t,dataType:"json",success:function(t){if(0!==t.chrom_info.length){if(t.reference){var a=new F(e);e.add_label_track(a),e.reference_track=a}e.chrom_data=t.chrom_info;for(var n='<option value="">Select Chrom/Contig</option>',o=0,s=e.chrom_data.length;s>o;o++){var r=e.chrom_data[o].chrom;n+='<option value="'+r+'">'+r+"</option>"}t.prev_chroms&&(n+='<option value="previous">Previous '+y+"</option>"),t.next_chroms&&(n+='<option value="next">Next '+y+"</option>"),e.chrom_select.html(n),e.chrom_start_index=t.start_index,i.resolve(t.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: "+e.dbkey)}}),i},change_chrom:function(t,e,i){var a=this;if(!a.chrom_data)return void a.load_chroms_deferred.then(function(){a.change_chrom(t,e,i)});if(t&&"None"!==t){if("previous"===t)return void a.load_chroms({low:this.chrom_start_index-y});if("next"===t)return void a.load_chroms({low:this.chrom_start_index+y});var n=o.grep(a.chrom_data,function(e,i){return e.chrom===t})[0];if(void 0===n)return void a.load_chroms({chrom:t},function(){a.change_chrom(t,e,i)});if(t!==a.chrom){a.chrom=t,a.chrom_select.val(a.chrom),a.max_high=n.len-1,a.reset();for(var s=0,r=a.drawables.length;r>s;s++){var l=a.drawables[s];l.init&&l.init()}a.reference_track&&a.reference_track.init()}void 0===e&&void 0===i?(a.low=0,a.high=a.max_high):(a.low=void 0!==e?Math.max(e,0):0,void 0===i?(a.low=Math.max(a.low-15,0),a.high=a.low+30):a.high=Math.min(i,a.max_high)),a.request_redraw()}},go_to:function(t){t=t.replace(/,/g,""),t=t.replace(/:|\-/g," ");var e=t.split(/\s+/),i=e[0],a=e[1]?parseInt(e[1],10):void 0,n=e[2]?parseInt(e[2],10):void 0;this.change_chrom(i,a,n)},move_fraction:function(t){var e=this,i=e.high-e.low;this.move_delta(t*i)},move_delta:function(t){var e=this,i=e.high-e.low;e.low-t<e.max_low?(e.low=e.max_low,e.high=e.max_low+i):e.high-t>e.max_high?(e.high=e.max_high,e.low=e.max_high-i):(e.high-=t,e.low-=t),e.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=setTimeout(function(){e.request_redraw()},200);var a=e.chrom_select.val();this.trigger_navigate(a,e.low,e.high,!0)},add_drawable:function(t){z.prototype.add_drawable.call(this,t),t.init(),this.changed(),this.update_intro_div();var e=this;t.config.on("change",function(){
e.changed()})},add_label_track:function(t){t.view=this,t.init(),this.label_tracks.push(t)},remove_drawable:function(t,e){if(z.prototype.remove_drawable.call(this,t),e){var i=this;t.container_div.hide(0,function(){o(this).remove(),i.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(e,i){var a=this,n=i?[i]:a.drawables;t.each(n,function(i){var n=t.find(a.tracks_to_be_redrawn,function(t){return t[0]===i});n?n[1]=e:a.tracks_to_be_redrawn.push([i,e])}),this.requested_redraw||(requestAnimationFrame(function(){a._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var e=this.low,i=this.high;e<this.max_low&&(e=this.max_low),i>this.max_high&&(i=this.max_high);var a=this.high-this.low;0!==this.high&&a<this.min_separation&&(i=e+this.min_separation),this.low=Math.floor(e),this.high=Math.ceil(i),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var n=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,o=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0,s=13;this.overview_box.css({left:n,width:Math.max(s,o)}).show(),s>o&&this.overview_box.css("left",n-(s-o)/2),this.overview_highlight&&this.overview_highlight.css({left:n,width:o}),t.each(this.tracks_to_be_redrawn,function(t){var e=t[0],i=t[1];e&&e._draw(i)}),this.tracks_to_be_redrawn=[],t.each(this.label_tracks,function(t){t._draw()})},zoom_in:function(t,e){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var i=this.high-this.low,a=i/2+this.low,n=i/this.zoom_factor/2;t&&(a=t/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(a-n),this.high=Math.round(a+n),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var t=this.high-this.low,e=t/2+this.low,i=t*this.zoom_factor/2;this.low=Math.round(e-i),this.high=Math.round(e+i),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(t){if(this.overview_drawable){if(this.overview_drawable.dataset.id===t.dataset.id)return;this.overview_viewport.find(".track").remove()}var e=t.copy({content_div:this.overview_viewport}),i=this;e.header_div.hide(),e.is_overview=!0,i.overview_drawable=e,this.overview_drawable.postdraw_actions=function(){i.overview_highlight.show().height(i.overview_drawable.content_div.height()),i.overview_viewport.height(i.overview_drawable.content_div.height()+i.overview_box.outerHeight()),i.overview_close.show(),i.resize_window()},i.overview_drawable.request_draw(),this.changed()},reset_overview:function(){o(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),view.resize_window(),view.overview_drawable=null}});var N=c.Tool.extend({defaults:{track:null},initialize:function(t){c.Tool.prototype.initialize.call(this,t);var e=!0;void 0!==t.tool_state&&void 0!==t.tool_state.hidden&&(e=t.tool_state.hidden),this.set("hidden",e),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(e){return t.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),V=s.View.extend({events:{"change :input":"update_value"},render:function(){var t=this.$el.addClass("param-row"),e=this.model,i=(o("<div>").addClass("param-label").text(e.get("label")).appendTo(t),o("<div/>").addClass("param-input").html(e.get("html")).appendTo(t));i.find(":input").val(e.get("value")),o("<div style='clear: both;'/>").appendTo(t)},update_value:function(t){this.model.set_value(o(t.target).val())}}),O=s.View.extend({initialize:function(t){this.model.on("change:hidden",this.set_visible,this)},render:function(){var t=this;tool=this.model,parent_div=this.$el.addClass("dynamic-tool").hide(),parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).keydown(function(t){t.stopPropagation()});o("<div class='tool-name'>").appendTo(parent_div).text(tool.get("name"));tool.get("inputs").each(function(t){var e=new V({model:t});e.render(),parent_div.append(e.$el)}),parent_div.find("input").click(function(){o(this).select()});var e=o("<div>").addClass("param-row").appendTo(parent_div),i=o("<input type='submit'>").attr("value","Run on complete dataset").appendTo(e),a=o("<input type='submit'>").attr("value","Run on visible region").appendTo(e);a.click(function(){t.run_on_region()}),i.click(function(){t.run_on_dataset()}),tool.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var t=0;t<this.params.length;t++)this.params[t].update_value()},run_on_dataset:function(){var t=this.model;this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:t.id},null,function(e){Galaxy.modal.show({title:t.get("name")+" is Running",body:t.get("name")+" is running on the complete dataset. Tool outputs are in dataset's history.",buttons:{Close:function(){Galaxy.modal.hide()}}})})},run_on_region:function(){var t,i=this.model.get("track"),a=this.model,n=new e.GenomeRegion({chrom:i.view.chrom,start:i.view.low,end:i.view.high}),o={target_dataset_id:i.dataset.id,action:"rerun",tool_id:a.id,regions:[n.toJSON()]},s=i,r=a.get("name")+s.tool_region_and_parameters_str(n);if(s.container===view){var l=new A(view,view,{name:i.config.get_value("name")}),c=s.container.replace_drawable(s,l,!1);l.container_div.insertBefore(s.view.content_div.children()[c]),l.add_drawable(s),s.container_div.appendTo(l.content_div),t=l}else t=s.container;var d=new s.constructor(view,t,{name:r,hda_ldda:"hda"});d.init_for_tool_data(),d.change_mode(s.mode),d.set_filters_manager(s.filters_manager.copy(d)),d.update_icons(),t.add_drawable(d),d.tiles_div.text("Starting job."),this.run(o,d,function(t){d.set_dataset(new h.Dataset(t)),d.tiles_div.text("Running job."),d.init()})},run:function(t,e,i){t.inputs=this.model.get_inputs_dict();var n=new a.ServerStateDeferred({ajax_settings:{url:Galaxy.root+"api/tools",data:JSON.stringify(t),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});o.when(n.go()).then(function(t){"no converter"===t?(e.container_div.addClass("error"),e.content_div.text(k)):t.error?(e.container_div.addClass("error"),e.content_div.text(S+t.message)):i(t)})}}),G=function(t,e){r.Scaler.call(this,e),this.filter=t};G.prototype.gen_val=function(t){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(t[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var P=function(t,e,i,a,n){this.track=t,this.region=e,this.low=e.get("start"),this.high=e.get("end"),this.w_scale=i,this.canvas=a,this.html_elt=o("<div class='track-tile'/>").append(a),this.data=n,this.stale=!1};P.prototype.predisplay_actions=function(){};var D=function(t,e,i,a,n){P.call(this,t,e,i,a,n)};D.prototype.predisplay_actions=function(){};var I=function(t,e,i,a,n,o,s,r,l,h,c){P.call(this,t,e,i,a,n),this.mode=o,this.all_slotted=r,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=h,this.other_tiles_features_drawn={},this.seq_data=c};u(I.prototype,P.prototype),I.prototype.predisplay_actions=function(){};var Y=function(t,i,a){u(a,{drag_handle_class:"draghandle"}),M.call(this,t,i,a),this.dataset=null,a.dataset&&(this.dataset=a.dataset instanceof s.Model?a.dataset:new h.Dataset(a.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in a?a.data_query_wait:w,this.data_manager="data_manager"in a?a.data_manager:new e.GenomeDataManager({dataset:this.dataset,genome:new e.Genome({key:t.dbkey,chroms_info:{chrom_info:t.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=o("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in a&&!a.resize||this.add_resize_handle())};u(Y.prototype,M.prototype,{action_icons_def:[{name:"mode_icon",title:"Set display mode",css_class:"chevron-expand",on_click_fn:function(){}},M.prototype.action_icons_def[0],{name:"overview_icon",title:"Set as overview",css_class:"application-dock-270",on_click_fn:function(t){t.view.set_overview(t)}},M.prototype.action_icons_def[1],{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?t.filters_manager.clear_filters():t.filters_manager.init_filters(),t.filters_manager.toggle()}},{name:"tools_icon",title:"Tool",css_class:"hammer",on_click_fn:function(t){t.tool.toggle(),t.tool.is_visible()?t.set_name(t.config.get_value("name")+t.tool_region_and_parameters_str()):t.revert_name(),o(".tooltip").remove()}},{name:"param_space_viz_icon",title:"Tool parameter space visualization",css_class:"arrow-split",on_click_fn:function(i){var a="<strong>Tool</strong>:"+i.tool.get("name")+"<br/><strong>Dataset</strong>:"+i.config.get_value("name")+'<br/><strong>Region(s)</strong>: <select name="regions"><option value="cur">current viewing area</option><option value="bookmarks">bookmarks</option><option value="both">current viewing area and bookmarks</option></select>',n=function(){Galaxy.modal.hide(),o(window).unbind("keypress.check_enter_esc")},r=function(){var a,n=o('select[name="regions"] option:selected').val(),r=new e.GenomeRegion({chrom:view.chrom,start:view.low,end:view.high}),l=t.map(o(".bookmark"),function(t){return new e.GenomeRegion({from_str:o(t).children(".position").text()})});a="cur"===n?[r]:"bookmarks"===n?l:[r].concat(l),Galaxy.modal.hide(),window.location.href=Galaxy.root+"visualization/sweepster?"+o.param({dataset_id:i.dataset.id,hda_ldda:i.dataset.get("hda_ldda"),regions:JSON.stringify(new s.Collection(a).toJSON())})};Galaxy.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:a,buttons:{No:n,Yes:r}})}},M.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&M.prototype.can_draw.call(this)},build_container_div:function(){return o("<div/>").addClass("track").attr("id","track_"+this.id)},set_dataset:function(t){this.dataset=t,this.data_manager.set("dataset",t)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var t=this,e=!1,i=!1,a=o("<div class='track-resize'>");o(t.container_div).hover(function(){t.config.get_value("content_visible")&&(e=!0,a.show())},function(){e=!1,i||a.hide()}),a.hide().bind("dragstart",function(e,a){i=!0,a.original_height=o(t.content_div).height()}).bind("drag",function(e,i){var a=Math.min(Math.max(i.original_height+i.deltaY,t.min_height_px),t.max_height_px);o(t.tiles_div).css("height",a),t.visible_height_px=t.max_height_px===a?0:a,t.on_resize()}).bind("dragend",function(n,o){t.tile_cache.clear(),i=!1,e||a.hide(),t.config.set_value("height",t.visible_height_px),t.changed()}).appendTo(t.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof L?"LabelTrack":this instanceof F?"ReferenceTrack":this instanceof H?"LineTrack":this instanceof X?"ReadTrack":this instanceof J?"VariantTrack":this instanceof j?"CompositeTrack":this instanceof U?"FeatureTrack":""},show_message:function(t){return this.tiles_div.remove(),o("<span/>").addClass("message").html(t).appendTo(this.content_div)},init:function(t){var e=this;if(e.enabled=!1,e.tile_cache.clear(),e.data_manager.clear(),e.content_div.children().remove(),e.container_div.removeClass("nodata error pending"),e.tiles_div=o("<div/>").addClass("tiles").appendTo(e.content_div),e.dataset.id){var i=o.Deferred(),a={hda_ldda:e.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:e.view.chrom,retry:t};return o.getJSON(this.dataset.url(),a,function(t){if(t&&"error"!==t&&"error"!==t.kind)"no converter"===t?(e.container_div.addClass("error"),e.show_message(k)):"no data"===t||void 0!==t.data&&(null===t.data||0===t.data.length)?(e.container_div.addClass("nodata"),e.show_message(C)):"pending"===t?(e.container_div.addClass("pending"),e.show_message(T),setTimeout(function(){e.init()},e.data_query_wait)):"data"!==t&&"data"!==t.status||(t.valid_chroms&&(e.valid_chroms=t.valid_chroms,e.update_icons()),e.tiles_div.text(E),e.view.chrom?(e.tiles_div.text(""),e.tiles_div.css("height",e.visible_height_px+"px"),e.enabled=!0,o.when.apply(o,e.predraw_init()).done(function(){i.resolve(),e.container_div.removeClass("nodata error pending"),e.request_draw()})):i.resolve());else{e.container_div.addClass("error");var a=e.show_message(x);t.message&&(a.append(o("<a href='javascript:void(0);'></a>").text("View error").click(function(){Galaxy.modal.show({title:"Trackster Error",body:"<pre>"+t.message+"</pre>",buttons:{Close:function(){Galaxy.modal.hide()}}})})),a.append(o("<span/>").text(" ")),a.append(o("<a href='javascript:void(0);'></a>").text("Try again").click(function(){e.init(!0)})))}}),this.update_icons(),i}},predraw_init:function(){var t=this;return o.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){var i=e.data;if(void 0!==i&&void 0!==i.min&&void 0!==i.max){var a=i.min,n=i.max;a=Math.floor(Math.min(0,Math.max(a,i.mean-2*i.sd))),n=Math.ceil(Math.max(0,Math.min(n,i.mean+2*i.sd))),t.config.set_default_value("min_value",a),t.config.set_default_value("max_value",n),t.config.set_value("min_value",a),t.config.set_value("max_value",n)}})},get_drawables:function(){return this}});var B=function(i,a,n){Y.call(this,i,a,n);var s=this;if(_(s.container_div,s.drag_handle_class,".group",s),this.filters_manager=new l.FiltersManager(this,"filters"in n?n.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=n.tool?new N(t.extend(n.tool,{track:this,tool_state:n.tool_state})):null,this.tile_cache=new e.Cache($),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var r=new O({model:this.tool});r.render(),this.dynamic_tool_div=r.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=o("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=o("<div/>").addClass("overlay").appendTo(this.content_div),n.mode&&this.change_mode(n.mode)};u(B.prototype,M.prototype,Y.prototype,{action_icons_def:Y.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(t){o(".tooltip").remove(),t.slotters[t.view.resolution_px_b].max_rows*=2,t.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(t){var e=this.to_dict();u(e,{data_manager:this.data_manager});var i=new this.constructor(this.view,t,e);return i.change_mode(this.mode),i.enabled=this.enabled,i},set_filters_manager:function(t){this.filters_manager=t,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var t=this;return o.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){var i=e.data;if(isNaN(parseFloat(t.config.get_value("min_value")))||isNaN(parseFloat(t.config.get_value("max_value")))){var a=i.min,n=i.max;a=Math.floor(Math.min(0,Math.max(a,i.mean-2*i.sd))),n=Math.ceil(Math.max(0,Math.min(n,i.mean+2*i.sd))),t.config.set_value("min_value",a),t.config.set_value("max_value",n)}})},change_mode:function(t){var e=this;return e.mode=t,e.config.set_value("mode",t),"Auto"===t&&this.data_manager.clear(),e.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: "+e.mode+")"),e},update_icons:function(){var t=this;t.action_icons.filters_icon.toggle(t.filters_available),t.action_icons.tools_icon.toggle(null!==t.tool),t.action_icons.param_space_viz_icon.toggle(null!==t.tool)},_gen_tile_cache_key:function(t,e){return t+"_"+e},request_draw:function(t){t&&t.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(t,this)},before_draw:function(){this.max_height_px=0},_draw:function(i){if(this.can_draw()){var a=i&&i.clear_after,n=this.view.low,s=this.view.high,r=this.view.container.width(),l=this.view.resolution_px_b,h=1/l;this.is_overview&&(n=this.view.max_low,s=this.view.max_high,l=r/(view.max_high-view.max_low),h=1/l),this.before_draw(),this.tiles_div.children().addClass("remove");for(var c,d,u=Math.floor(b*h),g=Math.floor(n/u),p=[],_=[];s>g*u;)c=new e.GenomeRegion({chrom:this.view.chrom,start:g*u,end:Math.min((g+1)*u,this.view.max_high)}),d=this.draw_helper(c,l,i),p.push(d),o.when(d).then(function(t){_.push(t)}),g+=1;a||this.tiles_div.children(".remove").removeClass("remove").remove();var f=this;o.when.apply(o,p).then(function(){f.tiles_div.children(".remove").remove(),_=t.filter(_,function(t){return null!==t}),0!==_.length&&f.postdraw_actions(_,r,l,a)})}},_add_yaxis_label:function(t,e){var i=this,a="max"===t?"top":"bottom",n="max"===t?"max":"min",s="max"===t?"max_value":"min_value",r=this.container_div.find(".yaxislabel."+a);e=e||function(){i.request_draw({clear_tile_cache:!0})},0!==r.length?r.text(i.config.get_value(s)):(r=o("<div/>").text(i.config.get_value(s)).make_text_editable({num_cols:12,on_finish:function(t){o(".tooltip").remove(),i.config.set_value(s,t),e()},help_text:"Set "+n+" value"}).addClass("yaxislabel "+a).css("color",this.config.get_value("label_color")),this.container_div.prepend(r))},postdraw_actions:function(e,i,a,n){var o=t.filter(e,function(t){return t instanceof D});if(o.length>0){this.max_height_px=0;var s=this;t.each(e,function(t){t instanceof D||(t.html_elt.remove(),s.draw_helper(t.region,a,{force:!0,mode:"Coverage"}))}),s._add_yaxis_label("max")}else{this.container_div.find(".yaxislabel").remove();var r=t.find(e,function(t){return t.has_icons});r&&t.each(e,function(t){t.has_icons||t.html_elt.css("padding-top",f)})}},get_mode:function(t){return this.mode},update_auto_mode:function(t){},_get_drawables:function(){return[this]},draw_helper:function(e,i,n){n||(n={});var s=n.force,r=n.mode||this.mode,l=1/i,h=this,c=this._get_drawables(),d=this._gen_tile_cache_key(i,e),u=function(t){return t&&"track"in t},g=s?void 0:h.tile_cache.get_elt(d);if(g)return u(g)&&h.show_tile(g,i),g;if(n.data_fetch===!1)return null;var p=function(){var i=t.find(R,function(t){return t===r})?"Coverage":r,a=t.map(c,function(t){return t.data_manager.get_data(e,i,l,h.data_url_extra_params)});return view.reference_track&&a.push(view.reference_track.data_manager.get_data(e,r,l,view.reference_track.data_url_extra_params)),a},_=o.Deferred();return h.tile_cache.set_elt(d,_),o.when.apply(o,p()).then(function(){var s,r=p(),l=r;if(t.find(r,function(t){return a.is_deferred(t)}))return h.tile_cache.set_elt(d,void 0),void o.when(h.draw_helper(e,i,n)).then(function(t){_.resolve(t)});view.reference_track&&(s=view.reference_track.data_manager.subset_entry(r.pop(),e));var u=[],g=[];t.each(c,function(t,e){var a=t.mode,n=l[e];"Auto"===a&&(a=t.get_mode(n),t.update_auto_mode(a)),u.push(a),g.push(t.get_canvas_height(n,a,i,w))});var f,v=h.view.canvas_manager.new_canvas(),m=e.get("start"),b=e.get("end"),w=Math.ceil((b-m)*i)+h.left_offset,y=t.max(g);v.width=w,v.height=n.height||y;var x=v.getContext("2d");x.translate(h.left_offset,0),c.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),t.each(c,function(t,a){f=t.draw_tile(l[a],x,u[a],e,i,s)}),void 0!==f&&(h.tile_cache.set_elt(d,f),h.show_tile(f,i)),_.resolve(f)}),_},get_canvas_height:function(t,e,i,a){return this.visible_height_px},_draw_line_track_tile:function(t,e,i,a,n){var o=e.canvas,s=new r.LinePainter(t.data,a.get("start"),a.get("end"),this.config.to_key_value_dict(),i);return s.draw(e,o.width,o.height,n),new D(this,a,n,o,t.data)},draw_tile:function(t,e,i,a,n,o){},show_tile:function(t,e){var i=t.html_elt;t.predisplay_actions();var a=Math.round((t.low-(this.is_overview?this.view.max_low:this.view.low))*e);this.left_offset&&(a-=this.left_offset),i.css("left",a),i.hasClass("remove")?i.removeClass("remove"):this.tiles_div.append(i),i.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,i.height()-2),i.parent().children().css("height",this.max_height_px+"px");var n=this.max_height_px;0!==this.visible_height_px&&(n=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height",n+"px")},tool_region_and_parameters_str:function(e){var i=this,a=void 0!==e?e.toString():"all",n=t.values(i.tool.get_inputs_dict()).join(", ");return" - region=["+a+"], parameters=["+n+"]"},data_and_mode_compatible:function(t,e){return"Auto"===e?!0:"Coverage"===e?"bigwig"===t.dataset_type:"bigwig"!==t.dataset_type&&"no_detail"!==t.extra_info},can_subset:function(t){return t.message||"no_detail"===t.extra_info?!1:"bigwig"===t.dataset_type?t.data[1][0]-t.data[0][0]===1:!0},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var L=function(t,e){Y.call(this,t,e,{resize:!1,header:!1}),this.container_div.addClass("label-track")};u(L.prototype,Y.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(t){for(var e=this.view,i=e.high-e.low,n=Math.floor(Math.pow(10,Math.floor(Math.log(i)/Math.log(10)))),s=Math.floor(e.low/n)*n,r=this.view.container.width(),l=o("<div/>").addClass("label-container");s<e.high;){var h=Math.floor((s-e.low)/i*r);l.append(o("<div/>").addClass("pos-label").text(a.commatize(s)).css({left:h})),s+=n}this.content_div.children(":first").remove(),this.content_div.append(l)}});var j=function(e,i,a){if(B.call(this,e,i,a),this.drawables=[],"drawables"in a){for(var n,o=0;o<a.drawables.length;o++)n=a.drawables[o],this.drawables[o]=Z(n,e,null),n.left_offset>this.left_offset&&(this.left_offset=n.left_offset);this.enabled=!0}t.each(this.drawables,function(t){(t instanceof U||t instanceof X)&&t.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};u(j.prototype,B.prototype,{display_modes:R,config_params:t.union(M.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}]),action_icons_def:[{name:"composite_icon",title:"Show individual tracks",css_class:"layers-stack",on_click_fn:function(t){o(".tooltip").remove(),t.show_group()}}].concat(B.prototype.action_icons_def),to_dict:z.prototype.to_dict,add_drawable:z.prototype.add_drawable,unpack_drawables:z.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var e=this.visible_height_px;t.each(this.drawables,function(t){t.visible_height_px=e}),Y.prototype.on_resize.call(this)},change_mode:function(t){B.prototype.change_mode.call(this,t);for(var e=0;e<this.drawables.length;e++)this.drawables[e].change_mode(t)},init:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].init());var i=this;o.when.apply(o,t).then(function(){i.enabled=!0,i.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:M.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var t,e=new A(this.view,this.container,{name:this.config.get_value("name")}),i=0;i<this.drawables.length;i++)t=this.drawables[i],t.update_icons(),e.add_drawable(t),t.container=e,e.content_div.append(t.container_div);this.container.replace_drawable(this,e,!0);e.request_draw({clear_tile_cache:!0})},before_draw:function(){var e=t.min(t.map(this.drawables,function(t){return t.config.get_value("min_value")})),i=t.max(t.map(this.drawables,function(t){return t.config.get_value("max_value")}));this.config.set_value("min_value",e),this.config.set_value("max_value",i),t.each(this.drawables,function(t){t.config.set_value("min_value",e),t.config.set_value("max_value",i)})},update_all_min_max:function(){var e=this.config.get_value("min_value"),i=this.config.get_value("max_value");t.each(this.drawables,function(t){t.config.set_value("min_value",e),t.config.set_value("max_value",i)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(t,e,i,a){var n,o=-1;for(n=0;n<t.length;n++){var s=t[n].html_elt.find("canvas").height();s>o&&(o=s)}for(n=0;n<t.length;n++){var r=t[n];r.html_elt.find("canvas").height()!==o&&(this.draw_helper(r.region,i,{force:!0,height:o}),r.html_elt.remove())}var l=this,h=function(){l.update_all_min_max()};this._add_yaxis_label("min",h),this._add_yaxis_label("max",h)}});var F=function(t){B.call(this,t,{content_div:t.top_labeltrack},{resize:!1,header:!1}),this.left_offset=t.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url=Galaxy.root+"api/genomes/"+this.view.dbkey,this.data_url_extra_params={reference:!0},this.data_manager=new e.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};u(F.prototype,M.prototype,B.prototype,{config_params:t.union(M.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}]),init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:M.prototype.can_draw,draw_helper:function(t,e,i){var a,n=this.tiles_div.is(":visible"),o=null;return e>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),a=!0,o=B.prototype.draw_helper.call(this,t,e,i)):(a=!1,this.tiles_div.hide()),n!==a&&this.view.resize_viewport(),o},can_subset:function(t){return!0},draw_tile:function(t,e,i,a,n){var o=this.data_manager.subset_entry(t,a),s=o.data,r=e.canvas;e.font=e.canvas.manager.default_font,e.textAlign="center";for(var l=0,h=s.length;h>l;l++)e.fillStyle=this.view.get_base_color(s[l]),e.fillText(s[l],Math.floor(l*n),10);return new P(this,a,n,r,o)}});var H=function(t,e,i){this.mode="Histogram",B.call(this,t,e,i)};u(H.prototype,M.prototype,B.prototype,{display_modes:R,config_params:t.union(M.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}]),config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(t,e,i,a,n){return this._draw_line_track_tile(t,e,i,a,n)},can_subset:function(t){return t.data[1][0]-t.data[0][0]===1},postdraw_actions:function(t,e,i,a){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var K=function(t,e,i){this.mode="Heatmap",B.call(this,t,e,i)};u(K.prototype,M.prototype,B.prototype,{display_modes:["Heatmap"],config_params:t.union(M.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}]),config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){var t=this;return o.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(t){t.data})},draw_tile:function(t,e,i,a,n){var o=e.canvas,s=new r.DiagonalHeatmapPainter(t.data,a.get("start"),a.get("end"),this.config.to_key_value_dict(),i);return s.draw(e,o.width,o.height,n),new P(this,a,n,o,t.data)}});var U=function(t,e,i){B.call(this,t,e,i),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};u(U.prototype,M.prototype,B.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],config_params:t.union(M.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:null,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:null,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}]),config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=r.ArcLinkedFeaturePainter:this.painter=r.LinkedFeaturePainter},postdraw_actions:function(e,i,a,n){B.prototype.postdraw_actions.call(this,e,i,a,n);var s,r=this,l=t.filter(e,function(t){return t instanceof D});if(0===l.length){var h={};t.each(t.pluck(e,"incomplete_features"),function(e){t.each(e,function(t){h[t[0]]=t})});var c=this;t.each(e,function(e){var i=t.omit(h,t.map(e.incomplete_features,function(t){return t[0]}));if(i=t.omit(i,t.keys(e.other_tiles_features_drawn)),0!==t.size(i)){var a={data:t.values(i)},n=c.view.canvas_manager.new_canvas(),s=n.getContext("2d");n.height=Math.max(e.canvas.height,c.get_canvas_height(a,e.mode,e.w_scale,100)),n.width=e.canvas.width,s.drawImage(e.canvas,0,0),s.translate(r.left_offset,0);var l=c.draw_tile(a,s,e.mode,e.region,e.w_scale,e.seq_data);o(e.canvas).replaceWith(o(l.canvas)),e.canvas=n,t.extend(e.other_tiles_features_drawn,h)}})}if(r.filters_manager){var d,u=r.filters_manager.filters;for(d=0;d<u.length;d++)u[d].update_ui_elt();var g,p,_=!1;for(s=0;s<e.length;s++)if(e[s].data.length)for(g=e[s].data[0],d=0;d<u.length;d++)if(p=u[d],p.applies_to(g)&&p.min!==p.max){_=!0;break}r.filters_available!==_&&(r.filters_available=_,r.filters_available||r.filters_manager.hide(),r.update_icons())}if(e[0]instanceof I){var f=!0;for(s=0;s<e.length;s++)if(!e[s].all_slotted){f=!1;break}this.action_icons.show_more_rows_icon.toggle(!f)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(t){"Auto"===this.mode&&("no_detail"===t&&(t="feature spans"),
this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/"+t+")"))},incremental_slots:function(t,e,i){var a=this.view.canvas_manager.dummy_context,o=this.slotters[t];return o&&o.mode===i||(o=new n.FeatureSlotter(t,i,v,function(t){return a.measureText(t)}),this.slotters[t]=o),o.slot_features(e)},get_mode:function(t){return"no_detail"===t.extra_info||this.is_overview?mode="no_detail":this.view.high-this.view.low>m?mode="Squish":mode="Pack",mode},get_canvas_height:function(t,e,i,a){if("Coverage"===e||"bigwig"===t.dataset_type)return this.summary_draw_height;var n=this.incremental_slots(i,t.data,e),o=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return Math.max(this.min_height_px,o.get_required_height(n,a))},draw_tile:function(t,e,i,a,n,o,s){var r=this,l=e.canvas,h=a.get("start"),c=a.get("end"),d=this.left_offset;if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,i,a,n);var u=[],g=this.slotters[n].slots;if(all_slotted=!0,t.data)for(var p=this.filters_manager.filters,_=0,f=t.data.length;f>_;_++){for(var v,m=t.data[_],b=!1,w=0,y=p.length;y>w;w++)if(v=p[w],v.update_attrs(m),!v.keep(m)){b=!0;break}b||(u.push(m),m[0]in g||(all_slotted=!1))}var x=this.filters_manager.alpha_filter?new G(this.filters_manager.alpha_filter):null,k=this.filters_manager.height_filter?new G(this.filters_manager.height_filter):null,C=new this.painter(u,h,c,this.config.to_key_value_dict(),i,x,k,o,function(t){return r.view.get_base_color(t)}),T=null;if(e.fillStyle=this.config.get_value("block_color"),e.font=e.canvas.manager.default_font,e.textAlign="right",t.data){var S=C.draw(e,l.width,l.height,n,g);T=S.feature_mapper,incomplete_features=S.incomplete_features,T.translation=-d}return s?void 0:new I(r,a,n,l,t.data,i,t.message,all_slotted,T,incomplete_features,o)}});var J=function(t,e,i){B.call(this,t,e,i),this.painter=r.VariantPainter,this.summary_draw_height=30,this.left_offset=30};u(J.prototype,M.prototype,B.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],config_params:t.union(M.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}]),config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(t,e,i,a,n){if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,"Histogram",a,n);var o=this.view,s=new this.painter(t.data,a.get("start"),a.get("end"),this.config.to_key_value_dict(),i,function(t){return o.get_base_color(t)});return s.draw(e,e.canvas.width,e.canvas.height,n),new P(this,a,n,e.canvas,t.data)},get_canvas_height:function(t,e,i,a){if("bigwig"===t.dataset_type)return this.summary_draw_height;var n=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;0===n&&0!==t.data.length&&(n=t.data[0][7].match(/,/g),n=null===n?1:n.length+1);var o=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return o.get_required_height(n)},predraw_init:function(){var t=[Y.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||t.push(this.dataset.fetch()),t},postdraw_actions:function(e,i,a,n){B.prototype.postdraw_actions.call(this,e,i,a,n);var s=t.filter(e,function(t){return t instanceof D}),r=this.dataset.get_metadata("sample_names");if(0===s.length&&this.config.get_value("show_labels")&&r&&r.length>1){var l;if(0===this.container_div.find(".yaxislabel.variant").length&&(l=this.config.get_value("summary_height")/2,this.tiles_div.prepend(o("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":l+"px",top:(this.config.get_value("summary_height")-l)/2+"px"})),this.config.get_value("show_sample_data"))){var h=r.join("<br/>");this.tiles_div.prepend(o("<div/>").html(h).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}l=("Squish"===this.mode?5:10)+"px",o(this.tiles_div).find(".sample").css({"font-size":l,"line-height":l}),o(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var X=function(t,e,i){U.call(this,t,e,i),this.painter=r.ReadPainter,this.update_icons()};u(X.prototype,M.prototype,B.prototype,U.prototype,{config_params:t.union(M.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:null,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:null,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}]),config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var W={CompositeTrack:j,DrawableGroup:A,DiagonalHeatmapTrack:K,FeatureTrack:U,LineTrack:H,ReadTrack:X,VariantTrack:J,VcfTrack:J},Z=function(t,e,i){if("copy"in t)return t.copy(i);var a=t.obj_type;return a||(a=t.track_type),new W[a](e,i,t)};return{TracksterView:q,DrawableGroup:A,LineTrack:H,FeatureTrack:U,DiagonalHeatmapTrack:K,ReadTrack:X,VariantTrack:J,CompositeTrack:j,object_from_template:Z}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(1),i(2))},function(t,e,i){var a,n;(function(o,s){a=[i(3)],n=function(t){var e=o.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(s("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(s("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(t){t.stopPropagation()}),this.$el.append(s("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var e=this;this.icons_div=s("<div/>").addClass("track-icons").hide().appendTo(this.$el),t.each(this.model.action_icons_def,function(t){e.add_action_icon(t.name,t.title,t.css_class,t.on_click_fn,t.prepend,t.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(t,e,i,a,n,o){var r=this;this.action_icons[t]=s("<a/>").attr("title",e).addClass("icon-button").addClass(i).tooltip().click(function(){a(r.model)}).appendTo(this.icons_div),o&&this.action_icons[t].hide()},set_display_modes:function(t,e){if(t){this.model.display_modes=t,this.model.mode=e||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: "+this.mode+")");for(var i=this.model,a={},n=0,o=i.display_modes.length;o>n;n++){var s=i.display_modes[n];a[s]=function(t){return function(){i.change_mode(t)}}(s)}make_popupmenu(this.action_icons.mode_icon,a)}}});return{TrackHeaderView:e}}.apply(e,a),!(void 0!==n&&(t.exports=n))}).call(e,i(2),i(1))}]);
//# sourceMappingURL=0.0.bundled.js.map