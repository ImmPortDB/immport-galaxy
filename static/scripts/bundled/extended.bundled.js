webpackJsonp([1],[,,,,,,,,,,,function(t,e,n){"use strict";function i(t,e){return function(n){if(t.hasOwnProperty(n))return t[n];if(!e)throw new Error("I do not know how to modify the following string: "+n+". Change your TeX file or submit a feature request at https://github.com/digitalheir/tex-to-unicode/issues.");return n+e}}Object.defineProperty(e,"__esModule",{value:!0}),e.lookupOrAppend=i},,function(t,e,n){"use strict";function i(t){return"("+t+")"}Object.defineProperty(e,"__esModule",{value:!0}),e.simpleSuffix=function(t){return function(e){return e+t}},e.isSingleTerm=/^.$|^[0-9]+$/,e.addParenthesis=i},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(31),c=a(l),d=t.Model.extend({}),u=t.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new d;i.each(i.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var n=e.split("metadata_")[1];t.set(n,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),h=u.extend({defaults:i.extend({},u.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(t){u.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=r.Deferred();return r.getJSON(this.attributes.chunk_url,{offset:t.attributes.offset}).success(function(n){var i;""!==n.ck_data?(i=n,t.attributes.offset=n.offset):(t.attributes.at_eof=!0,i=null),e.resolve(i)}),e}}),f=t.Collection.extend({model:u}),p=t.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new m({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),r.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=r("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=r("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),n=r("<thead/>").appendTo(t),i=r("<tr/>").appendTo(n);if(e)i.append("<th>"+e.join("</th><th>")+"</th>");else for(var a=1;a<=this.model.get_metadata("columns");a++)i.append("<th>"+a+"</th>");var o=this,s=this.model.get("first_data_chunk");s?this._renderChunk(s):r.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,n){var i=r("<td>").text(t),a=this.model.get_metadata("column_types");return void 0!==n?i.attr("colspan",n).addClass("stringalign"):a&&e<a.length&&("str"!==a[e]&&"list"!==a[e]||i.addClass("stringalign")),i},_renderRow:function(t){var e=t.split("\t"),n=r("<tr>"),a=this.model.get_metadata("columns");return this.row_count%2!=0&&n.addClass("dark_row"),e.length===a?i.each(e,function(t,e){n.append(this._renderCell(t,e))},this):e.length>a?(i.each(e.slice(0,a-1),function(t,e){n.append(this._renderCell(t,e))},this),n.append(this._renderCell(e.slice(a-1).join("\t"),a-1))):1===e.length?n.append(this._renderCell(t,0,a)):(i.each(e,function(t,e){n.append(this._renderCell(t,e))},this),i.each(i.range(a-e.length),function(){n.append(r("<td>"))})),this.row_count++,n},_renderChunk:function(t){var e=this.$el.find("table");i.each(t.ck_data.split("\n"),function(t,n){""!==t&&e.append(this._renderRow(t))},this)}}),_=p.extend({initialize:function(t){p.prototype.initialize.call(this,t);var e=i.find(this.$el.parents(),function(t){return"auto"===r(t).css("overflow")});e||(e=window),this.scroll_elt=r(e)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),g=p.extend({initialize:function(t){p.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),m=t.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){var e=parent.Galaxy;if(e&&e.modal&&(this.modal=e.modal),e&&e.frame&&(this.frame=e.frame),this.modal&&this.frame){var n=t.model,i=n.get("metadata");if(n.get("file_ext")){if(this.file_ext=n.get("file_ext"),"bed"==this.file_ext){if(!(i.get("chromCol")&&i.get("startCol")&&i.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=i.get("chromCol")-1,this.col.start=i.get("startCol")-1,this.col.end=i.get("endCol")-1}if("vcf"==this.file_ext){var r=function(t,e){for(var n=0;n<e.length;n++)if(e[n].match(t))return n;return-1};if(this.col.chrom=r("Chrom",i.get("column_names")),this.col.start=r("Pos",i.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start)return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.")}if(void 0!==this.col.chrom){if(!n.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=n.id,!n.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=n.get("url_viz"),n.get("genome_build")&&(this.genome_build=n.get("genome_build"));var a=new c.default.IconButtonView({model:new c.default.IconButton({title:(0,s.default)("Visualize"),icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(a.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){var e=this;if(null!==this.col.chrom){var n=r(t.target).parent(),i=n.children().eq(this.col.chrom).html(),a=n.children().eq(this.col.start).html(),o=this.col.end?n.children().eq(this.col.end).html():a;if(!i.match("^#")&&""!==i&&function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(a)){var l={dataset_id:this.dataset_id,gene_region:i+":"+a+"-"+o},c=n.offset(),d=c.left-10,u=c.top-r(window).scrollTop()+3;r("#btn_viz").css({position:"fixed",top:u+"px",left:d+"px"}),r("#btn_viz").off("click"),r("#btn_viz").click(function(){e.frame.add({title:(0,s.default)("Trackster"),url:e.url_viz+"/trackster?"+r.param(l)})}),r("#btn_viz").show()}else r("#btn_viz").hide()}},hide:function(){this.$("#btn_viz").hide()}}),v=function(t){t.model||(t.model=new h(t.dataset_config));var e=t.parent_elt,n=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var i=n?new g(t):new _(t);return i.render(),e&&(e.append(i.$el),i.expand_to_container()),i};e.default={Dataset:u,TabularDataset:h,DatasetCollection:f,TabularDatasetChunkedView:p,createTabularDatasetChunkedView:v}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(1),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(s),c=n(14),d=r(c),u=n(18),h=r(u),f=n(33),p=r(f),_=n(24),g=r(_),m=n(80),v=r(m),y={toJSON:function(){var t=this,e={};return l.each(t.constructor.to_json_keys,function(n){var i=t.get(n);n in t.constructor.to_json_mappers&&(i=t.constructor.to_json_mappers[n](i,t)),e[n]=i}),e}},b=function(e,n){var i=new g.default({url_base:Galaxy.root+"visualization/list_history_datasets",filters:e,embedded:!0}),r=new g.default({url_base:Galaxy.root+"visualization/list_library_datasets",embedded:!0}),a=new v.default.View;a.add({id:"histories",title:(0,o.default)("Histories"),$el:t("<div/>").append(i.$el)}),a.add({id:"libraries",title:(0,o.default)("Libraries"),$el:t("<div/>").append(r.$el)}),Galaxy.modal.show({title:(0,o.default)("Select datasets for new tracks"),body:a.$el,closing_events:!0,buttons:{Cancel:function(){Galaxy.modal.hide()},Add:function(){var e=[];a.$("input.grid-row-select-checkbox[name=id]:checked").each(function(){window.console.log(t(this).val()),e[e.length]=t.ajax({url:Galaxy.root+"api/datasets/"+t(this).val(),dataType:"json",data:{data_type:"track_config",hda_ldda:"histories"==a.current()?"hda":"ldda"}})}),t.when.apply(t,e).then(function(){var e=arguments[0]instanceof Array?t.map(arguments,function(t){return t[0]}):[arguments[0]];n(e)}),Galaxy.modal.hide()}}})},w=function(t){this.default_font=void 0!==t?t:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};l.extend(w.prototype,{load_pattern:function(t,e){var n=this.patterns,i=this.dummy_context,r=new Image;r.src=Galaxy.root+"static/images"+e,r.onload=function(){n[t]=i.createPattern(r,"repeat")}},get_pattern:function(t){return this.patterns[t]},new_canvas:function(){var e=t("<canvas/>")[0];return e.manager=this,e}});var x=i.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(t){this.clear()},get_elt:function(t){var e=this.attributes.obj_cache,n=this.attributes.key_ary,i=t.toString(),r=l.indexOf(n,function(t){return t.toString()===i});return-1!==r&&(e[i].stale?(n.splice(r,1),delete e[i]):this.move_key_to_end(t,r)),e[i]},set_elt:function(t,e){var n=this.attributes.obj_cache,i=this.attributes.key_ary,r=t.toString(),a=this.attributes.num_elements;if(!n[r]){if(i.length>=a){delete n[i.shift().toString()]}i.push(t)}return n[r]=e,e},move_key_to_end:function(t,e){this.attributes.key_ary.splice(e,1),this.attributes.key_ary.push(t)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),k=x.extend({defaults:l.extend({},x.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(t,e){return!0},can_subset:function(t){return!1}}),initialize:function(t){x.prototype.initialize.call(this);var e=this.get("init_data");e&&this.add_data(e)},add_data:function(t){this.get("num_elements")<t.length&&this.set("num_elements",t.length);var e=this;l.each(t,function(t){e.set_data(t.region,t)})},data_is_ready:function(){var e=this.get("dataset"),n=t.Deferred(),i="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",r=new h.default.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:e.get("hda_ldda"),data_type:i},dataType:"json"},interval:5e3,success_fn:function(t){return"pending"!==t}});return t.when(r.go()).then(function(t){n.resolve("ok"===t||"data"===t)}),n},search_features:function(e){var n=this.get("dataset"),i={query:e,hda_ldda:n.get("hda_ldda"),data_type:"features"};return t.getJSON(n.url(),i)},load_data:function(e,n,i,r){var a=this.get("dataset"),o={data_type:this.get("data_type"),chrom:e.get("chrom"),low:e.get("start"),high:e.get("end"),mode:n,resolution:i,hda_ldda:a.get("hda_ldda")};t.extend(o,r);var s=this.get("filters_manager");if(s){for(var l=[],c=s.filters,d=0;d<c.length;d++)l.push(c[d].name);o.filter_cols=JSON.stringify(l)}var u=this,h=t.getJSON(a.url(),o,function(t){t.region=e,u.set_data(e,t)});return this.set_data(e,h),h},get_data:function(t,e,n,i){var r=this.get_elt(t);if(r&&(h.default.is_deferred(r)||this.get("data_mode_compatible")(r,e)))return r;for(var a,o,s=this.get("key_ary"),l=this.get("obj_cache"),c=0;c<s.length;c++)if(a=s[c],a.contains(t)&&(o=!0,r=l[a.toString()],h.default.is_deferred(r)||this.get("data_mode_compatible")(r,e)&&this.get("can_subset")(r))){if(this.move_key_to_end(a,c),!h.default.is_deferred(r)){var d=this.subset_entry(r,t);this.set_data(t,d),r=d}return r}if(!o&&t.length()<this.attributes.min_region_size){t=t.copy();var u=this.most_recently_added();!u||t.get("start")>u.get("start")?t.set("end",t.get("start")+this.attributes.min_region_size):t.set("start",t.get("end")-this.attributes.min_region_size),t.set("genome",this.attributes.genome),t.trim()}return this.load_data(t,e,n,i)},set_data:function(t,e){this.set_elt(t,e)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(e,n,i,r,a){var o=this._mark_stale(e);if(!o||!this.get("data_mode_compatible")(o,n))return void console.log("ERROR: problem with getting more data: current data is not compatible");var s=e.get("start");a===this.DEEP_DATA_REQ?t.extend(r,{start_val:o.data.length+1}):a===this.BROAD_DATA_REQ&&(s=(o.max_high?o.max_high:o.data[o.data.length-1][2])+1);var l=e.copy().set("start",s),c=this,d=this.load_data(l,n,i,r),u=t.Deferred();return this.set_data(e,u),t.when(d).then(function(t){t.data&&(t.data=o.data.concat(t.data),t.max_low&&(t.max_low=o.max_low),t.message&&(t.message=t.message.replace(/[0-9]+/,t.data.length))),c.set_data(e,t),u.resolve(t)}),u},can_get_more_detailed_data:function(t){var e=this.get_elt(t);return"bigwig"===e.dataset_type&&e.data.length<8e3},get_more_detailed_data:function(t,e,n,i,r){var a=this._mark_stale(t);return a?(r||(r={}),"bigwig"===a.dataset_type&&(r.num_samples=1e3*i),this.load_data(t,e,n,r)):void console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(t){var e=this.get_elt(t);return e||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),t.toString()),e.stale=!0,e},get_genome_wide_data:function(e){var n=this,i=!0,r=l.map(e.get("chroms_info").chrom_info,function(t){var e=n.get_elt(new S({chrom:t.chrom,start:0,end:t.len}));return e||(i=!1),e});if(i)return r;var a=t.Deferred();return t.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(t){n.add_data(t.data),a.resolve(t.data)}),a},subset_entry:function(t,e){var n={bigwig:function(t,e){return l.filter(t,function(t){return t[0]>=e.get("start")&&t[0]<=e.get("end")})},refseq:function(e,n){var i=n.get("start")-t.region.get("start");return t.data.slice(i,i+n.length())}},i=t.data;return!t.region.same(e)&&t.dataset_type in n&&(i=n[t.dataset_type](t.data,e)),{region:e,data:i,dataset_type:t.dataset_type}}}),M=k.extend({initialize:function(t){var e=new i.Model;e.urlRoot=t.data_url,this.set("dataset",e)},load_data:function(t,e,n,i){return t.length()<=1e5?k.prototype.load_data.call(this,t,e,n,i):{data:null,region:t}}}),C=i.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(t){this.id=t.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(t){var e=l.find(this.get_chroms_info(),function(e){return e.chrom===t});return new S({chrom:e.chrom,end:e.len})},get_chrom_len:function(t){return l.find(this.get_chroms_info(),function(e){return e.chrom===t}).len}}),S=i.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(t){return this.attributes.chrom===t.get("chrom")&&this.attributes.start===t.get("start")&&this.attributes.end===t.get("end")},initialize:function(t){if(t.from_str){var e=t.from_str.split(":"),n=e[0],i=e[1].split("-");this.set({chrom:n,start:parseInt(i[0],10),end:parseInt(i[1],10)})}this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end"),this.on("change",function(){this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end")},this)},copy:function(){return new S({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(t){var e=this.get("chrom"),n=t.get("chrom"),i=this.get("start"),r=t.get("start"),a=this.get("end"),o=t.get("end");return e&&n&&e!==n?S.overlap_results.DIF_CHROMS:i<r?a<r?S.overlap_results.BEFORE:a<o?S.overlap_results.OVERLAP_START:S.overlap_results.CONTAINS:i>r?i>o?S.overlap_results.AFTER:a<=o?S.overlap_results.CONTAINED_BY:S.overlap_results.OVERLAP_END:a>=o?S.overlap_results.CONTAINS:S.overlap_results.CONTAINED_BY},trim:function(t){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var e=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>e&&(this.attributes.end=e-1)}return this},contains:function(t){return this.compute_overlap(t)===S.overlap_results.CONTAINS},overlaps:function(t){return 0===l.intersection([this.compute_overlap(t)],[S.overlap_results.DIF_CHROMS,S.overlap_results.BEFORE,S.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),T=i.Collection.extend({model:S}),A=i.Model.extend({defaults:{region:null,note:""},initialize:function(t){this.set("region",new S(t.region))}}),j=i.Collection.extend({model:A}),E=i.Model.extend(y).extend({defaults:{mode:"Auto"},initialize:function(t){this.set("dataset",new d.default.Dataset(t.dataset));var e=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",p.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs));var n=this.get("preloaded_data");n=n?n.data:[],this.set("data_manager",new k({dataset:this.get("dataset"),init_data:n}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(t,e){return 0===l.size(t)&&(t={name:e.get("config").get("name").get("value"),color:e.get("config").get("color").get("value")}),t},dataset:function(t){return{id:t.id,hda_ldda:t.get("hda_ldda")}}}}),O=i.Collection.extend({model:E}),L=i.Model.extend({defaults:{title:"",type:""},urlRoot:Galaxy.root+"api/visualizations",save:function(){return t.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),N=L.extend(y).extend({defaults:l.extend({},L.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(t){this.set("drawables",new O(t.tracks));var e=[];this.set("config",p.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs)),this.unset("tracks"),this.get("drawables").each(function(t){t.unset("preloaded_data")})},add_tracks:function(t){this.get("drawables").add(t)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(t,e){return{obj_type:"View",prefs:{name:e.get("title"),content_visible:!0},drawables:e.get("drawables")}}}}),I=i.Router.extend({initialize:function(t){var e=this;this.view=t.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w+]+:[\d,]+-[\d,]+)$/,"change_location"),this.view.on("navigate",function(t){e.navigate(t)})},change_location:function(t){this.view.go_to(t)}});e.default={BackboneTrack:E,BrowserBookmark:A,BrowserBookmarkCollection:j,Cache:x,CanvasManager:w,Genome:C,GenomeDataManager:k,GenomeRegion:S,GenomeRegionCollection:T,GenomeVisualization:N,GenomeReferenceDataManager:M,TrackBrowserRouter:I,Visualization:L,select_datasets:b}}).call(e,n(0),n(2))},,,function(t,e,n){"use strict";(function(t,n){function i(t){t+="";for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return"promise"in t},a=t.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(t){return!0}},go:function(){var t=n.Deferred(),e=this,i=e.get("ajax_settings"),r=e.get("success_fn"),a=e.get("interval");return function e(){n.ajax(i).success(function(n){r(n)?t.resolve(n):setTimeout(e,a)})}(),t}}),o=function(t){t||(t="#ffffff"),"string"==typeof t&&(t=[t]);for(var e=0;e<t.length;e++)t[e]=parseInt(t[e].slice(1),16);var n,i,r,a,o,s,l,c,d,u,h,f=function(t,e,n){return(299*t+587*e+114*n)/1e3},p=!1,_=0;do{for(n=Math.round(16777215*Math.random()),i=(16711680&n)>>16,r=(65280&n)>>8,a=255&n,d=f(i,r,a),p=!0,e=0;e<t.length;e++)if(o=t[e],s=(16711680&o)>>16,l=(65280&o)>>8,c=255&o,u=f(s,l,c),h=function(t,e,n,i,r,a){return Math.max(t,i)-Math.min(t,i)+(Math.max(e,r)-Math.min(e,r))+(Math.max(n,a)-Math.min(n,a))}(i,r,a,s,l,c),Math.abs(d-u)<40||h<200){p=!1;break}_++}while(!p&&_<=10);return"#"+(16777216+n).toString(16).substr(1,6)};e.default={commatize:i,is_deferred:r,ServerStateDeferred:a,get_random_color:o}}).call(e,n(2),n(0))},function(t,e,n){"use strict";var i=n(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=r.default;a.fn.make_text_editable=function(t){var e="num_cols"in t?t.num_cols:30,n="num_rows"in t?t.num_rows:4,i="use_textarea"in t&&t.use_textarea,r="on_finish"in t?t.on_finish:null,o="help_text"in t?t.help_text:null,s=a(this);return s.addClass("editable-text").click(function(o){if(!(a(this).children(":input").length>0)){s.removeClass("editable-text");var l,c,d=function(t){s.find(":input").remove(),""!==t?s.text(t):s.html("<br>"),s.addClass("editable-text"),r&&r(t)},u="cur_text"in t?t.cur_text:s.text();i?(l=a("<textarea/>").attr({rows:n,cols:e}).text(a.trim(u)).keyup(function(t){27===t.keyCode&&d(u)}),c=a("<button/>").text("Done").click(function(){return d(l.val()),!1})):l=a("<input type='text'/>").attr({value:a.trim(u),size:e}).blur(function(){d(u)}).keyup(function(t){27===t.keyCode?a(this).trigger("blur"):13===t.keyCode&&d(a(this).val()),t.stopPropagation()}),s.text(""),s.append(l),c&&s.append(c),l.focus(),l.select(),o.stopPropagation()}}),o&&s.attr("title",o).tooltip(),s}},,,,,function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=n(9),o=r(a),s=n(1),l=r(s),c=n(5),d=i(c),u=n(78),h=i(u),f=n(79),p=i(f),_=n(41),g=i(_),m=n(34),v=i(m);t.ajaxSettings.traditional=!0,e.default=o.View.extend({grid:null,initialize:function(e){this.grid=new h.default,this.title=e.title,this.active_tab=e.active_tab;var n=this;if(window.add_tag_to_grid_filter=function(e,i){var r=e+(void 0!==i&&""!==i?":"+i:"");t("#advanced-search").is(":visible")||(t("#standard-search").slideToggle("fast"),t("#advanced-search").slideToggle("fast")),n.add_filter_condition("tags",r)},e.url_base&&!e.items){v.default.markViewAsLoading(this);var i=e.url_data||{};l.each(e.filters,function(t,e){i["f-"+e]=t}),t.ajax({url:e.url_base+"?"+t.param(i),success:function(t){t.embedded=e.embedded,t.filters=e.filters||{},n.init_grid(t)}})}else this.setElement("<div>"),this.init_grid(e);e.use_panels&&t("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(e){e&&t.inArray("history",e)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&d.default.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var n=this.grid.get("url_base");if(n=n.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",n),this.$el.html(p.default.grid(e)),this.$el.find("#grid-table-header").html(p.default.header(e)),this.$el.find("#grid-table-body").html(p.default.body(e)),this.$el.find("#grid-table-footer").html(p.default.footer(e)),e.message){this.$el.find("#grid-message").html(p.default.message(e));var i=this;e.use_hide_message&&window.setTimeout(function(){i.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),window.init_refresh_on_change&&window.init_refresh_on_change()},init_grid_controls:function(){var e=this;this.$el.find(".operation-button").each(function(){t(this).off(),t(this).click(function(){return e.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){t(this).off(),t(this).click(function(){t(this).select()}).keyup(function(){t(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){t(this).off(),t(this).click(function(){return e.set_sort_condition(t(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){t(this).off(),t(this).submit(function(){var n=t(this).attr("column_key"),i=t("#input-"+n+"-filter"),r=i.val();return i.val(""),e.add_filter_condition(n,r),!1})}),this.$el.find(".text-filter-val > a").each(function(){t(this).off(),t(this).click(function(){return t(this).parent().remove(),e.remove_filter_condition(t(this).attr("filter_key"),t(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){t(this).off(),t(this).click(function(){return e.set_categorical_filter(t(this).attr("filter_key"),t(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){t(this).off(),t(this).click(function(){return e.$el.find("#standard-search").slideToggle("fast"),e.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){e.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var e=t(this).find("input.grid-row-select-checkbox"),n=t(this).find("span.grid-selected-count"),i=function(){n.text(t(e).filter(":checked").length)};t(e).each(function(){t(this).change(i)}),i()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var e=this.grid.attributes,n=this;this.$el.find(".page-link-grid > a").each(function(){t(this).click(function(){return n.set_page(t(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){t(this).click(function(){return n.execute({href:t(this).attr("href"),target:t(this).attr("target")}),!1})}),0!==e.items.length&&l.each(e.items,function(t,i){var r=n.$("#grid-"+t.encode_id+"-popup").off(),a=new g.default(r);l.each(e.operations,function(e){n.add_operation(a,e,t)})})},add_operation:function(e,n,i){var r=this,a=i.operation_config[n.label];a.allowed&&n.allow_popup&&e.addItem({html:n.label,href:a.url_args,target:a.target,confirmation_text:n.confirm,func:function(e){e.preventDefault();var a=t(e.target).html();n.onclick?n.onclick(i.encode_id):r.execute(this.findItemByHtml(a))}})},add_filter_condition:function(e,n){if(""===n)return!1;this.grid.add_filter(e,n,!0);var i=t(p.default.filter_element(e,n)),r=this;i.click(function(){t(this).remove(),r.remove_filter_condition(e,n)}),this.$el.find("#"+e+"-filtering-criteria").append(i),this.go_page_one(),this.execute()},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),this.go_page_one(),this.execute()},set_sort_condition:function(e){var n=this.grid.get("sort_key"),i=e;-1!==n.indexOf(e)&&"-"!==n.substring(0,1)&&(i="-"+e),this.$el.find(".sort-arrow").remove();var r="-"==i.substring(0,1)?"&uarr;":"&darr;",a=t("<span>"+r+"</span>").addClass("sort-arrow");this.$el.find("#"+e+"-header").append(a),this.grid.set("sort_key",i),this.go_page_one(),this.execute()},set_categorical_filter:function(e,n){var i=this.grid.get("categorical_filters")[e],r=this.grid.get("filters")[e],a=this;this.$el.find("."+e+"-filter").each(function(){var o=t.trim(t(this).text()),s=i[o],l=s[e];if(l==n)t(this).empty(),t(this).addClass("current-filter"),t(this).append(o);else if(l==r){t(this).empty();var c=t('<a href="#">'+o+"</a>");c.click(function(){a.set_categorical_filter(e,l)}),t(this).removeClass("current-filter"),t(this).append(c)}}),this.grid.add_filter(e,n),this.go_page_one(),this.execute()},set_page:function(e){var n=this;this.$el.find(".page-link").each(function(){var i,r=t(this).attr("id"),a=parseInt(r.split("-")[2],10),o=n.grid.get("cur_page");if(a===e)i=t(this).children().text(),t(this).empty(),t(this).addClass("inactive-link"),t(this).text(i);else if(a===o){i=t(this).text(),t(this).empty(),t(this).removeClass("inactive-link");var s=t('<a href="#">'+i+"</a>");s.click(function(){n.set_page(a)}),t(this).append(s)}}),"all"===e?this.grid.set("cur_page",e):this.grid.set("cur_page",parseInt(e,10)),this.execute()},submit_operation:function(e,n){var i=t(e).val();if(this.$el.find('input[name="id"]:checked').length<1)return!1;var r=l.findWhere(this.grid.attributes.operations,{label:i});r&&!n&&(n=r.confirm||"");var a=[];this.$el.find("input[name=id]:checked").each(function(){a.push(t(this).val())});var o={operation:i,id:a,confirmation_text:n};return"top"!=r.target&&"center"!=r.target||(o=l.extend(o,{href:r.href,target:r.target})),this.execute(o),!0},check_all_items:function(){var e=this.$(".grid-row-select-checkbox"),n=this.$("#check_all").prop("checked");l.each(e,function(e){t(e).prop("checked",n)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!==t&&void 0!==t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(e){var n=null,i=null,r=null,a=null,o=null;if(e&&(i=e.href,r=e.operation,n=e.id,a=e.confirmation_text,o=e.target,void 0!==i&&-1!=i.indexOf("operation="))){var s=i.split("?");if(s.length>1)for(var l=s[1],c=l.split("&"),d=0;d<c.length;d++)-1!=c[d].indexOf("operation")?(r=c[d].split("=")[1],r=r.replace(/\+/g," ")):-1!=c[d].indexOf("id")&&(n=c[d].split("=")[1])}return r&&n?!(a&&""!==a&&"None"!=a&&"null"!=a&&!window.confirm(a))&&(r=r.toLowerCase(),this.grid.set({operation:r,item_ids:n}),"top"==o?window.top.location=i+"?"+t.param(this.grid.get_url_data()):"center"==o?t("#galaxy_main").attr("src",i+"?"+t.param(this.grid.get_url_data())):this.update_grid(),!1):i?(this.go_to(o,i),!1):(this.update_grid(),!1)},go_to:function(e,n){var i=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",i),n||(n=this.grid.get("url_base")+"?"+t.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0}),e){case"center":t("#galaxy_main").attr("src",n);break;case"top":window.top.location=n;break;default:window.location=n}},update_grid:function(){var e=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var n=this;t.ajax({type:e,url:n.grid.get("url_base"),data:n.grid.get_url_data(),error:function(){alert("Grid refresh failed")},success:function(t){var e=n.grid.get("embedded"),i=n.grid.get("insert"),r=n.$el.find("#advanced-search").is(":visible"),a=t;a.embedded=e,a.insert=i,a.advanced_search=r,n.init_grid(a),n.$el.find(".loading-elt-overlay").hide()},complete:function(){n.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(e,n(0))},,,,function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(29)),i(n(30)),i(n(94))},function(t,e,n){"use strict";function i(t,e,n,i){if(void 0===i&&(i={writable:!0,enumerable:!0,configurable:!0}),!(t instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0!==e){if(!(e instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===i)i={writable:!0,enumerable:!0,configurable:!0};else if(!(i instanceof Object))throw new TypeError('"attributes" isn\'t an Object instance');if(void 0===n)for(var r in e)void 0!==e[r]&&Object.defineProperty(t,r,Object.create(i,{value:{value:e[r]}}));else if(n instanceof Array)n.forEach(function(n){void 0!==e[n]&&Object.defineProperty(t,n,Object.create(i,{value:{value:e[n]}}))});else{if(!(n instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var a in n){var r=n[a];void 0!==e[r]&&Object.defineProperty(t,a,Object.create(i,{value:{value:e[r]}}))}}}}function r(t,e,n,i){if(void 0===i&&(i=!0),!(t instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0===e)return!0;if(!(e instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===i&&(i=!0),void 0===n){for(var r in e)if(t[r]!==e[r]&&(void 0!==e[r]||!i))return!1}else{if(n instanceof Array)return n.every(function(n){return t[n]===e[n]||void 0===e[n]&&i});if(!(n instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var a in n){var r=n[a];if(t[a]!==e[r]&&(void 0!==e[r]||!i))return!1}}return!0}function a(t){return"number"==typeof t}function o(t){return"string"==typeof t}function s(t,e){if(!t)throw new Error(e);return t}function l(t,e){if(!(t instanceof Object))throw new TypeError(e||"Expected Object");return t}function c(t,e){if("string"!=typeof t)throw new TypeError(e||"Expected string");return t}function d(t,e){if(!u(t))throw new TypeError(e||"Expected Array");return t}function u(t){return!!t&&t.constructor===Array}function h(t,e){return[].concat.apply([],t.map(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.updateProperties=i,e.testProperties=r,e.mustBeNumber=function(t,e){if(!a(t))throw new TypeError(e||"Expected number");return t},e.isNumber=a,e.isString=o,e.mustNotBeUndefined=s,e.mustBeObject=l,e.mustBeString=c,e.mustBeArray=d,e.isArray=u,e.mconcat=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduceRight(t)},e.snd=function(t){return t[1]},e.concatMap=h},function(t,e,n){"use strict";function i(t){return a(t)||o(t)}function r(t){return e.measureTypes.hasOwnProperty(t)}function a(t){return r(t.type)&&B.isNumber(t.value)}function o(t){return _(t.expression)}function s(t){if(void 0===t)return!1;switch(t){case"Parentheses":case"Square":case"Dollar":return!0;default:return!1}}function l(t,e){return void 0!==t&&(void 0===e?"string"==typeof t.name:e===t.name)}function c(t){return void 0!==t&&"string"==typeof t.text}function d(t){return void 0!==t&&B.isArray(t.latex)}function u(t){return t.arguments instanceof Array}function h(t){return t===J.SUP||t===J.SUB}function f(t){switch(t){case"#":return"\\#";case"$":return"\\$";case"%":return"\\%";case"^":return"\\^{}";case"&":return"\\&";case"{":return"\\{";case"}":return"\\}";case"~":return"\\~{}";case"\\":return"\\textbackslash{}";case"_":return"\\_{}";default:return t}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return 0===e.length?"string"==typeof t.type:e.some(function(e){return t.type===e})}function _(t){return m(t)||g(t)}function g(t){return E(t)||y(t)||b(t)||x(t)||k(t)||M(t)||S(t)||j(t)}function m(t){return E(t)||v(t)||b(t)||x(t)||k(t)||M(t)||S(t)||j(t)}function v(t){return void 0!==t&&void 0!==t.type&&c(t)&&p(t,e.typeTeXRaw)}function y(t){return void 0!==t&&"string"==typeof t.string&&"number"==typeof t.category}function b(t){return l(t)&&u(t)&&p(t,e.typeTeXComm,e.typeTeXCommS)}function w(t){return b(t)&&0===t.arguments.length}function x(t,n){return p(t,e.typeTeXEnv)}function k(t){return d(t)&&p(t)&&s(t.type)}function M(t){return void 0!==t&&"boolean"==typeof t.noNewPage&&(void 0===t.measure||i(t.measure))}function C(t){return h(t.type)}function S(t){return d(t)&&p(t,e.typeTeXBraces)}function T(t){return p(t,"FixArg")}function A(t){return p(t,"OptArg")}function j(t){return c(t)&&p(t,e.typeTeXComment)}function E(t){return void 0!==t&&0===Object.keys(t).length}function O(t){return{type:"FixArg",latex:t}}function L(t){return 1===t.length?{type:"OptArg",latex:t}:{type:"MOptArg",latex:t}}function N(t){return{type:"SymArg",latex:[t]}}function I(t){return{type:"ParArg",latex:[t]}}function P(t){return{type:"MOptArg",latex:t}}function D(t){return{type:"MSymArg",latex:t}}function R(t){return{type:"MParArg",latex:t}}function z(t){return{name:t,arguments:[],type:e.typeTeXCommS}}function $(t){return{text:t,type:e.typeTeXRaw,characterCategories:X.convertToTeXCharsDefault(t)}}function W(t,e,n,i){return{latex:i,type:t,startSymbol:e,endSymbol:n}}function G(t){return{latex:[t],type:e.typeTeXBraces}}function V(t){return{text:t,type:e.typeTeXComment}}function H(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return{name:t,arguments:n,type:e.typeTeXComm}}function F(t,e,n){return{type:t,symbol:e,arguments:n}}function Y(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return{name:t,latex:n,arguments:i,type:e.typeTeXEnv}}function q(t){var e=[];return U(t,e),e.join("")}function U(t,e){if(b(t))e.push("\\",t.name),t.arguments.forEach(function(t){return U(t,e)});else{if(x(t))throw new Error("not supported yet");if(k(t))e.push(t.startSymbol),t.latex.forEach(function(t){return U(t,e)}),e.push(t.endSymbol);else if(M(t))e.push("\n");else if(C(t))e.push(t.symbol),t.arguments&&t.arguments.forEach(function(t){return U(t,e)});else if(S(t))e.push("{"),t.latex.forEach(function(t){return U(t,e)}),e.push("}");else if(j(t))e.push("%"+t.text+"\n");else if(v(t))e.push(t.text);else{if(y(t))throw new Error("not supported yet");if(T(t))e.push("{"),t.latex.forEach(function(t){return U(t,e)}),e.push("}");else{if(!A(t))throw new Error("Did not recognize "+JSON.stringify(t));e.push("["),t.latex.forEach(function(t){return U(t,e)}),e.push("]")}}}}Object.defineProperty(e,"__esModule",{value:!0});var B=n(29),X=n(45);e.isMeasure=i,e.measureTypes={pt:!0,mm:!0,cm:!0,in:!0,ex:!0,em:!0},e.isMeasureType=r,e.isBuiltInMeasure=a,e.isCustomMeasure=o,e.mathTypes={Parentheses:"Parentheses",Square:"Square",Dollar:"Dollar"},e.isMathType=s,e.isNameHaving=l,e.isTextHaving=c,e.isLaTeXHaving=d,e.isArgumentHaving=u,e.typeTeXSeq="TeXSeq",e.typeTeXEnv="TeXEnv",e.typeTeXBraces="TeXBraces",e.typeTeXComment="TeXComment",e.typeTeXRaw="TeXRaw",e.typeTeXComm="TeXComm",e.typeTeXCommS="TeXCommS";var J;!function(t){t[t.SUP=0]="SUP",t[t.SUB=1]="SUB"}(J=e.SubOrSuperSymbol||(e.SubOrSuperSymbol={})),e.isSubOrSuperSymbol=h,e.fromStringLaTeX=function(t){return $(e.protectString(t))},e.protectString=function(t){for(var e=[],n=0;n<t.length;n++)e.push(f(t.charAt(n)));return e.join()},e.protectChar=f,e.isTypeHaving=p,e.isLaTeXBlock=_,e.isLaTeXNoRaw=g,e.isLaTeXRaw=m,e.isTeXRaw=v,e.isTeXChar=y,e.isTeXComm=b,e.isTeXCommS=w,e.isTeXEnv=x,e.isTeXMath=k,e.isTeXLineBreak=M,e.isSubOrSuperScript=C,e.isTeXBraces=S,e.isFixArg=T,e.isOptArg=A,e.isTeXComment=j,e.isTeXEmpty=E,e.newFixArg=O,e.newOptArg=L,e.newSymArg=N,e.newParArg=I,e.newMOptArg=P,e.newMSymArg=D,e.newMParArg=R,e.newCommandS=z,e.newTeXRaw=$,e.newTeXMath=W,e.newTeXBraces=G,e.newTeXMathDol=function(t){return W("Dollar","$","$",t)},e.newTeXComment=V,e.newTeXComm=H,e.newSubOrSuperScript=F,e.newTeXEnv=Y,e.stringifyLaTeX=q},function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0});var r=t.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),a=t.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return!n.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(t),!1)},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",i(e)}}),o=t.Collection.extend({model:r}),s=t.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var n=i("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&n.tooltip(e.attributes.tooltip_config);var r=e.get("options");r&&make_popupmenu(n,r)}),this}}),l=function(t,e){e||(e={});var i=new o(n.map(t,function(t){return new r(n.extend(t,e))}));return new s({collection:i})};e.default={IconButton:r,IconButtonView:a,IconButtonCollection:o,IconButtonMenuView:s,create_icon_buttons_menu:l}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t){function n(e,n){n=n||window.location.search.substr(1);var i=new RegExp(e+"=([^&#$]+)","g"),r=n.match(i);if(r&&r.length)return r=t.map(r,function(t){return decodeURIComponent(t.substr(e.length+1).replace(/\+/g," "))}),1===r.length?r[0]:r}function i(t){if(!t)return{};var e={};return t.split("&").forEach(function(t){var n=t.split("=");e[n[0]]=decodeURI(n[1])}),e}Object.defineProperty(e,"__esModule",{value:!0}),e.default={get:n,parse:i}}).call(e,n(1))},function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),a=i(r),o=n(2),s=i(o),l=n(18),c=function(t){return t&&t.__esModule?t:{default:t}}(l),d=s.Model.extend({initialize:function(t){var e=this.get("key");this.set("id",e);var n=a.find([{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0}],function(t){return t.key===e});n&&this.set(a.extend({},n,t)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",c.default.get_random_color()))},set_value:function(t,e){var n=this.get("type");"float"===n?t=parseFloat(t):"int"===n&&(t=parseInt(t,10)),this.set({value:t},e)}}),u=s.Collection.extend({model:d,to_key_value_dict:function(){var t={};return this.each(function(e){t[e.get("key")]=e.get("value")}),t},get_value:function(t){var e=this.get(t);if(e)return e.get("value")},set_value:function(t,e,n){var i=this.get(t);if(i)return i.set_value(e,n)},set_default_value:function(t,e){var n=this.get(t);if(n)return n.set("default_value",e)}},{from_models_and_saved_values:function(t,e){return e&&(t=a.map(t,function(t){return a.extend({},t,{value:e[t.key]})})),new u(t)}}),h=s.View.extend({className:"config-settings-view",render:function(){var e=this.$el;return this.collection.each(function(n,i){if(!n.get("hidden")){var r="param_"+i,o=n.get("type"),s=n.get("value"),l=t("<div class='form-row' />").appendTo(e);if(l.append(t("<label />").attr("for",r).text(n.get("label")+":")),"bool"===o)l.append(t('<input type="checkbox" />').attr("id",r).attr("name",r).attr("checked",s));else if("text"===o)l.append(t('<input type="text"/>').attr("id",r).val(s).click(function(){t(this).select()}));else if("select"===o){var d=t("<select />").attr("id",r);a.each(n.get("options"),function(e){t("<option/>").text(e.label).attr("value",e.value).appendTo(d)}),d.val(s),l.append(d)}else if("color"===o){var u=t("<div/>").appendTo(l),h=t("<input />").attr("id",r).attr("name",r).val(s).css("float","left").appendTo(u).click(function(e){t(".tooltip").removeClass("in");var n=t(this).siblings(".tooltip").addClass("in");n.css({left:t(this).position().left+t(this).width()+5,top:t(this).position().top-t(n).height()/2+t(this).height()/2}).show(),n.click(function(t){t.stopPropagation()}),t(document).bind("click.color-picker",function(){n.hide(),t(document).unbind("click.color-picker")}),e.stopPropagation()}),f=t("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(u).attr("title","Set new random color").tooltip(),p=t("<div class='tooltip right' style='position: absolute;' />").appendTo(u).hide(),_=t("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(p);t("<div class='tooltip-arrow'></div>").appendTo(p);var g=t.farbtastic(_,{width:100,height:100,callback:h,color:s});u.append(t("<div/>").css("clear","both")),function(t){f.click(function(){t.setColor(c.default.get_random_color())})}(g)}else l.append(t("<input />").attr("id",r).attr("name",r).val(s));n.help&&l.append(t("<div class='help'/>").text(n.help))}}),this},render_in_modal:function(e){var n=this,i=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc")},r=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc"),n.update_from_form()},a=function(t){27===(t.keyCode||t.which)?i():13===(t.keyCode||t.which)&&r()};t(window).bind("keypress.check_enter_esc",a),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:e||"Configure",body:this.$el,buttons:{Cancel:i,OK:r}})},update_from_form:function(){var t=this;this.collection.each(function(e,n){if(!e.get("hidden")){var i="param_"+n,r=t.$el.find("#"+i).val();"bool"===e.get("type")&&(r=t.$el.find("#"+i).is(":checked")),e.set_value(r)}})}});e.default={ConfigSetting:d,ConfigSettingCollection:u,ConfigSettingCollectionView:h}}).call(e,n(0))},function(t,e,n){"use strict";function i(t,e){function n(){var n=['<div class="loading-indicator">','<div class="loading-indicator-text">','<span class="fa fa-spinner fa-spin fa-lg"></span>','<span class="loading-indicator-message">loading...</span>',"</div>","</div>"].join("\n"),i=o(n).hide().css(e.css||{position:"fixed"}),r=i.children(".loading-indicator-text");return e.cover?(i.css({"z-index":2,top:t.css("top"),bottom:t.css("bottom"),left:t.css("left"),right:t.css("right"),opacity:.5,"background-color":"white","text-align":"center"}),r=i.children(".loading-indicator-text").css({"margin-top":"20px"})):(r=i.children(".loading-indicator-text").css({margin:"12px 0px 0px 10px",opacity:"0.85",color:"grey"}),r.children(".loading-indicator-message").css({margin:"0px 8px 0px 0px","font-style":"italic"})),i}var i=this;return e=a.default.extend({cover:!1},e||{}),i.show=function(e,r,a){return e=e||"loading...",r=r||"fast",t.parent().find(".loading-indicator").remove(),i.$indicator=n().insertBefore(t),i.message(e),i.$indicator.fadeIn(r,a),i},i.message=function(t){i.$indicator.find("i").text(t)},i.hide=function(t,e){return t=t||"fast",i.$indicator&&i.$indicator.length?i.$indicator.fadeOut(t,function(){i.$indicator.remove(),e&&e()}):e&&e(),i},i}Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=a.default,s=function(t){t.setElement(o('<div><div class="loading"></div></div>')),new i(t.$(".loading")).show()};e.default={LoadingIndicator:i,markViewAsLoading:s}},,,,,function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=n(9),a=i(r),o=n(1),s=i(o),l=n(5),c=function(t){return t&&t.__esModule?t:{default:t}}(l),d=a.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,maximumTextLength:100,initialData:""},initialize:function(t){if(this.options=c.default.merge(t,this.optionsDefault),this.setElement(this._template(this.options)),!this.options.container)return void console.log("ui-select::initialize() : container not specified.");if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var e=this;this.options.onchange&&this.$el.on("change",function(){e.options.onchange(e.value())})}},value:function(t){var e=this._getValue();void 0!==t&&this._setValue(t);var n=this._getValue();return n!=e&&this.options.onchange&&this.options.onchange(n),n},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(t){this.select_data.push({id:t.id,text:t.text}),this._refresh()},del:function(t){var e=this._getIndex(t);-1!=e&&(this.select_data.splice(e,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(t){this.select_data=[];for(var e in t.data)this.select_data.push(t.data[e]);this._refresh()},_refresh:function(){var t=this,e=void 0;if(this.options.multiple)e={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData},this.$el.select2(e);else{this.select_data&&this.select_data.map(function(e){var n=t.options.maximumTextLength+3;if(e.text&&e.text.length>n){var i=e.text.indexOf("("+e.id+")");i=-1!=i&&i<n?i:n;var r=e.text.substring(0,i).replace(/[\ \.]*$/,"");e.text=r+"...("+e.id+")"}});var n=this._getValue();e={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0},this.$el.select2(e),this._setValue(n)}},_getIndex:function(t){s.findIndex(this.select_data,{id:t})},_getValue:function(){return this.$el.select2("val")},_setValue:function(t){-1==this._getIndex(t)&&this.select_data.length>0&&(t=this.select_data[0].id),this.$el.select2("val",t)},_template:function(t){return'<input type="hidden" value="'+this.options.initialData+'"/>'}});e.default={View:d}},,function(t,e,n){"use strict";(function(t,n,i,r){Object.defineProperty(e,"__esModule",{value:!0});var a=t.View.extend({initialize:function(t,e){this.$button=t,this.$button.length||(this.$button=n("<div/>")),this.options=e||[],this.$button.data("popupmenu",this);var i=this;this.$button.click(function(t){return n(".popmenu-wrapper").remove(),i._renderAndShow(t),!1})},_renderAndShow:function(t){this.render(),this.$el.appendTo("body").css(this._getShownPosition(t)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var t=this;this.$el.find("li").each(function(e,i){var r=t.options[e];r.func&&n(this).children("a.popupmenu-option").click(function(e){r.func.call(t,e,r),e.preventDefault()})})}return this},template:function(t,e){return['<ul id="',t,'-menu" class="dropdown-menu">',this._templateOptions(e),"</ul>"].join("")},_templateOptions:function(t){return t.length?i.map(t,function(t){return t.divider?'<li class="divider"></li>':t.header?['<li class="head"><a href="javascript:void(0);">',t.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',t.href||"javascript:void(0);",'"',t.target?' target="'+t.target+'"':"",">",t.checked?'<span class="fa fa-check"></span>':"",t.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(t){var e=this.$el.width(),i=t.pageX-e/2;return i=Math.min(i,n(document).scrollLeft()+n(window).width()-e-5),i=Math.max(i,n(document).scrollLeft()+5),{top:t.pageY,left:i}},_setUpCloseBehavior:function(){function t(t){if(n(document).off("click.close_popup"),window&&window.parent!==window)try{n(window.parent.document).off("click.close_popup")}catch(t){}else try{n("iframe#galaxy_main").contents().off("click.close_popup")}catch(t){}e.remove()}var e=this;if(n("html").one("click.close_popup",t),window&&window.parent!==window)try{n(window.parent.document).find("html").one("click.close_popup",t)}catch(t){}else try{n("iframe#galaxy_main").contents().one("click.close_popup",t)}catch(t){}},addItem:function(t,e){return e=e>=0?e:this.options.length,this.options.splice(e,0,t),this},removeItem:function(t){return t>=0&&this.options.splice(t,1),this},findIndexByHtml:function(t){for(var e=0;e<this.options.length;e++)if(i.has(this.options[e],"html")&&this.options[e].html===t)return e;return null},findItemByHtml:function(t){return this.options[this.findIndexByHtml(t)]},toString:function(){return"PopupMenu"}});a.create=function(t,e){return new a(t,e)},a.make_popupmenu=function(t,e){var o=[];return i.each(e,function(t,e){var n={html:e};null===t?n.header=!0:"function"===r.type(t)&&(n.func=t),o.push(n)}),new a(n(t),o)},a.convertLinksToOptions=function(t,e){t=n(t),e=e||"a";var i=[];return t.find(e).each(function(t,e){var r={},a=n(t);if(r.html=a.text(),a.attr("href")){var o=a.attr("href"),s=a.attr("target"),l=a.attr("confirm");r.func=function(){if(!l||confirm(l))switch(s){case"_parent":window.parent.location=o;break;case"_top":window.top.location=o;break;default:window.location=o}}}i.push(r)}),i},a.fromExistingDom=function(t,e,i){t=n(t),e=n(e);var r=a.convertLinksToOptions(e,i);return e.remove(),new a(t,r)},a.make_popup_menus=function(t,e,i){t=t||document,e=e||"div[popupmenu]",i=i||function(t,e){return"#"+t.attr("popupmenu")};var r=[];return n(t).find(e).each(function(){var e=n(this),o=n(t).find(i(e,t));r.push(a.fromDom(o,e)),o.addClass("popup")}),r},e.default=a}).call(e,n(2),n(0),n(1),n(0))},,function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(35),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(90),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(91),l=n(28);e.default={props:{source:{type:String,required:!0},id:{type:String,required:!0},viewRender:{type:Boolean,requried:!1,default:!0}},data:function(){return{citations:[],content:"",errors:[]}},computed:{formattedReferences:function(){var t=this;return this.citations.reduce(function(e,n){return e.concat('<p class="formatted-reference">'+t.formattedReference(n)+"</p>")},"")}},created:function(){var e=this;r.default.get(Galaxy.root+"api/"+this.source+"/"+this.id+"/citations").then(function(n){e.content="";var i=!0,r=!1,a=void 0;try{for(var s,l=n.data[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value;try{var d={fields:{},entryType:void 0},u=o.toJSON(c.content);if(u){u=t.first(u),d.entryType=u.entryType||void 0;for(var h in u.entryTags)d.fields[h.toLowerCase()]=u.entryTags[h]}e.citations.push(d),e.content+=c.content}catch(t){console.warn("Error parsing bibtex: "+t)}}}catch(t){r=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw a}}}).catch(function(t){console.error(t)})},methods:{formattedReference:function(t){var e=t.entryType,n=t.fields,i="",r=this._asSentence((n.author?n.author:"")+(n.year?" ("+n.year+")":""))+" ",a=n.title||"",o=n.pages?"pp. "+n.pages:"",c=n.address;if("article"==e){var d=(n.volume?n.volume:"")+(n.number?" ("+n.number+")":"")+(o?", "+o:"");i=r+this._asSentence(a)+(n.journal?"In <em>"+n.journal+", ":"")+this._asSentence(d)+this._asSentence(n.address)+"</em>"}else i="inproceedings"==e||"proceedings"==e?r+this._asSentence(a)+(n.booktitle?"In <em>"+n.booktitle+", ":"")+(o||"")+(c?", "+c:"")+".</em>":"mastersthesis"==e||"phdthesis"==e?r+this._asSentence(a)+(n.howpublished?n.howpublished+". ":"")+(n.note?n.note+".":""):"techreport"==e?r+this._asSentence(a)+this._asSentence(n.institution)+this._asSentence(n.number)+this._asSentence(n.type):"book"==e||"inbook"==e||"incollection"==e?r+" "+this._formatBookInfo(n):r+" "+this._asSentence(a)+this._asSentence(n.howpublished)+this._asSentence(n.note);var u="";n.doi&&(u="http://dx.doi.org/"+n.doi,i+='[<a href="'+u+'" target="_blank">doi:'+n.doi+"</a>]");var h=n.url||u;return h&&(i+='[<a href="'+h+'" target="_blank">Link</a>]'),(0,s.convertLaTeX)({onError:function(t,e){return"{"+(0,l.stringifyLaTeX)(e)+"}"}},i)},_formatBookInfo:function(t){var e="";return t.chapter&&(e+=t.chapter+" in "),t.title&&(e+="<em>"+t.title+"</em>"),t.editor&&(e+=", Edited by "+t.editor+", "),t.publisher&&(e+=", "+t.publisher),t.pages&&(e+=", pp. "+t.pages),t.series&&(e+=", <em>"+t.series+"</em>"),t.volume&&(e+=", Vol."+t.volume),t.issn&&(e+=", ISBN: "+t.issn),e+"."},_asSentence:function(t){return t&&t.trim()?t+". ":""},toggleViewRender:function(){this.viewRender=!this.viewRender}}}}).call(e,n(1))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.supportedMarkups={ascii:!0,unicode:!0,html:!0}},function(t,e,n){"use strict";function i(t){return r(e.defaultCategories,t)}function r(t,e){for(var n=[],i=0;i<e.length;i++){var r=e.charAt(i);n.push({string:r,category:t(r)})}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.defaultCategories=function(t){switch(t){case"\\":return 0;case"{":return 1;case"}":return 2;case"$":return 3;case"&":return 4;case"\r":return 5;case"#":return 6;case"^":return 7;case"_":return 8;case"\0":return 9;case" ":return 10;case"~":return 13;case"%":return 14;case"d":return 15;default:return 11}},e.convertToTeXCharsDefault=i,e.convertToTeXChars=r},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function i(t){if(!(this instanceof i))return new i(t);this._=t}function r(t){return t instanceof i}function a(t){return"[object Array]"==={}.toString.call(t)}function o(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function s(t,e){return{status:!1,index:-1,value:null,furthest:t,expected:[e]}}function l(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?d(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function c(t,e){var n=t.slice(0,e).split("\n");return{offset:e,line:n.length,column:n[n.length-1].length+1}}function d(t,e){var n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;for(var r={},a=0;a<n;a++)r[t[a]]=!0;for(var o=0;o<i;o++)r[e[o]]=!0;var s=[];for(var l in r)r.hasOwnProperty(l)&&s.push(l);return s.sort(),s}function u(t){if(!r(t))throw new Error("not a parser: "+t)}function h(t){if(!a(t))throw new Error("not an array: "+t)}function f(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function p(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=b(t),n=0;n<e.length;n++){var i=e.charAt(n);if("i"!==i&&"m"!==i&&"u"!==i)throw new Error('unsupported regexp flag "'+i+'": '+t)}}function _(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function g(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function m(t){return 1===t.length?t[0]:"one of "+t.join(", ")}function v(t,e){var n=e.index,i=n.offset;if(i===t.length)return", got the end of the input";var r=i>0?"'...":"'",a=t.length-i>12?"...'":"'";return" at line "+n.line+" column "+n.column+", got "+r+t.slice(i,i+12)+a}function y(t,e){return"expected "+m(e.expected)+v(t,e)}function b(t){var e=""+t;return e.slice(e.lastIndexOf("/")+1)}function w(t){return RegExp("^(?:"+t.source+")",b(t))}function x(){for(var t=[].slice.call(arguments),e=t.length,n=0;n<e;n+=1)u(t[n]);return i(function(n,i){for(var r,a=new Array(e),s=0;s<e;s+=1){if(r=l(t[s]._(n,i),r),!r.status)return r;a[s]=r.value,i=r.index}return l(o(i,a),r)})}function k(){for(var t={},e=0,n=[].slice.call(arguments),s=n.length,c=0;c<s;c+=1){var d=n[c];if(!r(d)){if(a(d)&&2===d.length&&"string"==typeof d[0]&&r(d[1])){var u=d[0];if(t[u])throw new Error("seqObj: duplicate key "+u);t[u]=!0,e++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===e)throw new Error("seqObj expects at least one named parser, found zero");return i(function(t,e){for(var i,r={},c=0;c<s;c+=1){var d,u;if(a(n[c])?(d=n[c][0],u=n[c][1]):(d=null,u=n[c]),i=l(u._(t,e),i),!i.status)return i;d&&(r[d]=i.value),e=i.index}return l(o(e,r),i)})}function M(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return _(e),x.apply(null,t).map(function(t){return e.apply(null,t)})}function C(t){var e={};for(var n in t)({}).hasOwnProperty.call(t,n)&&function(n){var i=function(){return t[n](e)};e[n]=G(i)}(n);return e}function S(){var t=[].slice.call(arguments),e=t.length;if(0===e)return L("zero alternates");for(var n=0;n<e;n+=1)u(t[n]);return i(function(e,n){for(var i,r=0;r<t.length;r+=1)if(i=l(t[r]._(e,n),i),i.status)return i;return i})}function T(t,e){return A(t,e).or(O([]))}function A(t,e){u(t),u(e);var n=e.then(t).many();return t.chain(function(t){return n.map(function(e){return[t].concat(e)})})}function j(t){g(t);var e="'"+t+"'";return i(function(n,i){var r=i+t.length,a=n.slice(i,r);return a===t?o(r,a):s(i,e)})}function E(t,e){p(t),arguments.length>=2?f(e):e=0;var n=w(t),r=""+t;return i(function(t,i){var a=n.exec(t.slice(i));if(a){if(0<=e&&e<=a.length){var l=a[0],c=a[e];return o(i+l.length,c)}return s(i,"valid match group (0 to "+a.length+") in "+r)}return s(i,r)})}function O(t){return i(function(e,n){return o(n,t)})}function L(t){return i(function(e,n){return s(n,t)})}function N(t){if(r(t))return i(function(e,n){var i=t._(e,n);return i.index=n,i.value="",i});if("string"==typeof t)return N(j(t));if(t instanceof RegExp)return N(E(t));throw new Error("not a string, regexp, or parser: "+t)}function I(t){return u(t),i(function(e,n){var i=t._(e,n),r=e.slice(n,i.index);return i.status?s(n,'not "'+r+'"'):o(n,null)})}function P(t){return _(t),i(function(e,n){var i=e.charAt(n);return n<e.length&&t(i)?o(n+1,i):s(n,"a character matching "+t)})}function D(t){return P(function(e){return t.indexOf(e)>=0})}function R(t){return P(function(e){return t.indexOf(e)<0})}function z(t){return i(t(o,s))}function $(t,e){return P(function(n){return t<=n&&n<=e}).desc(t+"-"+e)}function W(t){return _(t),i(function(e,n){for(var i=n;i<e.length&&t(e.charAt(i));)i++;return o(i,e.slice(n,i))})}function G(t,e){arguments.length<2&&(e=t,t=void 0);var n=i(function(t,i){return n._=e()._,n._(t,i)});return t?n.desc(t):n}function V(){return L("fantasy-land/empty")}var H=i.prototype;H.parse=function(t){if("string"!=typeof t)throw new Error(".parse must be called with a string as its argument");var e=this.skip(U)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:c(t,e.furthest),expected:e.expected}},H.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var n=y(t,e),i=new Error(n);throw i.type="ParsimmonError",i.result=e,i},H.or=function(t){return S(this,t)},H.trim=function(t){return this.wrap(t,t)},H.wrap=function(t,e){return M(t,this,e,function(t,e){return e})},H.thru=function(t){return t(this)},H.then=function(t){return u(t),x(this,t).map(function(t){return t[1]})},H.many=function(){var t=this;return i(function(e,n){for(var i=[],r=void 0;;){if(r=l(t._(e,n),r),!r.status)return l(o(n,i),r);n=r.index,i.push(r.value)}})},H.tie=function(){return this.map(function(t){h(t);for(var e="",n=0;n<t.length;n++)g(t[n]),e+=t[n];return e})},H.times=function(t,e){var n=this;return arguments.length<2&&(e=t),f(t),f(e),i(function(i,r){for(var a=[],s=void 0,c=void 0,d=0;d<t;d+=1){if(s=n._(i,r),c=l(s,c),!s.status)return c;r=s.index,a.push(s.value)}for(;d<e&&(s=n._(i,r),c=l(s,c),s.status);d+=1)r=s.index,a.push(s.value);return l(o(r,a),c)})},H.result=function(t){return this.map(function(){return t})},H.atMost=function(t){return this.times(0,t)},H.atLeast=function(t){return M(this.times(t),this.many(),function(t,e){return t.concat(e)})},H.map=function(t){_(t);var e=this;return i(function(n,i){var r=e._(n,i);return r.status?l(o(r.index,t(r.value)),r):r})},H.skip=function(t){return x(this,t).map(function(t){return t[0]})},H.mark=function(){return M(F,this,F,function(t,e,n){return{start:t,value:e,end:n}})},H.node=function(t){return M(F,this,F,function(e,n,i){return{name:t,value:n,start:e,end:i}})},H.sepBy=function(t){return T(this,t)},H.sepBy1=function(t){return A(this,t)},H.lookahead=function(t){return this.skip(N(t))},H.notFollowedBy=function(t){return this.skip(I(t))},H.desc=function(t){var e=this;return i(function(n,i){var r=e._(n,i);return r.status||(r.expected=[t]),r})},H.fallback=function(t){return this.or(O(t))},H.ap=function(t){return M(t,this,function(t,e){return t(e)})},H.chain=function(t){var e=this;return i(function(n,i){var r=e._(n,i);return r.status?l(t(r.value)._(n,r.index),r):r})},H.concat=H.or,H.empty=V,H.of=O,H["fantasy-land/ap"]=H.ap,H["fantasy-land/chain"]=H.chain,H["fantasy-land/concat"]=H.concat,H["fantasy-land/empty"]=H.empty,H["fantasy-land/of"]=H.of,H["fantasy-land/map"]=H.map;var F=i(function(t,e){return o(e,c(t,e))}),Y=i(function(t,e){return e>=t.length?s(e,"any character"):o(e+1,t.charAt(e))}),q=i(function(t,e){return o(t.length,t.slice(e))}),U=i(function(t,e){return e<t.length?s(e,"EOF"):o(e,null)}),B=E(/[0-9]/).desc("a digit"),X=E(/[0-9]*/).desc("optional digits"),J=E(/[a-z]/i).desc("a letter"),Q=E(/[a-z]*/i).desc("optional letters"),K=E(/\s*/).desc("optional whitespace"),Z=E(/\s+/).desc("whitespace");i.all=q,i.alt=S,i.any=Y,i.createLanguage=C,i.custom=z,i.digit=B,i.digits=X,i.empty=V,i.eof=U,i.fail=L,i.formatError=y,i.index=F,i.isParser=r,i.lazy=G,i.letter=J,i.letters=Q,i.lookahead=N,i.makeFailure=s,i.makeSuccess=o,i.noneOf=R,i.notFollowedBy=I,i.of=O,i.oneOf=D,i.optWhitespace=K,i.Parser=i,i.range=$,i.regex=E,i.regexp=E,i.sepBy=T,i.sepBy1=A,i.seq=x,i.seqMap=M,i.seqObj=k,i.string=j,i.succeed=O,i.takeWhile=W,i.test=P,i.whitespace=Z,i["fantasy-land/empty"]=V,i["fantasy-land/of"]=O,t.exports=i}])})},function(t,e,n){"use strict";function i(t){return new Error("I do not know command "+t)}Object.defineProperty(e,"__esModule",{value:!0}),e.unknownCommandError=i},function(t,e,n){"use strict";function i(t,e,n,i){return{name:t,optionalArguments:e,argumentCount:n,apply:i}}function r(t,e,n){return{name:t,optionalArguments:e,argumentCount:n}}function a(t,e){return{name:t,optionalArguments:0,argumentCount:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.createCommandHandler=i,e.createKnownCommandWithOptArgs=r,e.createKnownCommandWithArgs=a},function(t,e,n){"use strict";function i(t){return"bb"===t||"mathbb"===t||"textbb"===t}function r(t){return"bf"===t||"mathbf"===t||"textbf"===t}function a(t){return"mono"===t}function o(t){return"frak"===t||"mathfrak"===t||"textfrak"===t}function s(t){return"it"===t||"mathit"===t||"textit"===t}function l(t){return"tt"===t||"mathtt"===t||"texttt"===t}function c(t){return"cal"===t||"mathcal"===t||"textcal"===t}function d(t){return"sup"===t||"mathsup"===t||"textsup"===t||"superscript"===t||"mathsuperscript"===t||"textsuperscript"===t}function u(t){return"sub"===t||"mathsub"===t||"textsub"===t||"subscript"===t||"mathsubscript"===t||"textsubscript"===t}function h(t){return e.formattingText.hasOwnProperty(t)||e.formattingMath.hasOwnProperty(t)||e.formattingNoMode.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.formattingText={textbb:!0,textbf:!0,textfrak:!0,textit:!0,texttt:!0,textcal:!0,textsup:!0,textsub:!0,textsuperscript:!0,textsubscript:!0},e.formattingNoMode={bb:!0,bf:!0,frak:!0,it:!0,tt:!0,cal:!0,mono:!0,sup:!0,sub:!0,superscript:!0,subscript:!0},e.formattingMath={mathbb:!0,mathbf:!0,mathfrak:!0,mathit:!0,mathtt:!0,mathcal:!0,mathsup:!0,mathsub:!0,mathsuperscript:!0,mathsubscript:!0},e.isBbCmd=i,e.isBfCmd=r,e.isMonoCmd=a,e.isFrakCmd=o,e.isItCmd=s,e.isTtCmd=l,e.isCalCmd=c,e.isSupCmd=d,e.isSubCmd=u,e.isFormattingCmd=h},function(t,e,n){"use strict";function i(t){return e.superscriptCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.superscriptCharacters={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",a:"ᵃ",b:"ᵇ",c:"ᶜ",d:"ᵈ",e:"ᵉ",f:"ᶠ",g:"ᵍ",h:"ʰ",i:"ⁱ",j:"ʲ",k:"ᵏ",l:"ˡ",m:"ᵐ",n:"ⁿ",o:"ᵒ",p:"ᵖ",r:"ʳ",s:"ˢ",t:"ᵗ",u:"ᵘ",v:"ᵛ",w:"ʷ",x:"ˣ",y:"ʸ",z:"ᶻ",A:"ᴬ",B:"ᴮ",D:"ᴰ",E:"ᴱ",G:"ᴳ",H:"ᴴ",I:"ᴵ",J:"ᴶ",K:"ᴷ",L:"ᴸ",M:"ᴹ",N:"ᴺ",O:"ᴼ",P:"ᴾ",R:"ᴿ",T:"ᵀ",U:"ᵁ",V:"ⱽ",W:"ᵂ","α":"ᵅ","β":"ᵝ","γ":"ᵞ","δ":"ᵟ","∊":"ᵋ","θ":"ᶿ","ι":"ᶥ","Φ":"ᶲ","φ":"ᵠ","χ":"ᵡ"},e.isSuperscriptCharacter=i,e.translateCharToSuperscript=function(t){return i(t)?e.superscriptCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.oneArgsCommands.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(126),a=n(127),o=n(49);e.oneArgsCommands=Object.assign({},r.spaceCmds1arg,o.formattingText,o.formattingMath,o.formattingNoMode,a.diacriticsTextMode,a.diacriticsMathMode,{cyrchar:!0,vec:!0,mono:!0}),e.is1argsCommand=i},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=r.default,o=function(e){e=e||{},e.tooltipConfig=e.tooltipConfig||{placement:"bottom"},e.classes=["icon-btn"].concat(e.classes||[]),e.disabled&&e.classes.push("disabled");var n=['<a class="',e.classes.join(" "),'"',e.title?' title="'+e.title+'"':"",!e.disabled&&e.target?' target="'+e.target+'"':"",' href="',!e.disabled&&e.href?e.href:"javascript:void(0);",'">','<span class="fa ',e.faIcon,'"></span>',"</a>"].join(""),i=a(n).tooltip(e.tooltipConfig);return t.isFunction(e.onclick)&&i.click(e.onclick),i};e.default=o}).call(e,n(1))},,function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(18),l=r(s),c=n(14),d=r(c),u=n(63),h=(r(u),{hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}}),f=t.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(t){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new f(this.toJSON())},set_value:function(t){this.set("value",t||"")}}),p=t.Collection.extend({model:f}),_=f.extend({}),g=f.extend({set_value:function(t){this.set("value",parseInt(t,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),m=g.extend({set_value:function(t){this.set("value",parseFloat(t))}}),v=f.extend({get_samples:function(){return o.map(this.get("options"),function(t){return t[0]})}});f.subModelTypes={integer:g,float:m,data:_,select:v};var y=t.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(t){this.set("inputs",new p(o.map(t.inputs,function(t){return new(f.subModelTypes[t.type]||f)(t)})))},toJSON:function(){var e=t.Model.prototype.toJSON.call(this);return e.inputs=this.get("inputs").map(function(t){return t.toJSON()}),e},remove_inputs:function(t){var e=this,n=e.get("inputs").filter(function(e){return-1!==t.indexOf(e.get("type"))});e.get("inputs").remove(n)},copy:function(e){var n=new y(this.toJSON());if(e){var i=new t.Collection;n.get("inputs").each(function(t){t.get_samples()&&i.push(t)}),n.set("inputs",i)}return n},apply_search_results:function(t){return-1!==o.indexOf(t,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(t,e){this.get("inputs").find(function(e){return e.get("name")===t}).set("value",e)},set_input_values:function(t){var e=this;o.each(o.keys(t),function(n){e.set_input_value(n,t[n])})},run:function(){return this._run()},rerun:function(t,e){return this._run({action:"rerun",target_dataset_id:t.id,regions:e})},get_inputs_dict:function(){var t={};return this.get("inputs").each(function(e){t[e.get("name")]=e.get("value")}),t},_run:function(t){var e=o.extend({tool_id:this.id,inputs:this.get_inputs_dict()},t),n=i.Deferred(),r=new l.default.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});return i.when(r.go()).then(function(t){n.resolve(new d.default.DatasetCollection(t))}),n}});o.extend(y.prototype,h);var b=(t.View.extend({}),t.Collection.extend({model:y})),w=t.Model.extend(h),x=t.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){o.each(this.attributes.elems,function(t){t.show()}),this.show(),this.set("open",!1)},apply_search_results:function(t){var e,n=!0;o.each(this.attributes.elems,function(i){i instanceof w?(e=i,e.hide()):i instanceof y&&i.apply_search_results(t)&&(n=!1,e&&e.show())}),n?this.hide():(this.show(),this.set("open",!0))}});o.extend(x.prototype,h);var k=t.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var t=this.attributes.query;if(t.length<this.attributes.min_chars_for_search)return void this.set("results",null);var e=t;this.timer&&clearTimeout(this.timer),i("#search-clear-btn").hide(),i("#search-spinner").show();var n=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+e),i.get(n.urlRoot,{q:e},function(t){n.set("results",t),i("#search-spinner").hide(),i("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});o.extend(k.prototype,h);var M=t.Model.extend({initialize:function(e){this.attributes.tool_search=e.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=e.tools,this.attributes.layout=new t.Collection(this.parse(e.layout))},parse:function(t){var e=this,n=function t(n){var i=n.model_class;if(i.indexOf("Tool")===i.length-4)return e.attributes.tools.get(n.id);if("ToolSection"===i){var r=o.map(n.elems,t);return n.elems=r,new x(n)}return"ToolSectionLabel"===i?new w(n):void 0};return o.map(t,n)},clear_search_results:function(){this.get("layout").each(function(t){t instanceof x?t.clear_search_results():t.show()})},apply_search_results:function(){var t=this.get("tool_search").get("results");if(null===t)return void this.clear_search_results();var e=null;this.get("layout").each(function(n){n instanceof w?(e=n,e.hide()):n instanceof y?n.apply_search_results(t)&&e&&e.show():(e=null,n.apply_search_results(t))})}}),C=t.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),S=C.extend({tagName:"div",render:function(){var t=i("<div/>");t.append(L.tool_link(this.model.toJSON()));var e=this.model.get("form_style",null);if("upload1"===this.model.id)t.find("a").on("click",function(t){t.preventDefault(),Galaxy.upload.show()});else if("regular"===e){var n=this;t.find("a").on("click",function(t){t.preventDefault(),Galaxy.router.push("/",{tool_id:n.model.id,version:n.model.get("version")})})}return this.$el.append(t),this}}),T=C.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(i("<span/>").text(this.model.attributes.text)),this}}),A=C.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){C.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(L.panel_section(this.model.toJSON()));var t=this.$el.find(".toolSectionBody");return o.each(this.model.attributes.elems,function(e){if(e instanceof y){var n=new S({model:e,className:"toolTitle"});n.render(),t.append(n.$el)}else if(e instanceof w){var i=new T({model:e});i.render(),t.append(i.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),j=t.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","change :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(L.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),i("#messagebox").is(":visible")&&this.$el.css("top","95px"),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(t){if(this.model.attributes.clear_key&&this.model.attributes.clear_key===t.which)return this.clear(),!1;this.model.set("query",this.$el.find(":input").val())}}),E=t.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var t=this,e=new j({model:this.model.get("tool_search")});return e.render(),t.$el.append(e.$el),this.model.get("layout").each(function(e){if(e instanceof x){var n=new A({model:e});n.render(),t.$el.append(n.$el)}else if(e instanceof y){var i=new S({model:e,className:"toolTitleNoSection"});i.render(),t.$el.append(i.$el)}else if(e instanceof w){var r=new T({model:e});r.render(),t.$el.append(r.$el)}}),t.$el.find("a.tool-link").click(function(e){var n=i(this).attr("class").split(/\s+/)[0],r=t.model.get("tools").get(n);t.trigger("tool_link_click",e,r)}),this},handle_search_results:function(){var t=this.model.get("tool_search").get("results");t&&0===t.length?i("#search-no-results").show():i("#search-no-results").hide()}}),O=t.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(L.tool_form(this.model.toJSON()))}}),L=(t.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new E({collection:this.collection}),this.tool_form_view=new O},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var t=this;this.tool_panel_view.on("tool_link_click",function(e,n){e.preventDefault(),t.show_tool(n)})},show_tool:function(t){var e=this;t.fetch().done(function(){e.tool_form_view.model=t,e.tool_form_view.render(),e.tool_form_view.$el.show(),i("#left").width("650px")})}}),{tool_search:o.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:o.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:o.template(['<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">','<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="badge badge-default badge-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<span class="tool-old-link">',"<%- name %>","</span>"," <%- description %>","</a>"].join("")),tool_form:o.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});e.default={ToolParameter:f,IntegerToolParameter:g,SelectToolParameter:v,Tool:y,ToolCollection:b,ToolSearch:k,ToolPanel:M,ToolPanelView:E,ToolFormView:O}}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(5),l=(r(s),n(152)),c=r(l),d=n(10),u=r(d),h=n(26),f=r(h),p=n(25),_=r(p),g=n(66),m=r(g),v=n(40),y=r(v);e.default=f.default.extend({initialize:function(t){var e=this;this.deferred=new c.default,f.default.prototype.initialize.call(this,t),this._update(this.model.get("initialmodel")),this.model.get("listen_to_history")&&parent.Galaxy&&parent.Galaxy.currHistoryPanel&&this.listenTo(parent.Galaxy.currHistoryPanel.collection,"change",function(){e.model.get("onchange")()}),this.$el.on("remove",function(){e._destroy()})},_update:function(t){var e=this;t=t||this.model.get("buildmodel"),t?(this.deferred.reset(),this.deferred.execute(function(n){t(n,e),n.then(function(){e._render()})})):this._render()},_destroy:function(){var t=this;this.$el.off().hide(),this.deferred.execute(function(){f.default.prototype.remove.call(t),Galaxy.emit.debug("tool-form-base::_destroy()","Destroy view.")})},_render:function(){var e=this,n=this.model.attributes;this.model.set({title:n.fixed_title||"<b>"+n.name+"</b> "+n.description+" (Galaxy Version "+n.version+")",operations:!n.hide_operations&&this._operations(),onchange:function(){e.deferred.reset(),e.deferred.execute(function(t){e.model.get("postchange")(t,e)})}}),this.render(),this.model.get("collapsible")||this.$el.append(t("<div/>").addClass("ui-margin-top-large").append(this._footer())),this.show_message&&this.message.update({status:"success",message:"Now you are using '"+n.name+"' version "+n.version+", id '"+n.id+"'.",persistent:!1}),this.show_message=!0},_operations:function(){var t=this,e=this.model.attributes,n=new u.default.ButtonMenu({icon:"fa-cubes",title:!e.narrow&&"Versions"||null,tooltip:"Select another tool version"});if(!e.sustain_version&&e.versions&&e.versions.length>1)for(var i in e.versions){var r=e.versions[i];r!=e.version&&n.addMenu({title:"Switch to "+r,version:r,icon:"fa-cube",onclick:function(){t.model.set("id",e.id.replace(e.version,this.version)),t.model.set("version",this.version),t._update()}})}else n.$el.hide();var a=new u.default.ButtonMenu({id:"options",icon:"fa-caret-down",title:!e.narrow&&"Options"||null,tooltip:"View available options"});return e.biostar_url&&(a.addMenu({icon:"fa-question-circle",title:"Question?",onclick:function(){window.open(e.biostar_url+"/p/new/post/")}}),a.addMenu({icon:"fa-search",title:(0,o.default)("Search"),onclick:function(){window.open(e.biostar_url+"/local/search/page/?q="+e.name)}})),a.addMenu({icon:"fa-share",title:(0,o.default)("Share"),onclick:function(){prompt("Copy to clipboard: Ctrl+C, Enter",window.location.origin+Galaxy.root+"root?tool_id="+e.id)}}),Galaxy.user&&Galaxy.user.get("is_admin")&&a.addMenu({icon:"fa-download",title:(0,o.default)("Download"),onclick:function(){window.location.href=Galaxy.root+"api/tools/"+e.id+"/download"}}),e.requirements&&e.requirements.length>0&&a.addMenu({icon:"fa-info-circle",title:(0,o.default)("Requirements"),onclick:function(){!this.requirements_visible||t.portlet.collapsed?(this.requirements_visible=!0,t.portlet.expand(),t.message.update({persistent:!0,message:t._templateRequirements(e),status:"info"})):(this.requirements_visible=!1,t.message.update({message:""}))}}),e.sharable_url&&a.addMenu({icon:"fa-external-link",title:(0,o.default)("See in Tool Shed"),onclick:function(){window.open(e.sharable_url)}}),_.default.load({type:"tool-menu",callback:function(t){t.each(function(t){var n=t.toJSON();n.activate&&n.config.function&&a.addMenu({icon:n.config.icon,title:n.config.title,onclick:function(){new Function("options",n.config.function)(e)}})})}}),{menu:a,versions:n}},_footer:function(){var e=this.model.attributes,n=t("<div/>").append(this._templateHelp(e));if(e.citations){var i=y.default.extend(m.default),r=document.createElement("div");n.append(r),new i({propsData:{id:e.id,source:"tools"}}).$mount(r)}return n},_templateHelp:function(e){var n=t("<div/>").addClass("ui-form-help").append(e.help);return n.find("a").attr("target","_blank"),n.find("img").each(function(){var e=t(this).attr("src");-1!==e.indexOf("admin_toolshed")&&t(this).attr("src",Galaxy.root+e)}),n},_templateRequirements:function(e){var n=e.requirements.length;if(n>0){var r="This tool requires ";i.each(e.requirements,function(t,e){r+=t.name+(t.version?" (Version "+t.version+")":"")+(e<n-2?", ":e==n-2?" and ":"")});var a=t("<a/>").attr("target","_blank").attr("href","https://galaxyproject.org/tools/requirements/").text("here");return t("<span/>").append(r+". Click ").append(a).append(" for more information.")}return"No requirements found."}})}).call(e,n(0),n(1))},,function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(175),o=r(a),s=n(145),l=r(s),c=n(153),d=r(c),u=n(217),h=r(u),f=n(184),p=r(f),_=n(6),g=r(_),m=n(86),v=r(m),y=n(1),b=i(y),w=n(2),x=i(w),k=window.localStorage.getItem("historyContentsLimitPerPageDefault")||500,M=o.default.PaginatedCollection,C=M.extend(g.default.LoggableMixin).extend({_logNamespace:"history",limitPerPage:k,limitPerProgressiveFetch:k,order:"hid",urlRoot:Galaxy.root+"api/histories",url:function(){return this.urlRoot+"/"+this.historyId+"/contents"},initialize:function(t,e){this.on({"sync add":this.trackJobStates}),e=e||{},M.prototype.initialize.call(this,t,e),this.history=e.history||null,this.setHistoryId(e.historyId||null),this.includeDeleted=e.includeDeleted||this.includeDeleted,this.includeHidden=e.includeHidden||this.includeHidden,this.model.prototype.idAttribute="type_id"},trackJobStates:function(){var t=this;this.each(function(e){if(!e.has("job_states_summary")&&"dataset_collection"===e.attributes.history_content_type){var n=e.attributes.job_source_type,i=e.attributes.job_source_id;if(n&&t.jobStateSummariesCollection){t.jobStateSummariesCollection.add({id:i,model:n,history_id:t.history_id,collection_id:e.attributes.id});var r=t.jobStateSummariesCollection.get(i);e.jobStatesSummary=r}}})},model:function(t,e){return"dataset"===t.history_content_type?new l.default.HistoryDatasetAssociation(t,e):"dataset_collection"===t.history_content_type?new d.default.HistoryDatasetCollection(t,e):{validationError:"Unknown history_content_type: "+t.history_content_type}},stopPolling:function(){this.jobStateSummariesCollection&&(this.jobStateSummariesCollection.active=!1,this.jobStateSummariesCollection.clearUpdateTimeout())},setHistoryId:function(t){this.stopPolling(),this.historyId=t,t&&(this._setUpWebStorage(),this.jobStateSummariesCollection=new p.default.JobStatesSummaryCollection,this.jobStateSummariesCollection.historyId=t,this.jobStateSummariesCollection.monitor())},_setUpWebStorage:function(t){return this.storage=new h.default.HistoryPrefs({id:h.default.HistoryPrefs.historyStorageKey(this.historyId)}),this.trigger("new-storage",this.storage,this),this.on({"include-deleted":function(t){this.storage.includeDeleted(t)},"include-hidden":function(t){this.storage.includeHidden(t)}}),this.includeDeleted=this.storage.includeDeleted()||!1,this.includeHidden=this.storage.includeHidden()||!1,this},comparators:b.extend(b.clone(M.prototype.comparators),{name:g.default.buildComparator("name",{ascending:!0}),"name-dsc":g.default.buildComparator("name",{ascending:!1}),hid:g.default.buildComparator("hid",{ascending:!1}),"hid-asc":g.default.buildComparator("hid",{ascending:!0})}),running:function(){return this.filter(function(t){return!t.inReadyState()})},runningAndActive:function(){return this.filter(function(t){return!t.inReadyState()&&t.get("visible")&&!t.get("deleted")})},getByHid:function(t){return this.findWhere({hid:t})},haveDetails:function(){return this.all(function(t){return t.hasDetails()})},hidden:function(){return this.filter(function(t){return t.hidden()})},deleted:function(){return this.filter(function(t){return t.get("deleted")})},visibleAndUndeleted:function(){return this.filter(function(t){return t.get("visible")&&!t.get("deleted")})},setIncludeDeleted:function(t,e){if(b.isBoolean(t)&&t!==this.includeDeleted){if(this.includeDeleted=t,b.result(e,"silent"))return;this.trigger("include-deleted",t,this)}},setIncludeHidden:function(t,e){if(b.isBoolean(t)&&t!==this.includeHidden){if(this.includeHidden=t,e=e||{},b.result(e,"silent"))return;this.trigger("include-hidden",t,this)}},fetch:function(t){if(t=t||{},this.historyId&&!t.details){var e=h.default.HistoryPrefs.get(this.historyId).toJSON();b.isEmpty(e.expandedIds)||(t.details=b.values(e.expandedIds).join(","))}return M.prototype.fetch.call(this,t)},_buildFetchData:function(t){return b.extend(M.prototype._buildFetchData.call(this,t),{v:"dev"})},_fetchParams:M.prototype._fetchParams.concat(["v","details"]),_buildFetchFilters:function(t){var e=M.prototype._buildFetchFilters.call(this,t)||{},n={};return this.includeDeleted||(n.deleted=!1,n.purged=!1),this.includeHidden||(n.visible=!0),b.defaults(e,n)},getTotalItemCount:function(){return this.history.contentsShown()},fetchUpdated:function(t,e){return t&&(e=e||{filters:{}},e.remove=!1,e.filters={"update_time-ge":t.toISOString(),visible:""}),this.fetch(e)},fetchDeleted:function(t){var e=this;return t=t||{},t.filters=b.extend(t.filters,{deleted:!0,purged:void 0}),t.remove=!1,this.trigger("fetching-deleted",this),this.fetch(t).always(function(){e.trigger("fetching-deleted-done",e)})},fetchHidden:function(t){var e=this;return t=t||{},t.filters=b.extend(t.filters,{visible:!1}),t.remove=!1,this.trigger("fetching-hidden",this),this.fetch(t).always(function(){e.trigger("fetching-hidden-done",e)})},fetchAllDetails:function(t){t=t||{};var e={details:"all"};return t.data=b.extend(t.data||{},e),this.fetch(t)},_filterAndUpdate:function(t,e){var n=this,i=this.model.prototype.idAttribute,r=[e];return this.fetch({filters:t,remove:!1}).then(function(t){return t=t.reduce(function(t,e,r){var a=n.get(e[i]);return a?t.concat(a):t},[]),n.ajaxQueue("save",r,t)})},ajaxQueue:function(t,e,n){return n=n||this.models,new v.default.AjaxQueue(n.slice().reverse().map(function(n,i){var r=b.isString(t)?n[t]:t;return function(){return r.apply(n,e)}})).deferred},_recursivelyFetch:function(t,e,n,i,r){var a=this;r=r||0;var o=b.extend(b.clone(t),{view:"summary",keys:e,limit:i,offset:r,reset:0===r,remove:!1});b.defer(function(){a.fetch.call(a,o).fail(n.reject).done(function(o){n.notify(o,i,r),o.length!==i?(a.allFetched=!0,n.resolve(o,i,r)):a._recursivelyFetch(t,e,n,i,r+i)})})},progressivelyFetchDetails:function(e){e=e||{};var n=t.Deferred();return this._recursivelyFetch(e,l.default.HistoryDatasetAssociation.prototype.searchAttributes.join(","),n,e.limitPerCall||this.limitPerProgressiveFetch),n},isCopyable:function(t){var e=["HistoryDatasetAssociation","HistoryDatasetCollectionAssociation"];return b.isObject(t)&&t.id&&b.contains(e,t.model_class)},copy:function(e){var n,i,r;b.isString(e)?(n=e,r="hda",i="dataset"):(n=e.id,r={HistoryDatasetAssociation:"hda",LibraryDatasetDatasetAssociation:"ldda",HistoryDatasetCollectionAssociation:"hdca"}[e.model_class]||"hda",i="hdca"===r?"dataset_collection":"dataset");var a=this,o=t.ajax(this.url(),{method:"POST",contentType:"application/json",data:JSON.stringify({content:n,source:r,type:i})}).done(function(t){a.add([t],{parse:!0})}).fail(function(t,e,s){a.trigger("error",a,o,{},"Error copying contents",{type:i,id:n,source:r})});return o},createHDCA:function(t,e,n,i,r){return this.model({history_content_type:"dataset_collection",collection_type:e,history_id:this.historyId,name:n,hide_source_items:i||!1,element_identifiers:t}).save(r)},haveSearchDetails:function(){return this.allFetched&&this.all(function(t){return b.has(t.attributes,"annotation")})},matches:function(t){return this.filter(function(e){return e.matches(t)})},clone:function(){var t=x.Collection.prototype.clone.call(this);return t.historyId=this.historyId,t},toString:function(){return["HistoryContents(",[this.historyId,this.length].join(),")"].join("")}});e.default={HistoryContents:C}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(67),l=o(s),c=n(37),d=o(c),u=n(52),h=o(u),f=n(6),p=o(f),_=n(3),g=o(_),m=l.default.ListItemView,v=m.extend({_logNamespace:"dataset",className:m.prototype.className+" dataset",id:function(){return["dataset",this.model.get("id")].join("-")},initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log(this+".initialize:",t),m.prototype.initialize.call(this,t),this.linkTarget=t.linkTarget||"_blank"},_setUpListeners:function(){m.prototype._setUpListeners.call(this);var e=this;return e.listenTo(e.model,{change:function(n){e.model.changedAttributes().state&&e.model.inReadyState()&&e.expanded&&!e.model.hasDetails()?e.model.fetch({silent:!0}).done(function(){e.render()}):t.has(n.changed,"tags")&&1===t.keys(n.changed).length?e.$(".nametags").html(e._renderNametags()):e.render()}})},_fetchModelDetails:function(){var t=this;return t.model.inReadyState()&&!t.model.hasDetails()?t.model.fetch({silent:!0}):i.when()},remove:function(t,e){var n=this;t=t||this.fxSpeed,this.$el.fadeOut(t,function(){r.View.prototype.remove.call(n),e&&e.call(n)})},_swapNewRender:function(t){return m.prototype._swapNewRender.call(this,t),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_renderPrimaryActions:function(){return[this._renderDisplayButton()]},_renderDisplayButton:function(){var t=this.model.get("state");if(t===d.default.NOT_VIEWABLE||t===d.default.DISCARDED||!this.model.get("accessible"))return null;var e={target:this.linkTarget,classes:"display-btn"};if(this.model.get("purged"))e.disabled=!0,e.title=(0,g.default)("Cannot display datasets removed from disk");else if(t===d.default.UPLOAD)e.disabled=!0,e.title=(0,g.default)("This dataset must finish uploading before it can be viewed");else if(t===d.default.NEW)e.disabled=!0,e.title=(0,g.default)("This dataset is not yet viewable");else{e.title=(0,g.default)("View data"),e.href=this.model.urls.display;var n=this;e.onclick=function(t){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.addDataset(n.model.get("id")),t.preventDefault())}}return e.faIcon="fa-eye",(0,h.default)(e)},_renderDetails:function(){if(this.model.get("state")===d.default.NOT_VIEWABLE)return a(this.templates.noAccess(this.model.toJSON(),this));var t=m.prototype._renderDetails.call(this);return t.find(".actions .left").empty().append(this._renderSecondaryActions()),t.find(".summary").html(this._renderSummary()).prepend(this._renderDetailMessages()),t.find(".display-applications").html(this._renderDisplayApplications()),this._setUpBehaviors(t),t},_renderSummary:function(){var t=this.model.toJSON(),e=this.templates.summaries[t.state];return(e=e||this.templates.summaries.unknown)(t,this)},_renderDetailMessages:function(){var e=this,n=a('<div class="detail-messages"></div>'),i=e.model.toJSON();return t.each(e.templates.detailMessages,function(t){n.append(a(t(i,e)))}),n},_renderDisplayApplications:function(){return this.model.isDeletedOrPurged()?"":[this.templates.displayApplications(this.model.get("display_apps"),this),this.templates.displayApplications(this.model.get("display_types"),this)].join("")},_renderSecondaryActions:function(){switch(this.debug("_renderSecondaryActions"),this.model.get("state")){case d.default.NOT_VIEWABLE:return[];case d.default.OK:case d.default.FAILED_METADATA:case d.default.ERROR:return[this._renderDownloadButton(),this._renderShowParamsButton()]}return[this._renderShowParamsButton()]},_renderShowParamsButton:function(){return(0,h.default)({title:(0,g.default)("View details"),classes:"params-btn",href:this.model.urls.show_params,target:this.linkTarget,faIcon:"fa-info-circle",onclick:function(t){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:(0,g.default)("Dataset details"),url:this.href}),t.preventDefault(),t.stopPropagation())}})},_renderDownloadButton:function(){return this.model.get("purged")||!this.model.hasData()?null:t.isEmpty(this.model.get("meta_files"))?a('\n                <a class="download-btn icon-btn" href="'+this.model.urls.download+'" title="'+(0,g.default)("Download")+'">\n                    <span class="fa fa-floppy-o"></span>\n                </a>'):this._renderMetaFileDownloadButton()},_renderMetaFileDownloadButton:function(){var e=this.model.urls;return a('\n                <div class="metafile-dropdown dropdown">\n                    <a class="download-btn icon-btn" href="'+e.download+'" data-toggle="dropdown" title="'+(0,g.default)("Download")+'">\n                        <span class="fa fa-floppy-o"></span>\n                    </a>\n                    <ul class="dropdown-menu" role="menu">\n                        <li>\n                            <a href="'+e.download+'">\n                                '+(0,g.default)("Download dataset")+"\n                            </a>\n                        </li>\n                        "+t.map(this.model.get("meta_files"),function(t){return'<li>\n                                    <a href="'+(e.meta_download+t.file_type)+'">\n                                        '+(0,g.default)("Download")+" "+t.file_type+"\n                                    </a>\n                                </li>"})+"\n                    </ul>\n                </div>")},_renderNametags:function(){return t.template(["<% _.each(_.sortBy(_.uniq(tags), function(x) { return x }), function(tag){ %>",'<% if (tag.indexOf("name:") == 0){ %>','<span class="badge badge-primary badge-tags"><%- tag.slice(5) %></span>',"<% } %>","<% }); %>"].join(""))({tags:this.model.get("tags")})},events:t.extend(t.clone(m.prototype.events),{"click .display-btn":function(t){this.trigger("display",this,t)},"click .params-btn":function(t){this.trigger("params",this,t)},"click .download-btn":function(t){this.trigger("download",this,t)}}),toString:function(){return"DatasetListItemView("+(this.model?""+this.model:"(no model)")+")"}});v.prototype.templates=function(){var e=t.extend({},m.prototype.templates.warnings,{failed_metadata:p.default.wrapTemplate(['<% if( model.state === "failed_metadata" ){ %>','<div class="warningmessagesmall">',(0,g.default)("An error occurred setting the metadata for this dataset"),"</div>","<% } %>"]),error:p.default.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',(0,g.default)("There was an error getting the data for this dataset"),": <%- model.error %>","</div>","<% } %>"]),purged:p.default.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',(0,g.default)("This dataset has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:p.default.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,g.default)("This dataset has been deleted"),"</div>","<% } %>"])}),n=p.default.wrapTemplate(['<div class="details">','<div class="summary"></div>','<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !dataset.deleted && !dataset.purged ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications"></div>',"<% if( dataset.peek ){ %>",'<pre class="dataset-peek"><%= dataset.peek %></pre>',"<% } %>","<% } %>","</div>"],"dataset"),i=p.default.wrapTemplate(['<div class="details">','<div class="summary">',(0,g.default)("You do not have permission to view this dataset"),"</div>","</div>"],"dataset"),r={};r[d.default.OK]=r[d.default.FAILED_METADATA]=p.default.wrapTemplate(["<% if( dataset.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- dataset.misc_blurb %></span>',"</div>","<% } %>","<% if( dataset.file_ext ){ %>",'<div class="datatype">','<label class="prompt">',(0,g.default)("format"),"</label>",'<span class="value"><%- dataset.file_ext %></span>',"</div>","<% } %>","<% if( dataset.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',(0,g.default)("database"),"</label>",'<span class="value">',"<%- dataset.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( dataset.misc_info ){ %>",'<div class="info">','<span class="value"><%- dataset.misc_info %></span>',"</div>","<% } %>"],"dataset"),r[d.default.NEW]=p.default.wrapTemplate(["<div>",(0,g.default)("This is a new dataset and not all of its data are available yet"),"</div>"],"dataset"),r[d.default.NOT_VIEWABLE]=p.default.wrapTemplate(["<div>",(0,g.default)("You do not have permission to view this dataset"),"</div>"],"dataset"),r[d.default.DISCARDED]=p.default.wrapTemplate(["<div>",(0,g.default)("The job creating this dataset was cancelled before completion"),"</div>"],"dataset"),r[d.default.QUEUED]=p.default.wrapTemplate(["<div>",(0,g.default)("This job is waiting to run"),"</div>"],"dataset"),r[d.default.RUNNING]=p.default.wrapTemplate(["<div>",(0,g.default)("This job is currently running"),"</div>"],"dataset"),r[d.default.UPLOAD]=p.default.wrapTemplate(["<div>",(0,g.default)("This dataset is currently uploading"),"</div>"],"dataset"),r[d.default.SETTING_METADATA]=p.default.wrapTemplate(["<div>",(0,g.default)("Metadata is being auto-detected"),"</div>"],"dataset"),r[d.default.PAUSED]=p.default.wrapTemplate(["<div>",(0,g.default)('This job is paused. Use the "Resume Paused Jobs" in the history menu to resume'),"</div>"],"dataset"),r[d.default.ERROR]=p.default.wrapTemplate(["<% if( !dataset.purged ){ %>","<div><%- dataset.misc_blurb %></div>","<% } %>",'<span class="help-text">',(0,g.default)("An error occurred with this dataset"),":</span>",'<div class="job-error-text"><%- dataset.misc_info %></div>'],"dataset"),r[d.default.EMPTY]=p.default.wrapTemplate(["<div>",(0,g.default)("No data"),": <i><%- dataset.misc_blurb %></i></div>"],"dataset"),r.unknown=p.default.wrapTemplate(['<div>Error: unknown dataset state: "<%- dataset.state %>"</div>'],"dataset");var a={resubmitted:p.default.wrapTemplate(["<% if( model.resubmitted ){ %>",'<div class="resubmitted-msg infomessagesmall">',(0,g.default)("The job creating this dataset has been resubmitted"),"</div>","<% } %>"])},o=p.default.wrapTemplate(["<% _.each( apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%- link.target %>" href="<%- link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>"],"apps");return t.extend({},m.prototype.templates,{warnings:e,details:n,noAccess:i,summaries:r,detailMessages:a,displayApplications:o})}(),e.default={DatasetListItemView:v}}).call(e,n(1),n(0),n(2),n(0))},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(729),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=t.Model.extend({urlRoot:Galaxy.root+"api/libraries/",isVisible:function(t){var e=!0;return!t&&this.get("deleted")&&(e=!1),e}}),o=t.Collection.extend({urlRoot:Galaxy.root+"api/libraries",model:a,initialize:function(t){t=t||{}},search:function(t){if(""==t)return this;var e=t.toLowerCase();return this.filter(function(t){return-1!==t.get("name").toLowerCase().indexOf(e)})},getVisible:function(t,e){return e=e||[],new o(this.filter(function(e){return e.isVisible(t)}))},sortLibraries:function(t,e){this.comparator=r.default.generateLibraryComparator(t,e),this.sort()}}),s=t.Model.extend({}),l=s.extend({urlRoot:Galaxy.root+"api/libraries/datasets/"}),c=s.extend({urlRoot:Galaxy.root+"api/folders/"}),d=t.Collection.extend({model:s,sortFolder:function(t,e){this.comparator=r.default.generateFolderComparator(t,e),this.sort()}}),u=t.Model.extend({defaults:{folder:new d,urlRoot:Galaxy.root+"api/folders/",id:"unknown"},parse:function(t){this.get("folder").reset();for(var e=0;e<t.folder_contents.length;e++)if("folder"===t.folder_contents[e].type){var n=new c(t.folder_contents[e]);this.get("folder").add(n)}else if("file"===t.folder_contents[e].type){var i=new l(t.folder_contents[e]);this.get("folder").add(i)}else Galaxy.emit.error("Unknown folder item type encountered while parsing response.");return t}}),h=t.Model.extend({urlRoot:Galaxy.root+"api/histories/"}),f=t.Collection.extend({urlRoot:Galaxy.root+"api/histories/",initialize:function(t){this.id=t.id},url:function(){return this.urlRoot+this.id+"/contents"},model:h}),p=t.Model.extend({urlRoot:Galaxy.root+"api/histories/"}),_=t.Collection.extend({url:Galaxy.root+"api/histories",model:p}),g=t.Model.extend({urlRoot:Galaxy.root+"api/remote_files"});e.default={Library:a,Libraries:o,Item:l,Ldda:l,FolderAsModel:c,Folder:d,FolderContainer:u,HistoryItem:h,HistoryContents:f,GalaxyHistory:p,GalaxyHistories:_,Jstree:g}}).call(e,n(2))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=(r(a),n(2)),s=r(o),l=n(6),c=i(l),d=n(3),u=i(d),h=s.Model.extend(c.default.LoggableMixin).extend({_logNamespace:"user",urlRoot:function(){return Galaxy.root+"api/users"},defaults:{id:null,username:"("+(0,u.default)("anonymous user")+")",email:"",total_disk_usage:0,nice_total_disk_usage:"",quota_percent:null,is_admin:!1},initialize:function(t){this.log("User.initialize:",t),this.on("loaded",function(t,e){this.log(this+" has loaded:",t,e)}),this.on("change",function(t,e){this.log(this+" has changed:",t,e.changes)})},isAnonymous:function(){return!this.get("email")},isAdmin:function(){return this.get("is_admin")},loadFromApi:function(t,e){t=t||h.CURRENT_ID_STR,e=e||{};var n=this,i=e.success;return e.success=function(t,e){n.trigger("loaded",t,e),i&&i(t,e)},t===h.CURRENT_ID_STR&&(e.url=this.urlRoot+"/"+h.CURRENT_ID_STR),s.Model.prototype.fetch.call(this,e)},clearSessionStorage:function(){for(var t in sessionStorage)0===t.indexOf("history:")?sessionStorage.removeItem(t):"history-panel"===t&&sessionStorage.removeItem(t)},toString:function(){var t=[this.get("username")];return this.get("id")&&(t.unshift(this.get("id")),t.push(this.get("email"))),"User("+t.join(":")+")"}});h.CURRENT_ID_STR="current",h.getCurrentUserFromApi=function(t){var e=new h;return e.loadFromApi(h.CURRENT_ID_STR,t),e};s.Collection.extend(c.default.LoggableMixin).extend({model:h,urlRoot:function(){return Galaxy.root+"api/users"}});e.default={User:h}},function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(3),d=r(c),u=n(1),h=i(u),f=n(2),p=i(f),_=n(62),g=r(_),m=n(15),v=r(m),y=n(31),b=r(y),w=n(32),x=r(w),k=n(24),M=r(k),C=n(5),S=r(C);n(163),n(162),n(164),n(69),n(166),n(150),n(149),n(165),n(19);var T=function(e){function n(t){return a(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))}return s(n,e),l(n,[{key:"initialize",value:function(t){this.baseURL=t,S.default.cssLoadFile("static/style/jquery.rating.css"),S.default.cssLoadFile("static/style/autocomplete_tagging.css"),S.default.cssLoadFile("static/style/jquery-ui/smoothness/jquery-ui.css"),S.default.cssLoadFile("static/style/library.css"),S.default.cssLoadFile("static/style/trackster.css")}},{key:"save_viz",value:function(){var e=this;Galaxy.modal.show({title:"Saving...",body:"progress"});var n=[];t(".bookmark").each(function(){n.push({position:t(e).children(".position").text(),annotation:t(e).children(".annotation").text()})});var i=this.view.overview_drawable?this.view.overview_drawable.config.get_value("name"):null,r={view:this.view.to_dict(),viewport:{chrom:this.view.chrom,start:this.view.low,end:this.view.high,overview:i},bookmarks:n};return t.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:this.view.vis_id,title:this.view.config.get_value("name"),dbkey:this.view.dbkey,type:"trackster",vis_json:JSON.stringify(r)}}).success(function(t){Galaxy.modal.hide(),e.view.vis_id=t.vis_id,e.view.has_changes=!1,window.history.pushState({},"",t.url+window.top.location.hash)}).error(function(){Galaxy.modal.show({title:(0,d.default)("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{key:"createButtonMenu",value:function(){var e=this,n=b.default.create_icon_buttons_menu([{icon_class:"plus-button",title:(0,d.default)("Add tracks"),on_click:function(){v.default.select_datasets({dbkey:e.view.dbkey},function(t){h.each(t,function(t){e.view.add_drawable(g.default.object_from_template(t,e.view,e.view))})})}},{icon_class:"block--plus",title:(0,d.default)("Add group"),on_click:function(){e.view.add_drawable(new g.default.DrawableGroup(e.view,e.view,{name:"New Group"}))}},{icon_class:"bookmarks",title:(0,d.default)("Bookmarks"),on_click:function(){window.force_right_panel("0px"==t("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:(0,d.default)("Circster"),on_click:function(){window.top.location=e.baseURL+"visualization/circster?id="+e.view.vis_id}},{icon_class:"disk--arrow",title:(0,d.default)("Save"),on_click:function(){e.save_viz()}},{icon_class:"cross-circle",title:(0,d.default)("Close"),on_click:function(){e.handle_unsaved_changes(e.view)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=n,n}},{key:"add_bookmark",value:function(e,n,i){var r=this,a=t("#right .unified-panel-body"),o=t("<div/>").addClass("bookmark").appendTo(a),s=t("<div/>").addClass("position").appendTo(o);t("<a href=''/>").text(e).appendTo(s).click(function(){return r.view.go_to(e),!1});var l=t("<div/>").text(n).appendTo(o);if(i){var c=t("<div/>").addClass("delete-icon-container").prependTo(o).click(function(){return o.slideUp("fast"),o.remove(),r.view.has_changes=!0,!1});t("<a href=''/>").addClass("icon-button delete").appendTo(c),l.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return this.view.has_changes=!0,o}},{key:"create_visualization",value:function(e,n,i,r,a){var o=this;return this.view=new g.default.TracksterView(h.extend(e,{header:!1})),this.view.editor=!0,t.when(this.view.load_chroms_deferred).then(function(t){var e=null;if(n){var s=n.chrom,l=n.start,c=n.end;e=n.overview,s&&void 0!==l&&c?o.view.change_chrom(s,l,c):o.view.change_chrom(t[0].chrom)}else o.view.change_chrom(t[0].chrom);if(i)for(var d=0;d<i.length;d++)o.view.add_drawable(g.default.object_from_template(i[d],o.view,o.view));for(var u=0;u<o.view.drawables.length;u++)if(o.view.drawables[u].config.get_value("name")===e){o.view.set_overview(o.view.drawables[u]);break}if(r)for(var h,f=0;f<r.length;f++)h=r[f],o.add_bookmark(h.position,h.annotation,a);o.view.has_changes=!1}),this.set_up_router({view:this.view}),this.view}},{key:"set_up_router",value:function(t){new v.default.TrackBrowserRouter(t),p.history.start()}},{key:"init_keyboard_nav",value:function(e){t(document).keyup(function(n){if(!t(n.srcElement).is(":input"))switch(n.which){case 37:e.move_fraction(.25);break;case 38:e.viewport_container.scrollTop(e.viewport_container.scrollTop()-20);break;case 39:e.move_fraction(-.25);break;case 40:e.viewport_container.scrollTop(e.viewport_container.scrollTop()+20)}})}},{key:"handle_unsaved_changes",value:function(e){var n=this;e.has_changes?Galaxy.modal.show({title:(0,d.default)("Close visualization"),body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){Galaxy.modal.hide()},"Leave without Saving":function(){t(window).off("beforeunload"),window.top.location=Galaxy.root+"visualizations/list"},Save:function(){t.when(n.save_viz()).then(function(){window.top.location=Galaxy.root+"visualizations/list"})}}}):window.top.location=Galaxy.root+"visualizations/list"}}]),n}(p.Model),A=function(e){function n(t){return a(this,n),o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))}return s(n,e),l(n,[{key:"initialize",value:function(){var e=this;this.ui=new T(Galaxy.root),this.ui.createButtonMenu(),this.ui.buttonMenu.$el.attr("style","float: right"),t("#center .unified-panel-header-inner").append(this.ui.buttonMenu.$el),t("#right .unified-panel-title").append("Bookmarks"),t("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),t("#right-border").click(function(){e.ui.view.resize_window()}),window.force_right_panel("hide"),window.galaxy_config.app.id?this.view_existing():x.default.get("dataset_id")?this.choose_existing_or_new():this.view_new()}},{key:"choose_existing_or_new",value:function(){var t=this,e=x.default.get("dbkey"),n={},i={dbkey:e,dataset_id:x.default.get("dataset_id"),hda_ldda:x.default.get("hda_ldda"),gene_region:x.default.get("gene_region")};e&&(n["f-dbkey"]=e),Galaxy.modal.show({title:"View Data in a New or Saved Visualization?",body:"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>"+(e||"Not available.")+"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>",buttons:{Cancel:function(){window.top.location=Galaxy.root+"visualizations/list"},"View in saved visualization":function(){t.view_in_saved(i)},"View in new visualization":function(){t.view_new()}}})}},{key:"view_in_saved",value:function(e){var n=this,i=new M.default({url_base:Galaxy.root+"visualization/list_tracks",embedded:!0});Galaxy.modal.show({title:(0,d.default)("Add Data to Saved Visualization"),body:i.$el,buttons:{Cancel:function(){window.top.location=Galaxy.root+"visualizations/list"},"Add to visualization":function(){t(window.parent.document).find("input[name=id]:checked").each(function(){e.id=t(n).val(),window.top.location=Galaxy.root+"visualization/trackster?"+t.param(e)})}}})}},{key:"view_existing",value:function(){var e=window.galaxy_config.app.viz_config;this.ui.create_visualization({container:t("#center .unified-panel-body"),name:e.title,vis_id:e.vis_id,dbkey:e.dbkey},e.viewport,e.tracks,e.bookmarks,!0),this.init_editor()}},{key:"view_new",value:function(){var e=this;t.ajax({url:Galaxy.root+"api/genomes?chrom_info=True",data:{},error:function(){alert("Couldn't create new browser.")},success:function(n){Galaxy.modal.show({title:(0,d.default)("New Visualization"),body:e.template_view_new(n),buttons:{Cancel:function(){window.top.location=Galaxy.root+"visualizations/list"},Create:function(){e.create_browser(t("#new-title").val(),t("#new-dbkey").val()),Galaxy.modal.hide()}}});var i=n.map(function(t){return t[1]});window.galaxy_config.app.default_dbkey&&h.contains(i,window.galaxy_config.app.default_dbkey)&&t("#new-dbkey").val(window.galaxy_config.app.default_dbkey),t("#new-title").focus(),t("select[name='dbkey']").select2(),t("#overlay").css("overflow","auto")}})}},{key:"template_view_new",value:function(t){for(var e='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',n=0;n<t.length;n++)e+='<option value="'+t[n][1]+'">'+t[n][0]+"</option>";return e+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'+Galaxy.root+'custom_builds" target="_top">Add a Custom Build</a></div></form>'}},{key:"init_editor",value:function(){var e=this;t("#center .unified-panel-title").text(this.ui.view.config.get_value("name")+" ("+this.ui.view.dbkey+")"),window.galaxy_config.app.add_dataset&&t.ajax({url:Galaxy.root+"api/datasets/"+window.galaxy_config.app.add_dataset,data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(t){e.ui.view.add_drawable(g.default.object_from_template(t,e.ui.view,e.ui.view))}}),t("#add-bookmark-button").click(function(){var t=e.ui.view.chrom+":"+e.ui.view.low+"-"+e.ui.view.high;return e.ui.add_bookmark(t,"Bookmark description",!0)}),this.ui.init_keyboard_nav(this.ui.view),t(window).on("beforeunload",function(){if(e.ui.view.has_changes)return"There are unsaved changes to your visualization that will be lost if you leave this page."})}},{key:"create_browser",value:function(e,n){t(document).trigger("convert_to_values"),this.ui.create_visualization({container:t("#center .unified-panel-body"),name:e,dbkey:n},window.galaxy_config.app.gene_region),this.init_editor(),this.ui.view.editor=!0}}]),n}(p.View);e.default={TracksterUI:T,GalaxyApp:A}}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){D[t.attr("id")]=e}function o(e,n,i,r){i=".group",D[e.attr("id")]=r,e.bind("drag",{handle:"."+n,relative:!0},function(e,n){var r,a,o,s,l,c=t(this),d=c.parent(),u=d.children(".track,.group"),h=D[t(this).attr("id")];if(a=t(this).parents(i),0!==a.length){o=a.position().top,s=o+a.outerHeight();var f=D[a.attr("id")];if(n.offsetY<o)return t(this).insertBefore(a),f.remove_drawable(h),void f.container.add_drawable_before(h,f);if(n.offsetY>s)return t(this).insertAfter(a),f.remove_drawable(h),void f.container.add_drawable(h)}for(a=null,l=0;l<u.length;l++)if(r=t(u.get(l)),o=r.position().top,s=o+r.outerHeight(),r.is(i)&&this!==r.get(0)&&n.offsetY>=o&&n.offsetY<=s)return n.offsetY-o<s-n.offsetY?r.find(".content-div").prepend(this):r.find(".content-div").append(this),h.container&&h.container.remove_drawable(h),void D[r.attr("id")].add_drawable(h);for(l=0;l<u.length&&(r=t(u.get(l)),!(n.offsetY<r.position().top)||r.hasClass("reference-track")||r.hasClass("intro"));l++);l===u.length?this!==u.get(l-1)&&(d.append(this),D[d.attr("id")].move_drawable(h,l)):this!==u.get(l)&&(t(this).insertBefore(u.get(l)),D[d.attr("id")].move_drawable(h,n.deltaY>0?l-1:l))}).bind("dragstart",function(){t(this).addClass("dragging")}).bind("dragend",function(){t(this).removeClass("dragging")})}function s(t,e){e||(e=0);var n=Math.pow(10,e);return Math.round(t*n)/n}function l(e){var n=t.Deferred();return t.ajax({type:"HEAD",url:e,beforeSend:function(t){t.setRequestHeader("Range","bytes=0-10")},success:function(t,e,i){n.resolve(206===i.status)}}),n}Object.defineProperty(e,"__esModule",{value:!0});var c=n(3),d=r(c),u=n(1),h=i(u),f=n(2),p=i(f),_=n(15),g=r(_),m=n(81),v=r(m),y=n(18),b=r(y),w=n(82),x=r(w),k=n(83),M=r(k),C=n(84),S=r(C),T=n(14),A=r(T),j=n(54),E=r(j),O=n(33),L=r(O),N=n(137),I=r(N);n(19);var P=h.extend,D={},R="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",z=["Histogram","Line","Filled","Intensity"],$=function t(e,n,i){if(t.id_counter||(t.id_counter=0),this.id=t.id_counter++,this.view=e,this.container=n,this.drag_handle_class=i.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=L.default.ConfigSettingCollection.from_models_and_saved_values(this.build_config_params(),i.prefs),this.config.get_value("name")||this.config.set_value("name",i.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,!1!==i.header){var r=new v.default.TrackHeaderView({model:this,id:this.id});this.header_div=r.$el,this.container_div.append(this.header_div);var a=r.icons_div;this.action_icons=r.action_icons,this.container_div.hover(function(){a.show()},function(){a.hide()})}};$.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(t){t.config.get_value("content_visible")?(t.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),t.hide_contents(),t.config.set_value("content_visible",!1)):(t.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),t.config.set_value("content_visible",!0),t.show_contents())}},{name:"settings_icon",title:(0,d.default)("Edit settings"),css_class:"gear",on_click_fn:function(t){new L.default.ConfigSettingCollectionView({collection:t.config}).render_in_modal("Configure Track")}},{name:"remove_icon",title:(0,d.default)("Remove"),css_class:"remove-icon",on_click_fn:function(e){t(".tooltip").remove(),e.remove()}}],P($.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],build_config_params:function(){return this.config_params},config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(t){},to_dict:function(){},set_name:function(t){this.old_name=this.config.get_value("name"),this.config.set_value("name",t)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var e=this.view;this.container_div.hide(0,function(){t(this).remove(),e.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var W=function(t,e,n){$.call(this,t,e,n),this.obj_type=n.obj_type,this.drawables=[]};P(W.prototype,$.prototype,{unpack_drawables:function(t){this.drawables=[];for(var e,n=0;n<t.length;n++)e=st(t[n],this.view,this),this.add_drawable(e)},init:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].init()},_draw:function(t){for(var e=0;e<this.drawables.length;e++)this.drawables[e]._draw(t)},to_dict:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:t}},add_drawable:function(t){this.drawables.push(t),t.container=this,this.changed()},add_drawable_before:function(t,e){this.changed();var n=this.drawables.indexOf(e);return-1!==n&&(this.drawables.splice(n,0,t),!0)},replace_drawable:function(t,e,n){var i=this.drawables.indexOf(t);return-1!==i&&(this.drawables[i]=e,n&&t.container_div.replaceWith(e.container_div),this.changed()),i},remove_drawable:function(t){var e=this.drawables.indexOf(t);return-1!==e&&(this.drawables.splice(e,1),t.container=null,this.changed(),!0)},move_drawable:function(t,e){var n=this.drawables.indexOf(t);return-1!==n&&(this.drawables.splice(n,1),this.drawables.splice(e,0,t),this.changed(),!0)},get_drawables:function(){return this.drawables},get_tracks:function(t){for(var e,n=this.drawables.slice(0),i=[];0!==n.length;)e=n.shift(),e instanceof t?i.push(e):e.drawables&&(n=n.concat(e.drawables));return i}});var G=function(e,n,i){if(P(i,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),W.call(this,e,n,i),this.content_div=t("<div/>").addClass("content-div").attr("id","group_"+this.id+"_content_div").appendTo(this.container_div),a(this.container_div,this),a(this.content_div,this),o(this.container_div,this.drag_handle_class,".group",this),this.filters_manager=new S.default.FiltersManager(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(t("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in i&&this.unpack_drawables(i.drawables),"filters"in i){var r=this.filters_manager;this.filters_manager=new S.default.FiltersManager(this,i.filters),r.parent_div.replaceWith(this.filters_manager.parent_div),i.filters.visible&&this.setup_multitrack_filtering()}};P(G.prototype,$.prototype,W.prototype,{action_icons_def:[$.prototype.action_icons_def[0],$.prototype.action_icons_def[1],{name:"composite_icon",title:(0,d.default)("Show composite track"),css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_composite_track()}},{name:"filters_icon",title:(0,d.default)("Filters"),css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?(t.filters_manager.clear_filters(),t._restore_filter_managers()):(t.setup_multitrack_filtering(),t.request_draw({clear_tile_cache:!0})),t.filters_manager.toggle()}},$.prototype.action_icons_def[2]],build_container_div:function(){var e=t("<div/>").addClass("group").attr("id","group_"+this.id);return this.container&&this.container.content_div.append(e),e},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var e=this.drawables.length;if(0===e)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===e)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof Z),this.action_icons.filters_icon.hide();else{var n,i,r,a=this.drawables[0].get_type(),o=0;for(n=0;n<e&&(r=this.drawables[n],r.get_type()===a);n++)r instanceof it&&o++;if(this.drawables[0]instanceof et?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),t(".tooltip").remove()),o>1&&o===this.drawables.length){var s,l={};for(r=this.drawables[0],i=0;i<r.filters_manager.filters.length;i++)s=r.filters_manager.filters[i],l[s.name]=[s];for(n=1;n<this.drawables.length;n++)for(r=this.drawables[n],i=0;i<r.filters_manager.filters.length;i++)s=r.filters_manager.filters[i],s.name in l&&l[s.name].push(s);this.filters_manager.remove_all();for(var c in l){var d=l[c];if(d.length===o){var u=new S.default.NumberFilter({name:d[0].name,index:d[0].index});this.filters_manager.add_filter(u)}}this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].filters_manager=this.saved_filters_managers[t];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var t=0;t<this.drawables.length;t++){var e=this.drawables[t];this.saved_filters_managers.push(e.filters_manager),e.filters_manager=this.filters_manager}}this.filters_manager.init_filters()},show_composite_track:function(){var t=new Z(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,t,!0),t.request_draw()},add_drawable:function(t){W.prototype.add_drawable.call(this,t),this.update_icons()},remove_drawable:function(t){W.prototype.remove_drawable.call(this,t),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var t=P(W.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),t},request_draw:function(t){h.each(this.drawables,function(e){e.request_draw(t)})}});var V=p.View.extend({initialize:function(t){P(t,{obj_type:"View"}),W.call(this,"View",t.container,t),this.chrom=null,this.vis_id=t.vis_id,this.dbkey=t.dbkey,this.stand_alone=void 0===t.stand_alone||t.stand_alone,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new g.default.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=L.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:t.name})},render:function(){this.requested_redraw=!1;var e=this.container,n=this;this.top_container=t("<div/>").addClass("top-container").appendTo(e),this.browser_content_div=t("<div/>").addClass("content").appendTo(e),this.bottom_container=t("<div/>").addClass("bottom-container").appendTo(e),this.top_labeltrack=t("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=t("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,a(this.viewport_container,n),this.intro_div=t("<div/>").addClass("intro").appendTo(this.viewport_container),t("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){g.default.select_datasets({dbkey:n.dbkey},function(t){h.each(t,function(t){n.add_drawable(st(t,n,n))})})}),this.nav_container=t("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=t("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=t("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=t("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=t("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=t("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=t("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=t("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=t("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=t("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);var i=function(e){"focusout"!==e.type&&13!==(e.keyCode||e.which)&&27!==(e.keyCode||e.which)||(27!==(e.keyCode||e.which)&&n.go_to(t(this).val()),t(this).hide(),t(this).val(""),n.location_span.show(),n.chrom_select.show()),e.stopPropagation()};this.nav_input=t("<input/>").addClass("nav-input").hide().bind("keyup focusout",i).appendTo(this.nav_controls),this.location_span=t("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){n.location_span.hide(),n.chrom_select.hide(),n.nav_input.val(n.chrom+":"+n.low+"-"+n.high),n.nav_input.css("display","inline-block"),n.nav_input.select(),n.nav_input.focus(),n.nav_input.autocomplete({source:function(e,i){var r=[],a=t.map(n.get_tracks(it),function(t){return t.data_manager.search_features(e.term).success(function(t){r=r.concat(t)})});t.when.apply(t,a).done(function(){i(t.map(r,function(t){return{label:t[0],value:t[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=t("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=t("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){n.zoom_out()}).appendTo(this.nav_controls),this.zi_link=t("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){n.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){n.change_chrom(n.chrom_select.val())}),this.browser_content_div.click(function(e){t(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(t){n.zoom_in(t.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(t,e){this.current_x=e.offsetX}).bind("drag",function(t,e){var i=e.offsetX-this.current_x;this.current_x=e.offsetX;var r=Math.round(i/n.viewport_container.width()*(n.max_high-n.max_low));n.move_delta(-r)}),this.overview_close.click(function(){n.reset_overview()}),this.viewport_container.bind("draginit",function(t,e){if(t.clientX>n.viewport_container.width()-16)return!1}).bind("dragstart",function(t,e){e.original_low=n.low,e.current_height=t.clientY,e.current_x=e.offsetX}).bind("drag",function(e,i){var r=t(this),a=i.offsetX-i.current_x,o=r.scrollTop()-(e.clientY-i.current_height);r.scrollTop(o),i.current_height=e.clientY,i.current_x=i.offsetX;var s=Math.round(a/n.viewport_container.width()*(n.high-n.low));n.move_delta(s)}),this.top_labeltrack.bind("dragstart",function(e,i){return t("<div/>").addClass("zoom-area").css("height",n.browser_content_div.height()+n.top_labeltrack.height()+1).appendTo(t(this))}).bind("drag",function(e,i){t(i.proxy).css({left:Math.min(e.pageX,i.startX)-n.container.offset().left,width:Math.abs(e.pageX-i.startX)});var r=Math.min(e.pageX,i.startX)-n.container.offset().left,a=Math.max(e.pageX,i.startX)-n.container.offset().left,o=n.high-n.low,s=n.viewport_container.width();n.update_location(Math.round(r/s*o)+n.low,Math.round(a/s*o)+n.low)}).bind("dragend",function(e,i){var r=Math.min(e.pageX,i.startX),a=Math.max(e.pageX,i.startX),o=n.high-n.low,s=n.viewport_container.width(),l=n.low;n.low=Math.round(r/s*o)+l,n.high=Math.round(a/s*o)+l,t(i.proxy).remove(),n.request_redraw()}),this.add_label_track(new K(this,{content_div:this.top_labeltrack})),t(window).bind("resize",function(){this.resize_timer&&window.clearTimeout(this.resize_timer),this.resize_timer=window.setTimeout(function(){n.resize_window()},500)}),t(document).bind("redraw",function(){n.redraw()}),this.reset(),t(window).trigger("resize")},get_base_color:function(t){return this.config.get_value(t.toLowerCase()+"_color")||this.config.get_value("n_color")}});P(V.prototype,W.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(t,e,n,i){var r=this;this.timer&&window.clearTimeout(this.timer),i?this.timer=window.setTimeout(function(){r.trigger("navigate",t+":"+e+"-"+n)},500):this.trigger("navigate",t+":"+e+"-"+n)},update_location:function(t,e){this.location_span.text(b.default.commatize(t)+" - "+b.default.commatize(e)),this.nav_input.val(this.chrom+":"+b.default.commatize(t)+"-"+b.default.commatize(e));var n=this.chrom_select.val();""!==n&&this.trigger_navigate(n,this.low,this.high,!0)},load_chroms:function(e){var n=this;e.num=100;var i=t.Deferred();return t.ajax({url:Galaxy.root+"api/genomes/"+this.dbkey,data:e,dataType:"json",success:function(e){if(0!==e.chrom_info.length){if(e.reference){var r=new tt(n);n.add_label_track(r),n.reference_track=r}n.chrom_data=e.chrom_info,n.chrom_select.html(""),n.chrom_select.append(t('<option value="">Select Chrom/Contig</option>'));for(var a=0,o=n.chrom_data.length;a<o;a++){var s=n.chrom_data[a].chrom,l=t("<option>");l.text(s),l.val(s),n.chrom_select.append(l)}e.prev_chroms&&n.chrom_select.append(t('<option value="previous">Previous 100</option>')),e.next_chroms&&n.chrom_select.append(t('<option value="next">Next 100</option>')),n.chrom_start_index=e.start_index,i.resolve(e.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: "+this.dbkey)}}),i},change_chrom:function(e,n,i){var r=this;if(!r.chrom_data)return void r.load_chroms_deferred.then(function(){r.change_chrom(e,n,i)});if(e&&"None"!==e){if("previous"===e)return void r.load_chroms({low:this.chrom_start_index-100});if("next"===e)return void r.load_chroms({low:this.chrom_start_index+100});var a=t.grep(r.chrom_data,function(t,n){return t.chrom===e})[0];if(void 0===a)return void r.load_chroms({chrom:e},function(){r.change_chrom(e,n,i)});if(e!==r.chrom){r.chrom=e,r.chrom_select.val(r.chrom),r.max_high=a.len-1,r.reset();for(var o=0,s=r.drawables.length;o<s;o++){var l=r.drawables[o];l.init&&l.init()}r.reference_track&&r.reference_track.init()}void 0===n&&void 0===i?(r.low=0,r.high=r.max_high):(r.low=void 0!==n?Math.max(n,0):0,void 0===i?(r.low=Math.max(r.low-15,0),r.high=r.low+30):r.high=Math.min(i,r.max_high)),r.request_redraw()}},go_to:function(t){t=t.replace(/,/g,""),t=t.replace(/:|-/g," ");var e=t.split(/\s+/),n=e[0],i=e[1]?parseInt(e[1],10):void 0,r=e[2]?parseInt(e[2],10):void 0;this.change_chrom(n,i,r)},move_fraction:function(t){var e=this,n=e.high-e.low;this.move_delta(t*n)},move_delta:function(t){var e=this,n=e.high-e.low;e.low-t<e.max_low?(e.low=e.max_low,e.high=e.max_low+n):e.high-t>e.max_high?(e.high=e.max_high,e.low=e.max_high-n):(e.high-=t,e.low-=t),e.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&window.clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=window.setTimeout(function(){e.request_redraw()},200);var i=e.chrom_select.val();this.trigger_navigate(i,e.low,e.high,!0)},add_drawable:function(t){W.prototype.add_drawable.call(this,t),t.init(),this.changed(),this.update_intro_div();var e=this;t.config.on("change",function(){e.changed()})},add_label_track:function(t){t.view=this,t.init(),this.label_tracks.push(t)},remove_drawable:function(e,n){if(W.prototype.remove_drawable.call(this,e),n){var i=this;e.container_div.hide(0,function(){t(this).remove(),i.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(t,e){var n=this,i=e?[e]:n.drawables;h.each(i,function(e){var i=h.find(n.tracks_to_be_redrawn,function(t){return t[0]===e});i?i[1]=t:n.tracks_to_be_redrawn.push([e,t])}),this.requested_redraw||(window.requestAnimationFrame(function(){n._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var t=this.low,e=this.high;t<this.max_low&&(t=this.max_low),e>this.max_high&&(e=this.max_high);var n=this.high-this.low;0!==this.high&&n<this.min_separation&&(e=t+this.min_separation),this.low=Math.floor(t),this.high=Math.ceil(e),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var i=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,r=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0;this.overview_box.css({left:i,width:Math.max(13,r)}).show(),r<13&&this.overview_box.css("left",i-(13-r)/2),this.overview_highlight&&this.overview_highlight.css({left:i,width:r}),h.each(this.tracks_to_be_redrawn,function(t){var e=t[0],n=t[1];e&&e._draw(n)}),this.tracks_to_be_redrawn=[],h.each(this.label_tracks,function(t){t._draw()})},zoom_in:function(t,e){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var n=this.high-this.low,i=n/2+this.low,r=n/this.zoom_factor/2;t&&(i=t/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(i-r),this.high=Math.round(i+r),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var t=this.high-this.low,e=t/2+this.low,n=t*this.zoom_factor/2;this.low=Math.round(e-n),this.high=Math.round(e+n),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(t){if(this.overview_drawable){if(this.overview_drawable.dataset.id===t.dataset.id)return;this.overview_viewport.find(".track").remove()}var e=t.copy({content_div:this.overview_viewport}),n=this;e.header_div.hide(),e.is_overview=!0,n.overview_drawable=e,this.overview_drawable.postdraw_actions=function(){n.overview_highlight.show().height(n.overview_drawable.content_div.height()),n.overview_viewport.height(n.overview_drawable.content_div.height()+n.overview_box.outerHeight()),n.overview_close.show(),n.resize_window()},n.overview_drawable.request_draw(),this.changed()},reset_overview:function(){t(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),this.resize_window(),this.overview_drawable=null}});var H=E.default.Tool.extend({defaults:{track:null},initialize:function(t){E.default.Tool.prototype.initialize.call(this,t);var e=!0;void 0!==t.tool_state&&void 0!==t.tool_state.hidden&&(e=t.tool_state.hidden),this.set("hidden",e),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(t){return h.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),F=p.View.extend({events:{"change :input":"update_value"},render:function(){var e=this.$el.addClass("param-row"),n=this.model;t("<div>").addClass("param-label").text(n.get("label")).appendTo(e),t("<div/>").addClass("param-input").html(n.get("html")).appendTo(e).find(":input").val(n.get("value")),t("<div style='clear: both;'/>").appendTo(e)},update_value:function(e){this.model.set_value(t(e.target).val())}}),Y=p.View.extend({initialize:function(t){this.model.on("change:hidden",this.set_visible,this)},render:function(){var e=this,n=this.model,i=this.$el.addClass("dynamic-tool").hide();i.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).keydown(function(t){t.stopPropagation()}),t("<div class='tool-name'>").appendTo(i).text(n.get("name")),n.get("inputs").each(function(t){var e=new F({model:t});e.render(),i.append(e.$el)}),i.find("input").click(function(){t(this).select()});var r=t("<div>").addClass("param-row").appendTo(i),a=t("<input type='submit'>").attr("value","Run on complete dataset").appendTo(r);t("<input type='submit'>").attr("value","Run on visible region").appendTo(r).click(function(){e.run_on_region()}),a.click(function(){e.run_on_dataset()}),n.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var t=0;t<this.params.length;t++)this.params[t].update_value()},run_on_dataset:function(){var t=this.model;this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:t.id},null,function(e){Galaxy.modal.show({title:t.get("name")+" is Running",body:t.get("name")+" is running on the complete dataset. Tool outputs are in dataset's history.",buttons:{Close:function(){Galaxy.modal.hide()}}})})},run_on_region:function(){var t,e=this.model.get("track"),n=this.model,i=new g.default.GenomeRegion({chrom:e.view.chrom,start:e.view.low,end:e.view.high}),r={target_dataset_id:e.dataset.id,action:"rerun",tool_id:n.id,regions:[i.toJSON()]},a=n.get("name")+e.tool_region_and_parameters_str(i);if(e.container===e.view){var o=new G(e.view,e.view,{name:e.config.get_value("name")}),s=e.container.replace_drawable(e,o,!1);o.container_div.insertBefore(e.view.content_div.children()[s]),o.add_drawable(e),e.container_div.appendTo(o.content_div),t=o}else t=e.container;var l=new e.constructor(e.view,t,{name:a,hda_ldda:"hda"});l.init_for_tool_data(),l.change_mode(e.mode),l.set_filters_manager(e.filters_manager.copy(l)),l.update_icons(),t.add_drawable(l),l.tiles_div.text("Starting job."),this.run(r,l,function(t){l.set_dataset(new A.default.Dataset(t)),l.tiles_div.text("Running job."),l.init()})},run:function(e,n,i){e.inputs=this.model.get_inputs_dict();var r=new b.default.ServerStateDeferred({ajax_settings:{url:Galaxy.root+"api/tools",data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});t.when(r.go()).then(function(t){"no converter"===t?(n.container_div.addClass("error"),n.content_div.text(R)):t.error?(n.container_div.addClass("error"),n.content_div.text("Tool cannot be rerun: "+t.message)):i(t)})}}),q=function(t,e){M.default.Scaler.call(this,e),this.filter=t};q.prototype.gen_val=function(t){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(t[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var U=function(e,n,i,r,a){this.track=e,this.region=n,this.low=n.get("start"),this.high=n.get("end"),this.w_scale=i,this.canvas=r,this.html_elt=t("<div class='track-tile'/>").append(r),this.data=a,this.stale=!1};U.prototype.predisplay_actions=function(){};var B=function(t,e,n,i,r){U.call(this,t,e,n,i,r)};B.prototype.predisplay_actions=function(){};var X=function(t,e,n,i,r,a,o,s,l,c,d){U.call(this,t,e,n,i,r),this.mode=a,this.all_slotted=s,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=c,this.other_tiles_features_drawn={},this.seq_data=d};P(X.prototype,U.prototype),X.prototype.predisplay_actions=function(){};var J=function(e,n,i){P(i,{drag_handle_class:"draghandle"}),$.call(this,e,n,i),this.dataset=null,i.dataset&&(this.dataset=i.dataset instanceof p.Model?i.dataset:new A.default.Dataset(i.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in i?i.data_query_wait:5e3,this.data_manager="data_manager"in i?i.data_manager:new g.default.GenomeDataManager({dataset:this.dataset,genome:new g.default.Genome({key:e.dbkey,chroms_info:{chrom_info:e.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=t("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in i&&!i.resize||this.add_resize_handle())};P(J.prototype,$.prototype,{action_icons_def:[{name:"mode_icon",title:(0,d.default)("Set display mode"),css_class:"chevron-expand",on_click_fn:function(){}},$.prototype.action_icons_def[0],{name:"overview_icon",title:(0,d.default)("Set as overview"),css_class:"application-dock-270",on_click_fn:function(t){t.view.set_overview(t)}},$.prototype.action_icons_def[1],{name:"filters_icon",title:(0,d.default)("Filters"),css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?t.filters_manager.clear_filters():t.filters_manager.init_filters(),t.filters_manager.toggle()}},{name:"tools_icon",title:(0,d.default)("Tool"),css_class:"hammer",on_click_fn:function(e){e.tool.toggle(),e.tool.is_visible()?e.set_name(e.config.get_value("name")+e.tool_region_and_parameters_str()):e.revert_name(),t(".tooltip").remove()}},{name:"param_space_viz_icon",title:(0,d.default)("Tool parameter space visualization"),css_class:"arrow-split",on_click_fn:function(e){var n="\n                    <strong>Tool</strong>:"+e.tool.get("name")+"<br/>\n                    <strong>Dataset</strong>:"+e.config.get_value("name")+'<br/>\n                    <strong>Region(s)</strong>:\n                        <select name="regions">\n                            <option value="cur">current viewing area</option>\n                            <option value="bookmarks">bookmarks</option>\n                            <option value="both">current viewing area and bookmarks</option>\n                        </select>\n                    ',i=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc")},r=function(){var n,i=t('select[name="regions"] option:selected').val(),r=new g.default.GenomeRegion({chrom:(void 0).view.chrom,start:(void 0).view.low,end:(void 0).view.high}),a=h.map(t(".bookmark"),function(e){return new g.default.GenomeRegion({from_str:t(e).children(".position").text()})});n="cur"===i?[r]:"bookmarks"===i?a:[r].concat(a),Galaxy.modal.hide(),window.top.location.href=Galaxy.root+"visualization/sweepster?"+t.param({dataset_id:e.dataset.id,hda_ldda:e.dataset.get("hda_ldda"),regions:JSON.stringify(new p.Collection(n).toJSON())})};Galaxy.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:n,buttons:{No:i,Yes:r}})}},$.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&$.prototype.can_draw.call(this)},build_container_div:function(){return t("<div/>").addClass("track").attr("id","track_"+this.id)},set_dataset:function(t){this.dataset=t,this.data_manager.set("dataset",t)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var e=this,n=!1,i=!1,r=t("<div class='track-resize'>");t(e.container_div).hover(function(){e.config.get_value("content_visible")&&(n=!0,r.show())},function(){n=!1,i||r.hide()}),r.hide().bind("dragstart",function(n,r){i=!0,r.original_height=t(e.content_div).height()}).bind("drag",function(n,i){var r=Math.min(Math.max(i.original_height+i.deltaY,e.min_height_px),e.max_height_px);t(e.tiles_div).css("height",r),e.visible_height_px=e.max_height_px===r?0:r,e.on_resize()}).bind("dragend",function(t,a){e.tile_cache.clear(),i=!1,n||r.hide(),e.config.set_value("height",e.visible_height_px),e.changed()}).appendTo(e.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof K?"LabelTrack":this instanceof tt?"ReferenceTrack":this instanceof et?"LineTrack":this instanceof at?"ReadTrack":this instanceof rt?"VariantTrack":this instanceof Z?"CompositeTrack":this instanceof it?"FeatureTrack":""},show_message:function(e){return this.tiles_div.remove(),t("<span/>").addClass("message").html(e).appendTo(this.content_div)},init:function(e){var n=this;if(n.enabled=!1,n.tile_cache.clear(),n.data_manager.clear(),n.content_div.children().remove(),n.container_div.removeClass("nodata error pending"),n.tiles_div=t("<div/>").addClass("tiles").appendTo(n.content_div),n.dataset.id){var i=t.Deferred(),r={hda_ldda:n.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:n.view.chrom,retry:e};return t.getJSON(this.dataset.url(),r,function(e){if(e&&"error"!==e&&"error"!==e.kind)"no converter"===e?(n.container_div.addClass("error"),n.show_message(R)):"no data"===e||void 0!==e.data&&(null===e.data||0===e.data.length)?(n.container_div.addClass("nodata"),n.show_message("No data for this chrom/contig.")):"pending"===e?(n.container_div.addClass("pending"),n.show_message("Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background."),window.setTimeout(function(){n.init()},n.data_query_wait)):"data"!==e&&"data"!==e.status||(e.valid_chroms&&(n.valid_chroms=e.valid_chroms,n.update_icons()),n.tiles_div.text("Ready for display"),n.view.chrom?(n.tiles_div.text(""),n.tiles_div.css("height",n.visible_height_px+"px"),n.enabled=!0,t.when.apply(t,n.predraw_init()).done(function(){i.resolve(),n.container_div.removeClass("nodata error pending"),n.request_draw()})):i.resolve());else{n.container_div.addClass("error");var r=n.show_message("Cannot display dataset due to an error. ");e.message&&(r.append(t("<a href='javascript:void(0);'></a>").text("View error").click(function(){Galaxy.modal.show({title:(0,d.default)("Trackster Error"),body:"<pre>"+e.message+"</pre>",buttons:{Close:function(){Galaxy.modal.hide()}}})})),r.append(t("<span/>").text(" ")),r.append(t("<a href='javascript:void(0);'></a>").text("Try again").click(function(){n.init(!0)})))}}),this.update_icons(),i}},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var n=t.data;if(n&&void 0!==n.min&&void 0!==n.max){var i=n.min,r=n.max;i=Math.floor(Math.min(0,Math.max(i,n.mean-2*n.sd))),r=Math.ceil(Math.max(0,Math.min(r,n.mean+2*n.sd))),e.config.set_default_value("min_value",i),e.config.set_default_value("max_value",r),e.config.set_value("min_value",i),e.config.set_value("max_value",r)}})},get_drawables:function(){return this}});var Q=function(e,n,i){J.call(this,e,n,i);var r=this;if(o(r.container_div,r.drag_handle_class,".group",r),this.filters_manager=new S.default.FiltersManager(this,"filters"in i?i.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=i.tool?new H(h.extend(i.tool,{track:this,tool_state:i.tool_state})):null,this.tile_cache=new g.default.Cache(10),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var a=new Y({model:this.tool});a.render(),this.dynamic_tool_div=a.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=t("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=t("<div/>").addClass("overlay").appendTo(this.content_div),i.mode&&this.change_mode(i.mode)};P(Q.prototype,$.prototype,J.prototype,{action_icons_def:J.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(e){t(".tooltip").remove(),e.slotters[e.view.resolution_px_b].max_rows*=2,e.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(t){var e=this.to_dict();P(e,{data_manager:this.data_manager});var n=new this.constructor(this.view,t,e);return n.change_mode(this.mode),n.enabled=this.enabled,n},set_filters_manager:function(t){this.filters_manager=t,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var n=t.data;if(isNaN(parseFloat(e.config.get_value("min_value")))||isNaN(parseFloat(e.config.get_value("max_value")))){var i=n.min,r=n.max;i=Math.floor(Math.min(0,Math.max(i,n.mean-2*n.sd))),r=Math.ceil(Math.max(0,Math.min(r,n.mean+2*n.sd))),e.config.set_value("min_value",i),e.config.set_value("max_value",r)}})},change_mode:function(t){var e=this;return e.mode=t,e.config.set_value("mode",t),"Auto"===t&&this.data_manager.clear(),e.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: "+e.mode+")"),e},update_icons:function(){var t=this;t.action_icons.filters_icon.toggle(t.filters_available),t.action_icons.tools_icon.toggle(null!==t.tool),t.action_icons.param_space_viz_icon.toggle(null!==t.tool)},_gen_tile_cache_key:function(t,e){return t+"_"+e},request_draw:function(t){t&&t.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(t,this)},before_draw:function(){this.max_height_px=0},_draw:function(e){var n=this;if(this.can_draw()){var i=e&&e.clear_after,r=this.view.low,a=this.view.high,o=this.view.container.width(),s=this.view.resolution_px_b,l=1/s;this.is_overview&&(r=this.view.max_low,a=this.view.max_high,s=o/(this.view.max_high-this.view.max_low),l=1/s),this.before_draw(),this.tiles_div.children().addClass("remove");for(var c,d,u=Math.floor(400*l),f=Math.floor(r/u),p=[],_=[];f*u<a;)c=new g.default.GenomeRegion({chrom:this.view.chrom,start:f*u,end:Math.min((f+1)*u,this.view.max_high)}),d=this.draw_helper(c,s,e),p.push(d),t.when(d).then(function(t){_.push(t)}),f+=1;i||this.tiles_div.children(".remove").removeClass("remove").remove(),t.when.apply(t,p).then(function(){n.tiles_div.children(".remove").remove(),_=h.filter(_,function(t){return null!==t}),0!==_.length&&n.postdraw_actions(_,o,s,i)})}},_add_yaxis_label:function(e,n){var i=this,r="max"===e?"top":"bottom",a="max"===e?"max":"min",o="max"===e?"max_value":"min_value",l=this.container_div.find(".yaxislabel."+r),c=s(this.config.get_value(o),1);n=n||function(){i.request_draw({clear_tile_cache:!0})},0!==l.length?l.text(c):(l=t("<div/>").text(c).make_text_editable({num_cols:12,on_finish:function(e){t(".tooltip").remove(),this.config.set_value(o,s(e,1)),n()},help_text:"Set "+a+" value"}).addClass("yaxislabel "+r).css("color",this.config.get_value("label_color")),this.container_div.prepend(l))},postdraw_actions:function(t,e,n,i){var r=this;h.filter(t,function(t){return t instanceof B}).length>0?(this.max_height_px=0,h.each(t,function(t){t instanceof B||(t.html_elt.remove(),r.draw_helper(t.region,n,{force:!0,mode:"Coverage"}))}),this._add_yaxis_label("max")):(this.container_div.find(".yaxislabel").remove(),h.find(t,function(t){return t.has_icons})&&h.each(t,function(t){t.has_icons||t.html_elt.css("padding-top",20)}))},get_mode:function(t){return this.mode},update_auto_mode:function(t){},_get_drawables:function(){return[this]},draw_helper:function(e,n,i){var r=this;i||(i={});var a=i.force,o=i.mode||this.mode,s=1/n,l=this._get_drawables(),c=this._gen_tile_cache_key(n,e),d=a?void 0:this.tile_cache.get_elt(c);if(d)return function(t){return t&&"track"in t}(d)&&this.show_tile(d,n),d;if(!1===i.data_fetch)return null;var u=function(){var t=h.find(z,function(t){return t===o})?"Coverage":o,n=h.map(l,function(n){return n.data_manager.get_data(e,t,s,r.data_url_extra_params)});return r.view.reference_track&&n.push(r.view.reference_track.data_manager.get_data(e,o,s,r.view.reference_track.data_url_extra_params)),n},f=t.Deferred();return this.tile_cache.set_elt(c,f),t.when.apply(t,u()).then(function(){var a,o=u(),s=o;if(h.find(o,function(t){return b.default.is_deferred(t)}))return r.tile_cache.set_elt(c,void 0),void t.when(r.draw_helper(e,n,i)).then(function(t){f.resolve(t)});r.view.reference_track&&(a=r.view.reference_track.data_manager.subset_entry(o.pop(),e));var d=[],p=[];h.each(l,function(t,e){var i=s[e];"Auto"===t.mode&&(t.mode=t.get_mode(i),t.update_auto_mode(t.mode)),d.push(t.mode),p.push(t.get_canvas_height(i,t.mode,n,y))});var _,g=r.view.canvas_manager.new_canvas(),m=e.get("start"),v=e.get("end"),y=Math.ceil((v-m)*n)+r.left_offset,w=h.max(p);g.width=y,g.height=i.height||w;var x=g.getContext("2d");x.translate(r.left_offset,0),l.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),h.each(l,function(t,i){_=t.draw_tile(s[i],x,d[i],e,n,a)}),void 0!==_&&(r.tile_cache.set_elt(c,_),r.show_tile(_,n)),f.resolve(_)}),f},get_canvas_height:function(t,e,n,i){return this.visible_height_px},_draw_line_track_tile:function(t,e,n,i,r){-1!==[void 0,null].indexOf(this.config.get_value("min_value"))&&this.config.set_value("min_value",0),-1!==[void 0,null,0].indexOf(this.config.get_value("max_value"))&&this.config.set_value("max_value",h.max(h.map(t.data,function(t){return t[1]}))||0);var a=e.canvas;return new M.default.LinePainter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n).draw(e,a.width,a.height,r),new B(this,i,r,a,t.data)},draw_tile:function(t,e,n,i,r,a){},show_tile:function(t,e){var n=t.html_elt;t.predisplay_actions();var i=Math.round((t.low-(this.is_overview?this.view.max_low:this.view.low))*e);this.left_offset&&(i-=this.left_offset),n.css("left",i),n.hasClass("remove")?n.removeClass("remove"):this.tiles_div.append(n),n.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,n.height()-2),n.parent().children().css("height",this.max_height_px+"px");var r=this.max_height_px;0!==this.visible_height_px&&(r=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height",r+"px")},tool_region_and_parameters_str:function(t){var e=this;return" - region=["+(void 0!==t?t.toString():"all")+"], parameters=["+h.values(e.tool.get_inputs_dict()).join(", ")+"]"},data_and_mode_compatible:function(t,e){return"Auto"===e||("Coverage"===e?"bigwig"===t.dataset_type:"bigwig"!==t.dataset_type&&"no_detail"!==t.extra_info)},can_subset:function(t){return!t.message&&"no_detail"!==t.extra_info&&("bigwig"!==t.dataset_type||t.data[1][0]-t.data[0][0]==1)},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var K=function(t,e){J.call(this,t,e,{resize:!1,header:!1}),this.container_div.addClass("label-track")};P(K.prototype,J.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(e){for(var n=this.view,i=n.high-n.low,r=Math.floor(Math.pow(10,Math.floor(Math.log(i)/Math.log(10)))),a=Math.floor(n.low/r)*r,o=this.view.container.width(),s=t("<div/>").addClass("label-container");a<n.high;){var l=Math.floor((a-n.low)/i*o);s.append(t("<div/>").addClass("pos-label").text(b.default.commatize(a)).css({left:l})),a+=r}this.content_div.children(":first").remove(),this.content_div.append(s)}});var Z=function(t,e,n){if(Q.call(this,t,e,n),this.drawables=[],"drawables"in n){for(var i,r=0;r<n.drawables.length;r++)i=n.drawables[r],this.drawables[r]=st(i,t,null),i.left_offset>this.left_offset&&(this.left_offset=i.left_offset);this.enabled=!0}h.each(this.drawables,function(t){(t instanceof it||t instanceof at)&&t.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};P(Z.prototype,Q.prototype,{display_modes:z,build_config_params:function(){return h.union($.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},action_icons_def:[{name:"composite_icon",title:(0,d.default)("Show individual tracks"),css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_group()}}].concat(Q.prototype.action_icons_def),to_dict:W.prototype.to_dict,add_drawable:W.prototype.add_drawable,unpack_drawables:W.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var t=this.visible_height_px;h.each(this.drawables,function(e){e.visible_height_px=t}),J.prototype.on_resize.call(this)},change_mode:function(t){Q.prototype.change_mode.call(this,t);for(var e=0;e<this.drawables.length;e++)this.drawables[e].change_mode(t)},init:function(){for(var e=[],n=0;n<this.drawables.length;n++)e.push(this.drawables[n].init());var i=this;t.when.apply(t,e).then(function(){i.enabled=!0,i.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:$.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var t,e=new G(this.view,this.container,{name:this.config.get_value("name")}),n=0;n<this.drawables.length;n++)t=this.drawables[n],t.update_icons(),e.add_drawable(t),t.container=e,e.content_div.append(t.container_div);this.container.replace_drawable(this,e,!0),e.request_draw({clear_tile_cache:!0})},before_draw:function(){var t=h.min(h.map(this.drawables,function(t){return t.config.get_value("min_value")})),e=h.max(h.map(this.drawables,function(t){return t.config.get_value("max_value")}));this.config.set_value("min_value",t),this.config.set_value("max_value",e),h.each(this.drawables,function(n){n.config.set_value("min_value",t),n.config.set_value("max_value",e)})},update_all_min_max:function(){var t=this.config.get_value("min_value"),e=this.config.get_value("max_value");h.each(this.drawables,function(n){n.config.set_value("min_value",t),n.config.set_value("max_value",e)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(t,e,n,i){var r,a=-1;for(r=0;r<t.length;r++){var o=t[r].html_elt.find("canvas").height();o>a&&(a=o)}for(r=0;r<t.length;r++){var s=t[r];s.html_elt.find("canvas").height()!==a&&(this.draw_helper(s.region,n,{force:!0,height:a}),s.html_elt.remove())}var l=this,c=function(){l.update_all_min_max()};this._add_yaxis_label("min",c),this._add_yaxis_label("max",c)}});var tt=function(t){Q.call(this,t,{content_div:t.top_labeltrack},{resize:!1,header:!1}),this.left_offset=t.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url=Galaxy.root+"api/genomes/"+this.view.dbkey,this.data_url_extra_params={reference:!0},this.data_manager=new g.default.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};P(tt.prototype,$.prototype,Q.prototype,{build_config_params:function(){return h.union($.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}])},init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:$.prototype.can_draw,draw_helper:function(t,e,n){var i,r=this.tiles_div.is(":visible"),a=null;return e>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),i=!0,a=Q.prototype.draw_helper.call(this,t,e,n)):(i=!1,this.tiles_div.hide()),r!==i&&this.view.resize_viewport(),a},can_subset:function(t){return!0},draw_tile:function(t,e,n,i,r){var a=this.data_manager.subset_entry(t,i),o=a.data,s=e.canvas;e.font=e.canvas.manager.default_font,e.textAlign="center";for(var l=0,c=o.length;l<c;l++)e.fillStyle=this.view.get_base_color(o[l]),e.fillText(o[l],Math.floor(l*r),10);return new U(this,i,r,s,a)}});var et=function(e,n,i){this.mode="Histogram",Q.call(this,e,n,i),this.left_offset=30;var r=this;t.when(l(Galaxy.root+"datasets/"+this.dataset.id+"/display")).then(function(t){t&&(r.data_manager=new I.default.BBIDataManager({dataset:r.dataset}))})};P(et.prototype,$.prototype,Q.prototype,{display_modes:z,build_config_params:function(){return h.union($.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(t,e,n,i,r){return this._draw_line_track_tile(t,e,n,i,r)},can_subset:function(t){return t.data[1][0]-t.data[0][0]==1},postdraw_actions:function(t,e,n,i){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var nt=function(t,e,n){this.mode="Heatmap",Q.call(this,t,e,n)};P(nt.prototype,$.prototype,Q.prototype,{display_modes:["Heatmap"],build_config_params:function(){return h.union($.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){})},draw_tile:function(t,e,n,i,r){var a=e.canvas;return new M.default.DiagonalHeatmapPainter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n).draw(e,a.width,a.height,r),new U(this,i,r,a,t.data)}});var it=function(t,e,n){Q.call(this,t,e,n),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};P(it.prototype,$.prototype,Q.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return h.union($.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=M.default.ArcLinkedFeaturePainter:this.painter=M.default.LinkedFeaturePainter},postdraw_actions:function(e,n,i,r){var a=this;if(Q.prototype.postdraw_actions.call(this,e,n,i,r),0===h.filter(e,function(t){return t instanceof B}).length){var o={};h.each(h.pluck(e,"incomplete_features"),function(t){h.each(t,function(t){o[t[0]]=t})}),h.each(e,function(e){var n=h.omit(o,h.map(e.incomplete_features,function(t){return t[0]}));if(n=h.omit(n,h.keys(e.other_tiles_features_drawn)),0!==h.size(n)){var i={data:h.values(n)},r=a.view.canvas_manager.new_canvas(),s=r.getContext("2d");r.height=Math.max(e.canvas.height,a.get_canvas_height(i,e.mode,e.w_scale,100)),r.width=e.canvas.width,s.drawImage(e.canvas,0,0),s.translate(a.left_offset,0);var l=a.draw_tile(i,s,e.mode,e.region,e.w_scale,e.seq_data);t(e.canvas).replaceWith(t(l.canvas)),e.canvas=r,h.extend(e.other_tiles_features_drawn,o)}})}if(this.filters_manager){var s,l=this.filters_manager.filters;for(s=0;s<l.length;s++)l[s].update_ui_elt();for(var c,d,u=!1,f=0;f<e.length;f++)if(e[f].data.length)for(c=e[f].data[0],s=0;s<l.length;s++)if(d=l[s],d.applies_to(c)&&d.min!==d.max){u=!0;break}this.filters_available!==u&&(this.filters_available=u,this.filters_available||this.filters_manager.hide(),this.update_icons())}if(e[0]instanceof X){for(var p=!0,_=0;_<e.length;_++)if(!e[_].all_slotted){p=!1;break}this.action_icons.show_more_rows_icon.toggle(!p)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(t){"Auto"===this.mode&&("no_detail"===t&&(t="feature spans"),this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/"+t+")"))},incremental_slots:function(t,e,n){var i=this.view.canvas_manager.dummy_context,r=this.slotters[t];return r&&r.mode===n||(r=new x.default.FeatureSlotter(t,n,100,function(t){return i.measureText(t)}),this.slotters[t]=r),r.slot_features(e)},get_mode:function(t){return"no_detail"===t.extra_info||this.is_overview?"no_detail":this.view.high-this.view.low>12e3?"Squish":"Pack"},get_canvas_height:function(t,e,n,i){if("Coverage"===e||"bigwig"===t.dataset_type)return this.summary_draw_height;var r=this.incremental_slots(n,t.data,e),a=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return Math.max(this.min_height_px,a.get_required_height(r,i))},draw_tile:function(t,e,n,i,r,a,o){var s=this,l=e.canvas,c=i.get("start"),d=i.get("end"),u=this.left_offset;if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,n,i,r);var h=[],f=this.slotters[r].slots,p=!0;if(t.data)for(var _=this.filters_manager.filters,g=0,m=t.data.length;g<m;g++){for(var v,y=t.data[g],b=!1,w=0,x=_.length;w<x;w++)if(v=_[w],v.update_attrs(y),!v.keep(y)){b=!0;break}b||(h.push(y),y[0]in f||(p=!1))}var k=this.filters_manager.alpha_filter?new q(this.filters_manager.alpha_filter):null,M=this.filters_manager.height_filter?new q(this.filters_manager.height_filter):null,C=new this.painter(h,c,d,this.config.to_key_value_dict(),n,k,M,a,function(t){return s.view.get_base_color(t)}),S=null,T=null;if(e.fillStyle=this.config.get_value("block_color"),e.font=e.canvas.manager.default_font,e.textAlign="right",t.data){var A=C.draw(e,l.width,l.height,r,f);S=A.feature_mapper,T=A.incomplete_features,S.translation=-u}return o?void 0:new X(s,i,r,l,t.data,n,t.message,p,S,T,a)}});var rt=function(t,e,n){Q.call(this,t,e,n),this.painter=M.default.VariantPainter,this.summary_draw_height=30,this.left_offset=30};P(rt.prototype,$.prototype,Q.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return h.union($.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(t,e,n,i,r){if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,"Histogram",i,r);var a=this.view;return new this.painter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n,function(t){return a.get_base_color(t)}).draw(e,e.canvas.width,e.canvas.height,r),new U(this,i,r,e.canvas,t.data)},get_canvas_height:function(t,e,n,i){if("bigwig"===t.dataset_type)return this.summary_draw_height;var r=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;return 0===r&&0!==t.data.length&&(r=t.data[0][7].match(/,/g),r=null===r?1:r.length+1),new this.painter(null,null,null,this.config.to_key_value_dict(),e).get_required_height(r)},predraw_init:function(){var t=[J.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||t.push(this.dataset.fetch()),t},postdraw_actions:function(e,n,i,r){Q.prototype.postdraw_actions.call(this,e,n,i,r);var a=h.filter(e,function(t){return t instanceof B}),o=this.dataset.get_metadata("sample_names");if(0===a.length&&this.config.get_value("show_labels")&&o&&o.length>1){var s;if(0===this.container_div.find(".yaxislabel.variant").length&&(s=this.config.get_value("summary_height")/2,this.tiles_div.prepend(t("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":s+"px",top:(this.config.get_value("summary_height")-s)/2+"px"})),this.config.get_value("show_sample_data"))){var l=o.join("<br/>");this.tiles_div.prepend(t("<div/>").html(l).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}s=("Squish"===this.mode?5:10)+"px",t(this.tiles_div).find(".sample").css({"font-size":s,"line-height":s}),t(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var at=function(t,e,n){it.call(this,t,e,n),this.painter=M.default.ReadPainter,this.update_icons()};P(at.prototype,$.prototype,Q.prototype,it.prototype,{build_config_params:function(){return h.union($.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var ot={CompositeTrack:Z,DrawableGroup:G,DiagonalHeatmapTrack:nt,FeatureTrack:it,LineTrack:et,ReadTrack:at,VariantTrack:rt,VcfTrack:rt},st=function(t,e,n){if("copy"in t)return t.copy(n);var i=t.obj_type;return i||(i=t.track_type),new ot[i](e,n,t)};e.default={TracksterView:V,DrawableGroup:G,LineTrack:et,FeatureTrack:it,DiagonalHeatmapTrack:nt,ReadTrack:at,VariantTrack:rt,CompositeTrack:Z,object_from_template:st}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(5),c=a(l),d=n(10),u=a(d),h=n(17),f=a(h),p=n(55),_=a(p),g=n(25),m=a(g),v=t.View.extend({initialize:function(t){var e=this;this.modal=parent.Galaxy.modal||new f.default.View,this.form=new _.default(c.default.merge({listen_to_history:!0,always_refresh:!1,buildmodel:function(t,n){var r=n.model.attributes,a="",o={},l=r.job_id;l?a=Galaxy.root+"api/jobs/"+l+"/build_for_rerun":(a=Galaxy.root+"api/tools/"+r.id+"/build",o=i.extend({},Galaxy.params),o.tool_id&&delete o.tool_id),r.version&&(o.tool_version=r.version),c.default.get({url:a,data:o,success:function(i){if(!i.display)return void(window.location=Galaxy.root);n.model.set(i),e._customize(n),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model ready.",i),t.resolve()},error:function(e,a){var o=e&&e.err_msg||"Uncaught error.";401==a?window.location=Galaxy.root+"user/login?"+i.param({redirect:Galaxy.root+"?tool_id="+r.id}):n.$el.is(":empty")?n.$el.prepend(new u.default.Message({message:o,status:"danger",persistent:!0,large:!0}).$el):Galaxy.modal&&Galaxy.modal.show({title:(0,s.default)("Tool request failed"),body:o,buttons:{Close:function(){Galaxy.modal.hide()}}}),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model request failed.",e),t.reject()}})},postchange:function(t,e){var n={tool_id:e.model.get("id"),tool_version:e.model.get("version"),inputs:i.extend(!0,{},e.data.create())};e.wait(!0),Galaxy.emit.debug("tool-form::postchange()","Sending current state.",n),c.default.request({type:"POST",url:Galaxy.root+"api/tools/"+e.model.get("id")+"/build",data:n,success:function(n){e.update(n),e.wait(!1),Galaxy.emit.debug("tool-form::postchange()","Received new model.",n),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form::postchange()","Refresh request failed.",e),t.reject()}})}},t)),this.deferred=this.form.deferred,this.setElement("<div/>"),this.$el.append(this.form.$el)},_customize:function(t){var e=this,n=t.model.attributes,i=new u.default.Button({icon:"fa-check",tooltip:"Execute: "+n.name+" ("+n.version+")",title:(0,s.default)("Execute"),cls:"btn btn-primary ui-clear-float",wait_cls:"btn btn-info ui-clear-float",onclick:function(){i.wait(),t.portlet.disable(),e.submit(n,function(){i.unwait(),t.portlet.enable()})}});if(n.buttons={execute:i},n.job_id&&n.job_remap){if("job_produced_collection_elements"===n.job_remap)var r="Replace elements in collection ?",a="The previous run of this tool failed. Use this option to replace the failed element(s) in the dataset collectio that were produced during the previous tool run.";else var r="Resume dependencies from this job ?",a="The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run.";n.inputs.push({label:r,name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",n.job_id],["No","__ignore__"]],help:a})}var o={};Galaxy.user.attributes.preferences&&"extra_user_preferences"in Galaxy.user.attributes.preferences&&(o=JSON.parse(Galaxy.user.attributes.preferences.extra_user_preferences)),"true"===("use_cached_job|use_cached_job_checkbox"in o&&o["use_cached_job|use_cached_job_checkbox"])&&n.inputs.push({label:"BETA: Attempt to re-use jobs with identical parameters ?",help:"This may skip executing jobs that you have already run",name:"use_cached_job",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["No",!1],["Yes",!0]]})},submit:function(t,e){var n=this,a={tool_id:t.id,tool_version:t.version,inputs:this.form.data.create()};if(this.form.trigger("reset"),!n.validate(a))return Galaxy.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(e&&e());if(t.action!==Galaxy.root+"tool_runner/index"){var o=i("<form/>").attr({action:t.action,method:t.method,enctype:t.enctype});return r.each(a.inputs,function(t,e){o.append(i("<input/>").attr({name:e,value:t}))}),o.hide().appendTo("body").submit().remove(),void(e&&e())}Galaxy.emit.debug("tool-form::submit()","Validation complete.",a),c.default.request({type:"POST",url:Galaxy.root+"api/tools",data:a,success:function(t){if(e&&e(),n.$el.children().hide(),n.$el.append(n._templateSuccess(t)),t.jobs&&t.jobs.length>0){n.$el.append(i("<div/>",{id:"webhook-view"}));new m.default.WebhookView({type:"tool",toolId:a.tool_id})}parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.refreshContents()},error:function(t){e&&e(),Galaxy.emit.debug("tool-form::submit","Submission failed.",t);var i=!1;if(t&&t.err_data){var r=n.form.data.matchResponse(t.err_data);for(var o in r){n.form.highlight(o,r[o]),i=!0;break}}i||n.modal.show({title:(0,s.default)("Job submission failed"),body:n._templateError(a,t&&t.err_msg),buttons:{Close:function(){n.modal.hide()}}})}})},validate:function(t){var e=this,n=t.inputs,i=-1,r=null;for(var a in n){var o=n[a],s=this.form.data.match(a),l=this.form.field_list[s],c=this.form.input_list[s];if(s&&c&&l){if(!c.optional&&null==o)return this.form.highlight(s),!1;if(l.validate){var d=function(){e.form.trigger("reset")},u=l.validate(d);if(!u.valid)return this.form.highlight(s,u.message),!1}if(o&&o.batch){var h=o.values.length,f=h>0&&o.values[0]&&o.values[0].src;if(f)if(null===r)r=f;else if(r!==f)return this.form.highlight(s,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===i)i=h;else if(i!==h)return this.form.highlight(s,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+h+"</b> selection(s) while a previous field contains <b>"+i+"</b>."),!1}}else Galaxy.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0},_templateSuccess:function(t){if(t.jobs&&t.jobs.length>0){var e=t.jobs.length,n=1==e?"1 job has":e+" jobs have",a=i("<div/>").addClass("donemessagelarge").append(i("<p/>").text(n+" been successfully added to the queue - resulting in the following datasets:"));return r.each(t.outputs,function(t){a.append(i("<p/>").addClass("messagerow").append(i("<b/>").text(t.hid+": "+t.name)))}),a.append(i("<p/>").append("<b/>").text("You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.")),a}return this._templateError(t,"Invalid success response. No jobs found.")},_templateError:function(t,e){return i("<div/>").addClass("errormessagelarge").append(i("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. "+(e||""))).append(i("<pre/>").text(JSON.stringify(t,null,4)))}});e.default={View:v}}).call(e,n(2),n(0),n(1))},,,function(t,e,n){"use strict";function i(t){n(88)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(43),a=n.n(r);for(var o in r)"default"!==o&&function(t){n.d(e,t,function(){return r[t]})}(o);var s=n(136),l=n(23),c=i,d=Object(l.a)(a.a,s.a,s.b,!1,c,null,null);e.default=d.exports},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(6),l=o(s),c=n(3),d=(o(c),t.View.extend(l.default.LoggableMixin).extend({_logNamespace:"list",initialize:function(t){this.expanded=t.expanded||!1,this.log("\t expanded:",this.expanded),this.fxSpeed=void 0!==t.fxSpeed?t.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(t){var e=this._buildNewRender();return this._setUpBehaviors(e),this._queueNewRender(e,t),this},_buildNewRender:function(){var t=i(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(t).replaceWith(this._renderDetails().show()),t},_queueNewRender:function(t,e){e=void 0===e?this.fxSpeed:e;var n=this;0===e?(n._swapNewRender(t),n.trigger("rendered",n)):i(n).queue("fx",[function(t){n.$el.fadeOut(e,t)},function(e){n._swapNewRender(t),e()},function(t){n.$el.fadeIn(e,t)},function(t){n.trigger("rendered",n),t()}])},_swapNewRender:function(t){return this.$el.empty().attr("class",r.isFunction(this.className)?this.className():this.className).append(t.children())},_setUpBehaviors:function(t){t=t||this.$el,t.find("[title]").tooltip({placement:"bottom"})},$details:function(t){return t=t||this.$el,t.find("> .details")},_renderDetails:function(){var t=i(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(t),t},toggleExpanded:function(t){return t=void 0===t?!this.expanded:t,t?this.expand():this.collapse(),this},expand:function(){var t=this;return t._fetchModelDetails().always(function(){t._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?a.when():this.model.fetch()},_expand:function(){var t=this,e=t._renderDetails();t.$details().replaceWith(e),t.expanded=!0,t.$details().slideDown(t.fxSpeed,function(){t.trigger("expanded",t)})},collapse:function(){this.debug(this+"(ExpandableView).collapse");var t=this;t.expanded=!1,this.$details().slideUp(t.fxSpeed,function(){t.trigger("collapsed",t)})}})),u=d.extend(l.default.mixin(l.default.SelectableViewMixin,l.default.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(t){d.prototype.initialize.call(this,t),l.default.SelectableViewMixin.initialize.call(this,t),l.default.DraggableViewMixin.initialize.call(this,t),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(t){t?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var t=d.prototype._buildNewRender.call(this);return t.children(".warnings").replaceWith(this._renderWarnings()),t.children(".title-bar").replaceWith(this._renderTitleBar()),t.children(".primary-actions").append(this._renderPrimaryActions()),t.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),t},_swapNewRender:function(t){return d.prototype._swapNewRender.call(this,t),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var t=this,e=i('<div class="warnings"></div>'),n=t.model.toJSON();return r.each(t.templates.warnings,function(r){e.append(i(r(n,t)))}),e},_renderTitleBar:function(){return i(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return i(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(t){t.stopPropagation(),t.altKey?(this.toggleSelect(t),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(t){return!t||"keydown"!==t.type||32!==t.keyCode&&13!==t.keyCode||(this.toggleExpanded(),t.stopPropagation(),!1)},toString:function(){return"ListItemView("+(this.model?""+this.model:"(no model)")+")"}}));u.prototype.templates=function(){return{el:l.default.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),warnings:{},titleBar:l.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),subtitle:l.default.wrapTemplate(['<div class="subtitle"></div>']),details:l.default.wrapTemplate(['<div class="details"></div>'])}}();var h=u.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(t){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=t.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=t.foldoutPanelClass||this.foldoutPanelClass,u.prototype.initialize.call(this,t),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return i();var t=u.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,t)},_createFoldoutPanel:function(){var t=this.model,e=this._getFoldoutPanelClass(t),n=this._getFoldoutPanelOptions(t);return new e(r.extend(n,{model:t}))},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(t,e){return e=e||this.$("> .details"),this.foldout=t.render(0),t.$("> .controls").hide(),e.append(t.$el)},expand:function(){var t=this;return t._fetchModelDetails().always(function(){"foldout"===t.foldoutStyle?t._expand():"drilldown"===t.foldoutStyle&&t._expandByDrilldown()})},_expandByDrilldown:function(){var t=this;t.listenTo(t.foldout,"close",function(){t.trigger("collapsed:drilldown",t,t.foldout)}),t.trigger("expanded:drilldown",t,t.foldout)}});h.prototype.templates=function(){var t=l.default.wrapTemplate(['<div class="details">',"</div>"],"collection");return r.extend({},u.prototype.templates,{details:t})}(),e.default={ExpandableView:d,ListItemView:u,FoldoutListItemView:h}}).call(e,n(2),n(0),n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(6),o=r(a),s=n(3),l=r(s),c=t.View.extend(o.default.LoggableMixin).extend(o.default.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"tags-display",select_width:"100%",events:{},initialize:function(t){this.show_editor=!1,!1===t.usePrompt?this.label="":this.label='<label class="prompt">'+(0,l.default)("Tags")+"</label>",this.workflow_mode=t.workflow_mode||!1,this.workflow_mode&&(this.events.click="showEditor",this.events.keydown="keydownHandler"),this.hiddenUntilActivated(t.$activator,t)},render:function(){var t=this;return this.workflow_mode?this.$el.html(this._workflowTemplate()):this.$el.html(this._defaultTemplate()),this.$input().select2({placeholder:"Add tags",width:this.workflow_mode?this.width:this.select_width,tags:function(){return t._getTagsUsed()}}),this._setUpBehaviors(),this},_hashToName:function(t){return t.startsWith("#")?"name:"+t.slice(1):t},_nameToHash:function(t){return t.startsWith("name:")&&(t="#"+t.slice(5)),t},_defaultTemplate:function(){return[this.label,this._renderEditor()].join("")},_workflowTemplate:function(){return[this.show_editor?this._renderEditor():this._renderTags()].join(" ")},keydownHandler:function(t){switch(t.which){case 27:this.hideEditor()}},showEditor:function(){this.show_editor=!0,this.render()},hideEditor:function(){this.show_editor=!1,this.render()},_renderEditor:function(){return'<input class="tags-input" value="'+this.tagsToCSV()+'"/>'},_renderTags:function(){var t=this.model.get("tags"),e=Galaxy.root+"static/images/fugue/tag--plus.png",n=[];return i.each(t,function(t){t=0==t.indexOf("name:")?t.slice(5):t;var e='<span class="badge badge-primary badge-tags">'+t+"</span>";n.push(e)}),0===n.length&&n.push("<img src="+e+' class="add-tag-button" title="Add tags"/>'),n.join(" ")},tagsToCSV:function(){var t=this,e=this.model.get("tags");return!i.isArray(e)||i.isEmpty(e)?"":e.map(function(e){return i.escape(t._nameToHash(e))}).sort().join(",")},$input:function(){return this.$el.find("input.tags-input")},_getTagsUsed:function(){var t=this;return i.map(Galaxy.user.get("tags_used"),t._nameToHash)},_setUpBehaviors:function(){var t=this;this.$input().on("change",function(e){e.val=i.map(e.val,t._hashToName),t.model.save({tags:e.val}),e.added&&t._addNewTagToTagsUsed(""+e.added.text)})},_addNewTagToTagsUsed:function(t){var e=Galaxy.user.get("tags_used");i.contains(e,t)||(e.push(t),e.sort(),Galaxy.user.set("tags_used",e))},remove:function(){this.$input.off(),this.stopListening(this.model),t.View.prototype.remove.call(this)},toString:function(){return["TagsEditor(",""+this.model,")"].join("")}});e.default={TagsEditor:c}}).call(e,n(2),n(1))},,function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function a(t,e){return this._init(t||{},e||{})}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),s=r(o),l=n(2),c=r(l),d=n(6),u=i(d),h=n(60),f=i(h),p=n(72),_=i(p),g=n(71),m=i(g),v=n(3),y=i(v);(0,m.default)(a,"GalaxyApp");var b="galaxy:debug:namespaces",w=!1;try{w="true"==localStorage.getItem("galaxy:debug")}catch(t){console.log((0,y.default)("localStorage not available for debug flag retrieval"))}a.prototype._init=function(t,e){var n=this;return s.extend(n,c.Events),w&&(n.logger=console,console.debug("debugging galaxy:","options:",t,"bootstrapped:",e)),n._processOptions(t),n.root=t.root||"/",n.params=t.params||{},n.session_csrf_token=t.session_csrf_token||null,n._initConfig(t.config||{}),n._patchGalaxy(window.Galaxy),n._initLogger(n.options.loggerOptions||{}),n.debug("GalaxyApp.options: ",n.options),n.debug("GalaxyApp.config: ",n.config),n.debug("GalaxyApp.logger: ",n.logger),n._initLocale(),n.debug("GalaxyApp.localize: ",n.localize),n.config=t.config||{},n.debug("GalaxyApp.config: ",n.config),n._initUser(t.user||{}),n.debug("GalaxyApp.user: ",n.user),n._initUserLocale(),n.debug("currentLocale: ",sessionStorage.getItem("currentLocale")),n._setUpListeners(),n.trigger("ready",n),n},a.prototype.defaultOptions={patchExisting:!0,root:"/",session_csrf_token:null},a.prototype._processOptions=function(t){var e=this,n=e.defaultOptions;e.options={};for(var i in n)n.hasOwnProperty(i)&&(e.options[i]=t.hasOwnProperty(i)?t[i]:n[i]);return e},a.prototype._initConfig=function(t){var e=this;return e.config=t,e.config.debug=w||e.config.debug,e},a.prototype._patchGalaxy=function(t){var e=this;if(e.options.patchExisting&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},a.prototype._initLogger=function(t){var e=this;if(e.config.debug){t.consoleLogger=t.consoleLogger||console,t.consoleLevel=t.consoleLevel||_.default.MetricsLogger.ALL;try{t.consoleNamespaceWhitelist=localStorage.getItem(b).split(",")}catch(t){}try{t.consoleFlattenMessages="true"==localStorage.getItem("galaxy:debug:flatten")}catch(t){}console.log(t.consoleFlattenMessages)}return e.logger=new _.default.MetricsLogger(t),e.emit={},["log","debug","info","warn","error","metric"].map(function(t){e.emit[t]=function(n){e.logger.emit(t,arguments[0],Array.prototype.slice.call(arguments,1))}}),e.config.debug&&(u.default.LoggableMixin.logger=e.logger),e},a.prototype._initLocale=function(t){var e=this;return e.debug("_initLocale:",t),e.localize=y.default,window._l=e.localize,e},a.prototype._initUserLocale=function(t){var e=this,n=!!e.config.default_locale&&e.config.default_locale.toLowerCase(),i={};e.user&&e.user.attributes.preferences&&"extra_user_preferences"in e.user.attributes.preferences&&(i=JSON.parse(e.user.attributes.preferences.extra_user_preferences));var r="localization|locale"in i&&i["localization|locale"].toLowerCase();"auto"==r&&(r=!1);var a="undefined"==typeof navigator?"__root":(navigator.language||navigator.userLanguage||"__root").toLowerCase(),o=r||n||a;sessionStorage.setItem("currentLocale",o)},a.prototype._initUser=function(t){var e=this;return e.debug("_initUser:",t),e.user=new f.default.User(t),e.user.logger=e.logger,e},a.prototype._setUpListeners=function(){var e=this;return e.lastAjax={},t(document).bind("ajaxSend",function(t,n,i){var r=i.data;try{r=JSON.parse(r)}catch(t){}e.lastAjax={url:location.href.slice(0,-1)+i.url,data:r}}),e},a.prototype.debugging=function(t){var e=this;try{if(void 0===t)return"true"===localStorage.getItem("galaxy:debug");if(t)return localStorage.setItem("galaxy:debug",!0),!0;localStorage.removeItem("galaxy:debug"),e.debuggingNamespaces(null)}catch(t){console.log((0,y.default)("localStorage not available for debug flag retrieval"))}return!1},a.prototype.debuggingNamespaces=function(t){var e=this;try{if(void 0===t){var n=localStorage.getItem(b);return"string"==typeof n?n.split(","):[]}null===t?localStorage.removeItem(b):localStorage.setItem(b,t);var i=e.debuggingNamespaces();return e.logger&&(e.logger.options.consoleNamespaceWhitelist=i),i}catch(t){console.log((0,y.default)("localStorage not available for debug namespace retrieval"))}},a.prototype.toString=function(){return"GalaxyApp("+(this.user?this.user.get("email")||"(anonymous)":"uninitialized")+")"},window.Galaxy=window.Galaxy||new a,e.default={GalaxyApp:a}}).call(e,n(0))},,function(t,e,n){"use strict";(function(t){function n(t){t=t||{};var e=this;return e.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,e.userId=e.userId||t.userId||null,e.consoleLogger=t.consoleLogger||null,e._init(t),e}function i(t){var e=String(t);return"[object Object]"==e&&(e=JSON.stringify(t)),e}function r(t){return this._init(t||{})}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.ALL=0,n.LOG=0,n.DEBUG=10,n.INFO=20,n.WARN=30,n.ERROR=40,n.METRIC=50,n.NONE=100,n.defaultOptions={logLevel:n.NONE,consoleLevel:n.NONE,defaultNamespace:"Galaxy",consoleNamespaceWhitelist:null,consoleFlattenMessages:!1,clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},n.prototype._init=function(t){var e=this;e.options={};for(var i in n.defaultOptions)n.defaultOptions.hasOwnProperty(i)&&(e.options[i]=t.hasOwnProperty(i)?t[i]:n.defaultOptions[i]);return e.options.logLevel=e._parseLevel(e.options.logLevel),e.options.consoleLevel=e._parseLevel(e.options.consoleLevel),e._sending=!1,e._waiting=null,e._postSize=e.options.postSize,e._initCache(),e},n.prototype._initCache=function(){try{this.cache=new r({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(t){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",t]),this.options.logLevel=n.NONE}},n.prototype._parseLevel=function(t){var e=void 0===t?"undefined":a(t);if("number"===e)return t;if("string"===e){var i=t.toUpperCase();if(n.hasOwnProperty(i))return n[i]}throw new Error("Unknown log level: "+t)},n.prototype.emit=function(t,e,n){var i=this;return e=e||i.options.defaultNamespace,t&&n?(t=i._parseLevel(t),t>=i.options.logLevel&&i._addToCache(t,e,n),i.consoleLogger&&t>=i.options.consoleLevel&&i._emitToConsole(t,e,n),i):i},n.prototype._addToCache=function(t,e,n){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);var i=this;try{i.cache.add(i._buildEntry(t,e,n))>=i._postSize&&i._postCache()}catch(t){i._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",e,n]),i._emitToConsole("error","MetricsLogger",[t])}return i},n.prototype._buildEntry=function(t,e,n){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var i={level:t,namespace:this.options.clientPrefix+e,args:n};return this.options.addTime&&(i.time=(new Date).toISOString()),i},n.prototype._postCache=function(e){if(e=e||{},this._emitToConsole("info","MetricsLogger",["_postCache",e,this._postSize]),!this.options.postUrl||this._sending)return t.when({});var n=this,i=e.count||n._postSize,r=n.cache.get(i),a=r.length,o="function"==typeof n.options.getPingData?n.options.getPingData():{};return o.metrics=JSON.stringify(r),n._sending=!0,t.post(n.options.postUrl,o).always(function(){n._sending=!1}).fail(function(t,e,i){n._postSize=n.options.maxCacheSize,n.emit("error","MetricsLogger",["_postCache error:",t.readyState,t.status,t.responseJSON||t.responseText])}).done(function(t){"function"==typeof n.options.onServerResponse&&n.options.onServerResponse(t),n.cache.remove(a),n._postSize=n.options.postSize})},n.prototype._delayPost=function(){var t=this;t._waiting=setTimeout(function(){t._waiting=null},t.options.delayPostInMs)},n.prototype._emitToConsole=function(t,e,r){var a=this,o=a.options.consoleNamespaceWhitelist;if(!a.consoleLogger)return a;if(o&&-1===o.indexOf(e))return a;var s=Array.prototype.slice.call(r,0);return s.unshift(e),a.options.consoleFlattenMessages&&(s=[s.map(i).join(" ")]),t>=n.METRIC&&"function"==typeof a.consoleLogger.info?a.consoleLogger.info.apply(a.consoleLogger,s):t>=n.ERROR&&"function"==typeof a.consoleLogger.error?a.consoleLogger.error.apply(a.consoleLogger,s):(t>=n.WARN&&"function"==typeof a.consoleLogger.warn?a.consoleLogger.warn.apply(a.consoleLogger,s):t>=n.INFO&&"function"==typeof a.consoleLogger.info?a.consoleLogger.info.apply(a.consoleLogger,s):t>=n.DEBUG&&"function"==typeof a.consoleLogger.debug?a.consoleLogger.debug.apply(a.consoleLogger,s):"function"==typeof a.consoleLogger.log&&a.consoleLogger.log.apply(a.consoleLogger,s),a)},n.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.debug=function(){this.emit(n.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.info=function(){this.emit(n.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.warn=function(){this.emit(n.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.error=function(){this.emit(n.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},n.prototype.metric=function(){this.emit(n.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},r.defaultOptions={maxSize:5e3},r.prototype._init=function(t){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!t.key)throw new Error("LoggingCache needs key for localStorage");return this.key=t.key,this._initStorage(),this.maxSize=t.maxSize||r.defaultOptions.maxSize,this},r.prototype._hasStorage=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}},r.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},r.prototype.add=function(t){var e=this,n=e._fetchAndParse(),i=n.length+1-e.maxSize;return i>0&&n.splice(0,i),n.push(t),e._unparseAndStore(n),n.length},r.prototype._fetchAndParse=function(){var t=this;return JSON.parse(localStorage.getItem(t.key))},r.prototype._unparseAndStore=function(t){var e=this;return localStorage.setItem(e.key,JSON.stringify(t))},r.prototype.length=function(){return this._fetchAndParse().length},r.prototype.get=function(t){return this._fetchAndParse().slice(0,t)},r.prototype.remove=function(t){var e=this._fetchAndParse(),n=e.splice(0,t);return this._unparseAndStore(e),n},r.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},r.prototype.stringify=function(t){return JSON.stringify(this.get(t))},r.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},e.default={MetricsLogger:n,LoggingCache:r}}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(9),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(r),o=n(74),s=i(o),l=n(76),c=i(l),d=n(142),u=i(d),h=a.View.extend({initialize:function(e){var n=this;this.options=e,this.setElement(this._template()),this.$navbarBrandLink=this.$(".navbar-brand"),this.$navbarBrandImage=this.$(".navbar-brand-image"),this.$navbarBrandTitle=this.$(".navbar-brand-title"),this.$navbarTabs=this.$(".navbar-nav"),this.$quoteMeter=this.$(".quota-meter-container"),this.collection=new s.default.Collection,this.collection.on("add",function(t){n.$navbarTabs.append(new s.default.Tab({model:t}).render().$el)}).on("reset",function(){n.$navbarTabs.empty()}).on("dispatch",function(t){n.collection.each(function(e){t(e)})}).fetch(this.options),this.highlight(e.active_view),Galaxy.frame=this.frame=new c.default({collection:this.collection}),Galaxy.quotaMeter=this.quotaMeter=new u.default.UserQuotaMeter({model:Galaxy.user,el:this.$quoteMeter}),t(window).on("click",function(e){var n=t(e.target).closest("a[download]");1==n.length&&(0===t("iframe[id=download]").length&&t("body").append(t("<iframe/>").attr("id","download").hide()),t("iframe[id=download]").attr("src",n.attr("href")),e.preventDefault())}).on("beforeunload",function(){var t="";if(n.collection.each(function(e){var n=e.get("onbeforeunload")&&e.get("onbeforeunload")();n&&(t+=n+" ")}),""!==t)return t})},render:function(){return this.$navbarBrandTitle.html("ImmPort Galaxy "+(this.options.brand&&"/ "+this.options.brand||"")),this.$navbarBrandLink.attr("href",this.options.logo_url),this.$navbarBrandImage.attr("src",this.options.logo_src),this.quotaMeter.render(),this},highlight:function(t){this.collection.forEach(function(e){e.set("active",e.id==t)})},_template:function(){return'\n            <nav id="masthead" class="navbar navbar-expand fixed-top justify-content-center navbar-dark">\n                <a class="navbar-brand">\n                    <img class="navbar-brand-image"/>\n                    <span class="navbar-brand-title"/>\n                </a>\n                <ul class="navbar-nav"/>\n                <div class="quota-meter-container"/>\n            </nav>'}});e.default={View:h}}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=n(9),o=r(a),s=n(1),l=r(s),c=n(75),d=n(25),u=i(d),h=n(3),f=i(h),p=n(5),_=i(p),g=o.Collection.extend({model:o.Model.extend({defaults:{visible:!0,target:"_parent"}}),fetch:function(e){e=e||{},this.reset();var n=new c.CommunicationServerView;this.add(n.render()),this.add({id:"analysis",title:(0,f.default)("Analyze Data"),url:"",tooltip:(0,f.default)("Analysis home view")}),this.add({id:"workflow",title:(0,f.default)("Workflow"),tooltip:(0,f.default)("Chain tools into workflows"),disabled:!Galaxy.user.id,url:"workflows/list"}),this.add({id:"visualization",title:(0,f.default)("Visualize"),url:"visualizations/list",tooltip:(0,f.default)("Visualize datasets"),disabled:!Galaxy.user.id,menu:[{title:(0,f.default)("Create Visualization"),url:"visualizations"},{title:(0,f.default)("Interactive Environments"),url:"visualization/gie_list",target:"galaxy_main"},{title:(0,f.default)("Saved Visualizations"),url:"visualizations/list",target:"_frame"}]}),this.add({id:"shared",title:(0,f.default)("Shared Data"),url:"library/index",tooltip:(0,f.default)("Access published resources"),menu:[{title:(0,f.default)("Data Libraries"),url:"library/list"},{title:(0,f.default)("Histories"),url:"histories/list_published"},{title:(0,f.default)("Workflows"),url:"workflows/list_published"},{title:(0,f.default)("Visualizations"),url:"visualizations/list_published"},{title:(0,f.default)("Pages"),url:"pages/list_published"}]}),u.default.load({type:"masthead",callback:function(e){t(document).ready(function(){e.each(function(t){var e=t.toJSON();if(e.activate){var n={id:e.id,icon:e.config.icon,url:e.config.url,tooltip:e.config.tooltip,onclick:e.config.function&&new Function(e.config.function)};Galaxy.page?Galaxy.page.masthead.collection.add(n):Galaxy.masthead&&Galaxy.masthead.collection.add(n),_.default.appendScriptStyle(e)}})})}}),Galaxy.user.get("is_admin")&&this.add({id:"admin",title:(0,f.default)("Admin"),url:"admin",tooltip:(0,f.default)("Administer this Galaxy"),cls:"admin-only"});var i={id:"help",title:(0,f.default)("Help"),tooltip:(0,f.default)("Support, contact, and community"),menu:[{title:(0,f.default)("Support"),url:e.support_url,target:"_blank"},{title:(0,f.default)("Search"),url:e.search_url,target:"_blank"},{title:(0,f.default)("Mailing Lists"),url:e.mailing_lists,target:"_blank"},{title:(0,f.default)("Videos"),url:e.screencasts_url,target:"_blank"},{title:(0,f.default)("Wiki"),url:e.wiki_url,target:"_blank"},{title:(0,f.default)("How to Cite Galaxy"),url:e.citation_url,target:"_blank"},{title:(0,f.default)("Interactive Tours"),url:"tours"}]};e.terms_url&&i.menu.push({title:(0,f.default)("Terms and Conditions"),url:e.terms_url,target:"_blank"}),e.biostar_url&&i.menu.unshift({title:(0,f.default)("Ask a question"),url:"biostar/biostar_question_redirect",target:"_blank"}),e.biostar_url&&i.menu.unshift({title:(0,f.default)("Galaxy Biostar"),url:e.biostar_url_redirect,target:"_blank"}),this.add(i);var r={};return r=Galaxy.user.id?{id:"user",title:(0,f.default)("User"),cls:"loggedin-only",tooltip:(0,f.default)("Account and saved data"),menu:[{title:(0,f.default)("Logged in as")+" "+Galaxy.user.get("email")},{title:(0,f.default)("Preferences"),url:"user"},{title:(0,f.default)("Custom Builds"),url:"custom_builds"},{title:(0,f.default)("Logout"),url:"user/logout?session_csrf_token="+Galaxy.session_csrf_token,target:"_top",divider:!0},{title:(0,f.default)("Saved Datasets"),url:"datasets/list",target:"_top"},{title:(0,f.default)("Saved Histories"),url:"histories/list",target:"_top"},{title:(0,f.default)("Saved Pages"),url:"pages/list",target:"_top"},{title:(0,f.default)("Saved Visualizations"),url:"visualizations/list",target:"_top"}]}:e.allow_user_creation?{id:"user",title:(0,f.default)("Login or Register"),cls:"loggedout-only",tooltip:(0,f.default)("Account registration or login"),menu:[{title:(0,f.default)("Login"),url:"user/login",target:"galaxy_main",noscratchbook:!0},{title:(0,f.default)("Register"),url:"user/create",target:"galaxy_main",noscratchbook:!0}]}:{id:"user",title:(0,f.default)("Login"),cls:"loggedout-only",tooltip:(0,f.default)("Login"),url:"user/login",target:"galaxy_main",noscratchbook:!0},this.add(r),(new t.Deferred).resolve().promise()}}),m=o.View.extend({initialize:function(t){this.model=t.model,this.setElement(this._template()),this.$link=this.$(".nav-link"),this.$note=this.$(".nav-note"),this.$menu=this.$(".dropdown-menu"),this.listenTo(this.model,"change",this.render,this)},events:{"click .nav-link":"_toggleClick"},render:function(){var e=this;return t(".tooltip").remove(),this.$el.removeClass().addClass(this.model.get("disabled")&&"disabled").addClass(this.model.get("active")&&"active").addClass(this.model.get("menu")&&"dropdown").attr("id",this.model.id).css({visibility:this.model.get("visible")&&"visible"||"hidden"}),this.model.set("url",this._formatUrl(this.model.get("url"))),this.$note.html(this.model.get("note")||"").removeClass().addClass("nav-note").addClass(this.model.get("note_cls")).css({display:this.model.get("show_note")&&"block"||"none"}),this.$link.html(this.model.get("title")||"").removeClass().addClass("nav-link").addClass(this.model.get("cls")).addClass(this.model.get("icon")&&"nav-icon fa "+this.model.get("icon")).addClass(this.model.get("menu")&&"dropdown-toggle").addClass(this.model.get("toggle")&&"toggle").attr("target",this.model.get("target")).attr("href",this.model.get("url")).attr("title",this.model.get("tooltip")).tooltip("dispose"),this.model.get("tooltip")&&this.$link.tooltip({placement:"bottom"}),this.model.get("menu")&&this.model.get("show_menu")?(this.$menu.show(),t("#dd-helper").show().off().on("click",function(){t("#dd-helper").hide(),e.model.set("show_menu",!1)})):(this.$menu.hide(),t("#dd-helper").hide()),this.$menu.empty().removeClass(),this.model.get("menu")&&(l.each(this.model.get("menu"),function(n){e.$menu.append(e._buildMenuItem(n)),n.divider&&e.$menu.append(t("<div/>").addClass("dropdown-divider"))}),this.$menu.addClass("dropdown-menu"),this.$link.append(t("<b/>").addClass("caret"))),this},_buildMenuItem:function(e){var n=this;return e=l.defaults(e||{},{title:"",url:"",target:"_parent",noscratchbook:!1}),e.url=this._formatUrl(e.url),t("<a/>").addClass("dropdown-item").attr("href",e.url).attr("target",e.target).html(e.title).on("click",function(t){t.preventDefault(),n.model.set("show_menu",!1),e.onclick?e.onclick():Galaxy.frame.add(e)})},buildLink:function(e,n){return t("<div/>").append(t("<a/>").attr("href",Galaxy.root+n).html(e)).html()},_toggleClick:function(e){var n=this,i=this.model;e.preventDefault(),t(".tooltip").hide(),i.trigger("dispatch",function(t){i.id!==t.id&&t.get("menu")&&t.set("show_menu",!1)}),i.get("disabled")?(this.$link.popover&&this.$link.popover("dispose"),this.$link.popover({html:!0,placement:"bottom",content:"Please "+this.buildLink("login","user/login?use_panels=True")+" or "+this.buildLink("register","user/create?use_panels=True")+" to use this feature."}).popover("show"),window.setTimeout(function(){n.$link.popover("dispose")},3e3)):i.get("menu")?i.set("show_menu",!0):i.get("onclick")?i.get("onclick")():Galaxy.frame.add(i.attributes)},_formatUrl:function(t){return"string"==typeof t&&-1===t.indexOf("//")&&"/"!=t.charAt(0)?Galaxy.root+t:t},_template:function(){return'\n            <li class="nav-item">\n                <a class="nav-link"/>\n                <div class="nav-note"/>\n                <div class="dropdown-menu"/>\n            </li>'}});e.default={Collection:g,Tab:m}}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.CommunicationServerView=void 0;var a=n(9),o=r(a),s=n(1),l=r(s),c=n(3),d=i(c),u=n(17),h=i(u),f=e.CommunicationServerView=o.View.extend({initialize:function(){this.modal=null},makeModalIframe:function(e){var n=window.Galaxy.config.communication_server_host,i=window.Galaxy.config.communication_server_port,r=l.escape(window.Galaxy.user.attributes.username),a=l.escape(window.Galaxy.config.persistent_communication_rooms),o="?username="+r+"&persistent_communication_rooms="+a,s=n+":"+i+o,c=null,d=null,u='<iframe class="f-iframe fade in communication-iframe" src="'+s+'"> </iframe>';return t(".chat-modal").length>0&&t(".chat-modal").remove(),f.modal=new h.default.View({body:u,height:350,width:600,closing_events:!0,title_separator:!1,cls:"ui-modal chat-modal"}),f.modal.show(),c=t(".chat-modal .modal-header"),d=t(".chat-modal .modal-body"),c.addClass("modal-header-body"),d.addClass("modal-header-body"),c.find("h4").remove(),c.removeAttr("min-height padding border"),c.append('<i class="fa fa-comment" aria-hidden="true" title="Communicate with other users"></i><i class="fa fa-expand expand-compress-modal" aria-hidden="true" title="Maximize"></i><i class="fa fa-times close-modal" aria-hidden="true" title="Close"></i>'),t(".close-modal").click(function(e){t(".chat-modal").css("display","none")}),t(".expand-compress-modal").click(function(e){t(".expand-compress-modal").hasClass("fa-expand")?(t(".chat-modal .modal-dialog").width("1000px"),t(".chat-modal .modal-body").height("575px"),t(".expand-compress-modal").removeClass("fa-expand").addClass("fa-compress"),t(".expand-compress-modal").attr("title","Minimize"),t(".expand-compress-modal").css("margin-left","96.2%")):(t(".chat-modal .modal-dialog").width("600px"),t(".chat-modal .modal-body").height("350px"),t(".expand-compress-modal").removeClass("fa-compress").addClass("fa-expand"),t(".expand-compress-modal").attr("title","Maximize"),t(".expand-compress-modal").css("margin-left","93.2%"))}),this},render:function(){var t=this;return{id:"show-chat-online",icon:"fa-comment-o",tooltip:(0,d.default)("Chat online"),visible:!1,onclick:t.makeModalIframe}}})}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=n(9),o=r(a),s=n(1),l=r(s),c=n(77),d=i(c),u=n(14),h=i(u),f=n(15),p=i(f),_=n(61),g=i(_),m=n(3),v=i(m);e.default=o.View.extend({initialize:function(t){var e=this;t=t||{},this.frames=new d.default.View({visible:!1}),this.setElement(this.frames.$el),this.buttonActive=t.collection.add({id:"enable-scratchbook",icon:"fa-th",tooltip:(0,v.default)("Enable/Disable Scratchbook"),onclick:function(){e.active=!e.active,e.buttonActive.set({toggle:e.active,show_note:e.active,note_cls:e.active&&"fa fa-check"}),e.active||e.frames.hide()},onbeforeunload:function(){if(e.frames.length()>0)return"You opened "+e.frames.length()+" frame(s) which will be lost."}}),this.buttonLoad=t.collection.add({id:"show-scratchbook",icon:"fa-eye",tooltip:(0,v.default)("Show/Hide Scratchbook"),show_note:!0,visible:!1,onclick:function(t){e.frames.visible?e.frames.hide():e.frames.show()}}),this.frames.on("add remove",function(){this.visible&&0===this.length()&&this.hide(),e.buttonLoad.set({note:this.length(),visible:this.length()>0})}).on("show hide ",function(){e.buttonLoad.set({toggle:this.visible,icon:this.visible&&"fa-eye"||"fa-eye-slash"})}),this.history_cache={}},addDataset:function(t){var e=this,n=null;if(Galaxy&&Galaxy.currHistoryPanel){var i=Galaxy.currHistoryPanel.collection.historyId;this.history_cache[i]={name:Galaxy.currHistoryPanel.model.get("name"),dataset_ids:[]},Galaxy.currHistoryPanel.collection.each(function(t){!t.get("deleted")&&t.get("visible")&&e.history_cache[i].dataset_ids.push(t.get("id"))})}var r=function(t,n){if(t){var i=e.history_cache[t.get("history_id")];if(i&&i.dataset_ids){var r=i.dataset_ids,a=r.indexOf(t.get("id"));if(-1!==a&&a+n>=0&&a+n<r.length)return r[a+n]}}},a=function(t,i,a){var o=r(t,i);o?e._loadDataset(o,function(t,e){n=t,a.model.set(e)}):a.model.trigger("change")};this._loadDataset(t,function(t,i){n=t,e.add(l.extend({menu:[{icon:"fa fa-chevron-circle-left",tooltip:(0,v.default)("Previous in History"),onclick:function(t){a(n,-1,t)},disabled:function(){return!r(n,-1)}},{icon:"fa fa-chevron-circle-right",tooltip:(0,v.default)("Next in History"),onclick:function(t){a(n,1,t)},disabled:function(){return!r(n,1)}}]},i))})},_loadDataset:function(e,n){var i=this,r=new h.default.Dataset({id:e});t.when(r.fetch()).then(function(){var t=l.find(["tabular","interval"],function(t){return-1!==r.get("data_type").indexOf(t)}),a=r.get("name"),o=i.history_cache[r.get("history_id")];o&&(a=o.name+": "+a),n(r,t?{title:a,url:null,content:h.default.createTabularDatasetChunkedView({model:new h.default.TabularDataset(r.toJSON()),embedded:!0,height:"100%"}).$el}:{title:a,url:Galaxy.root+"datasets/"+e+"/display/?preview=True",content:null})})},addTrackster:function(e){var n=this,i=new p.default.Visualization({id:e});t.when(i.fetch()).then(function(){var t=new g.default.TracksterUI(Galaxy.root),e={title:i.get("name"),type:"other",content:function(e){var n={container:e,name:i.get("title"),id:i.id,dbkey:i.get("dbkey"),stand_alone:!1},r=i.get("latest_revision"),a=r.config.view.drawables;l.each(a,function(t){t.dataset={hda_ldda:t.hda_ldda,id:t.dataset_id}}),t.create_visualization(n,r.config.viewport,r.config.view.drawables,r.config.bookmarks,!1)}};n.add(e)})},add:function(e){if("_blank"==e.target)window.open(e.url);else if("_top"==e.target||"_parent"==e.target||"_self"==e.target)window.location=e.url;else if(!this.active||e.noscratchbook){var n=t(window.parent.document).find("#galaxy_main");"galaxy_main"==e.target||"center"==e.target?0===n.length?window.location=this._build_url(e.url,{use_panels:!0}):n.attr("src",e.url):window.location=e.url}else e.url=this._build_url(e.url,{hide_panels:!0,hide_masthead:!0}),this.frames.add(e)},_build_url:function(e,n){if(e)return e+=-1==e.indexOf("?")?"?":"&",e+=t.param(n,!0)}})}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=n(9),s=i(o),l=n(1),c=i(l),d=s.View.extend({initialize:function(e){this.model=e&&e.model||new s.Model(e),this.setElement(t("<div/>").addClass("corner frame")),this.$el.append(t("<div/>").addClass("f-header corner").append(t("<div/>").addClass("f-title")).append(t("<div/>").addClass("f-icon f-close fa fa-close").tooltip({title:(0,a.default)("Close"),placement:"bottom"}))).append(t("<div/>").addClass("f-content")).append(t("<div/>").addClass("f-resize f-icon corner fa fa-expand").tooltip({title:"Resize"})).append(t("<div/>").addClass("f-cover")),this.$header=this.$(".f-header"),this.$title=this.$(".f-title"),this.$content=this.$(".f-content"),this.render(),this.listenTo(this.model,"change",this.render,this)},render:function(){var e=this,n=this.model.attributes;this.$title.html(n.title||""),this.$header.find(".f-icon-left").remove(),c.each(n.menu,function(n){var i=t("<div/>").addClass("f-icon-left").addClass(n.icon);c.isFunction(n.disabled)&&n.disabled()?i.attr("disabled",!0):i.on("click",function(){n.onclick(e)}).tooltip({title:n.tooltip||"",placement:"bottom"}),e.$header.append(i)}),n.url?this.$content.html(t("<iframe/>").addClass("f-iframe").attr("scrolling","auto").attr("src",n.url+(-1===n.url.indexOf("?")?"?":"&")+"widget=True")):n.content&&(c.isFunction(n.content)?n.content(e.$content):e.$content.html(n.content))}}),u=s.View.extend({defaultOptions:{frame:{cols:6,rows:3},rows:1e3,cell:130,margin:5,scroll:5,top_min:40,frame_max:9,visible:!0},cols:0,top:0,top_max:0,frame_z:0,frame_counter:0,frame_uid:0,frame_list:{},frame_shadow:null,visible:!1,event:{},initialize:function(e){var n=this;this.options=c.defaults(e||{},this.defaultOptions),this.visible=this.options.visible,this.top=this.top_max=this.options.top_min,this.setElement(t("<div/>").addClass("galaxy-frame").append(t("<div/>").addClass("frame-background")).append(t("<div/>").addClass("frame-menu frame-scroll-up fa fa-chevron-up fa-2x")).append(t("<div/>").addClass("frame-menu frame-scroll-down fa fa-chevron-down fa-2x"))),this.frame_shadow=new s.View({el:t("<div/>").addClass("corner frame-shadow")}),this.$el.append(this.frame_shadow.$el),this._frameInit(this.frame_shadow,"#frame-shadow"),this._frameResize(this.frame_shadow,{width:0,height:0}),this.frame_list["#frame-shadow"]=this.frame_shadow,this.visible?this.show():this.hide(),this._panelRefresh(),t(window).resize(function(){n.visible&&n._panelRefresh()})},render:function(){this.$(".frame-scroll-up")[this.top!=this.options.top_min&&"show"||"hide"](),this.$(".frame-scroll-down")[this.top!=this.top_max&&"show"||"hide"]()},add:function(e){if(this.frame_counter>=this.options.frame_max)Galaxy.modal.show({title:(0,a.default)("Warning"),body:"You have reached the maximum number of allowed frames ("+this.options.frame_max+").",buttons:{Close:function(){Galaxy.modal.hide()}}});else{var n="#frame-"+this.frame_uid++;if(0!==t(n).length)Galaxy.modal.show({title:(0,a.default)("Error"),body:"This frame already exists. This page might contain multiple frame managers.",buttons:{Close:function(){Galaxy.modal.hide()}}});else{this.top=this.options.top_min;var i=new d(e);this.$el.append(i.$el),e.width=this._toPixelCoord("width",this.options.frame.cols),e.height=this._toPixelCoord("height",this.options.frame.rows),this.frame_z=parseInt(i.$el.css("z-index")),this.frame_list[n]=i,this.frame_counter++,this._frameInit(i,n),this._frameResize(i,{width:e.width,height:e.height}),this._frameInsert(i,{top:0,left:0},!0),this.visible||this.show(),this.trigger("add")}}},del:function(t){var e=this,n=t.$el;n.fadeOut("fast",function(){n.remove(),delete e.frame_list[t.id],e.frame_counter--,e._panelRefresh(!0),e._panelAnimationComplete(),e.trigger("remove")})},show:function(){this.visible=!0,this.$el.fadeIn("fast"),this.trigger("show")},hide:function(){this.event.type||(this.visible=!1,this.$el.fadeOut("fast",function(){t(this).hide()}),this.trigger("hide"))},length:function(){return this.frame_counter},events:{mousemove:"_eventFrameMouseMove",mouseup:"_eventFrameMouseUp",mouseleave:"_eventFrameMouseUp",mousewheel:"_eventPanelScroll",DOMMouseScroll:"_eventPanelScroll","mousedown .frame":"_eventFrameMouseDown","mousedown .frame-background":"_eventHide","mousedown .frame-scroll-up":"_eventPanelScroll_up","mousedown .frame-scroll-down":"_eventPanelScroll_down","mousedown .f-close":"_eventFrameClose"},_eventFrameMouseDown:function(e){t(".tooltip").hide(),this.event.type||((t(e.target).hasClass("f-header")||t(e.target).hasClass("f-title"))&&(this.event.type="drag"),t(e.target).hasClass("f-resize")&&(this.event.type="resize"),this.event.type&&(e.preventDefault(),this.event.target=this._frameIdentify(e.target),this.event.xy={x:e.originalEvent.pageX,y:e.originalEvent.pageY},this._frameDragStart(this.event.target)))},_eventFrameMouseMove:function(t){if(this.event.type){var e={x:t.originalEvent.pageX,y:t.originalEvent.pageY},n={x:e.x-this.event.xy.x,y:e.y-this.event.xy.y};this.event.xy=e;var i=this._frameScreen(this.event.target);if("resize"==this.event.type){i.width+=n.x,i.height+=n.y;var r=this.options.cell-this.options.margin-1;i.width=Math.max(i.width,r),i.height=Math.max(i.height,r),this._frameResize(this.event.target,i),i.width=this._toGridCoord("width",i.width)+1,i.height=this._toGridCoord("height",i.height)+1,i.width=this._toPixelCoord("width",i.width),i.height=this._toPixelCoord("height",i.height),this._frameResize(this.frame_shadow,i),this._frameInsert(this.frame_shadow,{top:this._toGridCoord("top",i.top),left:this._toGridCoord("left",i.left)})}else if("drag"==this.event.type){i.left+=n.x,i.top+=n.y,this._frameOffset(this.event.target,i);var a={top:this._toGridCoord("top",i.top),left:this._toGridCoord("left",i.left)};0!==a.left&&a.left++,this._frameInsert(this.frame_shadow,a)}}},_eventFrameMouseUp:function(t){this.event.type&&(this._frameDragStop(this.event.target),this.event.type=null)},_eventFrameClose:function(t){this.event.type||(t.preventDefault(),this.del(this._frameIdentify(t.target)))},_eventHide:function(t){this.event.type||this.hide()},_eventPanelScroll:function(e){if(!this.event.type&&this.visible){0!==t(e.srcElement).parents(".frame").length?e.stopPropagation():(e.preventDefault(),this._panelScroll(e.originalEvent.detail?e.originalEvent.detail:e.originalEvent.wheelDelta/-3))}},_eventPanelScroll_up:function(t){this.event.type||(t.preventDefault(),this._panelScroll(-this.options.scroll))},_eventPanelScroll_down:function(t){this.event.type||(t.preventDefault(),this._panelScroll(this.options.scroll))},_frameIdentify:function(e){return this.frame_list["#"+t(e).closest(".frame").attr("id")]},_frameDragStart:function(e){this._frameFocus(e,!0);var n=this._frameScreen(e);this._frameResize(this.frame_shadow,n),this._frameGrid(this.frame_shadow,e.grid_location),e.grid_location=null,this.frame_shadow.$el.show(),t(".f-cover").show()},_frameDragStop:function(e){this._frameFocus(e,!1);var n=this._frameScreen(this.frame_shadow);this._frameResize(e,n),this._frameGrid(e,this.frame_shadow.grid_location,!0),this.frame_shadow.grid_location=null,this.frame_shadow.$el.hide(),t(".f-cover").hide(),this._panelAnimationComplete()},_toGridCoord:function(t,e){var n="width"==t||"height"==t?1:-1;return"top"==t&&(e-=this.top),parseInt((e+n*this.options.margin)/this.options.cell,10)},_toPixelCoord:function(t,e){var n="width"==t||"height"==t?1:-1,i=e*this.options.cell-n*this.options.margin;return"top"==t&&(i+=this.top),i},_toGrid:function(t){return{top:this._toGridCoord("top",t.top),left:this._toGridCoord("left",t.left),width:this._toGridCoord("width",t.width),height:this._toGridCoord("height",t.height)}},_toPixel:function(t){return{top:this._toPixelCoord("top",t.top),left:this._toPixelCoord("left",t.left),width:this._toPixelCoord("width",t.width),height:this._toPixelCoord("height",t.height)}},_isCollision:function(t){for(var e in this.frame_list){var n=this.frame_list[e];if(null!==n.grid_location&&function(t,e){return!(t.left>e.left+e.width-1||t.left+t.width-1<e.left||t.top>e.top+e.height-1||t.top+t.height-1<e.top)}(t,n.grid_location))return!0}return!1},_locationRank:function(t){return t.top*this.cols+t.left},_panelRefresh:function(e){this.cols=parseInt(t(window).width()/this.options.cell,10)+1,this._frameInsert(null,null,e)},_panelAnimationComplete:function(){var e=this;t(".frame").promise().done(function(){e._panelScroll(0,!0)})},_panelScroll:function(t,e){var n=this.top-this.options.scroll*t;if(n=Math.max(n,this.top_max),n=Math.min(n,this.options.top_min),this.top!=n){for(var i in this.frame_list){var r=this.frame_list[i];if(null!==r.grid_location){var a={top:r.screen_location.top-(this.top-n),left:r.screen_location.left};this._frameOffset(r,a,e)}}this.top=n}this.render()},_frameInit:function(t,e){t.id=e,t.screen_location={},t.grid_location={},t.grid_rank=null,t.$el.attr("id",e.substring(1))},_frameInsert:function(e,n,i){var r=this,a=[];e&&(e.grid_location=null,a.push([e,this._locationRank(n)])),c.each(this.frame_list,function(t){null!==t.grid_location&&(t.grid_location=null,a.push([t,t.grid_rank]))}),a.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),c.each(a,function(t){r._framePlace(t[0],i)}),this.top_max=0,c.each(this.frame_list,function(t){null!==t.grid_location&&(r.top_max=Math.max(r.top_max,t.grid_location.top+t.grid_location.height))}),this.top_max=t(window).height()-this.top_max*this.options.cell-2*this.options.margin,this.top_max=Math.min(this.top_max,this.options.top_min),this.render()},_framePlace:function(t,e){t.grid_location=null;for(var n=this._toGrid(this._frameScreen(t)),i=!1,r=0;r<this.options.rows;r++){for(var a=0;a<Math.max(1,this.cols-n.width);a++)if(n.top=r,n.left=a,!this._isCollision(n)){i=!0;break}if(i)break}i?this._frameGrid(t,n,e):console.log("Grid dimensions exceeded.")},_frameFocus:function(t,e){t.$el.css("z-index",this.frame_z+(e?1:0))},_frameOffset:function(t,e,n){if(t.screen_location.left=e.left,t.screen_location.top=e.top,n){this._frameFocus(t,!0);var i=this;t.$el.animate({top:e.top,left:e.left},"fast",function(){i._frameFocus(t,!1)})}else t.$el.css({top:e.top,left:e.left})},_frameResize:function(t,e){t.$el.css({width:e.width,height:e.height}),t.screen_location.width=e.width,t.screen_location.height=e.height},_frameGrid:function(t,e,n){t.grid_location=e,this._frameOffset(t,this._toPixel(e),n),t.grid_rank=this._locationRank(e)},_frameScreen:function(t){var e=t.screen_location;return{top:e.top,left:e.left,width:e.width,height:e.height}}});e.default={View:u}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.Model.extend({defaults:{url_base:"",title_id:void 0,async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},add_filter:function(t,e,n){if(n){var i,r=this.attributes.filters[t];if(null===r||void 0===r)i=e;else if("string"==typeof r)if("All"==r||r==e)i=e;else{var a=[];a[0]=r,a[1]=e,i=a}else i=r,-1===i.indexOf(e)&&i.push(e);this.attributes.filters[t]=i}else this.attributes.filters[t]=e},remove_filter:function(t,e){var i=this.attributes.filters[t];if(null===i||void 0===i)return!1;if("string"==typeof i)this.attributes.filters[t]="";else{var r=n.indexOf(i,e);-1!==r&&(i[r]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);var e=this;return n.each(n.pairs(e.attributes.filters),function(e){t["f-"+e[0]]=e[1]}),t},get_url:function(t){return this.get("url_base")+"?"+i.param(this.get_url_data())+"&"+i.param(t)}})}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a);e.default={grid:function(t){var e=void 0;return e=t.embedded?this.grid_header(t)+this.grid_table(t):'\n                <div class="loading-elt-overlay"></div>\n                <table class="grid-table">\n                    <tr>\n                        <td width="75%">'+this.grid_header(t)+'</td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td width="100%" id="grid-message" valign="top"></td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                </table>\n                '+this.grid_table(t)+"\n            ",t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'+t.info_text+"</div>"),e},grid_table:function(){return'\n            <form method="post" onsubmit="return false;">\n                <table id="grid-table" class="grid">\n                    <thead id="grid-table-header"></thead>\n                    <tbody id="grid-table-body"></tbody>\n                    <tfoot id="grid-table-footer"></tfoot>\n                </table>\n            </form>'},grid_header:function(t){var e='<div class="grid-header">';if(!t.embedded){var n="";t.title_id&&(n+=' id="'+t.title_id+'"'),e+="<h2"+n+">"+t.title+"</h2>"}if(t.global_actions){e+='<ul class="manage-table-actions">';var i=t.global_actions.length>=3;i&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');var r=!0,a=!1,o=void 0;try{for(var s,l=t.global_actions[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;e+='<li><a class="action-button use-target" target="'+c.target+'" href="'+c.url_args+'" onclick="return false;" >'+c.label+"</a></li>"}}catch(t){a=!0,o=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}i&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");var n=!0,i=!1,r=void 0;try{for(var a,o=t.columns[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.visible&&(e+='<th id="'+s.key+'-header">',s.sortable?e+='<a href="javascript:void(0)" class="sort-link" sort_key="'+s.key+'">'+s.label+"</a>":e+=s.label,e+='<span class="sort-arrow">'+s.extra+"</span></th>")}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return e+="</tr>"},body:function(e){var n="";0===e.items.length&&(n+='<tr><td colspan="100"><em>No Items</em></td></tr>');var i=!0,r=!1,a=void 0;try{for(var o,s=e.items[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;n+="<tr ",e.current_item_id==l.id&&(n+='class="current"'),n+=">",e.show_item_checkboxes&&(n+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+l.encode_id+'" id="'+l.encode_id+'" class="grid-row-select-checkbox" /></td>');var c=!0,d=!1,u=void 0;try{for(var h,f=e.columns[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;if(p.visible){var _="";p.nowrap&&(_='style="white-space:nowrap;"');var g=l.column_config[p.label],m=g.link,v=g.value,y=g.target;"string"===t.type(v)&&(v=v.replace(/\/\//g,"/"));var b="";p.attach_popup&&(b="grid-"+l.encode_id+"-popup"),n+="<td "+_+">",p.delayed?n+='<div class="delayed-value-'+p.key+'" data-id="'+l.encode_id+'" data-value="'+v+'"><span class="fa fa-spinner fa-spin"></span></div>':p.attach_popup&&m?n+='<div class="btn-group">\n                                    <button class="btn btn-secondary use-target" target="'+y+'" href="'+m+'" onclick="return false;">'+v+'</button>\n                                    <button id="'+b+'" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"/>\n                                </div>':p.attach_popup?n+='<button id="'+b+'" class="btn dropdown-toggle" data-toggle="dropdown">'+v+"</button>":n+=m?'<a class="use-target" target="'+y+'" href="'+m+'" onclick="return false;">'+v+"</a>":"<label>"+(v||"")+"</label>",n+="</td>"}}}catch(t){d=!0,u=t}finally{try{!c&&f.return&&f.return()}finally{if(d)throw u}}n+="</tr>"}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var n=t.num_page_links,i=t.cur_page_num,r=t.num_pages,a=n/2,o=i-a,s=0;o<=0&&(o=1,s=a-(i-o));var l,c=a+s,d=i+c;d<=r?l=0:(d=r,l=c-(d+1-i)),0!==l&&(o-=l)<1&&(o=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(e+='<span class="page-link-grid" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var u=o;u<d+1;u++)u==t.cur_page_num?e+='<span class="page-link-grid inactive-link" id="page-link-'+u+'">'+u+"</span>":e+='<span class="page-link-grid" id="page-link-'+u+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+u+'">'+u+"</a></span>";d<r&&(e+='...<span class="page-link-grid" id="page-link-'+r+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+r+'">'+r+"</a></span>"),e+="</span>",e+='\n                    <span class="page-link-grid" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span>\n                    </td>\n                </tr>'}if(t.show_item_checkboxes){e+='\n                <tr>\n                    <input type="hidden" id="operation" name="operation" value="">\n                    <td></td>\n                    <td colspan="100">\n                        For <span class="grid-selected-count"></span> selected items: \n            ';var h=!0,f=!1,p=void 0;try{for(var _,g=t.operations[Symbol.iterator]();!(h=(_=g.next()).done);h=!0){var m=_.value;m.allow_multiple&&(e+='<input type="button" value="'+m.label+'" class="operation-button action-button">&nbsp;')}}catch(t){f=!0,p=t}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}e+="</td></tr>"}var v=!1,y=!0,b=!1,w=void 0;try{for(var x,k=t.operations[Symbol.iterator]();!(y=(x=k.next()).done);y=!0){if(x.value.global_operation){v=!0;break}}}catch(t){b=!0,w=t}finally{try{!y&&k.return&&k.return()}finally{if(b)throw w}}if(v){e+='<tr><td colspan="100">';var M=!0,C=!1,S=void 0;try{for(var T,A=t.operations[Symbol.iterator]();!(M=(T=A.next()).done);M=!0){var j=T.value;j.global_operation&&(e+='<a class="action-button" href="'+j.global_operation+'">'+j.label+"</a>")}}catch(t){C=!0,S=t}finally{try{!M&&A.return&&A.return()}finally{if(C)throw S}}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'+t.legend+"</td></tr>"),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'+e+'message transient-message">'+o.escape(t.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(t){var e=t.default_filter_dict,n=t.filters,i="none";t.advanced_search&&(i="block");var r=!1,a=!0,o=!1,s=void 0;try{for(var l,c=t.columns[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;if("advanced"==d.filterable){var u=d.key,h=n[u],f=e[u];h&&f&&h!=f&&(i="block"),r=!0}}}catch(t){o=!0,s=t}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}var p="block";"block"==i&&(p="none");var _='<div id="standard-search" style="display: '+p+';"><table><tr><td style="padding: 0;"><table>',g=!0,m=!1,v=void 0;try{for(var y,b=t.columns[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var w=y.value;"standard"==w.filterable&&(_+=this.grid_column_filter(t,w))}}catch(t){m=!0,v=t}finally{try{!g&&b.return&&b.return()}finally{if(m)throw v}}_+="</table></td></tr><tr><td>",r&&(_+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),_+="</td></tr></table></div>",_+='<div id="advanced-search" style="display: '+i+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';var x=!0,k=!1,M=void 0;try{for(var C,S=t.columns[Symbol.iterator]();!(x=(C=S.next()).done);x=!0){var T=C.value;"advanced"==T.filterable&&(_+=this.grid_column_filter(t,T))}}catch(t){k=!0,M=t}finally{try{!x&&S.return&&S.return()}finally{if(k)throw M}}return _+="</table></div>"},grid_column_filter:function(e,n){var i=e.filters,r=n.label,a=n.key;"advanced"==n.filterable&&(r=r.toLowerCase());var o="<tr>";if("advanced"==n.filterable&&(o+='<td align="left" style="padding-left: 10px">'+r+":</td>"),o+='<td style="padding-bottom: 1px;">',n.is_text){o+='<form class="text-filter-form" column_key="'+a+'" action="'+e.url+'" method="get" >';var s=!0,l=!1,c=void 0;try{for(var d,u=e.columns[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value,f=i[h.key];f&&"All"!=f&&(h.is_text&&(f=JSON.stringify(f)),o+='<input type="hidden" id="'+h.key+'" name="f-'+h.key+'" value="'+f+'"/>')}}catch(t){l=!0,c=t}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}o+='<span id="'+a+'-filtering-criteria">';var p=i[a];if(p){var _=t.type(p);if("string"==_&&"All"!=p&&(o+=this.filter_element(a,p)),"array"==_)for(var g in p){var m=p;m=m.slice(g),o+=this.filter_element(a,p[g])}}o+="</span>";var v="",y=20;"standard"==n.filterable&&(v=n.label.toLowerCase(),v.length<20&&(y=v.length),y+=4),o+='\n                <span class="search-box">\n                    <input class="search-box-input" id="input-'+a+'-filter" name="f-'+a+'" type="text" placeholder="'+v+'" size="'+y+'"/>\n                    <button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;">\n                        <i class="fa fa-search"></i>\n                    </button>\n                </span>\n            </form>'}else{o+='<span id="'+a+'-filtering-criteria">';var b=!1;for(var w in e.categorical_filters[a]){var x=e.categorical_filters[a][w],k="",M="";for(var C in x)k=C,M=x[C];b&&(o+=" | "),b=!0;var S=i[a];S&&x[a]&&S==M?o+='<span class="categorical-filter '+a+'-filter current-filter">'+w+"</span>":o+='<span class="categorical-filter '+a+'-filter"><a href="javascript:void(0);" filter_key="'+k+'" filter_val="'+M+'">'+w+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(t,e){return'<span class="text-filter-val">'+(e=r.default.sanitize(e))+'<a href="javascript:void(0);" filter_key="'+t+'" filter_val="'+e+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(e,n(0))},,function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(r),o=t.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(i("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(i("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(t){t.stopPropagation()}),this.$el.append(i("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var t=this;this.icons_div=i("<div/>").addClass("track-icons").hide().appendTo(this.$el),a.each(this.model.action_icons_def,function(e){t.add_action_icon(e.name,e.title,e.css_class,e.on_click_fn,e.prepend,e.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(t,e,n,r,a,o){var s=this;this.action_icons[t]=i("<a/>").attr("title",e).addClass("icon-button").addClass(n).tooltip().click(function(){r(s.model)}).appendTo(this.icons_div),o&&this.action_icons[t].hide()},set_display_modes:function(t,e){if(t){this.model.display_modes=t,this.model.mode=e||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: "+this.mode+")");for(var n=this.model,i={},r=0,a=n.display_modes.length;r<a;r++){var o=n.display_modes[r];i[o]=function(t){return function(){n.change_mode(t)}}(o)}make_popupmenu(this.action_icons.mode_icon,i)}}});e.default={TrackHeaderView:o}}).call(e,n(2),n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=r.extend,o=function(t,e){this.slot=t,this.feature=e},s=function(t,e,n,i){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=n,this.measureText=i};a(s.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),n=Math.ceil(t[2]*this.w_scale),i=t[3];if(void 0!==i&&this.include_label){var r=this.measureText(i).width+7;e-r>=0?e-=r:n+=r}return[e,n]},_find_slot:function(t){for(var e=t[0],n=t[1],i=0;i<=this.max_rows;i++){var r=!1,a=this.start_end_dct[i];if(void 0!==a)for(var o=0,s=a.length;o<s;o++){var l=a[o];if(n>l[0]&&e<l[1]){r=!0;break}}if(!r)return i}return-1},slot_features:function(t){for(var e,n,i=this.start_end_dct,r=[],a=0,s=0,l=t.length;s<l;s++){e=t[s],n=e[0];var c=this.slots[n];if(c){if(e[1]<c.feature[1]||c.feature[2]<e[2])for(var d=this._get_draw_coords(c.feature),u=this._get_draw_coords(e),h=this.start_end_dct[c.slot],f=0;f<h.length;f++){var p=h[f];p[0]===d[0]&&p[1]===d[1]&&(h[f]=u)}a=Math.max(a,this.slots[n].slot)}else r.push(s)}for(var _=0,g=r.length;_<g;_++){e=t[r[_]],n=e[0];var m=this._get_draw_coords(e),v=this._find_slot(m);v>=0&&(void 0===i[v]&&(i[v]=[]),i[v].push(m),this.slots[n]=new o(v,e),a=Math.max(a,v))}return a+1}}),e.default={FeatureSlotter:s}},function(t,e,n){"use strict";function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var n=t[0],i=t[1],r=e[0],a=e[1];return n<r?i<=r?f:i<=a?_:p:n>a?v:i<=a?m:g}function s(t,e){var n=o(t,e);return n!==f&&n!==v}function l(t,e,n,i,r,a){void 0===a&&(a=4);var o,s=i-e,l=r-n,c=Math.floor(Math.sqrt(s*s+l*l)/a),d=s/c,u=l/c;for(o=0;o<c;o++,e+=d,n+=u)o%2==0&&t.fillRect(e,n,a,1)}function c(t,e,n,i){var r=e-i/2,a=e+i/2,o=n-Math.sqrt(3*i/2);t.beginPath(),t.moveTo(r,o),t.lineTo(a,o),t.lineTo(e,n),t.lineTo(r,o),t.strokeStyle=this.fillStyle,t.fill(),t.stroke(),t.closePath()}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(1),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(u),f=1001,p=1002,_=1003,g=1004,m=1005,v=1006,y=function(){function t(e){a(this,t),this.default_val=e||1}return d(t,[{key:"gen_val",value:function(t){return this.default_val}}]),t}(),b=function t(e){a(this,t),this.incomplete_features=e.incomplete_features,this.feature_mapper=e.feature_mapper},w=function(){function t(e,n,i,r,o){a(this,t),this.data=e,this.default_prefs={},this.view_start=n,this.view_end=i,this.prefs=h.extend({},this.default_prefs,r),this.mode=o}return d(t,[{key:"draw",value:function(t,e,n,i){}},{key:"get_start_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,-.5)}},{key:"get_end_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,.5)}},{key:"get_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,0)}},{key:"_chrom_pos_to_draw_pos",value:function(t,e,n){return Math.floor(e*(Math.max(0,t-this.view_start)+n))}}],[{key:"default_prefs",get:function(){return{}}}]),t}(),x=function(t){function e(t,n,r,o,s){return a(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s))}return r(e,t),d(e,[{key:"draw",value:function(t,e,n,i){var r=!1,a=this.prefs.min_value,o=this.prefs.max_value,s=o-a,l=n,c=this.view_start,d=this.mode,u=this.data;t.save();var f=Math.round(n+a/s*n);"Intensity"!==d&&(t.fillStyle="#aaa",t.fillRect(0,f,e,1)),t.beginPath();var p,_,g;g=u.length>1?h.map(u.slice(0,-1),function(t,e){return Math.ceil((u[e+1][0]-u[e][0])*i)}):[10];for(var m,v=this.prefs.block_color||this.prefs.color,y=parseInt(v.slice(1),16),b=(16711680&y)>>16,w=(65280&y)>>8,x=255&y,k=!1,M=!1,C=0,S=u.length;C<S;C++)if(t.fillStyle=t.strokeStyle=v,k=M=!1,m=g[C],p=Math.floor((u[C][0]-c-.5)*i),null!==(_=u[C][1])){if(_<a?(M=!0,_=a):_>o&&(k=!0,_=o),"Histogram"===d)_=Math.round(_/s*l),t.fillRect(p,f,m,-_);else if("Intensity"===d){var T=(_-a)/s,A=Math.round(b+(255-b)*(1-T)),j=Math.round(w+(255-w)*(1-T)),E=Math.round(x+(255-x)*(1-T));t.fillStyle="rgb("+A+","+j+","+E+")",t.fillRect(p,0,m,l)}else _=Math.round(l-(_-a)/s*l),r?t.lineTo(p,_):(r=!0,"Filled"===d?(t.moveTo(p,l),t.lineTo(p,_)):t.moveTo(p,_));if(t.fillStyle=this.prefs.overflow_color,k||M){var O;"Histogram"===d||"Intensity"===d?O=m:(p-=2,O=4),k&&t.fillRect(p,0,O,3),M&&t.fillRect(p,l-3,O,3)}t.fillStyle=v}else r&&"Filled"===d&&t.lineTo(p,l),r=!1;"Filled"===d?(r&&(t.lineTo(p,f),t.lineTo(0,f)),t.fill()):t.stroke(),t.restore()}}],[{key:"default_prefs",get:function(){return{min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"}}}]),e}(w),k=function(){function t(e){a(this,t),this.feature_positions={},this.slot_height=e,this.translation=0,this.y_translation=0}return d(t,[{key:"map_feature_data",value:function(t,e,n,i){this.feature_positions[e]||(this.feature_positions[e]=[]),this.feature_positions[e].push({data:t,x_start:n,x_end:i})}},{key:"get_feature_data",value:function(t,e){var n,i=Math.floor((e-this.y_translation)/this.slot_height);if(!this.feature_positions[i])return null;t+=this.translation;for(var r=0;r<this.feature_positions[i].length;r++)if(n=this.feature_positions[i][r],t>=n.x_start&&t<=n.x_end)return n.data}}]),t}(),M=function(t){function e(t,n,r,o,s,l,c){a(this,e);var d=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s));return d.alpha_scaler=l||new y,d.height_scaler=c||new y,d.max_label_length=200,d}return r(e,t),d(e,[{key:"get_required_height",value:function(t,e){var n=this.get_row_height(),i=n,r=this.mode;return"no_detail"!==r&&"Squish"!==r&&"Pack"!==r||(n=t*i),n+this.get_top_padding(e)}},{key:"get_top_padding",value:function(t){return 0}},{key:"draw",value:function(t,e,n,i,r){t.save(),t.fillStyle=this.prefs.block_color,t.textAlign="right";for(var a,o=this.get_row_height(),s=new k(o),l=[],c=0,d=this.data.length;c<d;c++){var u=this.data[c],h=u[0],f=u[1],p=u[2],_=r&&void 0!==r[h]?r[h].slot:null;("Dense"===this.mode||null!==_)&&f<this.view_end&&p>this.view_start&&(a=this.draw_element(t,this.mode,u,_,this.view_start,this.view_end,i,o,e),s.map_feature_data(u,_,a[0],a[1]),(f<this.view_start||p>this.view_end)&&l.push(u))}return t.restore(),s.y_translation=this.get_top_padding(e),new b({incomplete_features:l,feature_mapper:s})}},{key:"draw_element",value:function(t,e,n,i,r,a,o,s,l){return[0,0]}}],[{key:"default_prefs",get:function(){return{block_color:"#FFF",connector_color:"#FFF"}}}]),e}(w),C=function(t){function e(t,n,r,o,s,l,c){a(this,e);var d=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s,l,c));return d.draw_background_connector=!0,d.draw_individual_connectors=!1,d}return r(e,t),d(e,[{key:"get_row_height",value:function(){var t=this.mode;return"Dense"===t?10:"no_detail"===t?3:"Squish"===t?5:10}},{key:"draw_element",value:function(t,e,n,i,r,a,o,s,l){var c=n[1],d=n[2],u=n[3],h=n[4],f=Math.floor(Math.max(0,(c-r-.5)*o)),p=Math.ceil(Math.min(l,Math.max(0,(d-r-.5)*o))),_=f,g=p,m=("Dense"===e?0:0+i)*s+this.get_top_padding(l),v=null,y=null,b=h&&"+"!==h&&"."!==h?this.prefs.reverse_strand_color:this.prefs.block_color,w=this.prefs.label_color;if(t.globalAlpha=this.alpha_scaler.gen_val(n),"Dense"===e&&(i=1),"no_detail"===e)t.fillStyle=b,t.fillRect(f,m+5,p-f,1);else{var x=n[5],k=n[6],M=n[7],C=!0;x&&k&&(v=Math.floor(Math.max(0,(x-r)*o)),y=Math.ceil(Math.min(l,Math.max(0,(k-r)*o))));var S,T;if("Squish"===e?(S=1,T=3,C=!1):(S=5,T=9),M){var A,j;"Squish"===e||"Dense"===e?(A=m+Math.floor(1.5)+1,j=1):h?(A=m,j=T):(A+=2.5,j=1),this.draw_background_connector&&("Squish"===e||"Dense"===e?t.fillStyle="#ccc":h?"+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand")):t.fillStyle="#ccc",t.fillRect(f,A,p-f,j));for(var E=0,O=M.length;E<O;E++){var L,N,I=M[E],P=Math.floor(Math.max(0,(I[0]-r-.5)*o)),D=Math.ceil(Math.min(l,Math.max((I[1]-r-.5)*o)));if(!(P>D)){if(t.fillStyle=b,t.fillRect(P,m+(T-S)/2+1,D-P,S),void 0!==v&&k>x&&!(P>y||D<v)){var R=Math.max(P,v),z=Math.min(D,y);t.fillRect(R,m+1,z-R,T),1===M.length&&"Pack"===e&&("+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),R+14<z&&(R+=2,z-=2),t.fillRect(R,m+1,z-R,T))}this.draw_individual_connectors&&L&&this.draw_connector(t,L,N,P,D,m),L=P,N=D}}if("Pack"===e){t.globalAlpha=1,t.fillStyle="white";var $=this.height_scaler.gen_val(n),W=Math.ceil(T*$),G=Math.round((T-W)/2);1!==$&&(t.fillRect(f,A+1,p-f,G),t.fillRect(f,A+T-G+1,p-f,G))}}else t.fillStyle=b,t.fillRect(f,m+1,p-f,T),h&&C&&("+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),t.fillRect(f,m+1,p-f,T));t.globalAlpha=1,u&&"Pack"===e&&c>r&&(t.fillStyle=w,0===r&&f-t.measureText(u).width<0?(t.textAlign="left",t.fillText(u,p+2,m+8,this.max_label_length),g+=t.measureText(u).width+2):(t.textAlign="right",t.fillText(u,f-2,m+8,this.max_label_length),_-=t.measureText(u).width+2))}return t.globalAlpha=1,[_,g]}}]),e}(M),S=function(t){function e(t,n,r,o,s,l,c,d,u){a(this,e);var h=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s,l,c));return h.ref_seq=d?d.data:null,h.base_color_fn=u,h}return r(e,t),d(e,[{key:"get_row_height",value:function(){var t,e=this.mode;return"Dense"===e?t=10:"Squish"===e?t=5:(t=10,this.prefs.show_insertions&&(t*=2)),t}},{key:"_parse_cigar",value:function(t){var e="MIDNSHP=X",n=[[0,0]],i=n[0],r=0,a=h.map(t.match(/[0-9]+[MIDNSHP=X]/g),function(t){var a=parseInt(t.slice(0,-1),10),o=t.slice(-1);return"N"===o?0!==i[1]&&(i=[r+a,r+a],n.push(i)):-1==="ISHP".indexOf(o)&&(i[1]+=a,r+=a),[e.indexOf(o),a]});return{blocks:n,cigar:a}}},{key:"draw_read",value:function(t,e,n,i,r,a,l,d,u,h){var f=function(t){return Math.floor(Math.max(0,(t-r-.5)*n))};t.textAlign="center";var v,y,b=[r,a],w=0,x=0,k=Math.round(n/2),M=t.canvas.manager.char_width_px,C="+"===u?this.prefs.detail_block_color:this.prefs.reverse_strand_color,S="Pack"===e,T=S?9:3,A=i+1,j=new L(t,T,n,e),E=[],O=[],N=this._parse_cigar(d);d=N.cigar,E=N.blocks;for(var I=0;I<E.length;I++){var P=E[I];s([l+P[0],l+P[1]],b)&&(v=f(l+P[0]),y=f(l+P[1]),v===y&&(y+=1),t.fillStyle=C,t.fillRect(v,A,y-v,T))}for(var D=0,R=d.length;D<R;D++){var z=d[D],$="MIDNSHP=X"[z[0]],W=z[1],G=l+w;if(v=f(G),y=f(G+W),s([G,G+W],b))switch(v===y&&(y+=1),$){case"H":case"S":case"P":break;case"M":w+=W;break;case"=":case"X":var V="";"X"===$?V=h.slice(x,x+W):this.ref_seq&&(V=this.ref_seq.slice(Math.max(0,G-r),Math.min(G-r+W,a-r)));for(var H=Math.max(G,r),F=0;F<V.length;F++)if(V&&!this.prefs.show_differences||"X"===$){var Y=Math.floor(Math.max(0,(H+F-r)*n));t.fillStyle=this.base_color_fn(V[F]),S&&n>M?t.fillText(V[F],Y,i+9):n>.05&&t.fillRect(Y-k,A,Math.max(1,Math.round(n)),T)}"X"===$&&(x+=W),w+=W;break;case"N":t.fillStyle="#ccc",t.fillRect(v,A+(T-1)/2,y-v,1),w+=W;break;case"D":j.draw_deletion(v,A,W),w+=W;break;case"I":var q=v-k;if(s([G,G+W],b)){var U=h.slice(x,x+W);if(this.prefs.show_insertions){var B=v-(y-v)/2;if(("Pack"===e||"Auto"===this.mode)&&void 0!==h&&n>M){switch(t.fillStyle="yellow",t.fillRect(B-k,i-9,y-v,9),O[O.length]={type:"triangle",data:[q,i+4,5]},t.fillStyle="#ccc",o([G,G+W],b)){case _:U=U.slice(r-G);break;case g:U=U.slice(0,G-a);break;case m:break;case p:U=U.slice(r-G,G-a)}for(var X=0,J=U.length;X<J;X++){var Q=Math.floor(Math.max(0,(G+X-r)*n));t.fillText(U[X],Q-(y-v)/2,i)}}else t.fillStyle="yellow",t.fillRect(B,i+("Dense"!==this.mode?2:5),y-v,"Dense"!==e?3:9)}else("Pack"===e||"Auto"===this.mode)&&void 0!==h&&n>M&&O.push({type:"text",data:[U.length,q,i+9]})}x+=W}else w=function(t,e,n){return-1!=="M=NXD".indexOf(e)&&(t+=n),t}(w,$,W),x=function(t,e,n){return-1!=="IX".indexOf(e)&&(t+=n),t}(x,$,W)}t.fillStyle="yellow";for(var K,Z,tt,et=0;et<O.length;et++)K=O[et],Z=K.type,tt=K.data,"text"===Z?(t.save(),t.font="bold "+t.font,t.fillText(tt[0],tt[1],tt[2]),t.restore()):"triangle"===Z&&c(t,tt[0],tt[1],tt[2])}},{key:"draw_element",value:function(t,e,n,i,r,a,o,s,c){var d=n[1],u=n[2],h=n[3],f=Math.floor(Math.max(-.5*o,(d-r-.5)*o)),p=Math.ceil(Math.min(c,Math.max(0,(u-r-.5)*o))),_=("Dense"===e?0:0+i)*s,g="Pack"===e?9:3;if(n[5]instanceof Array){var m=!0;n[4][1]>=r&&n[4][0]<=a&&n[4][2]?this.draw_read(t,e,o,_,r,a,n[4][0],n[4][2],n[4][3],n[4][4]):m=!1,n[5][1]>=r&&n[5][0]<=a&&n[5][2]?this.draw_read(t,e,o,_,r,a,n[5][0],n[5][2],n[5][3],n[5][4]):m=!1;var v=Math.ceil(Math.min(c,Math.max(-.5*o,(n[4][1]-r-.5)*o))),y=Math.floor(Math.max(-.5*o,(n[5][0]-r-.5)*o));if(m&&y>v){t.fillStyle="#ccc";var b=_+1+(g-1)/2;l(t,v,b,y,b)}}else this.draw_read(t,e,o,_,r,a,d,n[4],n[5],n[6]);return"Pack"===e&&d>=r&&"."!==h&&(t.fillStyle=this.prefs.label_color,0===r&&f-t.measureText(h).width<0?(t.textAlign="left",t.fillText(h,p+2,_+9,this.max_label_length)):(t.textAlign="right",t.fillText(h,f-2,_+9,this.max_label_length))),[0,0]}}]),e}(M),T=function(t){function e(t,n,r,o,s,l,c){a(this,e);var d=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s,l,c));return d.longest_feature_length=d.calculate_longest_feature_length(),d.draw_background_connector=!1,d.draw_individual_connectors=!0,d}return r(e,t),d(e,[{key:"calculate_longest_feature_length",value:function(){for(var t=0,e=0,n=this.data.length;e<n;e++){var i=this.data[e],r=i[1],a=i[2];t=Math.max(t,a-r)}return t}},{key:"get_top_padding",value:function(t){var e=this.view_end-this.view_start,n=t/e;return Math.min(128,Math.ceil(this.longest_feature_length/2*n))}},{key:"draw_connector",value:function(t,e,n,i,r,a){var o=(n+i)/2;i-o>0&&(t.beginPath(),t.arc(o,a,i-o,Math.PI,0),t.stroke())}}]),e}(C),A=function(){function t(e,n){a(this,t),Array.isArray(e)?this.rgb=e:6==e.length?this.rgb=e.match(/.{2}/g).map(function(t){return parseInt(t,16)}):7==e.length?this.rgb=e.substring(1,7).match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=e.split("").map(function(t){return parseInt(t+t,16)}),this.alpha="number"==typeof n?n:1}return d(t,[{key:"eval",value:function(){return this}},{key:"toCSS",value:function(){return this.alpha<1?"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")}},{key:"toHSL",value:function(){var t,e,n=this.rgb[0]/255,i=this.rgb[1]/255,r=this.rgb[2]/255,a=this.alpha,o=Math.max(n,i,r),s=Math.min(n,i,r),l=(o+s)/2,c=o-s;if(o===s)t=e=0;else{switch(e=l>.5?c/(2-o-s):c/(o+s),o){case n:t=(i-r)/c+(i<r?6:0);break;case i:t=(r-n)/c+2;break;case r:t=(n-i)/c+4}t/=6}return{h:360*t,s:e,l:l,a:a}}},{key:"toARGB",value:function(){return"#"+[Math.round(255*this.alpha)].concat(this.rgb).map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")}},{key:"mix",value:function(e,n){var i=this,r=n,a=2*r-1,o=i.toHSL().a-e.toHSL().a,s=((a*o==-1?a:(a+o)/(1+a*o))+1)/2,l=1-s;return new t([i.rgb[0]*s+e.rgb[0]*l,i.rgb[1]*s+e.rgb[1]*l,i.rgb[2]*s+e.rgb[2]*l],i.alpha*r+e.alpha*(1-r))}}]),t}(),j=function(){function t(e,n,i,r){a(this,t),this.start_color=new A(e),this.end_color=new A(n),this.start_value=i,this.end_value=r,this.value_range=r-i}return d(t,[{key:"map_value",value:function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t=(t-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-t).toCSS()}}]),t}(),E=function(){function t(e,n,i,r,o){a(this,t),this.positive_ramp=new j(n,i,0,o),this.negative_ramp=new j(n,e,0,-r),this.start_value=r,this.end_value=o}return d(t,[{key:"map_value",value:function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t>=0?this.positive_ramp.map_value(t):this.negative_ramp.map_value(-t)}}]),t}(),O=function(t){function e(t,n,r,o,s){a(this,e);var l,c,d=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s));if(void 0===d.prefs.min_value){var u=1/0;for(l=0,c=d.data.length;l<c;l++)u=Math.min(u,d.data[l][6]);d.prefs.min_value=u}if(void 0===d.prefs.max_value){var h=-1/0;for(l=0,c=d.data.length;l<c;l++)h=Math.max(h,d.data[l][6]);d.prefs.max_value=h}return d}return r(e,t),d(e,[{key:"draw",value:function(t,e,n,i){var r,a,o,s,l,c,d=this.prefs.min_value,u=this.prefs.max_value,h=this.view_start,f=1/Math.sqrt(2),p=new E(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,d,u),_=function(t){return(t-h)*i};t.save(),t.rotate(-45*Math.PI/180),t.scale(f,f);for(var g=0,m=this.data.length;g<m;g++)r=this.data[g],a=_(r[1]),o=_(r[2]),s=_(r[4]),l=_(r[5]),c=r[6],t.fillStyle=p.map_value(c),t.fillRect(a,s,o-a,l-s);t.restore()}}],[{key:"default_prefs",get:function(){return{min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"}}}]),e}(w),L=function(){function t(e,n,i,r){a(this,t),this.ctx=e,this.row_height=n,this.px_per_base=i,this.draw_details=("Pack"===r||"Auto"===r)&&i>=e.canvas.manager.char_width_px,this.delete_details_thickness=.2}return d(t,[{key:"draw_deletion",value:function(t,e,n){this.ctx.fillStyle="black";var i=(this.draw_details?this.delete_details_thickness:1)*this.row_height;e+=.5*(this.row_height-i),this.ctx.fillRect(t,e,n*this.px_per_base,i)}}]),t}(),N=function(t){function e(t,n,r,o,s,l){a(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r,o,s));return c.base_color_fn=l,c.divider_height=1,c}return r(e,t),d(e,[{key:"get_row_height",value:function(){var t=this.mode;return"Dense"===t?10:"Squish"===t?5:10}},{key:"get_required_height",value:function(t){var e=this.prefs.summary_height;return t>1&&this.prefs.show_sample_data&&(e+=this.divider_height+t*this.get_row_height()),e}},{key:"draw",value:function(t,e,n,i){t.save();var r,a,o,s,l,c,d,u,f,p,_,g=function(t,e){var n=t.length,i=e.length,r=0,a=1,o=null;return"-"===e?(o="deletion",a=t.length):0===t.indexOf(e)&&n>i?(o="deletion",a=n-i,r=i):0===e.indexOf(t)&&n<i&&(o="insertion",a=i-n,r=i),null!==o?{type:o,start:r,len:a}:{}},m=Math.max(1,Math.floor(i)),v=this.data.length?this.data[0][7].split(",").length:0,y="Squish"===this.mode?5:10,b=i<.1?y:"Squish"===this.mode?3:9,w=!0,x=new L(t,y,i,this.mode);1===v&&(y=b=i<t.canvas.manager.char_width_px?this.prefs.summary_height:y,x.row_height=y,w=!1),this.prefs.show_sample_data&&w&&(t.fillStyle="#F3F3F3",t.globalAlpha=1,t.fillRect(0,this.prefs.summary_height-this.divider_height,e,this.divider_height)),t.textAlign="center";for(var k=0;k<this.data.length;k++)if(r=this.data[k],a=r[1],o=r[3],s=[r[4].split(",")],l=r[7].split(","),c=r.slice(8),s=h.map(h.flatten(s),function(t){var e={type:"snp",value:t,start:0},n=g(o,t);return h.extend(e,n)}),!(a<this.view_start||a>this.view_end)){if(w)for(t.fillStyle="#999999",t.globalAlpha=1,_=0;_<s.length;_++)for(u=this.get_start_draw_pos(a+s[_].start,i),t.fillRect(u,0,m,this.prefs.summary_height),f=this.prefs.summary_height,_=0;_<s.length;_++){t.fillStyle="deletion"===s[_].type?"black":this.base_color_fn(s[_].value);var M=c/l.length,C=Math.ceil(this.prefs.summary_height*M);t.fillRect(u,f-C,m,C),f-=C}if(this.prefs.show_sample_data)for(f=w?this.prefs.summary_height+this.divider_height:0,_=0;_<l.length;_++,f+=y)if(p=l[_]?l[_].split(/\/|\|/):["0","0"],d=null,p[0]===p[1]?"."===p[0]||"0"!==p[0]&&(d=s[parseInt(p[0],10)-1],t.globalAlpha=1):(d="0"!==p[0]?p[0]:p[1],d=s[parseInt(d,10)-1],t.globalAlpha=.5),d)if(u=this.get_start_draw_pos(a+d.start,i),"snp"===d.type){var S=d.value;t.fillStyle=this.base_color_fn(S),x.draw_details?t.fillText(S,this.get_draw_pos(a,i),f+y):t.fillRect(u,f+1,m,b)}else"deletion"===d.type&&x.draw_deletion(u,f+1,d.len)}t.restore()}}]),e}(w);e.default={Scaler:y,LinePainter:x,LinkedFeaturePainter:C,ReadPainter:S,ArcLinkedFeaturePainter:T,DiagonalHeatmapPainter:O,VariantPainter:N}},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=o.extend,l=function(t){this.manager=null,this.name=t.name,this.index=t.index,this.tool_id=t.tool_id,this.tool_exp_name=t.tool_exp_name};s(l.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var c=function(e,n,i){return t("<a/>").attr("href","javascript:void(0);").attr("title",e).addClass("icon-button").addClass(n).tooltip().click(i)},d=function(e){l.call(this,e),this.low="low"in e?e.low:-Number.MAX_VALUE,this.high="high"in e?e.high:Number.MAX_VALUE,this.min="min"in e?e.min:Number.MAX_VALUE,this.max="max"in e?e.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var n=this;n.parent_div=t("<div/>").addClass("filter-row slider-row");var i=t("<div/>").addClass("elt-label").appendTo(n.parent_div);t("<span/>").addClass("slider-name").text(n.name+"  ").appendTo(i);var r=t("<span/>").text(this.low+"-"+this.high),a=t("<span/>").addClass("slider-value").appendTo(i).append("[").append(r).append("]");n.values_span=r;var o=t("<div/>").addClass("slider").appendTo(n.parent_div);n.control_element=t("<div/>").attr("id",n.name+"-filter-control").appendTo(o),n.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(t,e){n.slide(t,e)},change:function(t,e){n.control_element.slider("option","slide").call(n.control_element,t,e)}}),n.slider=n.control_element,n.slider_label=r,function(e,n,i){e.click(function(){var e=n.text(),r=parseFloat(i.slider("option","max")),a=r<=1?4:r<=1e6?r.toString().length:6,o=!1,s=t(this).parents(".slider-row");s.addClass("input"),i.slider("option","values")&&(a=2*a+1,o=!0),n.text(""),t("<input type='text'/>").attr("size",a).attr("maxlength",a).attr("value",e).appendTo(n).focus().select().click(function(t){t.stopPropagation()}).blur(function(){t(this).remove(),n.text(e),s.removeClass("input")}).keyup(function(e){if(27===e.keyCode)t(this).trigger("blur");else if(13===e.keyCode){var n=i.slider("option","min"),r=i.slider("option","max"),a=function(t){return isNaN(t)||t>r||t<n},l=t(this).val();if(o){if(l=l.split("-"),l=[parseFloat(l[0]),parseFloat(l[1])],a(l[0])||a(l[1]))return alert("Parameter value must be in the range ["+n+"-"+r+"]"),t(this)}else if(l=parseFloat(l),a(l))return alert("Parameter value must be in the range ["+n+"-"+r+"]"),t(this);i.slider(o?"values":"value",l),s.removeClass("input")}})})}(a,r,n.control_element);var s=t("<div/>").addClass("display-controls").appendTo(n.parent_div);this.transparency_icon=c("Use filter for data transparency","layer-transparent",function(){n.manager.alpha_filter!==n?(n.manager.alpha_filter=n,n.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),n.transparency_icon.addClass("active").show()):(n.manager.alpha_filter=null,n.transparency_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(s).hide(),this.height_icon=c("Use filter for data height","arrow-resize-090",function(){n.manager.height_filter!==n?(n.manager.height_filter=n,n.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),n.height_icon.addClass("active").show()):(n.manager.height_filter=null,n.height_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(s).hide(),n.parent_div.hover(function(){n.transparency_icon.show(),n.height_icon.show()},function(){n.manager.alpha_filter!==n&&n.transparency_icon.hide(),n.manager.height_filter!==n&&n.height_icon.hide()}),t("<div style='clear: both;'/>").appendTo(n.parent_div)};s(d.prototype,{to_dict:function(){var t=l.prototype.to_dict.call(this);return s(t,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new d({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(t,e){return e-t<=2?.01:1},slide:function(t,e){var n=e.values;this.values_span.text(n[0]+"-"+n[1]),this.low=n[0],this.high=n[1];var i=this;setTimeout(function(){n[0]===i.low&&n[1]===i.high&&i.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(t){return t.length>this.index},_keep_val:function(t){return isNaN(t)||t>=this.low&&t<=this.high},keep:function(t){if(!this.applies_to(t))return!0;var e=t[this.index];if(e instanceof Array){for(var n=!0,i=0;i<e.length;i++)if(!this._keep_val(e[i])){n=!1;break}return n}return this._keep_val(t[this.index])},update_attrs:function(t){var e=!1;if(!this.applies_to(t))return e;var n=t[this.index];n instanceof Array||(n=[n]);for(var i=0;i<n.length;i++){var r=n[i];r<this.min&&(this.min=Math.floor(r),e=!0),r>this.max&&(this.max=Math.ceil(r),e=!0)}return e},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var t=this.slider.slider("option","min"),e=this.slider.slider("option","max");(this.min<t||this.max>e)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var u=function(e,n){if(this.track=e,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=t("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}),n&&"filters"in n){for(var i,r=("alpha_filter"in n?n.alpha_filter:null),a=("height_filter"in n?n.height_filter:null),o=n.filters,s=0;s<o.length;s++)"number"===o[s].type?(i=new d(o[s]),this.add_filter(i),i.name===r&&(this.alpha_filter=i,i.transparency_icon.addClass("active").show()),i.name===a&&(this.height_filter=i,i.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",o[s]);"visible"in n&&n.visible&&this.parent_div.show()}if(0!==this.filters.length){var l=t("<div/>").addClass("param-row").appendTo(this.parent_div),c=this;t("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(l).click(function(){c.run_on_dataset()})}};s(u.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var t,e={},n=[],i=0;i<this.filters.length;i++)t=this.filters[i],n.push(t.to_dict());return e.filters=n,e.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,e.height_filter=this.height_filter?this.height_filter.name:null,e.visible=this.parent_div.is(":visible"),e},copy:function(t){for(var e=new u(t),n=0;n<this.filters.length;n++)e.add_filter(this.filters[n].copy());return e},add_filter:function(t){t.manager=this,this.parent_div.append(t.parent_div),this.filters.push(t)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var t=0;t<this.filters.length;t++){this.filters[t].update_ui_elt()}},clear_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.slider.slider("option","values",[e.min,e.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var e,n,i=(function(t,e,n){return e in t||(t[e]=n),t[e]}),a={},o=0;o<this.filters.length;o++)e=this.filters[o],e.tool_id&&(e.min!==e.low&&(n=i(a,e.tool_id,[]),n[n.length]=e.tool_exp_name+" >= "+e.low),e.max!==e.high&&(n=i(a,e.tool_id,[]),n[n.length]=e.tool_exp_name+" <= "+e.high));var s=[];for(var l in a)s[s.length]=[l,a[l]];!function e(n,i){var a=i[0],o=a[0],s=a[1],l="("+s.join(") and (")+")",c={cond:l,input:n,target_dataset_id:n,tool_id:o};i=i.slice(1),t.getJSON(run_tool_url,c,function(t){t.error?Galaxy.modal.show({title:(0,r.default)("Filter Dataset"),body:"Error running tool "+o,buttons:{Close:Galaxy.modal.hide()}}):0===i.length?Galaxy.modal.show({title:(0,r.default)("Filtering Dataset"),body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:Galaxy.modal.hide()}}):e(t.dataset_id,i)})}(this.track.dataset_id,s)}}),e.default={FiltersManager:u,NumberFilter:d}}).call(e,n(0))},,,,function(t,e,n){var i=n(89);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var r=n(38).default;r("ecbbbcd8",i,!0,{})},function(t,e,n){e=t.exports=n(27)(void 0),e.push([t.i,".citations-formatted{word-wrap:break-word}.citations-bibtex-text{width:100%;height:500px}.citation-padding{padding:5px 10px}",""])},function(t,e,n){!function(t){function e(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(t){this.input=t},this.getEntries=function(){return this.entries},this.isWhitespace=function(t){return" "==t||"\r"==t||"\t"==t||"\n"==t},this.match=function(t,e){if(void 0!=e&&null!=e||(e=!0),this.skipWhitespace(e),this.input.substring(this.pos,this.pos+t.length)!=t)throw"Token mismatch, expected "+t+", found "+this.input.substring(this.pos);this.pos+=t.length,this.skipWhitespace(e)},this.tryMatch=function(t,e){return void 0!=e&&null!=e||(e=!0),this.skipWhitespace(e),this.input.substring(this.pos,this.pos+t.length)==t},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(t){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==t){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(t)}},this.value_braces=function(){var t=0;this.match("{",!1);for(var e=this.pos,n=!1;;){if(!n)if("}"==this.input[this.pos]){if(!(t>0)){var i=this.pos;return this.match("}",!1),this.input.substring(e,i)}t--}else if("{"==this.input[this.pos])t++;else if(this.pos>=this.input.length-1)throw"Unterminated value";n="\\"==this.input[this.pos]&&0==n,this.pos++}},this.value_comment=function(){for(var t="",e=0;!this.tryMatch("}",!1)||0!=e;){if(t+=this.input[this.pos],"{"==this.input[this.pos]&&e++,"}"==this.input[this.pos]&&e--,this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(start);this.pos++}return t},this.value_quotes=function(){this.match('"',!1);for(var t=this.pos,e=!1;;){if(!e){if('"'==this.input[this.pos]){var n=this.pos;return this.match('"',!1),this.input.substring(t,n)}if(this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(t)}e="\\"==this.input[this.pos]&&0==e,this.pos++}},this.single_value=function(){var t=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var e=this.key();if(e.match("^[0-9]+$"))return e;if(this.months.indexOf(e.toLowerCase())>=0)return e.toLowerCase();throw"Value expected:"+this.input.substring(t)+" for key: "+e},this.value=function(){var t=[];for(t.push(this.single_value());this.tryMatch("#");)this.match("#"),t.push(this.single_value());return t.join("")},this.key=function(t){for(var e=this.pos;;){if(this.pos>=this.input.length)throw"Runaway key";if(this.notKey.indexOf(this.input[this.pos])>=0)return t&&","!=this.input[this.pos]?(this.pos=e,null):this.input.substring(e,this.pos);this.pos++}},this.key_equals_value=function(){var t=this.key();if(this.tryMatch("=")){this.match("=");var e=this.value();return t=t.trim(),[t,e]}throw"... = value expected, equals sign missing:"+this.input.substring(this.pos)},this.key_value_list=function(){var t=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[t[0]]=t[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)t=this.key_equals_value(),this.currentEntry.entryTags[t[0]]=t[1]},this.entry_body=function(t){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=t.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(t){this.entry_body(t)},this.alernativeCitationKey=function(){this.entries.forEach(function(t){!t.citationKey&&t.entryTags&&(t.citationKey="",t.entryTags.author&&(t.citationKey+=t.entryTags.author.split(",")[0]+=", "),t.citationKey+=t.entryTags.year)})},this.bibtex=function(){for(;this.matchAt();){var t=this.directive();this.match("{"),"@STRING"==t.toUpperCase()?this.string():"@PREAMBLE"==t.toUpperCase()?this.preamble():"@COMMENT"==t.toUpperCase()?this.comment():this.entry(t),this.match("}")}this.alernativeCitationKey()}}t.toJSON=function(t){var n=new e;return n.setInput(t),n.bibtex(),n.entries},t.toBibtex=function(t){var e="";for(var n in t){if(e+="@"+t[n].entryType,e+="{",t[n].citationKey&&(e+=t[n].citationKey+", "),t[n].entry&&(e+=t[n].entry),t[n].entryTags){var i="";for(var r in t[n].entryTags)0!=i.length&&(i+=", "),i+=r+"= {"+t[n].entryTags[r]+"}";e+=i}e+="}\n\n"}return e}}(e)},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(92)),i(n(93)),i(n(44)),i(n(47)),i(n(13)),i(n(48)),i(n(134)),i(n(135)),i(n(51))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.aliases={mathfrak:"frak",mathcal:"cal",mathbb:"bb",mathbf:"bf",dfrac:"frac",ldots:"dots"}},function(t,e,n){"use strict";function i(t,e){return a(t,s.mustNotBeUndefined(s.mustBeOk(s.latexParser.parse(e)).value))}function r(t){return a({translateTo:"unicode",mode:"Any"},s.mustNotBeUndefined(s.mustBeOk(s.latexParser.parse(t)).value))}function a(t,e){var n=t.translateTo;switch(n){case"html":throw new Error("Unsupported format: '"+n+"'. Use one of: "+Object.keys(o.supportedMarkups));case"unicode":default:return l.convertLaTeXBlocksToUnicode(t,e).result}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(44),s=n(28),l=n(95);e.convertLaTeX=i,e.convertLaTeXToUnicode=r,e.convertLaTeXBlocks=a},function(t,e,n){"use strict";function i(t,e){var n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;for(var r={},a=0;a<n;a++)r[t[a]]=!0;for(var o=0;o<i;o++)r[e[o]]=!0;var s=[];for(var l in r)r.hasOwnProperty(l)&&s.push(l);return s.sort(),s}function r(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?i(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function a(t,e,n,i){return k.Parser(function(a,o){for(var s=i,l=0,c=void 0;o<a.length;){var d=e._(a,o);if(d.status){o=S.mustBeNumber(d.index);break}var u=t._(a,o);if(w(u))return u;if(c=S.mustNotBeUndefined(r(u,c)),w(c))return c;l++;var h=S.mustNotBeUndefined(c.value);s=n(s,h),o=S.mustBeNumber(c.index)}return x(r(k.makeSuccess(o,s),c))})}function o(t,e){return a(t,e,function(t,e){return t.concat([e])},[])}function s(t){return k.Parser(function(e,n){var i=e.charAt(n);if(n>=e.length||t(i))return T.makeFailure(n,"text character");var r=[i];n++;for(var a=e.charAt(n);!t(a)&&n<e.length;)r.push(a),n++,a=e.charAt(n);return k.makeSuccess(n,r.join(""))})}function l(t){return s(d(t)).map(function(t){return C.newTeXRaw(t)})}function c(t,n){return(void 0===n?e.specialCharsDefault:n).hasOwnProperty(t)}function d(t){return function(e){return t.hasOwnProperty(e)}}function u(t,n,i){switch(void 0===n&&(n="_"),void 0===i&&(i="^"),t){case"Math":return e.latexBlockParserMathMode(n,i);default:return e.latexBlockParserTextMode}}function h(t){return t>="A"&&t<="Z"}function f(t){return t>="a"&&t<="z"}function p(t){return P.then(o(u(t,"_"),D)).map(M.newFixArg)}function _(t){return O.then(o(u(t),L)).map(M.newOptArg)}function g(t){return k.alt(p(t),_(t))}function m(t){return k.alt(k.string("{}").map(function(){return[]}),g(t).map(function(t){return t}).atLeast(0)).map(function(t){return t})}function v(t){return k.seqMap(e.commandSymbol,k.alt(e.specialChar,e.takeTill(e.endCmd)),m(t),function(t,e,n){return void 0!==n?M.newTeXComm.apply(void 0,[e].concat(n)):M.newTeXComm(e)}).map(function(t){return t})}function y(t,n,i){return k.seqMap(e.subOrSuperscriptSymbolParser(n,i),m(t),function(t,e){return M.newSubOrSuperScript(t,t===M.SubOrSuperSymbol.SUB?n:i,e)}).map(function(t){return t})}function b(t){return void 0!==t&&!0===t.status}function w(t){return void 0!==t&&!1===t.status}function x(t){if(!b(t))throw new Error("Expected parse to be success: "+JSON.stringify(t));return t}Object.defineProperty(e,"__esModule",{value:!0});var k=n(46),M=n(30),C=n(30),S=n(29),T=n(46);e.defaultParserConf={verbatimEnvironments:["verbatim"]},e.takeTill=function(t){return k.takeWhile(function(e){return!t(e)})};var A=k.regexp(/[^\n]*/),j=k.regexp(/\n?/),E=(k.regexp(/\s*/m),k.string("%")),O=k.string("["),L=k.string("]");e.notTextDefault={$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},e.notTextMathMode={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},e.notTextMathModeAndNotClosingBracket={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},e.notTextDefaultAndNotClosingBracket={$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},e.textParser=l;var N=(l(e.notTextDefault),l(e.notTextDefaultAndNotClosingBracket),k.regexp(/ */).map(C.newTeXRaw));e.comment=E.then(A).skip(j).map(M.newTeXComment),e.specialCharsDefault={"'":!0,"(":!0,")":!0,",":!0,".":!0,"-":!0,'"':!0,"!":!0,"^":!0,$:!0,"&":!0,"#":!0,"{":!0,"}":!0,"%":!0,"~":!0,"|":!0,"/":!0,":":!0,";":!0,"=":!0,"[":!0,"]":!0,"\\":!0,"`":!0," ":!0},e.isSpecialCharacter=c,e.isNotText=d,e.mathSymbol=k.string("$"),e.commandSymbol=k.string("\\"),e.latexBlockParser=u,e.latexBlockParserTextMode=k.lazy(function(){return k.alt(k.alt(l(e.notTextDefault),e.dolMath,e.comment,l(e.notTextDefaultAndNotClosingBracket),e.environment,v("Paragraph")))}),e.latexBlockParserMathMode=function(t,n){return k.lazy(function(){return k.alt(k.alt(y("Math",t,n),l(e.notTextMathMode),e.dolMath,e.comment,l(e.notTextMathModeAndNotClosingBracket),e.environment,v("Math")))})},e.latexParser=e.latexBlockParserTextMode.many();var I=k.string("{").then(e.latexBlockParserTextMode.many()).skip(k.string("}"));e.env=k.Parser(function(t,n){var i=k.string("\\begin").then(k.string("{")).then(N).then(k.regexp(/[a-zA-Z]+/)).skip(N).skip(k.string("}"))._(t,n);if(w(i))return i;n=S.mustBeNumber(i.index);var r=i.value;return o(e.latexBlockParserTextMode,k.string("\\end").then(k.string("{")).then(N).then(k.string(r)).then(N).then(k.string("}"))).map(function(t){return M.newTeXEnv(r,t)})._(t,n)}),e.environment=k.alt(I,e.env),e.specialChar=k.test(c),e.endCmd=function(t){return!f(t)&&!h(t)};var P=k.string("{"),D=k.string("}");e.fixArg=p,e.optArg=_,e.cmdArg=g,e.cmdArgs=m,e.command=v,e.subOrSuperscriptSymbolParser=function(t,e){return k.alt(k.string(t),k.string(e)).map(function(e){return e===t?M.SubOrSuperSymbol.SUB:M.SubOrSuperSymbol.SUP})},e.shiftedScript=y,e.dolMath=function(t,e,n){return void 0===t&&(t="Dollar"),void 0===e&&(e="$"),void 0===n&&(n="$"),k.string(e).then(u("Math","_").many().map(function(i){return M.newTeXMath(t,e,n,i)})).skip(k.string(n))}(),e.isOk=b,e.isNotOk=w,e.mustBeOk=x},function(t,e,n){"use strict";function i(t){return"string"==typeof t}function r(t,e){var n=t;do{t++}while(h.isTeXChar(e[t]));return{result:e.slice(n,t).map(function(t){return t.string}).join(""),blockIndex:t}}function a(t,e,n,r){var a=u(t,r);if(i(a))return{result:a,blockIndex:e+1};for(var o=[],l=[];o.length<a.argumentCount&&e<n.length-1;){e++;var c=e;if(n.length<c-1)throw new Error("Could not gobble "+a.argumentCount+" arguments for "+r.name);var d=n[c];if(h.isTeXRaw(d)){for(var f=/\s+/g,p=d.text.replace(x,""),_=-1,g=0;o.length<a.argumentCount;){var m=f.exec(p);if(!m){o.push.apply(o,w.convertToTeXCharsDefault(p));break}var v=p.substring(g,m.index);_=m.index,g=m.index+v.length,o.push.apply(o,w.convertToTeXCharsDefault(v))}_>=0&&l.push(p.substring(_))}else o.push(d)}e++;var y=o.map(function(e){return s(t,[e]).result}).map(h.newTeXRaw).map(function(t){return h.newFixArg([t])});if(y.length<a.argumentCount)throw new Error("Could not find enough arguments for command \\"+a.name+". Expected "+a.argumentCount+", but found "+y.length);var b=[a.apply(function(){},y)];return l.length>0&&b.push(l.join("")),{result:b.join(""),blockIndex:e}}function o(t){return void 0!==t&&"string"==typeof t.string&&"number"==typeof t.category}function s(t,e){var n=0;if(e.length<=0)return{result:"",blockIndex:n};for(var i=[];n<e.length;){var l=e[n];try{if(o(l)){var c=r(n,e);n=c.blockIndex,i.push(c.result)}else if(h.isTeXComm(l)){var d=a(t,n,e,l);n=d.blockIndex,i.push(d.result)}else if(h.isFixArg(l)||h.isOptArg(l)){var d=s(t,l.latex);i.push(d.result),n++}else if(h.isTextHaving(l))i.push(l.text),n++;else{if(h.isTeXMath(l))return s(t,l.latex);if(h.isTeXRaw(l))i.push(l.text),n++;else if(h.isSubOrSuperScript(l)){var u=l.arguments?l.arguments:[],d=a(t,n,e,h.newTeXComm.apply(void 0,[l.type===h.SubOrSuperSymbol.SUB?"mathsubscript":"mathsuperscript"].concat(u)));n=d.blockIndex,i.push(d.result)}else{if(!h.isArray(l))throw new Error("Can't handle LaTeX block yet: "+JSON.stringify(l)+". Leave an issue at https://github.com/digitalheir/tex-to-unicode/issues");var d=s(t,l);i.push(d.result),n++}}}catch(e){if(void 0===t.onError)throw e;var f=t.onError(e,l);if(void 0===f)throw e;i.push(f),n++}}return{result:i.join(""),blockIndex:n}}function l(t,e){if(e.arguments.length>0){var n=g.expand1argsCommand(e.name,s(t,[e.arguments[0]]).result||"");return e.arguments.length>1?n+s(t,e.arguments.slice(1)).result:n}return _.createCommandHandler(e.name,0,1,function(n,i){var r=i[0],a=i.slice(1);return g.expand1argsCommand(e.name,s(t,[r]).result)+s(t,a).result})}function c(t,e){if(e.arguments.length>1){var n=y.expand2argsCommand(e.name,s(t,[e.arguments[0]]).result||"",s(t,[e.arguments[1]]).result||"");return e.arguments.length>2?n+s(t,e.arguments.slice(1)).result:n}return _.createCommandHandler(e.name,0,2,function(n,i){var r=i[0],a=i[1],o=i.slice(2);return y.expand2argsCommand(e.name,s(t,[r]).result,s(t,[a]).result)+s(t,o).result})}function d(t,e){for(var n=void 0,i=void 0,r=0;void 0===i&&r<e.arguments.length;){var a=e.arguments[r],o=s(t,[a]).result;h.isOptArg(a)&&!n?n=o:i=o,r++}return i?v.convertSqrtToUnicode(i,n):_.createCommandHandler(e.name,1,1,function(e,n){var i=n[0],r=v.convertSqrtToUnicode(s(t,[i]).result);if(n.length>1){var a=n.slice(1);return r+s(t,a).result}return r})}function u(t,e){var n=e.name,i=p.expand0argsCommand(n);if(i)return e.arguments&&e.arguments.length>0?i+s(t,e.arguments).result:i;if(m.is1argsCommand(n))return l(t,e);if(b.is2argsCommand(n))return c(t,e);if("sqrt"===n)return d(t,e);throw f.unknownCommandError(n)}Object.defineProperty(e,"__esModule",{value:!0});var h=n(28),f=n(47),p=n(96),_=n(48),g=n(103),m=n(51),v=n(128),y=n(129),b=n(132),w=n(45),x=/^\s*/;e.isTeXChar2=o,e.convertLaTeXBlocksToUnicode=s,e.convertCommand=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(97),r=n(98),a=n(99),o=n(100),s=n(101),l=n(102);e.expand0argsCommand=function(t){for(var e=0,n=[a.barredLUnicode,i.spaceUnicode,o.slashedOUnicode,r.characterUnicode,l.specialCharacter,s.cyrillicUnicode];e<n.length;e++){var c=n[e],d=c(t);if(d)return d}}},function(t,e,n){"use strict";function i(t){return e.spaceCharactersUnicode.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.mathSpace="芇",e.spaceCharactersUnicode={",":" ",quad:" ",qquad:"  "," ":" ",space:" ",";":"　",":":"　",hfill:"\t"},e.isSpaceCharactersUnicode=i,e.spaceUnicode=function(t){return i(t)?e.spaceCharactersUnicode[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.characterUnicodeChart.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.characterUnicodeChart={leftrightsquigarrow:"↭",Longleftrightarrow:"⟺",blacktriangleright:"▶",longleftrightarrow:"⟷",blacktriangledown:"▼",blacktriangleleft:"◀",leftrightharpoons:"⇋",rightleftharpoons:"⇌",twoheadrightarrow:"↠",circlearrowright:"↻",downharpoonright:"⇂",rightharpoondown:"⇁",rightrightarrows:"⇉",twoheadleftarrow:"↞",vartriangleright:"⊳",bigtriangledown:"▽",circlearrowleft:"↺",curvearrowright:"↷",downharpoonleft:"⇃",leftharpoondown:"↽",leftrightarrows:"⇆",rightleftarrows:"⇄",rightsquigarrow:"⇝",rightthreetimes:"⋌",trianglerighteq:"⊵",vartriangleleft:"⊲",Leftrightarrow:"⇔",Longrightarrow:"⟹",curvearrowleft:"↶",dashrightarrow:"⇢",doublebarwedge:"⩞",downdownarrows:"⇊",hookrightarrow:"↪",leftleftarrows:"⇇",leftrightarrow:"↔",leftthreetimes:"⋋",longrightarrow:"⟶",looparrowright:"↬",rightarrowtail:"↣",rightharpoonup:"⇀",sphericalangle:"∢",textregistered:"®",trianglelefteq:"⊴",upharpoonright:"↾",Longleftarrow:"⟸",bigtriangleup:"△",blacktriangle:"▲",dashleftarrow:"⇠",divideontimes:"⋇",fallingdotseq:"≒",hookleftarrow:"↩",leftarrowtail:"↢",leftharpoonup:"↼",longleftarrow:"⟵",looparrowleft:"↫",measuredangle:"∡",shortparallel:"∥",smallsetminus:"∖",texttrademark:"™",triangleright:"▷",upharpoonleft:"↿",blacklozenge:"◆",risingdotseq:"≓",triangledown:"▽",triangleleft:"◁",Rrightarrow:"⇛",Updownarrow:"⇕",backepsilon:"∍",blacksquare:"■",circledcirc:"⊚",circleddash:"⊝",curlyeqprec:"⋞",curlyeqsucc:"⋟",diamondsuit:"♢",preccurlyeq:"≼",succcurlyeq:"≽",textgreater:">",thickapprox:"≈",updownarrow:"↕",vartriangle:"△",Lleftarrow:"⇚",Rightarrow:"⇒",circledast:"⊛",complement:"∁",curlywedge:"⋏",longmapsto:"⟼",registered:"®",rightarrow:"→",smallfrown:"⌢",smallsmile:"⌣",sqsubseteq:"⊑",sqsupseteq:"⊒",textlangle:"〈",textrangle:"〉",upuparrows:"⇈",varepsilon:"ε",varnothing:"∅",Downarrow:"⇓",Leftarrow:"⇐",backprime:"‵",bigotimes:"⨂",centerdot:"⋅",copyright:"©",downarrow:"↓",gtreqless:"⋛",heartsuit:"♡",leftarrow:"←",lesseqgtr:"⋚",pitchfork:"⋔",spadesuit:"♠",therefore:"∴",trademark:"™",triangleq:"≜",varpropto:"∝",approxeq:"≊",barwedge:"⊼",bigoplus:"⨁",bigsqcup:"⨆",biguplus:"⨄",bigwedge:"⋀",boxminus:"⊟",boxtimes:"⊠",circledS:"Ⓢ",clubsuit:"♣",curlyvee:"⋎",doteqdot:"≑",emptyset:"∅",intercal:"⊺",leqslant:"⩽",multimap:"⊸",parallel:"∥",setminus:"∖",sqsubset:"⊏",sqsupset:"⊐",subseteq:"⊆",supseteq:"⊇",textless:"<",thicksim:"∼",triangle:"△",varkappa:"ϰ",varsigma:"ς",vartheta:"ϑ",Diamond:"◇",Uparrow:"⇑",Upsilon:"Υ",backsim:"∽",because:"∵",between:"≬",bigodot:"⨀",bigstar:"★",boxplus:"⊞",ddagger:"‡",diamond:"⋄",digamma:"Ϝ",dotplus:"∔",epsilon:"∊",gtrless:"≷",implies:"⇒",leadsto:"↝",lessdot:"⋖",lessgtr:"≶",lesssim:"≲",lozenge:"◊",natural:"♮",nearrow:"↗",nexists:"∄",nwarrow:"↖",partial:"∂",pilcrow:"¶",precsim:"≾",searrow:"↘",section:"§",succsim:"≿",swarrow:"↙",textbar:"|",uparrow:"↑",upsilon:"υ",Bumpeq:"≎",Lambda:"Λ",Subset:"⋐",Supset:"⋑",Vvdash:"⊪",approx:"≈",bigcap:"⋂",bigcup:"⋃",bigvee:"⋁",bowtie:"⋈",boxdot:"⊡",bullet:"∙",bumpeq:"≏",circeq:"≗",coprod:"∐",dagger:"†",daleth:"ד",degree:"°",eqcirc:"≖",exists:"∃",forall:"∀",gtrdot:"⋗",gtrsim:"≳",hslash:"ℏ",lambda:"λ",lfloor:"⌊",ltimes:"⋉",mapsto:"↦",models:"⊨",ominus:"⊖",oslash:"⊘",otimes:"⊗",preceq:"⪯",propto:"∝",rfloor:"⌋",rtimes:"⋊",square:"□",subset:"⊂",succeq:"⪰",supset:"⊃",varphi:"φ",varrho:"ϱ",veebar:"⊻",Delta:"Δ",Gamma:"Γ",Omega:"Ω",Theta:"Θ",Vdash:"⊩",aleph:"ℵ",Alpha:"Α",alpha:"α",angle:"∠",asymp:"≍",cdots:"⋯",cents:"¢",dashv:"⊣",ddots:"⋱",delta:"δ",doteq:"≐",equiv:"≡",frown:"⌢",gamma:"γ",gimel:"ℷ",infty:"∞",kappa:"κ",Kappa:"Κ",lceil:"⌈",nabla:"∇",notin:"∉",omega:"ω",oplus:"⊕",pound:"£",prime:"′",qquad:"  ",rceil:"⌉",sharp:"♯",sigma:"σ",simeq:"≃",smile:"⌣",space:"␣",sqcap:"⊓",sqcup:"⊔",theta:"θ",times:"×",unlhd:"⊴",unrhd:"⊵",uplus:"⊎",vDash:"⊨",varpi:"ϖ",vdash:"⊢",vdots:"⋮",wedge:"∧",Finv:"Ⅎ",Join:"⋈",atop:"¦",beta:"β",Beta:"Β",beth:"ב",cdot:"⋅",circ:"∘",cong:"≅",dots:"…",euro:"€",flat:"♭",geqq:"≧",hbar:"ℏ",iota:"ι",leqq:"≦",odot:"⊙",oint:"∮",perp:"⊥",prec:"≺",prod:"∏",quad:" ",star:"⋆",succ:"≻",surd:"√",zeta:"ζ",Box:"□",Cap:"⋒",Cup:"⋓",Lsh:"↰",Phi:"Φ",Psi:"Ψ",Rsh:"↱",ast:"∗",bot:"⊥",cap:"∩",chi:"χ",Chi:"Χ",cup:"∪",div:"÷",ell:"ℓ",eta:"η",eth:"ð",geq:"≥",ggg:"⋙",int:"∫",leq:"≤",lhd:"⊲",lll:"⋘",mho:"℧",mid:"∣",neg:"¬",neq:"≠",phi:"ϕ",psi:"ψ",rhd:"⊳",rho:"ρ",Rho:"Ρ",sim:"∼",sum:"∑",tau:"τ",Tau:"Τ",top:"⊤",vee:"∨",Im:"ℑ",Pi:"Π",Re:"ℜ",Xi:"Ξ",ge:"≥",gg:"≫",in:"∈",le:"≤",ll:"≪",mp:"∓",mu:"μ",Mu:"Μ",ni:"∋",nu:"ν",Nu:"Ν",pi:"π",pm:"±",wp:"℘",wr:"≀",xi:"ξ",Omicron:"Ο",omicron:"ο",textdollar:"$",textquotesingle:"'",textbackslash:"\\",textasciigrave:"`",lbrace:"{",vert:"|",rbrace:"}",textasciitilde:"~",textexclamdown:"¡",textcent:"¢",textsterling:"£",textcurrency:"¤",textyen:"¥",textbrokenbar:"¦",textsection:"§",textasciidieresis:"¨",textcopyright:"©",textordfeminine:"ª",guillemotleft:"«",lnot:"¬",textasciimacron:"¯",textdegree:"°",textasciiacute:"´",textparagraph:"¶",textordmasculine:"º",guillemotright:"»",textonequarter:"¼",textonehalf:"½",textthreequarters:"¾",textquestiondown:"¿",AA:"Å",AE:"Æ",DH:"Ð",texttimes:"×",TH:"Þ",ss:"ß",aa:"å",ae:"æ",dh:"ð",th:"þ",DJ:"Đ",dj:"đ",Elzxh:"ħ",i:"ı",NG:"Ŋ",ng:"ŋ",OE:"Œ",oe:"œ",texthvlig:"ƕ",textnrleg:"ƞ",textdoublepipe:"ǂ",Elztrna:"ɐ",Elztrnsa:"ɒ",Elzopeno:"ɔ",Elzrtld:"ɖ",Elzschwa:"ə",Elzpgamma:"ɣ",Elzpbgam:"ɤ",Elztrnh:"ɥ",Elzbtdl:"ɬ",Elzrtll:"ɭ",Elztrnm:"ɯ",Elztrnmlr:"ɰ",Elzltlmr:"ɱ",Elzltln:"ɲ",Elzrtln:"ɳ",Elzclomeg:"ɷ",textphi:"ɸ",Elztrnr:"ɹ",Elztrnrl:"ɺ",Elzrttrnr:"ɻ",Elzrl:"ɼ",Elzrtlr:"ɽ",Elzfhr:"ɾ",Elzrtls:"ʂ",Elzesh:"ʃ",Elztrnt:"ʇ",Elzrtlt:"ʈ",Elzpupsil:"ʊ",Elzpscrv:"ʋ",Elzinvv:"ʌ",Elzinvw:"ʍ",Elztrny:"ʎ",Elzrtlz:"ʐ",Elzyogh:"ʒ",Elzglst:"ʔ",Elzreglst:"ʕ",Elzinglst:"ʖ",textturnk:"ʞ",Elzdyogh:"ʤ",Elztesh:"ʧ",textasciicaron:"ˇ",Elzverts:"ˈ",Elzverti:"ˌ",Elzlmrk:"ː",Elzhlmrk:"ˑ",Elzsbrhr:"˒",Elzsblhr:"˓",Elzrais:"˔",Elzlow:"˕",textasciibreve:"˘",textperiodcentered:"˙",texttildelow:"˜",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Iota:"Ι",Sigma:"Σ",texttheta:"θ",textvartheta:"ϑ",Stigma:"Ϛ",Digamma:"Ϝ",Koppa:"Ϟ",Sampi:"Ϡ",textTheta:"ϴ",textendash:"–",textemdash:"—",Vert:"‖",Elzreapos:"‛",textquotedblleft:"“",textquotedblright:"”",textdagger:"†",textdaggerdbl:"‡",textbullet:"•",ldots:"…",textperthousand:"‰",textpertenthousand:"‱",guilsinglleft:"‹",guilsinglright:"›",nolinebreak:"⁠",Elzxrat:"℞",nleftarrow:"↚",nrightarrow:"↛",arrowwaveleft:"↜",arrowwaveright:"↝",nleftrightarrow:"↮",dblarrowupdown:"⇅",nLeftarrow:"⇍",nLeftrightarrow:"⇎",nRightarrow:"⇏",DownArrowUpArrow:"⇵",rightangle:"∟",nmid:"∤",nparallel:"∦",surfintegral:"∯",volintegral:"∰",clwintegral:"∱",Colon:"∷",homothetic:"∻",lazysinv:"∾",NotEqualTilde:"≂",approxnotequal:"≆",tildetrpl:"≋",allequal:"≌",NotHumpDownHump:"≎",NotHumpEqual:"≏",estimates:"≙",starequal:"≛",lneqq:"≨",lvertneqq:"≨",gneqq:"≩",gvertneqq:"≩",NotLessLess:"≪",NotGreaterGreater:"≫",lessequivlnt:"≲",greaterequivlnt:"≳",notlessgreater:"≸",notgreaterless:"≹",precapprox:"≾",NotPrecedesTilde:"≾",succapprox:"≿",NotSucceedsTilde:"≿",subsetneq:"⊊",varsubsetneqq:"⊊",supsetneq:"⊋",varsupsetneq:"⊋",NotSquareSubset:"⊏",NotSquareSuperset:"⊐",truestate:"⊧",forcesextra:"⊨",VDash:"⊫",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",original:"⊶",image:"⊷",hermitconjmatrix:"⊹",rightanglearc:"⊾",backsimeq:"⋍",verymuchless:"⋘",verymuchgreater:"⋙",Elzsqspne:"⋥",lnsim:"⋦",gnsim:"⋧",precedesnotsimilar:"⋨",succnsim:"⋩",ntriangleleft:"⋪",ntriangleright:"⋫",ntrianglelefteq:"⋬",ntrianglerighteq:"⋭",upslopeellipsis:"⋰",downslopeellipsis:"⋱",perspcorrespond:"⌆",recorder:"⌕",ulcorner:"⌜",urcorner:"⌝",llcorner:"⌞",lrcorner:"⌟",langle:"〈",rangle:"〉",Elzdlcorn:"⎣",lmoustache:"⎰",rmoustache:"⎱",textvisiblespace:"␣",Elzdshfnc:"┆",Elzsqfnw:"┙",diagup:"╱",Elzvrecto:"▯",Elzcirfl:"◐",Elzcirfr:"◑",Elzcirfb:"◒",Elzrvbull:"◘",Elzsqfl:"◧",Elzsqfr:"◨",Elzsqfse:"◪",bigcirc:"◯",rightmoon:"☾",mercury:"☿",venus:"♀",male:"♂",jupiter:"♃",saturn:"♄",uranus:"♅",neptune:"♆",pluto:"♇",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpio:"♏",sagittarius:"♐",capricornus:"♑",aquarius:"♒",pisces:"♓",quarternote:"♩",eighthnote:"♪",UpArrowBar:"⤒",DownArrowBar:"⤓",Elolarr:"⥀",Elorarr:"⥁",ElzRlarr:"⥂",ElzrLarr:"⥄",Elzrarrx:"⥇",LeftRightVector:"⥎",RightUpDownVector:"⥏",DownLeftRightVector:"⥐",LeftUpDownVector:"⥑",LeftVectorBar:"⥒",RightVectorBar:"⥓",RightUpVectorBar:"⥔",RightDownVectorBar:"⥕",DownLeftVectorBar:"⥖",DownRightVectorBar:"⥗",LeftUpVectorBar:"⥘",LeftDownVectorBar:"⥙",LeftTeeVector:"⥚",RightTeeVector:"⥛",RightUpTeeVector:"⥜",RightDownTeeVector:"⥝",DownLeftTeeVector:"⥞",DownRightTeeVector:"⥟",LeftUpTeeVector:"⥠",LeftDownTeeVector:"⥡",UpEquilibrium:"⥮",ReverseUpEquilibrium:"⥯",RoundImplies:"⥰",Elztfnc:"⦀",Elroang:"⦆",Elzddfnc:"⦙",Angle:"⦜",Elzlpargt:"⦠",ElzLap:"⧊",Elzdefas:"⧋",LeftTriangleBar:"⧏",NotLeftTriangleBar:"⧏",RightTriangleBar:"⧐",NotRightTriangleBar:"⧐",RuleDelayed:"⧴",Elxuplus:"⨄",ElzThr:"⨅",Elxsqcup:"⨆",ElzInf:"⨇",ElzSup:"⨈",ElzCint:"⨍",clockoint:"⨏",sqrint:"⨖",ElzTimes:"⨯",amalg:"⨿",ElzAnd:"⩓",ElzOr:"⩔",ElOr:"⩖",Elzminhat:"⩟",Equal:"⩵",nleqslant:"⩽",geqslant:"⩾",ngeqslant:"⩾",lessapprox:"⪅",gtrapprox:"⪆",lneq:"⪇",gneq:"⪈",lnapprox:"⪉",gnapprox:"⪊",lesseqqgtr:"⪋",gtreqqless:"⪌",eqslantless:"⪕",eqslantgtr:"⪖",NestedLessLess:"⪡",NotNestedLessLess:"⪡",NestedGreaterGreater:"⪢",NotNestedGreaterGreater:"⪢",precneqq:"⪵",succneqq:"⪶",precnapprox:"⪹",succnapprox:"⪺",subseteqq:"⫅",nsubseteqq:"⫅",supseteqq:"⫆",subsetneqq:"⫋",supsetneqq:"⫌",Elztdcol:"⫶",openbracketleft:"〚",openbracketright:"〛"},e.isCharacterUnicode=i,e.characterUnicode=function(t){return i(t)?e.characterUnicodeChart[t]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.barredLUnicodeChart={l:"ł",L:"Ł"},e.barredLUnicode=function(t){return e.barredLUnicodeChart[t]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.slashed_o="ø",e.slashed_O="Ø",e.slashedOUnicodeChart={o:e.slashed_o,O:e.slashed_O},e.slashedOUnicode=function(t){return e.slashedOUnicodeChart[t]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyrillicUnicodeChart={CYRF:"Ф",CYRII:"І",CYROMEGA:"Ѡ",CYRG:"Г",cyrkvcrs:"ҝ",cyryo:"ё",CYRH:"Х",CYRZHDSC:"Җ",cyrphk:"ҧ",CYRTDSC:"Ҭ",CYRI:"И",cyryi:"ї",CYRDZHE:"Џ",cyriote:"ѥ",CYRK:"К",CYRSHHA:"Һ",CYRL:"Л",CYRM:"М",CYRCHLDSC:"Ӌ",CYRNJE:"Њ",CYRYAT:"Ѣ",CYRA:"А",CYRB:"Б",cyrchrdsc:"ҷ",cyrschwa:"ә",CYRDZE:"Ѕ",CYRIE:"Є",CYRC:"Ц",CYRZH:"Ж",CYRD:"Д",CYRABHCHDSC:"Ҿ",CYRFITA:"Ѳ",CYRE:"Е",CYRABHHA:"Ҩ",cyrya:"я",cyrdzhe:"џ",CYRIOTLYUS:"Ѩ",cyrsemisftsn:"ҍ",CYRV:"В",cyrishrt:"й",cyrdje:"ђ",cyrchldsc:"ӌ",CYRY:"Ү",cyrndsc:"ң",CYRZ:"З",CYRKHCRS:"Ҟ",CYRNG:"Ҥ",CYRCHRDSC:"Ҷ",CYRYHCRS:"Ұ",CYRSHCH:"Щ",CYRUSHRT:"Ў",cyryu:"ю",cyrksi:"ѯ",CYRN:"Н",CYRO:"О",CYRBYUS:"Ѫ",CYRP:"П",CYRZDSC:"Ҙ",CYRAE:"Ӕ",CYRR:"Р",CYRS:"С",CYRT:"Т",CYRABHCH:"Ҽ",cyruk:"ѹ",CYRU:"У",cyrii:"і",CYRSEMISFTSN:"Ҍ",cyrghcrs:"ғ",CYRISHRT:"Й",cyromegatitlo:"ѽ",cyrkbeak:"ҡ",cyrie:"є",cyrzdsc:"ҙ",CYRNDSC:"Ң",CYRGUP:"Ґ",cyrshch:"щ",CYRKHK:"Ӄ",cyrzh:"ж",CYRJE:"Ј",cyrthousands:"҂",cyrabhch:"ҽ",textnumero:"№",cyrng:"ҥ",CYRPSI:"Ѱ",CYRTETSE:"Ҵ",CYRIOTBYUS:"Ѭ",cyrnje:"њ",CYRIOTE:"Ѥ",cyrdze:"ѕ",cyrae:"ӕ",CYRHRDSN:"Ъ",CYRKOPPA:"Ҁ",CYRRTICK:"Ҏ",CYRSCHWA:"Ә",cyrtdsc:"ҭ",CYRGHK:"Ҕ",cyrabhha:"ҩ",cyrshha:"һ",CYRSH:"Ш",cyru:"у",cyrkhcrs:"ҟ",cyrt:"т",CYRERY:"Ы",cyrs:"с",cyrr:"р",CYROT:"Ѿ",cyrlyus:"ѧ",CYRNHK:"Ӈ",CYRSFTSN:"Ь",cyrghk:"ҕ",cyrp:"п",cyrabhdze:"ӡ",cyro:"о",CYRTSHE:"Ћ",cyrn:"н",CYRSDSC:"Ҫ",cyryhcrs:"ұ",cyrpsi:"ѱ",cyrz:"з",cyry:"ү",cyrje:"ј",cyrv:"в",cyrchvcrs:"ҹ",cyrkhk:"ӄ",cyre:"е",cyromega:"ѡ",cyrd:"д",cyrc:"ц",cyrb:"б",CYROTLD:"Ө",cyrgup:"ґ",CYRLJE:"Љ",cyra:"а",CYROMEGATITLO:"Ѽ",CYRGHCRS:"Ғ",CYRCHVCRS:"Ҹ",cyrm:"м",cyrl:"л",cyrsh:"ш",cyrk:"к",cyri:"и",cyrh:"х",CYRHDSC:"Ҳ",CYRIZH:"Ѵ",CYRABHDZE:"Ӡ",cyrkdsc:"қ",cyrg:"г",CYRCH:"Ч",cyrf:"ф",CYRYI:"Ї",cyrmillions:"҉",CYRKSI:"Ѯ",CYROMEGARND:"Ѻ",cyrot:"ѿ",cyrtetse:"ҵ",cyrhdsc:"ҳ",cyrushrt:"ў",cyriotlyus:"ѩ",CYRYA:"Я",cyrlje:"љ",cyrotld:"ө",CYRKDSC:"Қ",cyrhrdsn:"ъ",cyrrtick:"ҏ",cyrkoppa:"ҁ",CYRDJE:"Ђ",cyriotbyus:"ѭ",cyrhundredthousands:"҈",CYRpalochka:"Ӏ",CYRKVCRS:"Ҝ",cyromegarnd:"ѻ",cyrsftsn:"ь",cyrabhchdsc:"ҿ",cyrzhdsc:"җ",cyrerev:"э",CYRLYUS:"Ѧ",CYRKBEAK:"Ҡ",cyrery:"ы",CYREREV:"Э",cyrnhk:"ӈ",cyrsdsc:"ҫ",cyrch:"ч",cyrtshe:"ћ",CYRPHK:"Ҧ",CYRYO:"Ё",CYRYU:"Ю",CYRUK:"Ѹ"},e.cyrillicUnicode=function(t){return e.cyrillicUnicodeChart[t]}},function(t,e,n){"use strict";function i(t){return e.specialCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.specialCharacters={i:"ı",j:"ȷ",oe:"œ",OE:"Œ",ae:"æ",AE:"Æ",aa:"å",AA:"Å",o:"ø",O:"Ø",ss:"ß",l:"ł",L:"Ł"},e.isSpecialCharacter=i,e.specialCharacter=function(t){return i(t)?e.specialCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t,e){switch(t){case"cyrchar":var n=o.translateCharToCyrillic(e);if(n)return n;break;default:for(var i=0,s=[r.diacriticUnicode,a.formattingUnicode];i<s.length;i++){var l=s[i],c=l(t,e);if(c)return c}}throw new Error("No implementation found to expand \\"+t+" with argument {"+e+"}")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(104),a=n(116),o=n(125);e.expand1argsCommand=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(105),r=n(106),a=n(107),o=n(108),s=n(109),l=n(110),c=n(111),d=n(112),u=n(13),h=n(113),f=n(114),p=n(115);e.barUnderLetter=u.simpleSuffix("̱"),e.dotUnderLetter=u.simpleSuffix("̣"),e.breve=u.simpleSuffix("̆"),e.macrron=u.simpleSuffix("̄"),e.dotOverLetter=u.simpleSuffix("̇"),e.longHungarianUmlaut=u.simpleSuffix("̋"),e.modifiersTextModeUnicodeChart={"`":a.graveAccent,"'":r.acuteAccent,"^":o.circumflex,"~":s.tilde,"=":e.macrron,".":e.dotOverLetter,'"':l.dieresis,H:e.longHungarianUmlaut,c:c.cedilla,k:h.ogonek,b:e.barUnderLetter,d:e.dotUnderLetter,r:i.ringOverLetter,u:e.breve,v:d.caron,t:f.tieLetters},e.modifiersMathModeUnicodeChart={check:d.caron,acute:r.acuteAccent,grave:r.acuteAccent,breve:e.breve,vec:p.vectorArrow,mathring:i.ringOverLetter},e.diacriticUnicode=function(t,n){var i=e.modifiersTextModeUnicodeChart[t];return i||(i=e.modifiersMathModeUnicodeChart[t]),i&&i(n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.ringOverLetter=i.lookupOrAppend({a:"å",A:"Å",y:"ẙ"},"̊")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.acuteAccent=i.lookupOrAppend({e:"é",y:"ý",u:"ú",i:"í",o:"ó",a:"á",E:"É",Y:"Ý",U:"Ú",I:"Í",O:"Ó",A:"Á",cyrk:"ќ",cyrg:"ѓ",CYRK:"Ќ",CYRG:"Ѓ"},"́")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.graveAccent=i.lookupOrAppend({e:"è",u:"ù",i:"ì",o:"ò",a:"à",E:"È",U:"Ù",I:"Ì",O:"Ò",A:"À"},"̀")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.circumflex=i.lookupOrAppend({e:"ê",u:"û",i:"î",o:"ô",a:"â",E:"Ê",U:"Û",I:"Î",O:"Ô",A:"Â"},"̂")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.tilde=i.lookupOrAppend({o:"õ",a:"ã",n:"ñ",O:"Õ",A:"Ã",N:"Ñ"},"̃")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.dieresis=i.lookupOrAppend({e:"ë",y:"ÿ",u:"ü",i:"ï",o:"ö",a:"ä",E:"Ë",Y:"Ÿ",U:"Ü",I:"Ï",O:"Ö",A:"Ä"},"̈")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.cedilla=i.lookupOrAppend({c:"ç"},"̧")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.caron=i.lookupOrAppend({s:"š"},"̌")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(13);e.ogonek=i.simpleSuffix("̨")},function(t,e,n){"use strict";function i(t){return r(t.charAt(0),t.substring(1))}function r(t,e){return t+"͡"+e}function a(t){return"t"===t}Object.defineProperty(e,"__esModule",{value:!0}),e.tieLetters=i,e.tie2Letters=r,e.isTieLetters=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.vectorArrow=i.lookupOrAppend({},"⃗")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(117),r=n(118),a=n(119),o=n(120),s=n(121),l=n(122),c=n(49),d=n(123),u=n(50),h=n(124);e.formattingUnicode=function(t,e){var n=void 0;if(c.isBbCmd(t)?n=i.translateCharToBlackboard:c.isBfCmd(t)?n=r.translateCharToBold:c.isFrakCmd(t)?n=a.translateCharToFraktur:c.isItCmd(t)?n=o.translateCharToItalic:c.isTtCmd(t)?n=s.translateCharToMonospace:c.isCalCmd(t)?n=l.translateCharToCalligraphic:c.isSubCmd(t)?n=d.translateCharToSubscript:c.isSupCmd(t)?n=u.translateCharToSuperscript:c.isMonoCmd(t)&&(n=h.translateCharToMono),n){var f=n;return e.split("").map(function(t){return f(t)||t}).join("")}}},function(t,e,n){"use strict";function i(t){return e.blackboardCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.blackboardCharacters={A:"𝔸",B:"𝔹",C:"ℂ",D:"𝔻",E:"𝔼",F:"𝔽",G:"𝔾",H:"ℍ",I:"𝕀",J:"𝕁",K:"𝕂",L:"𝕃",M:"𝕄",N:"ℕ",O:"𝕆",P:"ℙ",Q:"ℚ",R:"ℝ",S:"𝕊",T:"𝕋",U:"𝕌",V:"𝕍",W:"𝕎",X:"𝕏",Y:"𝕐",Z:"ℤ",a:"𝕒",b:"𝕓",c:"𝕔",d:"𝕕",e:"𝕖",f:"𝕗",g:"𝕘",h:"𝕙",i:"𝕚",j:"𝕛",k:"𝕜",l:"𝕝",m:"𝕞",n:"𝕟",o:"𝕠",p:"𝕡",q:"𝕢",r:"𝕣",s:"𝕤",t:"𝕥",u:"𝕦",v:"𝕧",w:"𝕨",x:"𝕩",y:"𝕪",z:"𝕫",0:"𝟘",1:"𝟙",2:"𝟚",3:"𝟛",4:"𝟜",5:"𝟝",6:"𝟞",7:"𝟟",8:"𝟠",9:"𝟡"},e.isBlackboardCharacter=i,e.translateCharToBlackboard=function(t){return i(t)?e.blackboardCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.boldCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.boldCharacters={A:"𝐀",B:"𝐁",C:"𝐂",D:"𝐃",E:"𝐄",F:"𝐅",G:"𝐆",H:"𝐇",I:"𝐈",J:"𝐉",K:"𝐊",L:"𝐋",M:"𝐌",N:"𝐍",O:"𝐎",P:"𝐏",Q:"𝐐",R:"𝐑",S:"𝐒",T:"𝐓",U:"𝐔",V:"𝐕",W:"𝐖",X:"𝐗",Y:"𝐘",Z:"𝐙",a:"𝐚",b:"𝐛",c:"𝐜",d:"𝐝",e:"𝐞",f:"𝐟",g:"𝐠",h:"𝐡",i:"𝐢",j:"𝐣",k:"𝐤",l:"𝐥",m:"𝐦",n:"𝐧",o:"𝐨",p:"𝐩",q:"𝐪",r:"𝐫",s:"𝐬",t:"𝐭",u:"𝐮",v:"𝐯",w:"𝐰",x:"𝐱",y:"𝐲",z:"𝐳","Α":"𝚨","Β":"𝚩","Γ":"𝚪","Δ":"𝚫","Ε":"𝚬","Ζ":"𝚭","Η":"𝚮","Θ":"𝚯","Ι":"𝚰","Κ":"𝚱","Λ":"𝚲","Μ":"𝚳","Ν":"𝚴","Ξ":"𝚵","Ο":"𝚶","Π":"𝚷","Ρ":"𝚸","ϴ":"𝚹","Σ":"𝚺","Τ":"𝚻","Υ":"𝚼","Φ":"𝚽","Χ":"𝚾","Ψ":"𝚿","Ω":"𝛀","∇":"𝛁","α":"𝛂","β":"𝛃","γ":"𝛄","δ":"𝛅","ε":"𝛆","ζ":"𝛇","η":"𝛈","θ":"𝛉","ι":"𝛊","κ":"𝛋","λ":"𝛌","μ":"𝛍","ν":"𝛎","ξ":"𝛏","ο":"𝛐","π":"𝛑","ρ":"𝛒","ς":"𝛓","σ":"𝛔","τ":"𝛕","υ":"𝛖","φ":"𝛗","χ":"𝛘","ψ":"𝛙","ω":"𝛚","∂":"𝛛","ϵ":"𝛜","ϑ":"𝛝","ϰ":"𝛞","ϕ":"𝛟","ϱ":"𝛠","ϖ":"𝛡",0:"𝟎",1:"𝟏",2:"𝟐",3:"𝟑",4:"𝟒",5:"𝟓",6:"𝟔",7:"𝟕",8:"𝟖",9:"𝟗"},e.isBlackboardCharacter=i,e.translateCharToBold=function(t){return i(t)?e.boldCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.frakturCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.frakturCharacters={A:"𝔄",B:"𝔅",C:"ℭ",D:"𝔇",E:"𝔈",F:"𝔉",G:"𝔊",H:"ℌ",I:"ℑ",J:"𝔍",K:"𝔎",L:"𝔏",M:"𝔐",N:"𝔑",O:"𝔒",P:"𝔓",Q:"𝔔",R:"ℜ",S:"𝔖",T:"𝔗",U:"𝔘",V:"𝔙",W:"𝔚",X:"𝔛",Y:"𝔜",Z:"ℨ",a:"𝔞",b:"𝔟",c:"𝔠",d:"𝔡",e:"𝔢",f:"𝔣",g:"𝔤",h:"𝔥",i:"𝔦",j:"𝔧",k:"𝔨",l:"𝔩",m:"𝔪",n:"𝔫",o:"𝔬",p:"𝔭",q:"𝔮",r:"𝔯",s:"𝔰",t:"𝔱",u:"𝔲",v:"𝔳",w:"𝔴",x:"𝔵",y:"𝔶",z:"𝔷"},e.isFrakturCharacter=i,e.translateCharToFraktur=function(t){return i(t)?e.frakturCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.italicCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.italicCharacters={A:"𝐴",B:"𝐵",C:"𝐶",D:"𝐷",E:"𝐸",F:"𝐹",G:"𝐺",H:"𝐻",I:"𝐼",J:"𝐽",K:"𝐾",L:"𝐿",M:"𝑀",N:"𝑁",O:"𝑂",P:"𝑃",Q:"𝑄",R:"𝑅",S:"𝑆",T:"𝑇",U:"𝑈",V:"𝑉",W:"𝑊",X:"𝑋",Y:"𝑌",Z:"𝑍",a:"𝑎",b:"𝑏",c:"𝑐",d:"𝑑",e:"𝑒",f:"𝑓",g:"𝑔",h:"ℎ",i:"𝑖",j:"𝑗",k:"𝑘",l:"𝑙",m:"𝑚",n:"𝑛",o:"𝑜",p:"𝑝",q:"𝑞",r:"𝑟",s:"𝑠",t:"𝑡",u:"𝑢",v:"𝑣",w:"𝑤",x:"𝑥",y:"𝑦",z:"𝑧","Α":"𝛢","Β":"𝛣","Γ":"𝛤","Δ":"𝛥","Ε":"𝛦","Ζ":"𝛧","Η":"𝛨","Θ":"𝛩","Ι":"𝛪","Κ":"𝛫","Λ":"𝛬","Μ":"𝛭","Ν":"𝛮","Ξ":"𝛯","Ο":"𝛰","Π":"𝛱","Ρ":"𝛲","ϴ":"𝛳","Σ":"𝛴","Τ":"𝛵","Υ":"𝛶","Φ":"𝛷","Χ":"𝛸","Ψ":"𝛹","Ω":"𝛺","∇":"𝛻","α":"𝛼","β":"𝛽","γ":"𝛾","δ":"𝛿","ε":"𝜀","ζ":"𝜁","η":"𝜂","θ":"𝜃","ι":"𝜄","κ":"𝜅","λ":"𝜆","μ":"𝜇","ν":"𝜈","ξ":"𝜉","ο":"𝜊","π":"𝜋","ρ":"𝜌","ς":"𝜍","σ":"𝜎","τ":"𝜏","υ":"𝜐","φ":"𝜑","χ":"𝜒","ψ":"𝜓","ω":"𝜔","∂":"𝜕","ϵ":"𝜖","ϑ":"𝜗","ϰ":"𝜘","ϕ":"𝜙","ϱ":"𝜚","ϖ":"𝜛"},e.isItalicCharacter=i,e.translateCharToItalic=function(t){return i(t)?e.italicCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.monospaceCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.monospaceCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},e.isMonospaceCharacter=i,e.translateCharToMonospace=function(t){return i(t)?e.monospaceCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.calligraphicLetters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.calligraphicLetters={A:"𝓐",B:"𝓑",C:"𝓒",D:"𝓓",E:"𝓔",F:"𝓕",G:"𝓖",H:"𝓗",I:"𝓘",J:"𝓙",K:"𝓚",L:"𝓛",M:"𝓜",N:"𝓝",O:"𝓞",P:"𝓟",Q:"𝓠",R:"𝓡",S:"𝓢",T:"𝓣",U:"𝓤",V:"𝓥",W:"𝓦",X:"𝓧",Y:"𝓨",Z:"𝓩",a:"𝓪",b:"𝓫",c:"𝓬",d:"𝓭",e:"𝓮",f:"𝓯",g:"𝓰",h:"𝓱",i:"𝓲",j:"𝓳",k:"𝓴",l:"𝓵",m:"𝓶",n:"𝓷",o:"𝓸",p:"𝓹",q:"𝓺",r:"𝓻",s:"𝓼",t:"𝓽",u:"𝓾",v:"𝓿",w:"𝔀",x:"𝔁",y:"𝔂",z:"𝔃"},e.isCalligraphicLetter=i,e.translateCharToCalligraphic=function(t){return i(t)?e.calligraphicLetters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.subscriptCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.subscriptCharacters={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ","β":"ᵦ","γ":"ᵧ","ρ":"ᵨ","φ":"ᵩ","χ":"ᵪ"},e.isSubscriptCharacter=i,e.translateCharToSubscript=function(t){return i(t)?e.subscriptCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.monoCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.monoCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},e.isMonoCharacter=i,e.translateCharToMono=function(t){return i(t)?e.monoCharacters[t]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyrillicCharacters={"Ф":"Ф","І":"І","Ѡ":"Ѡ","Г":"Г","ҝ":"ҝ","ё":"ё","Х":"Х","Җ":"Җ","ҧ":"ҧ","Ҭ":"Ҭ","И":"И","ї":"ї","Џ":"Џ","ѥ":"ѥ","К":"К","Һ":"Һ","Л":"Л","М":"М","Ӌ":"Ӌ","Њ":"Њ","Ѣ":"Ѣ","А":"А","Б":"Б","ҷ":"ҷ","ә":"ә","Ѕ":"Ѕ","Є":"Є","Ц":"Ц","Ж":"Ж","Д":"Д","Ҿ":"Ҿ","Ѳ":"Ѳ","Е":"Е","Ҩ":"Ҩ","я":"я","џ":"џ","Ѩ":"Ѩ","ҍ":"ҍ","В":"В","й":"й","ђ":"ђ","ӌ":"ӌ","Ү":"Ү","ң":"ң","З":"З","Ҟ":"Ҟ","Ҥ":"Ҥ","Ҷ":"Ҷ","Ұ":"Ұ","Щ":"Щ","Ў":"Ў","ю":"ю","ѯ":"ѯ","Н":"Н","О":"О","Ѫ":"Ѫ","П":"П","Ҙ":"Ҙ","Ӕ":"Ӕ","Р":"Р","С":"С","Т":"Т","Ҽ":"Ҽ","ѹ":"ѹ","У":"У","і":"і","Ҍ":"Ҍ","ғ":"ғ","Й":"Й","ѽ":"ѽ","ҡ":"ҡ","є":"є","ҙ":"ҙ","Ң":"Ң","Ґ":"Ґ","щ":"щ","Ӄ":"Ӄ","ж":"ж","Ј":"Ј","҂":"҂","ҽ":"ҽ","№":"№","ҥ":"ҥ","Ѱ":"Ѱ","Ҵ":"Ҵ","Ѭ":"Ѭ","њ":"њ","Ѥ":"Ѥ","ѕ":"ѕ","ӕ":"ӕ","Ъ":"Ъ","Ҁ":"Ҁ","Ҏ":"Ҏ","Ә":"Ә","ҭ":"ҭ","Ҕ":"Ҕ","ҩ":"ҩ","һ":"һ","Ш":"Ш","у":"у","ҟ":"ҟ","т":"т","Ы":"Ы","с":"с","р":"р","Ѿ":"Ѿ","ѧ":"ѧ","Ӈ":"Ӈ","Ь":"Ь","ҕ":"ҕ","п":"п","ӡ":"ӡ","о":"о","Ћ":"Ћ","н":"н","Ҫ":"Ҫ","ұ":"ұ","ѱ":"ѱ","з":"з","ү":"ү","̏":"̏","ј":"ј","в":"в","ҹ":"ҹ","ӄ":"ӄ","е":"е","ѡ":"ѡ","д":"д","ц":"ц","б":"б","Ө":"Ө","ґ":"ґ","Љ":"Љ","а":"а","Ѽ":"Ѽ","Ғ":"Ғ","Ҹ":"Ҹ","м":"м","л":"л","ш":"ш","к":"к","и":"и","х":"х","Ҳ":"Ҳ","Ѵ":"Ѵ","Ӡ":"Ӡ","қ":"қ","г":"г","Ч":"Ч","ф":"ф","Ї":"Ї","҉":"҉","Ѯ":"Ѯ","Ѻ":"Ѻ","ѿ":"ѿ","ҵ":"ҵ","ҳ":"ҳ","ў":"ў","ѩ":"ѩ","Я":"Я","љ":"љ","ө":"ө","Қ":"Қ","ъ":"ъ","ҏ":"ҏ","ҁ":"ҁ","Ђ":"Ђ","ѭ":"ѭ","҈":"҈","Ӏ":"Ӏ","Ҝ":"Ҝ","ѻ":"ѻ","ь":"ь","ҿ":"ҿ","җ":"җ","э":"э","Ѧ":"Ѧ","Ҡ":"Ҡ","ы":"ы","Э":"Э","ӈ":"ӈ","ҫ":"ҫ","ч":"ч","ћ":"ћ","Ҧ":"Ҧ","Ё":"Ё","Ю":"Ю","Ѹ":"Ѹ","ќ":"ќ","ѓ":"ѓ","Ќ":"Ќ","Ѓ":"Ѓ"},e.isCyrillicCharacter=function(t){return e.cyrillicCharacters.hasOwnProperty(t)},e.translateCharToCyrillic=function(t){return e.isCyrillicCharacter(t)?e.cyrillicCharacters[t]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.spaceCmds1arg={kern:!0,hskip:!0,hspace:!0,hphantom:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diacriticsTextMode={"`":!0,"'":!0,"^":!0,"~":!0,"=":!0,".":!0,'"':!0,H:!0,c:!0,k:!0,b:!0,d:!0,r:!0,u:!0,v:!0},e.diacriticsMathMode={hat:!0,widehat:!0,check:!0,tilde:!0,widetilde:!0,acute:!0,grave:!0,dot:!0,ddot:!0,breve:!0,bar:!0,vec:!0,mathring:!0}},function(t,e,n){"use strict";function i(t){var e=t?t.trim():void 0;if(!e)return"√";switch(e){case"2":return"√";case"3":return"∛";case"4":return"∜";default:for(var n=[],i=0;i<e.length;i++){var r=a.translateCharToSuperscript(e.charAt(i));if(!r)throw new Error('Could not translate "'+r+'" to superscript');n.push(r)}return n.join("")+"√"}}function r(t,e){var n=i(e),r=t.trim();return""===r?n:n+"("+r+")"}Object.defineProperty(e,"__esModule",{value:!0});var a=n(50);e.convertSqrtToUnicode=r},function(t,e,n){"use strict";function i(t,e,n){switch(t){case"frac":case"nfrac":case"cfrac":case"xfrac":case"sfrac":return r.convertFracToUnicode(e,n);case"binom":return a.convertBinom(e,n)}throw new Error("No implementation found to expand \\"+t+" with arguments {"+e+", "+n)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(130),a=n(131);e.expand2argsCommand=i},function(t,e,n){"use strict";function i(t,e){return"1"===t&&"2"===e?"½":"1"===t&&"3"===e?"⅓":"1"===t&&"4"===e?"¼":"1"===t&&"5"===e?"⅕":"1"===t&&"6"===e?"⅙":"1"===t&&"8"===e?"⅛":"2"===t&&"3"===e?"⅔":"2"===t&&"5"===e?"⅖":"3"===t&&"4"===e?"¾":"3"===t&&"5"===e?"⅗":"3"===t&&"8"===e?"⅜":"4"===t&&"5"===e?"⅘":"5"===t&&"6"===e?"⅚":"5"===t&&"8"===e?"⅝":"7"===t&&"8"===e?"⅞":o.test(t)&&o.test(e)?a+t+"⁄"+e+a:(t=r.isSingleTerm.test(t)?t:r.addParenthesis(t),e=r.isSingleTerm.test(e)?e:r.addParenthesis(e),"("+t+" / "+e+")")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(13),a="‌",o=/^[0-9]*$/;e.convertFracToUnicode=i},function(t,e,n){"use strict";function i(t,e){return t=a.test(t)?t:r.addParenthesis(t),e=a.test(e)?e:r.addParenthesis(e),"("+t+" ¦ "+e+")"}Object.defineProperty(e,"__esModule",{value:!0});var r=n(13),a=/^.$|^[0-9]+$/;e.convertBinom=i},function(t,e,n){"use strict";function i(t){return e.twoArgsCommands.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(133);e.twoArgsCommands=Object.assign({},r.fracCmds,{binom:!0}),e.is2argsCommand=i},function(t,e,n){"use strict";function i(t){return e.fracCmds.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.fracCmds={frac:!0,nfrac:!0,cfrac:!0,xfrac:!0,sfrac:!0},e.isFracCmd=i},function(t,e,n){"use strict";function i(t){return{name:t,optionalArguments:0,argumentCount:0}}Object.defineProperty(e,"__esModule",{value:!0}),e.createKnownCommand=i},function(t,e,n){"use strict";function i(t){return{name:t,optionalArguments:0,argumentCount:1}}Object.defineProperty(e,"__esModule",{value:!0}),e.createKnownCommandWith1Arg=i},function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return r});var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"toolForm"},[n("div",{staticClass:"toolFormTitle"},[t._v("\n        Citations\n        "),t.viewRender?n("button",{staticClass:"btn btn-sm btn-secondary citations-to-bibtex",attrs:{type:"button",title:"Show all in BibTeX format."},on:{click:t.toggleViewRender}},[n("i",{staticClass:"fa fa-pencil-square-o"}),t._v("\n            Show BibTeX\n        ")]):n("button",{staticClass:"btn btn-sm btn-secondary citations-to-formatted",attrs:{type:"button",title:"Return to formatted citation list."},on:{click:t.toggleViewRender}},[n("i",{staticClass:"fa fa-times"}),t._v("\n            Hide BibTeX\n        ")])]),t._v(" "),n("div",{staticClass:"citations-bibtex toolFormBody citation-padding"},["histories"===t.source?n("div",{staticClass:"infomessage"},[t._v("\n            When writing up your analysis, remember to include all references that should be cited in order\n            to completely describe your work. Also, please remember to "),n("a",{attrs:{href:"https://galaxyproject.org/citing-galaxy"}},[t._v("cite Galaxy")]),t._v(".\n        ")]):t._e(),t._v(" "),t.viewRender?n("span",{staticClass:"citations-formatted"},[n("p",{domProps:{innerHTML:t._s(t.formattedReferences)}})]):n("textarea",{staticClass:"citations-bibtex-text"},[t._v("            "+t._s(t.content)+"\n        ")])])])},r=[]},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(15),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(138),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=r.default.GenomeDataManager.extend({load_data:function(e,n,i,r){var a=t.Deferred();this.set_data(e,a);var s=Galaxy.root+"datasets/"+this.get("dataset").id+"/display",l=this;new t.Deferred;return t.when(o.makeBwg(s)).then(function(n,i){t.when(n.readWigData(e.get("chrom"),e.get("start"),e.get("end"))).then(function(t){var n=[],i={max:Number.MIN_VALUE};t.forEach(function(t){i.max!==t.min-1&&(n.push([i.max+1,0]),n.push([t.min-2,0])),n.push([t.min-1,t.score]),n.push([t.max,t.score]),i=t});var r={data:n,region:e,dataset_type:"bigwig"};l.set_data(e,r),a.resolve(r)})}),a}});e.default={BBIDataManager:s}}).call(e,n(0))},function(t,e,n){(function(i){var r,a;r=[n(139),n(140),n(141)],void 0!==(a=function(t,e){"use strict";function n(){}function r(t){t&&(this.id=t)}function a(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function o(t,e,n){Math.pow(10,6);return i.ajax({type:"GET",dataType:"native",url:t,timeout:5e3,beforeSend:function(t){t.setRequestHeader("Range","bytes="+e+"-"+(e+(n-1)))},xhrFields:{responseType:"arraybuffer"}})}function s(t,e){return t[e]+t[e+1]*w+t[e+2]*x+t[e+3]*k+t[e+4]*M}function l(){}function c(t,e,n,i){this.bwg=t,this.cirTreeOffset=e,this.cirTreeLength=n,this.isSummary=i}function d(t){var e=i.Deferred(),n=new l;return n.url=t,i.when(o(n.url,0,512)).then(function(t){if(!t)return e.resolve(null,"Couldn't fetch file");var r=t,a=new Uint8Array(r),o=new Int16Array(r),l=new Int32Array(r),c=a[0]+w*a[1]+x*a[2]+k*a[3];if(c==m)n.type="bigwig";else{if(c!=y)return c==v||c==b?e.resolve(null,"Currently don't support big-endian BBI files"):e.resolve(null,"Not a supported format, magic=0x"+c.toString(16));n.type="bigbed"}n.version=o[2],n.numZoomLevels=o[3],n.chromTreeOffset=s(a,8),n.unzoomedDataOffset=s(a,16),n.unzoomedIndexOffset=s(a,24),n.fieldCount=o[16],n.definedFieldCount=o[17],n.asOffset=s(a,36),n.totalSummaryOffset=s(a,44),n.uncompressBufSize=l[13],n.extHeaderOffset=s(a,56),n.zoomLevels=[];for(var d=0;d<n.numZoomLevels;++d){var u=l[6*d+16],h=s(a,24*d+72),f=s(a,24*d+80);n.zoomLevels.push({reduction:u,dataOffset:h,indexOffset:f})}i.when(n.readChromTree()).then(function(){n.getAutoSQL(function(t){return n.schema=t,e.resolve(n)})})}),e}function u(t,e,n,i,r){this.bbi=t,this.type=e,this.fieldCount=n,this.offset=i,this.field=r}var h=t.Range,f=t.union,p=t.intersection,_=e.inflateBuffer,g=e.arrayCopy,m=2291137574,v=654086024,y=2273964779,b=3958540679,w=256,x=65536,k=16777216,M=4294967296,C=new RegExp("^[0-9]+,[0-9]+,[0-9]+");return l.prototype.readChromTree=function(){var t=this;this.chromsToIDs={},this.idsToChroms={},this.maxID=0;var e=this.unzoomedDataOffset;return e=e+4-(e-this.chromTreeOffset&3),i.when(o(this.url,this.chromTreeOffset,e-this.chromTreeOffset)).then(function(e){var n=new Uint8Array(e),i=new Int16Array(e),r=new Int32Array(e),a=(r[0],r[1],r[2]),o=(r[3],s(n,16),function(e){var r=n[e],l=i[e/2+1];e+=4;for(var c=0;c<l;++c)if(0===r){e+=a;var d=s(n,e);e+=8,d-=t.chromTreeOffset,o(d)}else{for(var u="",h=0;h<a;++h){var f=n[e++];0!==f&&(u+=String.fromCharCode(f))}var p=n[e+3]<<24|n[e+2]<<16|n[e+1]<<8|n[e+0];n[e+7],n[e+6],n[e+5],n[e+4],e+=8,t.chromsToIDs[u]=p,0===u.indexOf("chr")&&(t.chromsToIDs[u.substr(3)]=p),t.idsToChroms[p]=u,t.maxID=Math.max(t.maxID,p)}});o(32)})},c.prototype.readWigData=function(t,e,n){var i=this.bwg.chromsToIDs[t];return void 0===i?[]:this.readWigDataById(i,e,n)},c.prototype.readWigDataById=function(t,e,n){var r=this,a=i.Deferred();if(!this.cirHeader)return i.when(o(r.bwg.url,this.cirTreeOffset,48)).then(function(o){r.cirHeader=o;var s=new Int32Array(r.cirHeader);r.cirBlockSize=s[1],i.when(r.readWigDataById(t,e,n)).then(function(t){a.resolve(t)})}),a;var l=[],c=0,d=(Date.now(),function(i,r,a,o){return(t<0||i==t)&&r<=n&&a>=e}),u=function(t,e){if(r.bwg.instrument&&console.log("level="+e+"; offset="+t+"; time="+(0|Date.now())),c+=t.length,1==t.length&&t[0]-r.cirTreeOffset==48&&r.cachedCirRoot)return _(r.cachedCirRoot,0,e),void(0===--c&&i.when(r.fetchFeatures(d,l)).then(function(t){a.resolve(t)}));for(var n,o=4+32*r.cirBlockSize,s=0;s<t.length;++s){var u=new h(t[s],t[s]+o);n=n?f(n,u):u}for(var g=n.ranges(),m=0;m<g.length;++m){var v=g[m];p(t,v,e)}},p=function(t,e,n,s){e.max(),e.min();i.when(o(r.bwg.url,e.min(),e.max()-e.min())).then(function(o){for(var s=0;s<t.length;++s)e.contains(t[s])&&(_(o,t[s]-e.min(),n),t[s]-r.cirTreeOffset==48&&t[s]-e.min()==0&&(r.cachedCirRoot=o),0===--c&&i.when(r.fetchFeatures(d,l)).then(function(t){a.resolve(t)}))})},_=function(i,r,a){var o=new Uint8Array(i),c=new Int16Array(i),d=new Int32Array(i),h=o[r],f=c[r/2+1];if(r+=4,0!==h)for(var p=0;p<f;++p){var _=r/4,g=d[_],m=d[_+1],v=d[_+2],y=d[_+3],b=s(o,r+16),w=s(o,r+24);(t<0||g<t||g==t&&m<=n)&&(t<0||v>t||v==t&&y>=e)&&l.push({offset:b,size:w}),r+=32}else{for(var x=[],p=0;p<f;++p){var _=r/4,g=d[_],m=d[_+1],v=d[_+2],y=d[_+3],b=s(o,r+16);(t<0||g<t||g==t&&m<=n)&&(t<0||v>t||v==t&&y>=e)&&x.push(b),r+=24}x.length>0&&u(x,a+1)}};return u([r.cirTreeOffset+48],1),a},c.prototype.fetchFeatures=function(t,e){var r=this,a=i.Deferred();if(e.sort(function(t,e){return(0|t.offset)-(0|e.offset)}),0===e.length)return[];var s=[],l=function(t,e,i,a){a||(a={});var o=new n;o._chromId=t,o.segment=r.bwg.idsToChroms[t],o.min=e,o.max=i,o.type=r.bwg.type;for(var l in a)o[l]=a[l];s.push(o)},c=function(){if(0===e.length){Date.now();return a.resolve(s)}var n=e[0];if(n.data)r.parseFeatures(n.data,l,t),e.splice(0,1),c();else{for(var d=n.offset,u=n.size,h=1;h<e.length&&e[h].offset==d+u;)u+=e[h].size,++h;i.when(o(r.bwg.url,d,u)).then(function(t){for(var n=0,i=0;n<u;){var a,o=e[i];if(r.bwg.uncompressBufSize>0)a=_(t,n+2,o.size-2);else{var s=new Uint8Array(o.size);g(new Uint8Array(t,n,o.size),0,s,0,o.size),a=s.buffer}o.data=a,n+=o.size,++i}c()})}};return c(),a},c.prototype.parseFeatures=function(t,e,n){var a=new Uint8Array(t);if(this.isSummary)for(var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),c=t.byteLength/32,d=0;d<c;++d){var u=s[8*d],_=s[8*d+1],g=s[8*d+2],m=s[8*d+3],v=(l[8*d+4],l[8*d+5]),y=l[8*d+6];l[8*d+7];if(n(u,_+1,g)){var b={type:"bigwig",score:y/m,maxScore:v};"bigbed"==this.bwg.type&&(b.type="density"),e(u,_+1,g,b)}}else if("bigwig"==this.bwg.type){var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),u=s[0],w=s[1],x=(s[2],s[3]),k=s[4],M=a[20],c=o[11];if(3==M)for(var d=0;d<c;++d){var S=l[d+6],T=w+d*x+1,A=w+d*x+k;n(u,T,A)&&e(u,T,A,{score:S})}else if(2==M)for(var d=0;d<c;++d){var _=s[2*d+6]+1,g=_+k-1,S=l[2*d+7];n(u,_,g)&&e(u,_,g,{score:S})}else if(1==M)for(var d=0;d<c;++d){var _=s[3*d+6]+1,g=s[3*d+7],S=l[3*d+8];_>g&&(_=g),n(u,_,g)&&e(u,_,g,{score:S})}else console.log("Currently not handling bwgType="+M)}else{if("bigbed"!=this.bwg.type)throw Error("Don't know what to do with "+this.bwg.type);for(var j=0,E=this.bwg.definedFieldCount,O=this.bwg.schema;j<a.length;){var u=a[j+3]<<24|a[j+2]<<16|a[j+1]<<8|a[j+0],_=a[j+7]<<24|a[j+6]<<16|a[j+5]<<8|a[j+4],g=a[j+11]<<24|a[j+10]<<16|a[j+9]<<8|a[j+8];j+=12;for(var L="";;){var N=a[j++];if(0==N)break;L+=String.fromCharCode(N)}var I,P={};if(I=L.length>0?L.split("\t"):[],I.length>0&&E>3&&(P.label=I[0]),I.length>1&&E>4){var S=parseInt(I[1]);isNaN(S)||(P.score=S)}if(I.length>2&&E>5&&(P.orientation=I[2]),I.length>5&&E>8){var D=I[5];C.test(D)&&(P.itemRgb="rgb("+D+")")}if(I.length>E-3&&O)for(var R=E-3;R<I.length;++R)P[O.fields[R+3].name]=I[R];if(n(u,_+1,g,I))if(E<12)e(u,_+1,g,P);else{var z=0|I[3],$=0|I[4],W=0|I[6],G=I[7].split(","),V=I[8].split(",");if(P.exonFrames){var H=P.exonFrames.split(",");P.exonFrames=void 0}P.type="transcript";var F=new r;for(var Y in P)F[Y]=P[Y];if(F.id=I[0],F.segment=this.bwg.idsToChroms[u],F.min=_+1,F.max=g,F.notes=[],P.groups=[F],I.length>9){var q=P.geneName||I[9],U=q;I.length>10&&(U=I[10]),P.geneName2&&(U=P.geneName2);var B=i.extend({},F);B.id=q,B.label=U,B.type="gene",P.groups.push(B)}for(var X=[],J=0;J<W;++J){var Q=(0|V[J])+_,K=Q+(0|G[J]),Z=new h(Q,K);X.push(Z)}for(var tt=f(X),et=tt.ranges(),nt=0;nt<et.length;++nt){var it=et[nt];e(u,it.min()+1,it.max(),P)}if($>z){var rt="+"==P.orientation?new h(z,$+3):new h(z-3,$),at=p(tt,rt);if(at){P.type="translation";for(var ot=at.ranges(),st=0,lt=0;ot[0].min()>et[lt].max();)lt++;for(var nt=0;nt<ot.length;++nt){var ct=nt;"-"==P.orientation&&(ct=ot.length-nt-1);var it=ot[ct];if(P.readframe=st,H){var dt=parseInt(H[ct+lt]);"number"==typeof dt&&dt>=0&&dt<=2&&(P.readframe=dt,P.readframeExplicit=!0)}var ut=it.max()-it.min();st=(st+ut)%3,e(u,it.min()+1,it.max(),P)}}}}}}},c.prototype.getFirstAdjacent=function(t,e,n,i){var r=this.bwg.chromsToIDs[t];if(void 0===r)return i([]);this.getFirstAdjacentById(r,e,n,i)},c.prototype.getFirstAdjacentById=function(t,e,n,i){var r=this;if(!this.cirHeader)return void this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(a){r.cirHeader=a;var o=new Int32Array(r.cirHeader);r.cirBlockSize=o[1],r.getFirstAdjacentById(t,e,n,i)});var a=null,o=-1,l=-1,c=0,d=(Date.now(),function(t,e){c+=t.length;for(var n,i=4+32*r.cirBlockSize,a=0;a<t.length;++a){var o=new h(t[a],t[a]+i);n=n?f(n,o):o}for(var s=n.ranges(),l=0;l<s.length;++l){var d=s[l];u(t,d,e)}}),u=function(o,s,l,d){s.max(),s.min();r.bwg.data.slice(s.min(),s.max()-s.min()).fetch(function(d){for(var u=0;u<o.length;++u)if(s.contains(o[u])&&(p(d,o[u]-s.min(),l),0==--c)){if(!a)return n>0&&(0!=t||e>0)?r.getFirstAdjacentById(0,0,n,i):n<0&&(t!=r.bwg.maxID||e<1e9)?r.getFirstAdjacentById(r.bwg.maxID,1e9,n,i):i([]);r.fetchFeatures(function(i,r,a,o){return n<0&&(i<t||a<e)||n>0&&(i>t||r>e)},[a],function(t){for(var e=null,r=-1,a=-1,o=0;o<t.length;++o){var s=t[o],l=s._chromId,c=s.min,d=s.max;(null==e||n<0&&(l>r||d>a)||n>0&&(l<r||c<a))&&(e=s,a=n<0?d:c,r=l)}return i(null!=e?[e]:[])})}})},p=function(i,c,u){var h=new Uint8Array(i),f=new Int16Array(i),p=new Int32Array(i),_=h[c],g=f[c/2+1];if(c+=4,0!=_)for(var m=0;m<g;++m){var v=c/4,y=p[v],b=p[v+1],w=p[v+2],x=p[v+3],k=s(h,c+16),M=s(h,c+24);(n<0&&(y<t||y==t&&b<=e)||n>0&&(w>t||w==t&&x>=e))&&(/_random/.exec(r.bwg.idsToChroms[y])||(null==a||n<0&&(w>o||w==o&&x>l)||n>0&&(y<o||y==o&&b<l))&&(a={offset:k,size:M},l=n<0?x:b,o=n<0?w:y)),c+=32}else{for(var C=-1,S=-1,m=0;m<g;++m){var v=c/4,y=p[v],b=p[v+1],w=p[v+2],x=p[v+3],k=p[v+4]<<32|p[v+5];(n<0&&(y<t||y==t&&b<=e)&&w>=t||n>0&&(w>t||w==t&&x>=e)&&y<=t)&&(C<0||x>S)&&(C=k,S=n<0?x:b,n<0?w:y),c+=24}C>=0&&d([C],u+1)}};d([r.cirTreeOffset+48],1)},l.prototype.readWigData=function(t,e,n){var i,r=n-e;if(r<=25e3||0===this.zoomLevels.length)i=this.getUnzoomedView();else for(var a=0;a<this.zoomLevels.length;a++)if(r/this.zoomLevels[a].reduction<25e3){i=this.getZoomedView(a);break}return i.readWigData(t,e,n)},l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var t=4e3;this.zoomLevels[0]&&(t=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset),this.unzoomedView=new c(this,this.unzoomedIndexOffset,t,!1)}return this.unzoomedView},l.prototype.getZoomedView=function(t){var e=this.zoomLevels[t];return e.view||(e.view=new c(this,e.indexOffset,4e3,!0)),e.view},l.prototype._tsFetch=function(t,e,n,i,r){var a=this;if(!(t>=this.zoomLevels.length-1)){var o;return o=t<0?this.getUnzoomedView():this.getZoomedView(t),o.readWigDataById(e,n,i,r)}if(this.topLevelReductionCache){for(var s=[],l=this.topLevelReductionCache,c=0;c<l.length;++c)l[c]._chromId==e&&s.push(l[c]);return r(s)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3e8,function(o){return a.topLevelReductionCache=o,a._tsFetch(t,e,n,i,r)})},l.prototype.thresholdSearch=function(t,e,n,i,r){function a(){if(0==l.length)return r(null);l.sort(function(t,e){var i=t.zoom-e.zoom;return 0!=i?i:(i=t.chrOrd-e.chrOrd,0!=i?i:t.min-e.min*n)});var t=l.splice(0,1)[0];o._tsFetch(t.zoom,t.chr,t.min,t.max,function(o){var s=n>0?0:3e8;t.fromRef&&(s=e);for(var c=0;c<o.length;++c){var d,u=o[c];if(d=void 0!=u.maxScore?u.maxScore:u.score,n>0){if(d>i)if(t.zoom<0){if(u.min>s)return r(u)}else u.max>s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:u.min,max:u.max,fromRef:t.fromRef})}else if(d>i)if(t.zoom<0){if(u.max<s)return r(u)}else u.min<s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:u.min,max:u.max,fromRef:t.fromRef})}a()})}n=n<0?-1:1;for(var o=this,s=this.chromsToIDs[t],l=[{chrOrd:0,chr:s,zoom:o.zoomLevels.length-4,min:0,max:3e8,fromRef:!0}],c=1;c<=this.maxID+1;++c){var d=(s+n*c)%(this.maxID+1);d<0&&(d+=this.maxID+1),l.push({chrOrd:c,chr:d,zoom:o.zoomLevels.length-1,min:0,max:3e8})}a()},l.prototype.getAutoSQL=function(t){if(!this.asOffset)return t(null);i.when(o(this.url,this.asOffset,2048)).then(function(e){for(var n=new Uint8Array(e),i="",r=0;r<n.length&&0!=n[r];++r)i+=String.fromCharCode(n[r]);var a=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/,o=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,s=a.exec(i);if(s){var l={declType:s[1],name:s[2],comment:s[4],fields:[]};i=i.substring(s[0]);for(var c=o.exec(i);null!=c;c=o.exec(i))l.fields.push({type:c[1],name:c[2],comment:c[4]});return t(l)}})},l.prototype.getExtraIndices=function(t){var e=this;if(this.version<4||0==this.extHeaderOffset||"bigbed"!=this.type)return t(null);this.data.slice(this.extHeaderOffset,64).fetch(function(n){if(!n)return t(null,"Couldn't fetch extension header");var i=new Uint8Array(n),r=new Int16Array(n),a=(new Int32Array(n),r[0],r[1]),o=s(i,4);if(0==a)return t(null);e.data.slice(o,20*a).fetch(function(n){if(!n)return t(null,"Couldn't fetch index info");for(var i=new Uint8Array(n),r=new Int16Array(n),o=(new Int32Array(n),[]),l=0;l<a;++l){var c=r[10*l],d=r[10*l+1],h=s(i,20*l+4),f=r[10*l+8],p=new u(e,c,d,h,f);o.push(p)}t(o)})})},u.prototype.lookup=function(t,e){var n=this;this.bbi.data.slice(this.offset,32).fetch(function(i){function r(i){n.bbi.data.slice(i,4+c*(d+u)).fetch(function(i){var o=new Uint8Array(i),l=new Uint16Array(i),c=(new Uint32Array(i),o[0]),h=l[1],f=4;if(0!=c){for(var p=0;p<h;++p){for(var _="",g=0;g<d;++g){var m=o[f++];0!=m&&(_+=String.fromCharCode(m))}if(_==t){var v=s(o,f),y=a(o,f+8);return n.bbi.getUnzoomedView().fetchFeatures(function(e,i,r,a){if(a&&a.length>n.field-3)return a[n.field-3]==t},[{offset:v,size:y}],e)}f+=u}return e([])}for(var b=null,p=0;p<h;++p){for(var _="",g=0;g<d;++g){var m=o[f++];0!=m&&(_+=String.fromCharCode(m))}var w=s(o,f);if(f+=8,t.localeCompare(_)<0&&b)return void r(b);b=w}r(b)})}var o=new Uint8Array(i),l=(new Int16Array(i),new Int32Array(i)),c=(l[0],l[1]),d=l[2],u=l[3];s(o,16);r(n.offset+32)})},{makeBwg:d}}.apply(e,r))&&(t.exports=a)}).call(e,n(0))},function(t,e,n){var i,r;i=[],void 0!==(r=function(){"use strict";function t(t,e){if("number"!=typeof t||"number"!=typeof e)throw"Bad range "+t+","+e;this._min=t,this._max=e}function e(t){var e=t.sort(o),n=[],i=e.shift();e.forEach(function(t){t._min<=i._max?t._max>i._max&&(i._max=t._max):(n.push(i),i=t)}),n.push(i),this._ranges=n}function n(t,n){return t instanceof e||(t instanceof Array||(t=[t]),t=new e(t)),n&&t.insertRange(n),t}function i(n,i){for(var r=n.ranges(),a=i.ranges(),o=r.length,s=a.length,l=0,c=0,d=[];l<o&&c<s;){var n=r[l],i=a[c],u=Math.max(n.min(),i.min()),h=Math.min(n.max(),i.max());h>=u&&d.push(new t(u,h)),n.max()>i.max()?++c:++l}return 0==d.length?null:1==d.length?d[0]:new e(d)}function r(t){for(var e=0,n=t.ranges(),i=0;i<n.length;++i){var r=n[i];e+=r.max()-r.min()+1}return e}function a(t,e){return t.min()<e.min()?-1:t.min()>e.min()?1:t.max()<e.max()?-1:e.max()>t.max()?1:0}function o(t,e){return t._min<e._min?-1:t._min>e._min?1:t._max<e._max?-1:e._max>t._max?1:0}return t.prototype.min=function(){return this._min},t.prototype.max=function(){return this._max},t.prototype.contains=function(t){return t>=this._min&&t<=this._max},t.prototype.isContiguous=function(){return!0},t.prototype.ranges=function(){return[this]},t.prototype._pushRanges=function(t){t.push(this)},t.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"},e.prototype.min=function(){return this._ranges[0].min()},e.prototype.max=function(){return this._ranges[this._ranges.length-1].max()},e.prototype.lower_bound=function(t){var e=this.ranges();if(t>this.max())return e.length;if(t<this.min())return 0;for(var n=0,i=e.length-1;n<=i;){var r=Math.floor((n+i)/2);if(t>e[r]._max)n=r+1;else{if(!(t<e[r]._min))return r;i=r-1}}return n},e.prototype.contains=function(t){var e=this.lower_bound(t);return!!(e<this._ranges.length&&this._ranges[e].contains(t))},e.prototype.insertRange=function(t){var e=this.lower_bound(t._min);if(e===this._ranges.length)return void this._ranges.push(t);var n=this.ranges();if(t._max<n[e]._min)return void this._ranges.splice(e,0,t);n[e]._min<t._min&&(t._min=n[e]._min);for(var i=e+1;i<n.length&&n[i]._min<=t._max;)i++;i--,n[i]._max>t._max&&(t._max=n[i]._max),this._ranges.splice(e,i-e+1,t)},e.prototype.isContiguous=function(){return this._ranges.length>1},e.prototype.ranges=function(){return this._ranges},e.prototype._pushRanges=function(t){for(var e=0;e<this._ranges.length;++e)t.push(this._ranges[e])},e.prototype.toString=function(){for(var t="",e=0;e<this._ranges.length;++e)e>0&&(t+=","),t+=this._ranges[e].toString();return t},{Range:t,union:n,intersection:i,coverage:r,rangeOver:a,_rangeOrder:o}}.apply(e,i))&&(t.exports=r)},function(t,e,n){var i,r;i=[],void 0!==(r=function(){function t(){}function e(){this.was=[0]}function n(t,e,n){this.hufts=new Int32Array(3*u),this.window=new Uint8Array(n),this.end=n,this.checkfn=e,this.mode=m,this.reset(t,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new i,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new r}function i(){}function r(){}function a(t,e,n,i,r){return t[0]=v,e[0]=y,n[0]=b,i[0]=w,f}function o(t,e,n,i,r){if(0!=r){if(!t)throw"Undef src";if(!n)throw"Undef dest";0==e&&r==t.length?l(t,n,i):j?l(t.subarray(e,e+r),n,i):1==t.BYTES_PER_ELEMENT&&r>100?l(new Uint8Array(t.buffer,t.byteOffset+e,r),n,i):s(t,e,n,i,r)}}function s(t,e,n,i,r){for(var a=0;a<r;++a)n[i+a]=t[e+a]}function l(t,e,n){e.set(t,n)}function c(e,n,i,r){e=n?i?new Uint8Array(e,n,i):new Uint8Array(e,n,e.byteLength-n):new Uint8Array(e);var a=new t;a.inflateInit(d,!0),a.next_in=e,a.next_in_index=0,a.avail_in=e.length;for(var s=[],l=0;;){var c=new Uint8Array(32e3);a.next_out=c,a.next_out_index=0,a.avail_out=c.length;var u=a.inflate(h);if(u!=f&&u!=p&&u!=_)throw a.msg;if(0!=a.avail_out){var g=new Uint8Array(c.length-a.avail_out);o(c,0,g,0,c.length-a.avail_out),c=g}if(s.push(c),l+=c.length,u==p||u==_)break}if(r&&(r[0]=(n||0)+a.next_in_index),1==s.length)return s[0].buffer;for(var m=new Uint8Array(l),v=0,y=0;y<s.length;++y){var b=s[y];o(b,0,m,v,b.length),v+=b.length}return m.buffer}var d=15,u=1440,h=0,f=0,p=1,_=-5,g=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],m=0,v=9,y=5,b=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],w=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],M=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];t.prototype.inflateInit=function(t,n){return t||(t=d),n&&(n=!1),this.istate=new e,this.istate.inflateInit(this,n?-t:t)},t.prototype.inflate=function(t){return null==this.istate?-2:this.istate.inflate(this,t)},t.prototype.inflateEnd=function(){if(null==this.istate)return-2;var t=istate.inflateEnd(this);return this.istate=null,t},t.prototype.inflateSync=function(){return istate.inflateSync(this)},t.prototype.inflateSetDictionary=function(t,e){return istate.inflateSetDictionary(this,t,e)},e.prototype.inflateReset=function(t){return null==t||null==t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=0!=t.istate.nowrap?7:0,t.istate.blocks.reset(t,null),f)},e.prototype.inflateEnd=function(t){return null!=this.blocks&&this.blocks.free(t),this.blocks=null,f},e.prototype.inflateInit=function(t,e){return t.msg=null,this.blocks=null,nowrap=0,e<0&&(e=-e,nowrap=1),e<8||e>15?(this.inflateEnd(t),-2):(this.wbits=e,t.istate.blocks=new n(t,0!=t.istate.nowrap?null:this,1<<e),this.inflateReset(t),f)},e.prototype.inflate=function(t,e){var n,i;if(null==t||null==t.istate||null==t.next_in)return-2;for(e=4==e?_:f,n=_;;)switch(t.istate.mode){case 0:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,8!=(15&(t.istate.method=t.next_in[t.next_in_index++]))){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,i=255&t.next_in[t.next_in_index++],((t.istate.method<<8)+i)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if(0==(32&i)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=3;case 3:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=4;case 4:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=5;case 5:return 0==t.avail_in?n:(n=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.adler=t.istate.need,t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if(-3==(n=t.istate.blocks.proc(t,n))){t.istate.mode=13,t.istate.marker=0;break}if(n==f&&(n=e),n!=p)return n;if(n=e,t.istate.blocks.reset(t,t.istate.was),0!=t.istate.nowrap){t.istate.mode=12;break}t.istate.mode=8;case 8:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=9;case 9:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=10;case 10:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=11;case 11:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.istate.was[0]!=t.istate.need){t.istate.mode=13,t.msg="incorrect data check",t.istate.marker=5;break}t.istate.mode=12;case 12:return p;case 13:return-3;default:return-2}},e.prototype.inflateSetDictionary=function(t,e,n){var i=0,r=n;return null==t||null==t.istate||6!=t.istate.mode?-2:t._adler.adler32(1,e,0,n)!=t.adler?-3:(t.adler=t._adler.adler32(0,null,0,0),r>=1<<t.istate.wbits&&(r=(1<<t.istate.wbits)-1,i=n-r),t.istate.blocks.set_dictionary(e,i,r),t.istate.mode=7,f)};var S=[0,0,255,255];e.prototype.inflateSync=function(t){var e,n,i,r,a;if(null==t||null==t.istate)return-2;if(13!=t.istate.mode&&(t.istate.mode=13,t.istate.marker=0),0==(e=t.avail_in))return _;for(n=t.next_in_index,i=t.istate.marker;0!=e&&i<4;)t.next_in[n]==S[i]?i++:i=0!=t.next_in[n]?0:4-i,n++,e--;return t.total_in+=n-t.next_in_index,t.next_in_index=n,t.avail_in=e,t.istate.marker=i,4!=i?-3:(r=t.total_in,a=t.total_out,this.inflateReset(t),t.total_in=r,t.total_out=a,t.istate.mode=7,f)},e.prototype.inflateSyncPoint=function(t){return null==t||null==t.istate||null==t.istate.blocks?-2:t.istate.blocks.sync_point()};var T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];n.prototype.reset=function(t,e){e&&(e[0]=this.check),6==this.mode&&this.codes.free(t),this.mode=m,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(t.adler=this.check=t._adler.adler32(0,null,0,0))},n.prototype.proc=function(t,e){var n,i,r,s,l,c,d;for(s=t.next_in_index,l=t.avail_in,i=this.bitb,r=this.bitk,c=this.write,d=c<this.read?this.read-c-1:this.end-c;;)switch(this.mode){case m:for(;r<3;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}switch(n=7&i,this.last=1&n,n>>>1){case 0:i>>>=3,r-=3,n=7&r,i>>>=n,r-=n,this.mode=1;break;case 1:var u=new Int32Array(1),h=new Int32Array(1),_=[],v=[];a(u,h,_,v,t),this.codes.init(u[0],h[0],_[0],0,v[0],0,t),i>>>=3,r-=3,this.mode=6;break;case 2:i>>>=3,r-=3,this.mode=3;break;case 3:return i>>>=3,r-=3,this.mode=13,t.msg="invalid block type",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e)}break;case 1:for(;r<32;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if((~i>>>16&65535)!=(65535&i))return this.mode=13,t.msg="invalid stored block lengths",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);this.left=65535&i,i=r=0,this.mode=0!=this.left?2:0!=this.last?7:m;break;case 2:if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=c,this.inflate_flush(t,e);if(0==d&&(c==end&&0!=read&&(c=0,d=c<this.read?this.read-c-1:this.end-c),0==d&&(this.write=c,e=this.inflate_flush(t,e),c=this.write,d=c<this.read?this.read-c-1:this.end-c,c==this.end&&0!=this.read&&(c=0,d=c<this.read?this.read-c-1:this.end-c),0==d)))return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);if(e=f,n=this.left,n>l&&(n=l),n>d&&(n=d),o(t.next_in,s,this.window,c,n),s+=n,l-=n,c+=n,d-=n,0!=(this.left-=n))break;this.mode=0!=this.last?7:m;break;case 3:for(;r<14;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(this.table=n=16383&i,(31&n)>29||(n>>5&31)>29)return this.mode=9,t.msg="too many length or distance symbols",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);if(n=258+(31&n)+(n>>5&31),null==this.blens||this.blens.length<n)this.blens=new Int32Array(n);else for(var y=0;y<n;y++)this.blens[y]=0;i>>>=14,r-=14,this.index=0,mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;r<3;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}this.blens[T[this.index++]]=7&i,i>>>=3,r-=3}for(;this.index<19;)this.blens[T[this.index++]]=0;if(this.bb[0]=7,(n=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,t))!=f)return e=n,-3==e&&(this.blens=null,this.mode=9),this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=c,this.inflate_flush(t,e);this.index=0,this.mode=5;case 5:for(;;){if(n=this.table,!(this.index<258+(31&n)+(n>>5&31)))break;var y,b,w;for(n=this.bb[0];r<n;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(n=this.hufts[3*(this.tb[0]+(i&g[n]))+1],(w=this.hufts[3*(this.tb[0]+(i&g[n]))+2])<16)i>>>=n,r-=n,this.blens[this.index++]=w;else{for(y=18==w?7:w-14,b=18==w?11:3;r<n+y;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(i>>>=n,r-=n,b+=i&g[y],i>>>=y,r-=y,y=this.index,n=this.table,y+b>258+(31&n)+(n>>5&31)||16==w&&y<1)return this.blens=null,this.mode=9,t.msg="invalid bit length repeat",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);w=16==w?this.blens[y-1]:0;do{this.blens[y++]=w}while(0!=--b);this.index=y}}this.tb[0]=-1;var u=new Int32Array(1),h=new Int32Array(1),_=new Int32Array(1),v=new Int32Array(1);if(u[0]=9,h[0]=6,n=this.table,(n=this.inftree.inflate_trees_dynamic(257+(31&n),1+(n>>5&31),this.blens,u,h,_,v,this.hufts,t))!=f)return-3==n&&(this.blens=null,this.mode=13),e=n,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);this.codes.init(u[0],h[0],this.hufts,_[0],this.hufts,v[0],t),this.mode=6;case 6:if(this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,(e=this.codes.proc(this,t,e))!=p)return this.inflate_flush(t,e);if(e=f,this.codes.free(t),s=t.next_in_index,l=t.avail_in,i=this.bitb,r=this.bitk,c=this.write,d=c<this.read?this.read-c-1:this.end-c,0==this.last){this.mode=m;break}this.mode=7;case 7:if(this.write=c,e=this.inflate_flush(t,e),c=this.write,d=c<this.read?this.read-c-1:this.end-c,this.read!=this.write)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);mode=12;case 8:return e=p,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);case 9:return e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);default:return e=-2,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e)}},n.prototype.free=function(t){this.reset(t,null),this.window=null,this.hufts=null},n.prototype.set_dictionary=function(t,e,n){o(t,e,window,0,n),this.read=this.write=n},n.prototype.sync_point=function(){return 1==this.mode},n.prototype.inflate_flush=function(t,e){var n,i,r;return i=t.next_out_index,r=this.read,n=(r<=this.write?this.write:this.end)-r,n>t.avail_out&&(n=t.avail_out),0!=n&&e==_&&(e=f),t.avail_out-=n,t.total_out+=n,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,r,n)),o(this.window,r,t.next_out,i,n),i+=n,r+=n,r==this.end&&(r=0,this.write==this.end&&(this.write=0),n=this.write-r,n>t.avail_out&&(n=t.avail_out),0!=n&&e==_&&(e=f),t.avail_out-=n,t.total_out+=n,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,r,n)),o(this.window,r,t.next_out,i,n),i+=n,r+=n),t.next_out_index=i,this.read=r,e};i.prototype.init=function(t,e,n,i,r,a,o){this.mode=0,this.lbits=t,this.dbits=e,this.ltree=n,this.ltree_index=i,this.dtree=r,this.dtree_index=a,this.tree=null},i.prototype.proc=function(t,e,n){var i,r,a,o,s,l,c,d=0,u=0,h=0;for(h=e.next_in_index,o=e.avail_in,d=t.bitb,u=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s;;)switch(this.mode){case 0:if(l>=258&&o>=10&&(t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,n=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,t,e),h=e.next_in_index,o=e.avail_in,d=t.bitb,u=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s,n!=f)){this.mode=n==p?7:9;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=1;case 1:for(i=this.need;u<i;){if(0==o)return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);n=f,o--,d|=(255&e.next_in[h++])<<u,u+=8}if(r=3*(this.tree_index+(d&g[i])),d>>>=this.tree[r+1],u-=this.tree[r+1],0==(a=this.tree[r])){this.lit=this.tree[r+2],this.mode=6;break}if(0!=(16&a)){this.get=15&a,this.len=this.tree[r+2],this.mode=2;break}if(0==(64&a)){this.need=a,this.tree_index=r/3+this.tree[r+2];break}if(0!=(32&a)){this.mode=7;break}return this.mode=9,e.msg="invalid literal/length code",n=-3,t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);case 2:for(i=this.get;u<i;){if(0==o)return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);n=f,o--,d|=(255&e.next_in[h++])<<u,u+=8}this.len+=d&g[i],d>>=i,u-=i,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=3;case 3:for(i=this.need;u<i;){if(0==o)return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);n=f,o--,d|=(255&e.next_in[h++])<<u,u+=8}if(r=3*(this.tree_index+(d&g[i])),d>>=this.tree[r+1],u-=this.tree[r+1],0!=(16&(a=this.tree[r]))){this.get=15&a,this.dist=this.tree[r+2],this.mode=4;break}if(0==(64&a)){this.need=a,this.tree_index=r/3+this.tree[r+2];break}return this.mode=9,e.msg="invalid distance code",n=-3,t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);case 4:for(i=this.get;u<i;){if(0==o)return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);n=f,o--,d|=(255&e.next_in[h++])<<u,u+=8}this.dist+=d&g[i],d>>=i,u-=i,this.mode=5;case 5:for(c=s-this.dist;c<0;)c+=t.end;for(;0!=this.len;){if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);t.window[s++]=t.window[c++],l--,c==t.end&&(c=0),this.len--}this.mode=0;break;case 6:if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);n=f,t.window[s++]=this.lit,l--,this.mode=0;break;case 7:if(u>7&&(u-=8,o++,h--),t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,t.read!=t.write)return t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);this.mode=8;case 8:return n=p,t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);case 9:return n=-3,t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n);default:return n=-2,t.bitb=d,t.bitk=u,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,n)}},i.prototype.free=function(t){},i.prototype.inflate_fast=function(t,e,n,i,r,a,s,l){var c,d,u,h,_,m,v,y,b,w,x,k,M,C,S,T;v=l.next_in_index,y=l.avail_in,_=s.bitb,m=s.bitk,b=s.write,w=b<s.read?s.read-b-1:s.end-b,x=g[t],k=g[e];do{for(;m<20;)y--,_|=(255&l.next_in[v++])<<m,m+=8;if(c=_&x,d=n,u=i,T=3*(u+c),0!=(h=d[T]))for(;;){if(_>>=d[T+1],m-=d[T+1],0!=(16&h)){for(h&=15,M=d[T+2]+(_&g[h]),_>>=h,m-=h;m<15;)y--,_|=(255&l.next_in[v++])<<m,m+=8;for(c=_&k,d=r,u=a,T=3*(u+c),h=d[T];;){if(_>>=d[T+1],m-=d[T+1],0!=(16&h)){for(h&=15;m<h;)y--,_|=(255&l.next_in[v++])<<m,m+=8;if(C=d[T+2]+(_&g[h]),_>>=h,m-=h,w-=M,b>=C)S=b-C,s.window[b++]=s.window[S++],s.window[b++]=s.window[S++],M-=2;else{S=b-C;do{S+=s.end}while(S<0);if(h=s.end-S,M>h){if(M-=h,b-S>0&&h>b-S)do{s.window[b++]=s.window[S++]}while(0!=--h);else o(s.window,S,s.window,b,h),b+=h,S+=h,h=0;S=0}}do{s.window[b++]=s.window[S++]}while(0!=--M);break}if(0!=(64&h))return l.msg="invalid distance code",M=l.avail_in-y,M=m>>3<M?m>>3:M,y+=M,v-=M,m-=M<<3,s.bitb=_,s.bitk=m,l.avail_in=y,l.total_in+=v-l.next_in_index,l.next_in_index=v,s.write=b,-3;c+=d[T+2],c+=_&g[h],T=3*(u+c),h=d[T]}break}if(0!=(64&h))return 0!=(32&h)?(M=l.avail_in-y,M=m>>3<M?m>>3:M,y+=M,v-=M,m-=M<<3,s.bitb=_,s.bitk=m,l.avail_in=y,l.total_in+=v-l.next_in_index,l.next_in_index=v,s.write=b,p):(l.msg="invalid literal/length code",M=l.avail_in-y,M=m>>3<M?m>>3:M,y+=M,v-=M,m-=M<<3,s.bitb=_,s.bitk=m,l.avail_in=y,l.total_in+=v-l.next_in_index,l.next_in_index=v,s.write=b,-3);if(c+=d[T+2],c+=_&g[h],T=3*(u+c),0==(h=d[T])){_>>=d[T+1],m-=d[T+1],s.window[b++]=d[T+2],w--;break}}else _>>=d[T+1],m-=d[T+1],s.window[b++]=d[T+2],w--}while(w>=258&&y>=10);return M=l.avail_in-y,M=m>>3<M?m>>3:M,y+=M,v-=M,m-=M<<3,s.bitb=_,s.bitk=m,l.avail_in=y,l.total_in+=v-l.next_in_index,l.next_in_index=v,s.write=b,f},r.prototype.huft_build=function(t,e,n,i,r,a,s,l,c,d,h){var p,g,m,v,y,b,w,x,k,M,C,S,T,A,j;M=0,y=n;do{this.c[t[e+M]]++,M++,y--}while(0!=y);if(this.c[0]==n)return s[0]=-1,l[0]=0,f;for(x=l[0],b=1;b<=15&&0==this.c[b];b++);for(w=b,x<b&&(x=b),y=15;0!=y&&0==this.c[y];y--);for(m=y,x>y&&(x=y),l[0]=x,A=1<<b;b<y;b++,A<<=1)if((A-=this.c[b])<0)return-3;if((A-=this.c[y])<0)return-3;for(this.c[y]+=A,this.x[1]=b=0,M=1,T=2;0!=--y;)this.x[T]=b+=this.c[M],T++,M++;y=0,M=0;do{0!=(b=t[e+M])&&(this.v[this.x[b]++]=y),M++}while(++y<n);for(n=this.x[m],this.x[0]=y=0,M=0,v=-1,S=-x,this.u[0]=0,C=0,j=0;w<=m;w++)for(p=this.c[w];0!=p--;){for(;w>S+x;){if(v++,S+=x,j=m-S,j=j>x?x:j,(g=1<<(b=w-S))>p+1&&(g-=p+1,T=w,b<j))for(;++b<j&&!((g<<=1)<=this.c[++T]);)g-=this.c[T];if(j=1<<b,this.hn[0]+j>u)return-3;this.u[v]=C=this.hn[0],this.hn[0]+=j,0!=v?(this.x[v]=y,this.r[0]=b,this.r[1]=x,b=y>>>S-x,this.r[2]=C-this.u[v-1]-b,o(this.r,0,c,3*(this.u[v-1]+b),3)):s[0]=C}for(this.r[1]=w-S,M>=n?this.r[0]=192:h[M]<i?(this.r[0]=this.v[M]<256?0:96,this.r[2]=this.v[M++]):(this.r[0]=a[this.v[M]-i]+16+64,this.r[2]=r[this.v[M++]-i]),g=1<<w-S,b=y>>>S;b<j;b+=g)o(this.r,0,c,3*(C+b),3);for(b=1<<w-1;0!=(y&b);b>>>=1)y^=b;for(y^=b,k=(1<<S)-1;(y&k)!=this.x[v];)v--,S-=x,k=(1<<S)-1}return 0!=A&&1!=m?_:f},r.prototype.inflate_trees_bits=function(t,e,n,i,r){var a;return this.initWorkArea(19),this.hn[0]=0,a=this.huft_build(t,0,19,19,null,null,n,e,i,this.hn,this.v),-3==a?r.msg="oversubscribed dynamic bit lengths tree":a!=_&&0!=e[0]||(r.msg="incomplete dynamic bit lengths tree",a=-3),a},r.prototype.inflate_trees_dynamic=function(t,e,n,i,r,a,o,s,l){var c;return this.initWorkArea(288),this.hn[0]=0,(c=this.huft_build(n,0,t,257,x,k,a,i,s,this.hn,this.v))!=f||0==i[0]?(-3==c?l.msg="oversubscribed literal/length tree":-4!=c&&(l.msg="incomplete literal/length tree",c=-3),c):(this.initWorkArea(288),c=this.huft_build(n,t,e,0,M,C,o,r,s,this.hn,this.v),c!=f||0==r[0]&&t>257?(-3==c?l.msg="oversubscribed distance tree":c==_?(l.msg="incomplete distance tree",c=-3):-4!=c&&(l.msg="empty distance tree with lengths",c=-3),c):f)},r.prototype.initWorkArea=function(t){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(t),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16)),this.v.length<t&&(this.v=new Int32Array(t));for(var e=0;e<t;e++)this.v[e]=0;for(var e=0;e<16;e++)this.c[e]=0;for(var e=0;e<3;e++)this.r[e]=0;o(this.c,0,this.u,0,15),o(this.c,0,this.x,0,16)};var A=new Uint8Array(1),j="function"==typeof A.subarray;return{inflateBuffer:c,arrayCopy:o}}.apply(e,i))&&(t.exports=r)},function(t,e,n){(function(i){var r,a,o;!function(i,s){a=[n(0)],r=s,void 0!==(o="function"==typeof r?r.apply(e,a):r)&&(t.exports=o)}(0,function(t){var e=t.ajaxSettings;e.responseFields.native="responseNative",e.converters["* native"]=!0;var n={},r=0,a={0:200,1223:204},o={},s=i.ajaxSettings.xhr();window.ActiveXObject&&t(window).on("unload",function(){for(var t in o)o[t]()}),n.cors=!!s&&"withCredentials"in s,n.ajax=s=!!s,t.ajaxTransport("native",function(t){var e;if(n.cors||s&&!t.crossDomain)return{send:function(n,i){var s,l=t.xhr(),c=++r,d={};if(l.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)l[s]=t.xhrFields[s];t.mimeType&&l.overrideMimeType&&l.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)l.setRequestHeader(s,n[s]);e=function(t){return function(){e&&(delete o[c],e=l.onload=l.onerror=null,"abort"===t?l.abort():"error"===t?i(l.status,l.statusText):(l.response&&(d.native=l.response),i(a[l.status]||l.status,l.statusText,d,l.getAllResponseHeaders())))}},l.onload=e(),l.onerror=e("error"),e=o[c]=e("abort");try{l.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}}),t.getNative=function(e,n){return t.ajax({dataType:"native",url:e,xhrFields:{responseType:"arraybuffer"},success:n})}})}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=n(9),o=r(a),s=n(1),l=r(s),c=n(6),d=i(c),u=n(3),h=i(u),f=o.View.extend(d.default.LoggableMixin).extend({_logNamespace:"user",options:{warnAtPercent:85,errorAtPercent:100},initialize:function(t){this.log(this+".initialize:",t),l.extend(this.options,t),this.listenTo(this.model,"change:quota_percent change:total_disk_usage",this.render)},update:function(t){return this.log(this+" updating user data...",t),this.model.loadFromApi(this.model.get("id"),t),this},isOverQuota:function(){return null!==this.model.get("quota_percent")&&this.model.get("quota_percent")>=this.options.errorAtPercent},_render_quota:function(){var e=this.model.toJSON(),n=e.quota_percent,i=t(this._templateQuotaMeter(e)),r=i.find(".progress-bar");return this.isOverQuota()?(r.attr("class","progress-bar bg-danger"),i.find(".quota-meter-text").css("color","white"),this.trigger("quota:over",e)):n>=this.options.warnAtPercent?(r.attr("class","progress-bar bg-warning"),this.trigger("quota:under quota:under:approaching",e)):(r.attr("class","progress-bar bg-success"),this.trigger("quota:under quota:under:ok",e)),i},_render_usage:function(){var e=t(this._templateUsage(this.model.toJSON()));return this.log(this+".rendering usage:",e),e},render:function(){var t=null;return this.log(this+".model.quota_percent:",this.model.get("quota_percent")),t=null===this.model.get("quota_percent")||void 0===this.model.get("quota_percent")?this._render_usage():this._render_quota(),this.$el.html(t),this.$el.find(".quota-meter-text").tooltip(),this},_templateQuotaMeter:function(t){return['<div id="quota-meter" class="quota-meter progress">','<div class="progress-bar" style="width: ',t.quota_percent,'%"></div>','<div class="quota-meter-text" data-placement="left" style="top: 6px"',t.nice_total_disk_usage?' title="Using '+t.nice_total_disk_usage+'. Click for details.">':">",'<a href="https://galaxyproject.org/support/account-quotas/" target="_blank">',(0,h.default)("Using")," ",t.quota_percent,"%","</a>","</div>","</div>"].join("")},_templateUsage:function(t){return['<div id="quota-meter" class="quota-meter" style="background-color: transparent">','<div class="quota-meter-text" data-placement="left" data-original-title="This value is recalculated when you log out." style="top: 6px; color: white">',t.nice_total_disk_usage?(0,h.default)("Using ")+t.nice_total_disk_usage:"","</div>","</div>"].join("")},toString:function(){return"UserQuotaMeter("+this.model+")"}});e.default={UserQuotaMeter:f}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(17),s=a(o),l=n(156),c=a(l),d=n(3),u=a(d),h={defaultName:t.template("Copy of '<%- name %>'"),title:t.template((0,u.default)("Copying history")+' "<%- name %>"'),submitLabel:(0,u.default)("Copy"),errorMessage:(0,u.default)("History could not be copied."),progressive:(0,u.default)("Copying history"),activeLabel:(0,u.default)("Copy only the active, non-deleted datasets"),allLabel:(0,u.default)("Copy all datasets including deleted ones"),anonWarning:(0,u.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,u.default)("after copying this history. "),_template:t.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",(0,u.default)("You can"),' <a href="/user/login">',(0,u.default)("login here"),"</a> ",(0,u.default)("or")," ",' <a href="/user/create">',(0,u.default)("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',(0,u.default)("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',(0,u.default)("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",(0,u.default)("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var t='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(t).css({"margin-top":"8px"})},dialog:function(e,n,a){function o(){var t=e.$("#copy-modal-title").val();if(!t)return void e.$(".invalid-title").show();var i="copy-all"===e.$('input[name="copy-what"]:checked').val();e.$("button").prop("disabled",!0),s._showAjaxIndicator(),n.copy(!0,t,i).done(function(t){l.resolve(t)}).fail(function(e,r,a){var o={name:t,copyAllDatasets:i};c.default.ajaxErrorModal(n,e,o,s.errorMessage),l.rejectWith(l,arguments)}).done(function(){_&&e.hide()})}a=a||{};var s=this,l=i.Deferred(),d=a.nameFn||this.defaultName,h=d({name:n.get("name")}),f=a.allDatasets?"copy-all":"copy-non-deleted",p=!!t.isUndefined(a.allowAll)||a.allowAll,_=!!t.isUndefined(a.autoClose)||a.autoClose;this.modal=e;var g=a.closing_callback;return e.show(t.extend(a,{title:this.title({name:n.get("name")}),body:r(s._template({name:h,isAnon:Galaxy.user.isAnonymous(),allowAll:p,copyWhat:f,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:t.object([[(0,u.default)("Cancel"),function(){e.hide()}],[this.submitLabel,o]]),height:"auto",closing_events:!0,closing_callback:function(t){t&&l.reject({cancelled:!0}),g&&g(t)}})),e.$("#copy-modal-title").focus().select(),e.$("#copy-modal-title").on("keydown",function(t){13===t.keyCode&&(t.preventDefault(),o())}),l}},f=t.extend({},h,{defaultName:t.template("imported: <%- name %>"),title:t.template((0,u.default)("Importing history")+' "<%- name %>"'),submitLabel:(0,u.default)("Import"),errorMessage:(0,u.default)("History could not be imported."),progressive:(0,u.default)("Importing history"),activeLabel:(0,u.default)("Import only the active, non-deleted datasets"),allLabel:(0,u.default)("Import all datasets including deleted ones"),anonWarning:(0,u.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,u.default)("after importing this history. ")}),p=function(t,e){e=e||{};var n=window.parent.Galaxy.modal||new s.default.View({});return e.useImport?f.dialog(n,t,e):h.dialog(n,t,e)};e.default=p}).call(e,n(1),n(0),n(0))},function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(57),o=r(a),s=n(175),l=r(s),c=n(5),d=r(c),u=n(6),h=r(u),f=n(3),p=r(f),_=n(1),g=i(_),m=n(2),v=i(m),y=v.Model.extend(h.default.LoggableMixin).extend(h.default.mixin(h.default.SearchableModelMixin,{_logNamespace:"history",UPDATE_DELAY:4e3,defaults:{model_class:"History",id:null,name:"Unnamed History",state:"new",deleted:!1,contents_active:{},contents_states:{}},contentsClass:o.default.HistoryContents,searchAttributes:["name","annotation","tags"],searchAliases:{title:"name",tag:"tags"},initialize:function(t,e){e=e||{},this.logger=e.logger||null,this.log(this+".initialize:",t,e),this.urlRoot=Galaxy.root+"api/histories",this.contents=new this.contentsClass([],{history:this,historyId:this.get("id"),order:e.order}),this._setUpListeners(),this._setUpCollectionListeners(),this.updateTimeoutId=null},_setUpListeners:function(){return this.on({error:function(t,e,n,i,r){this.clearUpdateTimeout()},"change:id":function(t,e){this.contents&&(this.contents.historyId=e)}})},_setUpCollectionListeners:function(){return this.contents?this.listenTo(this.contents,{error:function(){this.trigger.apply(this,t.makeArray(arguments))}}):this},contentsShown:function(){var t=this.get("contents_active"),e=t.active||0;return e+=this.contents.includeDeleted?t.deleted:0,e+=this.contents.includeHidden?t.hidden:0},nice_size:function(){var t=this.get("size");return t?d.default.bytesToString(t,!0,2):(0,p.default)("(empty)")},toJSON:function(){return g.extend(v.Model.prototype.toJSON.call(this),{nice_size:this.nice_size()})},get:function(t){return"nice_size"===t?this.nice_size():v.Model.prototype.get.apply(this,arguments)},ownedByCurrUser:function(){return!(!Galaxy||!Galaxy.user)&&(!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.get("user_id"))},numOfUnfinishedJobs:function(){var t=this.get("non_ready_jobs");return t?t.length:0},numOfUnfinishedShownContents:function(){return this.contents.runningAndActive().length||0},_fetchContentRelatedAttributes:function(){var e=["size","non_ready_jobs","contents_active","hid_counter"];return this.fetch({data:t.param({keys:e.join(",")})})},refresh:function(t){var e=this;t=t||{};var n=this.lastUpdateTime;return this.contents.allFetched=!1,(0!==this.contents.currentPage?function(){return e.contents.fetchPage(e.contents.currentPage)}:function(){return e.contents.fetchUpdated(n)})().done(function(n,i,r){var a;try{a=new Date(r.getResponseHeader("Date"))}catch(t){console.error(t)}e.lastUpdateTime=a||new Date,e.checkForUpdates(t)})},checkForUpdates:function(t){var e=this;t=t||{};var n=this.UPDATE_DELAY;if(this.id){var i=function(){e.clearUpdateTimeout(),e.updateTimeoutId=setTimeout(function(){e.refresh(t)},n)};this.numOfUnfinishedShownContents()>0?i():this._fetchContentRelatedAttributes().done(function(t){e.numOfUnfinishedJobs()>0?i():e.trigger("ready")})}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},stopPolling:function(){this.clearUpdateTimeout(),this.contents&&this.contents.stopPolling()},parse:function(t,e){var n=v.Model.prototype.parse.call(this,t,e);return n.create_time&&(n.create_time=new Date(n.create_time)),n.update_time&&(n.update_time=new Date(n.update_time)),n},fetchWithContents:function(t,e){t=t||{};var n=this;return t.view="dev-detailed",this.fetch(t).then(function(t){return n.contents.history=n,n.contents.setHistoryId(t.id),n.fetchContents(e)})},fetchContents:function(t){return t=t||{},this.lastUpdateTime=new Date,this.contents.fetchCurrentPage(t)},_delete:function(e){return this.get("deleted")?t.when():this.save({deleted:!0},e)},purge:function(e){return this.get("purged")?t.when():this.save({deleted:!0,purged:!0},e)},undelete:function(e){return this.get("deleted")?this.save({deleted:!1},e):t.when()},copy:function(e,n,i){if(e=void 0===e||e,!this.id)throw new Error("You must set the history ID before copying it.");var r={history_id:this.id};e&&(r.current=!0),n&&(r.name=n),i||(r.all_datasets=!1),r.view="dev-detailed";var a=this,o=t.post(this.urlRoot,r);return e?o.then(function(t){return new y(t).setAsCurrent().done(function(){a.trigger("copied",a,t)})}):o.done(function(t){a.trigger("copied",a,t)})},setAsCurrent:function(){var e=this,n=t.getJSON(Galaxy.root+"history/set_as_current?id="+this.id);return n.done(function(){e.trigger("set-as-current",e)}),n},toString:function(){return"History("+this.get("id")+","+this.get("name")+")"}})),b=l.default.InfinitelyScrollingCollection,w=b.extend(h.default.LoggableMixin).extend({_logNamespace:"history",model:y,order:"update_time",limitOnFirstFetch:10,limitPerFetch:10,initialize:function(t,e){e=e||{},this.log("HistoryCollection.initialize",t,e),this.urlRoot=Galaxy.root+"api/histories",b.prototype.initialize.call(this,t,e),this.includeDeleted=e.includeDeleted||!1,this.currentHistoryId=e.currentHistoryId,this.setUpListeners()},url:function(){return this.urlRoot},setUpListeners:function(){return this.on({"change:deleted":function(t){this.debug("change:deleted",this.includeDeleted,t.get("deleted")),!this.includeDeleted&&t.get("deleted")&&this.remove(t)},copied:function(t,e){this.setCurrent(new y(e,[]))},"set-as-current":function(t){var e=this.currentHistoryId;this.trigger("no-longer-current",e),this.currentHistoryId=t.id}})},_buildFetchData:function(t){return g.extend(b.prototype._buildFetchData.call(this,t),{view:"dev-detailed"})},_buildFetchFilters:function(t){var e=b.prototype._buildFetchFilters.call(this,t)||{},n={};return!0!==this.includeDeleted?(n.deleted=!1,n.purged=!1):n.deleted=null,g.defaults(e,n)},fetchFirst:function(e){var n=this,i=t.when();return this.currentHistoryId&&(i=b.prototype.fetchFirst.call(this,{silent:!0,limit:1,filters:{"encoded_id-in":this.currentHistoryId,deleted:null,purged:""}})),i.then(function(){return e=e||{},e.offset=0,n.fetchMore(e)})},comparators:g.extend(g.clone(b.prototype.comparators),{name:h.default.buildComparator("name",{ascending:!0}),"name-dsc":h.default.buildComparator("name",{ascending:!1}),size:h.default.buildComparator("size",{ascending:!1}),"size-asc":h.default.buildComparator("size",{ascending:!0})}),sort:function(t){t=t||{};var e=t.silent,n=this.remove(this.get(this.currentHistoryId));return b.prototype.sort.call(this,g.defaults({silent:!0},t)),this.unshift(n,{silent:!0}),e||this.trigger("sort",this,t),this},create:function(e,n,i,r){var a=this;return t.getJSON(Galaxy.root+"history/create_new_current").done(function(t){a.setCurrent(new y(t,[],i||{}))})},setCurrent:function(t,e){return e=e||{},this.unshift(t,e),this.currentHistoryId=t.get("id"),e.silent||this.trigger("new-current",t,this),this},toString:function(){return"HistoryCollection("+this.length+",current:"+this.currentHistoryId+")"}});e.default={History:y,HistoryCollection:w}}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(196),a=i(r),o=n(197),s=i(o),l=n(6),c=i(l),d=n(3),u=(i(d),a.default.DatasetAssociation),h=s.default.HistoryContentMixin,f=u.extend(c.default.mixin(h,{defaults:t.extend({},u.prototype.defaults,h.defaults,{history_content_type:"dataset",model_class:"HistoryDatasetAssociation"})}));e.default={HistoryDatasetAssociation:f}}).call(e,n(1))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(67),s=a(o),l=n(58),c=a(l),d=n(6),u=a(d),h=n(3),f=a(h),p=s.default.FoldoutListItemView,_=s.default.ListItemView,g=p.extend({className:p.prototype.className+" dataset-collection",id:function(){return["dataset_collection",this.model.get("id")].join("-")},initialize:function(t){this.linkTarget=t.linkTarget||"_blank",this.hasUser=t.hasUser,p.prototype.initialize.call(this,t)},_setUpListeners:function(){p.prototype._setUpListeners.call(this),this.listenTo(this.model,"change",function(e,n){t.has(e.changed,"deleted")?this.render():t.has(e.changed,"element_count")&&this.$("> .title-bar .subtitle").replaceWith(this._renderSubtitle())})},_renderSubtitle:function(){return i(this.templates.subtitle(this.model.toJSON(),this))},_getFoldoutPanelOptions:function(){var e=p.prototype._getFoldoutPanelOptions.call(this);return t.extend(e,{linkTarget:this.linkTarget,hasUser:this.hasUser})},$selector:function(){return this.$("> .selector")},toString:function(){return"DCListItemView("+(this.model?""+this.model:"(no model)")+")"}});g.prototype.templates=function(){var e=t.extend({},p.prototype.templates.warnings,{error:u.default.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',(0,f.default)("There was an error getting the data for this collection"),": <%- model.error %>","</div>","<% } %>"]),purged:u.default.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',(0,f.default)("This collection has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:u.default.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,f.default)("This collection has been deleted"),"</div>","<% } %>"])}),n=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier || collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection"),i=u.default.wrapTemplate(['<div class="subtitle">','<% var countText = collection.element_count? ( collection.element_count + " " ) : ""; %>','<%        if( collection.collection_type === "list" ){ %>',(0,f.default)("a list of <%- countText %>datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',(0,f.default)("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',(0,f.default)("a list of <%- countText %>dataset pairs"),'<% } else if( collection.collection_type === "list:list" ){ %>',(0,f.default)("a list of <%- countText %>dataset lists"),"<% } %>","</div>"],"collection");return t.extend({},p.prototype.templates,{warnings:e,titleBar:n,subtitle:i})}();var m=_.extend({className:_.prototype.className+" dataset-collection-element",initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log("DCEListItemView.initialize:",t),_.prototype.initialize.call(this,t)},toString:function(){return"DCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});m.prototype.templates=function(){var e=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element");return t.extend({},_.prototype.templates,{titleBar:e})}();var v=c.default.DatasetListItemView.extend({className:c.default.DatasetListItemView.prototype.className+" dataset-collection-element",initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log("DatasetDCEListItemView.initialize:",t),c.default.DatasetListItemView.prototype.initialize.call(this,t)},_fetchModelDetails:function(){var t=this;return t.model.inReadyState()&&!t.model.hasDetails()?t.model.fetch({silent:!0}):r.when()},toString:function(){return"DatasetDCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});v.prototype.templates=function(){var e=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>"],"element");return t.extend({},c.default.DatasetListItemView.prototype.templates,{titleBar:e})}();var y=g.extend({className:g.prototype.className+" dataset-collection-element",_swapNewRender:function(t){g.prototype._swapNewRender.call(this,t);var e=this.model.get("state")||"ok";return this.$el.addClass("state-"+e),this.$el},toString:function(){return"NestedDCDCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});e.default={DCListItemView:g,DCEListItemView:m,DatasetDCEListItemView:v,NestedDCDCEListItemView:y}}).call(e,n(1),n(0),n(0))},function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0});var i=t.Model.extend({defaults:{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"},urlRoot:Galaxy.root+"api/tool_shed"}),r=t.Collection.extend({url:Galaxy.root+"api/tool_shed",model:i}),a=t.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/contents"}),o=t.Collection.extend({url:Galaxy.root+"api/tool_shed/contents",model:a}),s=t.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/category"}),l=t.Collection.extend({url:Galaxy.root+"api/tool_shed/category",model:s}),c=t.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/repository"}),d=t.Collection.extend({url:Galaxy.root+"api/tool_shed/repository",model:c}),u=t.Model.extend({url:"#"}),h=t.Collection.extend({url:"#",model:u,fetch:function(){var e=this,i=Array(),r=JSON.parse(localStorage.repositories),a=Object.keys(r);return n.each(a,function(t){var e=r[t];e.queue_key=t,i.push(e)}),e.reset(i),t.Collection.prototype.fetch.call(this)}}),f=t.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/status"}),p=t.Collection.extend({url:Galaxy.root+"api/tool_shed/status",model:f}),_=t.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/workflows?missing_tools=True"}),g=t.Collection.extend({url:Galaxy.root+"api/workflows?missing_tools=True",model:_});e.default={ShedModel:i,ShedsCollection:r,Category:a,Categories:o,CategoryModel:s,CategoryCollection:l,RepositoryModel:c,RepositoryCollection:d,RepoQueue:h,RepoStatus:p,WorkflowTools:g}}).call(e,n(2),n(1))},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=function(e,n){var i=this,r=this.shed_url,a=Galaxy.root+"api/tool_shed/search";t.get(a,{term:e.term,tool_shed_url:r},function(t){var e=i.shedParser(t);n(e)})},i=function(e){var n=[],i=e.hits;return t.each(i,function(t){var e=i[t],r=e.repository.name+" by "+e.repository.repo_owner_username+": "+e.repository.description,a={value:e.repository.id,label:r};n.push(a)}),n},r=function(t){"/"==t.tool_shed_url.substr(-1)&&(t.tool_shed_url=t.tool_shed_url.substr(0,t.tool_shed_url.length-1));var e=t.tool_shed_url+"|"+t.repository_id+"|"+t.changeset_revision,n=new Object;localStorage.repositories&&(n=JSON.parse(localStorage.repositories)),n[e]=t,localStorage.repositories=JSON.stringify(n)},a=function(){if(localStorage.hasOwnProperty("repositories")){var t=JSON.parse(localStorage.repositories);return Object.keys(t).length}return 0};e.default={searchShed:n,shedParser:i,addToQueue:r,queueLength:a}}).call(e,n(0))},,,,,,,,function(t,e,n){"use strict";(function(t,i){function r(e,n,i){return Galaxy.modal.show({title:n,body:e,closing_events:!0,buttons:{Ok:function(){Galaxy.modal.hide()}}}),Galaxy.modal.$el.addClass("error-modal"),i&&(Galaxy.modal.$(".error-details").add(Galaxy.modal.$('button:contains("Details")')).remove(),t("<div/>").addClass("error-details").hide().appendTo(Galaxy.modal.$(".modal-content")).append([t("<p/>").text(p),t("<pre/>").text(JSON.stringify(i,null,"  "))]),t('<button id="button-1" class="float-left">'+(0,u.default)("Details")+"</button>").appendTo(Galaxy.modal.$(".buttons")).click(function(){Galaxy.modal.$(".error-details").toggle()})),Galaxy.modal}function a(t,e,n){if(t){if(t=(0,u.default)(t),e=(0,u.default)(e)||(0,u.default)("Error:"),window.Galaxy&&Galaxy.modal)return r(t,e,n);alert(e+"\n\n"+t),console.log("error details:",JSON.stringify(n))}}function o(){return a((0,u.default)("You appear to be offline. Please check your connection and try again."),(0,u.default)("Offline?"))}function s(){return a((0,u.default)("Galaxy is currently unreachable. Please try again in a few minutes.")+" "+h,(0,u.default)("Cannot connect to Galaxy"))}function l(t,e,n,i,r){return i=i||f,i+=" "+h,r=r||(0,u.default)("An error occurred"),a(i,r,c(t,e,n))}function c(t,e,n){return{raven:i.result(window.Raven,"lastEventId"),userAgent:navigator.userAgent,onLine:navigator.onLine,version:i.result(Galaxy.config,"version_major"),xhr:i.omit(e,i.functions(e)),options:i.omit(n,"xhr"),url:i.result(Galaxy.lastAjax,"url"),data:i.result(Galaxy.lastAjax,"data"),model:i.result(t,"toJSON",""+t),user:i.omit(i.result(Galaxy.user,"toJSON"),"email")}}Object.defineProperty(e,"__esModule",{value:!0});var d=n(3),u=function(t){return t&&t.__esModule?t:{default:t}}(d),h=(0,u.default)("Please contact a Galaxy administrator if the problem persists."),f=(0,u.default)("An error occurred while updating information with the server."),p=(0,u.default)("The following information can assist the developers in finding the source of the error:");e.default={errorModal:a,offlineErrorModal:o,badGatewayErrorModal:s,ajaxErrorModal:l}}).call(e,n(0),n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(e){t("#toggle-deleted").modeButton({initialMode:e.initialModeDeleted,modes:[{mode:"showing_deleted",html:(0,l.default)("Exclude deleted")},{mode:"not_showing_deleted",html:(0,l.default)("Include deleted")}]}),t("#toggle-hidden").modeButton({initialMode:e.initialModeHidden,modes:[{mode:"showing_hidden",html:(0,l.default)("Exclude hidden")},{mode:"not_showing_hidden",html:(0,l.default)("Include hidden")}]}),t("#switch").click(function(){var t=Galaxy.currHistoryPanel||window.top.Galaxy&&window.top.Galaxy.currHistoryPanel?window.top.Galaxy.currHistoryPanel:null;t?t.switchToHistory("${ history[ 'id' ] }"):window.location="${ switch_to_url }"}),e.hasMasthead&&t("#center").addClass("flex-vertical-container");var n=e.userIsOwner?S.default.HistoryViewEdit:E.HistoryView,i=new h.default.History(e.historyJSON);t("#import").click(function(){(0,A.default)(i,{useImport:!0,allDatasets:"showing_deleted"===t("#toggle-deleted").modeButton("getMode").mode}).done(function(){window===window.parent?window.location=Galaxy.root:Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.loadCurrentHistory()})});var r=new n({el:t("#history-"+e.historyJSON.id),className:n.prototype.className+" wide",$scrollContainer:e.hasMasthead?function(){return this.$el.parent()}:void 0,model:i,show_deleted:e.showDeletedJson,show_hidden:e.showHiddenJson,purgeAllowed:e.allow_user_dataset_purge});r.trigger("loading"),i.fetchContents({silent:!0}).fail(function(){alert("Galaxy history failed to load")}).done(function(){r.trigger("loading-done"),r.render()}),t("#toggle-deleted").on("click",function(){r.toggleShowDeleted()}),t("#toggle-hidden").on("click",function(){r.toggleShowHidden()})}Object.defineProperty(e,"__esModule",{value:!0}),e.historyEntry=r;var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(3),l=i(s),c=n(158),d=i(c),u=n(144),h=i(u),f=n(57),p=i(f),_=n(160),g=i(_),m=n(161),v=i(m),y=n(156),b=i(y),w=n(52),x=i(w),k=n(6),M=i(k),C=n(176),S=i(C),T=n(143),A=i(T);n(159),n(218);var j=d.default.ModelListPanel,E=j.extend({_logNamespace:"history",HDAViewClass:g.default.HDAListItemView,HDCAViewClass:v.default.HDCAListItemView,collectionClass:p.default.HistoryContents,modelCollectionKey:"contents",tagName:"div",className:j.prototype.className+" history-panel",emptyMsg:(0,l.default)("This history is empty"),noneFoundMsg:(0,l.default)("No matching datasets found"),searchPlaceholder:(0,l.default)("search datasets"),initialize:function(t){j.prototype.initialize.call(this,t),this.linkTarget=t.linkTarget||"_blank"},_createDefaultCollection:function(){return new this.collectionClass([],{history:this.model})},freeModel:function(){return j.prototype.freeModel.call(this),this.model&&this.model.stopPolling(),this},_setUpListeners:function(){j.prototype._setUpListeners.call(this),this.on({error:function(t,e,n,i,r){this.errorHandler(t,e,n,i,r)},"views:ready view:attached view:removed":function(t){this._renderSelectButton()},"view:attached":function(t){this.scrollTo(0)}})},loadHistory:function(t,e,n){var i=this;return n=o.extend(n||{silent:!0}),this.info("loadHistory:",t,e,n),this.setModel(new h.default.History({id:t})),n.silent=!0,this.trigger("loading"),this.model.fetchWithContents(e,n).always(function(){i.render(),i.trigger("loading-done")})},refreshContents:function(e){return this.model?this.model.refresh(e):t.when()},_setUpCollectionListeners:function(){return j.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"fetching-more":function(){this._toggleContentsLoadingIndicator(!0),this.$emptyMessage().hide()},"fetching-more-done":function(){this._toggleContentsLoadingIndicator(!1)}})},_showLoadingIndicator:function(e,n,i){var r=t('<div class="loading-indicator"/>');this.$el.html(r.text(e).slideDown(o.isUndefined(n)?this.fxSpeed:n))},_hideLoadingIndicator:function(e){this.$(".loading-indicator").slideUp(o.isUndefined(e)?this.fxSpeed+200:e,function(){t(this).remove()})},_buildNewRender:function(){var t=j.prototype._buildNewRender.call(this);return this._renderSelectButton(t),t},_renderSelectButton:function(t){if(t=t||this.$el,!this.multiselectActions().length)return null;if(!this.views.length)return this.hideSelectors(),t.find(".controls .actions .show-selectors-btn").remove(),null;var e=t.find(".controls .actions .show-selectors-btn");return e.length?e:(0,x.default)({title:(0,l.default)("Operations on multiple datasets"),classes:"show-selectors-btn",faIcon:"fa-check-square-o",tooltipConfig:{placement:"top"}}).prependTo(t.find(".controls .actions"))},_renderEmptyMessage:function(e){var n=this.$emptyMessage(e);return this.model.get("contents_active").active<=0?n.empty().append(this.emptyMsg).show():this.searchFor&&this.model.contents.haveSearchDetails()&&!this.views.length?n.empty().append(this.noneFoundMsg).show():(n.hide(),t())},$scrollContainer:function(t){return this.$list(t)},_toggleContentsLoadingIndicator:function(t){t?this.$list().html('<div class="contents-loading-indicator"><span class="fa fa-2x fa-spinner fa-spin"/></div>'):this.$list().find(".contents-loading-indicator").remove()},renderItems:function(e){e=e||this.$el;var n=this.$list(e);t(".tooltip").remove(),n.empty(),this.views=[];var i=this._filterCollection();return i.length?(this._renderPagination(e),this.views=this._renderSomeItems(i,n)):e.find("> .controls .list-pagination").empty(),this._renderEmptyMessage(e).toggle(!i.length),this.trigger("views:ready",this.views),this.views},_renderPagination:function(t){var e=t.find("> .controls .list-pagination");return this.searchFor||!this.model.contents.shouldPaginate()?e.empty():(e.html(this.templates.pagination({current:this.model.contents.currentPage+1,last:this.model.contents.getLastPage()+1},this)),e.find("select.pages").tooltip(),e)},_renderSomeItems:function(t,e){var n=this,i=[];return e.append(t.map(function(t){var e=n._createItemView(t);return i.push(e),n._renderItemView$el(e)})),i},_filterItem:function(t){var e=this.model.contents;return(e.includeHidden||!t.hidden())&&(e.includeDeleted||!t.isDeletedOrPurged())&&j.prototype._filterItem.call(this,t)},_getItemViewClass:function(t){var e=t.get("history_content_type");switch(e){case"dataset":return this.HDAViewClass;case"dataset_collection":return this.HDCAViewClass}throw new TypeError("Unknown history_content_type: "+e)},_getItemViewOptions:function(t){var e=j.prototype._getItemViewOptions.call(this,t);return o.extend(e,{linkTarget:this.linkTarget,expanded:this.model.contents.storage.isExpanded(t.id),hasUser:this.model.ownedByCurrUser()})},_setUpItemViewListeners:function(t){var e=this;return j.prototype._setUpItemViewListeners.call(e,t),e.listenTo(t,{expanded:function(t){e.model.contents.storage.addExpanded(t.model)},collapsed:function(t){e.model.contents.storage.removeExpanded(t.model)}})},collapseAll:function(){this.model.contents.storage.clearExpanded(),j.prototype.collapseAll.call(this)},getSelectedModels:function(){var t=j.prototype.getSelectedModels.call(this);return t.historyId=this.collection.historyId,t},events:o.extend(o.clone(j.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click > .controls .prev":"_clickPrevPage","click > .controls .next":"_clickNextPage","change > .controls .pages":"_changePageSelect","click .messages [class$=message]":"clearMessages"}),_clickPrevPage:function(t){this.model.stopPolling(),this.model.contents.fetchPrevPage()},_clickNextPage:function(t){this.model.stopPolling(),this.model.contents.fetchNextPage()},_changePageSelect:function(e){this.model.stopPolling();var n=t(e.currentTarget).val();this.model.contents.fetchPage(n)},toggleShowDeleted:function(t,e){t=void 0!==t?t:!this.model.contents.includeDeleted;var n=this.model.contents;return n.setIncludeDeleted(t,e),this.trigger("show-deleted",t),n.fetchCurrentPage({renderAll:!0}),t},toggleShowHidden:function(t,e,n){t=void 0!==t?t:!this.model.contents.includeHidden;var i=this.model.contents;return i.setIncludeHidden(t,n),this.trigger("show-hidden",t),i.fetchCurrentPage({renderAll:!0}),t},_firstSearch:function(t){var e=this;if(this.log("onFirstSearch",t),this.model.contents.haveSearchDetails())return void this.searchItems(t);this.$("> .controls .search-input").searchInput("toggle-loading"),this.searchFor=t,this.model.contents.progressivelyFetchDetails({silent:!0}).progress(function(t,n,i){e.renderItems(),e.trigger("search:loading-progress",n,i)}).always(function(){e.$el.find("> .controls .search-input").searchInput("toggle-loading")}).done(function(){e.searchItems(t,"force")})},clearSearch:function(t){var e=this;return this.searchFor?(this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.model.contents.fetchCurrentPage({silent:!0}).done(function(){e.renderItems()}),this):this},errorHandler:function(t,e,n){if(!e||0!==e.status||0!==e.readyState){if(this.error(t,e,n),o.isString(t)&&o.isString(e)){var i=t,r=e;return b.default.errorModal(i,r,n)}return e&&502===e.status?b.default.badGatewayErrorModal():b.default.ajaxErrorModal(t,e,n)}},clearMessages:function(e){return(o.isUndefined(e)?this.$messages().children('[class$="message"]'):t(e.currentTarget)).fadeOut(this.fxSpeed,function(){t(this).remove()}),this},scrollToHid:function(t){return this.scrollToItem(o.first(this.viewsWhereModel({hid:t})))},ordinalIndicator:function(t){var e=""+t;switch(e.charAt(e.length-1)){case"1":return e+"st";case"2":return e+"nd";case"3":return e+"rd";default:return e+"th"}},toString:function(){return"HistoryView("+(this.model?this.model.get("name"):"")+")"}});E.prototype.templates=function(){var t=function(){return'<div>\n            <div class="controls"></div>\n            <ul class="list-items"></ul>\n            <div class="empty-message infomessagesmall"></div>\',\n        </div>'},e=M.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- history.name %></div>',"</div>",'<div class="subtitle"></div>','<div class="history-size"><%- history.nice_size %></div>','<div class="actions"></div>','<div class="messages">',"<% if( history.deleted && history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,l.default)("This history has been purged and deleted"),"</div>","<% } else if( history.deleted ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,l.default)("This history has been deleted"),"</div>","<% } else if( history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,l.default)("This history has been purged"),"</div>","<% } %>","<% if( history.message ){ %>",'<div class="<%= history.message.level || "info" %>messagesmall">',"<%= history.message.text %>","</div>","<% } %>","</div>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-secondary"','data-mode="select">',(0,l.default)("All"),"</button>",'<button class="deselect-all btn btn-secondary"','data-mode="select">',(0,l.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>",'<div class="list-pagination form-inline"></div>',"</div>"],"history"),n=M.default.wrapTemplate(['<button class="prev" <%- pages.current === 1 ? "disabled" : "" %>>previous</button>','<select class="pages form-control" ','title="',(0,l.default)("Click to open and select a page. Begin typing a page number to select it"),'">',"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>",'<option value="<%- i - 1 %>" <%- i === pages.current ? "selected" : "" %>>',"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages","</option>","<% }); %>","</select>",'<button class="next" <%- pages.current === pages.last ? "disabled" : "" %>>next</button>'],"pages");return o.extend(o.clone(j.prototype.templates),{el:t,controls:e,pagination:n})}(),e.default={HistoryView:E,historyEntry:r}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(67),s=a(o),l=n(34),c=a(l),d=n(6),u=a(d),h=n(3),f=a(h);n(159);var p=t.View.extend(u.default.LoggableMixin).extend({_logNamespace:"list",viewClass:s.default.ListItemView,collectionClass:t.Collection,tagName:"div",className:"list-panel",fxSpeed:"fast",emptyMsg:(0,f.default)("This list is empty"),noneFoundMsg:(0,f.default)("No matching items found"),searchPlaceholder:(0,f.default)("search"),initialize:function(t,e){t=t||{},t.logger&&(this.logger=t.logger),this.log(this+".initialize:",t),this.fxSpeed=i.has(t,"fxSpeed")?t.fxSpeed:this.fxSpeed,this.filters=[],this.searchFor=t.searchFor||"",this.selecting=void 0===t.selecting||t.selecting,this.selected=t.selected||[],this.lastSelected=null,this.dragItems=t.dragItems||!1,this.viewClass=t.viewClass||this.viewClass,this.views=[],this.collection=t.collection||this._createDefaultCollection(),this.filters=t.filters||[],this.$scrollContainer=t.$scrollContainer||this.$scrollContainer,this.title=t.title||"",this.subtitle=t.subtitle||"",this._setUpListeners()},_setUpListeners:function(){return this.off(),this.on({error:function(t,e,n,i,r){console.error(t,e,n,i,r)},loading:function(){this._showLoadingIndicator("loading...",40)},"loading-done":function(){this._hideLoadingIndicator(40)}}),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this._setUpCollectionListeners(),this._setUpViewListeners(),this},_createDefaultCollection:function(){return new this.collectionClass([])},_setUpCollectionListeners:function(){return this.log(this+"._setUpCollectionListeners",this.collection),this.stopListening(this.collection),this.listenTo(this.collection,{error:function(t,e,n,i,r){this.trigger("error",t,e,n,i,r)},update:function(t,e){var n=e.changes;return e.renderAll||n.added.length+n.removed.length>1?this.renderItems():1===n.added.length?this.addItemView(i.first(n.added),t,e):1===n.removed.length?this.removeItemView(i.first(n.removed),t,e):void 0}}),this},_setUpViewListeners:function(){this.log(this+"._setUpViewListeners"),this.on({"view:selected":function(t,e){if(e&&e.shiftKey&&this.lastSelected){var n=this.viewFromModelId(this.lastSelected);n&&this.selectRange(t,n)}else e&&e.altKey&&!this.selecting&&this.showSelectors();this.selected.push(t.model.id),this.lastSelected=t.model.id},"view:de-selected":function(t,e){this.selected=i.without(this.selected,t.model.id)}})},render:function(t){this.log(this+".render",t);var e=this._buildNewRender();return this._setUpBehaviors(e),this._queueNewRender(e,t),this},_buildNewRender:function(){this.debug(this+"(ListPanel)._buildNewRender");var t=r(this.templates.el({},this));return this._renderControls(t),this._renderTitle(t),this._renderSubtitle(t),this._renderSearch(t),this.renderItems(t),t},_renderControls:function(t){this.debug(this+"(ListPanel)._renderControls");var e=r(this.templates.controls({},this));return t.find(".controls").replaceWith(e),e},_renderTitle:function(t){},_renderSubtitle:function(t){},_queueNewRender:function(t,e){e=void 0===e?this.fxSpeed:e;var n=this;n.log("_queueNewRender:",t,e),r(n).queue("fx",[function(t){n.$el.fadeOut(e,t)},function(e){n._swapNewRender(t),e()},function(t){n.$el.fadeIn(e,t)},function(t){n.trigger("rendered",n),t()}])},_swapNewRender:function(t){return this.$el.empty().attr("class",this.className).append(t.children()),this.selecting&&this.showSelectors(0),this},_setUpBehaviors:function(t){return t=t||this.$el,this.$controls(t).find("[title]").tooltip(),this._renderMultiselectActionMenu(t),this},_renderMultiselectActionMenu:function(t){t=t||this.$el;var e=t.find(".list-action-menu"),n=this.multiselectActions();if(!n.length)return e.empty();var i=r(['<div class="list-action-menu btn-group">','<button class="list-action-menu-btn btn btn-secondary dropdown-toggle" data-toggle="dropdown">',(0,f.default)("For all selected"),"...","</button>",'<ul class="dropdown-menu float-right" role="menu">',"</ul>","</div>"].join("")),a=n.map(function(t){var e=['<li><a href="javascript:void(0);">',t.html,"</a></li>"].join("");return r(e).click(function(e){return e.preventDefault(),t.func(e)})});return i.find("ul").append(a),e.replaceWith(i),i},multiselectActions:function(){return[]},$scrollContainer:function(t){return(t||this.$el).parent().parent()},$controls:function(t){return(t||this.$el).find("> .controls")},$list:function(t){return(t||this.$el).find("> .list-items")},$messages:function(t){return(t||this.$el).find("> .controls .messages")},$emptyMessage:function(t){return(t||this.$el).find("> .empty-message")},renderItems:function(t){t=t||this.$el;var e=this;e.log(this+".renderItems",t);var n=e.$list(t);e.freeViews();var i=e._filterCollection();return e.views=i.map(function(t){return e._createItemView(t)}),n.empty(),e.views.length&&e._attachItems(t),e._renderEmptyMessage(t).toggle(!e.views.length),e.trigger("views:ready",e.views),e.views},_filterCollection:function(){var t=this;return t.collection.filter(i.bind(t._filterItem,t))},_filterItem:function(t){var e=this;return i.every(e.filters.map(function(e){return e.call(t)}))&&(!e.searchFor||t.matchesAll(e.searchFor))},_createItemView:function(t){var e=this._getItemViewClass(t),n=i.extend(this._getItemViewOptions(t),{model:t}),r=new e(n);return this._setUpItemViewListeners(r),r},_destroyItemView:function(t){this.stopListening(t),this.views=i.without(this.views,t)},_destroyItemViews:function(t){var e=this;return e.views.forEach(function(t){e.stopListening(t)}),e.views=[],e},freeViews:function(){return this._destroyItemViews()},_getItemViewClass:function(t){return this.viewClass},_getItemViewOptions:function(t){return{fxSpeed:this.fxSpeed,expanded:!1,selectable:this.selecting,selected:i.contains(this.selected,t.id),draggable:this.dragItems}},_setUpItemViewListeners:function(t){var e=this;return this.listenTo(t,"all",function(){var t=Array.prototype.slice.call(arguments,0);t[0]="view:"+t[0],e.trigger.apply(e,t)}),this.listenTo(t,"draggable:dragstart",function(t,e){var n={},i=this.getSelectedModels();n=i.length?i.toJSON():[e.model.toJSON()],t.dataTransfer.setData("text",JSON.stringify(n))},this),e},_attachItems:function(t){var e=this;return this.$list(t).append(this.views.map(function(t){return e._renderItemView$el(t)})),this},_renderItemView$el:function(t){return t.render(0).$el},_renderEmptyMessage:function(t){this.debug("_renderEmptyMessage",t,this.searchFor);var e=this.searchFor?this.noneFoundMsg:this.emptyMsg;return this.$emptyMessage(t).text(e)},expandAll:function(){i.each(this.views,function(t){t.expand()})},collapseAll:function(){i.each(this.views,function(t){t.collapse()})},addItemView:function(t,e,n){var i=this,a=i._filterCollection().indexOf(t);if(-1!==a){var o=i._createItemView(t);return r(o).queue("fx",[function(t){i.$emptyMessage().is(":visible")?i.$emptyMessage().fadeOut(i.fxSpeed,t):t()},function(t){i._attachView(o,a),t()}]),o}},_attachView:function(t,e,n){n=!!i.isUndefined(n)||n,e=e||0;var r=this;return r.views.splice(e,0,t),r._insertIntoListAt(e,r._renderItemView$el(t).hide()),r.trigger("view:attached",t),n?t.$el.slideDown(r.fxSpeed,function(){r.trigger("view:attached:rendered")}):(t.$el.show(),r.trigger("view:attached:rendered")),t},_insertIntoListAt:function(t,e){var n=this.$list();return 0===t?n.prepend(e):n.children().eq(t-1).after(e),e},removeItemView:function(t,e,n){var a=this,o=i.find(a.views,function(e){return e.model===t});if(o)return a.views=i.without(a.views,o),a.trigger("view:removed",o),r({}).queue("fx",[function(t){o.$el.fadeOut(a.fxSpeed,t)},function(t){o.remove(),a.trigger("view:removed:rendered"),a.views.length?t():a._renderEmptyMessage().fadeIn(a.fxSpeed,t)}]),o},viewFromModelId:function(t){return i.find(this.views,function(e){return e.model.id===t})},viewFromModel:function(t){return t?this.viewFromModelId(t.id):void 0},viewsWhereModel:function(t){return this.views.filter(function(e){return i.isMatch(e.model.attributes,t)})},viewRange:function(t,e){if(t===e)return t?[t]:[];var n=this.views.indexOf(t),i=this.views.indexOf(e);return-1===n||-1===i?n===i?[]:-1===n?[e]:[t]:n<i?this.views.slice(n,i+1):this.views.slice(i,n+1)},_renderSearch:function(t){return t.find(".controls .search-input").searchInput({placeholder:this.searchPlaceholder,initialVal:this.searchFor,onfirstsearch:i.bind(this._firstSearch,this),onsearch:i.bind(this.searchItems,this),onclear:i.bind(this.clearSearch,this)}),t},_firstSearch:function(t){return this.log("onFirstSearch",t),this.searchItems(t)},searchItems:function(t,e){if(this.log("searchItems",t,this.searchFor,e),!e&&this.searchFor===t)return this;this.searchFor=t,this.renderItems(),this.trigger("search:searching",t,this);var n=this.$("> .controls .search-query");return n.val()!==t&&n.val(t),this},clearSearch:function(t){return this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.renderItems(),this},THROTTLE_SELECTOR_FX_AT:20,showSelectors:function(t){t=void 0!==t?t:this.fxSpeed,this.selecting=!0,this.$(".list-actions").slideDown(t),t=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:t,i.each(this.views,function(e){e.showSelector(t)})},hideSelectors:function(t){t=void 0!==t?t:this.fxSpeed,this.selecting=!1,this.$(".list-actions").slideUp(t),t=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:t,i.each(this.views,function(e){e.hideSelector(t)}),this.selected=[],this.lastSelected=null},toggleSelectors:function(){this.selecting?this.hideSelectors():this.showSelectors()},selectAll:function(t){i.each(this.views,function(e){e.select(t)})},deselectAll:function(t){this.lastSelected=null,i.each(this.views,function(e){e.deselect(t)})},selectRange:function(t,e){var n=this.viewRange(t,e);return i.each(n,function(t){t.select()}),n},getSelectedViews:function(){return i.filter(this.views,function(t){return t.selected})},getSelectedModels:function(){return new this.collection.constructor(i.map(this.getSelectedViews(),function(t){return t.model}))},_showLoadingIndicator:function(t,e,n){this.debug("_showLoadingIndicator",this.indicator,t,e,n),e=void 0!==e?e:this.fxSpeed,this.indicator||(this.indicator=new c.default.LoadingIndicator(this.$el),this.debug("\t created",this.indicator)),this.$el.is(":visible")?(this.$el.fadeOut(e),this.indicator.show(t,e,n)):this.indicator.show(0,n)},_hideLoadingIndicator:function(t,e){this.debug("_hideLoadingIndicator",this.indicator,t,e),t=void 0!==t?t:this.fxSpeed,this.indicator&&this.indicator.hide(t,e)},scrollPosition:function(){return this.$scrollContainer().scrollTop()},scrollTo:function(t,e){return e=e||0,this.$scrollContainer().animate({scrollTop:t},e),this},scrollToTop:function(t){return this.scrollTo(0,t)},scrollToItem:function(t,e){return this},scrollToId:function(t,e){return this.scrollToItem(this.viewFromModelId(t),e)},events:{"click .select-all":"selectAll","click .deselect-all":"deselectAll"},toString:function(){return"ListPanel("+this.collection+")"}});p.prototype.templates=function(){return{el:u.default.wrapTemplate(["<div>",'<div class="controls"></div>','<div class="list-items"></div>','<div class="empty-message infomessagesmall"></div>',"</div>"]),controls:u.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- view.title %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-secondary"','data-mode="select">',(0,f.default)("All"),"</button>",'<button class="deselect-all btn btn-secondary"','data-mode="select">',(0,f.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"])}}();var _=p.extend({modelCollectionKey:"contents",initialize:function(t){p.prototype.initialize.call(this,t),this.selecting=void 0!==t.selecting&&t.selecting,this.setModel(this.model,t)},setModel:function(t,e){if(e=e||{},this.debug(this+".setModel:",t,e),this.freeModel(),this.freeViews(),t){var n=this.model?this.model.get("id"):null;this.model=t,this.logger&&(this.model.logger=this.logger),this._setUpModelListeners(),this.stopListening(this.collection),this.collection=this.model[this.modelCollectionKey]||e.collection||this._createDefaultCollection(),this._setUpCollectionListeners(),n&&t.get("id")!==n&&this.trigger("new-model",this)}return this},freeModel:function(){return this.model&&this.stopListening(this.model),this},_setUpModelListeners:function(){return this.log(this+"._setUpModelListeners",this.model),this.listenTo(this.model,"error",function(){var t=Array.prototype.slice.call(arguments,0);t.unshift("error"),this.trigger.apply(this,t)},this),this.logger&&this.listenTo(this.model,"all",function(t){this.info(this+"(model)",t,arguments)}),this},_renderControls:function(t){this.debug(this+"(ModelListPanel)._renderControls");var e=this.model?this.model.toJSON():{},n=r(this.templates.controls(e,this));return t.find(".controls").replaceWith(n),n},toString:function(){return"ModelListPanel("+this.model+")"}});_.prototype.templates=function(){var t=u.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- model.name %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-secondary"','data-mode="select">',(0,f.default)("All"),"</button>",'<button class="deselect-all btn btn-secondary"','data-mode="select">',(0,f.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return i.extend(i.clone(p.prototype.templates),{controls:t})}(),e.default={ListPanel:p,ModelListPanel:_}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";function i(t,e){function n(t){o(this).parent().children("input").val("").trigger("searchInput.clear").blur(),e.onclear()}function i(t,i){if(!i)return n();o(this).trigger("search.search",i),"function"==typeof e.onfirstsearch&&u?(u=!1,e.onfirstsearch(i)):e.onsearch(i)}function r(){return['<input type="text" name="',e.name,'" placeholder="',e.placeholder,'" ','class="search-query ',e.classes,'" ',"/>"].join("")}var l=27,c=13,d=o(t),u=!0,h={initialVal:"",name:"search",placeholder:"search",classes:"",onclear:function(){},onfirstsearch:null,onsearch:function(t){},minSearchLen:0,escWillClear:!0,oninit:function(){}};return"string"===a.default.type(e)?("toggle-loading"===e&&function(){d.find(".search-loading").toggle(),d.find(".search-clear").toggle()}(),d):("object"===a.default.type(e)&&(e=a.default.extend(!0,{},h,e)),d.addClass("search-input").prepend([function(){return o(r()).focus(function(t){o(this).select()}).keyup(function(t){if(t.preventDefault(),t.stopPropagation(),t.which===l&&e.escWillClear)n.call(this,t);else{var r=o(this).val();(t.which===c||e.minSearchLen&&r.length>=e.minSearchLen)&&i.call(this,t,r)}}).val(e.initialVal)}(),function(){return o(['<span class="search-clear fa fa-times-circle" ','title="',s("clear search (esc)"),'"></span>'].join("")).tooltip({placement:"bottom"}).click(function(t){n.call(this,t)})}(),function(){return o(['<span class="search-loading fa fa-spinner fa-spin" ','title="',s("loading..."),'"></span>'].join("")).hide().tooltip({placement:"bottom"})}()]))}var r=n(0),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=a.default,s=window._l||function(t){return t};a.default.fn.extend({searchInput:function(t){return this.each(function(){return i(this,t)})}})},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(58),a=i(r),o=n(6),s=i(o),l=n(177),c=i(l),d=n(3),u=i(d),h=a.default.DatasetListItemView,f=h.extend({className:h.prototype.className+" history-content",initialize:function(t,e){h.prototype.initialize.call(this,t,e)},toString:function(){return"HDAListItemView("+(this.model?""+this.model:"(no model)")+")"}});f.prototype.templates=function(){var e=function(e){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'+e.hid+'</span>\n                <span class="name">'+t.escape(e.name)+"</span>\n            </div>\n            </br>\n            "+c.default.nametagTemplate(e)+"\n        </div>\n    "},n=t.extend({},h.prototype.templates.warnings,{hidden:s.default.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',(0,u.default)("This dataset has been hidden"),"</div>","<% } %>"],"dataset")});return t.extend({},h.prototype.templates,{titleBar:e,warnings:n})}(),e.default={HDAListItemView:f}}).call(e,n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(37),a=i(r),o=n(146),s=i(o),l=n(178),c=i(l),d=n(6),u=(i(d),n(177)),h=i(u),f=n(3),p=i(f),_=s.default.DCListItemView,g=_.extend({className:_.prototype.className+" history-content",_setUpListeners:function(){var t=this;_.prototype._setUpListeners.call(this);var e=function(e,n){t.render()};this.model.jobStatesSummary&&this.listenTo(this.model.jobStatesSummary,"change",e),this.listenTo(this.model,{"change:tags change:visible change:state":e})},_getFoldoutPanelClass:function(){return c.default.CollectionView},_swapNewRender:function(t){_.prototype._swapNewRender.call(this,t);var e,n=this.model.jobStatesSummary;e=n?n.new()?"loading":n.errored()?"error":n.terminal()?"ok":n.running()?"running":"queued":this.model.get("job_source_id")?"loading":this.model.get("populated_state")?a.default.OK:a.default.RUNNING,this.$el.addClass("state-"+e);var i=this.stateDescription();return this.$(".state-description").html(i),this.$el},stateDescription:function(){var t=this.model,e=(t.get("element_count"),t.get("job_source_type")),n=(this.model.get("collection_type"),c.default.collectionTypeDescription(t)),i=c.default.collectionDescription(t),r=t.jobStatesSummary;if(e&&"Job"!=e){if(r&&r.hasDetails()){var a=r.new(),o=a?null:r.jobCount();if(a)return'\n                        <div class="progress state-progress">\n                            <span class="note">Creating jobs.<span class="blinking">..</span></span>\n                            <div class="progress-bar info" style="width:100%">\n                        </div>';if(r.errored()){return"a "+n+" with "+r.numInError()+" / "+o+" jobs in error"}if(r.terminal())return i;var s=r.states().running||0,l=r.states().ok||0,d=l/(1*o),u=s/(1*o),h=1-d-u;return'\n                        <div class="progress state-progress">\n                            <span class="note">'+(o&&o>1?o+" jobs":"a job")+" generating a "+n+'</span>\n                            <div class="progress-bar ok" style="width:'+100*d+'%"></div>\n                            <div class="progress-bar running" style="width:'+100*u+'%"></div>\n                            <div class="progress-bar new" style="width:'+100*h+'%">\n                        </div>'}return'\n                    <div class="progress state-progress">\n                        <span class="note">Loading job data for '+n+'.<span class="blinking">..</span></span>\n                        <div class="progress-bar info" style="width:100%">\n                    </div>'}return i},toString:function(){return"HDCAListItemView("+(this.model?""+this.model:"(no model)")+")"}});g.prototype.templates=function(){var e=t.extend({},_.prototype.templates.warnings,{hidden:function(t){t.visible||(0,p.default)("This collection has been hidden")}}),n=function(e){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'+e.hid+'</span>\n                <span class="name">'+t.escape(e.name)+'</span>\n            </div>\n            <div class="state-description">\n            </div>\n            '+h.default.nametagTemplate(e)+"\n        </div>\n    "};return t.extend({},_.prototype.templates,{warnings:e,titleBar:n})}(),e.default={HDCAListItemView:g}}).call(e,n(1))},,,,,,,,,,,,,,function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),a=i(r),o=n(2),s=i(o),l=n(6),c=function(t){return t&&t.__esModule?t:{default:t}}(l),d=s.Collection.extend({initialize:function(t,e){s.Collection.prototype.initialize.call(this,t,e),this.setOrder(e.order||this.order,{silent:!0})},_setUpListeners:function(){return this.on({"changed-order":this.sort})},fetch:function(t){return t=this._buildFetchOptions(t),Galaxy.debug("fetch options:",t),s.Collection.prototype.fetch.call(this,t)},_buildFetchOptions:function(t){t=a.clone(t)||{},t.traditional=!0,t.data=t.data||this._buildFetchData(t),Galaxy.debug("data:",t.data);var e=this._buildFetchFilters(t);return Galaxy.debug("filters:",e),a.isEmpty(e)||a.extend(t.data,this._fetchFiltersToAjaxData(e)),Galaxy.debug("data:",t.data),t},_buildFetchData:function(t){var e={};return this.order&&(e.order=this.order),a.defaults(a.pick(t,this._fetchParams),e)},_fetchParams:["order","limit","offset","view","keys"],_buildFetchFilters:function(t){return a.clone(t.filters||{})},_fetchFiltersToAjaxData:function(t){var e={q:[],qv:[]};return a.each(t,function(t,n){void 0!==t&&""!==t&&(!0===t&&(t="True"),!1===t&&(t="False"),null===t&&(t="None"),e.q.push(n),e.qv.push(t))}),e},reset:function(t,e){return this.allFetched=!1,s.Collection.prototype.reset.call(this,t,e)},order:null,comparators:{update_time:c.default.buildComparator("update_time",{ascending:!1}),"update_time-asc":c.default.buildComparator("update_time",{ascending:!0}),create_time:c.default.buildComparator("create_time",{ascending:!1}),"create_time-asc":c.default.buildComparator("create_time",{ascending:!0})},setOrder:function(t,e){e=e||{};var n=this,i=n.comparators[t];if(a.isUndefined(i))throw new Error("unknown order: "+t);if(i!==n.comparator)return n.order=t,n.comparator=i,e.silent||n.trigger("changed-order",e),n}}),u=d.extend({limitPerPage:500,initialize:function(t,e){d.prototype.initialize.call(this,t,e),this.currentPage=e.currentPage||0},getTotalItemCount:function(){return this.length},shouldPaginate:function(){return this.getTotalItemCount()>=this.limitPerPage},getLastPage:function(){return Math.floor(this.getTotalItemCount()/this.limitPerPage)},getPageCount:function(){return this.getLastPage()+1},getPageLimitOffset:function(t){return t=this.constrainPageNum(t),{limit:this.limitPerPage,offset:t*this.limitPerPage}},constrainPageNum:function(t){return Math.max(0,Math.min(t,this.getLastPage()))},fetchPage:function(t,e){var n=this;return t=n.constrainPageNum(t),n.currentPage=t,e=a.defaults(e||{},n.getPageLimitOffset(t)),n.trigger("fetching-more"),n.fetch(e).always(function(){n.trigger("fetching-more-done")})},fetchCurrentPage:function(t){return this.fetchPage(this.currentPage,t)},fetchPrevPage:function(t){return this.fetchPage(this.currentPage-1,t)},fetchNextPage:function(t){return this.fetchPage(this.currentPage+1,t)}}),h=d.extend({limitOnFirstFetch:null,limitPerFetch:100,initialize:function(t,e){d.prototype.initialize.call(this,t,e),this.limitOnFirstFetch=e.limitOnFirstFetch||this.limitOnFirstFetch,this.limitPerFetch=e.limitPerFetch||this.limitPerFetch,this.allFetched=!1,this.lastFetched=e.lastFetched||0},_buildFetchOptions:function(t){return t.remove=t.remove||!1,d.prototype._buildFetchOptions.call(this,t)},fetchFirst:function(t){return Galaxy.debug("ControlledFetchCollection.fetchFirst:",t),t=t?a.clone(t):{},this.allFetched=!1,this.lastFetched=0,this.fetchMore(a.defaults(t,{reset:!0,limit:this.limitOnFirstFetch}))},fetchMore:function(e){Galaxy.debug("ControlledFetchCollection.fetchMore:",e),e=a.clone(e||{});var n=this;if(Galaxy.debug("fetchMore, options.reset:",e.reset),!e.reset&&n.allFetched)return t.when();e.reset?e.offset=0:void 0===e.offset&&(e.offset=n.lastFetched);var i=e.limit=e.limit||n.limitPerFetch||null;return Galaxy.debug("fetchMore, limit:",i,"offset:",e.offset),n.trigger("fetching-more"),n.fetch(e).always(function(){n.trigger("fetching-more-done")}).done(function(t){var e=a.isArray(t)?t.length:0;n.lastFetched+=e,Galaxy.debug("fetchMore, lastFetched:",n.lastFetched),(!i||e<i)&&(n.allFetched=!0,n.trigger("all-fetched",this))})},fetchAll:function(t){t=t||{};var e=this;return t=a.pick(t,"silent"),t.filters={},e.fetch(t).done(function(){e.allFetched=!0,e.trigger("all-fetched",e)})}});e.default={ControlledFetchCollection:d,PaginatedCollection:u,InfinitelyScrollingCollection:h}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(157),s=a(o),l=n(57),c=(a(l),n(37)),d=(a(c),n(145)),u=a(d),h=n(179),f=a(h),p=n(219),_=a(p),g=n(68),m=a(g),v=n(181),y=a(v),b=n(85),w=a(b),x=n(190),k=a(x),M=n(191),C=a(M),S=n(52),T=a(S),A=n(41),j=(a(A),n(6)),E=a(j),O=n(3),L=a(O);n(19);var N=s.default.HistoryView,I=N.extend({HDAViewClass:f.default.HDAListItemEdit,HDCAViewClass:_.default.HDCAListItemEdit,initialize:function(t){t=t||{},N.prototype.initialize.call(this,t),this.tagsEditor=null,this.dragItems=!0,this.annotationEditor=null,this.purgeAllowed=t.purgeAllowed||!1,this.annotationEditorShown=t.annotationEditorShown||!1,this.tagsEditorShown=t.tagsEditorShown||!1},_setUpListeners:function(){return N.prototype._setUpListeners.call(this),this.on({"droptarget:drop":function(t,e){this.dataDropped(e),this.dropTargetOff()},"view:attached view:removed":function(){this._renderCounts()},"search:loading-progress":this._renderSearchProgress,"search:searching":this._renderSearchFindings})},_setUpModelListeners:function(){return N.prototype._setUpModelListeners.call(this),this.listenTo(this.model,"change:size",this.updateHistoryDiskSize),this},_setUpCollectionListeners:function(){return N.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"change:deleted":this._handleItemDeletedChange,"change:visible":this._handleItemVisibleChange,"change:purged":function(t){this.model.fetch()},"fetching-deleted":function(t){this.$("> .controls .deleted-count").html("<i>"+(0,L.default)("loading...")+"</i>")},"fetching-hidden":function(t){this.$("> .controls .hidden-count").html("<i>"+(0,L.default)("loading...")+"</i>")},"fetching-deleted-done fetching-hidden-done":this._renderCounts}),this},_buildNewRender:function(){var t=N.prototype._buildNewRender.call(this);return this.model?(Galaxy&&Galaxy.user&&Galaxy.user.id&&Galaxy.user.id===this.model.get("user_id")&&(this._renderTags(t),this._renderAnnotation(t)),t):t},updateHistoryDiskSize:function(){this.$(".history-size").text(this.model.get("nice_size"))},renderItems:function(t){var e=N.prototype.renderItems.call(this,t);return this.searchFor?this._renderSearchFindings(t):this._renderCounts(t),e},_renderCounts:function(e){e=e instanceof t?e:this.$el;var n=this.templates.counts(this.model.toJSON(),this);return e.find("> .controls .subtitle").html(n)},_renderTags:function(t){var e=this;this.tagsEditor=new m.default.TagsEditor({model:this.model,el:t.find(".controls .tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){e.toggleHDATagEditors(!0,e.fxSpeed)},onhide:function(){e.toggleHDATagEditors(!1,e.fxSpeed)},$activator:(0,T.default)({title:(0,L.default)("Edit history tags"),classes:"history-tag-btn",faIcon:"fa-tags",tooltipConfig:{placement:"top"}}).appendTo(t.find(".controls .actions"))})},_renderAnnotation:function(t){var e=this;this.annotationEditor=new y.default.AnnotationEditor({model:this.model,el:t.find(".controls .annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){e.toggleHDAAnnotationEditors(!0,e.fxSpeed)},onhide:function(){e.toggleHDAAnnotationEditors(!1,e.fxSpeed)},$activator:(0,T.default)({title:(0,L.default)("Edit history annotation"),classes:"history-annotate-btn",faIcon:"fa-comment",tooltipConfig:{placement:"top"}}).appendTo(t.find(".controls .actions"))})},_setUpBehaviors:function(t){if(t=t||this.$el,N.prototype._setUpBehaviors.call(this,t),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.model.get("user_id")){var e=this;t.find("> .controls .name").attr("title",(0,L.default)("Click to rename history")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(t){var n=e.model.get("name");t&&t!==n?(e.$el.find("> .controls .name").text(t),e.model.save({name:t}).fail(function(){e.$el.find("> .controls .name").text(e.model.previous("name"))})):e.$el.find("> .controls .name").text(n)}})}},multiselectActions:function(){var t=this,e=[{html:(0,L.default)("Hide datasets"),func:function(){var e=u.default.HistoryDatasetAssociation.prototype.hide;t.getSelectedModels().ajaxQueue(e)}},{html:(0,L.default)("Unhide datasets"),func:function(){var e=u.default.HistoryDatasetAssociation.prototype.unhide;t.getSelectedModels().ajaxQueue(e)}},{html:(0,L.default)("Delete datasets"),func:function(){var e=u.default.HistoryDatasetAssociation.prototype.delete;t.getSelectedModels().ajaxQueue(e)}},{html:(0,L.default)("Undelete datasets"),func:function(){var e=u.default.HistoryDatasetAssociation.prototype.undelete;t.getSelectedModels().ajaxQueue(e)}}];return t.purgeAllowed&&e.push({html:(0,L.default)("Permanently delete datasets"),func:function(){if(confirm((0,L.default)("This will permanently remove the data in your datasets. Are you sure?"))){var e=u.default.HistoryDatasetAssociation.prototype.purge,n=t.getSelectedModels(),i=n.filter(function(t){return"dataset"==t.get("history_content_type")});n.ajaxQueue(e,{},i)}}}),e=e.concat(t._collectionActions())},_collectionActions:function(){var t=this;return[{html:(0,L.default)("Build Dataset List"),func:function(){return t.buildCollection("list")}},{html:(0,L.default)("Build Dataset Pair"),func:function(){return t.buildCollection("paired")}},{html:(0,L.default)("Build List of Dataset Pairs"),func:function(){return t.buildCollection("list:paired")}},{html:(0,L.default)("Build Collection from Rules"),func:function(){return t.buildCollection("rules")}}]},buildCollection:function(t,e,n){var i,r=this,e=e||r.getSelectedModels(),n=n||!1;"list"==t?i=w.default.createListCollection:"paired"==t?i=k.default.createPairCollection:"list:paired"==t?i=C.default.createListOfPairsCollection:t.startsWith("rules")?i=w.default.createCollectionViaRules:console.warn("Unknown collectionType encountered "+t),i(e,n).done(function(){r.model.refresh()})},_getItemViewOptions:function(t){var e=N.prototype._getItemViewOptions.call(this,t);return i.extend(e,{purgeAllowed:this.purgeAllowed,tagsEditorShown:this.tagsEditor&&!this.tagsEditor.hidden,annotationEditorShown:this.annotationEditor&&!this.annotationEditor.hidden}),e},_handleItemDeletedChange:function(t){t.get("deleted")?this._handleItemDeletion(t):this._handleItemUndeletion(t),this._renderCounts()},_handleItemDeletion:function(t){var e=this.model.get("contents_active");e.deleted+=1,e.active-=1,this.model.contents.includeDeleted||this.removeItemView(t),this.model.set("contents_active",e)},_handleItemUndeletion:function(t){var e=this.model.get("contents_active");e.deleted-=1,this.model.contents.includeDeleted||(e.active-=1),this.model.set("contents_active",e)},_handleItemVisibleChange:function(t){t.hidden()?this._handleItemHidden(t):this._handleItemUnhidden(t),this._renderCounts()},_handleItemHidden:function(t){var e=this.model.get("contents_active");e.hidden+=1,e.active-=1,this.model.contents.includeHidden||this.removeItemView(t),this.model.set("contents_active",e)},_handleItemUnhidden:function(t){var e=this.model.get("contents_active");e.hidden-=1,this.model.contents.includeHidden||(e.active-=1),this.model.set("contents_active",e)},toggleHDATagEditors:function(t,e){i.each(this.views,function(n){n.tagsEditor&&n.tagsEditor.toggle(t,e)})},toggleHDAAnnotationEditors:function(t,e){i.each(this.views,function(n){n.annotationEditor&&n.annotationEditor.toggle(t,e)})},events:i.extend(i.clone(N.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .toggle-deleted-link":function(t){this.toggleShowDeleted()},"click .toggle-hidden-link":function(t){this.toggleShowHidden()}}),_renderSearchProgress:function(t,e){var n=t+e;return this.$("> .controls .subtitle").html(["<i>",(0,L.default)("Searching "),n,"/",this.model.contentsShown(),"</i>"].join(""))},_renderSearchFindings:function(e){e=e instanceof t?e:this.$el;var n=this.templates.found(this.model.toJSON(),this);return e.find("> .controls .subtitle").html(n),this},dropTargetOn:function(){if(this.dropTarget)return this;this.dropTarget=!0;var t={dragenter:i.bind(this.dragenter,this),dragover:i.bind(this.dragover,this),dragleave:i.bind(this.dragleave,this),drop:i.bind(this.drop,this)},e=this._renderDropTarget();this.$list().before([this._renderDropTargetHelp(),e]);for(var n in t)t.hasOwnProperty(n)&&e.on(n,t[n]);return this},_renderDropTarget:function(){return this.$(".history-drop-target").remove(),r("<div/>").addClass("history-drop-target")},_renderDropTargetHelp:function(){return this.$(".history-drop-target-help").remove(),r("<div/>").addClass("history-drop-target-help").text((0,L.default)("Drag datasets here to copy them to the current history"))},dropTargetOff:function(){if(!this.dropTarget)return this;this.dropTarget=!1;var t=this.$(".history-drop-target").get(0);for(var e in this._dropHandlers)this._dropHandlers.hasOwnProperty(e)&&t.off(e,this._dropHandlers[e]);return this.$(".history-drop-target").remove(),this.$(".history-drop-target-help").remove(),this},dropTargetToggle:function(){return this.dropTarget?this.dropTargetOff():this.dropTargetOn(),this},dragenter:function(t){t.preventDefault(),t.stopPropagation(),this.$(".history-drop-target").css("border","2px solid black")},dragover:function(t){t.preventDefault(),t.stopPropagation()},dragleave:function(t){t.preventDefault(),t.stopPropagation(),this.$(".history-drop-target").css("border","1px dashed black")},drop:function(t){t.preventDefault();var e=this,n=t.originalEvent.dataTransfer,i=n.getData("text");n.dropEffect="move";try{i=JSON.parse(i)}catch(t){e.warn("error parsing JSON from drop:",i)}return e.trigger("droptarget:drop",t,i,e),!1},dataDropped:function(e){var n=this;return i.isObject(e)&&"HistoryDatasetAssociation"===e.model_class&&e.id?0!==n.contents.currentPage?n.contents.fetchPage(0).then(function(){return n.model.contents.copy(e.id)}):n.model.contents.copy(e.id):t.when()},toString:function(){return"HistoryViewEdit("+(this.model?this.model.get("name"):"")+")"}});I.prototype.templates=function(){var t=E.default.wrapTemplate(["<% var shown = Math.max( view.views.length, history.contents_active.active ) %>","<% if( shown ){ %>",'<span class="shown-count">',"<%- shown %> ",(0,L.default)("shown"),"</span>","<% } %>","<% if( history.contents_active.deleted ){ %>",'<span class="deleted-count">',"<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("hide deleted"),"</a>","<% } else { %>","<%- history.contents_active.deleted %> ",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("deleted"),"</a>","<% } %>","</span>","<% } %>","<% if( history.contents_active.hidden ){ %>",'<span class="hidden-count">',"<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("hide hidden"),"</a>","<% } else { %>","<%- history.contents_active.hidden %> ",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("hidden"),"</a>","<% } %>","</span>","<% } %>"],"history"),e=E.default.wrapTemplate([(0,L.default)("Found")," <%- view.views.length %>, ","<% if( history.contents_active.deleted ){ %>","<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("hide deleted"),"</a>, ","<% } else { %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,L.default)("show deleted"),"</a>, ","<% } %>","<% } %>","<% if( history.contents_active.hidden ){ %>","<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("hide hidden"),"</a>","<% } else { %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,L.default)("show hidden"),"</a>","<% } %>","<% } %>"],"history");return i.extend(i.clone(N.prototype.templates),{counts:t,found:e})}(),e.default={HistoryViewEdit:I}}).call(e,n(0),n(1),n(0))},function(t,e,n){"use strict";(function(t){function n(e){return'<span class="badge badge-primary badge-tags">'+t.escape(e.slice(5))+"</span>"}function i(e){var i=t.filter(t.uniq(e.tags),function(t){return 0===t.indexOf("name:")}),r=t.sortBy(i).map(n);return'\n        <div class="nametags" title="'+i.length+' nametags">\n            '+r.join("")+"\n        </div>"}Object.defineProperty(e,"__esModule",{value:!0}),e.default={nametagTemplate:i}}).call(e,n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){var e=t.get("collection_type");return"list"==e?(0,f.default)("list"):"paired"==e?(0,f.default)("dataset pair"):"list:paired"==e?(0,f.default)("list of pairs"):(0,f.default)("nested list")}function a(t){var e=t.get("element_count"),n="a "+r(t);if(e){var i;1==e?i="with 1 item":e&&(i="with "+e+" items"),n=n+" "+(0,f.default)(i)}return n}Object.defineProperty(e,"__esModule",{value:!0});var o=n(158),s=i(o),l=n(170),c=(i(l),n(146)),d=i(c),u=n(6),h=(i(u),n(3)),f=i(h),p=s.default.ModelListPanel,_=p.extend({_logNamespace:"collections",className:p.prototype.className+" dataset-collection-panel",DatasetDCEViewClass:d.default.DatasetDCEListItemView,modelCollectionKey:"elements",initialize:function(t){p.prototype.initialize.call(this,t),this.linkTarget=t.linkTarget||"_blank",this.dragItems=!0,this.hasUser=t.hasUser,this.panelStack=[],this.parentName=t.parentName,this.foldoutStyle=t.foldoutStyle||"foldout",this.downloadUrl=Galaxy.root+"api/dataset_collections/"+this.model.attributes.id+"/download"},getNestedDCDCEViewClass:function(){return d.default.NestedDCDCEListItemView.extend({foldoutPanelClass:_})},_queueNewRender:function(t,e){e=void 0===e?this.fxSpeed:e;var n=this;this.handleWarning(t),n.log("_queueNewRender:",t,e),n._swapNewRender(t),n.trigger("rendered",n)},handleWarning:function(t){var e=this.views.length,n=this.model.get("element_count");if(n&&n!==e){var i=(0,f.default)("displaying only "+e+" of "+n+" items");t.find(".elements-warning").html('<div class="warningmessagesmall">'+i+"</div>")}},_filterCollection:function(){return this.model.getVisibleContents()},_getItemViewClass:function(t){switch(t.get("element_type")){case"hda":return this.DatasetDCEViewClass;case"dataset_collection":return this.getNestedDCDCEViewClass()}throw new TypeError("Unknown element type:",t.get("element_type"))},_getItemViewOptions:function(e){var n=p.prototype._getItemViewOptions.call(this,e);return t.extend(n,{linkTarget:this.linkTarget,hasUser:this.hasUser,foldoutStyle:this.foldoutStyle})},_setUpItemViewListeners:function(t){var e=this;return p.prototype._setUpItemViewListeners.call(e,t),e.listenTo(t,{"expanded:drilldown":function(t,e){this._expandDrilldownPanel(e)},"collapsed:drilldown":function(t,e){this._collapseDrilldownPanel(e)}}),this},_expandDrilldownPanel:function(t){this.panelStack.push(t),this.$("> .controls").add(this.$list()).hide(),t.parentName=this.model.get("name"),this.$el.append(t.render().$el)},_collapseDrilldownPanel:function(t){this.panelStack.pop(),this.render()},events:{"click .navigation .back":"close"},close:function(t){this.remove(),this.trigger("close")},toString:function(){return"CollectionView("+(this.model?this.model.get("name"):"")+")"}});_.prototype.templates=function(){var e=function(e,n){var i=a(n.model);return'\n        <div class="controls">\n            <div class="navigation">\n            <a class="back" href="javascript:void(0)">\n                <span class="fa fa-icon fa-angle-left"></span>\n                '+(0,f.default)("Back to ")+"\n                "+t.escape(n.parentName)+'\n            </a>\n            </div>\n            <div class="title">\n                <div class="name">'+(t.escape(e.name)||t.escape(e.element_identifier))+'</div>\n                <div class="subtitle">\n                    '+i+'\n                </div>\n            </div>\n            <div class="elements-warning">\n            </div>\n            <div class="tags-display"></div>\n            <div class="actions">\n                <a class="download-btn icon-btn" href="'+n.downloadUrl+'"\n                   title="" download="" data-original-title="Download Collection">\n                   <span class="fa fa-floppy-o"></span>\n                </a>\n            </div>\n        </div>'};return t.extend(t.clone(p.prototype.templates),{controls:e})}(),e.default={collectionTypeDescription:r,collectionDescription:a,CollectionView:_}}).call(e,n(1))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(180),o=r(a),s=n(160),l=r(s),c=n(6),d=r(c),u=n(3),h=r(u),f=o.default.DatasetListItemEdit,p=f.extend({className:f.prototype.className+" history-content",_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):e.model.has("rerunnable")?t.when():e.model.fetch({silent:!0,data:{keys:["rerunnable","creating_job"].join(",")}})},events:i.extend(i.clone(f.prototype.events),{"click .unhide-link":function(t){return this.model.unhide(),!1}}),toString:function(){return"HDAListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});p.prototype.templates=function(){var t=i.extend({},f.prototype.templates.warnings,{hidden:d.default.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',(0,h.default)("This dataset has been hidden"),'<br /><a class="unhide-link" a href="javascript:void(0);">',(0,h.default)("Unhide it"),"</a>","</div>","<% } %>"],"dataset")});return i.extend({},f.prototype.templates,{titleBar:l.default.HDAListItemView.prototype.templates.titleBar,warnings:t})}(),e.default={HDAListItemEdit:p}}).call(e,n(0),n(1))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(37),o=r(a),s=n(58),l=r(s),c=n(68),d=r(c),u=n(181),h=r(u),f=n(52),p=r(f),_=n(6),g=r(_),m=n(3),v=r(m),y=l.default.DatasetListItemView,b=y.extend({initialize:function(t){y.prototype.initialize.call(this,t),this.hasUser=t.hasUser,this.purgeAllowed=t.purgeAllowed||!1,this.tagsEditorShown=t.tagsEditorShown||!1,this.annotationEditorShown=t.annotationEditorShown||!1},_renderPrimaryActions:function(){var t=y.prototype._renderPrimaryActions.call(this);return this.model.get("state")===o.default.NOT_VIEWABLE?t:y.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(),this._renderDeleteButton()])},_renderEditButton:function(){var e=this;if(this.model.get("state")===o.default.DISCARDED||!this.model.get("accessible"))return null;var n=this.model.get("purged"),i=this.model.get("deleted"),r={title:(0,v.default)("Edit attributes"),href:Galaxy.root+"datasets/edit?dataset_id="+this.model.attributes.id,faIcon:"fa-pencil",classes:"edit-btn",onclick:function(t){Galaxy.router&&(t.preventDefault(),Galaxy.router.push("datasets/edit",{dataset_id:e.model.attributes.id}))}};return i||n?(r.disabled=!0,n?r.title=(0,v.default)("Cannot edit attributes of datasets removed from disk"):i&&(r.title=(0,v.default)("Undelete dataset to edit attributes"))):t.contains([o.default.UPLOAD,o.default.NEW],this.model.get("state"))&&(r.disabled=!0,r.title=(0,v.default)("This dataset is not yet editable")),(0,p.default)(r)},_renderDeleteButton:function(){if(!this.model.get("accessible"))return null;var t=this,e=this.model.isDeletedOrPurged();return(0,p.default)({title:e?(0,v.default)("Dataset is already deleted"):(0,v.default)("Delete"),disabled:e,faIcon:"fa-times",classes:"delete-btn",onclick:function(){t.$el.find(".icon-btn.delete-btn").trigger("mouseout"),t.model.delete()}})},_renderDetails:function(){var e=y.prototype._renderDetails.call(this),n=this.model.get("state");return!this.model.isDeletedOrPurged()&&t.contains([o.default.OK,o.default.FAILED_METADATA],n)&&(this._renderTags(e),this._renderAnnotation(e),this._makeDbkeyEditLink(e)),this._setUpBehaviors(e),e},_renderToolHelpButton:function(){var t=this.model.attributes.dataset_id,e=this.model.attributes.creating_job,n=this,r=function(e){var r='<div id="thdiv-'+t+'" class="toolhelp">';e.name&&e.help?(r+="<strong>Tool help for "+e.name+"</strong><hr/>",r+=e.help):r+="<strong>Tool help is unavailable for this dataset.</strong><hr/>",r+="</div>",n.$el.find(".details").append(i.parseHTML(r))},a=function(t){i.ajax({url:Galaxy.root+"api/tools/"+t.tool_id+"/build"}).done(function(t){r(t)}).fail(function(){r({})})};return null===Galaxy.user.id?null:(0,p.default)({title:(0,v.default)("Tool Help"),classes:"icon-btn",href:"#",faIcon:"fa-question",onclick:function(){n.$el.find(".toolhelp").length>0?n.$el.find(".toolhelp").toggle():i.ajax({url:Galaxy.root+"api/jobs/"+e}).done(function(t){a(t)}).fail(function(){console.log('Failed at recovering job information from the  Galaxy API for job id "'+e+'".')})}})},_renderSecondaryActions:function(){var t=y.prototype._renderSecondaryActions.call(this);switch(this.model.get("state")){case o.default.UPLOAD:case o.default.NOT_VIEWABLE:return t;case o.default.ERROR:return t.unshift(this._renderErrButton()),t.concat([this._renderRerunButton(),this._renderToolHelpButton()]);case o.default.OK:case o.default.FAILED_METADATA:return t.concat([this._renderRerunButton(),this._renderVisualizationsButton(),this._renderToolHelpButton()])}return t.concat([this._renderRerunButton(),this._renderToolHelpButton()])},_renderErrButton:function(){var t=this;return(0,p.default)({title:(0,v.default)("View or report this error"),href:Galaxy.root+"datasets/error?dataset_id="+this.model.attributes.id,classes:"report-error-btn",faIcon:"fa-bug",onclick:function(e){Galaxy.router&&(e.preventDefault(),Galaxy.router.push("datasets/error",{dataset_id:t.model.attributes.id}))}})},_renderRerunButton:function(){var t=this.model.get("creating_job");if(this.model.get("rerunnable"))return(0,p.default)({title:(0,v.default)("Run this job again"),href:this.model.urls.rerun,classes:"rerun-btn",target:this.linkTarget,faIcon:"fa-refresh",onclick:function(e){Galaxy.router&&(e.preventDefault(),Galaxy.router.push("/",{job_id:t}))}})},_renderVisualizationsButton:function(){var e=this.model.get("visualizations");if(this.model.isDeletedOrPurged()||!this.hasUser||!this.model.hasData()||t.isEmpty(e))return null;if(!t.isObject(e[0]))return this.warn("Visualizations have been switched off"),null;if(e.length>=1){var n=Galaxy.root+"visualizations?dataset_id="+this.model.get("id");return i("<a/>").addClass("visualization-link icon-btn").attr("href",n).append(i("<span/>").addClass("fa fa-bar-chart-o")).on("click",function(t){Galaxy.frame.add({url:n,title:"Visualization"}),t.preventDefault()})}},_addScratchBookFn:function(t){var e=this;t.click(function(t){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:(0,v.default)("Visualization"),url:i(e).attr("href")}),t.preventDefault(),t.stopPropagation())})},_renderTags:function(t){if(this.hasUser){var e=this;this.tagsEditor=new d.default.TagsEditor({model:this.model,el:t.find(".tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){e.tagsEditorShown=!0},onhide:function(){e.tagsEditorShown=!1},$activator:(0,p.default)({title:(0,v.default)("Edit dataset tags"),classes:"tag-btn",faIcon:"fa-tags"}).appendTo(t.find(".actions .right"))}),this.tagsEditorShown&&this.tagsEditor.toggle(!0)}},_renderAnnotation:function(t){if(this.hasUser){var e=this;this.annotationEditor=new h.default.AnnotationEditor({model:this.model,el:t.find(".annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){e.annotationEditorShown=!0},onhide:function(){e.annotationEditorShown=!1},$activator:(0,p.default)({title:(0,v.default)("Edit dataset annotation"),classes:"annotate-btn",faIcon:"fa-comment"}).appendTo(t.find(".actions .right"))}),this.annotationEditorShown&&this.annotationEditor.toggle(!0)}},_makeDbkeyEditLink:function(t){if("?"===this.model.get("metadata_dbkey")&&!this.model.isDeletedOrPurged()){var e=i('<a class="value">?</a>').attr("href",this.model.urls.edit).attr("target","_top");t.find(".dbkey .value").replaceWith(e)}},events:t.extend(t.clone(y.prototype.events),{"click .undelete-link":"_clickUndeleteLink","click .purge-link":"_clickPurgeLink","click .edit-btn":function(t){this.trigger("edit",this,t)},"click .delete-btn":function(t){this.trigger("delete",this,t)},"click .rerun-btn":function(t){this.trigger("rerun",this,t)},"click .report-err-btn":function(t){this.trigger("report-err",this,t)},"click .visualization-btn":function(t){this.trigger("visualize",this,t)},"click .dbkey a":function(t){this.trigger("edit",this,t)}}),_clickUndeleteLink:function(t){return this.model.undelete(),!1},_clickPurgeLink:function(t){return confirm((0,v.default)("This will permanently remove the data in your dataset. Are you sure?"))&&this.model.purge(),!1},toString:function(){return"HDAEditView("+(this.model?""+this.model:"(no model)")+")"}});b.prototype.templates=function(){var e=t.extend({},y.prototype.templates.warnings,{failed_metadata:g.default.wrapTemplate(['<% if( dataset.state === "failed_metadata" ){ %>','<div class="failed_metadata-warning warningmessagesmall">',(0,v.default)("An error occurred setting the metadata for this dataset"),'<br /><a href="<%- dataset.urls.edit %>" target="_top">',(0,v.default)("Set it manually or retry auto-detection"),"</a>","</div>","<% } %>"],"dataset"),deleted:g.default.wrapTemplate(["<% if( dataset.deleted && !dataset.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,v.default)("This dataset has been deleted"),'<br /><a class="undelete-link" href="javascript:void(0);">',(0,v.default)("Undelete it"),"</a>","<% if( view.purgeAllowed ){ %>",'<br /><a class="purge-link" href="javascript:void(0);">',(0,v.default)("Permanently remove it from disk"),"</a>","<% } %>","</div>","<% } %>"],"dataset")}),n=g.default.wrapTemplate(["<% if( visualizations.length === 1 ){ %>",'<a class="visualization-link icon-btn" href="<%- visualizations[0].href %>"',' target="<%- visualizations[0].target %>" title="',(0,v.default)("Visualize in"),' <%- visualizations[0].html %>">','<span class="fa fa-bar-chart-o"></span>',"</a>","<% } else { %>",'<div class="visualizations-dropdown dropdown icon-btn">','<a data-toggle="dropdown" title="',(0,v.default)("Visualize"),'">','<span class="fa fa-bar-chart-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu">',"<% _.each( visualizations, function( visualization ){ %>",'<li><a class="visualization-link" href="<%- visualization.href %>"',' target="<%- visualization.target %>">',"<%- visualization.html %>","</a></li>","<% }); %>","</ul>","</div>","<% } %>"],"visualizations");return t.extend({},y.prototype.templates,{warnings:e,visualizations:n})}(),e.default={DatasetListItemEdit:b}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(6),o=r(a),s=n(3),l=r(s);n(19);var c=t.View.extend(o.default.LoggableMixin).extend(o.default.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"annotation-display",initialize:function(t){t=t||{},this.tooltipConfig=t.tooltipConfig||{placement:"bottom"},this.listenTo(this.model,"change:annotation",function(){this.render()}),this.hiddenUntilActivated(t.$activator,t)},render:function(){var t=this;return this.$el.html(this._template()),this.$annotation().make_text_editable({use_textarea:!0,on_finish:function(e){t.$annotation().text(e),t.model.save({annotation:e},{silent:!0}).fail(function(){t.$annotation().text(t.model.previous("annotation"))})}}),this},_template:function(){var t=this.model.get("annotation");return['<label class="prompt">',(0,l.default)("Annotation"),"</label>",'<div class="annotation">',i.escape(t),"</div>"].join("")},$annotation:function(){return this.$el.find(".annotation")},remove:function(){this.$annotation.off(),this.stopListening(this.model),t.View.prototype.remove.call(this)},toString:function(){return["AnnotationEditor(",""+this.model,")"].join("")}});e.default={AnnotationEditor:c}}).call(e,n(2),n(1))},,,,,,,,,function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}function o(t,e){var n=t.toJSON();return v(n,{defaultHideSourceItems:e,creationFn:function(e,n,i){return e=[{name:"forward",src:"hda",id:e[0].id},{name:"reverse",src:"hda",id:e[1].id}],t.createHDCA(e,"paired",n,i)}})}Object.defineProperty(e,"__esModule",{value:!0});var s=n(85),l=a(s),c=n(153),d=a(c),u=n(6),h=a(u),f=n(3),p=a(f),_=t.View.extend(h.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(t){this.element=t.element||{},this.identifier=t.identifier},render:function(){return this.$el.attr("data-element-id",this.element.id).html(this.template({identifier:this.identifier,element:this.element})),this},template:i.template(['<span class="identifier"><%- identifier %></span>','<span class="name"><%- element.name %></span>'].join("")),destroy:function(){this.off(),this.$el.remove()},toString:function(){return"DatasetCollectionElementView()"}}),g=l.default.ListCollectionCreator,m=g.extend({elementViewClass:_,collectionClass:d.default.HistoryDatasetCollection,className:"pair-collection-creator collection-creator flex-row-container",_mangleDuplicateNames:function(){},render:function(t,e){return 2===this.workingElements.length?g.prototype.render.call(this,t,e):this._renderInvalid(t,e)},_renderList:function(t,e){var n=this,a=r("<div/>"),o=n.$list();i.each(this.elementViews,function(t){t.destroy(),n.removeElementView(t)}),a.append(n._createForwardElementView().$el),a.append(n._createReverseElementView().$el),o.empty().append(a.children()),i.invoke(n.elementViews,"render")},_createForwardElementView:function(){return this._createElementView(this.workingElements[0],{identifier:"forward"})},_createReverseElementView:function(){return this._createElementView(this.workingElements[1],{identifier:"reverse"})},_createElementView:function(t,e){var n=new this.elementViewClass(i.extend(e,{element:t}));return this.elementViews.push(n),n},swap:function(){this.workingElements=[this.workingElements[1],this.workingElements[0]],this._renderList()},events:i.extend(i.clone(g.prototype.events),{"click .swap":"swap"}),templates:i.extend(i.clone(g.prototype.templates),{middle:i.template(['<div class="collection-elements-controls">','<a class="swap" href="javascript:void(0);" title="',(0,p.default)("Swap forward and reverse datasets"),'">',(0,p.default)("Swap"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),helpContent:i.template(["<p>",(0,p.default)(["Pair collections are permanent collections containing two datasets: one forward and one reverse. ","Often these are forward and reverse reads. The pair collections can be passed to tools and ","workflows in order to have analyses done on both datasets. This interface allows ","you to create a pair, name it, and swap which is forward and which reverse."].join("")),"</p>","<ul>","<li>",(0,p.default)(['Click the <i data-target=".swap">"Swap"</i> link to make your forward dataset the reverse ',"and the reverse dataset forward."].join("")),"</li>","<li>",(0,p.default)(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",(0,p.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidInitial:i.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",(0,p.default)("The following selections could not be included due to problems"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) === 0 ){ %>",(0,p.default)("No datasets were selected"),".","<% } else if( _.size( elements ) === 1 ){ %>",(0,p.default)("Only one dataset was selected"),": <%- elements[0].name %>","<% } else if( _.size( elements ) > 2 ){ %>",(0,p.default)("Too many datasets were selected"),': <%- _.pluck( elements, "name" ).join( ", ") %>',"<% } %>","<br />",(0,p.default)("Two (and only two) elements are needed for the pair"),". ",(0,p.default)("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',(0,p.default)("cancel"),"</a> ",(0,p.default)("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options float-left">','<button class="cancel-create btn" tabindex="-1">',(0,p.default)("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"PairCollectionCreator"}}),v=function(t,e){return e=e||{},e.title=(0,p.default)("Create a collection from a pair of datasets"),l.default.collectionCreatorModal(t,e,m)};e.default={PairCollectionCreator:m,pairCollectionCreatorModal:v,createPairCollection:o}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}function s(t){function e(){return n.length||(n=[new RegExp(this.filters[0]),new RegExp(this.filters[1])]),n}t=t||{},t.createPair=t.createPair||function(t){t=t||{};var e=t.listA.splice(t.indexA,1)[0],n=t.listB.splice(t.indexB,1)[0],i=t.listB.indexOf(e),r=t.listA.indexOf(n);return-1!==i&&t.listB.splice(i,1),-1!==r&&t.listA.splice(r,1),this._pair(e,n,{silent:!0})};var n=[];return t.preprocessMatch=t.preprocessMatch||function(t){var n=e.call(this);return i.extend(t,{matchTo:t.matchTo.name.replace(n[0],""),possible:t.possible.name.replace(n[1],"")})},function(e){this.debug("autopair _strategy ---------------------------"),e=e||{};var n,i=e.listA,r=e.listB,a=0,o={score:0,index:null},s=[];for(this.debug("starting list lens:",i.length,r.length),this.debug("bestMatch (starting):",JSON.stringify(o,null,"  "));a<i.length;){var l=i[a];for(o.score=0,n=0;n<r.length;n++){var c=r[n];if(this.debug(a+":"+l.name),this.debug(n+":"+c.name),i[a]!==r[n]&&(o=t.match.call(this,t.preprocessMatch.call(this,{matchTo:l,possible:c,index:n,bestMatch:o})),this.debug("bestMatch:",JSON.stringify(o,null,"  ")),1===o.score)){this.debug("breaking early due to perfect match");break}}var d=t.scoreThreshold.call(this);if(this.debug("scoreThreshold:",d),this.debug("bestMatch.score:",o.score),o.score>=d?s.push(t.createPair.call(this,{listA:i,indexA:a,listB:r,indexB:o.index})):a+=1,!i.length||!r.length)return s}return this.debug("paired:",JSON.stringify(s,null,"  ")),this.debug("autopair _strategy ---------------------------"),s}}function l(t,e){var n=t.toJSON();return w(n,{historyId:t.historyId,defaultHideSourceItems:e})}Object.defineProperty(e,"__esModule",{value:!0});var c=n(222),d=o(c),u=n(199),h=o(u),f=n(198),p=o(f),_=n(6),g=o(_),m=n(3),v=o(m);n(211);var y=t.View.extend(g.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"dataset paired",initialize:function(t){this.pair=t.pair||{}},template:i.template(['<span class="forward-dataset-name flex-column"><%- pair.forward.name %></span>','<span class="pair-name-column flex-column">','<span class="pair-name"><%- pair.name %></span>',"</span>",'<span class="reverse-dataset-name flex-column"><%- pair.reverse.name %></span>'].join("")),render:function(){this.dragStartHandler=i.bind(this._dragstart,this),this.dragEndHandler=i.bind(this._dragend,this);var t=this.$el.attr("draggable",!0).data("pair",this.pair).html(this.template({pair:this.pair})).addClass("flex-column-container").get(0);return t.addEventListener("dragstart",this.dragStartHandler,!1),t.addEventListener("dragend",this.dragEndHandler,!1),this},events:{dragover:"_sendToParent",drop:"_sendToParent"},_dragstart:function(t){t.currentTarget.style.opacity="0.4",t.originalEvent&&(t=t.originalEvent),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",JSON.stringify(this.pair)),this.$el.parent().trigger("pair.dragstart",[this])},_dragend:function(t){t.currentTarget.style.opacity="1.0",this.$el.parent().trigger("pair.dragend",[this])},_sendToParent:function(t){this.$el.parent().trigger(t)},toString:function(){return"PairView("+this.pair.name+")"}}),b=t.View.extend(g.default.LoggableMixin).extend(p.default.CollectionCreatorMixin).extend({_logNamespace:"collections",className:"list-of-pairs-collection-creator collection-creator flex-row-container",initialize:function(t){this.metric("PairedCollectionCreator.initialize",t),t=i.defaults(t,{datasets:[],filters:this.DEFAULT_FILTERS,automaticallyPair:!0,strategy:"lcs",matchPercentage:.9,twoPassAutopairing:!0}),this.initialList=t.datasets,this.historyId=t.historyId,this.filters=this.commonFilters[t.filters]||this.commonFilters[this.DEFAULT_FILTERS],i.isArray(t.filters)&&(this.filters=t.filters),this.automaticallyPair=t.automaticallyPair,this.strategy=this.strategies[t.strategy]||this.strategies[this.DEFAULT_STRATEGY],i.isFunction(t.strategy)&&(this.strategy=t.strategy),this.matchPercentage=t.matchPercentage,this.twoPassAutopairing=t.twoPassAutopairing,this.removeExtensions=!0,this.oncancel=t.oncancel,this.oncreate=t.oncreate,this.autoscrollDist=t.autoscrollDist||24,this.unpairedPanelHidden=!1,this.pairedPanelHidden=!1,this.$dragging=null,this.blocking=!1,this._setUpCommonSettings(t),this._setUpBehaviors(),this._dataSetUp()},commonFilters:{illumina:["_1","_2"],Rs:["_R1","_R2"]},DEFAULT_FILTERS:"illumina",strategies:{simple:"autopairSimple",lcs:"autopairLCS",levenshtein:"autopairLevenshtein"},DEFAULT_STRATEGY:"lcs",_dataSetUp:function(){this.paired=[],this.unpaired=[],this.selectedIds=[],this._sortInitialList(),this._ensureIds(),this.unpaired=this.initialList.slice(0),this.automaticallyPair&&(this.autoPair(),this.once("rendered:initial",function(){this.trigger("autopair")}))},_sortInitialList:function(){this._sortDatasetList(this.initialList)},_sortDatasetList:function(t){return t.sort(function(t,e){return(0,h.default)(t.name,e.name)}),t},_ensureIds:function(){return this.initialList.forEach(function(t){t.hasOwnProperty("id")||(t.id=i.uniqueId())}),this.initialList},_splitByFilters:function(){function t(t,e){return e.test(t.name)}var e=this.filters.map(function(t){return new RegExp(t)}),n=[[],[]];return this.unpaired.forEach(function(i){e.forEach(function(e,r){t(i,e)&&n[r].push(i)})}),n},_addToUnpaired:function(t){var e=this;this.unpaired.splice(function n(i,r){if(i===r)return i;var a=Math.floor((r-i)/2)+i,o=(0,h.default)(t.name,e.unpaired[a].name);if(o<0)return n(i,a);if(o>0)return n(a+1,r);for(;e.unpaired[a]&&e.unpaired[a].name===t.name;)a++;return a}(0,this.unpaired.length),0,t)},autoPair:function(t){var e=this._splitByFilters(),n=[];return this.twoPassAutopairing&&(n=this.autopairSimple({listA:e[0],listB:e[1]}),e=this._splitByFilters()),t=t||this.strategy,e=this._splitByFilters(),n=n.concat(this[t].call(this,{listA:e[0],listB:e[1]}))},autopairSimple:s({scoreThreshold:function(){return.6},match:function(t){return t=t||{},t.matchTo===t.possible?{index:t.index,score:1}:t.bestMatch}}),autopairLevenshtein:s({scoreThreshold:function(){return this.matchPercentage},match:function(t){t=t||{};var e=(0,d.default)(t.matchTo,t.possible),n=1-e/Math.max(t.matchTo.length,t.possible.length);return n>t.bestMatch.score?{index:t.index,score:n}:t.bestMatch}}),autopairLCS:s({scoreThreshold:function(){return this.matchPercentage},match:function(t){t=t||{};var e=this._naiveStartingAndEndingLCS(t.matchTo,t.possible).length,n=e/Math.max(t.matchTo.length,t.possible.length);return n>t.bestMatch.score?{index:t.index,score:n}:t.bestMatch}}),_naiveStartingAndEndingLCS:function(t,e){for(var n="",i="",r=0,a=0;r<t.length&&r<e.length&&t[r]===e[r];)n+=t[r],r+=1;if(r===t.length)return t;if(r===e.length)return e;for(r=t.length-1,a=e.length-1;r>=0&&a>=0&&t[r]===e[a];)i=[t[r],i].join(""),r-=1,a-=1;return n+i},_pair:function(t,e,n){n=n||{},this.debug("_pair:",t,e);var r=this._createPair(t,e,n.name);return this.paired.push(r),this.unpaired=i.without(this.unpaired,t,e),n.silent||this.trigger("pair:new",r),r},_createPair:function(t,e,n){if(!t||!e||t===e)throw new Error("Bad pairing: "+[JSON.stringify(t),JSON.stringify(e)]);return n=n||this._guessNameForPair(t,e),{forward:t,name:n,reverse:e}},_guessNameForPair:function(t,e,n){n=void 0!==n?n:this.removeExtensions;var i=t.name,r=e.name,a=this._naiveStartingAndEndingLCS(i.replace(new RegExp(this.filters[0]),""),r.replace(new RegExp(this.filters[1]),""));if(n){var o=a.lastIndexOf(".");if(o>0){var s=a.slice(o,a.length);a=a.replace(s,""),i=i.replace(s,""),r=r.replace(s,"")}}return a||i+" & "+r},_unpair:function(t,e){if(e=e||{},!t)throw new Error("Bad pair: "+JSON.stringify(t));return this.paired=i.without(this.paired,t),this._addToUnpaired(t.forward),this._addToUnpaired(t.reverse),e.silent||this.trigger("pair:unpair",[t]),t},unpairAll:function(){for(var t=[];this.paired.length;)t.push(this._unpair(this.paired[0],{silent:!0}));this.trigger("pair:unpair",t)},_pairToJSON:function(t){return{collection_type:"paired",src:"new_collection",name:t.name,element_identifiers:[{name:"forward",id:t.forward.id,src:t.forward.src||"hda"},{name:"reverse",id:t.reverse.id,src:t.reverse.src||"hda"}]}},createList:function(t){var e=this,n=Galaxy.root+"api/histories/"+this.historyId+"/contents/dataset_collections",a={type:"dataset_collection",collection_type:"list:paired",hide_source_items:e.hideOriginals||!1,name:i.escape(t||e.$(".collection-name").val()),element_identifiers:e.paired.map(function(t){return e._pairToJSON(t)})};return e.blocking=!0,r.ajax(n,{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(a)}).always(function(){e.blocking=!1}).fail(function(t,n,i){e._ajaxErrHandler(t,n,i)}).done(function(t,n,i){e.trigger("collection:created",t,n,i),e.metric("collection:created",t),"function"==typeof e.oncreate&&e.oncreate.call(this,t,n,i)})},_ajaxErrHandler:function(t,e,n){this.error(t,e,n);var i=this,r=(0,v.default)("An error occurred while creating this collection");t&&(0===t.readyState&&0===t.status?r+=": "+(0,v.default)("Galaxy could not be reached and may be updating.")+(0,v.default)(" Try again in a few minutes."):t.responseJSON?r+="<br /><pre>"+JSON.stringify(t.responseJSON)+"</pre>":r+=": "+n),i._showAlert(r,"alert-danger")},render:function(t,e){return this.$el.empty().html(this.templates.main()),this._renderHeader(t),this._renderMiddle(t),this._renderFooter(t),this._addPluginComponents(),this.trigger("rendered",this),this},_renderHeader:function(t,e){var n=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(a(this.templates.helpContent()));return this._renderFilters(),n},_renderFilters:function(){return this.$(".forward-column .column-header input").val(this.filters[0]).add(this.$(".reverse-column .column-header input").val(this.filters[1]))},_renderMiddle:function(t,e){var n=this.$(".middle").empty().html(this.templates.middle());return this.unpairedPanelHidden?this.$(".unpaired-columns").hide():this.pairedPanelHidden&&this.$(".paired-columns").hide(),this._renderUnpaired(),this._renderPaired(),n},_renderUnpaired:function(t,e){var n,i,r=this,a=[],o=this._splitByFilters();return this.$(".forward-column .title").text([o[0].length,(0,v.default)("unpaired forward")].join(" ")),this.$(".forward-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-o[0].length)),this.$(".reverse-column .title").text([o[1].length,(0,v.default)("unpaired reverse")].join(" ")),this.$(".reverse-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-o[1].length)),this.$(".unpaired-columns .column-datasets").empty(),this.$(".autopair-link").toggle(0!==this.unpaired.length),0===this.unpaired.length?void this._renderUnpairedEmpty():(i=o[1].map(function(t,e){return void 0!==o[0][e]&&o[0][e]!==t&&a.push(r._renderPairButton()),r._renderUnpairedDataset(t)}),n=o[0].map(function(t){return r._renderUnpairedDataset(t)}),n.length||i.length?(this.$(".unpaired-columns .forward-column .column-datasets").append(n).add(this.$(".unpaired-columns .paired-column .column-datasets").append(a)).add(this.$(".unpaired-columns .reverse-column .column-datasets").append(i)),void this._adjUnpairedOnScrollbar()):void this._renderUnpairedNotShown())},_renderUnpairedDisplayStr:function(t){return["(",t," ",(0,v.default)("filtered out"),")"].join("")},_renderUnpairedDataset:function(t){return a("<li/>").attr("id","dataset-"+t.id).addClass("dataset unpaired").attr("draggable",!0).addClass(t.selected?"selected":"").append(a("<span/>").addClass("dataset-name").text(t.name)).data("dataset",t)},_renderPairButton:function(){return a("<li/>").addClass("dataset unpaired").append(a("<span/>").addClass("dataset-name").text((0,v.default)("Pair these datasets")))},_renderUnpairedEmpty:function(){var t=a('<div class="empty-message"></div>').text("("+(0,v.default)("no remaining unpaired datasets")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(t),t},_renderUnpairedNotShown:function(){var t=a('<div class="empty-message"></div>').text("("+(0,v.default)("no datasets were found matching the current filters")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(t),t},_adjUnpairedOnScrollbar:function(){var t=this.$(".unpaired-columns").last(),e=this.$(".unpaired-columns .reverse-column .dataset").first();if(e.length){var n=t.offset().left+t.outerWidth(),i=e.offset().left+e.outerWidth(),r=Math.floor(n)-Math.floor(i);this.$(".unpaired-columns .forward-column").css("margin-left",r>0?r:0)}},_renderPaired:function(t,e){if(this.$(".paired-column-title .title").text([this.paired.length,(0,v.default)("paired")].join(" ")),this.$(".unpair-all-link").toggle(0!==this.paired.length),0===this.paired.length)return void this._renderPairedEmpty();this.$(".remove-extensions-link").show(),this.$(".paired-columns .column-datasets").empty();var n=this;this.paired.forEach(function(t,e){var i=new y({pair:t});n.$(".paired-columns .column-datasets").append(i.render().$el).append(['<button class="unpair-btn">','<span class="fa fa-unlink" title="',(0,v.default)("Unpair"),'"></span>',"</button>"].join(""))})},_renderPairedEmpty:function(){var t=a('<div class="empty-message"></div>').text("("+(0,v.default)("no paired datasets yet")+")");return this.$(".paired-columns .column-datasets").empty().prepend(t),t},footerSettings:{".hide-originals":"hideOriginals",".remove-extensions":"removeExtensions"},_addPluginComponents:function(){this._chooseFiltersPopover(".choose-filters-link"),this.$(".help-content i").hoverhighlight(".collection-creator","rgba( 64, 255, 255, 1.0 )")},_chooseFiltersPopover:function(t){function e(t,e){return['<button class="filter-choice btn" ','data-forward="',t,'" data-reverse="',e,'">',(0,v.default)("Forward"),": ",t,", ",(0,v.default)("Reverse"),": ",e,"</button>"].join("")}var n=a(i.template(['<div class="choose-filters">','<div class="help">',(0,v.default)("Choose from the following filters to change which unpaired reads are shown in the display"),":</div>",i.values(this.commonFilters).map(function(t){return e(t[0],t[1])}).join(""),"</div>"].join(""))({}));return this.$(t).popover({container:".collection-creator",placement:"bottom",html:!0,content:n})},_validationWarning:function(t,e){"name"===t&&(t=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),e?(t=t||this.$(".validation-warning"),t.removeClass("validation-warning")):t.addClass("validation-warning")},_setUpBehaviors:function(){return this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("pair:new",function(){this._renderUnpaired(),this._renderPaired(),this.$(".paired-columns").scrollTop(8e6)}),this.on("pair:unpair",function(t){this._renderUnpaired(),this._renderPaired(),this.splitView()}),this.on("filter-change",function(){this.filters=[this.$(".forward-unpaired-filter input").val(),this.$(".reverse-unpaired-filter input").val()],this.metric("filter-change",this.filters),this._renderFilters(),this._renderUnpaired()}),this.on("autopair",function(){this._renderUnpaired(),this._renderPaired();var t,e=null;this.paired.length?(e="alert-success",t=this.paired.length+" "+(0,v.default)("pairs created"),this.unpaired.length||(t+=": "+(0,v.default)("all datasets have been successfully paired"),this.hideUnpaired(),this.$(".collection-name").focus())):t=(0,v.default)(["Could not automatically create any pairs from the given dataset names.","You may want to choose or enter different filters and try auto-pairing again.","Close this message using the X on the right to view more help."].join(" ")),this._showAlert(t,e)}),this},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .forward-column .column-title":"_clickShowOnlyUnpaired","click .reverse-column .column-title":"_clickShowOnlyUnpaired","click .unpair-all-link":"_clickUnpairAll","change .forward-unpaired-filter input":function(t){this.trigger("filter-change")},"focus .forward-unpaired-filter input":function(t){a(t.currentTarget).select()},"click .autopair-link":"_clickAutopair","click .choose-filters .filter-choice":"_clickFilterChoice","click .clear-filters-link":"_clearFilters","change .reverse-unpaired-filter input":function(t){this.trigger("filter-change")},"focus .reverse-unpaired-filter input":function(t){a(t.currentTarget).select()},"click .forward-column .dataset.unpaired":"_clickUnpairedDataset","click .reverse-column .dataset.unpaired":"_clickUnpairedDataset","click .paired-column .dataset.unpaired":"_clickPairRow","click .unpaired-columns":"clearSelectedUnpaired","mousedown .unpaired-columns .dataset":"_mousedownUnpaired","click .paired-column-title":"_clickShowOnlyPaired","mousedown .flexible-partition-drag":"_startPartitionDrag","click .paired-columns .dataset.paired":"selectPair","click .paired-columns":"clearSelectedPaired","click .paired-columns .pair-name":"_clickPairName","click .unpair-btn":"_clickUnpair","dragover .paired-columns .column-datasets":"_dragoverPairedColumns","drop .paired-columns .column-datasets":"_dropPairedColumns","pair.dragstart .paired-columns .column-datasets":"_pairDragstart","pair.dragend   .paired-columns .column-datasets":"_pairDragend","change .remove-extensions":function(t){this.toggleExtensions()},"change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},_clickShowOnlyUnpaired:function(t){this.$(".paired-columns").is(":visible")?this.hidePaired():this.splitView()},_clickShowOnlyPaired:function(t){this.$(".unpaired-columns").is(":visible")?this.hideUnpaired():this.splitView()},hideUnpaired:function(t,e){this.unpairedPanelHidden=!0,this.pairedPanelHidden=!1,this._renderMiddle(t,e)},hidePaired:function(t,e){this.unpairedPanelHidden=!1,this.pairedPanelHidden=!0,this._renderMiddle(t,e)},splitView:function(t,e){return this.unpairedPanelHidden=this.pairedPanelHidden=!1,this._renderMiddle(t,e),this},_clickUnpairAll:function(t){this.metric("unpairAll"),this.unpairAll()},_clickAutopair:function(t){var e=this.autoPair();this.metric("autopair",e.length,this.unpaired.length),this.trigger("autopair")},_clickFilterChoice:function(t){var e=a(t.currentTarget);this.$(".forward-unpaired-filter input").val(e.data("forward")),this.$(".reverse-unpaired-filter input").val(e.data("reverse")),this._hideChooseFilters(),this.trigger("filter-change")},_hideChooseFilters:function(){this.$(".choose-filters-link").popover("hide"),this.$(".popover").css("display","none")},_clearFilters:function(t){this.$(".forward-unpaired-filter input").val(""),this.$(".reverse-unpaired-filter input").val(""),this.trigger("filter-change")},_clickUnpairedDataset:function(t){return t.stopPropagation(),this.toggleSelectUnpaired(a(t.currentTarget))},toggleSelectUnpaired:function(t,e){e=e||{};var n=t.data("dataset"),i=void 0!==e.force?e.force:!t.hasClass("selected");return t.length&&void 0!==n?(i?(t.addClass("selected"),e.waitToPair||this.pairAllSelected()):t.removeClass("selected"),t):t},pairAllSelected:function(t){t=t||{};var e=this,n=[],i=[],r=[];return e.$(".unpaired-columns .forward-column .dataset.selected").each(function(){n.push(a(this).data("dataset"))}),e.$(".unpaired-columns .reverse-column .dataset.selected").each(function(){i.push(a(this).data("dataset"))}),n.length=i.length=Math.min(n.length,i.length),n.forEach(function(t,n){try{r.push(e._pair(t,i[n],{silent:!0}))}catch(t){e.error(t)}}),r.length&&!t.silent&&this.trigger("pair:new",r),r},clearSelectedUnpaired:function(){this.$(".unpaired-columns .dataset.selected").removeClass("selected")},_mousedownUnpaired:function(t){if(t.shiftKey){var e=this,n=a(t.target).addClass("selected"),i=function(t){e.$(t.target).filter(".dataset").addClass("selected")};n.parent().on("mousemove",i),a(document).one("mouseup",function(t){n.parent().off("mousemove",i),e.pairAllSelected()})}},_clickPairRow:function(t){var e=a(t.currentTarget).index(),n=a(".unpaired-columns .forward-column .dataset").eq(e).data("dataset"),i=a(".unpaired-columns .reverse-column .dataset").eq(e).data("dataset");this._pair(n,i)},_startPartitionDrag:function(t){function e(t){i.$(".flexible-partition-drag").css("color",""),a("body").css("cursor","").unbind("mousemove",n)}function n(t){var e=t.pageY-r;i.adjPartition(e)||a("body").trigger("mouseup"),i._adjUnpairedOnScrollbar(),r+=e}var i=this,r=t.pageY;a("body").css("cursor","ns-resize"),i.$(".flexible-partition-drag").css("color","black"),a("body").mousemove(n),a("body").one("mouseup",e)},adjPartition:function(t){var e=this.$(".unpaired-columns"),n=this.$(".paired-columns"),i=parseInt(e.css("height"),10),r=parseInt(n.css("height"),10);i=Math.max(10,i+t),r-=t;var a=t<0;if(a){if(this.unpairedPanelHidden)return!1;if(i<=10)return this.hideUnpaired(),!1}else this.unpairedPanelHidden&&(e.show(),this.unpairedPanelHidden=!1);if(a)this.pairedPanelHidden&&(n.show(),this.pairedPanelHidden=!1);else{if(this.pairedPanelHidden)return!1;if(r<=15)return this.hidePaired(),!1}return e.css({height:i+"px",flex:"0 0 auto"}),!0},selectPair:function(t){t.stopPropagation(),a(t.currentTarget).toggleClass("selected")},clearSelectedPaired:function(t){this.$(".paired-columns .dataset.selected").removeClass("selected")},_clickPairName:function(t){t.stopPropagation();var e=a(t.currentTarget),n=e.parent().parent(),i=n.index(".dataset.paired"),r=this.paired[i],o=prompt("Enter a new name for the pair:",r.name);o&&(r.name=o,r.customizedName=!0,e.text(r.name))},_clickUnpair:function(t){var e=Math.floor(a(t.currentTarget).index(".unpair-btn"));this._unpair(this.paired[e])},_dragoverPairedColumns:function(t){t.preventDefault();var e=this.$(".paired-columns .column-datasets");this._checkForAutoscroll(e,t.originalEvent.clientY);var n=this._getNearestPairedDatasetLi(t.originalEvent.clientY);a(".element-drop-placeholder").remove();var i=a('<div class="element-drop-placeholder"></div>');n.length?n.before(i):e.append(i)},_checkForAutoscroll:function(t,e){var n=t.offset(),i=t.scrollTop(),r=e-n.top,a=n.top+t.outerHeight()-e;r>=0&&r<this.autoscrollDist?t.scrollTop(i-2):a>=0&&a<this.autoscrollDist&&t.scrollTop(i+2)},_getNearestPairedDatasetLi:function(t){for(var e=this.$(".paired-columns .column-datasets li").toArray(),n=0;n<e.length;n++){var i=a(e[n]),r=i.offset().top,o=Math.floor(i.outerHeight()/2)+4;if(r+o>t&&r-o<t)return i}return a()},_dropPairedColumns:function(t){t.preventDefault(),t.dataTransfer.dropEffect="move";var e=this._getNearestPairedDatasetLi(t.originalEvent.clientY);return e.length?this.$dragging.insertBefore(e):this.$dragging.insertAfter(this.$(".paired-columns .unpair-btn").last()),this._syncPairsToDom(),!1},_syncPairsToDom:function(){var t=[];this.$(".paired-columns .dataset.paired").each(function(){t.push(a(this).data("pair"))}),this.paired=t,this._renderPaired()},_pairDragstart:function(t,e){e.$el.addClass("selected");var n=this.$(".paired-columns .dataset.selected");this.$dragging=n},_pairDragend:function(t,e){a(".element-drop-placeholder").remove(),this.$dragging=null},toggleExtensions:function(t){var e=this;e.removeExtensions=void 0!==t?t:!e.removeExtensions,i.each(e.paired,function(t){t.customizedName||(t.name=e._guessNameForPair(t.forward,t.reverse))}),e._renderPaired(),e._renderFooter()},_printList:function(t){var e=this;i.each(t,function(n){t===e.paired?e._printPair(n):e.debug(n)})},_printPair:function(t){this.debug(t.forward.name,t.reverse.name,": ->",t.name)},toString:function(){return"PairedCollectionCreator"},templates:i.extend({},p.default.CollectionCreatorMixin._creatorTemplates,{header:i.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',(0,v.default)("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',(0,v.default)("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>",'<div class="column-headers vertically-spaced flex-column-container">','<div class="forward-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',(0,v.default)("Unpaired forward"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter forward-unpaired-filter float-left">','<input class="search-query" placeholder="',(0,v.default)("Filter this list"),'" />',"</div>","</div>","</div>",'<div class="paired-column flex-column no-flex column">','<div class="column-header">','<a class="choose-filters-link" href="javascript:void(0)">',(0,v.default)("Choose filters"),"</a>",'<a class="clear-filters-link" href="javascript:void(0);">',(0,v.default)("Clear filters"),"</a><br />",'<a class="autopair-link" href="javascript:void(0);">',(0,v.default)("Auto-pair"),"</a>","</div>","</div>",'<div class="reverse-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',(0,v.default)("Unpaired reverse"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter reverse-unpaired-filter float-left">','<input class="search-query" placeholder="',(0,v.default)("Filter this list"),'" />',"</div>","</div>","</div>","</div>"].join("")),middle:i.template(['<div class="unpaired-columns flex-column-container scroll-container flex-row">','<div class="forward-column flex-column column">','<ol class="column-datasets"></ol>',"</div>",'<div class="paired-column flex-column no-flex column">','<ol class="column-datasets"></ol>',"</div>",'<div class="reverse-column flex-column column">','<ol class="column-datasets"></ol>',"</div>","</div>",'<div class="flexible-partition">','<div class="flexible-partition-drag" title="',(0,v.default)("Drag to change"),'"></div>','<div class="column-header">','<div class="column-title paired-column-title">','<span class="title"></span>',"</div>",'<a class="unpair-all-link" href="javascript:void(0);">',(0,v.default)("Unpair all"),"</a>","</div>","</div>",'<div class="paired-columns flex-column-container scroll-container flex-row">','<ol class="column-datasets"></ol>',"</div>"].join("")),footer:i.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt float-right">',(0,v.default)("Hide original elements"),"?",'<input class="hide-originals float-right" type="checkbox" />',"</label>",'<label class="setting-prompt float-right">',(0,v.default)("Remove file extensions from pair names"),"?",'<input class="remove-extensions float-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control float-right" ','placeholder="',(0,v.default)("Enter a name for your new list"),'" />','<div class="collection-name-prompt float-right">',(0,v.default)("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options float-left">','<button class="cancel-create btn" tabindex="-1">',(0,v.default)("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">',(0,v.default)("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',(0,v.default)("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',(0,v.default)("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options float-right">','<button class="create-collection btn btn-primary">',(0,v.default)("Create list"),"</button>","</div>","</div>"].join("")),helpContent:i.template(["<p>",(0,v.default)(["Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ","These collections can be passed to tools and workflows in order to have analyses done on each member of ","the entire group. This interface allows you to create a collection, choose which datasets are paired, ","and re-order the final collection."].join("")),"</p>","<p>",(0,v.default)(['Unpaired datasets are shown in the <i data-target=".unpaired-columns">unpaired section</i> ',"(hover over the underlined words to highlight below). ",'Paired datasets are shown in the <i data-target=".paired-columns">paired section</i>.',"<ul>To pair datasets, you can:","<li>Click a dataset in the ",'<i data-target=".unpaired-columns .forward-column .column-datasets,','.unpaired-columns .forward-column">forward column</i> ',"to select it then click a dataset in the ",'<i data-target=".unpaired-columns .reverse-column .column-datasets,','.unpaired-columns .reverse-column">reverse column</i>.',"</li>",'<li>Click one of the "Pair these datasets" buttons in the ','<i data-target=".unpaired-columns .paired-column .column-datasets,','.unpaired-columns .paired-column">middle column</i> ',"to pair the datasets in a particular row.","</li>",'<li>Click <i data-target=".autopair-link">"Auto-pair"</i> ',"to have your datasets automatically paired based on name.","</li>","</ul>"].join("")),"</p>","<p>",(0,v.default)(["<ul>You can filter what is shown in the unpaired sections by:","<li>Entering partial dataset names in either the ",'<i data-target=".forward-unpaired-filter input">forward filter</i> or ','<i data-target=".reverse-unpaired-filter input">reverse filter</i>.',"</li>","<li>Choosing from a list of preset filters by clicking the ",'<i data-target=".choose-filters-link">"Choose filters" link</i>.',"</li>","<li>Entering regular expressions to match dataset names. See: ",'<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"',' target="_blank">MDN\'s JavaScript Regular Expression Tutorial</a>. ',"Note: forward slashes (\\) are not needed.","</li>","<li>Clearing the filters by clicking the ",'<i data-target=".clear-filters-link">"Clear filters" link</i>.',"</li>","</ul>"].join("")),"</p>","<p>",(0,v.default)(["To unpair individual dataset pairs, click the ",'<i data-target=".unpair-btn">unpair buttons ( <span class="fa fa-unlink"></span> )</i>. ','Click the <i data-target=".unpair-all-link">"Unpair all" link</i> to unpair all pairs.'].join("")),"</p>","<p>",(0,v.default)(['You can include or remove the file extensions (e.g. ".fastq") from your pair names by toggling the ','<i data-target=".remove-extensions-prompt">"Remove file extensions from pair names?"</i> control.'].join("")),"</p>","<p>",(0,v.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>. ',"(Note: you do not have to pair all unpaired datasets to finish.)"].join("")),"</p>"].join(""))})}),w=function(t,e){var n,a=r.Deferred();if(e=i.defaults(e||{},{datasets:t,oncancel:function(){Galaxy.modal.hide(),a.reject("cancelled")},oncreate:function(t,e){Galaxy.modal.hide(),a.resolve(e)},title:(0,v.default)("Create a collection of paired datasets")}),!window.Galaxy||!Galaxy.modal)throw new Error("Galaxy or Galaxy.modal not found");return n=new b(e),Galaxy.modal.show({title:e.title,body:n.$el,width:"80%",height:"800px",closing_events:!0}),n.render(),window.creator=n,a};e.default={PairedCollectionCreator:b,pairedCollectionCreatorModal:w,createListOfPairsCollection:l}}).call(e,n(2),n(1),n(0),n(0))},function(t,e,n){var i,r;!function(){function a(t){return t&&(t.ownerDocument||t.document||t).documentElement}function o(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}function s(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function l(t){return null===t?NaN:+t}function c(t){return!isNaN(t)}function d(t){return{left:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)<0?i=a+1:r=a}return i},right:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)>0?r=a:i=a+1}return i}}}function u(t){return t.length}function h(t){for(var e=1;t*e%1;)e*=10;return e}function f(t,e){for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}function p(){this._=Object.create(null)}function _(t){return(t+="")===Mo||t[0]===Co?Co+t:t}function g(t){return(t+="")[0]===Co?t.slice(1):t}function m(t){return _(t)in this._}function v(t){return(t=_(t))in this._&&delete this._[t]}function y(){var t=[];for(var e in this._)t.push(g(e));return t}function b(){var t=0;for(var e in this._)++t;return t}function w(){for(var t in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(t){return t}function M(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}function C(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var n=0,i=So.length;n<i;++n){var r=So[n]+e;if(r in t)return r}}function S(){}function T(){}function A(t){function e(){for(var e,i=n,r=-1,a=i.length;++r<a;)(e=i[r].on)&&e.apply(this,arguments);return t}var n=[],i=new p;return e.on=function(e,r){var a,o=i.get(e);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(e)),r&&n.push(i.set(e,{on:r})),t)},e}function j(){fo.event.preventDefault()}function E(){for(var t,e=fo.event;t=e.sourceEvent;)e=t;return e}function O(t){for(var e=new T,n=0,i=arguments.length;++n<i;)e[arguments[n]]=A(e);return e.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=t,fo.event=r,e[r.type].apply(n,i)}finally{fo.event=a}}},e}function L(t){return Ao(t,Lo),t}function N(t){return"function"==typeof t?t:function(){return jo(t,this)}}function I(t){return"function"==typeof t?t:function(){return Eo(t,this)}}function P(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function r(){this.setAttribute(t,e)}function a(){this.setAttributeNS(t.space,t.local,e)}function o(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=fo.ns.qualify(t),null==e?t.local?i:n:"function"==typeof e?t.local?s:o:t.local?a:r}function D(t){return t.trim().replace(/\s+/g," ")}function R(t){return new RegExp("(?:^|\\s+)"+fo.requote(t)+"(?:\\s+|$)","g")}function z(t){return(t+"").trim().split(/^|\s+/)}function $(t,e){function n(){for(var n=-1;++n<r;)t[n](this,e)}function i(){for(var n=-1,i=e.apply(this,arguments);++n<r;)t[n](this,i)}t=z(t).map(W);var r=t.length;return"function"==typeof e?i:n}function W(t){var e=R(t);return function(n,i){if(r=n.classList)return i?r.add(t):r.remove(t);var r=n.getAttribute("class")||"";i?(e.lastIndex=0,e.test(r)||n.setAttribute("class",D(r+" "+t))):n.setAttribute("class",D(r.replace(e," ")))}}function G(t,e,n){function i(){this.style.removeProperty(t)}function r(){this.style.setProperty(t,e,n)}function a(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return null==e?i:"function"==typeof e?a:r}function V(t,e){function n(){delete this[t]}function i(){this[t]=e}function r(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?r:i}function H(t){function e(){var e=this.ownerDocument,n=this.namespaceURI;return n===No&&e.documentElement.namespaceURI===No?e.createElement(t):e.createElementNS(n,t)}function n(){return this.ownerDocument.createElementNS(t.space,t.local)}return"function"==typeof t?t:(t=fo.ns.qualify(t)).local?n:e}function F(){var t=this.parentNode;t&&t.removeChild(this)}function Y(t){return{__data__:t}}function q(t){return function(){return Oo(this,t)}}function U(t){return arguments.length||(t=s),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function B(t,e){for(var n=0,i=t.length;n<i;n++)for(var r,a=t[n],o=0,s=a.length;o<s;o++)(r=a[o])&&e(r,o,n);return t}function X(t){return Ao(t,Po),t}function J(t){var e,n;return function(i,r,a){var o,s=t[a].update,l=s.length;for(a!=n&&(n=a,e=0),r>=e&&(e=r+1);!(o=s[e])&&++e<l;);return o}}function Q(t,e,n){function i(){var e=this[o];e&&(this.removeEventListener(t,e,e.$),delete this[o])}function r(){var r=l(e,_o(arguments));i.call(this),this.addEventListener(t,this[o]=r,r.$=n),r._=e}function a(){var e,n=new RegExp("^__on([^.]+)"+fo.requote(t)+"$");for(var i in this)if(e=i.match(n)){var r=this[i];this.removeEventListener(e[1],r,r.$),delete this[i]}}var o="__on"+t,s=t.indexOf("."),l=K;s>0&&(t=t.slice(0,s));var c=Do.get(t);return c&&(t=c,l=Z),s?e?r:i:e?S:a}function K(t,e){return function(n){var i=fo.event;fo.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{fo.event=i}}}function Z(t,e){var n=K(t,e);return function(t){var e=this,i=t.relatedTarget;i&&(i===e||8&i.compareDocumentPosition(e))||n.call(e,t)}}function tt(t){var e=".dragsuppress-"+ ++zo,n="click"+e,i=fo.select(o(t)).on("touchmove"+e,j).on("dragstart"+e,j).on("selectstart"+e,j);if(null==Ro&&(Ro=!("onselectstart"in t)&&C(t.style,"userSelect")),Ro){var r=a(t).style,s=r[Ro];r[Ro]="none"}return function(t){if(i.on(e,null),Ro&&(r[Ro]=s),t){var a=function(){i.on(n,null)};i.on(n,function(){j(),a()},!0),setTimeout(a,0)}}}function et(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if($o<0){var r=o(t);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();$o=!(a.f||a.e),n.remove()}}return $o?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}function nt(){return fo.event.changedTouches[0].identifier}function it(t){return t>0?1:t<0?-1:0}function rt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function at(t){return t>1?0:t<-1?Vo:Math.acos(t)}function ot(t){return t>1?Yo:t<-1?-Yo:Math.asin(t)}function st(t){return((t=Math.exp(t))-1/t)/2}function lt(t){return((t=Math.exp(t))+1/t)/2}function ct(t){return((t=Math.exp(2*t))-1)/(t+1)}function dt(t){return(t=Math.sin(t/2))*t}function ut(){}function ht(t,e,n){return this instanceof ht?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof ht?new ht(t.h,t.s,t.l):St(""+t,Tt,ht):new ht(t,e,n)}function ft(t,e,n){function i(t){return t>360?t-=360:t<0&&(t+=360),t<60?a+(o-a)*t/60:t<180?o:t<240?a+(o-a)*(240-t)/60:a}function r(t){return Math.round(255*i(t))}var a,o;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:e<0?0:e>1?1:e,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+e):n+e-n*e,a=2*n-o,new xt(r(t+120),r(t),r(t-120))}function pt(t,e,n){return this instanceof pt?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof pt?new pt(t.h,t.c,t.l):t instanceof gt?vt(t.l,t.a,t.b):vt((t=At((t=fo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new pt(t,e,n)}function _t(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new gt(n,Math.cos(t*=qo)*e,Math.sin(t)*e)}function gt(t,e,n){return this instanceof gt?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof gt?new gt(t.l,t.a,t.b):t instanceof pt?_t(t.h,t.c,t.l):At((t=xt(t)).r,t.g,t.b):new gt(t,e,n)}function mt(t,e,n){var i=(t+16)/116,r=i+e/500,a=i-n/200;return r=yt(r)*es,i=yt(i)*ns,a=yt(a)*is,new xt(wt(3.2404542*r-1.5371385*i-.4985314*a),wt(-.969266*r+1.8760108*i+.041556*a),wt(.0556434*r-.2040259*i+1.0572252*a))}function vt(t,e,n){return t>0?new pt(Math.atan2(n,e)*Uo,Math.sqrt(e*e+n*n),t):new pt(NaN,NaN,t)}function yt(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function bt(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function wt(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function xt(t,e,n){return this instanceof xt?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof xt?new xt(t.r,t.g,t.b):St(""+t,xt,ft):new xt(t,e,n)}function kt(t){return new xt(t>>16,t>>8&255,255&t)}function Mt(t){return kt(t)+""}function Ct(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function St(t,e,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(t=t.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(Et(r[0]),Et(r[1]),Et(r[2]))}return(a=os.get(t))?e(a.r,a.g,a.b):(null==t||"#"!==t.charAt(0)||isNaN(a=parseInt(t.slice(1),16))||(4===t.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===t.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),e(o,s,l))}function Tt(t,e,n){var i,r,a=Math.min(t/=255,e/=255,n/=255),o=Math.max(t,e,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=t==o?(e-n)/s+(e<n?6:0):e==o?(n-t)/s+2:(t-e)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new ht(i,r,l)}function At(t,e,n){t=jt(t),e=jt(e),n=jt(n);var i=bt((.4124564*t+.3575761*e+.1804375*n)/es),r=bt((.2126729*t+.7151522*e+.072175*n)/ns);return gt(116*r-16,500*(i-r),200*(r-bt((.0193339*t+.119192*e+.9503041*n)/is)))}function jt(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Et(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function Ot(t){return"function"==typeof t?t:function(){return t}}function Lt(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Nt(e,n,t,i)}}function Nt(t,e,n,i){function r(){var t,e=l.status;if(!e&&Pt(l)||e>=200&&e<300||304===e){try{t=n.call(a,l)}catch(t){return void o.error.call(a,t)}o.load.call(a,t)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(t){var e=fo.event;fo.event=t;try{o.progress.call(a,l)}finally{fo.event=e}},a.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",a)},a.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",a):e},a.responseType=function(t){return arguments.length?(c=t,a):c},a.response=function(t){return n=t,a},["get","post"].forEach(function(t){a[t]=function(){return a.send.apply(a,[t].concat(_o(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),l.setRequestHeader)for(var d in s)l.setRequestHeader(d,s[d]);return null!=e&&l.overrideMimeType&&l.overrideMimeType(e),null!=c&&(l.responseType=c),null!=r&&a.on("error",r).on("load",function(t){r(null,t)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(It(i))}function It(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Pt(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function Dt(t,e,n){var i=arguments.length;i<2&&(e=0),i<3&&(n=Date.now());var r=n+e,a={c:t,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,cs||(ds=clearTimeout(ds),cs=1,us(Rt)),a}function Rt(){var t=zt(),e=$t()-t;e>24?(isFinite(e)&&(clearTimeout(ds),ds=setTimeout(Rt,e)),cs=0):(cs=1,us(Rt))}function zt(){for(var t=Date.now(),e=ss;e;)t>=e.t&&e.c(t-e.t)&&(e.c=null),e=e.n;return t}function $t(){for(var t,e=ss,n=1/0;e;)e.c?(e.t<n&&(n=e.t),e=(t=e).n):e=t?t.n=e.n:ss=e.n;return ls=t,n}function Wt(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Gt(t,e){var n=Math.pow(10,3*ko(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Vt(t){var e=t.decimal,n=t.thousands,i=t.grouping,r=t.currency,a=i&&n?function(t,e){for(var r=t.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>e&&(s=Math.max(1,e-l)),a.push(t.substring(r-=s,r+s)),!((l+=s+1)>e));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(t){var n=fs.exec(t),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",c=n[5],d=+n[6],u=n[7],h=n[8],f=n[9],p=1,_="",g="",m=!1,v=!0;switch(h&&(h=+h.substring(1)),(c||"0"===i&&"="===o)&&(c=i="0",o="="),f){case"n":u=!0,f="g";break;case"%":p=100,g="%",f="f";break;case"p":p=100,g="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(_="0"+f.toLowerCase());case"c":v=!1;case"d":m=!0,h=0;break;case"s":p=-1,f="r"}"$"===l&&(_=r[0],g=r[1]),"r"!=f||h||(f="g"),null!=h&&("g"==f?h=Math.max(1,Math.min(21,h)):"e"!=f&&"f"!=f||(h=Math.max(0,Math.min(20,h)))),f=ps.get(f)||Ht;var y=c&&u;return function(t){var n=g;if(m&&t%1)return"";var r=t<0||0===t&&1/t<0?(t=-t,"-"):"-"===s?"":s;if(p<0){var l=fo.formatPrefix(t,h);t=l.scale(t),n=l.symbol+g}else t*=p;t=f(t,h);var b,w,x=t.lastIndexOf(".");if(x<0){var k=v?t.lastIndexOf("e"):-1;k<0?(b=t,w=""):(b=t.substring(0,k),w=t.substring(k))}else b=t.substring(0,x),w=e+t.substring(x+1);!c&&u&&(b=a(b,1/0));var M=_.length+b.length+w.length+(y?0:r.length),C=M<d?new Array(M=d-M+1).join(i):"";return y&&(b=a(C+b,C.length?d-w.length:1/0)),r+=_,t=b+w,("<"===o?r+t+C:">"===o?C+r+t:"^"===o?C.substring(0,M>>=1)+r+t+C.substring(M):r+(y?t:C+t))+n}}}function Ht(t){return t+""}function Ft(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Yt(t,e,n){function i(e){var n=t(e),i=a(n,1);return e-n<i-e?n:i}function r(n){return e(n=t(new gs(n-1)),1),n}function a(t,n){return e(t=new gs(+t),n),t}function o(t,i,a){var o=r(t),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),e(o,1);else for(;o<i;)s.push(new Date(+o)),e(o,1);return s}function s(t,e,n){try{gs=Ft;var i=new Ft;return i._=t,o(i,e,n)}finally{gs=Date}}t.floor=t,t.round=i,t.ceil=r,t.offset=a,t.range=o;var l=t.utc=qt(t);return l.floor=l,l.round=qt(i),l.ceil=qt(r),l.offset=qt(a),l.range=s,t}function qt(t){return function(e,n){try{gs=Ft;var i=new Ft;return i._=e,t(i,n)._}finally{gs=Date}}}function Ut(t){function e(t){function e(e){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(r=vs[n=t.charAt(++s)])&&(n=t.charAt(++s)),(a=A[n])&&(n=a(e,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(t.slice(l,s)),o.join("")}var i=t.length;return e.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,t,e,0)!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&gs!==Ft,a=new(r?Ft:gs);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},e.toString=function(){return t},e}function n(t,e,n,i){for(var r,a,o,s=0,l=e.length,c=n.length;s<l;){if(i>=c)return-1;if(37===(r=e.charCodeAt(s++))){if(o=e.charAt(s++),!(a=j[o in vs?e.charAt(s++):o])||(i=a(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(t,e,n){x.lastIndex=0;var i=x.exec(e.slice(n));return i?(t.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(t,e,n){b.lastIndex=0;var i=b.exec(e.slice(n));return i?(t.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function a(t,e,n){S.lastIndex=0;var i=S.exec(e.slice(n));return i?(t.m=T.get(i[0].toLowerCase()),n+i[0].length):-1}function o(t,e,n){M.lastIndex=0;var i=M.exec(e.slice(n));return i?(t.m=C.get(i[0].toLowerCase()),n+i[0].length):-1}function s(t,e,i){return n(t,A.c.toString(),e,i)}function l(t,e,i){return n(t,A.x.toString(),e,i)}function c(t,e,i){return n(t,A.X.toString(),e,i)}function d(t,e,n){var i=y.get(e.slice(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}var u=t.dateTime,h=t.date,f=t.time,p=t.periods,_=t.days,g=t.shortDays,m=t.months,v=t.shortMonths;e.utc=function(t){function n(t){try{gs=Ft;var e=new gs;return e._=t,i(e)}finally{gs=Date}}var i=e(t);return n.parse=function(t){try{gs=Ft;var e=i.parse(t);return e&&e._}finally{gs=Date}},n.toString=i.toString,n},e.multi=e.utc.multi=fe;var y=fo.map(),b=Xt(_),w=Jt(_),x=Xt(g),k=Jt(g),M=Xt(m),C=Jt(m),S=Xt(v),T=Jt(v);p.forEach(function(t,e){y.set(t.toLowerCase(),e)});var A={a:function(t){return g[t.getDay()]},A:function(t){return _[t.getDay()]},b:function(t){return v[t.getMonth()]},B:function(t){return m[t.getMonth()]},c:e(u),d:function(t,e){return Bt(t.getDate(),e,2)},e:function(t,e){return Bt(t.getDate(),e,2)},H:function(t,e){return Bt(t.getHours(),e,2)},I:function(t,e){return Bt(t.getHours()%12||12,e,2)},j:function(t,e){return Bt(1+_s.dayOfYear(t),e,3)},L:function(t,e){return Bt(t.getMilliseconds(),e,3)},m:function(t,e){return Bt(t.getMonth()+1,e,2)},M:function(t,e){return Bt(t.getMinutes(),e,2)},p:function(t){return p[+(t.getHours()>=12)]},S:function(t,e){return Bt(t.getSeconds(),e,2)},U:function(t,e){return Bt(_s.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Bt(_s.mondayOfYear(t),e,2)},x:e(h),X:e(f),y:function(t,e){return Bt(t.getFullYear()%100,e,2)},Y:function(t,e){return Bt(t.getFullYear()%1e4,e,4)},Z:ue,"%":function(){return"%"}},j={a:i,A:r,b:a,B:o,c:s,d:ae,e:ae,H:se,I:se,j:oe,L:de,m:re,M:le,p:d,S:ce,U:Kt,w:Qt,W:Zt,x:l,X:c,y:ee,Y:te,Z:ne,"%":he};return e}function Bt(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(e)+r:r)}function Xt(t){return new RegExp("^(?:"+t.map(fo.requote).join("|")+")","i")}function Jt(t){for(var e=new p,n=-1,i=t.length;++n<i;)e.set(t[n].toLowerCase(),n);return e}function Qt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Kt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.U=+i[0],n+i[0].length):-1}function Zt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.W=+i[0],n+i[0].length):-1}function te(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function ee(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.y=ie(+i[0]),n+i[0].length):-1}function ne(t,e,n){return/^[+-]\d{4}$/.test(e=e.slice(n,n+5))?(t.Z=-e,n+5):-1}function ie(t){return t+(t>68?1900:2e3)}function re(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function ae(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function oe(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.j=+i[0],n+i[0].length):-1}function se(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function le(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function ce(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function de(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function ue(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=ko(e)/60|0,r=ko(e)%60;return n+Bt(i,"0",2)+Bt(r,"0",2)}function he(t,e,n){bs.lastIndex=0;var i=bs.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function fe(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,i=t[n];!i[1](e);)i=t[++n];return i[0](e)}}function pe(){}function _e(t,e,n){var i=n.s=t+e,r=i-t,a=i-r;n.t=t-a+(e-r)}function ge(t,e){t&&Ms.hasOwnProperty(t.type)&&Ms[t.type](t,e)}function me(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function ve(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)me(t[n],e,1);e.polygonEnd()}function ye(){function t(t,e){t*=qo,e=e*qo/2+Vo/4;var n=t-i,o=n>=0?1:-1,s=o*n,l=Math.cos(e),c=Math.sin(e),d=a*c,u=r*l+d*Math.cos(s),h=d*o*Math.sin(s);Ss.add(Math.atan2(h,u)),i=t,r=l,a=c}var e,n,i,r,a;Ts.point=function(o,s){Ts.point=t,i=(e=o)*qo,r=Math.cos(s=(n=s)*qo/2+Vo/4),a=Math.sin(s)},Ts.lineEnd=function(){t(e,n)}}function be(t){var e=t[0],n=t[1],i=Math.cos(n);return[i*Math.cos(e),i*Math.sin(e),Math.sin(n)]}function we(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xe(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ke(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Me(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Ce(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Se(t){return[Math.atan2(t[1],t[0]),ot(t[2])]}function Te(t,e){return ko(t[0]-e[0])<Wo&&ko(t[1]-e[1])<Wo}function Ae(t,e){t*=qo;var n=Math.cos(e*=qo);je(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function je(t,e,n){++As,Es+=(t-Es)/As,Os+=(e-Os)/As,Ls+=(n-Ls)/As}function Ee(){function t(t,r){t*=qo;var a=Math.cos(r*=qo),o=a*Math.cos(t),s=a*Math.sin(t),l=Math.sin(r),c=Math.atan2(Math.sqrt((c=n*l-i*s)*c+(c=i*o-e*l)*c+(c=e*s-n*o)*c),e*o+n*s+i*l);js+=c,Ns+=c*(e+(e=o)),Is+=c*(n+(n=s)),Ps+=c*(i+(i=l)),je(e,n,i)}var e,n,i;$s.point=function(r,a){r*=qo;var o=Math.cos(a*=qo);e=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),$s.point=t,je(e,n,i)}}function Oe(){$s.point=Ae}function Le(){function t(t,e){t*=qo;var n=Math.cos(e*=qo),o=n*Math.cos(t),s=n*Math.sin(t),l=Math.sin(e),c=r*l-a*s,d=a*o-i*l,u=i*s-r*o,h=Math.sqrt(c*c+d*d+u*u),f=i*o+r*s+a*l,p=h&&-at(f)/h,_=Math.atan2(h,f);Ds+=p*c,Rs+=p*d,zs+=p*u,js+=_,Ns+=_*(i+(i=o)),Is+=_*(r+(r=s)),Ps+=_*(a+(a=l)),je(i,r,a)}var e,n,i,r,a;$s.point=function(o,s){e=o,n=s,$s.point=t,o*=qo;var l=Math.cos(s*=qo);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),je(i,r,a)},$s.lineEnd=function(){t(e,n),$s.lineEnd=Oe,$s.point=Ae}}function Ne(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function Ie(){return!0}function Pe(t,e,n,i,r){var a=[],o=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],i=t[e];if(Te(n,i)){r.lineStart();for(var s=0;s<e;++s)r.point((n=t[s])[0],n[1]);return void r.lineEnd()}var l=new Re(n,t,null,!0),c=new Re(n,null,l,!1);l.o=c,a.push(l),o.push(c),l=new Re(i,t,null,!1),c=new Re(i,null,l,!0),l.o=c,a.push(l),o.push(c)}}),o.sort(e),De(a),De(o),a.length){for(var s=0,l=n,c=o.length;s<c;++s)o[s].e=l=!l;for(var d,u,h=a[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;d=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,c=d.length;s<c;++s)r.point((u=d[s])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(p){d=f.p.z;for(var s=d.length-1;s>=0;--s)r.point((u=d[s])[0],u[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,d=f.z,p=!p}while(!f.v);r.lineEnd()}}}function De(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function Re(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function ze(t,e,n,i){return function(r,a){function o(e,n){var i=r(e,n);t(e=i[0],n=i[1])&&a.point(e,n)}function s(t,e){var n=r(t,e);g.point(n[0],n[1])}function l(){v.point=s,g.lineStart()}function c(){v.point=o,g.lineEnd()}function d(t,e){_.push([t,e]);var n=r(t,e);b.point(n[0],n[1])}function u(){b.lineStart(),_=[]}function h(){d(_[0][0],_[0][1]),b.lineEnd();var t,e=b.clean(),n=y.buffer(),i=n.length;if(_.pop(),p.push(_),_=null,i)if(1&e){t=n[0];var r,i=t.length-1,o=-1;if(i>0){for(w||(a.polygonStart(),w=!0),a.lineStart();++o<i;)a.point((r=t[o])[0],r[1]);a.lineEnd()}}else i>1&&2&e&&n.push(n.pop().concat(n.shift())),f.push(n.filter($e))}var f,p,_,g=e(a),m=r.invert(i[0],i[1]),v={point:o,lineStart:l,lineEnd:c,polygonStart:function(){v.point=d,v.lineStart=u,v.lineEnd=h,f=[],p=[]},polygonEnd:function(){v.point=o,v.lineStart=l,v.lineEnd=c,f=fo.merge(f);var t=Ye(m,p);f.length?(w||(a.polygonStart(),w=!0),Pe(f,Ge,t,n,a)):t&&(w||(a.polygonStart(),w=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),f=p=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=We(),b=e(y),w=!1;return v}}function $e(t){return t.length>1}function We(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:S,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function Ge(t,e){return((t=t.x)[0]<0?t[1]-Yo-Wo:Yo-t[1])-((e=e.x)[0]<0?e[1]-Yo-Wo:Yo-e[1])}function Ve(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?Vo:-Vo,l=ko(a-n);ko(l-Vo)<Wo?(t.point(n,i=(i+o)/2>0?Yo:-Yo),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(a,i),e=0):r!==s&&l>=Vo&&(ko(n-r)<Wo&&(n-=r*Wo),ko(a-s)<Wo&&(a-=s*Wo),i=He(n,i,a,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=a,i=o),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}function He(t,e,n,i){var r,a,o=Math.sin(t-n);return ko(o)>Wo?Math.atan((Math.sin(e)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(e))*Math.sin(t))/(r*a*o)):(e+i)/2}function Fe(t,e,n,i){var r;if(null==t)r=n*Yo,i.point(-Vo,r),i.point(0,r),i.point(Vo,r),i.point(Vo,0),i.point(Vo,-r),i.point(0,-r),i.point(-Vo,-r),i.point(-Vo,0),i.point(-Vo,r);else if(ko(t[0]-e[0])>Wo){var a=t[0]<e[0]?Vo:-Vo;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])}function Ye(t,e){var n=t[0],i=t[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Ss.reset();for(var s=0,l=e.length;s<l;++s){var c=e[s],d=c.length;if(d)for(var u=c[0],h=u[0],f=u[1]/2+Vo/4,p=Math.sin(f),_=Math.cos(f),g=1;;){g===d&&(g=0),t=c[g];var m=t[0],v=t[1]/2+Vo/4,y=Math.sin(v),b=Math.cos(v),w=m-h,x=w>=0?1:-1,k=x*w,M=k>Vo,C=p*y;if(Ss.add(Math.atan2(C*x*Math.sin(k),_*b+C*Math.cos(k))),a+=M?w+x*Ho:w,M^h>=n^m>=n){var S=xe(be(u),be(t));Ce(S);var T=xe(r,S);Ce(T);var A=(M^w>=0?-1:1)*ot(T[2]);(i>A||i===A&&(S[0]||S[1]))&&(o+=M^w>=0?1:-1)}if(!g++)break;h=m,p=y,_=b,u=t}}return(a<-Wo||a<Wo&&Ss<-Wo)^1&o}function qe(t){function e(t,e){return Math.cos(t)*Math.cos(e)>a}function n(t){var n,a,l,c,d;return{lineStart:function(){c=l=!1,d=1},point:function(u,h){var f,p=[u,h],_=e(u,h),g=o?_?0:r(u,h):_?r(u+(u<0?Vo:-Vo),h):0;if(!n&&(c=l=_)&&t.lineStart(),_!==l&&(f=i(n,p),(Te(n,f)||Te(p,f))&&(p[0]+=Wo,p[1]+=Wo,_=e(p[0],p[1]))),_!==l)d=0,_?(t.lineStart(),f=i(p,n),t.point(f[0],f[1])):(f=i(n,p),t.point(f[0],f[1]),t.lineEnd()),n=f;else if(s&&n&&o^_){var m;g&a||!(m=i(p,n,!0))||(d=0,o?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1])))}!_||n&&Te(n,p)||t.point(p[0],p[1]),n=p,l=_,a=g},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return d|(c&&l)<<1}}}function i(t,e,n){var i=be(t),r=be(e),o=[1,0,0],s=xe(i,r),l=we(s,s),c=s[0],d=l-c*c;if(!d)return!n&&t;var u=a*l/d,h=-a*c/d,f=xe(o,s),p=Me(o,u);ke(p,Me(s,h));var _=f,g=we(p,_),m=we(_,_),v=g*g-m*(we(p,p)-1);if(!(v<0)){var y=Math.sqrt(v),b=Me(_,(-g-y)/m);if(ke(b,p),b=Se(b),!n)return b;var w,x=t[0],k=e[0],M=t[1],C=e[1];k<x&&(w=x,x=k,k=w);var S=k-x,T=ko(S-Vo)<Wo,A=T||S<Wo;if(!T&&C<M&&(w=M,M=C,C=w),A?T?M+C>0^b[1]<(ko(b[0]-x)<Wo?M:C):M<=b[1]&&b[1]<=C:S>Vo^(x<=b[0]&&b[0]<=k)){var j=Me(_,(-g+y)/m);return ke(j,p),[b,Se(j)]}}}function r(e,n){var i=o?t:Vo-t,r=0;return e<-i?r|=1:e>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(t),o=a>0,s=ko(a)>Wo;return ze(e,n,bn(t,6*qo),o?[0,-t]:[-Vo,t-Vo])}function Ue(t,e,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,c=o.y,d=s.x,u=s.y,h=0,f=1,p=d-l,_=u-c;if(a=t-l,p||!(a>0)){if(a/=p,p<0){if(a<h)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>h&&(h=a)}if(a=n-l,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>h&&(h=a)}else if(p>0){if(a<h)return;a<f&&(f=a)}if(a=e-c,_||!(a>0)){if(a/=_,_<0){if(a<h)return;a<f&&(f=a)}else if(_>0){if(a>f)return;a>h&&(h=a)}if(a=i-c,_||!(a<0)){if(a/=_,_<0){if(a>f)return;a>h&&(h=a)}else if(_>0){if(a<h)return;a<f&&(f=a)}return h>0&&(r.a={x:l+h*p,y:c+h*_}),f<1&&(r.b={x:l+f*p,y:c+f*_}),r}}}}}}function Be(t,e,n,i){function r(i,r){return ko(i[0]-t)<Wo?r>0?0:3:ko(i[0]-n)<Wo?r>0?2:1:ko(i[1]-e)<Wo?r>0?1:0:r>0?3:2}function a(t,e){return o(t.x,e.x)}function o(t,e){var n=r(t,1),i=r(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function l(t){for(var e=0,n=g.length,i=t[1],r=0;r<n;++r)for(var a,o=1,s=g[r],l=s.length,c=s[0];o<l;++o)a=s[o],c[1]<=i?a[1]>i&&rt(c,a,t)>0&&++e:a[1]<=i&&rt(c,a,t)<0&&--e,c=a;return 0!==e}function c(a,s,l,c){var d=0,u=0;if(null==a||(d=r(a,l))!==(u=r(s,l))||o(a,s)<0^l>0)do{c.point(0===d||3===d?t:n,d>1?i:e)}while((d=(d+l+4)%4)!==u);else c.point(s[0],s[1])}function d(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function u(t,e){d(t,e)&&s.point(t,e)}function h(){j.point=p,g&&g.push(m=[]),M=!0,k=!1,w=x=NaN}function f(){_&&(p(v,y),b&&k&&T.rejoin(),_.push(T.buffer())),j.point=u,k&&s.lineEnd()}function p(t,e){t=Math.max(-Gs,Math.min(Gs,t)),e=Math.max(-Gs,Math.min(Gs,e));var n=d(t,e);if(g&&m.push([t,e]),M)v=t,y=e,b=n,M=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&k)s.point(t,e);else{var i={a:{x:w,y:x},b:{x:t,y:e}};A(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),C=!1):n&&(s.lineStart(),s.point(t,e),C=!1)}w=t,x=e,k=n}var _,g,m,v,y,b,w,x,k,M,C,S=s,T=We(),A=Ue(t,e,n,i),j={point:u,lineStart:h,lineEnd:f,polygonStart:function(){s=T,_=[],g=[],C=!0},polygonEnd:function(){s=S,_=fo.merge(_);var e=l([t,i]),n=C&&e,r=_.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),c(null,null,1,s),s.lineEnd()),r&&Pe(_,a,e,c,s),s.polygonEnd()),_=g=m=null}};return j}}function Xe(t){var e=0,n=Vo/3,i=hn(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*Vo/180,n=t[1]*Vo/180):[e/Vo*180,n/Vo*180]},r}function Je(t,e){function n(t,e){var n=Math.sqrt(a-2*r*Math.sin(e))/r;return[n*Math.sin(t*=r),o-n*Math.cos(t)]}var i=Math.sin(t),r=(i+Math.sin(e))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/r,ot((a-(t*t+n*n)*r*r)/(2*r))]},n}function Qe(){function t(t,e){Hs+=r*t-i*e,i=t,r=e}var e,n,i,r;Bs.point=function(a,o){Bs.point=t,e=i=a,n=r=o},Bs.lineEnd=function(){t(e,n)}}function Ke(t,e){t<Fs&&(Fs=t),t>qs&&(qs=t),e<Ys&&(Ys=e),e>Us&&(Us=e)}function Ze(){function t(t,e){o.push("M",t,",",e,a)}function e(t,e){o.push("M",t,",",e),s.point=n}function n(t,e){o.push("L",t,",",e)}function i(){s.point=t}function r(){o.push("Z")}var a=tn(4.5),o=[],s={point:t,lineStart:function(){s.point=e},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=t},pointRadius:function(t){return a=tn(t),s},result:function(){if(o.length){var t=o.join("");return o=[],t}}};return s}function tn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function en(t,e){Es+=t,Os+=e,++Ls}function nn(){function t(t,i){var r=t-e,a=i-n,o=Math.sqrt(r*r+a*a);Ns+=o*(e+t)/2,Is+=o*(n+i)/2,Ps+=o,en(e=t,n=i)}var e,n;Js.point=function(i,r){Js.point=t,en(e=i,n=r)}}function rn(){Js.point=en}function an(){function t(t,e){var n=t-i,a=e-r,o=Math.sqrt(n*n+a*a);Ns+=o*(i+t)/2,Is+=o*(r+e)/2,Ps+=o,o=r*t-i*e,Ds+=o*(i+t),Rs+=o*(r+e),zs+=3*o,en(i=t,r=e)}var e,n,i,r;Js.point=function(a,o){Js.point=t,en(e=i=a,n=r=o)},Js.lineEnd=function(){t(e,n)}}function on(t){function e(e,n){t.moveTo(e+o,n),t.arc(e,n,o,0,Ho)}function n(e,n){t.moveTo(e,n),s.point=i}function i(e,n){t.lineTo(e,n)}function r(){s.point=e}function a(){t.closePath()}var o=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=e},pointRadius:function(t){return o=t,s},result:S};return s}function sn(t){function e(t){return(s?i:n)(t)}function n(e){return dn(e,function(n,i){n=t(n,i),e.point(n[0],n[1])})}function i(e){function n(n,i){n=t(n,i),e.point(n[0],n[1])}function i(){y=NaN,M.point=a,e.lineStart()}function a(n,i){var a=be([n,i]),o=t(n,i);r(y,b,v,w,x,k,y=o[0],b=o[1],v=n,w=a[0],x=a[1],k=a[2],s,e),e.point(y,b)}function o(){M.point=n,e.lineEnd()}function l(){i(),M.point=c,M.lineEnd=d}function c(t,e){a(u=t,h=e),f=y,p=b,_=w,g=x,m=k,M.point=a}function d(){r(y,b,v,w,x,k,f,p,u,_,g,m,s,e),M.lineEnd=o,o()}var u,h,f,p,_,g,m,v,y,b,w,x,k,M={point:n,lineStart:i,lineEnd:o,polygonStart:function(){e.polygonStart(),M.lineStart=l},polygonEnd:function(){e.polygonEnd(),M.lineStart=i}};return M}function r(e,n,i,s,l,c,d,u,h,f,p,_,g,m){var v=d-e,y=u-n,b=v*v+y*y;if(b>4*a&&g--){var w=s+f,x=l+p,k=c+_,M=Math.sqrt(w*w+x*x+k*k),C=Math.asin(k/=M),S=ko(ko(k)-1)<Wo||ko(i-h)<Wo?(i+h)/2:Math.atan2(x,w),T=t(S,C),A=T[0],j=T[1],E=A-e,O=j-n,L=y*E-v*O;(L*L/b>a||ko((v*E+y*O)/b-.5)>.3||s*f+l*p+c*_<o)&&(r(e,n,i,s,l,c,A,j,S,w/=M,x/=M,k,g,m),m.point(A,j),r(A,j,S,w,x,k,d,u,h,f,p,_,g,m))}}var a=.5,o=Math.cos(30*qo),s=16;return e.precision=function(t){return arguments.length?(s=(a=t*t)>0&&16,e):Math.sqrt(a)},e}function ln(t){var e=sn(function(e,n){return t([e*Uo,n*Uo])});return function(t){return fn(e(t))}}function cn(t){this.stream=t}function dn(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function un(t){return hn(function(){return t})()}function hn(t){function e(t){return t=s(t[0]*qo,t[1]*qo),[t[0]*h+l,c-t[1]*h]}function n(t){return(t=s.invert((t[0]-l)/h,(c-t[1])/h))&&[t[0]*Uo,t[1]*Uo]}function i(){s=Ne(o=gn(m,v,y),a);var t=a(_,g);return l=f-t[0]*h,c=p+t[1]*h,r()}function r(){return d&&(d.valid=!1,d=null),e}var a,o,s,l,c,d,u=sn(function(t,e){return t=a(t,e),[t[0]*h+l,c-t[1]*h]}),h=150,f=480,p=250,_=0,g=0,m=0,v=0,y=0,b=Ws,w=k,x=null,M=null;return e.stream=function(t){return d&&(d.valid=!1),d=fn(b(o,u(w(t)))),d.valid=!0,d},e.clipAngle=function(t){return arguments.length?(b=null==t?(x=t,Ws):qe((x=+t)*qo),r()):x},e.clipExtent=function(t){return arguments.length?(M=t,w=t?Be(t[0][0],t[0][1],t[1][0],t[1][1]):k,r()):M},e.scale=function(t){return arguments.length?(h=+t,i()):h},e.translate=function(t){return arguments.length?(f=+t[0],p=+t[1],i()):[f,p]},e.center=function(t){return arguments.length?(_=t[0]%360*qo,g=t[1]%360*qo,i()):[_*Uo,g*Uo]},e.rotate=function(t){return arguments.length?(m=t[0]%360*qo,v=t[1]%360*qo,y=t.length>2?t[2]%360*qo:0,i()):[m*Uo,v*Uo,y*Uo]},fo.rebind(e,u,"precision"),function(){return a=t.apply(this,arguments),e.invert=a.invert&&n,i()}}function fn(t){return dn(t,function(e,n){t.point(e*qo,n*qo)})}function pn(t,e){return[t,e]}function _n(t,e){return[t>Vo?t-Ho:t<-Vo?t+Ho:t,e]}function gn(t,e,n){return t?e||n?Ne(vn(t),yn(e,n)):vn(t):e||n?yn(e,n):_n}function mn(t){return function(e,n){return e+=t,[e>Vo?e-Ho:e<-Vo?e+Ho:e,n]}}function vn(t){var e=mn(t);return e.invert=mn(-t),e}function yn(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,c=Math.sin(e),d=c*i+s*r;return[Math.atan2(l*a-d*o,s*i-c*r),ot(d*a+l*o)]}var i=Math.cos(t),r=Math.sin(t),a=Math.cos(e),o=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,c=Math.sin(e),d=c*a-l*o;return[Math.atan2(l*a+c*o,s*i+d*r),ot(d*i-s*r)]},n}function bn(t,e){var n=Math.cos(t),i=Math.sin(t);return function(r,a,o,s){var l=o*e;null!=r?(r=wn(n,r),a=wn(n,a),(o>0?r<a:r>a)&&(r+=o*Ho)):(r=t+o*Ho,a=t-.5*l);for(var c,d=r;o>0?d>a:d<a;d-=l)s.point((c=Se([n,-i*Math.cos(d),-i*Math.sin(d)]))[0],c[1])}}function wn(t,e){var n=be(e);n[0]-=t,Ce(n);var i=at(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-Wo)%(2*Math.PI)}function xn(t,e,n){var i=fo.range(t,e-Wo,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function kn(t,e,n){var i=fo.range(t,e-Wo,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function Mn(t){return t.source}function Cn(t){return t.target}function Sn(t,e,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(t),c=r*Math.sin(t),d=o*Math.cos(n),u=o*Math.sin(n),h=2*Math.asin(Math.sqrt(dt(i-e)+r*o*dt(n-t))),f=1/Math.sin(h),p=h?function(t){var e=Math.sin(t*=h)*f,n=Math.sin(h-t)*f,i=n*l+e*d,r=n*c+e*u,o=n*a+e*s;return[Math.atan2(r,i)*Uo,Math.atan2(o,Math.sqrt(i*i+r*r))*Uo]}:function(){return[t*Uo,e*Uo]};return p.distance=h,p}function Tn(){function t(t,r){var a=Math.sin(r*=qo),o=Math.cos(r),s=ko((t*=qo)-e),l=Math.cos(s);Qs+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),e=t,n=a,i=o}var e,n,i;Ks.point=function(r,a){e=r*qo,n=Math.sin(a*=qo),i=Math.cos(a),Ks.point=t},Ks.lineEnd=function(){Ks.point=Ks.lineEnd=S}}function An(t,e){function n(e,n){var i=Math.cos(e),r=Math.cos(n),a=t(i*r);return[a*r*Math.sin(e),a*Math.sin(n)]}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n),r=e(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(t*a,i*o),Math.asin(i&&n*a/i)]},n}function jn(t,e){function n(t,e){o>0?e<-Yo+Wo&&(e=-Yo+Wo):e>Yo-Wo&&(e=Yo-Wo);var n=o/Math.pow(r(e),a);return[n*Math.sin(a*t),o-n*Math.cos(a*t)]}var i=Math.cos(t),r=function(t){return Math.tan(Vo/4+t/2)},a=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(r(e)/r(t)),o=i*Math.pow(r(t),a)/a;return a?(n.invert=function(t,e){var n=o-e,i=it(a)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Yo]},n):On}function En(t,e){function n(t,e){var n=a-e;return[n*Math.sin(r*t),a-n*Math.cos(r*t)]}var i=Math.cos(t),r=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),a=i/r+t;return ko(r)<Wo?pn:(n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/r,a-it(r)*Math.sqrt(t*t+n*n)]},n)}function On(t,e){return[t,Math.log(Math.tan(Vo/4+e/2))]}function Ln(t){var e,n=un(t),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var o=a.apply(n,arguments);if(o===n){if(e=null==t){var s=Vo*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else e&&(o=null);return o},n.clipExtent(null)}function Nn(t,e){return[Math.log(Math.tan(Vo/4+e/2)),-t]}function In(t){return t[0]}function Pn(t){return t[1]}function Dn(t){for(var e=t.length,n=[0,1],i=2,r=2;r<e;r++){for(;i>1&&rt(t[n[i-2]],t[n[i-1]],t[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function Rn(t,e){return t[0]-e[0]||t[1]-e[1]}function zn(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function $n(t,e,n,i){var r=t[0],a=n[0],o=e[0]-r,s=i[0]-a,l=t[1],c=n[1],d=e[1]-l,u=i[1]-c,h=(s*(l-c)-u*(r-a))/(u*o-s*d);return[r+h*o,l+h*d]}function Wn(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Gn(){li(this),this.edge=this.site=this.circle=null}function Vn(t){var e=dl.pop()||new Gn;return e.site=t,e}function Hn(t){Zn(t),sl.remove(t),dl.push(t),li(t)}function Fn(t){var e=t.circle,n=e.x,i=e.cy,r={x:n,y:i},a=t.P,o=t.N,s=[t];Hn(t);for(var l=a;l.circle&&ko(n-l.circle.x)<Wo&&ko(i-l.circle.cy)<Wo;)a=l.P,s.unshift(l),Hn(l),l=a;s.unshift(l),Zn(l);for(var c=o;c.circle&&ko(n-c.circle.x)<Wo&&ko(i-c.circle.cy)<Wo;)o=c.N,s.push(c),Hn(c),c=o;s.push(c),Zn(c);var d,u=s.length;for(d=1;d<u;++d)c=s[d],l=s[d-1],ai(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=ii(l.site,c.site,null,r),Kn(l),Kn(c)}function Yn(t){for(var e,n,i,r,a=t.x,o=t.y,s=sl._;s;)if((i=qn(s,o)-a)>Wo)s=s.L;else{if(!((r=a-Un(s,o))>Wo)){i>-Wo?(e=s.P,n=s):r>-Wo?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var l=Vn(t);if(sl.insert(e,l),e||n){if(e===n)return Zn(e),n=Vn(e.site),sl.insert(l,n),l.edge=n.edge=ii(e.site,l.site),Kn(e),void Kn(n);if(!n)return void(l.edge=ii(e.site,l.site));Zn(e),Zn(n);var c=e.site,d=c.x,u=c.y,h=t.x-d,f=t.y-u,p=n.site,_=p.x-d,g=p.y-u,m=2*(h*g-f*_),v=h*h+f*f,y=_*_+g*g,b={x:(g*v-f*y)/m+d,y:(h*y-_*v)/m+u};ai(n.edge,c,p,b),l.edge=ii(c,t,null,b),n.edge=ii(t,p,null,b),Kn(e),Kn(n)}}function qn(t,e){var n=t.site,i=n.x,r=n.y,a=r-e;if(!a)return i;var o=t.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,c=l-e;if(!c)return s;var d=s-i,u=1/a-1/c,h=d/c;return u?(-h+Math.sqrt(h*h-2*u*(d*d/(-2*c)-l+c/2+r-a/2)))/u+i:(i+s)/2}function Un(t,e){var n=t.N;if(n)return qn(n,e);var i=t.site;return i.y===e?i.x:1/0}function Bn(t){this.site=t,this.edges=[]}function Xn(t){for(var e,n,i,r,a,o,s,l,c,d,u=t[0][0],h=t[1][0],f=t[0][1],p=t[1][1],_=ol,g=_.length;g--;)if((a=_[g])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)d=s[o].end(),i=d.x,r=d.y,c=s[++o%l].start(),e=c.x,n=c.y,(ko(i-e)>Wo||ko(r-n)>Wo)&&(s.splice(o,0,new oi(ri(a.site,d,ko(i-u)<Wo&&p-r>Wo?{x:u,y:ko(e-u)<Wo?n:p}:ko(r-p)<Wo&&h-i>Wo?{x:ko(n-p)<Wo?e:h,y:p}:ko(i-h)<Wo&&r-f>Wo?{x:h,y:ko(e-h)<Wo?n:f}:ko(r-f)<Wo&&i-u>Wo?{x:ko(n-f)<Wo?e:u,y:f}:null),a.site,null)),++l)}function Jn(t,e){return e.angle-t.angle}function Qn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Kn(t){var e=t.P,n=t.N;if(e&&n){var i=e.site,r=t.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,c=i.y-s,d=a.x-o,u=a.y-s,h=2*(l*u-c*d);if(!(h>=-Go)){var f=l*l+c*c,p=d*d+u*u,_=(u*f-c*p)/h,g=(l*p-d*f)/h,u=g+s,m=ul.pop()||new Qn;m.arc=t,m.site=r,m.x=_+o,m.y=u+Math.sqrt(_*_+g*g),m.cy=u,t.circle=m;for(var v=null,y=cl._;y;)if(m.y<y.y||m.y===y.y&&m.x<=y.x){if(!y.L){v=y.P;break}y=y.L}else{if(!y.R){v=y;break}y=y.R}cl.insert(v,m),v||(ll=m)}}}}function Zn(t){var e=t.circle;e&&(e.P||(ll=e.N),cl.remove(e),ul.push(e),li(e),t.circle=null)}function ti(t){for(var e,n=al,i=Ue(t[0][0],t[0][1],t[1][0],t[1][1]),r=n.length;r--;)e=n[r],(!ei(e,t)||!i(e)||ko(e.a.x-e.b.x)<Wo&&ko(e.a.y-e.b.y)<Wo)&&(e.a=e.b=null,n.splice(r,1))}function ei(t,e){var n=t.b;if(n)return!0;var i,r,a=t.a,o=e[0][0],s=e[1][0],l=e[0][1],c=e[1][1],d=t.l,u=t.r,h=d.x,f=d.y,p=u.x,_=u.y,g=(h+p)/2,m=(f+_)/2;if(_===f){if(g<o||g>=s)return;if(h>p){if(a){if(a.y>=c)return}else a={x:g,y:l};n={x:g,y:c}}else{if(a){if(a.y<l)return}else a={x:g,y:c};n={x:g,y:l}}}else if(i=(h-p)/(_-f),r=m-i*g,i<-1||i>1)if(h>p){if(a){if(a.y>=c)return}else a={x:(l-r)/i,y:l};n={x:(c-r)/i,y:c}}else{if(a){if(a.y<l)return}else a={x:(c-r)/i,y:c};n={x:(l-r)/i,y:l}}else if(f<_){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return t.a=a,t.b=n,!0}function ni(t,e){this.l=t,this.r=e,this.a=this.b=null}function ii(t,e,n,i){var r=new ni(t,e);return al.push(r),n&&ai(r,t,e,n),i&&ai(r,e,t,i),ol[t.i].edges.push(new oi(r,t,e)),ol[e.i].edges.push(new oi(r,e,t)),r}function ri(t,e,n){var i=new ni(t,null);return i.a=e,i.b=n,al.push(i),i}function ai(t,e,n,i){t.a||t.b?t.l===n?t.b=i:t.a=i:(t.a=i,t.l=e,t.r=n)}function oi(t,e,n){var i=t.a,r=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ci(t,e){var n=e,i=e.R,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function di(t,e){var n=e,i=e.L,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ui(t){for(;t.L;)t=t.L;return t}function hi(t,e){var n,i,r,a=t.sort(fi).pop();for(al=[],ol=new Array(t.length),sl=new si,cl=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Bn(a),Yn(a),n=a.x,i=a.y),a=t.pop();else{if(!r)break;Fn(r.arc)}e&&(ti(e),Xn(e));var o={cells:ol,edges:al};return sl=cl=al=ol=null,o}function fi(t,e){return e.y-t.y||e.x-t.x}function pi(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function _i(t){return t.x}function gi(t){return t.y}function mi(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vi(t,e,n,i,r,a){if(!t(e,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=e.nodes;l[0]&&vi(t,l[0],n,i,o,s),l[1]&&vi(t,l[1],o,i,r,s),l[2]&&vi(t,l[2],n,s,o,a),l[3]&&vi(t,l[3],o,s,r,a)}}function yi(t,e,n,i,r,a,o){var s,l=1/0;return function t(c,d,u,h,f){if(!(d>a||u>o||h<i||f<r)){if(p=c.point){var p,_=e-c.x,g=n-c.y,m=_*_+g*g;if(m<l){var v=Math.sqrt(l=m);i=e-v,r=n-v,a=e+v,o=n+v,s=p}}for(var y=c.nodes,b=.5*(d+h),w=.5*(u+f),x=e>=b,k=n>=w,M=k<<1|x,C=M+4;M<C;++M)if(c=y[3&M])switch(3&M){case 0:t(c,d,u,b,w);break;case 1:t(c,b,u,h,w);break;case 2:t(c,d,w,b,f);break;case 3:t(c,b,w,h,f)}}}(t,i,r,a,o),s}function bi(t,e){t=fo.rgb(t),e=fo.rgb(e);var n=t.r,i=t.g,r=t.b,a=e.r-n,o=e.g-i,s=e.b-r;return function(t){return"#"+Ct(Math.round(n+a*t))+Ct(Math.round(i+o*t))+Ct(Math.round(r+s*t))}}function wi(t,e){var n,i={},r={};for(n in t)n in e?i[n]=Mi(t[n],e[n]):r[n]=t[n];for(n in e)n in t||(r[n]=e[n]);return function(t){for(n in i)r[n]=i[n](t);return r}}function xi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function ki(t,e){var n,i,r,a=fl.lastIndex=pl.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=fl.exec(t))&&(i=pl.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=pl.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function Mi(t,e){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](t,e)););return n}function Ci(t,e){var n,i=[],r=[],a=t.length,o=e.length,s=Math.min(t.length,e.length);for(n=0;n<s;++n)i.push(Mi(t[n],e[n]));for(;n<a;++n)r[n]=t[n];for(;n<o;++n)r[n]=e[n];return function(t){for(n=0;n<s;++n)r[n]=i[n](t);return r}}function Si(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function Ti(t){return function(e){return 1-t(1-e)}}function Ai(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function ji(t){return t*t}function Ei(t){return t*t*t}function Oi(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Li(t){return function(e){return Math.pow(e,t)}}function Ni(t){return 1-Math.cos(t*Yo)}function Ii(t){return Math.pow(2,10*(t-1))}function Pi(t){return 1-Math.sqrt(1-t*t)}function Di(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/Ho*Math.asin(1/t):(t=1,n=e/4),function(i){return 1+t*Math.pow(2,-10*i)*Math.sin((i-n)*Ho/e)}}function Ri(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function zi(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function $i(t,e){t=fo.hcl(t),e=fo.hcl(e);var n=t.h,i=t.c,r=t.l,a=e.h-n,o=e.c-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.c:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return _t(n+a*t,i+o*t,r+s*t)+""}}function Wi(t,e){t=fo.hsl(t),e=fo.hsl(e);var n=t.h,i=t.s,r=t.l,a=e.h-n,o=e.s-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.s:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return ft(n+a*t,i+o*t,r+s*t)+""}}function Gi(t,e){t=fo.lab(t),e=fo.lab(e);var n=t.l,i=t.a,r=t.b,a=e.l-n,o=e.a-i,s=e.b-r;return function(t){return mt(n+a*t,i+o*t,r+s*t)+""}}function Vi(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Hi(t){var e=[t.a,t.b],n=[t.c,t.d],i=Yi(e),r=Fi(e,n),a=Yi(qi(n,e,-r))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Uo,this.translate=[t.e,t.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*Uo:0}function Fi(t,e){return t[0]*e[0]+t[1]*e[1]}function Yi(t){var e=Math.sqrt(Fi(t,t));return e&&(t[0]/=e,t[1]/=e),e}function qi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function Ui(t){return t.length?t.pop()+",":""}function Bi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else(e[0]||e[1])&&n.push("translate("+e+")")}function Xi(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(Ui(n)+"rotate(",null,")")-2,x:xi(t,e)})):e&&n.push(Ui(n)+"rotate("+e+")")}function Ji(t,e,n,i){t!==e?i.push({i:n.push(Ui(n)+"skewX(",null,")")-2,x:xi(t,e)}):e&&n.push(Ui(n)+"skewX("+e+")")}function Qi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push(Ui(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else 1===e[0]&&1===e[1]||n.push(Ui(n)+"scale("+e+")")}function Ki(t,e){var n=[],i=[];return t=fo.transform(t),e=fo.transform(e),Bi(t.translate,e.translate,n,i),Xi(t.rotate,e.rotate,n,i),Ji(t.skew,e.skew,n,i),Qi(t.scale,e.scale,n,i),t=e=null,function(t){for(var e,r=-1,a=i.length;++r<a;)n[(e=i[r]).i]=e.x(t);return n.join("")}}function Zi(t,e){return e=(e-=t=+t)||1/e,function(n){return(n-t)/e}}function tr(t,e){return e=(e-=t=+t)||1/e,function(n){return Math.max(0,Math.min(1,(n-t)/e))}}function er(t){for(var e=t.source,n=t.target,i=ir(e,n),r=[e];e!==i;)e=e.parent,r.push(e);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function ir(t,e){if(t===e)return t;for(var n=nr(t),i=nr(e),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(t){t.fixed|=2}function ar(t){t.fixed&=-7}function or(t){t.fixed|=4,t.px=t.x,t.py=t.y}function sr(t){t.fixed&=-5}function lr(t,e,n){var i=0,r=0;if(t.charge=0,!t.leaf)for(var a,o=t.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,e,n),t.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var c=e*n[t.point.index];t.charge+=t.pointCharge=c,i+=c*t.point.x,r+=c*t.point.y}t.cx=i/t.charge,t.cy=r/t.charge}function cr(t,e){return fo.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=_r,t}function dr(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(r=t.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function ur(t,e){for(var n=[t],i=[];null!=(t=n.pop());)if(i.push(t),(a=t.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(t=i.pop());)e(t)}function hr(t){return t.children}function fr(t){return t.value}function pr(t,e){return e.value-t.value}function _r(t){return fo.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function gr(t){return t.x}function mr(t){return t.y}function vr(t,e,n){t.y0=e,t.y=n}function yr(t){return fo.range(t.length)}function br(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function wr(t){for(var e,n=1,i=0,r=t[0][1],a=t.length;n<a;++n)(e=t[n][1])>r&&(i=n,r=e);return i}function xr(t){return t.reduce(kr,0)}function kr(t,e){return t+e[1]}function Mr(t,e){return Cr(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Cr(t,e){for(var n=-1,i=+t[0],r=(t[1]-i)/e,a=[];++n<=e;)a[n]=r*n+i;return a}function Sr(t){return[fo.min(t),fo.max(t)]}function Tr(t,e){return t.value-e.value}function Ar(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function jr(t,e){t._pack_next=e,e._pack_prev=t}function Er(t,e){var n=e.x-t.x,i=e.y-t.y,r=t.r+e.r;return.999*r*r>n*n+i*i}function Or(t){function e(t){d=Math.min(t.x-t.r,d),u=Math.max(t.x+t.r,u),h=Math.min(t.y-t.r,h),f=Math.max(t.y+t.r,f)}if((n=t.children)&&(c=n.length)){var n,i,r,a,o,s,l,c,d=1/0,u=-1/0,h=1/0,f=-1/0;if(n.forEach(Lr),i=n[0],i.x=-i.r,i.y=0,e(i),c>1&&(r=n[1],r.x=r.r,r.y=0,e(r),c>2))for(a=n[2],Pr(i,r,a),e(a),Ar(i,a),i._pack_prev=a,Ar(a,r),r=i._pack_next,o=3;o<c;o++){Pr(i,r,a=n[o]);var p=0,_=1,g=1;for(s=r._pack_next;s!==r;s=s._pack_next,_++)if(Er(s,a)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!Er(l,a);l=l._pack_prev,g++);p?(_<g||_==g&&r.r<i.r?jr(i,r=s):jr(i=l,r),o--):(Ar(i,a),r=a,e(a))}var m=(d+u)/2,v=(h+f)/2,y=0;for(o=0;o<c;o++)a=n[o],a.x-=m,a.y-=v,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));t.r=y,n.forEach(Nr)}}function Lr(t){t._pack_next=t._pack_prev=t}function Nr(t){delete t._pack_next,delete t._pack_prev}function Ir(t,e,n,i){var r=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,r)for(var a=-1,o=r.length;++a<o;)Ir(r[a],e,n,i)}function Pr(t,e,n){var i=t.r+n.r,r=e.x-t.x,a=e.y-t.y;if(i&&(r||a)){var o=e.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),c=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=t.x+l*r+c*a,n.y=t.y+l*a-c*r}else n.x=t.x+i,n.y=t.y}function Dr(t,e){return t.parent==e.parent?1:2}function Rr(t){var e=t.children;return e.length?e[0]:t.t}function zr(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function $r(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Wr(t){for(var e,n=0,i=0,r=t.children,a=r.length;--a>=0;)e=r[a],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}function Gr(t,e,n){return t.a.parent===e.parent?t.a:n}function Vr(t){return 1+fo.max(t,function(t){return t.y})}function Hr(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Fr(t){var e=t.children;return e&&e.length?Fr(e[0]):t}function Yr(t){var e,n=t.children;return n&&(e=n.length)?Yr(n[e-1]):t}function qr(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Ur(t,e){var n=t.x+e[3],i=t.y+e[0],r=t.dx-e[1]-e[3],a=t.dy-e[0]-e[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Br(t){var e=t[0],n=t[t.length-1];return e<n?[e,n]:[n,e]}function Xr(t){return t.rangeExtent?t.rangeExtent():Br(t.range())}function Jr(t,e,n,i){var r=n(t[0],t[1]),a=i(e[0],e[1]);return function(t){return a(r(t))}}function Qr(t,e){var n,i=0,r=t.length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}function Kr(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:Cl}function Zr(t,e,n,i){var r=[],a=[],o=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<=s;)r.push(n(t[o-1],t[o])),a.push(i(e[o-1],e[o]));return function(e){var n=fo.bisect(t,e,1,s)-1;return a[n](r[n](e))}}function ta(t,e,n,i){function r(){var r=Math.min(t.length,e.length)>2?Zr:Jr,l=i?tr:Zi;return o=r(t,e,l,n),s=r(e,t,l,Mi),a}function a(t){return o(t)}var o,s;return a.invert=function(t){return s(t)},a.domain=function(e){return arguments.length?(t=e.map(Number),r()):t},a.range=function(t){return arguments.length?(e=t,r()):e},a.rangeRound=function(t){return a.range(t).interpolate(Vi)},a.clamp=function(t){return arguments.length?(i=t,r()):i},a.interpolate=function(t){return arguments.length?(n=t,r()):n},a.ticks=function(e){return ra(t,e)},a.tickFormat=function(e,n){return aa(t,e,n)},a.nice=function(e){return na(t,e),r()},a.copy=function(){return ta(t,e,n,i)},r()}function ea(t,e){return fo.rebind(t,e,"range","rangeRound","interpolate","clamp")}function na(t,e){return Qr(t,Kr(ia(t,e)[2])),Qr(t,Kr(ia(t,e)[2])),t}function ia(t,e){null==e&&(e=10);var n=Br(t),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),a=e/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(t,e){return fo.range.apply(fo,ia(t,e))}function aa(t,e,n){var i=ia(t,e);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(t){return n(a.scale(t))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function sa(t,e){var n=oa(e[2]);return t in Sl?Math.abs(n-oa(Math.max(ko(e[0]),ko(e[1]))))+ +("e"!==t):n-2*("%"===t)}function la(t,e,n,i){function r(t){return(n?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function a(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function o(e){return t(r(e))}return o.invert=function(e){return a(t.invert(e))},o.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((i=e.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(e=+n,t.domain(i.map(r)),o):e},o.nice=function(){var e=Qr(i.map(r),n?Math:Al);return t.domain(e),i=e.map(a),o},o.ticks=function(){var t=Br(i),o=[],s=t[0],l=t[1],c=Math.floor(r(s)),d=Math.ceil(r(l)),u=e%1?2:e;if(isFinite(d-c)){if(n){for(;c<d;c++)for(var h=1;h<u;h++)o.push(a(c)*h);o.push(a(c))}else for(o.push(a(c));c++<d;)for(var h=u-1;h>0;h--)o.push(a(c)*h);for(c=0;o[c]<s;c++);for(d=o.length;o[d-1]>l;d--);o=o.slice(c,d)}return o},o.tickFormat=function(t,n){if(!arguments.length)return Tl;arguments.length<2?n=Tl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,e*t/o.ticks().length);return function(t){var o=t/a(Math.round(r(t)));return o*e<e-.5&&(o*=e),o<=i?n(t):""}},o.copy=function(){return la(t.copy(),e,n,i)},ea(o,t)}function ca(t,e,n){function i(e){return t(r(e))}var r=da(e),a=da(1/e);return i.invert=function(e){return a(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(r)),i):n},i.ticks=function(t){return ra(n,t)},i.tickFormat=function(t,e){return aa(n,t,e)},i.nice=function(t){return i.domain(na(n,t))},i.exponent=function(o){return arguments.length?(r=da(e=o),a=da(1/e),t.domain(n.map(r)),i):e},i.copy=function(){return ca(t.copy(),e,n)},ea(i,t)}function da(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function ua(t,e){function n(n){return a[((r.get(n)||("range"===e.t?r.set(n,t.push(n)):NaN))-1)%a.length]}function i(e,n){return fo.range(t.length).map(function(t){return e+n*t})}var r,a,o;return n.domain=function(i){if(!arguments.length)return t;t=[],r=new p;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,t.push(a));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(a=t,o=0,e={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=t.length<2?(l=(l+c)/2,0):(c-l)/(t.length-1+s);return a=i(l+d*s/2,d),o=0,e={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=t.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(t.length-1+s)|0;return a=i(l+Math.round(d*s/2+(c-l-(t.length-1+s)*d)/2),d),o=0,e={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=(u-d)/(t.length-s+2*l);return a=i(d+h*l,h),c&&a.reverse(),o=h*(1-s),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=Math.floor((u-d)/(t.length-s+2*l));return a=i(d+Math.round((u-d-(t.length-s)*h)/2),h),c&&a.reverse(),o=Math.round(h*(1-s)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Br(e.a[0])},n.copy=function(){return ua(t,e)},n.domain(t)}function ha(t,e){function n(){var n=0,a=e.length;for(r=[];++n<a;)r[n-1]=fo.quantile(t,n/a);return i}function i(t){if(!isNaN(t=+t))return e[fo.bisect(r,t)]}var r;return i.domain=function(e){return arguments.length?(t=e.map(l).filter(c).sort(s),n()):t},i.range=function(t){return arguments.length?(e=t,n()):e},i.quantiles=function(){return r},i.invertExtent=function(n){return n=e.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:t[0],n<r.length?r[n]:t[t.length-1]]},i.copy=function(){return ha(t,e)},n()}function fa(t,e,n){function i(e){return n[Math.max(0,Math.min(o,Math.floor(a*(e-t))))]}function r(){return a=n.length/(e-t),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],r()):[t,e]},i.range=function(t){return arguments.length?(n=t,r()):n},i.invertExtent=function(e){return e=n.indexOf(e),e=e<0?NaN:e/a+t,[e,e+1/a]},i.copy=function(){return fa(t,e,n)},r()}function pa(t,e){function n(n){if(n<=n)return e[fo.bisect(t,n)]}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return pa(t,e)},n}function _a(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return ra(t,e)},e.tickFormat=function(e,n){return aa(t,e,n)},e.copy=function(){return _a(t)},e}function ga(){return 0}function ma(t){return t.innerRadius}function va(t){return t.outerRadius}function ya(t){return t.startAngle}function ba(t){return t.endAngle}function wa(t){return t&&t.padAngle}function xa(t,e,n,i){return(t-n)*e-(e-i)*t>0?0:1}function ka(t,e,n,i,r){var a=t[0]-e[0],o=t[1]-e[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,c=-s*a,d=t[0]+l,u=t[1]+c,h=e[0]+l,f=e[1]+c,p=(d+h)/2,_=(u+f)/2,g=h-d,m=f-u,v=g*g+m*m,y=n-i,b=d*f-h*u,w=(m<0?-1:1)*Math.sqrt(Math.max(0,y*y*v-b*b)),x=(b*m-g*w)/v,k=(-b*g-m*w)/v,M=(b*m+g*w)/v,C=(-b*g+m*w)/v,S=x-p,T=k-_,A=M-p,j=C-_;return S*S+T*T>A*A+j*j&&(x=M,k=C),[[x-l,k-c],[x*n/y,k*n/y]]}function Ma(t){function e(e){function o(){c.push("M",a(t(d),s))}for(var l,c=[],d=[],u=-1,h=e.length,f=Ot(n),p=Ot(i);++u<h;)r.call(this,l=e[u],u)?d.push([+f.call(this,l,u),+p.call(this,l,u)]):d.length&&(o(),d=[]);return d.length&&o(),c.length?c.join(""):null}var n=In,i=Pn,r=Ie,a=Ca,o=a.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(r=t,e):r},e.interpolate=function(t){return arguments.length?(o="function"==typeof t?a=t:(a=Il.get(t)||Ca).key,e):o},e.tension=function(t){return arguments.length?(s=t,e):s},e}function Ca(t){return t.length>1?t.join("L"):t+"Z"}function Sa(t){return t.join("L")+"Z"}function Ta(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i[0]+(i=t[e])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function Aa(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("V",(i=t[e])[1],"H",i[0]);return r.join("")}function ja(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i=t[e])[0],"V",i[1]);return r.join("")}function Ea(t,e){return t.length<4?Ca(t):t[1]+Na(t.slice(1,-1),Ia(t,e))}function Oa(t,e){return t.length<3?Sa(t):t[0]+Na((t.push(t[0]),t),Ia([t[t.length-2]].concat(t,[t[1]]),e))}function La(t,e){return t.length<3?Ca(t):t[0]+Na(t,Ia(t,e))}function Na(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return Ca(t);var n=t.length!=e.length,i="",r=t[0],a=t[1],o=e[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=t[1],l=2),e.length>1){s=e[1],a=t[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var c=2;c<e.length;c++,l++)a=t[l],s=e[c],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var d=t[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+d[0]+","+d[1]}return i}function Ia(t,e){for(var n,i=[],r=(1-e)/2,a=t[0],o=t[1],s=1,l=t.length;++s<l;)n=a,a=o,o=t[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Pa(t){if(t.length<3)return Ca(t);var e=1,n=t.length,i=t[0],r=i[0],a=i[1],o=[r,r,r,(i=t[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",$a(Rl,o),",",$a(Rl,s)];for(t.push(t[n-1]);++e<=n;)i=t[e],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),Wa(l,o,s);return t.pop(),l.push("L",i),l.join("")}function Da(t){if(t.length<4)return Ca(t);for(var e,n=[],i=-1,r=t.length,a=[0],o=[0];++i<3;)e=t[i],a.push(e[0]),o.push(e[1]);for(n.push($a(Rl,a)+","+$a(Rl,o)),--i;++i<r;)e=t[i],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),Wa(n,a,o);return n.join("")}function Ra(t){for(var e,n,i=-1,r=t.length,a=r+4,o=[],s=[];++i<4;)n=t[i%r],o.push(n[0]),s.push(n[1]);for(e=[$a(Rl,o),",",$a(Rl,s)],--i;++i<a;)n=t[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),Wa(e,o,s);return e.join("")}function za(t,e){var n=t.length-1;if(n)for(var i,r,a=t[0][0],o=t[0][1],s=t[n][0]-a,l=t[n][1]-o,c=-1;++c<=n;)i=t[c],r=c/n,i[0]=e*i[0]+(1-e)*(a+r*s),i[1]=e*i[1]+(1-e)*(o+r*l);return Pa(t)}function $a(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Wa(t,e,n){t.push("C",$a(Pl,e),",",$a(Pl,n),",",$a(Dl,e),",",$a(Dl,n),",",$a(Rl,e),",",$a(Rl,n))}function Ga(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Va(t){for(var e=0,n=t.length-1,i=[],r=t[0],a=t[1],o=i[0]=Ga(r,a);++e<n;)i[e]=(o+(o=Ga(r=a,a=t[e+1])))/2;return i[e]=o,i}function Ha(t){for(var e,n,i,r,a=[],o=Va(t),s=-1,l=t.length-1;++s<l;)e=Ga(t[s],t[s+1]),ko(e)<Wo?o[s]=o[s+1]=0:(n=o[s]/e,i=o[s+1]/e,(r=n*n+i*i)>9&&(r=3*e/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Fa(t){return t.length<3?Ca(t):t[0]+Na(t,Ha(t))}function Ya(t){for(var e,n,i,r=-1,a=t.length;++r<a;)e=t[r],n=e[0],i=e[1]-Yo,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function qa(t){function e(e){function l(){_.push("M",s(t(m),u),d,c(t(g.reverse()),u),"Z")}for(var h,f,p,_=[],g=[],m=[],v=-1,y=e.length,b=Ot(n),w=Ot(r),x=n===i?function(){return f}:Ot(i),k=r===a?function(){return p}:Ot(a);++v<y;)o.call(this,h=e[v],v)?(g.push([f=+b.call(this,h,v),p=+w.call(this,h,v)]),m.push([+x.call(this,h,v),+k.call(this,h,v)])):g.length&&(l(),g=[],m=[]);return g.length&&l(),_.length?_.join(""):null}var n=In,i=In,r=0,a=Pn,o=Ie,s=Ca,l=s.key,c=s,d="L",u=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(r=a=t,e):a},e.y0=function(t){return arguments.length?(r=t,e):r},e.y1=function(t){return arguments.length?(a=t,e):a},e.defined=function(t){return arguments.length?(o=t,e):o},e.interpolate=function(t){return arguments.length?(l="function"==typeof t?s=t:(s=Il.get(t)||Ca).key,c=s.reverse||s,d=s.closed?"M":"L",e):l},e.tension=function(t){return arguments.length?(u=t,e):u},e}function Ua(t){return t.radius}function Ba(t){return[t.x,t.y]}function Xa(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]-Yo;return[n*Math.cos(i),n*Math.sin(i)]}}function Ja(){return 64}function Qa(){return"circle"}function Ka(t){var e=Math.sqrt(t/Vo);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Za(t){return function(){var e,n,i;(e=this[t])&&(i=e[n=e.active])&&(i.timer.c=null,i.timer.t=NaN,--e.count?delete e[n]:delete this[t],e.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function to(t,e,n){return Ao(t,Fl),t.namespace=e,t.id=n,t}function eo(t,e,n,i){var r=t.id,a=t.namespace;return B(t,"function"==typeof n?function(t,o,s){t[a][r].tween.set(e,i(n.call(t,t.__data__,o,s)))}:(n=i(n),function(t){t[a][r].tween.set(e,n)}))}function no(t){return null==t&&(t=""),function(){this.textContent=t}}function io(t){return null==t?"__transition__":"__transition_"+t+"__"}function ro(t,e,n,i,r){function a(t){var e=_.delay;if(c.t=e+l,e<=t)return o(t-e);c.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(t,t.__data__,a.index));for(var o in f)if(+o<i){var p=f[o];p.timer.c=null,p.timer.t=NaN,--f.count,delete f[o]}c.c=s,Dt(function(){return c.c&&s(n||1)&&(c.c=null,c.t=NaN),1},0,l),f.active=i,_.event&&_.event.start.call(t,t.__data__,e),h=[],_.tween.forEach(function(n,i){(i=i.call(t,t.__data__,e))&&h.push(i)}),u=_.ease,d=_.duration}function s(r){for(var a=r/d,o=u(a),s=h.length;s>0;)h[--s].call(t,o);if(a>=1)return _.event&&_.event.end.call(t,t.__data__,e),--f.count?delete f[i]:delete t[n],1}var l,c,d,u,h,f=t[n]||(t[n]={active:0,count:0}),_=f[i];_||(l=r.time,c=Dt(a,0,l),_=f[i]={tween:new p,time:l,timer:c,delay:r.delay,duration:r.duration,ease:r.ease,index:e},r=null,++f.count)}function ao(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate("+(isFinite(i)?i:n(t))+",0)"})}function oo(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate(0,"+(isFinite(i)?i:n(t))+")"})}function so(t){return t.toISOString()}function lo(t,e,n){function i(e){return t(e)}function r(t,n){var i=t[1]-t[0],r=i/n,a=fo.bisect(Zl,r);return a==Zl.length?[e.year,ia(t.map(function(t){return t/31536e6}),n)[2]]:a?e[r/Zl[a-1]<Zl[a]/r?a-1:a]:[nc,ia(t,n)[2]]}return i.invert=function(e){return co(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(co)},i.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,co(+n+1),e).length}var a=i.domain(),o=Br(a),s=null==t?r(o,10):"number"==typeof t&&r(o,t);return s&&(t=s[0],e=s[1]),i.domain(Qr(a,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=co(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=co(+e+1);return e}}:t))},i.ticks=function(t,e){var n=Br(i.domain()),a=null==t?r(n,10):"number"==typeof t?r(n,t):!t.range&&[{range:t},e];return a&&(t=a[0],e=a[1]),t.range(n[0],co(+n[1]+1),e<1?1:e)},i.tickFormat=function(){return n},i.copy=function(){return lo(t.copy(),e,n)},ea(i,t)}function co(t){return new Date(t)}function uo(t){return JSON.parse(t.responseText)}function ho(t){var e=go.createRange();return e.selectNode(go.body),e.createContextualFragment(t.responseText)}var fo={version:"3.5.17"},po=[].slice,_o=function(t){return po.call(t)},go=this.document;if(go)try{_o(go.documentElement.childNodes)[0].nodeType}catch(t){_o=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}if(Date.now||(Date.now=function(){return+new Date}),go)try{go.createElement("DIV").style.setProperty("opacity",0,"")}catch(t){var mo=this.Element.prototype,vo=mo.setAttribute,yo=mo.setAttributeNS,bo=this.CSSStyleDeclaration.prototype,wo=bo.setProperty;mo.setAttribute=function(t,e){vo.call(this,t,e+"")},mo.setAttributeNS=function(t,e,n){yo.call(this,t,e,n+"")},bo.setProperty=function(t,e,n){wo.call(this,t,e+"",n)}}fo.ascending=s,fo.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},fo.min=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&n>i&&(n=i)}return n},fo.max=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&i>n&&(n=i)}return n},fo.extent=function(t,e){var n,i,r,a=-1,o=t.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=t[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=e.call(t,t[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e.call(t,t[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(t,e){var n,i=0,r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=+t[a])&&(i+=n);else for(;++a<r;)c(n=+e.call(t,t[a],a))&&(i+=n);return i},fo.mean=function(t,e){var n,i=0,r=t.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)c(n=l(t[a]))?i+=n:--o;else for(;++a<r;)c(n=l(e.call(t,t[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),r=+t[i-1],a=n-i;return a?r+a*(t[i]-r):r},fo.median=function(t,e){var n,i=[],r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=l(t[a]))&&i.push(n);else for(;++a<r;)c(n=l(e.call(t,t[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(t,e){var n,i,r=t.length,a=0,o=0,s=-1,d=0;if(1===arguments.length)for(;++s<r;)c(n=l(t[s]))&&(i=n-a,a+=i/++d,o+=i*(n-a));else for(;++s<r;)c(n=l(e.call(t,t[s],s)))&&(i=n-a,a+=i/++d,o+=i*(n-a));if(d>1)return o/(d-1)},fo.deviation=function(){var t=fo.variance.apply(this,arguments);return t?Math.sqrt(t):t};var xo=d(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(t){return d(1===t.length?function(e,n){return s(t(e),n)}:t)},fo.shuffle=function(t,e,n){(a=arguments.length)<3&&(n=t.length,a<2&&(e=0));for(var i,r,a=n-e;a;)r=Math.random()*a--|0,i=t[a+e],t[a+e]=t[r+e],t[r+e]=i;return t},fo.permute=function(t,e){for(var n=e.length,i=new Array(n);n--;)i[n]=t[e[n]];return i},fo.pairs=function(t){for(var e=0,n=t.length-1,i=t[0],r=new Array(n<0?0:n);e<n;)r[e]=[i,i=t[++e]];return r},fo.transpose=function(t){if(!(r=t.length))return[];for(var e=-1,n=fo.min(t,u),i=new Array(n);++e<n;)for(var r,a=-1,o=i[e]=new Array(r);++a<r;)o[a]=t[a][e];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(t){var e=[];for(var n in t)e.push(n);return e},fo.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},fo.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},fo.merge=function(t){for(var e,n,i,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(n=new Array(o);--r>=0;)for(i=t[r],e=i.length;--e>=0;)n[--o]=i[e];return n};var ko=Math.abs;fo.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var i,r=[],a=h(ko(n)),o=-1;if(t*=a,e*=a,n*=a,n<0)for(;(i=t+n*++o)>e;)r.push(i/a);else for(;(i=t+n*++o)<e;)r.push(i/a);return r},fo.map=function(t,e){var n=new p;if(t instanceof p)t.forEach(function(t,e){n.set(t,e)});else if(Array.isArray(t)){var i,r=-1,a=t.length;if(1===arguments.length)for(;++r<a;)n.set(r,t[r]);else for(;++r<a;)n.set(e.call(t,i=t[r],r),i)}else for(var o in t)n.set(o,t[o]);return n};var Mo="__proto__",Co="\0";f(p,{has:m,get:function(t){return this._[_(t)]},set:function(t,e){return this._[_(t)]=e},remove:v,keys:y,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:g(e),value:this._[e]});return t},size:b,empty:w,forEach:function(t){for(var e in this._)t.call(this,g(e),this._[e])}}),fo.nest=function(){function t(e,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,c,d,u,h=-1,f=o.length,_=a[s++],g=new p;++h<f;)(u=g.get(l=_(c=o[h])))?u.push(c):g.set(l,[c]);return e?(c=e(),d=function(n,i){c.set(n,t(e,i,s))}):(c={},d=function(n,i){c[n]=t(e,i,s)}),g.forEach(d),c}function e(t,n){if(n>=a.length)return t;var i=[],r=o[n++];return t.forEach(function(t,r){i.push({key:t,values:e(r,n)})}),r?i.sort(function(t,e){return r(t.key,e.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(e,n){return t(n,e,0)},r.entries=function(n){return e(t(fo.map,n,0),0)},r.key=function(t){return a.push(t),r},r.sortKeys=function(t){return o[a.length-1]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return i=t,r},r},fo.set=function(t){var e=new x;if(t)for(var n=0,i=t.length;n<i;++n)e.add(t[n]);return e},f(x,{has:m,add:function(t){return this._[_(t+="")]=!0,t},remove:v,values:y,size:b,empty:w,forEach:function(t){for(var e in this._)t.call(this,g(e))}}),fo.behavior={},fo.rebind=function(t,e){for(var n,i=1,r=arguments.length;++i<r;)t[n=arguments[i]]=M(t,e,e[n]);return t};var So=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var t=new T,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=A(t);return t},T.prototype.on=function(t,e){var n=t.indexOf("."),i="";if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t)return arguments.length<2?this[t].on(i):this[t].on(i,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(i,null);return this}},fo.event=null,fo.requote=function(t){return t.replace(To,"\\$&")};var To=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Ao={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},jo=function(t,e){return e.querySelector(t)},Eo=function(t,e){return e.querySelectorAll(t)},Oo=function(t,e){var n=t.matches||t[C(t,"matchesSelector")];return(Oo=function(t,e){return n.call(t,e)})(t,e)};"function"==typeof Sizzle&&(jo=function(t,e){return Sizzle(t,e)[0]||null},Eo=Sizzle,Oo=Sizzle.matchesSelector),fo.selection=function(){return fo.select(go.documentElement)};var Lo=fo.selection.prototype=[];Lo.select=function(t){var e,n,i,r,a=[];t=N(t);for(var o=-1,s=this.length;++o<s;){a.push(e=[]),e.parentNode=(i=this[o]).parentNode;for(var l=-1,c=i.length;++l<c;)(r=i[l])?(e.push(n=t.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):e.push(null)}return L(a)},Lo.selectAll=function(t){var e,n,i=[];t=I(t);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(e=_o(t.call(n,n.__data__,s,r))),e.parentNode=n);return L(i)};var No="http://www.w3.org/1999/xhtml",Io={svg:"http://www.w3.org/2000/svg",xhtml:No,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:Io,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),Io.hasOwnProperty(n)?{space:Io[n],local:t}:t}},Lo.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=fo.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(P(e,t[e]));return this}return this.each(P(t,e))},Lo.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),i=(t=z(t)).length,r=-1;if(e=n.classList){for(;++r<i;)if(!e.contains(t[r]))return!1}else for(e=n.getAttribute("class");++r<i;)if(!R(t[r]).test(e))return!1;return!0}for(e in t)this.each($(e,t[e]));return this}return this.each($(t,e))},Lo.style=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e="");for(n in t)this.each(G(n,t[n],e));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(t)}n=""}return this.each(G(t,e,n))},Lo.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(V(e,t[e]));return this}return this.each(V(t,e))},Lo.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},Lo.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},Lo.append=function(t){return t=H(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},Lo.insert=function(t,e){return t=H(t),e=N(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},Lo.remove=function(){return this.each(F)},Lo.data=function(t,e){function n(t,n){var i,r,a,o=t.length,d=n.length,u=Math.min(o,d),h=new Array(d),f=new Array(d),_=new Array(o);if(e){var g,m=new p,v=new Array(o);for(i=-1;++i<o;)(r=t[i])&&(m.has(g=e.call(r,r.__data__,i))?_[i]=r:m.set(g,r),v[i]=g);for(i=-1;++i<d;)(r=m.get(g=e.call(n,a=n[i],i)))?!0!==r&&(h[i]=r,r.__data__=a):f[i]=Y(a),m.set(g,!0);for(i=-1;++i<o;)i in v&&!0!==m.get(v[i])&&(_[i]=t[i])}else{for(i=-1;++i<u;)r=t[i],a=n[i],r?(r.__data__=a,h[i]=r):f[i]=Y(a);for(;i<d;++i)f[i]=Y(n[i]);for(;i<o;++i)_[i]=t[i]}f.update=h,f.parentNode=h.parentNode=_.parentNode=t.parentNode,s.push(f),l.push(h),c.push(_)}var i,r,a=-1,o=this.length;if(!arguments.length){for(t=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(t[a]=r.__data__);return t}var s=X([]),l=L([]),c=L([]);if("function"==typeof t)for(;++a<o;)n(i=this[a],t.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],t);return l.enter=function(){return s},l.exit=function(){return c},l},Lo.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},Lo.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=q(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]),e.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return L(r)},Lo.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Lo.sort=function(t){t=U.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},Lo.each=function(t){return B(this,function(e,n,i){t.call(e,e.__data__,n,i)})},Lo.call=function(t){var e=_o(arguments);return t.apply(e[0]=this,e),this},Lo.empty=function(){return!this.node()},Lo.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Lo.size=function(){var t=0;return B(this,function(){++t}),t};var Po=[];fo.selection.enter=X,fo.selection.enter.prototype=Po,Po.append=Lo.append,Po.empty=Lo.empty,Po.node=Lo.node,Po.call=Lo.call,Po.size=Lo.size,Po.select=function(t){for(var e,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(e=[]),e.parentNode=r.parentNode;for(var c=-1,d=r.length;++c<d;)(a=r[c])?(e.push(i[c]=n=t.call(r.parentNode,a.__data__,c,s)),n.__data__=a.__data__):e.push(null)}return L(o)},Po.insert=function(t,e){return arguments.length<2&&(e=J(this)),Lo.insert.call(this,t,e)},fo.select=function(t){var e;return"string"==typeof t?(e=[jo(t,go)],e.parentNode=go.documentElement):(e=[t],e.parentNode=a(t)),L([e])},fo.selectAll=function(t){var e;return"string"==typeof t?(e=_o(Eo(t,go)),e.parentNode=go.documentElement):(e=_o(t),e.parentNode=null),L([e])},Lo.on=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e=!1);for(n in t)this.each(Q(n,t[n],e));return this}if(i<2)return(i=this.node()["__on"+t])&&i._;n=!1}return this.each(Q(t,e,n))};var Do=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});go&&Do.forEach(function(t){"on"+t in go&&Do.remove(t)});var Ro,zo=0;fo.mouse=function(t){return et(t,E())};var $o=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=E().changedTouches),e)for(var i,r=0,a=e.length;r<a;++r)if((i=e[r]).identifier===n)return et(t,i)},fo.behavior.drag=function(){function t(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function e(t,e,r,a,o){return function(){function s(){var t,n,i=e(h,_);i&&(t=i[0]-y[0],n=i[1]-y[1],p|=t|n,y=i,f({type:"drag",x:i[0]+c[0],y:i[1]+c[1],dx:t,dy:n}))}function l(){e(h,_)&&(m.on(a+g,null).on(o+g,null),v(p),f({type:"dragend"}))}var c,d=this,u=fo.event.target.correspondingElement||fo.event.target,h=d.parentNode,f=n.of(d,arguments),p=0,_=t(),g=".drag"+(null==_?"":"-"+_),m=fo.select(r(u)).on(a+g,s).on(o+g,l),v=tt(u),y=e(h,_);i?(c=i.apply(d,arguments),c=[c.x-y[0],c.y-y[1]]):c=[0,0],f({type:"dragstart"})}}var n=O(t,"drag","dragstart","dragend"),i=null,r=e(S,fo.mouse,o,"mousemove","mouseup"),a=e(nt,fo.touch,k,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},fo.rebind(t,n,"on")},fo.touches=function(t,e){return arguments.length<2&&(e=E().touches),e?_o(e).map(function(e){var n=et(t,e);return n.identifier=e.identifier,n}):[]};var Wo=1e-6,Go=Wo*Wo,Vo=Math.PI,Ho=2*Vo,Fo=Ho-Wo,Yo=Vo/2,qo=Vo/180,Uo=180/Vo,Bo=Math.SQRT2;fo.interpolateZoom=function(t,e){var n,i,r=t[0],a=t[1],o=t[2],s=e[0],l=e[1],c=e[2],d=s-r,u=l-a,h=d*d+u*u;if(h<Go)i=Math.log(c/o)/Bo,n=function(t){return[r+t*d,a+t*u,o*Math.exp(Bo*t*i)]};else{var f=Math.sqrt(h),p=(c*c-o*o+4*h)/(2*o*2*f),_=(c*c-o*o-4*h)/(2*c*2*f),g=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(_*_+1)-_);i=(m-g)/Bo,n=function(t){var e=t*i,n=lt(g),s=o/(2*f)*(n*ct(Bo*e+g)-st(g));return[r+s*d,a+s*u,o*n/lt(Bo*e+g)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function t(t){t.on(E,u).on(Jo+".zoom",f).on("dblclick.zoom",p).on(I,h)}function e(t){return[(t[0]-M.x)/M.k,(t[1]-M.y)/M.k]}function n(t){return[t[0]*M.k+M.x,t[1]*M.k+M.y]}function i(t){M.k=Math.max(S[0],Math.min(S[1],t))}function r(t,e){e=n(e),M.x+=t[0]-e[0],M.y+=t[1]-e[1]}function a(e,n,a,o){e.__chart__={x:M.x,y:M.y,k:M.k},i(Math.pow(2,o)),r(g=n,a),e=fo.select(e),T>0&&(e=e.transition().duration(T)),e.call(t.event)}function s(){w&&w.domain(b.range().map(function(t){return(t-M.x)/M.k}).map(b.invert)),k&&k.domain(x.range().map(function(t){return(t-M.y)/M.k}).map(x.invert))}function l(t){A++||t({type:"zoomstart"})}function c(t){s(),t({type:"zoom",scale:M.k,translate:[M.x,M.y]})}function d(t){--A||(t({type:"zoomend"}),g=null)}function u(){function t(){s=1,r(fo.mouse(i),h),c(a)}function n(){u.on(L,null).on(N,null),f(s),d(a)}var i=this,a=P.of(i,arguments),s=0,u=fo.select(o(i)).on(L,t).on(N,n),h=e(fo.mouse(i)),f=tt(i);Hl.call(i),l(a)}function h(){function t(){var t=fo.touches(p);return f=M.k,t.forEach(function(t){t.identifier in g&&(g[t.identifier]=e(t))}),t}function n(){var e=fo.event.target;fo.select(e).on(b,o).on(w,s),x.push(e);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)g[n[i].identifier]=null;var l=t(),c=Date.now();if(1===l.length){if(c-y<500){var d=l[0];a(p,d,g[d.identifier],Math.floor(Math.log(M.k)/Math.LN2)+1),j()}y=c}else if(l.length>1){var d=l[0],u=l[1],h=d[0]-u[0],f=d[1]-u[1];m=h*h+f*f}}function o(){var t,e,n,a,o=fo.touches(p);Hl.call(p);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=g[n.identifier]){if(e)break;t=n,e=a}if(a){var d=(d=n[0]-t[0])*d+(d=n[1]-t[1])*d,u=m&&Math.sqrt(d/m);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+a[0])/2,(e[1]+a[1])/2],i(u*f)}y=null,r(t,e),c(_)}function s(){if(fo.event.touches.length){for(var e=fo.event.changedTouches,n=0,i=e.length;n<i;++n)delete g[e[n].identifier];for(var r in g)return void t()}fo.selectAll(x).on(v,null),k.on(E,u).on(I,h),C(),d(_)}var f,p=this,_=P.of(p,arguments),g={},m=0,v=".zoom-"+fo.event.changedTouches[0].identifier,b="touchmove"+v,w="touchend"+v,x=[],k=fo.select(p),C=tt(p);n(),l(_),k.on(E,null).on(I,n)}function f(){var t=P.of(this,arguments);v?clearTimeout(v):(Hl.call(this),_=e(g=m||fo.mouse(this)),l(t)),v=setTimeout(function(){v=null,d(t)},50),j(),i(Math.pow(2,.002*Xo())*M.k),r(g,_),c(t)}function p(){var t=fo.mouse(this),n=Math.log(M.k)/Math.LN2;a(this,t,e(t),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var _,g,m,v,y,b,w,x,k,M={x:0,y:0,k:1},C=[960,500],S=Qo,T=250,A=0,E="mousedown.zoom",L="mousemove.zoom",N="mouseup.zoom",I="touchstart.zoom",P=O(t,"zoomstart","zoom","zoomend");return Jo||(Jo="onwheel"in go?(Xo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in go?(Xo=function(){return fo.event.wheelDelta},"mousewheel"):(Xo=function(){return-fo.event.detail},"MozMousePixelScroll")),t.event=function(t){t.each(function(){var t=P.of(this,arguments),e=M;Gl?fo.select(this).transition().each("start.zoom",function(){M=this.__chart__||{x:0,y:0,k:1},l(t)}).tween("zoom:zoom",function(){var n=C[0],i=C[1],r=g?g[0]:n/2,a=g?g[1]:i/2,o=fo.interpolateZoom([(r-M.x)/M.k,(a-M.y)/M.k,n/M.k],[(r-e.x)/e.k,(a-e.y)/e.k,n/e.k]);return function(e){var i=o(e),s=n/i[2];this.__chart__=M={x:r-i[0]*s,y:a-i[1]*s,k:s},c(t)}}).each("interrupt.zoom",function(){d(t)}).each("end.zoom",function(){d(t)}):(this.__chart__=M,l(t),c(t),d(t))})},t.translate=function(e){return arguments.length?(M={x:+e[0],y:+e[1],k:M.k},s(),t):[M.x,M.y]},t.scale=function(e){return arguments.length?(M={x:M.x,y:M.y,k:null},i(+e),s(),t):M.k},t.scaleExtent=function(e){return arguments.length?(S=null==e?Qo:[+e[0],+e[1]],t):S},t.center=function(e){return arguments.length?(m=e&&[+e[0],+e[1]],t):m},t.size=function(e){return arguments.length?(C=e&&[+e[0],+e[1]],t):C},t.duration=function(e){return arguments.length?(T=+e,t):T},t.x=function(e){return arguments.length?(w=e,b=e.copy(),M={x:0,y:0,k:1},t):w},t.y=function(e){return arguments.length?(k=e,x=e.copy(),M={x:0,y:0,k:1},t):k},fo.rebind(t,P,"on")};var Xo,Jo,Qo=[0,1/0];fo.color=ut,ut.prototype.toString=function(){return this.rgb()+""},fo.hsl=ht;var Ko=ht.prototype=new ut;Ko.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new ht(this.h,this.s,this.l/t)},Ko.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new ht(this.h,this.s,t*this.l)},Ko.rgb=function(){return ft(this.h,this.s,this.l)},fo.hcl=pt;var Zo=pt.prototype=new ut;Zo.brighter=function(t){return new pt(this.h,this.c,Math.min(100,this.l+ts*(arguments.length?t:1)))},Zo.darker=function(t){return new pt(this.h,this.c,Math.max(0,this.l-ts*(arguments.length?t:1)))},Zo.rgb=function(){return _t(this.h,this.c,this.l).rgb()},fo.lab=gt;var ts=18,es=.95047,ns=1,is=1.08883,rs=gt.prototype=new ut;rs.brighter=function(t){return new gt(Math.min(100,this.l+ts*(arguments.length?t:1)),this.a,this.b)},rs.darker=function(t){return new gt(Math.max(0,this.l-ts*(arguments.length?t:1)),this.a,this.b)},rs.rgb=function(){return mt(this.l,this.a,this.b)},fo.rgb=xt;var as=xt.prototype=new ut;as.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,r=30;return e||n||i?(e&&e<r&&(e=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xt(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,i/t))):new xt(r,r,r)},as.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new xt(t*this.r,t*this.g,t*this.b)},as.hsl=function(){return Tt(this.r,this.g,this.b)},as.toString=function(){return"#"+Ct(this.r)+Ct(this.g)+Ct(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(t,e){os.set(t,kt(e))}),fo.functor=Ot,fo.xhr=Lt(k),fo.dsv=function(t,e){function n(t,n,a){arguments.length<3&&(a=n,n=null);var o=Nt(t,e,null==n?i:r(n),a);return o.row=function(t){return arguments.length?o.response(null==(n=t)?i:r(t)):n},o}function i(t){return n.parse(t.responseText)}function r(t){return function(e){return n.parse(e.responseText,t)}}function a(e){return e.map(o).join(t)}function o(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),l=t.charCodeAt(0);return n.parse=function(t,e){var i;return n.parseRows(t,function(t,n){if(i)return i(t,n-1);var r=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");i=e?function(t,n){return e(r(t),n)}:r})},n.parseRows=function(t,e){function n(){if(d>=c)return o;if(r)return r=!1,a;var e=d;if(34===t.charCodeAt(e)){for(var n=e;n++<c;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}d=n+2;var i=t.charCodeAt(n+1);return 13===i?(r=!0,10===t.charCodeAt(n+2)&&++d):10===i&&(r=!0),t.slice(e+1,n).replace(/""/g,'"')}for(;d<c;){var i=t.charCodeAt(d++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===t.charCodeAt(d)&&(++d,++s);else if(i!==l)continue;return t.slice(e,d-s)}return t.slice(e)}for(var i,r,a={},o={},s=[],c=t.length,d=0,u=0;(i=n())!==o;){for(var h=[];i!==a&&i!==o;)h.push(i),i=n();e&&null==(h=e(h,u++))||s.push(h)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var i=new x,r=[];return e.forEach(function(t){for(var e in t)i.has(e)||r.push(i.add(e))}),[r.map(o).join(t)].concat(e.map(function(e){return r.map(function(t){return o(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,cs,ds,us=this[C(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};fo.timer=function(){Dt.apply(this,arguments)},fo.timer.flush=function(){zt(),$t()},fo.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var hs=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Gt);fo.formatPrefix=function(t,e){var n=0;return(t=+t)&&(t<0&&(t*=-1),e&&(t=fo.round(t,Wt(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),hs[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ps=fo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=fo.round(t,Wt(t,e))).toFixed(Math.max(0,Math.min(20,Wt(t*(1+1e-15),e))))}}),_s=fo.time={},gs=Date;Ft.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ms.setUTCDate.apply(this._,arguments)},setDay:function(){ms.setUTCDay.apply(this._,arguments)},setFullYear:function(){ms.setUTCFullYear.apply(this._,arguments)},setHours:function(){ms.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ms.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ms.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ms.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ms.setUTCSeconds.apply(this._,arguments)},setTime:function(){ms.setTime.apply(this._,arguments)}};var ms=Date.prototype;_s.year=Yt(function(t){return t=_s.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),_s.years=_s.year.range,_s.years.utc=_s.year.utc.range,_s.day=Yt(function(t){var e=new gs(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),_s.days=_s.day.range,_s.days.utc=_s.day.utc.range,_s.dayOfYear=function(t){var e=_s.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=_s[t]=Yt(function(t){return(t=_s.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=_s.year(t).getDay();return Math.floor((_s.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});_s[t+"s"]=n.range,_s[t+"s"].utc=n.utc.range,_s[t+"OfYear"]=function(t){var n=_s.year(t).getDay();return Math.floor((_s.dayOfYear(t)+(n+e)%7)/7)}}),_s.week=_s.sunday,_s.weeks=_s.sunday.range,_s.weeks.utc=_s.sunday.utc.range,_s.weekOfYear=_s.sundayOfYear;var vs={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,bs=/^%/;fo.locale=function(t){return{numberFormat:Vt(t),timeFormat:Ut(t)}};var ws=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=ws.numberFormat,fo.geo={},pe.prototype={s:0,t:0,add:function(t){_e(t,this.t,xs),_e(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new pe;fo.geo.stream=function(t,e){t&&ks.hasOwnProperty(t.type)?ks[t.type](t,e):ge(t,e)};var ks={Feature:function(t,e){ge(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)ge(n[i].geometry,e)}},Ms={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){me(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)me(n[i],e,0)},Polygon:function(t,e){ve(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ve(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)ge(n[i],e)}};fo.geo.area=function(t){return Cs=0,fo.geo.stream(t,Ts),Cs};var Cs,Ss=new pe,Ts={sphere:function(){Cs+=4*Vo},point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ss.reset(),Ts.lineStart=ye},polygonEnd:function(){var t=2*Ss;Cs+=t<0?4*Vo+t:t,Ts.lineStart=Ts.lineEnd=Ts.point=S}};fo.geo.bounds=function(){function t(t,e){y.push(b=[d=t,h=t]),e<u&&(u=e),e>f&&(f=e)}function e(e,n){var i=be([e*qo,n*qo]);if(m){var r=xe(m,i),a=[r[1],-r[0],0],o=xe(a,r);Ce(o),o=Se(o);var l=e-p,c=l>0?1:-1,_=o[0]*Uo*c,g=ko(l)>180;if(g^(c*p<_&&_<c*e)){var v=o[1]*Uo;v>f&&(f=v)}else if(_=(_+360)%360-180,g^(c*p<_&&_<c*e)){var v=-o[1]*Uo;v<u&&(u=v)}else n<u&&(u=n),n>f&&(f=n);g?e<p?s(d,e)>s(d,h)&&(h=e):s(e,h)>s(d,h)&&(d=e):h>=d?(e<d&&(d=e),e>h&&(h=e)):e>p?s(d,e)>s(d,h)&&(h=e):s(e,h)>s(d,h)&&(d=e)}else t(e,n);m=i,p=e}function n(){w.point=e}function i(){b[0]=d,b[1]=h,w.point=t,m=null}function r(t,n){if(m){var i=t-p;v+=ko(i)>180?i+(i>0?360:-360):i}else _=t,g=n;Ts.point(t,n),e(t,n)}function a(){Ts.lineStart()}function o(){r(_,g),Ts.lineEnd(),ko(v)>Wo&&(d=-(h=180)),b[0]=d,b[1]=h,m=null}function s(t,e){return(e-=t)<0?e+360:e}function l(t,e){return t[0]-e[0]}function c(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var d,u,h,f,p,_,g,m,v,y,b,w={point:t,lineStart:n,lineEnd:i,polygonStart:function(){w.point=r,w.lineStart=a,w.lineEnd=o,v=0,Ts.polygonStart()},polygonEnd:function(){Ts.polygonEnd(),w.point=t,w.lineStart=n,w.lineEnd=i,Ss<0?(d=-(h=180),u=-(f=90)):v>Wo?f=90:v<-Wo&&(u=-90),b[0]=d,b[1]=h}};return function(t){f=h=-(d=u=1/0),y=[],fo.geo.stream(t,w);var e=y.length;if(e){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<e;++i)n=y[i],c(n[0],r)||c(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,p=-1/0,e=a.length-1,i=0,r=a[e];i<=e;r=n,++i)n=a[i],(o=s(r[1],n[0]))>p&&(p=o,d=n[0],h=r[1])}return y=b=null,d===1/0||u===1/0?[[NaN,NaN],[NaN,NaN]]:[[d,u],[h,f]]}}(),fo.geo.centroid=function(t){As=js=Es=Os=Ls=Ns=Is=Ps=Ds=Rs=zs=0,fo.geo.stream(t,$s);var e=Ds,n=Rs,i=zs,r=e*e+n*n+i*i;return r<Go&&(e=Ns,n=Is,i=Ps,js<Wo&&(e=Es,n=Os,i=Ls),(r=e*e+n*n+i*i)<Go)?[NaN,NaN]:[Math.atan2(n,e)*Uo,ot(i/Math.sqrt(r))*Uo]};var As,js,Es,Os,Ls,Ns,Is,Ps,Ds,Rs,zs,$s={sphere:S,point:Ae,lineStart:Ee,lineEnd:Oe,polygonStart:function(){$s.lineStart=Le},polygonEnd:function(){$s.lineStart=Ee}},Ws=ze(Ie,Ve,Fe,[-Vo,-Vo/2]),Gs=1e9;fo.geo.clipExtent=function(){var t,e,n,i,r,a,o={stream:function(t){return r&&(r.valid=!1),r=a(t),r.valid=!0,r},extent:function(s){return arguments.length?(a=Be(t=+s[0][0],e=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[t,e],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return Xe(Je)}).raw=Je,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function t(t){var a=t[0],o=t[1];return e=null,n(a,o),e||(i(a,o),e)||r(a,o),e}var e,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=a.scale(),n=a.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(t)},t.stream=function(t){var e=a.stream(t),n=o.stream(t),i=s.stream(t);return{point:function(t,r){e.point(t,r),n.point(t,r),i.point(t,r)},sphere:function(){e.sphere(),n.sphere(),i.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},t.precision=function(e){return arguments.length?(a.precision(e),o.precision(e),s.precision(e),t):a.precision()},t.scale=function(e){return arguments.length?(a.scale(e),o.scale(.35*e),s.scale(e),t.translate(a.translate())):a.scale()},t.translate=function(e){if(!arguments.length)return a.translate();var c=a.scale(),d=+e[0],u=+e[1];return n=a.translate(e).clipExtent([[d-.455*c,u-.238*c],[d+.455*c,u+.238*c]]).stream(l).point,i=o.translate([d-.307*c,u+.201*c]).clipExtent([[d-.425*c+Wo,u+.12*c+Wo],[d-.214*c-Wo,u+.234*c-Wo]]).stream(l).point,r=s.translate([d-.205*c,u+.212*c]).clipExtent([[d-.214*c+Wo,u+.166*c+Wo],[d-.115*c-Wo,u+.234*c-Wo]]).stream(l).point,t},t.scale(1070)};var Vs,Hs,Fs,Ys,qs,Us,Bs={point:S,lineStart:S,lineEnd:S,polygonStart:function(){Hs=0,Bs.lineStart=Qe},polygonEnd:function(){Bs.lineStart=Bs.lineEnd=Bs.point=S,Vs+=ko(Hs/2)}},Xs={point:Ke,lineStart:S,lineEnd:S,polygonStart:S,polygonEnd:S},Js={point:en,lineStart:nn,lineEnd:rn,polygonStart:function(){Js.lineStart=an},polygonEnd:function(){Js.point=en,Js.lineStart=nn,Js.lineEnd=rn}};fo.geo.path=function(){function t(t){return t&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(t,o)),a.result()}function e(){return o=null,t}var n,i,r,a,o,s=4.5;return t.area=function(t){return Vs=0,fo.geo.stream(t,r(Bs)),Vs},t.centroid=function(t){return Es=Os=Ls=Ns=Is=Ps=Ds=Rs=zs=0,fo.geo.stream(t,r(Js)),zs?[Ds/zs,Rs/zs]:Ps?[Ns/Ps,Is/Ps]:Ls?[Es/Ls,Os/Ls]:[NaN,NaN]},t.bounds=function(t){return qs=Us=-(Fs=Ys=1/0),fo.geo.stream(t,r(Xs)),[[Fs,Ys],[qs,Us]]},t.projection=function(t){return arguments.length?(r=(n=t)?t.stream||ln(t):k,e()):n},t.context=function(t){return arguments.length?(a=null==(i=t)?new Ze:new on(t),"function"!=typeof s&&a.pointRadius(s),e()):i},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(a.pointRadius(+e),+e),t):s},t.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(t){return{stream:function(e){var n=new cn(e);for(var i in t)n[i]=t[i];return n}}},cn.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=un,fo.geo.projectionMutator=hn,(fo.geo.equirectangular=function(){return un(pn)}).raw=pn.invert=pn,fo.geo.rotation=function(t){function e(e){return e=t(e[0]*qo,e[1]*qo),e[0]*=Uo,e[1]*=Uo,e}return t=gn(t[0]%360*qo,t[1]*qo,t.length>2?t[2]*qo:0),e.invert=function(e){return e=t.invert(e[0]*qo,e[1]*qo),e[0]*=Uo,e[1]*=Uo,e},e},_n.invert=pn,fo.geo.circle=function(){function t(){var t="function"==typeof i?i.apply(this,arguments):i,e=gn(-t[0]*qo,-t[1]*qo,0).invert,r=[];return n(null,null,1,{point:function(t,n){r.push(t=e(t,n)),t[0]*=Uo,t[1]*=Uo}}),{type:"Polygon",coordinates:[r]}}var e,n,i=[0,0],r=6;return t.origin=function(e){return arguments.length?(i=e,t):i},t.angle=function(i){return arguments.length?(n=bn((e=+i)*qo,r*qo),t):e},t.precision=function(i){return arguments.length?(n=bn(e*qo,(r=+i)*qo),t):r},t.angle(90)},fo.geo.distance=function(t,e){var n,i=(e[0]-t[0])*qo,r=t[1]*qo,a=e[1]*qo,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);return Math.atan2(Math.sqrt((n=u*o)*n+(n=c*d-l*u*s)*n),l*d+c*u*s)},fo.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return fo.range(Math.ceil(a/g)*g,r,g).map(h).concat(fo.range(Math.ceil(c/m)*m,l,m).map(f)).concat(fo.range(Math.ceil(i/p)*p,n,p).filter(function(t){return ko(t%g)>Wo}).map(d)).concat(fo.range(Math.ceil(s/_)*_,o,_).filter(function(t){return ko(t%m)>Wo}).map(u))}var n,i,r,a,o,s,l,c,d,u,h,f,p=10,_=p,g=90,m=360,v=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[h(a).concat(f(l).slice(1),h(r).reverse().slice(1),f(c).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(a=+e[0][0],r=+e[1][0],c=+e[0][1],l=+e[1][1],a>r&&(e=a,a=r,r=e),c>l&&(e=c,c=l,l=e),t.precision(v)):[[a,c],[r,l]]},t.minorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],i>n&&(e=i,i=n,n=e),s>o&&(e=s,s=o,o=e),t.precision(v)):[[i,s],[n,o]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(g=+e[0],m=+e[1],t):[g,m]},t.minorStep=function(e){return arguments.length?(p=+e[0],_=+e[1],t):[p,_]},t.precision=function(e){return arguments.length?(v=+e,d=xn(s,o,90),u=kn(i,n,v),h=xn(c,l,90),f=kn(a,r,v),t):v},t.majorExtent([[-180,-90+Wo],[180,90-Wo]]).minorExtent([[-180,-80-Wo],[180,80+Wo]])},fo.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||i.apply(this,arguments),n||r.apply(this,arguments)]}}var e,n,i=Mn,r=Cn;return t.distance=function(){return fo.geo.distance(e||i.apply(this,arguments),n||r.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,e="function"==typeof n?null:n,t):i},t.target=function(e){return arguments.length?(r=e,n="function"==typeof e?null:e,t):r},t.precision=function(){return arguments.length?t:0},t},fo.geo.interpolate=function(t,e){return Sn(t[0]*qo,t[1]*qo,e[0]*qo,e[1]*qo)},fo.geo.length=function(t){return Qs=0,fo.geo.stream(t,Ks),Qs};var Qs,Ks={sphere:S,point:S,lineStart:Tn,lineEnd:S,polygonStart:S,polygonEnd:S},Zs=An(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(fo.geo.azimuthalEqualArea=function(){return un(Zs)}).raw=Zs;var tl=An(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},k);(fo.geo.azimuthalEquidistant=function(){return un(tl)}).raw=tl,(fo.geo.conicConformal=function(){return Xe(jn)}).raw=jn,(fo.geo.conicEquidistant=function(){return Xe(En)}).raw=En;var el=An(function(t){return 1/t},Math.atan);(fo.geo.gnomonic=function(){return un(el)}).raw=el,On.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Yo]},(fo.geo.mercator=function(){return Ln(On)}).raw=On;var nl=An(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return un(nl)}).raw=nl;var il=An(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(fo.geo.stereographic=function(){return un(il)}).raw=il,Nn.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Yo]},(fo.geo.transverseMercator=function(){var t=Ln(Nn),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=Nn,fo.geom={},fo.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,r=Ot(n),a=Ot(i),o=t.length,s=[],l=[];for(e=0;e<o;e++)s.push([+r.call(this,t[e],e),+a.call(this,t[e],e),e]);for(s.sort(Rn),e=0;e<o;e++)l.push([s[e][0],-s[e][1]]);var c=Dn(s),d=Dn(l),u=d[0]===c[0],h=d[d.length-1]===c[c.length-1],f=[];for(e=c.length-1;e>=0;--e)f.push(t[s[c[e]][2]]);for(e=+u;e<d.length-h;++e)f.push(t[s[d[e]][2]]);return f}var n=In,i=Pn;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e)},fo.geom.polygon=function(t){return Ao(t,rl),t};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var t,e=-1,n=this.length,i=this[n-1],r=0;++e<n;)t=i,i=this[e],r+=t[1]*i[0]-t[0]*i[1];return.5*r},rl.centroid=function(t){var e,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(t=-1/(6*this.area()));++i<r;)e=s,s=this[i],n=e[0]*s[1]-s[0]*e[1],a+=(e[0]+s[0])*n,o+=(e[1]+s[1])*n;return[a*t,o*t]},rl.clip=function(t){for(var e,n,i,r,a,o,s=Wn(t),l=-1,c=this.length-Wn(this),d=this[c-1];++l<c;){for(e=t.slice(),t.length=0,r=this[l],a=e[(i=e.length-s)-1],n=-1;++n<i;)o=e[n],zn(o,d,r)?(zn(a,d,r)||t.push($n(a,o,d,r)),t.push(o)):zn(a,d,r)&&t.push($n(a,o,d,r)),a=o;s&&t.push(t[0]),d=r}return t};var al,ol,sl,ll,cl,dl=[],ul=[];Bn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Jn),e.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(t,e){var n,i,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ui(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.R&&(ci(this,n),t=n,n=t.U),n.C=!1,i.C=!0,di(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.L&&(di(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ci(this,i))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,i,r=t.U,a=t.L,o=t.R;if(n=a?o?ui(o):a:o,r?r.L===t?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=t.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=t.U,t=n.R,r.L=t,n.R=o,o.U=n):(n.U=r,r=n,t=n.R)):(i=t.C,t=n),t&&(t.U=r),!i){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===r.L){if(e=r.R,e.C&&(e.C=!1,r.C=!0,ci(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,di(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,ci(this,r),t=this._;break}}else if(e=r.L,e.C&&(e.C=!1,r.C=!0,di(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ci(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,di(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}},fo.geom.voronoi=function(t){function e(t){var e=new Array(t.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return hi(n(t),s).cells.forEach(function(n,s){var l=n.edges,c=n.site;(e[s]=l.length?l.map(function(t){var e=t.start();return[e.x,e.y]}):c.x>=i&&c.x<=a&&c.y>=r&&c.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(a(t,e)/Wo)*Wo,y:Math.round(o(t,e)/Wo)*Wo,i:e}})}var i=In,r=Pn,a=i,o=r,s=hl;return t?e(t):(e.links=function(t){return hi(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return hi(n(t)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Jn),s=-1,l=o.length,c=o[l-1].edge,d=c.l===a?c.r:c.l;++s<l;)c,r=d,c=o[s].edge,d=c.l===a?c.r:c.l,i<r.i&&i<d.i&&pi(a,r,d)<0&&e.push([t[i],t[r.i],t[d.i]])}),e},e.x=function(t){return arguments.length?(a=Ot(i=t),e):i},e.y=function(t){return arguments.length?(o=Ot(r=t),e):r},e.clipExtent=function(t){return arguments.length?(s=null==t?hl:t,e):s===hl?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===hl?null:s&&s[1]},e)};var hl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(t){return fo.geom.voronoi().triangles(t)},fo.geom.quadtree=function(t,e,n,i,r){function a(t){function a(t,e,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(t.leaf){var l=t.x,d=t.y;if(null!=l)if(ko(l-n)+ko(d-i)<.01)c(t,e,n,i,r,a,o,s);else{var u=t.point;t.x=t.y=t.point=null,c(t,u,l,d,r,a,o,s),c(t,e,n,i,r,a,o,s)}else t.x=n,t.y=i,t.point=e}else c(t,e,n,i,r,a,o,s)}function c(t,e,n,i,r,o,s,l){var c=.5*(r+s),d=.5*(o+l),u=n>=c,h=i>=d,f=h<<1|u;t.leaf=!1,t=t.nodes[f]||(t.nodes[f]=mi()),u?r=c:s=c,h?o=d:l=d,a(t,e,n,i,r,o,s,l)}var d,u,h,f,p,_,g,m,v,y=Ot(s),b=Ot(l);if(null!=e)_=e,g=n,m=i,v=r;else if(m=v=-(_=g=1/0),u=[],h=[],p=t.length,o)for(f=0;f<p;++f)d=t[f],d.x<_&&(_=d.x),d.y<g&&(g=d.y),d.x>m&&(m=d.x),d.y>v&&(v=d.y),u.push(d.x),h.push(d.y);else for(f=0;f<p;++f){var w=+y(d=t[f],f),x=+b(d,f);w<_&&(_=w),x<g&&(g=x),w>m&&(m=w),x>v&&(v=x),u.push(w),h.push(x)}var k=m-_,M=v-g;k>M?v=g+k:m=_+M;var C=mi();if(C.add=function(t){a(C,t,+y(t,++f),+b(t,f),_,g,m,v)},C.visit=function(t){vi(t,C,_,g,m,v)},C.find=function(t){return yi(C,t[0],t[1],_,g,m,v)},f=-1,null==e){for(;++f<p;)a(C,t[f],u[f],h[f],_,g,m,v);--f}else t.forEach(C.add);return u=h=t=d=null,C}var o,s=In,l=Pn;return(o=arguments.length)?(s=_i,l=gi,3===o&&(r=n,i=e,n=e=0),a(t)):(a.x=function(t){return arguments.length?(s=t,a):s},a.y=function(t){return arguments.length?(l=t,a):l},a.extent=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),a):null==e?null:[[e,n],[i,r]]},a.size=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=n=0,i=+t[0],r=+t[1]),a):null==e?null:[i-e,r-n]},a)},fo.interpolateRgb=bi,fo.interpolateObject=wi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(fl.source,"g");fo.interpolate=Mi,fo.interpolators=[function(t,e){var n=typeof e;return("string"===n?os.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?bi:ki:e instanceof ut?bi:Array.isArray(e)?Ci:"object"===n&&isNaN(e)?wi:xi)(t,e)}],fo.interpolateArray=Ci;var _l=function(){return k},gl=fo.map({linear:_l,poly:Li,quad:function(){return ji},cubic:function(){return Ei},sin:function(){return Ni},exp:function(){return Ii},circle:function(){return Pi},elastic:Di,back:Ri,bounce:function(){return zi}}),ml=fo.map({in:k,out:Ti,"in-out":Ai,"out-in":function(t){return Ai(Ti(t))}});fo.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.slice(0,e):t,i=e>=0?t.slice(e+1):"in";return n=gl.get(n)||_l,i=ml.get(i)||k,Si(i(n.apply(null,po.call(arguments,1))))},fo.interpolateHcl=$i,fo.interpolateHsl=Wi,fo.interpolateLab=Gi,fo.interpolateRound=Vi,fo.transform=function(t){var e=go.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Hi(n?n.matrix:vl)})(t)},Hi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var vl={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Ki,fo.layout={},fo.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(er(t[n]));return e}},fo.layout.chord=function(){function t(){var t,c,u,h,f,p={},_=[],g=fo.range(a),m=[];for(n=[],i=[],t=0,h=-1;++h<a;){for(c=0,f=-1;++f<a;)c+=r[h][f];_.push(c),m.push(fo.range(a)),t+=c}for(o&&g.sort(function(t,e){return o(_[t],_[e])}),s&&m.forEach(function(t,e){t.sort(function(t,n){return s(r[e][t],r[e][n])})}),t=(Ho-d*a)/t,c=0,h=-1;++h<a;){for(u=c,f=-1;++f<a;){var v=g[h],y=m[v][f],b=r[v][y],w=c,x=c+=b*t;p[v+"-"+y]={index:v,subindex:y,startAngle:w,endAngle:x,value:b}}i[v]={index:v,startAngle:u,endAngle:c,value:_[v]},c+=d}for(h=-1;++h<a;)for(f=h-1;++f<a;){var k=p[h+"-"+f],M=p[f+"-"+h];(k.value||M.value)&&n.push(k.value<M.value?{source:M,target:k}:{source:k,target:M})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,r,a,o,s,l,c={},d=0;return c.matrix=function(t){return arguments.length?(a=(r=t)&&r.length,n=i=null,c):r},c.padding=function(t){return arguments.length?(d=t,n=i=null,c):d},c.sortGroups=function(t){return arguments.length?(o=t,n=i=null,c):o},c.sortSubgroups=function(t){return arguments.length?(s=t,n=null,c):s},c.sortChords=function(t){return arguments.length?(l=t,n&&e(),c):l},c.chords=function(){return n||t(),n},c.groups=function(){return i||t(),i},c},fo.layout.force=function(){function t(t){return function(e,n,i,r){if(e.point!==t){var a=e.cx-t.x,o=e.cy-t.y,s=r-n,l=a*a+o*o;if(s*s/m<l){if(l<_){var c=e.charge/l;t.px-=a*c,t.py-=o*c}return!0}if(e.point&&l&&l<_){var c=e.pointCharge/l;t.px-=a*c,t.py-=o*c}}return!e.charge}}function e(t){t.px=fo.event.x,t.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},c=fo.dispatch("start","tick","end"),d=[1,1],u=.9,h=yl,f=bl,p=-30,_=wl,g=.1,m=.64,v=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,c.end({type:"end",alpha:r=0}),!0;var e,i,l,h,f,_,m,b,w,x=v.length,k=y.length;for(i=0;i<k;++i)l=y[i],h=l.source,f=l.target,b=f.x-h.x,w=f.y-h.y,(_=b*b+w*w)&&(_=r*o[i]*((_=Math.sqrt(_))-a[i])/_,b*=_,w*=_,f.x-=b*(m=h.weight+f.weight?h.weight/(h.weight+f.weight):.5),f.y-=w*m,h.x+=b*(m=1-m),h.y+=w*m);if((m=r*g)&&(b=d[0]/2,w=d[1]/2,i=-1,m))for(;++i<x;)l=v[i],l.x+=(b-l.x)*m,l.y+=(w-l.y)*m;if(p)for(lr(e=fo.geom.quadtree(v),r,s),i=-1;++i<x;)(l=v[i]).fixed||e.visit(t(l));for(i=-1;++i<x;)l=v[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*u,l.y-=(l.py-(l.py=l.y))*u);c.tick({type:"tick",alpha:r})},l.nodes=function(t){return arguments.length?(v=t,l):v},l.links=function(t){return arguments.length?(y=t,l):y},l.size=function(t){return arguments.length?(d=t,l):d},l.linkDistance=function(t){return arguments.length?(h="function"==typeof t?t:+t,l):h},l.distance=l.linkDistance,l.linkStrength=function(t){return arguments.length?(f="function"==typeof t?t:+t,l):f},l.friction=function(t){return arguments.length?(u=+t,l):u},l.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,l):p},l.chargeDistance=function(t){return arguments.length?(_=t*t,l):Math.sqrt(_)},l.gravity=function(t){return arguments.length?(g=+t,l):g},l.theta=function(t){return arguments.length?(m=t*t,l):Math.sqrt(m)},l.alpha=function(t){return arguments.length?(t=+t,r?t>0?r=t:(n.c=null,n.t=NaN,n=null,c.end({type:"end",alpha:r=0})):t>0&&(c.start({type:"start",alpha:r=t}),n=Dt(l.tick)),l):r},l.start=function(){function t(t,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<c;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[e],l=-1,d=s.length;++l<d;)if(!isNaN(o=s[l][t]))return o;return Math.random()*i}var e,n,i,r=v.length,c=y.length,u=d[0],_=d[1];for(e=0;e<r;++e)(i=v[e]).index=e,i.weight=0;for(e=0;e<c;++e)i=y[e],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(e=0;e<r;++e)i=v[e],isNaN(i.x)&&(i.x=t("x",u)),isNaN(i.y)&&(i.y=t("y",_)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof h)for(e=0;e<c;++e)a[e]=+h.call(this,y[e],e);else for(e=0;e<c;++e)a[e]=h;if(o=[],"function"==typeof f)for(e=0;e<c;++e)o[e]=+f.call(this,y[e],e);else for(e=0;e<c;++e)o[e]=f;if(s=[],"function"==typeof p)for(e=0;e<r;++e)s[e]=+p.call(this,v[e],e);else for(e=0;e<r;++e)s[e]=p;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",e).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,c,"on")};var yl=20,bl=1,wl=1/0;fo.layout.hierarchy=function(){function t(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(c=n.call(t,a,a.depth))&&(l=c.length)){for(var l,c,d;--l>=0;)o.push(d=c[l]),d.parent=a,d.depth=a.depth+1;i&&(a.value=0),a.children=c}else i&&(a.value=+i.call(t,a,a.depth)||0),delete a.children;return ur(r,function(t){var n,r;e&&(n=t.children)&&n.sort(e),i&&(r=t.parent)&&(r.value+=t.value)}),s}var e=pr,n=hr,i=fr;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(i=e,t):i},t.revalue=function(e){return i&&(dr(e,function(t){t.children&&(t.value=0)}),ur(e,function(e){var n;e.children||(e.value=+i.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},fo.layout.partition=function(){function t(e,n,i,r){var a=e.children;if(e.x=n,e.y=e.depth*r,e.dx=i,e.dy=r,a&&(o=a.length)){var o,s,l,c=-1;for(i=e.value?i/e.value:0;++c<o;)t(s=a[c],n,l=s.value*i,r),n+=l}}function e(t){var n=t.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,e(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return t(o[0],0,r[0],r[1]/e(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(t){return arguments.length?(r=t,n):r},cr(n,i)},fo.layout.pie=function(){function t(o){var s,l=o.length,c=o.map(function(n,i){return+e.call(t,n,i)}),d=+("function"==typeof i?i.apply(this,arguments):i),u=("function"==typeof r?r.apply(this,arguments):r)-d,h=Math.min(Math.abs(u)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=h*(u<0?-1:1),p=fo.sum(c),_=p?(u-l*f)/p:0,g=fo.range(l),m=[];return null!=n&&g.sort(n===xl?function(t,e){return c[e]-c[t]}:function(t,e){return n(o[t],o[e])}),g.forEach(function(t){m[t]={data:o[t],value:s=c[t],startAngle:d,endAngle:d+=s*_+f,padAngle:h}}),m}var e=Number,n=xl,i=0,r=Ho,a=0;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(r=e,t):r},t.padAngle=function(e){return arguments.length?(a=e,t):a},t};var xl={};fo.layout.stack=function(){function t(s,l){if(!(h=s.length))return s;var c=s.map(function(n,i){return e.call(t,n,i)}),d=c.map(function(e){return e.map(function(e,n){return[a.call(t,e,n),o.call(t,e,n)]})}),u=n.call(t,d,l);c=fo.permute(c,u),d=fo.permute(d,u);var h,f,p,_,g=i.call(t,d,l),m=c[0].length;for(p=0;p<m;++p)for(r.call(t,c[0][p],_=g[p],d[0][p][1]),f=1;f<h;++f)r.call(t,c[f][p],_+=d[f-1][p][1],d[f][p][1]);return s}var e=k,n=yr,i=br,r=vr,a=gr,o=mr;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:kl.get(e)||yr,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:Ml.get(e)||br,t):i},t.x=function(e){return arguments.length?(a=e,t):a},t.y=function(e){return arguments.length?(o=e,t):o},t.out=function(e){return arguments.length?(r=e,t):r},t};var kl=fo.map({"inside-out":function(t){var e,n,i=t.length,r=t.map(wr),a=t.map(xr),o=fo.range(i).sort(function(t,e){return r[t]-r[e]}),s=0,l=0,c=[],d=[];for(e=0;e<i;++e)n=o[e],s<l?(s+=a[n],c.push(n)):(l+=a[n],d.push(n));return d.reverse().concat(c)},reverse:function(t){return fo.range(t.length).reverse()},default:yr}),Ml=fo.map({silhouette:function(t){var e,n,i,r=t.length,a=t[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(t){var e,n,i,r,a,o,s,l,c,d=t.length,u=t[0],h=u.length,f=[];for(f[0]=l=c=0,n=1;n<h;++n){for(e=0,r=0;e<d;++e)r+=t[e][n][1];for(e=0,a=0,s=u[n][0]-u[n-1][0];e<d;++e){for(i=0,o=(t[e][n][1]-t[e][n-1][1])/(2*s);i<e;++i)o+=(t[i][n][1]-t[i][n-1][1])/s;a+=o*t[e][n][1]}f[n]=l-=r?a/r*s:0,l<c&&(c=l)}for(n=0;n<h;++n)f[n]-=c;return f},expand:function(t){var e,n,i,r=t.length,a=t[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];if(i)for(e=0;e<r;e++)t[e][n][1]/=i;else for(e=0;e<r;e++)t[e][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:br});fo.layout.histogram=function(){function t(t,a){for(var o,s,l=[],c=t.map(n,this),d=i.call(this,c,a),u=r.call(this,d,c,a),a=-1,h=c.length,f=u.length-1,p=e?1:1/h;++a<f;)o=l[a]=[],o.dx=u[a+1]-(o.x=u[a]),o.y=0;if(f>0)for(a=-1;++a<h;)(s=c[a])>=d[0]&&s<=d[1]&&(o=l[fo.bisect(u,s,1,f)-1],o.y+=p,o.push(t[a]));return l}var e=!0,n=Number,i=Sr,r=Mr;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=Ot(e),t):i},t.bins=function(e){return arguments.length?(r="number"==typeof e?function(t){return Cr(t,e)}:Ot(e),t):r},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},fo.layout.pack=function(){function t(t,a){var o=n.call(this,t,a),s=o[0],l=r[0],c=r[1],d=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,ur(s,function(t){t.r=+d(t.value)}),ur(s,Or),i){var u=i*(e?1:Math.max(2*s.r/l,2*s.r/c))/2;ur(s,function(t){t.r+=u}),ur(s,Or),ur(s,function(t){t.r-=u})}return Ir(s,l/2,c/2,e?1:1/Math.max(2*s.r/l,2*s.r/c)),o}var e,n=fo.layout.hierarchy().sort(Tr),i=0,r=[1,1];return t.size=function(e){return arguments.length?(r=e,t):r},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(i=+e,t):i},cr(t,n)},fo.layout.tree=function(){function t(t,r){var d=o.call(this,t,r),u=d[0],h=e(u);if(ur(h,n),h.parent.m=-h.z,dr(h,i),c)dr(u,a);else{var f=u,p=u,_=u;dr(u,function(t){t.x<f.x&&(f=t),t.x>p.x&&(p=t),t.depth>_.depth&&(_=t)});var g=s(f,p)/2-f.x,m=l[0]/(p.x+s(p,f)/2+g),v=l[1]/(_.depth||1);dr(u,function(t){t.x=(t.x+g)*m,t.y=t.depth*v})}return d}function e(t){for(var e,n={A:null,children:[t]},i=[n];null!=(e=i.pop());)for(var r,a=e.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:e,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(e.length){Wr(t);var a=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+s(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+s(t._,i._));t.parent.A=r(t,i,t.parent.A||n[0])}function i(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function r(t,e,n){if(e){for(var i,r=t,a=t,o=e,l=r.parent.children[0],c=r.m,d=a.m,u=o.m,h=l.m;o=zr(o),r=Rr(r),o&&r;)l=Rr(l),a=zr(a),a.a=t,i=o.z+u-r.z-c+s(o._,r._),i>0&&($r(Gr(o,t,n),t,i),c+=i,d+=i),u+=o.m,c+=r.m,h+=l.m,d+=a.m;o&&!zr(a)&&(a.t=o,a.m+=u-d),r&&!Rr(l)&&(l.t=r,l.m+=c-h,n=t)}return n}function a(t){t.x*=l[0],t.y=t.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=Dr,l=[1,1],c=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(c=null==(l=e)?a:null,t):c?null:l},t.nodeSize=function(e){return arguments.length?(c=null==(l=e)?null:a,t):c?l:null},cr(t,o)},fo.layout.cluster=function(){function t(t,a){var o,s=e.call(this,t,a),l=s[0],c=0;ur(l,function(t){var e=t.children;e&&e.length?(t.x=Hr(e),t.y=Vr(e)):(t.x=o?c+=n(t,o):0,t.y=0,o=t)});var d=Fr(l),u=Yr(l),h=d.x-n(d,u)/2,f=u.x+n(u,d)/2;return ur(l,r?function(t){t.x=(t.x-l.x)*i[0],t.y=(l.y-t.y)*i[1]}:function(t){t.x=(t.x-h)/(f-h)*i[0],t.y=(1-(l.y?t.y/l.y:1))*i[1]}),s}var e=fo.layout.hierarchy().sort(null).value(null),n=Dr,i=[1,1],r=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(r=null==(i=e),t):r?null:i},t.nodeSize=function(e){return arguments.length?(r=null!=(i=e),t):r?i:null},cr(t,e)},fo.layout.treemap=function(){function t(t,e){for(var n,i,r=-1,a=t.length;++r<a;)i=(n=t[r]).value*(e<0?0:e),n.area=isNaN(i)||i<=0?0:i}function e(n){var a=n.children;if(a&&a.length){var o,s,l,c=u(n),d=[],h=a.slice(),p=1/0,_="slice"===f?c.dx:"dice"===f?c.dy:"slice-dice"===f?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(t(h,c.dx*c.dy/n.value),d.area=0;(l=h.length)>0;)d.push(o=h[l-1]),d.area+=o.area,"squarify"!==f||(s=i(d,_))<=p?(h.pop(),p=s):(d.area-=d.pop().area,r(d,_,c,!1),_=Math.min(c.dx,c.dy),d.length=d.area=0,p=1/0);d.length&&(r(d,_,c,!0),d.length=d.area=0),a.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var a,o=u(e),s=i.slice(),l=[];for(t(s,o.dx*o.dy/e.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,r=0,a=1/0,o=-1,s=t.length;++o<s;)(n=t[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,e*=e,i?Math.max(e*r*p/i,i/(e*a*p)):1/0}function r(t,e,n,i){var r,a=-1,o=t.length,s=n.x,c=n.y,d=e?l(t.area/e):0;if(e==n.dx){for((i||d>n.dy)&&(d=n.dy);++a<o;)r=t[a],r.x=s,r.y=c,r.dy=d,s+=r.dx=Math.min(n.x+n.dx-s,d?l(r.area/d):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=d,n.dy-=d}else{for((i||d>n.dx)&&(d=n.dx);++a<o;)r=t[a],r.x=s,r.y=c,r.dx=d,c+=r.dy=Math.min(n.y+n.dy-c,d?l(r.area/d):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=d,n.dx-=d}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=c[0],a.dy=c[1]):a.dx=a.dy=0,o&&s.revalue(a),t([a],a.dx*a.dy/a.value),(o?n:e)(a),h&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,c=[1,1],d=null,u=qr,h=!1,f="squarify",p=.5*(1+Math.sqrt(5));return a.size=function(t){return arguments.length?(c=t,a):c},a.padding=function(t){function e(e){var n=t.call(a,e,e.depth);return null==n?qr(e):Ur(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Ur(e,t)}if(!arguments.length)return d;var i;return u=null==(d=t)?qr:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,a},a.round=function(t){return arguments.length?(l=t?Math.round:Number,a):l!=Number},a.sticky=function(t){return arguments.length?(h=t,o=null,a):h},a.ratio=function(t){return arguments.length?(p=t,a):p},a.mode=function(t){return arguments.length?(f=t+"",a):f},cr(a,s)},fo.random={normal:function(t,e){var n=arguments.length;return n<2&&(e=1),n<1&&(t=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return t+e*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var t=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=fo.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;n<t;n++)e+=Math.random();return e}}},fo.scale={};var Cl={floor:k,ceil:k};fo.scale.linear=function(){return ta([0,1],[0,1],Mi,!1)};var Sl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Tl=fo.format(".0e"),Al={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};fo.scale.pow=function(){return ca(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ua([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(jl)},fo.scale.category20=function(){return fo.scale.ordinal().range(El)},fo.scale.category20b=function(){return fo.scale.ordinal().range(Ol)},fo.scale.category20c=function(){return fo.scale.ordinal().range(Ll)};var jl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Mt),El=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Mt),Ol=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Mt),Ll=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Mt);fo.scale.quantile=function(){return ha([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return pa([.5],[0,1])},fo.scale.identity=function(){return _a([0,1])},fo.svg={},fo.svg.arc=function(){function t(){var t=Math.max(0,+n.apply(this,arguments)),c=Math.max(0,+i.apply(this,arguments)),d=o.apply(this,arguments)-Yo,u=s.apply(this,arguments)-Yo,h=Math.abs(u-d),f=d>u?0:1;if(c<t&&(p=c,c=t,t=p),h>=Fo)return e(c,f)+(t?e(t,1-f):"")+"Z";var p,_,g,m,v,y,b,w,x,k,M,C,S=0,T=0,A=[];if((m=(+l.apply(this,arguments)||0)/2)&&(g=a===Nl?Math.sqrt(t*t+c*c):+a.apply(this,arguments),f||(T*=-1),c&&(T=ot(g/c*Math.sin(m))),t&&(S=ot(g/t*Math.sin(m)))),c){v=c*Math.cos(d+T),y=c*Math.sin(d+T),b=c*Math.cos(u-T),w=c*Math.sin(u-T);var j=Math.abs(u-d-2*T)<=Vo?0:1;if(T&&xa(v,y,b,w)===f^j){var E=(d+u)/2;v=c*Math.cos(E),y=c*Math.sin(E),b=w=null}}else v=y=0;if(t){x=t*Math.cos(u-S),k=t*Math.sin(u-S),M=t*Math.cos(d+S),C=t*Math.sin(d+S);var O=Math.abs(d-u+2*S)<=Vo?0:1;if(S&&xa(x,k,M,C)===1-f^O){var L=(d+u)/2;x=t*Math.cos(L),k=t*Math.sin(L),M=C=null}}else x=k=0;if(h>Wo&&(p=Math.min(Math.abs(c-t)/2,+r.apply(this,arguments)))>.001){_=t<c^f?0:1;var N=p,I=p;if(h<Vo){var P=null==M?[x,k]:null==b?[v,y]:$n([v,y],[M,C],[b,w],[x,k]),D=v-P[0],R=y-P[1],z=b-P[0],$=w-P[1],W=1/Math.sin(Math.acos((D*z+R*$)/(Math.sqrt(D*D+R*R)*Math.sqrt(z*z+$*$)))/2),G=Math.sqrt(P[0]*P[0]+P[1]*P[1]);I=Math.min(p,(t-G)/(W-1)),N=Math.min(p,(c-G)/(W+1))}if(null!=b){var V=ka(null==M?[x,k]:[M,C],[v,y],c,N,f),H=ka([b,w],[x,k],c,N,f);p===N?A.push("M",V[0],"A",N,",",N," 0 0,",_," ",V[1],"A",c,",",c," 0 ",1-f^xa(V[1][0],V[1][1],H[1][0],H[1][1]),",",f," ",H[1],"A",N,",",N," 0 0,",_," ",H[0]):A.push("M",V[0],"A",N,",",N," 0 1,",_," ",H[0])}else A.push("M",v,",",y);if(null!=M){var F=ka([v,y],[M,C],t,-I,f),Y=ka([x,k],null==b?[v,y]:[b,w],t,-I,f);p===I?A.push("L",Y[0],"A",I,",",I," 0 0,",_," ",Y[1],"A",t,",",t," 0 ",f^xa(Y[1][0],Y[1][1],F[1][0],F[1][1]),",",1-f," ",F[1],"A",I,",",I," 0 0,",_," ",F[0]):A.push("L",Y[0],"A",I,",",I," 0 0,",_," ",F[0])}else A.push("L",x,",",k)}else A.push("M",v,",",y),null!=b&&A.push("A",c,",",c," 0 ",j,",",f," ",b,",",w),A.push("L",x,",",k),null!=M&&A.push("A",t,",",t," 0 ",O,",",1-f," ",M,",",C);return A.push("Z"),A.join("")}function e(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}var n=ma,i=va,r=ga,a=Nl,o=ya,s=ba,l=wa;return t.innerRadius=function(e){return arguments.length?(n=Ot(e),t):n},t.outerRadius=function(e){return arguments.length?(i=Ot(e),t):i},t.cornerRadius=function(e){return arguments.length?(r=Ot(e),t):r},t.padRadius=function(e){return arguments.length?(a=e==Nl?Nl:Ot(e),t):a},t.startAngle=function(e){return arguments.length?(o=Ot(e),t):o},t.endAngle=function(e){return arguments.length?(s=Ot(e),t):s},t.padAngle=function(e){return arguments.length?(l=Ot(e),t):l},t.centroid=function(){var t=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,e=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Yo;return[Math.cos(e)*t,Math.sin(e)*t]},t};var Nl="auto";fo.svg.line=function(){return Ma(k)};var Il=fo.map({linear:Ca,"linear-closed":Sa,step:Ta,"step-before":Aa,"step-after":ja,basis:Pa,"basis-open":Da,"basis-closed":Ra,bundle:za,cardinal:La,"cardinal-open":Ea,"cardinal-closed":Oa,monotone:Fa});Il.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Pl=[0,2/3,1/3,0],Dl=[0,1/3,2/3,0],Rl=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var t=Ma(Ya);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},Aa.reverse=ja,ja.reverse=Aa,fo.svg.area=function(){return qa(k)},fo.svg.area.radial=function(){var t=qa(Ya);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},fo.svg.chord=function(){function t(t,s){var l=e(this,a,t,s),c=e(this,o,t,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var r=e.call(t,n,i),a=s.call(t,r,i),o=l.call(t,r,i)-Yo,d=c.call(t,r,i)-Yo;return{r:a,a0:o,a1:d,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(d),a*Math.sin(d)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Vo)+",1 "+e}function r(t,e,n,i){return"Q 0,0 "+i}var a=Mn,o=Cn,s=Ua,l=ya,c=ba;return t.radius=function(e){return arguments.length?(s=Ot(e),t):s},t.source=function(e){return arguments.length?(a=Ot(e),t):a},t.target=function(e){return arguments.length?(o=Ot(e),t):o},t.startAngle=function(e){return arguments.length?(l=Ot(e),t):l},t.endAngle=function(e){return arguments.length?(c=Ot(e),t):c},t},fo.svg.diagonal=function(){function t(t,r){var a=e.call(this,t,r),o=n.call(this,t,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=Mn,n=Cn,i=Ba;return t.source=function(n){return arguments.length?(e=Ot(n),t):e},t.target=function(e){return arguments.length?(n=Ot(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},fo.svg.diagonal.radial=function(){var t=fo.svg.diagonal(),e=Ba,n=t.projection;return t.projection=function(t){return arguments.length?n(Xa(e=t)):e},t},fo.svg.symbol=function(){function t(t,i){return(zl.get(e.call(this,t,i))||Ka)(n.call(this,t,i))}var e=Qa,n=Ja;return t.type=function(n){return arguments.length?(e=Ot(n),t):e},t.size=function(e){return arguments.length?(n=Ot(e),t):n},t};var zl=fo.map({circle:Ka,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Wl)),n=e*Wl;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/$l),n=e*$l/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/$l),n=e*$l/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});fo.svg.symbolTypes=zl.keys();var $l=Math.sqrt(3),Wl=Math.tan(30*qo);Lo.transition=function(t){for(var e,n,i=Gl||++Yl,r=io(t),a=[],o=Vl||{time:Date.now(),ease:Oi,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(e=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(n=c[d])&&ro(n,d,r,i,o),e.push(n)}return to(a,r,i)},Lo.interrupt=function(t){return this.each(null==t?Hl:Za(io(t)))};var Gl,Vl,Hl=Za(io()),Fl=[],Yl=0;Fl.call=Lo.call,Fl.empty=Lo.empty,Fl.node=Lo.node,Fl.size=Lo.size,fo.transition=function(t,e){return t&&t.transition?Gl?t.transition(e):t:fo.selection().transition(t)},fo.transition.prototype=Fl,Fl.select=function(t){var e,n,i,r=this.id,a=this.namespace,o=[];t=N(t);for(var s=-1,l=this.length;++s<l;){o.push(e=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(i=c[d])&&(n=t.call(i,i.__data__,d,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,d,a,r,i[a][r]),e.push(n)):e.push(null)}return to(o,a,r)},Fl.selectAll=function(t){var e,n,i,r,a,o=this.id,s=this.namespace,l=[];t=I(t);for(var c=-1,d=this.length;++c<d;)for(var u=this[c],h=-1,f=u.length;++h<f;)if(i=u[h]){a=i[s][o],n=t.call(i,i.__data__,h,c),l.push(e=[]);for(var p=-1,_=n.length;++p<_;)(r=n[p])&&ro(r,p,s,o,a),e.push(r)}return to(l,s,o)},Fl.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=q(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return to(r,this.namespace,this.id)},Fl.tween=function(t,e){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(t):B(this,null==e?function(e){e[i][n].tween.remove(t)}:function(r){r[i][n].tween.set(t,e)})},Fl.attr=function(t,e){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=o(n,t),function(t){this.setAttribute(s,e(t))})})}function a(t){return null==t?i:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=o(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var o="transform"==t?Ki:Mi,s=fo.ns.qualify(t);return eo(this,"attr."+t,e,s.local?a:r)},Fl.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(r));return i&&function(t){this.setAttribute(r,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(r.space,r.local));return i&&function(t){this.setAttributeNS(r.space,r.local,i(t))}}var r=fo.ns.qualify(t);return this.tween("attr."+t,r.local?i:n)},Fl.style=function(t,e,n){function i(){this.style.removeProperty(t)}function r(e){return null==e?i:(e+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(t);return r!==e&&(i=Mi(r,e),function(e){this.style.setProperty(t,i(e),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof t){a<2&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return eo(this,"style."+t,e,r)},Fl.styleTween=function(t,e,n){function i(i,r){var a=e.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(t));return a&&function(e){this.style.setProperty(t,a(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,i)},Fl.text=function(t){return eo(this,"text",t,no)},Fl.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},Fl.ease=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].ease:("function"!=typeof t&&(t=fo.ease.apply(fo,arguments)),B(this,function(i){i[n][e].ease=t}))},Fl.delay=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].delay:B(this,"function"==typeof t?function(i,r,a){i[n][e].delay=+t.call(i,i.__data__,r,a)}:(t=+t,function(i){i[n][e].delay=t}))},Fl.duration=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].duration:B(this,"function"==typeof t?function(i,r,a){i[n][e].duration=Math.max(1,t.call(i,i.__data__,r,a))}:(t=Math.max(1,t),function(i){i[n][e].duration=t}))},Fl.each=function(t,e){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Vl,a=Gl;try{Gl=n,B(this,function(e,r,a){Vl=e[i][n],t.call(e,e.__data__,r,a)})}finally{Vl=r,Gl=a}}else B(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(t,e)});return this},Fl.transition=function(){for(var t,e,n,i,r=this.id,a=++Yl,o=this.namespace,s=[],l=0,c=this.length;l<c;l++){s.push(t=[]);for(var e=this[l],d=0,u=e.length;d<u;d++)(n=e[d])&&(i=n[o][r],ro(n,d,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),t.push(n)}return to(s,o,a)},fo.svg.axis=function(){function t(t){t.each(function(){var t,c=fo.select(this),d=this.__chart__||n,u=this.__chart__=n.copy(),h=null==l?u.ticks?u.ticks.apply(u,s):u.domain():l,f=null==e?u.tickFormat?u.tickFormat.apply(u,s):k:e,p=c.selectAll(".tick").data(h,u),_=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Wo),g=fo.transition(p.exit()).style("opacity",Wo).remove(),m=fo.transition(p.order()).style("opacity",1),v=Math.max(r,0)+o,y=Xr(u),b=c.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),fo.transition(b));_.append("line"),_.append("text");var x,M,C,S,T=_.select("line"),A=m.select("line"),j=p.select("text").text(f),E=_.select("text"),O=m.select("text"),L="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(t=ao,x="x",C="y",M="x2",S="y2",j.attr("dy",L<0?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+L*a+"V0H"+y[1]+"V"+L*a)):(t=oo,x="y",C="x",M="y2",S="x2",j.attr("dy",".32em").style("text-anchor",L<0?"end":"start"),w.attr("d","M"+L*a+","+y[0]+"H0V"+y[1]+"H"+L*a)),T.attr(S,L*r),E.attr(C,L*v),A.attr(M,0).attr(S,L*r),O.attr(x,0).attr(C,L*v),u.rangeBand){var N=u,I=N.rangeBand()/2;d=u=function(t){return N(t)+I}}else d.rangeBand?d=u:g.call(t,u,d);_.call(t,d,u),m.call(t,u,u)})}var e,n=fo.scale.linear(),i=ql,r=6,a=6,o=3,s=[10],l=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e in Ul?e+"":ql,t):i},t.ticks=function(){return arguments.length?(s=_o(arguments),t):s},t.tickValues=function(e){return arguments.length?(l=e,t):l},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(r=+e,a=+arguments[n-1],t):r},t.innerTickSize=function(e){return arguments.length?(r=+e,t):r},t.outerTickSize=function(e){return arguments.length?(a=+e,t):a},t.tickPadding=function(e){return arguments.length?(o=+e,t):o},t.tickSubdivide=function(){return arguments.length&&t},t};var ql="bottom",Ul={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function t(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(_,k);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Bl[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var l,u=fo.transition(a),h=fo.transition(o);c&&(l=Xr(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(u)),d&&(l=Xr(d),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(u)),e(u)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+u[+/e$/.test(t)]+","+h[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",u[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1]-u[0])}function i(t){t.select(".extent").attr("y",h[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function r(){function r(){32==fo.event.keyCode&&(A||(y=null,O[0]-=u[1],O[1]-=h[1],A=2),j())}function _(){32==fo.event.keyCode&&2==A&&(O[0]+=u[1],O[1]+=h[1],A=0,j())}function g(){var t=fo.mouse(w),r=!1;b&&(t[0]+=b[0],t[1]+=b[1]),A||(fo.event.altKey?(y||(y=[(u[0]+u[1])/2,(h[0]+h[1])/2]),O[0]=u[+(t[0]<y[0])],O[1]=h[+(t[1]<y[1])]):y=null),S&&m(t,c,0)&&(n(M),r=!0),T&&m(t,d,1)&&(i(M),r=!0),r&&(e(M),k({type:"brush",mode:A?"move":"resize"}))}function m(t,e,n){var i,r,o=Xr(e),l=o[0],c=o[1],d=O[n],_=n?h:u,g=_[1]-_[0];if(A&&(l-=d,c-=g+d),i=(n?p:f)?Math.max(l,Math.min(c,t[n])):t[n],A?r=(i+=d)+g:(y&&(d=Math.max(l,Math.min(c,2*y[n]-i))),d<i?(r=i,i=d):r=d),_[0]!=i||_[1]!=r)return n?s=null:a=null,_[0]=i,_[1]=r,!0}function v(){g(),M.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),fo.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),E(),k({type:"brushend"})}var y,b,w=this,x=fo.select(fo.event.target),k=l.of(w,arguments),M=fo.select(w),C=x.datum(),S=!/^(n|s)$/.test(C)&&c,T=!/^(e|w)$/.test(C)&&d,A=x.classed("extent"),E=tt(w),O=fo.mouse(w),L=fo.select(o(w)).on("keydown.brush",r).on("keyup.brush",_);if(fo.event.changedTouches?L.on("touchmove.brush",g).on("touchend.brush",v):L.on("mousemove.brush",g).on("mouseup.brush",v),M.interrupt().selectAll("*").interrupt(),A)O[0]=u[0]-O[0],O[1]=h[0]-O[1];else if(C){var N=+/w$/.test(C),I=+/^n/.test(C);b=[u[1-N]-O[0],h[1-I]-O[1]],O[0]=u[N],O[1]=h[I]}else fo.event.altKey&&(y=O.slice());M.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),g()}var a,s,l=O(t,"brushstart","brush","brushend"),c=null,d=null,u=[0,0],h=[0,0],f=!0,p=!0,_=Xl[0];return t.event=function(t){t.each(function(){var t=l.of(this,arguments),e={x:u,y:h,i:a,j:s},n=this.__chart__||e;this.__chart__=e,Gl?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,u=n.x,h=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=Ci(u,e.x),i=Ci(h,e.y);return a=s=null,function(r){u=e.x=n(r),h=e.y=i(r),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=e.i,s=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(c=e,_=Xl[!c<<1|!d],t):c},t.y=function(e){return arguments.length?(d=e,_=Xl[!c<<1|!d],t):d},t.clamp=function(e){return arguments.length?(c&&d?(f=!!e[0],p=!!e[1]):c?f=!!e:d&&(p=!!e),t):c&&d?[f,p]:c?f:d?p:null},t.extent=function(e){var n,i,r,o,l;return arguments.length?(c&&(n=e[0],i=e[1],d&&(n=n[0],i=i[0]),a=[n,i],c.invert&&(n=c(n),i=c(i)),i<n&&(l=n,n=i,i=l),n==u[0]&&i==u[1]||(u=[n,i])),d&&(r=e[0],o=e[1],c&&(r=r[1],o=o[1]),s=[r,o],d.invert&&(r=d(r),o=d(o)),o<r&&(l=r,r=o,o=l),r==h[0]&&o==h[1]||(h=[r,o])),t):(c&&(a?(n=a[0],i=a[1]):(n=u[0],i=u[1],c.invert&&(n=c.invert(n),i=c.invert(i)),i<n&&(l=n,n=i,i=l))),d&&(s?(r=s[0],o=s[1]):(r=h[0],o=h[1],d.invert&&(r=d.invert(r),o=d.invert(o)),o<r&&(l=r,r=o,o=l))),c&&d?[[n,r],[i,o]]:c?[n,i]:d&&[r,o])},t.clear=function(){return t.empty()||(u=[0,0],h=[0,0],a=s=null),t},t.empty=function(){return!!c&&u[0]==u[1]||!!d&&h[0]==h[1]},fo.rebind(t,l,"on")};var Bl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Xl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Jl=_s.format=ws.timeFormat,Ql=Jl.utc,Kl=Ql("%Y-%m-%dT%H:%M:%S.%LZ");Jl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Kl,so.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},so.toString=Kl.toString,_s.second=Yt(function(t){return new gs(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),_s.seconds=_s.second.range,_s.seconds.utc=_s.second.utc.range,_s.minute=Yt(function(t){return new gs(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),_s.minutes=_s.minute.range,_s.minutes.utc=_s.minute.utc.range,_s.hour=Yt(function(t){var e=t.getTimezoneOffset()/60;return new gs(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),_s.hours=_s.hour.range,_s.hours.utc=_s.hour.utc.range,_s.month=Yt(function(t){return t=_s.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),_s.months=_s.month.range,_s.months.utc=_s.month.utc.range;var Zl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],tc=[[_s.second,1],[_s.second,5],[_s.second,15],[_s.second,30],[_s.minute,1],[_s.minute,5],[_s.minute,15],[_s.minute,30],[_s.hour,1],[_s.hour,3],[_s.hour,6],[_s.hour,12],[_s.day,1],[_s.day,2],[_s.week,1],[_s.month,1],[_s.month,3],[_s.year,1]],ec=Jl.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Ie]]),nc={range:function(t,e,n){return fo.range(Math.ceil(t/n)*n,+e,n).map(co)},floor:k,ceil:k};tc.year=_s.year,_s.scale=function(){return lo(fo.scale.linear(),tc,ec)};var ic=tc.map(function(t){return[t[0].utc,t[1]]}),rc=Ql.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Ie]]);ic.year=_s.year.utc,_s.scale.utc=function(){return lo(fo.scale.linear(),ic,rc)},fo.text=Lt(function(t){return t.responseText}),fo.json=function(t,e){return Nt(t,"application/json",uo,e)},fo.html=function(t,e){return Nt(t,"text/html",ho,e)},fo.xml=Lt(function(t){return t.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(e,n,e,t):i)&&(t.exports=r)}()},,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={tool:"fa-wrench",data_input:"fa-file-o",data_collection_input:"fa-folder-o",subworkflow:"fa-sitemap fa-rotate-270",pause:"fa-pause"}},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=r.default.SessionStorageModel.extend({defaults:{expandedIds:{},show_deleted:!1,show_hidden:!1},addExpanded:function(t){var e=this.get("expandedIds");e[t.id]=t.get("id"),this.save("expandedIds",e)},removeExpanded:function(t){var e=this.get("expandedIds");delete e[t.id],this.save("expandedIds",e)},isExpanded:function(e){return t.result(this.get("expandedIds"),e,!1)},allExpanded:function(){return t.values(this.get("expandedIds"))},clearExpanded:function(){this.set("expandedIds",{})},includeDeleted:function(e){return t.isUndefined(e)||this.set("show_deleted",e),this.get("show_deleted")},includeHidden:function(e){return t.isUndefined(e)||this.set("show_hidden",e),this.get("show_hidden")},toString:function(){return"HistoryPrefs("+this.id+")"}},{storageKeyPrefix:"history:",historyStorageKey:function(t){if(!t)throw new Error("HistoryPrefs.historyStorageKey needs valid id: "+t);return a.storageKeyPrefix+t},get:function(t){return new a({id:a.historyStorageKey(t)})},clearAll:function(t){for(var e in sessionStorage)0===e.indexOf(a.storageKeyPrefix)&&sessionStorage.removeItem(e)}});e.default={HistoryPrefs:a}}).call(e,n(1))},function(t,e,n){"use strict";function i(t,e){return this.currModeIndex=0,this._init(t,e)}var r=n(0),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=a.default;i.prototype.DATA_KEY="mode-button",i.prototype.defaults={switchModesOnClick:!0},i.prototype._init=function(t,e){if(e=e||{},this.$element=o(t),this.options=o.extend(!0,{},this.defaults,e),!e.modes)throw new Error('ModeButton requires a "modes" array');var n=this;return this.$element.click(function(t){n.callModeFn(),n.options.switchModesOnClick&&n._incModeIndex(),o(this).html(n.options.modes[n.currModeIndex].html)}),this.reset()},i.prototype._incModeIndex=function(){return this.currModeIndex+=1,this.currModeIndex>=this.options.modes.length&&(this.currModeIndex=0),this},i.prototype._getModeIndex=function(t){for(var e=0;e<this.options.modes.length;e+=1)if(this.options.modes[e].mode===t)return e;throw new Error("mode not found: "+t)},i.prototype._setModeByIndex=function(t){var e=this.options.modes[t];if(!e)throw new Error("mode index not found: "+t);return this.currModeIndex=t,e.html&&this.$element.html(e.html),this},i.prototype.currentMode=function(){return this.options.modes[this.currModeIndex]},i.prototype.current=function(){return this.currentMode().mode},i.prototype.getMode=function(t){return t?this.options.modes[this._getModeIndex(t)]:this.currentMode()},i.prototype.hasMode=function(t){try{return!!this.getMode(t)}catch(t){}return!1},i.prototype.setMode=function(t){return this._setModeByIndex(this._getModeIndex(t))},i.prototype.reset=function(){return this.currModeIndex=0,this.options.initialMode&&(this.currModeIndex=this._getModeIndex(this.options.initialMode)),this._setModeByIndex(this.currModeIndex)},i.prototype.callModeFn=function(t){var e=this.getMode(t).onclick;if(e&&o.type("function"===e))return e.call(this.$element.get(0))},o.fn.modeButton=function(t){if(!this.length)return this;if("object"===o.type(t))return this.map(function(){var e=o(this);return e.data("mode-button",new i(e,t)),this});var e=o(this[0]),n=e.data("mode-button");if(!n)throw new Error("modeButton needs an options object or string name of a function");if(n&&"string"===o.type(t)){var r=t;if(n&&"function"===o.type(n[r]))return n[r].apply(n,o.makeArray(arguments).slice(1))}return n}},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(r),o=n(161),s=i(o),l=n(220),c=i(l),d=n(3),u=i(d),h=s.default.HDCAListItemView,f=h.extend({initialize:function(t){h.prototype.initialize.call(this,t),this.purgeAllowed=t.purgeAllowed||!1},_getFoldoutPanelClass:function(){return c.default.CollectionViewEdit},_renderPrimaryActions:function(){return this.log(this+"._renderPrimaryActions"),h.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()])},_renderDeleteButton:function(){return t('\n                <div class="dropdown">\n                    <a class="delete-btn icon-btn" title="'+(0,u.default)("Delete")+'" data-toggle="dropdown">\n                        <span class="fa fa-times"></span>\n                    </a>\n                    <div class="dropdown-menu" role="menu">\n                            <a href="#" class="dropdown-item" delete-collection">\n                                '+(0,u.default)("Collection Only")+'\n                            </a>\n                            <a href="#" class="dropdown-item delete-collection-and-datasets">\n                                '+(0,u.default)("Delete Datasets")+'\n                            </a>\n                            <a href="#" style="display: '+(this.purgeAllowed?"inherit":"none")+'" class="dropdown-item delete-collection-and-purge-datasets">\n                                '+(0,u.default)("Permanently Delete Datasets")+"\n                            </a>\n                    </div>\n                </div>")},events:a.extend(a.clone(h.prototype.events),{"click .delete-collection":function(t){this.model.delete()},"click .delete-collection-and-datasets":function(t){this.model.delete(!0)},"click .delete-collection-and-purge-datasets":function(t){this.model.delete(!0,!0)}}),toString:function(){return"HDCAListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});e.default={HDCAListItemEdit:f}}).call(e,n(0))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(178),a=i(r),o=n(170),s=(i(o),n(221)),l=i(s),c=n(6),d=(i(c),n(68)),u=i(d),h=n(52),f=(i(h),n(3)),p=i(f);n(19);var _=a.default.CollectionView,g=_.extend({DatasetDCEViewClass:l.default.DatasetDCEListItemEdit,NestedDCDCEViewClass:l.default.NestedDCDCEListItemEdit,getNestedDCDCEViewClass:function(){return l.default.NestedDCDCEListItemEdit.extend({foldoutPanelClass:g})},initialize:function(t){_.prototype.initialize.call(this,t)},_setUpBehaviors:function(t){if(t=t||this.$el,_.prototype._setUpBehaviors.call(this,t),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()){this.tagsEditorShown=!0;var e=this;t.find("> .controls .name").attr("title",(0,p.default)("Click to rename collection")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(t){var n=e.model.get("name");t&&t!==n?(e.$el.find("> .controls .name").text(t),e.model.save({name:t}).fail(function(){e.$el.find("> .controls .name").text(e.model.previous("name"))})):e.$el.find("> .controls .name").text(n)}}),this.tagsEditor=new u.default.TagsEditor({model:this.model,el:t.find(".tags-display"),onshowFirstTime:function(){this.render()},usePrompt:!1}),this.tagsEditor.toggle(!0)}},toString:function(){return"CollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}});e.default={CollectionViewEdit:g}},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(146),o=r(a),s=n(180),l=r(s),c=n(6),d=(r(c),n(3)),u=(r(d),o.default.DCListItemView),h=u.extend({initialize:function(t){u.prototype.initialize.call(this,t)},toString:function(){return"DCListItemEdit("+(this.model?""+this.model:"(no model)")+")"}}),f=o.default.DCEListItemView,p=f.extend({initialize:function(t){f.prototype.initialize.call(this,t)},toString:function(){return"DCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}}),_=l.default.DatasetListItemEdit.extend({initialize:function(t){l.default.DatasetListItemEdit.prototype.initialize.call(this,t)},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):t.when()},_renderDeleteButton:function(){return null},toString:function(){return"DatasetDCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});_.prototype.templates=function(){return i.extend({},l.default.DatasetListItemEdit.prototype.templates,{titleBar:o.default.DatasetDCEListItemView.prototype.templates.titleBar})}();var g=o.default.NestedDCDCEListItemView.extend({toString:function(){return"NestedDCDCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});e.default={DCListItemEdit:h,DCEListItemEdit:p,DatasetDCEListItemEdit:_,NestedDCDCEListItemEdit:g}}).call(e,n(0),n(1))},function(t,e,n){"use strict";function i(t,e){if(0===t.length)return e.length;if(0===e.length)return t.length;var n,i=[];for(n=0;n<=e.length;n++)i[n]=[n];var r;for(r=0;r<=t.length;r++)i[0][r]=r;for(n=1;n<=e.length;n++)for(r=1;r<=t.length;r++)e.charAt(n-1)===t.charAt(r-1)?i[n][r]=i[n-1][r-1]:i[n][r]=Math.min(i[n-1][r-1]+1,Math.min(i[n][r-1]+1,i[n-1][r]+1));return i[e.length][t.length]}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},,function(t,e,n){var i,r;!function(){function a(t){return t&&(t.ownerDocument||t.document||t).documentElement}function o(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}function s(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function l(t){return null===t?NaN:+t}function c(t){return!isNaN(t)}function d(t){return{left:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)<0?i=a+1:r=a}return i},right:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)>0?r=a:i=a+1}return i}}}function u(t){return t.length}function h(t){for(var e=1;t*e%1;)e*=10;return e}function f(t,e){for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}function p(){this._=Object.create(null)}function _(t){return(t+="")===Mo||t[0]===Co?Co+t:t}function g(t){return(t+="")[0]===Co?t.slice(1):t}function m(t){return _(t)in this._}function v(t){return(t=_(t))in this._&&delete this._[t]}function y(){var t=[];for(var e in this._)t.push(g(e));return t}function b(){var t=0;for(var e in this._)++t;return t}function w(){for(var t in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(t){return t}function M(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}function C(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var n=0,i=So.length;n<i;++n){var r=So[n]+e;if(r in t)return r}}function S(){}function T(){}function A(t){function e(){for(var e,i=n,r=-1,a=i.length;++r<a;)(e=i[r].on)&&e.apply(this,arguments);return t}var n=[],i=new p;return e.on=function(e,r){var a,o=i.get(e);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(e)),r&&n.push(i.set(e,{on:r})),t)},e}function j(){fo.event.preventDefault()}function E(){for(var t,e=fo.event;t=e.sourceEvent;)e=t;return e}function O(t){for(var e=new T,n=0,i=arguments.length;++n<i;)e[arguments[n]]=A(e);return e.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=t,fo.event=r,e[r.type].apply(n,i)}finally{fo.event=a}}},e}function L(t){return Ao(t,Lo),t}function N(t){return"function"==typeof t?t:function(){return jo(t,this)}}function I(t){return"function"==typeof t?t:function(){return Eo(t,this)}}function P(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function r(){this.setAttribute(t,e)}function a(){this.setAttributeNS(t.space,t.local,e)}function o(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=fo.ns.qualify(t),null==e?t.local?i:n:"function"==typeof e?t.local?s:o:t.local?a:r}function D(t){return t.trim().replace(/\s+/g," ")}function R(t){return new RegExp("(?:^|\\s+)"+fo.requote(t)+"(?:\\s+|$)","g")}function z(t){return(t+"").trim().split(/^|\s+/)}function $(t,e){function n(){for(var n=-1;++n<r;)t[n](this,e)}function i(){for(var n=-1,i=e.apply(this,arguments);++n<r;)t[n](this,i)}t=z(t).map(W);var r=t.length;return"function"==typeof e?i:n}function W(t){var e=R(t);return function(n,i){if(r=n.classList)return i?r.add(t):r.remove(t);var r=n.getAttribute("class")||"";i?(e.lastIndex=0,e.test(r)||n.setAttribute("class",D(r+" "+t))):n.setAttribute("class",D(r.replace(e," ")))}}function G(t,e,n){function i(){this.style.removeProperty(t)}function r(){this.style.setProperty(t,e,n)}function a(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return null==e?i:"function"==typeof e?a:r}function V(t,e){function n(){delete this[t]}function i(){this[t]=e}function r(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?r:i}function H(t){function e(){var e=this.ownerDocument,n=this.namespaceURI;return n===No&&e.documentElement.namespaceURI===No?e.createElement(t):e.createElementNS(n,t)}function n(){return this.ownerDocument.createElementNS(t.space,t.local)}return"function"==typeof t?t:(t=fo.ns.qualify(t)).local?n:e}function F(){var t=this.parentNode;t&&t.removeChild(this)}function Y(t){return{__data__:t}}function q(t){return function(){return Oo(this,t)}}function U(t){return arguments.length||(t=s),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function B(t,e){for(var n=0,i=t.length;n<i;n++)for(var r,a=t[n],o=0,s=a.length;o<s;o++)(r=a[o])&&e(r,o,n);return t}function X(t){return Ao(t,Po),t}function J(t){var e,n;return function(i,r,a){var o,s=t[a].update,l=s.length;for(a!=n&&(n=a,e=0),r>=e&&(e=r+1);!(o=s[e])&&++e<l;);return o}}function Q(t,e,n){function i(){var e=this[o];e&&(this.removeEventListener(t,e,e.$),delete this[o])}function r(){var r=l(e,_o(arguments));i.call(this),this.addEventListener(t,this[o]=r,r.$=n),r._=e}function a(){var e,n=new RegExp("^__on([^.]+)"+fo.requote(t)+"$");for(var i in this)if(e=i.match(n)){var r=this[i];this.removeEventListener(e[1],r,r.$),delete this[i]}}var o="__on"+t,s=t.indexOf("."),l=K;s>0&&(t=t.slice(0,s));var c=Do.get(t);return c&&(t=c,l=Z),s?e?r:i:e?S:a}function K(t,e){return function(n){var i=fo.event;fo.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{fo.event=i}}}function Z(t,e){var n=K(t,e);return function(t){var e=this,i=t.relatedTarget;i&&(i===e||8&i.compareDocumentPosition(e))||n.call(e,t)}}function tt(t){var e=".dragsuppress-"+ ++zo,n="click"+e,i=fo.select(o(t)).on("touchmove"+e,j).on("dragstart"+e,j).on("selectstart"+e,j);if(null==Ro&&(Ro=!("onselectstart"in t)&&C(t.style,"userSelect")),Ro){var r=a(t).style,s=r[Ro];r[Ro]="none"}return function(t){if(i.on(e,null),Ro&&(r[Ro]=s),t){var a=function(){i.on(n,null)};i.on(n,function(){j(),a()},!0),setTimeout(a,0)}}}function et(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if($o<0){var r=o(t);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();$o=!(a.f||a.e),n.remove()}}return $o?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}function nt(){return fo.event.changedTouches[0].identifier}function it(t){return t>0?1:t<0?-1:0}function rt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function at(t){return t>1?0:t<-1?Vo:Math.acos(t)}function ot(t){return t>1?Yo:t<-1?-Yo:Math.asin(t)}function st(t){return((t=Math.exp(t))-1/t)/2}function lt(t){return((t=Math.exp(t))+1/t)/2}function ct(t){return((t=Math.exp(2*t))-1)/(t+1)}function dt(t){return(t=Math.sin(t/2))*t}function ut(){}function ht(t,e,n){return this instanceof ht?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof ht?new ht(t.h,t.s,t.l):St(""+t,Tt,ht):new ht(t,e,n)}function ft(t,e,n){function i(t){return t>360?t-=360:t<0&&(t+=360),t<60?a+(o-a)*t/60:t<180?o:t<240?a+(o-a)*(240-t)/60:a}function r(t){return Math.round(255*i(t))}var a,o;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:e<0?0:e>1?1:e,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+e):n+e-n*e,a=2*n-o,new xt(r(t+120),r(t),r(t-120))}function pt(t,e,n){return this instanceof pt?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof pt?new pt(t.h,t.c,t.l):t instanceof gt?vt(t.l,t.a,t.b):vt((t=At((t=fo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new pt(t,e,n)}function _t(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new gt(n,Math.cos(t*=qo)*e,Math.sin(t)*e)}function gt(t,e,n){return this instanceof gt?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof gt?new gt(t.l,t.a,t.b):t instanceof pt?_t(t.h,t.c,t.l):At((t=xt(t)).r,t.g,t.b):new gt(t,e,n)}function mt(t,e,n){var i=(t+16)/116,r=i+e/500,a=i-n/200;return r=yt(r)*es,i=yt(i)*ns,a=yt(a)*is,new xt(wt(3.2404542*r-1.5371385*i-.4985314*a),wt(-.969266*r+1.8760108*i+.041556*a),wt(.0556434*r-.2040259*i+1.0572252*a))}function vt(t,e,n){return t>0?new pt(Math.atan2(n,e)*Uo,Math.sqrt(e*e+n*n),t):new pt(NaN,NaN,t)}function yt(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function bt(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function wt(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function xt(t,e,n){return this instanceof xt?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof xt?new xt(t.r,t.g,t.b):St(""+t,xt,ft):new xt(t,e,n)}function kt(t){return new xt(t>>16,t>>8&255,255&t)}function Mt(t){return kt(t)+""}function Ct(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function St(t,e,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(t=t.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(Et(r[0]),Et(r[1]),Et(r[2]))}return(a=os.get(t))?e(a.r,a.g,a.b):(null==t||"#"!==t.charAt(0)||isNaN(a=parseInt(t.slice(1),16))||(4===t.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===t.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),e(o,s,l))}function Tt(t,e,n){var i,r,a=Math.min(t/=255,e/=255,n/=255),o=Math.max(t,e,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=t==o?(e-n)/s+(e<n?6:0):e==o?(n-t)/s+2:(t-e)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new ht(i,r,l)}function At(t,e,n){t=jt(t),e=jt(e),n=jt(n);var i=bt((.4124564*t+.3575761*e+.1804375*n)/es),r=bt((.2126729*t+.7151522*e+.072175*n)/ns);return gt(116*r-16,500*(i-r),200*(r-bt((.0193339*t+.119192*e+.9503041*n)/is)))}function jt(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Et(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function Ot(t){return"function"==typeof t?t:function(){return t}}function Lt(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Nt(e,n,t,i)}}function Nt(t,e,n,i){function r(){var t,e=l.status;if(!e&&Pt(l)||e>=200&&e<300||304===e){try{t=n.call(a,l)}catch(t){return void o.error.call(a,t)}o.load.call(a,t)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,c=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(t){var e=fo.event;fo.event=t;try{o.progress.call(a,l)}finally{fo.event=e}},a.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",a)},a.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",a):e},a.responseType=function(t){return arguments.length?(c=t,a):c},a.response=function(t){return n=t,a},["get","post"].forEach(function(t){a[t]=function(){return a.send.apply(a,[t].concat(_o(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),l.setRequestHeader)for(var d in s)l.setRequestHeader(d,s[d]);return null!=e&&l.overrideMimeType&&l.overrideMimeType(e),null!=c&&(l.responseType=c),null!=r&&a.on("error",r).on("load",function(t){r(null,t)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(It(i))}function It(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Pt(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function Dt(t,e,n){var i=arguments.length;i<2&&(e=0),i<3&&(n=Date.now());var r=n+e,a={c:t,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,cs||(ds=clearTimeout(ds),cs=1,us(Rt)),a}function Rt(){var t=zt(),e=$t()-t;e>24?(isFinite(e)&&(clearTimeout(ds),ds=setTimeout(Rt,e)),cs=0):(cs=1,us(Rt))}function zt(){for(var t=Date.now(),e=ss;e;)t>=e.t&&e.c(t-e.t)&&(e.c=null),e=e.n;return t}function $t(){for(var t,e=ss,n=1/0;e;)e.c?(e.t<n&&(n=e.t),e=(t=e).n):e=t?t.n=e.n:ss=e.n;return ls=t,n}function Wt(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Gt(t,e){var n=Math.pow(10,3*ko(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Vt(t){var e=t.decimal,n=t.thousands,i=t.grouping,r=t.currency,a=i&&n?function(t,e){for(var r=t.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>e&&(s=Math.max(1,e-l)),a.push(t.substring(r-=s,r+s)),!((l+=s+1)>e));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(t){var n=fs.exec(t),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",c=n[5],d=+n[6],u=n[7],h=n[8],f=n[9],p=1,_="",g="",m=!1,v=!0;switch(h&&(h=+h.substring(1)),(c||"0"===i&&"="===o)&&(c=i="0",o="="),f){case"n":u=!0,f="g";break;case"%":p=100,g="%",f="f";break;case"p":p=100,g="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(_="0"+f.toLowerCase());case"c":v=!1;case"d":m=!0,h=0;break;case"s":p=-1,f="r"}"$"===l&&(_=r[0],g=r[1]),"r"!=f||h||(f="g"),null!=h&&("g"==f?h=Math.max(1,Math.min(21,h)):"e"!=f&&"f"!=f||(h=Math.max(0,Math.min(20,h)))),f=ps.get(f)||Ht;var y=c&&u;return function(t){var n=g;if(m&&t%1)return"";var r=t<0||0===t&&1/t<0?(t=-t,"-"):"-"===s?"":s;if(p<0){var l=fo.formatPrefix(t,h);t=l.scale(t),n=l.symbol+g}else t*=p;t=f(t,h);var b,w,x=t.lastIndexOf(".");if(x<0){var k=v?t.lastIndexOf("e"):-1;k<0?(b=t,w=""):(b=t.substring(0,k),w=t.substring(k))}else b=t.substring(0,x),w=e+t.substring(x+1);!c&&u&&(b=a(b,1/0));var M=_.length+b.length+w.length+(y?0:r.length),C=M<d?new Array(M=d-M+1).join(i):"";return y&&(b=a(C+b,C.length?d-w.length:1/0)),r+=_,t=b+w,("<"===o?r+t+C:">"===o?C+r+t:"^"===o?C.substring(0,M>>=1)+r+t+C.substring(M):r+(y?t:C+t))+n}}}function Ht(t){return t+""}function Ft(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Yt(t,e,n){function i(e){var n=t(e),i=a(n,1);return e-n<i-e?n:i}function r(n){return e(n=t(new gs(n-1)),1),n}function a(t,n){return e(t=new gs(+t),n),t}function o(t,i,a){var o=r(t),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),e(o,1);else for(;o<i;)s.push(new Date(+o)),e(o,1);return s}function s(t,e,n){try{gs=Ft;var i=new Ft;return i._=t,o(i,e,n)}finally{gs=Date}}t.floor=t,t.round=i,t.ceil=r,t.offset=a,t.range=o;var l=t.utc=qt(t);return l.floor=l,l.round=qt(i),l.ceil=qt(r),l.offset=qt(a),l.range=s,t}function qt(t){return function(e,n){try{gs=Ft;var i=new Ft;return i._=e,t(i,n)._}finally{gs=Date}}}function Ut(t){function e(t){function e(e){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(r=vs[n=t.charAt(++s)])&&(n=t.charAt(++s)),(a=A[n])&&(n=a(e,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(t.slice(l,s)),o.join("")}var i=t.length;return e.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,t,e,0)!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&gs!==Ft,a=new(r?Ft:gs);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},e.toString=function(){return t},e}function n(t,e,n,i){for(var r,a,o,s=0,l=e.length,c=n.length;s<l;){if(i>=c)return-1;if(37===(r=e.charCodeAt(s++))){if(o=e.charAt(s++),!(a=j[o in vs?e.charAt(s++):o])||(i=a(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(t,e,n){x.lastIndex=0;var i=x.exec(e.slice(n));return i?(t.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(t,e,n){b.lastIndex=0;var i=b.exec(e.slice(n));return i?(t.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function a(t,e,n){S.lastIndex=0;var i=S.exec(e.slice(n));return i?(t.m=T.get(i[0].toLowerCase()),n+i[0].length):-1}function o(t,e,n){M.lastIndex=0;var i=M.exec(e.slice(n));return i?(t.m=C.get(i[0].toLowerCase()),n+i[0].length):-1}function s(t,e,i){return n(t,A.c.toString(),e,i)}function l(t,e,i){return n(t,A.x.toString(),e,i)}function c(t,e,i){return n(t,A.X.toString(),e,i)}function d(t,e,n){var i=y.get(e.slice(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}var u=t.dateTime,h=t.date,f=t.time,p=t.periods,_=t.days,g=t.shortDays,m=t.months,v=t.shortMonths;e.utc=function(t){function n(t){try{gs=Ft;var e=new gs;return e._=t,i(e)}finally{gs=Date}}var i=e(t);return n.parse=function(t){try{gs=Ft;var e=i.parse(t);return e&&e._}finally{gs=Date}},n.toString=i.toString,n},e.multi=e.utc.multi=fe;var y=fo.map(),b=Xt(_),w=Jt(_),x=Xt(g),k=Jt(g),M=Xt(m),C=Jt(m),S=Xt(v),T=Jt(v);p.forEach(function(t,e){y.set(t.toLowerCase(),e)});var A={a:function(t){return g[t.getDay()]},A:function(t){return _[t.getDay()]},b:function(t){return v[t.getMonth()]},B:function(t){return m[t.getMonth()]},c:e(u),d:function(t,e){return Bt(t.getDate(),e,2)},e:function(t,e){return Bt(t.getDate(),e,2)},H:function(t,e){return Bt(t.getHours(),e,2)},I:function(t,e){return Bt(t.getHours()%12||12,e,2)},j:function(t,e){return Bt(1+_s.dayOfYear(t),e,3)},L:function(t,e){return Bt(t.getMilliseconds(),e,3)},m:function(t,e){return Bt(t.getMonth()+1,e,2)},M:function(t,e){return Bt(t.getMinutes(),e,2)},p:function(t){return p[+(t.getHours()>=12)]},S:function(t,e){return Bt(t.getSeconds(),e,2)},U:function(t,e){return Bt(_s.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Bt(_s.mondayOfYear(t),e,2)},x:e(h),X:e(f),y:function(t,e){return Bt(t.getFullYear()%100,e,2)},Y:function(t,e){return Bt(t.getFullYear()%1e4,e,4)},Z:ue,"%":function(){return"%"}},j={a:i,A:r,b:a,B:o,c:s,d:ae,e:ae,H:se,I:se,j:oe,L:de,m:re,M:le,p:d,S:ce,U:Kt,w:Qt,W:Zt,x:l,X:c,y:ee,Y:te,Z:ne,"%":he};return e}function Bt(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(e)+r:r)}function Xt(t){return new RegExp("^(?:"+t.map(fo.requote).join("|")+")","i")}function Jt(t){for(var e=new p,n=-1,i=t.length;++n<i;)e.set(t[n].toLowerCase(),n);return e}function Qt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Kt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.U=+i[0],n+i[0].length):-1}function Zt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.W=+i[0],n+i[0].length):-1}function te(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function ee(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.y=ie(+i[0]),n+i[0].length):-1}function ne(t,e,n){return/^[+-]\d{4}$/.test(e=e.slice(n,n+5))?(t.Z=-e,n+5):-1}function ie(t){return t+(t>68?1900:2e3)}function re(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function ae(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function oe(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.j=+i[0],n+i[0].length):-1}function se(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function le(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function ce(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function de(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function ue(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=ko(e)/60|0,r=ko(e)%60;return n+Bt(i,"0",2)+Bt(r,"0",2)}function he(t,e,n){bs.lastIndex=0;var i=bs.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function fe(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,i=t[n];!i[1](e);)i=t[++n];return i[0](e)}}function pe(){}function _e(t,e,n){var i=n.s=t+e,r=i-t,a=i-r;n.t=t-a+(e-r)}function ge(t,e){t&&Ms.hasOwnProperty(t.type)&&Ms[t.type](t,e)}function me(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function ve(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)me(t[n],e,1);e.polygonEnd()}function ye(){function t(t,e){t*=qo,e=e*qo/2+Vo/4;var n=t-i,o=n>=0?1:-1,s=o*n,l=Math.cos(e),c=Math.sin(e),d=a*c,u=r*l+d*Math.cos(s),h=d*o*Math.sin(s);Ss.add(Math.atan2(h,u)),i=t,r=l,a=c}var e,n,i,r,a;Ts.point=function(o,s){Ts.point=t,i=(e=o)*qo,r=Math.cos(s=(n=s)*qo/2+Vo/4),a=Math.sin(s)},Ts.lineEnd=function(){t(e,n)}}function be(t){var e=t[0],n=t[1],i=Math.cos(n);return[i*Math.cos(e),i*Math.sin(e),Math.sin(n)]}function we(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xe(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ke(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Me(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Ce(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Se(t){return[Math.atan2(t[1],t[0]),ot(t[2])]}function Te(t,e){return ko(t[0]-e[0])<Wo&&ko(t[1]-e[1])<Wo}function Ae(t,e){t*=qo;var n=Math.cos(e*=qo);je(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function je(t,e,n){++As,Es+=(t-Es)/As,Os+=(e-Os)/As,Ls+=(n-Ls)/As}function Ee(){function t(t,r){t*=qo;var a=Math.cos(r*=qo),o=a*Math.cos(t),s=a*Math.sin(t),l=Math.sin(r),c=Math.atan2(Math.sqrt((c=n*l-i*s)*c+(c=i*o-e*l)*c+(c=e*s-n*o)*c),e*o+n*s+i*l);js+=c,Ns+=c*(e+(e=o)),Is+=c*(n+(n=s)),Ps+=c*(i+(i=l)),je(e,n,i)}var e,n,i;$s.point=function(r,a){r*=qo;var o=Math.cos(a*=qo);e=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),$s.point=t,je(e,n,i)}}function Oe(){$s.point=Ae}function Le(){function t(t,e){t*=qo;var n=Math.cos(e*=qo),o=n*Math.cos(t),s=n*Math.sin(t),l=Math.sin(e),c=r*l-a*s,d=a*o-i*l,u=i*s-r*o,h=Math.sqrt(c*c+d*d+u*u),f=i*o+r*s+a*l,p=h&&-at(f)/h,_=Math.atan2(h,f);Ds+=p*c,Rs+=p*d,zs+=p*u,js+=_,Ns+=_*(i+(i=o)),Is+=_*(r+(r=s)),Ps+=_*(a+(a=l)),je(i,r,a)}var e,n,i,r,a;$s.point=function(o,s){e=o,n=s,$s.point=t,o*=qo;var l=Math.cos(s*=qo);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),je(i,r,a)},$s.lineEnd=function(){t(e,n),$s.lineEnd=Oe,$s.point=Ae}}function Ne(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function Ie(){return!0}function Pe(t,e,n,i,r){var a=[],o=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],i=t[e];if(Te(n,i)){r.lineStart();for(var s=0;s<e;++s)r.point((n=t[s])[0],n[1]);return void r.lineEnd()}var l=new Re(n,t,null,!0),c=new Re(n,null,l,!1);l.o=c,a.push(l),o.push(c),l=new Re(i,t,null,!1),c=new Re(i,null,l,!0),l.o=c,a.push(l),o.push(c)}}),o.sort(e),De(a),De(o),a.length){for(var s=0,l=n,c=o.length;s<c;++s)o[s].e=l=!l;for(var d,u,h=a[0];;){for(var f=h,p=!0;f.v;)if((f=f.n)===h)return;d=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,c=d.length;s<c;++s)r.point((u=d[s])[0],u[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(p){d=f.p.z;for(var s=d.length-1;s>=0;--s)r.point((u=d[s])[0],u[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,d=f.z,p=!p}while(!f.v);r.lineEnd()}}}function De(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function Re(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function ze(t,e,n,i){return function(r,a){function o(e,n){var i=r(e,n);t(e=i[0],n=i[1])&&a.point(e,n)}function s(t,e){var n=r(t,e);g.point(n[0],n[1])}function l(){v.point=s,g.lineStart()}function c(){v.point=o,g.lineEnd()}function d(t,e){_.push([t,e]);var n=r(t,e);b.point(n[0],n[1])}function u(){b.lineStart(),_=[]}function h(){d(_[0][0],_[0][1]),b.lineEnd();var t,e=b.clean(),n=y.buffer(),i=n.length;if(_.pop(),p.push(_),_=null,i)if(1&e){t=n[0];var r,i=t.length-1,o=-1;if(i>0){for(w||(a.polygonStart(),w=!0),a.lineStart();++o<i;)a.point((r=t[o])[0],r[1]);a.lineEnd()}}else i>1&&2&e&&n.push(n.pop().concat(n.shift())),f.push(n.filter($e))}var f,p,_,g=e(a),m=r.invert(i[0],i[1]),v={point:o,lineStart:l,lineEnd:c,polygonStart:function(){v.point=d,v.lineStart=u,v.lineEnd=h,f=[],p=[]},polygonEnd:function(){v.point=o,v.lineStart=l,v.lineEnd=c,f=fo.merge(f);var t=Ye(m,p);f.length?(w||(a.polygonStart(),w=!0),Pe(f,Ge,t,n,a)):t&&(w||(a.polygonStart(),w=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),f=p=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=We(),b=e(y),w=!1;return v}}function $e(t){return t.length>1}function We(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:S,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function Ge(t,e){return((t=t.x)[0]<0?t[1]-Yo-Wo:Yo-t[1])-((e=e.x)[0]<0?e[1]-Yo-Wo:Yo-e[1])}function Ve(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?Vo:-Vo,l=ko(a-n);ko(l-Vo)<Wo?(t.point(n,i=(i+o)/2>0?Yo:-Yo),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(a,i),e=0):r!==s&&l>=Vo&&(ko(n-r)<Wo&&(n-=r*Wo),ko(a-s)<Wo&&(a-=s*Wo),i=He(n,i,a,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=a,i=o),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}function He(t,e,n,i){var r,a,o=Math.sin(t-n);return ko(o)>Wo?Math.atan((Math.sin(e)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(e))*Math.sin(t))/(r*a*o)):(e+i)/2}function Fe(t,e,n,i){var r;if(null==t)r=n*Yo,i.point(-Vo,r),i.point(0,r),i.point(Vo,r),i.point(Vo,0),i.point(Vo,-r),i.point(0,-r),i.point(-Vo,-r),i.point(-Vo,0),i.point(-Vo,r);else if(ko(t[0]-e[0])>Wo){var a=t[0]<e[0]?Vo:-Vo;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])}function Ye(t,e){var n=t[0],i=t[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Ss.reset();for(var s=0,l=e.length;s<l;++s){var c=e[s],d=c.length;if(d)for(var u=c[0],h=u[0],f=u[1]/2+Vo/4,p=Math.sin(f),_=Math.cos(f),g=1;;){g===d&&(g=0),t=c[g];var m=t[0],v=t[1]/2+Vo/4,y=Math.sin(v),b=Math.cos(v),w=m-h,x=w>=0?1:-1,k=x*w,M=k>Vo,C=p*y;if(Ss.add(Math.atan2(C*x*Math.sin(k),_*b+C*Math.cos(k))),a+=M?w+x*Ho:w,M^h>=n^m>=n){var S=xe(be(u),be(t));Ce(S);var T=xe(r,S);Ce(T);var A=(M^w>=0?-1:1)*ot(T[2]);(i>A||i===A&&(S[0]||S[1]))&&(o+=M^w>=0?1:-1)}if(!g++)break;h=m,p=y,_=b,u=t}}return(a<-Wo||a<Wo&&Ss<-Wo)^1&o}function qe(t){function e(t,e){return Math.cos(t)*Math.cos(e)>a}function n(t){var n,a,l,c,d;return{lineStart:function(){c=l=!1,d=1},point:function(u,h){var f,p=[u,h],_=e(u,h),g=o?_?0:r(u,h):_?r(u+(u<0?Vo:-Vo),h):0;if(!n&&(c=l=_)&&t.lineStart(),_!==l&&(f=i(n,p),(Te(n,f)||Te(p,f))&&(p[0]+=Wo,p[1]+=Wo,_=e(p[0],p[1]))),_!==l)d=0,_?(t.lineStart(),f=i(p,n),t.point(f[0],f[1])):(f=i(n,p),t.point(f[0],f[1]),t.lineEnd()),n=f;else if(s&&n&&o^_){var m;g&a||!(m=i(p,n,!0))||(d=0,o?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1])))}!_||n&&Te(n,p)||t.point(p[0],p[1]),n=p,l=_,a=g},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return d|(c&&l)<<1}}}function i(t,e,n){var i=be(t),r=be(e),o=[1,0,0],s=xe(i,r),l=we(s,s),c=s[0],d=l-c*c;if(!d)return!n&&t;var u=a*l/d,h=-a*c/d,f=xe(o,s),p=Me(o,u);ke(p,Me(s,h));var _=f,g=we(p,_),m=we(_,_),v=g*g-m*(we(p,p)-1);if(!(v<0)){var y=Math.sqrt(v),b=Me(_,(-g-y)/m);if(ke(b,p),b=Se(b),!n)return b;var w,x=t[0],k=e[0],M=t[1],C=e[1];k<x&&(w=x,x=k,k=w);var S=k-x,T=ko(S-Vo)<Wo,A=T||S<Wo;if(!T&&C<M&&(w=M,M=C,C=w),A?T?M+C>0^b[1]<(ko(b[0]-x)<Wo?M:C):M<=b[1]&&b[1]<=C:S>Vo^(x<=b[0]&&b[0]<=k)){var j=Me(_,(-g+y)/m);return ke(j,p),[b,Se(j)]}}}function r(e,n){var i=o?t:Vo-t,r=0;return e<-i?r|=1:e>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(t),o=a>0,s=ko(a)>Wo;return ze(e,n,bn(t,6*qo),o?[0,-t]:[-Vo,t-Vo])}function Ue(t,e,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,c=o.y,d=s.x,u=s.y,h=0,f=1,p=d-l,_=u-c;if(a=t-l,p||!(a>0)){if(a/=p,p<0){if(a<h)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>h&&(h=a)}if(a=n-l,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>h&&(h=a)}else if(p>0){if(a<h)return;a<f&&(f=a)}if(a=e-c,_||!(a>0)){if(a/=_,_<0){if(a<h)return;a<f&&(f=a)}else if(_>0){if(a>f)return;a>h&&(h=a)}if(a=i-c,_||!(a<0)){if(a/=_,_<0){if(a>f)return;a>h&&(h=a)}else if(_>0){if(a<h)return;a<f&&(f=a)}return h>0&&(r.a={x:l+h*p,y:c+h*_}),f<1&&(r.b={x:l+f*p,y:c+f*_}),r}}}}}}function Be(t,e,n,i){function r(i,r){return ko(i[0]-t)<Wo?r>0?0:3:ko(i[0]-n)<Wo?r>0?2:1:ko(i[1]-e)<Wo?r>0?1:0:r>0?3:2}function a(t,e){return o(t.x,e.x)}function o(t,e){var n=r(t,1),i=r(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function l(t){for(var e=0,n=g.length,i=t[1],r=0;r<n;++r)for(var a,o=1,s=g[r],l=s.length,c=s[0];o<l;++o)a=s[o],c[1]<=i?a[1]>i&&rt(c,a,t)>0&&++e:a[1]<=i&&rt(c,a,t)<0&&--e,c=a;return 0!==e}function c(a,s,l,c){var d=0,u=0;if(null==a||(d=r(a,l))!==(u=r(s,l))||o(a,s)<0^l>0)do{c.point(0===d||3===d?t:n,d>1?i:e)}while((d=(d+l+4)%4)!==u);else c.point(s[0],s[1])}function d(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function u(t,e){d(t,e)&&s.point(t,e)}function h(){j.point=p,g&&g.push(m=[]),M=!0,k=!1,w=x=NaN}function f(){_&&(p(v,y),b&&k&&T.rejoin(),_.push(T.buffer())),j.point=u,k&&s.lineEnd()}function p(t,e){t=Math.max(-Gs,Math.min(Gs,t)),e=Math.max(-Gs,Math.min(Gs,e));var n=d(t,e);if(g&&m.push([t,e]),M)v=t,y=e,b=n,M=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&k)s.point(t,e);else{var i={a:{x:w,y:x},b:{x:t,y:e}};A(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),C=!1):n&&(s.lineStart(),s.point(t,e),C=!1)}w=t,x=e,k=n}var _,g,m,v,y,b,w,x,k,M,C,S=s,T=We(),A=Ue(t,e,n,i),j={point:u,lineStart:h,lineEnd:f,polygonStart:function(){s=T,_=[],g=[],C=!0},polygonEnd:function(){s=S,_=fo.merge(_);var e=l([t,i]),n=C&&e,r=_.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),c(null,null,1,s),s.lineEnd()),r&&Pe(_,a,e,c,s),s.polygonEnd()),_=g=m=null}};return j}}function Xe(t){var e=0,n=Vo/3,i=hn(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*Vo/180,n=t[1]*Vo/180):[e/Vo*180,n/Vo*180]},r}function Je(t,e){function n(t,e){var n=Math.sqrt(a-2*r*Math.sin(e))/r;return[n*Math.sin(t*=r),o-n*Math.cos(t)]}var i=Math.sin(t),r=(i+Math.sin(e))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/r,ot((a-(t*t+n*n)*r*r)/(2*r))]},n}function Qe(){function t(t,e){Hs+=r*t-i*e,i=t,r=e}var e,n,i,r;Bs.point=function(a,o){Bs.point=t,e=i=a,n=r=o},Bs.lineEnd=function(){t(e,n)}}function Ke(t,e){t<Fs&&(Fs=t),t>qs&&(qs=t),e<Ys&&(Ys=e),e>Us&&(Us=e)}function Ze(){function t(t,e){o.push("M",t,",",e,a)}function e(t,e){o.push("M",t,",",e),s.point=n}function n(t,e){o.push("L",t,",",e)}function i(){s.point=t}function r(){o.push("Z")}var a=tn(4.5),o=[],s={point:t,lineStart:function(){s.point=e},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=t},pointRadius:function(t){return a=tn(t),s},result:function(){if(o.length){var t=o.join("");return o=[],t}}};return s}function tn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function en(t,e){Es+=t,Os+=e,++Ls}function nn(){function t(t,i){var r=t-e,a=i-n,o=Math.sqrt(r*r+a*a);Ns+=o*(e+t)/2,Is+=o*(n+i)/2,Ps+=o,en(e=t,n=i)}var e,n;Js.point=function(i,r){Js.point=t,en(e=i,n=r)}}function rn(){Js.point=en}function an(){function t(t,e){var n=t-i,a=e-r,o=Math.sqrt(n*n+a*a);Ns+=o*(i+t)/2,Is+=o*(r+e)/2,Ps+=o,o=r*t-i*e,Ds+=o*(i+t),Rs+=o*(r+e),zs+=3*o,en(i=t,r=e)}var e,n,i,r;Js.point=function(a,o){Js.point=t,en(e=i=a,n=r=o)},Js.lineEnd=function(){t(e,n)}}function on(t){function e(e,n){t.moveTo(e+o,n),t.arc(e,n,o,0,Ho)}function n(e,n){t.moveTo(e,n),s.point=i}function i(e,n){t.lineTo(e,n)}function r(){s.point=e}function a(){t.closePath()}var o=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=e},pointRadius:function(t){return o=t,s},result:S};return s}function sn(t){function e(t){return(s?i:n)(t)}function n(e){return dn(e,function(n,i){n=t(n,i),e.point(n[0],n[1])})}function i(e){function n(n,i){n=t(n,i),e.point(n[0],n[1])}function i(){y=NaN,M.point=a,e.lineStart()}function a(n,i){var a=be([n,i]),o=t(n,i);r(y,b,v,w,x,k,y=o[0],b=o[1],v=n,w=a[0],x=a[1],k=a[2],s,e),e.point(y,b)}function o(){M.point=n,e.lineEnd()}function l(){i(),M.point=c,M.lineEnd=d}function c(t,e){a(u=t,h=e),f=y,p=b,_=w,g=x,m=k,M.point=a}function d(){r(y,b,v,w,x,k,f,p,u,_,g,m,s,e),M.lineEnd=o,o()}var u,h,f,p,_,g,m,v,y,b,w,x,k,M={point:n,lineStart:i,lineEnd:o,polygonStart:function(){e.polygonStart(),M.lineStart=l},polygonEnd:function(){e.polygonEnd(),M.lineStart=i}};return M}function r(e,n,i,s,l,c,d,u,h,f,p,_,g,m){var v=d-e,y=u-n,b=v*v+y*y;if(b>4*a&&g--){var w=s+f,x=l+p,k=c+_,M=Math.sqrt(w*w+x*x+k*k),C=Math.asin(k/=M),S=ko(ko(k)-1)<Wo||ko(i-h)<Wo?(i+h)/2:Math.atan2(x,w),T=t(S,C),A=T[0],j=T[1],E=A-e,O=j-n,L=y*E-v*O;(L*L/b>a||ko((v*E+y*O)/b-.5)>.3||s*f+l*p+c*_<o)&&(r(e,n,i,s,l,c,A,j,S,w/=M,x/=M,k,g,m),m.point(A,j),r(A,j,S,w,x,k,d,u,h,f,p,_,g,m))}}var a=.5,o=Math.cos(30*qo),s=16;return e.precision=function(t){return arguments.length?(s=(a=t*t)>0&&16,e):Math.sqrt(a)},e}function ln(t){var e=sn(function(e,n){return t([e*Uo,n*Uo])});return function(t){return fn(e(t))}}function cn(t){this.stream=t}function dn(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function un(t){return hn(function(){return t})()}function hn(t){function e(t){return t=s(t[0]*qo,t[1]*qo),[t[0]*h+l,c-t[1]*h]}function n(t){return(t=s.invert((t[0]-l)/h,(c-t[1])/h))&&[t[0]*Uo,t[1]*Uo]}function i(){s=Ne(o=gn(m,v,y),a);var t=a(_,g);return l=f-t[0]*h,c=p+t[1]*h,r()}function r(){return d&&(d.valid=!1,d=null),e}var a,o,s,l,c,d,u=sn(function(t,e){return t=a(t,e),[t[0]*h+l,c-t[1]*h]}),h=150,f=480,p=250,_=0,g=0,m=0,v=0,y=0,b=Ws,w=k,x=null,M=null;return e.stream=function(t){return d&&(d.valid=!1),d=fn(b(o,u(w(t)))),d.valid=!0,d},e.clipAngle=function(t){return arguments.length?(b=null==t?(x=t,Ws):qe((x=+t)*qo),r()):x},e.clipExtent=function(t){return arguments.length?(M=t,w=t?Be(t[0][0],t[0][1],t[1][0],t[1][1]):k,r()):M},e.scale=function(t){return arguments.length?(h=+t,i()):h},e.translate=function(t){return arguments.length?(f=+t[0],p=+t[1],i()):[f,p]},e.center=function(t){return arguments.length?(_=t[0]%360*qo,g=t[1]%360*qo,i()):[_*Uo,g*Uo]},e.rotate=function(t){return arguments.length?(m=t[0]%360*qo,v=t[1]%360*qo,y=t.length>2?t[2]%360*qo:0,i()):[m*Uo,v*Uo,y*Uo]},fo.rebind(e,u,"precision"),function(){return a=t.apply(this,arguments),e.invert=a.invert&&n,i()}}function fn(t){return dn(t,function(e,n){t.point(e*qo,n*qo)})}function pn(t,e){return[t,e]}function _n(t,e){return[t>Vo?t-Ho:t<-Vo?t+Ho:t,e]}function gn(t,e,n){return t?e||n?Ne(vn(t),yn(e,n)):vn(t):e||n?yn(e,n):_n}function mn(t){return function(e,n){return e+=t,[e>Vo?e-Ho:e<-Vo?e+Ho:e,n]}}function vn(t){var e=mn(t);return e.invert=mn(-t),e}function yn(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,c=Math.sin(e),d=c*i+s*r;return[Math.atan2(l*a-d*o,s*i-c*r),ot(d*a+l*o)]}var i=Math.cos(t),r=Math.sin(t),a=Math.cos(e),o=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,c=Math.sin(e),d=c*a-l*o;return[Math.atan2(l*a+c*o,s*i+d*r),ot(d*i-s*r)]},n}function bn(t,e){var n=Math.cos(t),i=Math.sin(t);return function(r,a,o,s){var l=o*e;null!=r?(r=wn(n,r),a=wn(n,a),(o>0?r<a:r>a)&&(r+=o*Ho)):(r=t+o*Ho,a=t-.5*l);for(var c,d=r;o>0?d>a:d<a;d-=l)s.point((c=Se([n,-i*Math.cos(d),-i*Math.sin(d)]))[0],c[1])}}function wn(t,e){var n=be(e);n[0]-=t,Ce(n);var i=at(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-Wo)%(2*Math.PI)}function xn(t,e,n){var i=fo.range(t,e-Wo,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function kn(t,e,n){var i=fo.range(t,e-Wo,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function Mn(t){return t.source}function Cn(t){return t.target}function Sn(t,e,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(t),c=r*Math.sin(t),d=o*Math.cos(n),u=o*Math.sin(n),h=2*Math.asin(Math.sqrt(dt(i-e)+r*o*dt(n-t))),f=1/Math.sin(h),p=h?function(t){var e=Math.sin(t*=h)*f,n=Math.sin(h-t)*f,i=n*l+e*d,r=n*c+e*u,o=n*a+e*s;return[Math.atan2(r,i)*Uo,Math.atan2(o,Math.sqrt(i*i+r*r))*Uo]}:function(){return[t*Uo,e*Uo]};return p.distance=h,p}function Tn(){function t(t,r){var a=Math.sin(r*=qo),o=Math.cos(r),s=ko((t*=qo)-e),l=Math.cos(s);Qs+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),e=t,n=a,i=o}var e,n,i;Ks.point=function(r,a){e=r*qo,n=Math.sin(a*=qo),i=Math.cos(a),Ks.point=t},Ks.lineEnd=function(){Ks.point=Ks.lineEnd=S}}function An(t,e){function n(e,n){var i=Math.cos(e),r=Math.cos(n),a=t(i*r);return[a*r*Math.sin(e),a*Math.sin(n)]}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n),r=e(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(t*a,i*o),Math.asin(i&&n*a/i)]},n}function jn(t,e){function n(t,e){o>0?e<-Yo+Wo&&(e=-Yo+Wo):e>Yo-Wo&&(e=Yo-Wo);var n=o/Math.pow(r(e),a);return[n*Math.sin(a*t),o-n*Math.cos(a*t)]}var i=Math.cos(t),r=function(t){return Math.tan(Vo/4+t/2)},a=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(r(e)/r(t)),o=i*Math.pow(r(t),a)/a;return a?(n.invert=function(t,e){var n=o-e,i=it(a)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Yo]},n):On}function En(t,e){function n(t,e){var n=a-e;return[n*Math.sin(r*t),a-n*Math.cos(r*t)]}var i=Math.cos(t),r=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),a=i/r+t;return ko(r)<Wo?pn:(n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/r,a-it(r)*Math.sqrt(t*t+n*n)]},n)}function On(t,e){return[t,Math.log(Math.tan(Vo/4+e/2))]}function Ln(t){var e,n=un(t),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var o=a.apply(n,arguments);if(o===n){if(e=null==t){var s=Vo*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else e&&(o=null);return o},n.clipExtent(null)}function Nn(t,e){return[Math.log(Math.tan(Vo/4+e/2)),-t]}function In(t){return t[0]}function Pn(t){return t[1]}function Dn(t){for(var e=t.length,n=[0,1],i=2,r=2;r<e;r++){for(;i>1&&rt(t[n[i-2]],t[n[i-1]],t[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function Rn(t,e){return t[0]-e[0]||t[1]-e[1]}function zn(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function $n(t,e,n,i){var r=t[0],a=n[0],o=e[0]-r,s=i[0]-a,l=t[1],c=n[1],d=e[1]-l,u=i[1]-c,h=(s*(l-c)-u*(r-a))/(u*o-s*d);return[r+h*o,l+h*d]}function Wn(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Gn(){li(this),this.edge=this.site=this.circle=null}function Vn(t){var e=dl.pop()||new Gn;return e.site=t,e}function Hn(t){Zn(t),sl.remove(t),dl.push(t),li(t)}function Fn(t){var e=t.circle,n=e.x,i=e.cy,r={x:n,y:i},a=t.P,o=t.N,s=[t];Hn(t);for(var l=a;l.circle&&ko(n-l.circle.x)<Wo&&ko(i-l.circle.cy)<Wo;)a=l.P,s.unshift(l),Hn(l),l=a;s.unshift(l),Zn(l);for(var c=o;c.circle&&ko(n-c.circle.x)<Wo&&ko(i-c.circle.cy)<Wo;)o=c.N,s.push(c),Hn(c),c=o;s.push(c),Zn(c);var d,u=s.length;for(d=1;d<u;++d)c=s[d],l=s[d-1],ai(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=ii(l.site,c.site,null,r),Kn(l),Kn(c)}function Yn(t){for(var e,n,i,r,a=t.x,o=t.y,s=sl._;s;)if((i=qn(s,o)-a)>Wo)s=s.L;else{if(!((r=a-Un(s,o))>Wo)){i>-Wo?(e=s.P,n=s):r>-Wo?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var l=Vn(t);if(sl.insert(e,l),e||n){if(e===n)return Zn(e),n=Vn(e.site),sl.insert(l,n),l.edge=n.edge=ii(e.site,l.site),Kn(e),void Kn(n);if(!n)return void(l.edge=ii(e.site,l.site));Zn(e),Zn(n);var c=e.site,d=c.x,u=c.y,h=t.x-d,f=t.y-u,p=n.site,_=p.x-d,g=p.y-u,m=2*(h*g-f*_),v=h*h+f*f,y=_*_+g*g,b={x:(g*v-f*y)/m+d,y:(h*y-_*v)/m+u};ai(n.edge,c,p,b),l.edge=ii(c,t,null,b),n.edge=ii(t,p,null,b),Kn(e),Kn(n)}}function qn(t,e){var n=t.site,i=n.x,r=n.y,a=r-e;if(!a)return i;var o=t.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,c=l-e;if(!c)return s;var d=s-i,u=1/a-1/c,h=d/c;return u?(-h+Math.sqrt(h*h-2*u*(d*d/(-2*c)-l+c/2+r-a/2)))/u+i:(i+s)/2}function Un(t,e){var n=t.N;if(n)return qn(n,e);var i=t.site;return i.y===e?i.x:1/0}function Bn(t){this.site=t,this.edges=[]}function Xn(t){for(var e,n,i,r,a,o,s,l,c,d,u=t[0][0],h=t[1][0],f=t[0][1],p=t[1][1],_=ol,g=_.length;g--;)if((a=_[g])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)d=s[o].end(),i=d.x,r=d.y,c=s[++o%l].start(),e=c.x,n=c.y,(ko(i-e)>Wo||ko(r-n)>Wo)&&(s.splice(o,0,new oi(ri(a.site,d,ko(i-u)<Wo&&p-r>Wo?{x:u,y:ko(e-u)<Wo?n:p}:ko(r-p)<Wo&&h-i>Wo?{x:ko(n-p)<Wo?e:h,y:p}:ko(i-h)<Wo&&r-f>Wo?{x:h,y:ko(e-h)<Wo?n:f}:ko(r-f)<Wo&&i-u>Wo?{x:ko(n-f)<Wo?e:u,y:f}:null),a.site,null)),++l)}function Jn(t,e){return e.angle-t.angle}function Qn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Kn(t){var e=t.P,n=t.N;if(e&&n){var i=e.site,r=t.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,c=i.y-s,d=a.x-o,u=a.y-s,h=2*(l*u-c*d);if(!(h>=-Go)){var f=l*l+c*c,p=d*d+u*u,_=(u*f-c*p)/h,g=(l*p-d*f)/h,u=g+s,m=ul.pop()||new Qn;m.arc=t,m.site=r,m.x=_+o,m.y=u+Math.sqrt(_*_+g*g),m.cy=u,t.circle=m;for(var v=null,y=cl._;y;)if(m.y<y.y||m.y===y.y&&m.x<=y.x){if(!y.L){v=y.P;break}y=y.L}else{if(!y.R){v=y;break}y=y.R}cl.insert(v,m),v||(ll=m)}}}}function Zn(t){var e=t.circle;e&&(e.P||(ll=e.N),cl.remove(e),ul.push(e),li(e),t.circle=null)}function ti(t){for(var e,n=al,i=Ue(t[0][0],t[0][1],t[1][0],t[1][1]),r=n.length;r--;)e=n[r],(!ei(e,t)||!i(e)||ko(e.a.x-e.b.x)<Wo&&ko(e.a.y-e.b.y)<Wo)&&(e.a=e.b=null,n.splice(r,1))}function ei(t,e){var n=t.b;if(n)return!0;var i,r,a=t.a,o=e[0][0],s=e[1][0],l=e[0][1],c=e[1][1],d=t.l,u=t.r,h=d.x,f=d.y,p=u.x,_=u.y,g=(h+p)/2,m=(f+_)/2;if(_===f){if(g<o||g>=s)return;if(h>p){if(a){if(a.y>=c)return}else a={x:g,y:l};n={x:g,y:c}}else{if(a){if(a.y<l)return}else a={x:g,y:c};n={x:g,y:l}}}else if(i=(h-p)/(_-f),r=m-i*g,i<-1||i>1)if(h>p){if(a){if(a.y>=c)return}else a={x:(l-r)/i,y:l};n={x:(c-r)/i,y:c}}else{if(a){if(a.y<l)return}else a={x:(c-r)/i,y:c};n={x:(l-r)/i,y:l}}else if(f<_){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return t.a=a,t.b=n,!0}function ni(t,e){this.l=t,this.r=e,this.a=this.b=null}function ii(t,e,n,i){var r=new ni(t,e);return al.push(r),n&&ai(r,t,e,n),i&&ai(r,e,t,i),ol[t.i].edges.push(new oi(r,t,e)),ol[e.i].edges.push(new oi(r,e,t)),r}function ri(t,e,n){var i=new ni(t,null);return i.a=e,i.b=n,al.push(i),i}function ai(t,e,n,i){t.a||t.b?t.l===n?t.b=i:t.a=i:(t.a=i,t.l=e,t.r=n)}function oi(t,e,n){var i=t.a,r=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ci(t,e){var n=e,i=e.R,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function di(t,e){var n=e,i=e.L,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ui(t){for(;t.L;)t=t.L;return t}function hi(t,e){var n,i,r,a=t.sort(fi).pop();for(al=[],ol=new Array(t.length),sl=new si,cl=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Bn(a),Yn(a),n=a.x,i=a.y),a=t.pop();else{if(!r)break;Fn(r.arc)}e&&(ti(e),Xn(e));var o={cells:ol,edges:al};return sl=cl=al=ol=null,o}function fi(t,e){return e.y-t.y||e.x-t.x}function pi(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function _i(t){return t.x}function gi(t){return t.y}function mi(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function vi(t,e,n,i,r,a){if(!t(e,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=e.nodes;l[0]&&vi(t,l[0],n,i,o,s),l[1]&&vi(t,l[1],o,i,r,s),l[2]&&vi(t,l[2],n,s,o,a),l[3]&&vi(t,l[3],o,s,r,a)}}function yi(t,e,n,i,r,a,o){var s,l=1/0;return function t(c,d,u,h,f){if(!(d>a||u>o||h<i||f<r)){if(p=c.point){var p,_=e-c.x,g=n-c.y,m=_*_+g*g;if(m<l){var v=Math.sqrt(l=m);i=e-v,r=n-v,a=e+v,o=n+v,s=p}}for(var y=c.nodes,b=.5*(d+h),w=.5*(u+f),x=e>=b,k=n>=w,M=k<<1|x,C=M+4;M<C;++M)if(c=y[3&M])switch(3&M){case 0:t(c,d,u,b,w);break;case 1:t(c,b,u,h,w);break;case 2:t(c,d,w,b,f);break;case 3:t(c,b,w,h,f)}}}(t,i,r,a,o),s}function bi(t,e){t=fo.rgb(t),e=fo.rgb(e);var n=t.r,i=t.g,r=t.b,a=e.r-n,o=e.g-i,s=e.b-r;return function(t){return"#"+Ct(Math.round(n+a*t))+Ct(Math.round(i+o*t))+Ct(Math.round(r+s*t))}}function wi(t,e){var n,i={},r={};for(n in t)n in e?i[n]=Mi(t[n],e[n]):r[n]=t[n];for(n in e)n in t||(r[n]=e[n]);return function(t){for(n in i)r[n]=i[n](t);return r}}function xi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function ki(t,e){var n,i,r,a=fl.lastIndex=pl.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=fl.exec(t))&&(i=pl.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=pl.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function Mi(t,e){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](t,e)););return n}function Ci(t,e){var n,i=[],r=[],a=t.length,o=e.length,s=Math.min(t.length,e.length);for(n=0;n<s;++n)i.push(Mi(t[n],e[n]));for(;n<a;++n)r[n]=t[n];for(;n<o;++n)r[n]=e[n];return function(t){for(n=0;n<s;++n)r[n]=i[n](t);return r}}function Si(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function Ti(t){return function(e){return 1-t(1-e)}}function Ai(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function ji(t){return t*t}function Ei(t){return t*t*t}function Oi(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Li(t){return function(e){return Math.pow(e,t)}}function Ni(t){return 1-Math.cos(t*Yo)}function Ii(t){return Math.pow(2,10*(t-1))}function Pi(t){return 1-Math.sqrt(1-t*t)}function Di(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/Ho*Math.asin(1/t):(t=1,n=e/4),function(i){return 1+t*Math.pow(2,-10*i)*Math.sin((i-n)*Ho/e)}}function Ri(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function zi(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function $i(t,e){t=fo.hcl(t),e=fo.hcl(e);var n=t.h,i=t.c,r=t.l,a=e.h-n,o=e.c-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.c:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return _t(n+a*t,i+o*t,r+s*t)+""}}function Wi(t,e){t=fo.hsl(t),e=fo.hsl(e);var n=t.h,i=t.s,r=t.l,a=e.h-n,o=e.s-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.s:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return ft(n+a*t,i+o*t,r+s*t)+""}}function Gi(t,e){t=fo.lab(t),e=fo.lab(e);var n=t.l,i=t.a,r=t.b,a=e.l-n,o=e.a-i,s=e.b-r;return function(t){return mt(n+a*t,i+o*t,r+s*t)+""}}function Vi(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Hi(t){var e=[t.a,t.b],n=[t.c,t.d],i=Yi(e),r=Fi(e,n),a=Yi(qi(n,e,-r))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Uo,this.translate=[t.e,t.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*Uo:0}function Fi(t,e){return t[0]*e[0]+t[1]*e[1]}function Yi(t){var e=Math.sqrt(Fi(t,t));return e&&(t[0]/=e,t[1]/=e),e}function qi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function Ui(t){return t.length?t.pop()+",":""}function Bi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else(e[0]||e[1])&&n.push("translate("+e+")")}function Xi(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(Ui(n)+"rotate(",null,")")-2,x:xi(t,e)})):e&&n.push(Ui(n)+"rotate("+e+")")}function Ji(t,e,n,i){t!==e?i.push({i:n.push(Ui(n)+"skewX(",null,")")-2,x:xi(t,e)}):e&&n.push(Ui(n)+"skewX("+e+")")}function Qi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push(Ui(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else 1===e[0]&&1===e[1]||n.push(Ui(n)+"scale("+e+")")}function Ki(t,e){var n=[],i=[];return t=fo.transform(t),e=fo.transform(e),Bi(t.translate,e.translate,n,i),Xi(t.rotate,e.rotate,n,i),Ji(t.skew,e.skew,n,i),Qi(t.scale,e.scale,n,i),t=e=null,function(t){for(var e,r=-1,a=i.length;++r<a;)n[(e=i[r]).i]=e.x(t);return n.join("")}}function Zi(t,e){return e=(e-=t=+t)||1/e,function(n){return(n-t)/e}}function tr(t,e){return e=(e-=t=+t)||1/e,function(n){return Math.max(0,Math.min(1,(n-t)/e))}}function er(t){for(var e=t.source,n=t.target,i=ir(e,n),r=[e];e!==i;)e=e.parent,r.push(e);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function ir(t,e){if(t===e)return t;for(var n=nr(t),i=nr(e),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(t){t.fixed|=2}function ar(t){t.fixed&=-7}function or(t){t.fixed|=4,t.px=t.x,t.py=t.y}function sr(t){t.fixed&=-5}function lr(t,e,n){var i=0,r=0;if(t.charge=0,!t.leaf)for(var a,o=t.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,e,n),t.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var c=e*n[t.point.index];t.charge+=t.pointCharge=c,i+=c*t.point.x,r+=c*t.point.y}t.cx=i/t.charge,t.cy=r/t.charge}function cr(t,e){return fo.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=_r,t}function dr(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(r=t.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function ur(t,e){for(var n=[t],i=[];null!=(t=n.pop());)if(i.push(t),(a=t.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(t=i.pop());)e(t)}function hr(t){return t.children}function fr(t){return t.value}function pr(t,e){return e.value-t.value}function _r(t){return fo.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function gr(t){return t.x}function mr(t){return t.y}function vr(t,e,n){t.y0=e,t.y=n}function yr(t){return fo.range(t.length)}function br(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function wr(t){for(var e,n=1,i=0,r=t[0][1],a=t.length;n<a;++n)(e=t[n][1])>r&&(i=n,r=e);return i}function xr(t){return t.reduce(kr,0)}function kr(t,e){return t+e[1]}function Mr(t,e){return Cr(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Cr(t,e){for(var n=-1,i=+t[0],r=(t[1]-i)/e,a=[];++n<=e;)a[n]=r*n+i;return a}function Sr(t){return[fo.min(t),fo.max(t)]}function Tr(t,e){return t.value-e.value}function Ar(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function jr(t,e){t._pack_next=e,e._pack_prev=t}function Er(t,e){var n=e.x-t.x,i=e.y-t.y,r=t.r+e.r;return.999*r*r>n*n+i*i}function Or(t){function e(t){d=Math.min(t.x-t.r,d),u=Math.max(t.x+t.r,u),h=Math.min(t.y-t.r,h),f=Math.max(t.y+t.r,f)}if((n=t.children)&&(c=n.length)){var n,i,r,a,o,s,l,c,d=1/0,u=-1/0,h=1/0,f=-1/0;if(n.forEach(Lr),i=n[0],i.x=-i.r,i.y=0,e(i),c>1&&(r=n[1],r.x=r.r,r.y=0,e(r),c>2))for(a=n[2],Pr(i,r,a),e(a),Ar(i,a),i._pack_prev=a,Ar(a,r),r=i._pack_next,o=3;o<c;o++){Pr(i,r,a=n[o]);var p=0,_=1,g=1;for(s=r._pack_next;s!==r;s=s._pack_next,_++)if(Er(s,a)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!Er(l,a);l=l._pack_prev,g++);p?(_<g||_==g&&r.r<i.r?jr(i,r=s):jr(i=l,r),o--):(Ar(i,a),r=a,e(a))}var m=(d+u)/2,v=(h+f)/2,y=0;for(o=0;o<c;o++)a=n[o],a.x-=m,a.y-=v,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));t.r=y,n.forEach(Nr)}}function Lr(t){t._pack_next=t._pack_prev=t}function Nr(t){delete t._pack_next,delete t._pack_prev}function Ir(t,e,n,i){var r=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,r)for(var a=-1,o=r.length;++a<o;)Ir(r[a],e,n,i)}function Pr(t,e,n){var i=t.r+n.r,r=e.x-t.x,a=e.y-t.y;if(i&&(r||a)){var o=e.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),c=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=t.x+l*r+c*a,n.y=t.y+l*a-c*r}else n.x=t.x+i,n.y=t.y}function Dr(t,e){return t.parent==e.parent?1:2}function Rr(t){var e=t.children;return e.length?e[0]:t.t}function zr(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function $r(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Wr(t){for(var e,n=0,i=0,r=t.children,a=r.length;--a>=0;)e=r[a],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}function Gr(t,e,n){return t.a.parent===e.parent?t.a:n}function Vr(t){return 1+fo.max(t,function(t){return t.y})}function Hr(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Fr(t){var e=t.children;return e&&e.length?Fr(e[0]):t}function Yr(t){var e,n=t.children;return n&&(e=n.length)?Yr(n[e-1]):t}function qr(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Ur(t,e){var n=t.x+e[3],i=t.y+e[0],r=t.dx-e[1]-e[3],a=t.dy-e[0]-e[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Br(t){var e=t[0],n=t[t.length-1];return e<n?[e,n]:[n,e]}function Xr(t){return t.rangeExtent?t.rangeExtent():Br(t.range())}function Jr(t,e,n,i){var r=n(t[0],t[1]),a=i(e[0],e[1]);return function(t){return a(r(t))}}function Qr(t,e){var n,i=0,r=t.length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}function Kr(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:Cl}function Zr(t,e,n,i){var r=[],a=[],o=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<=s;)r.push(n(t[o-1],t[o])),a.push(i(e[o-1],e[o]));return function(e){var n=fo.bisect(t,e,1,s)-1;return a[n](r[n](e))}}function ta(t,e,n,i){function r(){var r=Math.min(t.length,e.length)>2?Zr:Jr,l=i?tr:Zi;return o=r(t,e,l,n),s=r(e,t,l,Mi),a}function a(t){return o(t)}var o,s;return a.invert=function(t){return s(t)},a.domain=function(e){return arguments.length?(t=e.map(Number),r()):t},a.range=function(t){return arguments.length?(e=t,r()):e},a.rangeRound=function(t){return a.range(t).interpolate(Vi)},a.clamp=function(t){return arguments.length?(i=t,r()):i},a.interpolate=function(t){return arguments.length?(n=t,r()):n},a.ticks=function(e){return ra(t,e)},a.tickFormat=function(e,n){return aa(t,e,n)},a.nice=function(e){return na(t,e),r()},a.copy=function(){return ta(t,e,n,i)},r()}function ea(t,e){return fo.rebind(t,e,"range","rangeRound","interpolate","clamp")}function na(t,e){return Qr(t,Kr(ia(t,e)[2])),Qr(t,Kr(ia(t,e)[2])),t}function ia(t,e){null==e&&(e=10);var n=Br(t),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),a=e/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(t,e){return fo.range.apply(fo,ia(t,e))}function aa(t,e,n){var i=ia(t,e);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(t){return n(a.scale(t))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function sa(t,e){var n=oa(e[2]);return t in Sl?Math.abs(n-oa(Math.max(ko(e[0]),ko(e[1]))))+ +("e"!==t):n-2*("%"===t)}function la(t,e,n,i){function r(t){return(n?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function a(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function o(e){return t(r(e))}return o.invert=function(e){return a(t.invert(e))},o.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((i=e.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(e=+n,t.domain(i.map(r)),o):e},o.nice=function(){var e=Qr(i.map(r),n?Math:Al);return t.domain(e),i=e.map(a),o},o.ticks=function(){var t=Br(i),o=[],s=t[0],l=t[1],c=Math.floor(r(s)),d=Math.ceil(r(l)),u=e%1?2:e;if(isFinite(d-c)){if(n){for(;c<d;c++)for(var h=1;h<u;h++)o.push(a(c)*h);o.push(a(c))}else for(o.push(a(c));c++<d;)for(var h=u-1;h>0;h--)o.push(a(c)*h);for(c=0;o[c]<s;c++);for(d=o.length;o[d-1]>l;d--);o=o.slice(c,d)}return o},o.tickFormat=function(t,n){if(!arguments.length)return Tl;arguments.length<2?n=Tl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,e*t/o.ticks().length);return function(t){var o=t/a(Math.round(r(t)));return o*e<e-.5&&(o*=e),o<=i?n(t):""}},o.copy=function(){return la(t.copy(),e,n,i)},ea(o,t)}function ca(t,e,n){function i(e){return t(r(e))}var r=da(e),a=da(1/e);return i.invert=function(e){return a(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(r)),i):n},i.ticks=function(t){return ra(n,t)},i.tickFormat=function(t,e){return aa(n,t,e)},i.nice=function(t){return i.domain(na(n,t))},i.exponent=function(o){return arguments.length?(r=da(e=o),a=da(1/e),t.domain(n.map(r)),i):e},i.copy=function(){return ca(t.copy(),e,n)},ea(i,t)}function da(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function ua(t,e){function n(n){return a[((r.get(n)||("range"===e.t?r.set(n,t.push(n)):NaN))-1)%a.length]}function i(e,n){return fo.range(t.length).map(function(t){return e+n*t})}var r,a,o;return n.domain=function(i){if(!arguments.length)return t;t=[],r=new p;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,t.push(a));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(a=t,o=0,e={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=t.length<2?(l=(l+c)/2,0):(c-l)/(t.length-1+s);return a=i(l+d*s/2,d),o=0,e={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],c=r[1],d=t.length<2?(l=c=Math.round((l+c)/2),0):(c-l)/(t.length-1+s)|0;return a=i(l+Math.round(d*s/2+(c-l-(t.length-1+s)*d)/2),d),o=0,e={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=(u-d)/(t.length-s+2*l);return a=i(d+h*l,h),c&&a.reverse(),o=h*(1-s),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var c=r[1]<r[0],d=r[c-0],u=r[1-c],h=Math.floor((u-d)/(t.length-s+2*l));return a=i(d+Math.round((u-d-(t.length-s)*h)/2),h),c&&a.reverse(),o=Math.round(h*(1-s)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Br(e.a[0])},n.copy=function(){return ua(t,e)},n.domain(t)}function ha(t,e){function n(){var n=0,a=e.length;for(r=[];++n<a;)r[n-1]=fo.quantile(t,n/a);return i}function i(t){if(!isNaN(t=+t))return e[fo.bisect(r,t)]}var r;return i.domain=function(e){return arguments.length?(t=e.map(l).filter(c).sort(s),n()):t},i.range=function(t){return arguments.length?(e=t,n()):e},i.quantiles=function(){return r},i.invertExtent=function(n){return n=e.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:t[0],n<r.length?r[n]:t[t.length-1]]},i.copy=function(){return ha(t,e)},n()}function fa(t,e,n){function i(e){return n[Math.max(0,Math.min(o,Math.floor(a*(e-t))))]}function r(){return a=n.length/(e-t),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],r()):[t,e]},i.range=function(t){return arguments.length?(n=t,r()):n},i.invertExtent=function(e){return e=n.indexOf(e),e=e<0?NaN:e/a+t,[e,e+1/a]},i.copy=function(){return fa(t,e,n)},r()}function pa(t,e){function n(n){if(n<=n)return e[fo.bisect(t,n)]}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return pa(t,e)},n}function _a(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return ra(t,e)},e.tickFormat=function(e,n){return aa(t,e,n)},e.copy=function(){return _a(t)},e}function ga(){return 0}function ma(t){return t.innerRadius}function va(t){return t.outerRadius}function ya(t){return t.startAngle}function ba(t){return t.endAngle}function wa(t){return t&&t.padAngle}function xa(t,e,n,i){return(t-n)*e-(e-i)*t>0?0:1}function ka(t,e,n,i,r){var a=t[0]-e[0],o=t[1]-e[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,c=-s*a,d=t[0]+l,u=t[1]+c,h=e[0]+l,f=e[1]+c,p=(d+h)/2,_=(u+f)/2,g=h-d,m=f-u,v=g*g+m*m,y=n-i,b=d*f-h*u,w=(m<0?-1:1)*Math.sqrt(Math.max(0,y*y*v-b*b)),x=(b*m-g*w)/v,k=(-b*g-m*w)/v,M=(b*m+g*w)/v,C=(-b*g+m*w)/v,S=x-p,T=k-_,A=M-p,j=C-_;return S*S+T*T>A*A+j*j&&(x=M,k=C),[[x-l,k-c],[x*n/y,k*n/y]]}function Ma(t){function e(e){function o(){c.push("M",a(t(d),s))}for(var l,c=[],d=[],u=-1,h=e.length,f=Ot(n),p=Ot(i);++u<h;)r.call(this,l=e[u],u)?d.push([+f.call(this,l,u),+p.call(this,l,u)]):d.length&&(o(),d=[]);return d.length&&o(),c.length?c.join(""):null}var n=In,i=Pn,r=Ie,a=Ca,o=a.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(r=t,e):r},e.interpolate=function(t){return arguments.length?(o="function"==typeof t?a=t:(a=Il.get(t)||Ca).key,e):o},e.tension=function(t){return arguments.length?(s=t,e):s},e}function Ca(t){return t.length>1?t.join("L"):t+"Z"}function Sa(t){return t.join("L")+"Z"}function Ta(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i[0]+(i=t[e])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function Aa(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("V",(i=t[e])[1],"H",i[0]);return r.join("")}function ja(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i=t[e])[0],"V",i[1]);return r.join("")}function Ea(t,e){return t.length<4?Ca(t):t[1]+Na(t.slice(1,-1),Ia(t,e))}function Oa(t,e){return t.length<3?Sa(t):t[0]+Na((t.push(t[0]),t),Ia([t[t.length-2]].concat(t,[t[1]]),e))}function La(t,e){return t.length<3?Ca(t):t[0]+Na(t,Ia(t,e))}function Na(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return Ca(t);var n=t.length!=e.length,i="",r=t[0],a=t[1],o=e[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=t[1],l=2),e.length>1){s=e[1],a=t[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var c=2;c<e.length;c++,l++)a=t[l],s=e[c],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var d=t[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+d[0]+","+d[1]}return i}function Ia(t,e){for(var n,i=[],r=(1-e)/2,a=t[0],o=t[1],s=1,l=t.length;++s<l;)n=a,a=o,o=t[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Pa(t){if(t.length<3)return Ca(t);var e=1,n=t.length,i=t[0],r=i[0],a=i[1],o=[r,r,r,(i=t[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",$a(Rl,o),",",$a(Rl,s)];for(t.push(t[n-1]);++e<=n;)i=t[e],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),Wa(l,o,s);return t.pop(),l.push("L",i),l.join("")}function Da(t){if(t.length<4)return Ca(t);for(var e,n=[],i=-1,r=t.length,a=[0],o=[0];++i<3;)e=t[i],a.push(e[0]),o.push(e[1]);for(n.push($a(Rl,a)+","+$a(Rl,o)),--i;++i<r;)e=t[i],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),Wa(n,a,o);return n.join("")}function Ra(t){for(var e,n,i=-1,r=t.length,a=r+4,o=[],s=[];++i<4;)n=t[i%r],o.push(n[0]),s.push(n[1]);for(e=[$a(Rl,o),",",$a(Rl,s)],--i;++i<a;)n=t[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),Wa(e,o,s);return e.join("")}function za(t,e){var n=t.length-1;if(n)for(var i,r,a=t[0][0],o=t[0][1],s=t[n][0]-a,l=t[n][1]-o,c=-1;++c<=n;)i=t[c],r=c/n,i[0]=e*i[0]+(1-e)*(a+r*s),i[1]=e*i[1]+(1-e)*(o+r*l);return Pa(t)}function $a(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Wa(t,e,n){t.push("C",$a(Pl,e),",",$a(Pl,n),",",$a(Dl,e),",",$a(Dl,n),",",$a(Rl,e),",",$a(Rl,n))}function Ga(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Va(t){for(var e=0,n=t.length-1,i=[],r=t[0],a=t[1],o=i[0]=Ga(r,a);++e<n;)i[e]=(o+(o=Ga(r=a,a=t[e+1])))/2;return i[e]=o,i}function Ha(t){for(var e,n,i,r,a=[],o=Va(t),s=-1,l=t.length-1;++s<l;)e=Ga(t[s],t[s+1]),ko(e)<Wo?o[s]=o[s+1]=0:(n=o[s]/e,i=o[s+1]/e,(r=n*n+i*i)>9&&(r=3*e/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Fa(t){return t.length<3?Ca(t):t[0]+Na(t,Ha(t))}function Ya(t){for(var e,n,i,r=-1,a=t.length;++r<a;)e=t[r],n=e[0],i=e[1]-Yo,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function qa(t){function e(e){function l(){_.push("M",s(t(m),u),d,c(t(g.reverse()),u),"Z")}for(var h,f,p,_=[],g=[],m=[],v=-1,y=e.length,b=Ot(n),w=Ot(r),x=n===i?function(){return f}:Ot(i),k=r===a?function(){return p}:Ot(a);++v<y;)o.call(this,h=e[v],v)?(g.push([f=+b.call(this,h,v),p=+w.call(this,h,v)]),m.push([+x.call(this,h,v),+k.call(this,h,v)])):g.length&&(l(),g=[],m=[]);return g.length&&l(),_.length?_.join(""):null}var n=In,i=In,r=0,a=Pn,o=Ie,s=Ca,l=s.key,c=s,d="L",u=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(r=a=t,e):a},e.y0=function(t){return arguments.length?(r=t,e):r},e.y1=function(t){return arguments.length?(a=t,e):a},e.defined=function(t){return arguments.length?(o=t,e):o},e.interpolate=function(t){return arguments.length?(l="function"==typeof t?s=t:(s=Il.get(t)||Ca).key,c=s.reverse||s,d=s.closed?"M":"L",e):l},e.tension=function(t){return arguments.length?(u=t,e):u},e}function Ua(t){return t.radius}function Ba(t){return[t.x,t.y]}function Xa(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]-Yo;return[n*Math.cos(i),n*Math.sin(i)]}}function Ja(){return 64}function Qa(){return"circle"}function Ka(t){var e=Math.sqrt(t/Vo);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Za(t){return function(){var e,n,i;(e=this[t])&&(i=e[n=e.active])&&(i.timer.c=null,i.timer.t=NaN,--e.count?delete e[n]:delete this[t],e.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function to(t,e,n){return Ao(t,Fl),t.namespace=e,t.id=n,t}function eo(t,e,n,i){var r=t.id,a=t.namespace;return B(t,"function"==typeof n?function(t,o,s){t[a][r].tween.set(e,i(n.call(t,t.__data__,o,s)))}:(n=i(n),function(t){t[a][r].tween.set(e,n)}))}function no(t){return null==t&&(t=""),function(){this.textContent=t}}function io(t){return null==t?"__transition__":"__transition_"+t+"__"}function ro(t,e,n,i,r){function a(t){var e=_.delay;if(c.t=e+l,e<=t)return o(t-e);c.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(t,t.__data__,a.index));for(var o in f)if(+o<i){var p=f[o];p.timer.c=null,p.timer.t=NaN,--f.count,delete f[o]}c.c=s,Dt(function(){return c.c&&s(n||1)&&(c.c=null,c.t=NaN),1},0,l),f.active=i,_.event&&_.event.start.call(t,t.__data__,e),h=[],_.tween.forEach(function(n,i){(i=i.call(t,t.__data__,e))&&h.push(i)}),u=_.ease,d=_.duration}function s(r){for(var a=r/d,o=u(a),s=h.length;s>0;)h[--s].call(t,o);if(a>=1)return _.event&&_.event.end.call(t,t.__data__,e),--f.count?delete f[i]:delete t[n],1}var l,c,d,u,h,f=t[n]||(t[n]={active:0,count:0}),_=f[i];_||(l=r.time,c=Dt(a,0,l),_=f[i]={tween:new p,time:l,timer:c,delay:r.delay,duration:r.duration,ease:r.ease,index:e},r=null,++f.count)}function ao(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate("+(isFinite(i)?i:n(t))+",0)"})}function oo(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate(0,"+(isFinite(i)?i:n(t))+")"})}function so(t){return t.toISOString()}function lo(t,e,n){function i(e){return t(e)}function r(t,n){var i=t[1]-t[0],r=i/n,a=fo.bisect(Zl,r);return a==Zl.length?[e.year,ia(t.map(function(t){return t/31536e6}),n)[2]]:a?e[r/Zl[a-1]<Zl[a]/r?a-1:a]:[nc,ia(t,n)[2]]}return i.invert=function(e){return co(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(co)},i.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,co(+n+1),e).length}var a=i.domain(),o=Br(a),s=null==t?r(o,10):"number"==typeof t&&r(o,t);return s&&(t=s[0],e=s[1]),i.domain(Qr(a,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=co(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=co(+e+1);return e}}:t))},i.ticks=function(t,e){var n=Br(i.domain()),a=null==t?r(n,10):"number"==typeof t?r(n,t):!t.range&&[{range:t},e];return a&&(t=a[0],e=a[1]),t.range(n[0],co(+n[1]+1),e<1?1:e)},i.tickFormat=function(){return n},i.copy=function(){return lo(t.copy(),e,n)},ea(i,t)}function co(t){return new Date(t)}function uo(t){return JSON.parse(t.responseText)}function ho(t){var e=go.createRange();return e.selectNode(go.body),e.createContextualFragment(t.responseText)}var fo={version:"3.5.17"},po=[].slice,_o=function(t){return po.call(t)},go=this.document;if(go)try{_o(go.documentElement.childNodes)[0].nodeType}catch(t){_o=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}if(Date.now||(Date.now=function(){return+new Date}),go)try{go.createElement("DIV").style.setProperty("opacity",0,"")}catch(t){var mo=this.Element.prototype,vo=mo.setAttribute,yo=mo.setAttributeNS,bo=this.CSSStyleDeclaration.prototype,wo=bo.setProperty;mo.setAttribute=function(t,e){vo.call(this,t,e+"")},mo.setAttributeNS=function(t,e,n){yo.call(this,t,e,n+"")},bo.setProperty=function(t,e,n){wo.call(this,t,e+"",n)}}fo.ascending=s,fo.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},fo.min=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&n>i&&(n=i)}return n},fo.max=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&i>n&&(n=i)}return n},fo.extent=function(t,e){var n,i,r,a=-1,o=t.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=t[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=e.call(t,t[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e.call(t,t[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(t,e){var n,i=0,r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=+t[a])&&(i+=n);else for(;++a<r;)c(n=+e.call(t,t[a],a))&&(i+=n);return i},fo.mean=function(t,e){var n,i=0,r=t.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)c(n=l(t[a]))?i+=n:--o;else for(;++a<r;)c(n=l(e.call(t,t[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),r=+t[i-1],a=n-i;return a?r+a*(t[i]-r):r},fo.median=function(t,e){var n,i=[],r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)c(n=l(t[a]))&&i.push(n);else for(;++a<r;)c(n=l(e.call(t,t[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(t,e){var n,i,r=t.length,a=0,o=0,s=-1,d=0;if(1===arguments.length)for(;++s<r;)c(n=l(t[s]))&&(i=n-a,a+=i/++d,o+=i*(n-a));else for(;++s<r;)c(n=l(e.call(t,t[s],s)))&&(i=n-a,a+=i/++d,o+=i*(n-a));if(d>1)return o/(d-1)},fo.deviation=function(){var t=fo.variance.apply(this,arguments);return t?Math.sqrt(t):t};var xo=d(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(t){return d(1===t.length?function(e,n){return s(t(e),n)}:t)},fo.shuffle=function(t,e,n){(a=arguments.length)<3&&(n=t.length,a<2&&(e=0));for(var i,r,a=n-e;a;)r=Math.random()*a--|0,i=t[a+e],t[a+e]=t[r+e],t[r+e]=i;return t},fo.permute=function(t,e){for(var n=e.length,i=new Array(n);n--;)i[n]=t[e[n]];return i},fo.pairs=function(t){for(var e=0,n=t.length-1,i=t[0],r=new Array(n<0?0:n);e<n;)r[e]=[i,i=t[++e]];return r},fo.transpose=function(t){if(!(r=t.length))return[];for(var e=-1,n=fo.min(t,u),i=new Array(n);++e<n;)for(var r,a=-1,o=i[e]=new Array(r);++a<r;)o[a]=t[a][e];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(t){var e=[];for(var n in t)e.push(n);return e},fo.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},fo.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},fo.merge=function(t){for(var e,n,i,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(n=new Array(o);--r>=0;)for(i=t[r],e=i.length;--e>=0;)n[--o]=i[e];return n};var ko=Math.abs;fo.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var i,r=[],a=h(ko(n)),o=-1;if(t*=a,e*=a,n*=a,n<0)for(;(i=t+n*++o)>e;)r.push(i/a);else for(;(i=t+n*++o)<e;)r.push(i/a);return r},fo.map=function(t,e){var n=new p;if(t instanceof p)t.forEach(function(t,e){n.set(t,e)});else if(Array.isArray(t)){var i,r=-1,a=t.length;if(1===arguments.length)for(;++r<a;)n.set(r,t[r]);else for(;++r<a;)n.set(e.call(t,i=t[r],r),i)}else for(var o in t)n.set(o,t[o]);return n};var Mo="__proto__",Co="\0";f(p,{has:m,get:function(t){return this._[_(t)]},set:function(t,e){return this._[_(t)]=e},remove:v,keys:y,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:g(e),value:this._[e]});return t},size:b,empty:w,forEach:function(t){for(var e in this._)t.call(this,g(e),this._[e])}}),fo.nest=function(){function t(e,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,c,d,u,h=-1,f=o.length,_=a[s++],g=new p;++h<f;)(u=g.get(l=_(c=o[h])))?u.push(c):g.set(l,[c]);return e?(c=e(),d=function(n,i){c.set(n,t(e,i,s))}):(c={},d=function(n,i){c[n]=t(e,i,s)}),g.forEach(d),c}function e(t,n){if(n>=a.length)return t;var i=[],r=o[n++];return t.forEach(function(t,r){i.push({key:t,values:e(r,n)})}),r?i.sort(function(t,e){return r(t.key,e.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(e,n){return t(n,e,0)},r.entries=function(n){return e(t(fo.map,n,0),0)},r.key=function(t){return a.push(t),r},r.sortKeys=function(t){return o[a.length-1]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return i=t,r},r},fo.set=function(t){var e=new x;if(t)for(var n=0,i=t.length;n<i;++n)e.add(t[n]);return e},f(x,{has:m,add:function(t){return this._[_(t+="")]=!0,t},remove:v,values:y,size:b,empty:w,forEach:function(t){for(var e in this._)t.call(this,g(e))}}),fo.behavior={},fo.rebind=function(t,e){for(var n,i=1,r=arguments.length;++i<r;)t[n=arguments[i]]=M(t,e,e[n]);return t};var So=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var t=new T,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=A(t);return t},T.prototype.on=function(t,e){var n=t.indexOf("."),i="";if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t)return arguments.length<2?this[t].on(i):this[t].on(i,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(i,null);return this}},fo.event=null,fo.requote=function(t){return t.replace(To,"\\$&")};var To=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Ao={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},jo=function(t,e){return e.querySelector(t)},Eo=function(t,e){return e.querySelectorAll(t)},Oo=function(t,e){var n=t.matches||t[C(t,"matchesSelector")];return(Oo=function(t,e){return n.call(t,e)})(t,e)};"function"==typeof Sizzle&&(jo=function(t,e){return Sizzle(t,e)[0]||null},Eo=Sizzle,Oo=Sizzle.matchesSelector),fo.selection=function(){return fo.select(go.documentElement)};var Lo=fo.selection.prototype=[];Lo.select=function(t){var e,n,i,r,a=[];t=N(t);for(var o=-1,s=this.length;++o<s;){a.push(e=[]),e.parentNode=(i=this[o]).parentNode;for(var l=-1,c=i.length;++l<c;)(r=i[l])?(e.push(n=t.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):e.push(null)}return L(a)},Lo.selectAll=function(t){var e,n,i=[];t=I(t);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(e=_o(t.call(n,n.__data__,s,r))),e.parentNode=n);return L(i)};var No="http://www.w3.org/1999/xhtml",Io={svg:"http://www.w3.org/2000/svg",xhtml:No,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:Io,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),Io.hasOwnProperty(n)?{space:Io[n],local:t}:t}},Lo.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=fo.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(P(e,t[e]));return this}return this.each(P(t,e))},Lo.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),i=(t=z(t)).length,r=-1;if(e=n.classList){for(;++r<i;)if(!e.contains(t[r]))return!1}else for(e=n.getAttribute("class");++r<i;)if(!R(t[r]).test(e))return!1;return!0}for(e in t)this.each($(e,t[e]));return this}return this.each($(t,e))},Lo.style=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e="");for(n in t)this.each(G(n,t[n],e));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(t)}n=""}return this.each(G(t,e,n))},Lo.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(V(e,t[e]));return this}return this.each(V(t,e))},Lo.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},Lo.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},Lo.append=function(t){return t=H(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},Lo.insert=function(t,e){return t=H(t),e=N(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},Lo.remove=function(){return this.each(F)},Lo.data=function(t,e){function n(t,n){var i,r,a,o=t.length,d=n.length,u=Math.min(o,d),h=new Array(d),f=new Array(d),_=new Array(o);if(e){var g,m=new p,v=new Array(o);for(i=-1;++i<o;)(r=t[i])&&(m.has(g=e.call(r,r.__data__,i))?_[i]=r:m.set(g,r),v[i]=g);for(i=-1;++i<d;)(r=m.get(g=e.call(n,a=n[i],i)))?!0!==r&&(h[i]=r,r.__data__=a):f[i]=Y(a),m.set(g,!0);for(i=-1;++i<o;)i in v&&!0!==m.get(v[i])&&(_[i]=t[i])}else{for(i=-1;++i<u;)r=t[i],a=n[i],r?(r.__data__=a,h[i]=r):f[i]=Y(a);for(;i<d;++i)f[i]=Y(n[i]);for(;i<o;++i)_[i]=t[i]}f.update=h,f.parentNode=h.parentNode=_.parentNode=t.parentNode,s.push(f),l.push(h),c.push(_)}var i,r,a=-1,o=this.length;if(!arguments.length){for(t=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(t[a]=r.__data__);return t}var s=X([]),l=L([]),c=L([]);if("function"==typeof t)for(;++a<o;)n(i=this[a],t.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],t);return l.enter=function(){return s},l.exit=function(){return c},l},Lo.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},Lo.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=q(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]),e.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return L(r)},Lo.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Lo.sort=function(t){t=U.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},Lo.each=function(t){return B(this,function(e,n,i){t.call(e,e.__data__,n,i)})},Lo.call=function(t){var e=_o(arguments);return t.apply(e[0]=this,e),this},Lo.empty=function(){return!this.node()},Lo.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Lo.size=function(){var t=0;return B(this,function(){++t}),t};var Po=[];fo.selection.enter=X,fo.selection.enter.prototype=Po,Po.append=Lo.append,Po.empty=Lo.empty,Po.node=Lo.node,Po.call=Lo.call,Po.size=Lo.size,Po.select=function(t){for(var e,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(e=[]),e.parentNode=r.parentNode;for(var c=-1,d=r.length;++c<d;)(a=r[c])?(e.push(i[c]=n=t.call(r.parentNode,a.__data__,c,s)),n.__data__=a.__data__):e.push(null)}return L(o)},Po.insert=function(t,e){return arguments.length<2&&(e=J(this)),Lo.insert.call(this,t,e)},fo.select=function(t){var e;return"string"==typeof t?(e=[jo(t,go)],e.parentNode=go.documentElement):(e=[t],e.parentNode=a(t)),L([e])},fo.selectAll=function(t){var e;return"string"==typeof t?(e=_o(Eo(t,go)),e.parentNode=go.documentElement):(e=_o(t),e.parentNode=null),L([e])},Lo.on=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e=!1);for(n in t)this.each(Q(n,t[n],e));return this}if(i<2)return(i=this.node()["__on"+t])&&i._;n=!1}return this.each(Q(t,e,n))};var Do=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});go&&Do.forEach(function(t){"on"+t in go&&Do.remove(t)});var Ro,zo=0;fo.mouse=function(t){return et(t,E())};var $o=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=E().changedTouches),e)for(var i,r=0,a=e.length;r<a;++r)if((i=e[r]).identifier===n)return et(t,i)},fo.behavior.drag=function(){function t(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function e(t,e,r,a,o){return function(){function s(){var t,n,i=e(h,_);i&&(t=i[0]-y[0],n=i[1]-y[1],p|=t|n,y=i,f({type:"drag",x:i[0]+c[0],y:i[1]+c[1],dx:t,dy:n}))}function l(){e(h,_)&&(m.on(a+g,null).on(o+g,null),v(p),f({type:"dragend"}))}var c,d=this,u=fo.event.target.correspondingElement||fo.event.target,h=d.parentNode,f=n.of(d,arguments),p=0,_=t(),g=".drag"+(null==_?"":"-"+_),m=fo.select(r(u)).on(a+g,s).on(o+g,l),v=tt(u),y=e(h,_);i?(c=i.apply(d,arguments),c=[c.x-y[0],c.y-y[1]]):c=[0,0],f({type:"dragstart"})}}var n=O(t,"drag","dragstart","dragend"),i=null,r=e(S,fo.mouse,o,"mousemove","mouseup"),a=e(nt,fo.touch,k,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},fo.rebind(t,n,"on")},fo.touches=function(t,e){return arguments.length<2&&(e=E().touches),e?_o(e).map(function(e){var n=et(t,e);return n.identifier=e.identifier,n}):[]};var Wo=1e-6,Go=Wo*Wo,Vo=Math.PI,Ho=2*Vo,Fo=Ho-Wo,Yo=Vo/2,qo=Vo/180,Uo=180/Vo,Bo=Math.SQRT2;fo.interpolateZoom=function(t,e){var n,i,r=t[0],a=t[1],o=t[2],s=e[0],l=e[1],c=e[2],d=s-r,u=l-a,h=d*d+u*u;if(h<Go)i=Math.log(c/o)/Bo,n=function(t){return[r+t*d,a+t*u,o*Math.exp(Bo*t*i)]};else{var f=Math.sqrt(h),p=(c*c-o*o+4*h)/(2*o*2*f),_=(c*c-o*o-4*h)/(2*c*2*f),g=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(_*_+1)-_);i=(m-g)/Bo,n=function(t){var e=t*i,n=lt(g),s=o/(2*f)*(n*ct(Bo*e+g)-st(g));return[r+s*d,a+s*u,o*n/lt(Bo*e+g)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function t(t){t.on(E,u).on(Jo+".zoom",f).on("dblclick.zoom",p).on(I,h)}function e(t){return[(t[0]-M.x)/M.k,(t[1]-M.y)/M.k]}function n(t){return[t[0]*M.k+M.x,t[1]*M.k+M.y]}function i(t){M.k=Math.max(S[0],Math.min(S[1],t))}function r(t,e){e=n(e),M.x+=t[0]-e[0],M.y+=t[1]-e[1]}function a(e,n,a,o){e.__chart__={x:M.x,y:M.y,k:M.k},i(Math.pow(2,o)),r(g=n,a),e=fo.select(e),T>0&&(e=e.transition().duration(T)),e.call(t.event)}function s(){w&&w.domain(b.range().map(function(t){return(t-M.x)/M.k}).map(b.invert)),k&&k.domain(x.range().map(function(t){return(t-M.y)/M.k}).map(x.invert))}function l(t){A++||t({type:"zoomstart"})}function c(t){s(),t({type:"zoom",scale:M.k,translate:[M.x,M.y]})}function d(t){--A||(t({type:"zoomend"}),g=null)}function u(){function t(){s=1,r(fo.mouse(i),h),c(a)}function n(){u.on(L,null).on(N,null),f(s),d(a)}var i=this,a=P.of(i,arguments),s=0,u=fo.select(o(i)).on(L,t).on(N,n),h=e(fo.mouse(i)),f=tt(i);Hl.call(i),l(a)}function h(){function t(){var t=fo.touches(p);return f=M.k,t.forEach(function(t){t.identifier in g&&(g[t.identifier]=e(t))}),t}function n(){var e=fo.event.target;fo.select(e).on(b,o).on(w,s),x.push(e);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)g[n[i].identifier]=null;var l=t(),c=Date.now();if(1===l.length){if(c-y<500){var d=l[0];a(p,d,g[d.identifier],Math.floor(Math.log(M.k)/Math.LN2)+1),j()}y=c}else if(l.length>1){var d=l[0],u=l[1],h=d[0]-u[0],f=d[1]-u[1];m=h*h+f*f}}function o(){var t,e,n,a,o=fo.touches(p);Hl.call(p);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=g[n.identifier]){if(e)break;t=n,e=a}if(a){var d=(d=n[0]-t[0])*d+(d=n[1]-t[1])*d,u=m&&Math.sqrt(d/m);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+a[0])/2,(e[1]+a[1])/2],i(u*f)}y=null,r(t,e),c(_)}function s(){if(fo.event.touches.length){for(var e=fo.event.changedTouches,n=0,i=e.length;n<i;++n)delete g[e[n].identifier];for(var r in g)return void t()}fo.selectAll(x).on(v,null),k.on(E,u).on(I,h),C(),d(_)}var f,p=this,_=P.of(p,arguments),g={},m=0,v=".zoom-"+fo.event.changedTouches[0].identifier,b="touchmove"+v,w="touchend"+v,x=[],k=fo.select(p),C=tt(p);n(),l(_),k.on(E,null).on(I,n)}function f(){var t=P.of(this,arguments);v?clearTimeout(v):(Hl.call(this),_=e(g=m||fo.mouse(this)),l(t)),v=setTimeout(function(){v=null,d(t)},50),j(),i(Math.pow(2,.002*Xo())*M.k),r(g,_),c(t)}function p(){var t=fo.mouse(this),n=Math.log(M.k)/Math.LN2;a(this,t,e(t),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var _,g,m,v,y,b,w,x,k,M={x:0,y:0,k:1},C=[960,500],S=Qo,T=250,A=0,E="mousedown.zoom",L="mousemove.zoom",N="mouseup.zoom",I="touchstart.zoom",P=O(t,"zoomstart","zoom","zoomend");return Jo||(Jo="onwheel"in go?(Xo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in go?(Xo=function(){return fo.event.wheelDelta},"mousewheel"):(Xo=function(){return-fo.event.detail},"MozMousePixelScroll")),t.event=function(t){t.each(function(){var t=P.of(this,arguments),e=M;Gl?fo.select(this).transition().each("start.zoom",function(){M=this.__chart__||{x:0,y:0,k:1},l(t)}).tween("zoom:zoom",function(){var n=C[0],i=C[1],r=g?g[0]:n/2,a=g?g[1]:i/2,o=fo.interpolateZoom([(r-M.x)/M.k,(a-M.y)/M.k,n/M.k],[(r-e.x)/e.k,(a-e.y)/e.k,n/e.k]);return function(e){var i=o(e),s=n/i[2];this.__chart__=M={x:r-i[0]*s,y:a-i[1]*s,k:s},c(t)}}).each("interrupt.zoom",function(){d(t)}).each("end.zoom",function(){d(t)}):(this.__chart__=M,l(t),c(t),d(t))})},t.translate=function(e){return arguments.length?(M={x:+e[0],y:+e[1],k:M.k},s(),t):[M.x,M.y]},t.scale=function(e){return arguments.length?(M={x:M.x,y:M.y,k:null},i(+e),s(),t):M.k},t.scaleExtent=function(e){return arguments.length?(S=null==e?Qo:[+e[0],+e[1]],t):S},t.center=function(e){return arguments.length?(m=e&&[+e[0],+e[1]],t):m},t.size=function(e){return arguments.length?(C=e&&[+e[0],+e[1]],t):C},t.duration=function(e){return arguments.length?(T=+e,t):T},t.x=function(e){return arguments.length?(w=e,b=e.copy(),M={x:0,y:0,k:1},t):w},t.y=function(e){return arguments.length?(k=e,x=e.copy(),M={x:0,y:0,k:1},t):k},fo.rebind(t,P,"on")};var Xo,Jo,Qo=[0,1/0];fo.color=ut,ut.prototype.toString=function(){return this.rgb()+""},fo.hsl=ht;var Ko=ht.prototype=new ut;Ko.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new ht(this.h,this.s,this.l/t)},Ko.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new ht(this.h,this.s,t*this.l)},Ko.rgb=function(){return ft(this.h,this.s,this.l)},fo.hcl=pt;var Zo=pt.prototype=new ut;Zo.brighter=function(t){return new pt(this.h,this.c,Math.min(100,this.l+ts*(arguments.length?t:1)))},Zo.darker=function(t){return new pt(this.h,this.c,Math.max(0,this.l-ts*(arguments.length?t:1)))},Zo.rgb=function(){return _t(this.h,this.c,this.l).rgb()},fo.lab=gt;var ts=18,es=.95047,ns=1,is=1.08883,rs=gt.prototype=new ut;rs.brighter=function(t){return new gt(Math.min(100,this.l+ts*(arguments.length?t:1)),this.a,this.b)},rs.darker=function(t){return new gt(Math.max(0,this.l-ts*(arguments.length?t:1)),this.a,this.b)},rs.rgb=function(){return mt(this.l,this.a,this.b)},fo.rgb=xt;var as=xt.prototype=new ut;as.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,r=30;return e||n||i?(e&&e<r&&(e=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xt(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,i/t))):new xt(r,r,r)},as.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new xt(t*this.r,t*this.g,t*this.b)},as.hsl=function(){return Tt(this.r,this.g,this.b)},as.toString=function(){return"#"+Ct(this.r)+Ct(this.g)+Ct(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(t,e){os.set(t,kt(e))}),fo.functor=Ot,fo.xhr=Lt(k),fo.dsv=function(t,e){function n(t,n,a){arguments.length<3&&(a=n,n=null);var o=Nt(t,e,null==n?i:r(n),a);return o.row=function(t){return arguments.length?o.response(null==(n=t)?i:r(t)):n},o}function i(t){return n.parse(t.responseText)}function r(t){return function(e){return n.parse(e.responseText,t)}}function a(e){return e.map(o).join(t)}function o(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),l=t.charCodeAt(0);return n.parse=function(t,e){var i;return n.parseRows(t,function(t,n){if(i)return i(t,n-1);var r=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");i=e?function(t,n){return e(r(t),n)}:r})},n.parseRows=function(t,e){function n(){if(d>=c)return o;if(r)return r=!1,a;var e=d;if(34===t.charCodeAt(e)){for(var n=e;n++<c;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}d=n+2;var i=t.charCodeAt(n+1);return 13===i?(r=!0,10===t.charCodeAt(n+2)&&++d):10===i&&(r=!0),t.slice(e+1,n).replace(/""/g,'"')}for(;d<c;){var i=t.charCodeAt(d++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===t.charCodeAt(d)&&(++d,++s);else if(i!==l)continue;return t.slice(e,d-s)}return t.slice(e)}for(var i,r,a={},o={},s=[],c=t.length,d=0,u=0;(i=n())!==o;){for(var h=[];i!==a&&i!==o;)h.push(i),i=n();e&&null==(h=e(h,u++))||s.push(h)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var i=new x,r=[];return e.forEach(function(t){for(var e in t)i.has(e)||r.push(i.add(e))}),[r.map(o).join(t)].concat(e.map(function(e){return r.map(function(t){return o(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,cs,ds,us=this[C(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};fo.timer=function(){Dt.apply(this,arguments)},fo.timer.flush=function(){zt(),$t()},fo.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var hs=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Gt);fo.formatPrefix=function(t,e){var n=0;return(t=+t)&&(t<0&&(t*=-1),e&&(t=fo.round(t,Wt(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),hs[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ps=fo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=fo.round(t,Wt(t,e))).toFixed(Math.max(0,Math.min(20,Wt(t*(1+1e-15),e))))}}),_s=fo.time={},gs=Date;Ft.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ms.setUTCDate.apply(this._,arguments)},setDay:function(){ms.setUTCDay.apply(this._,arguments)},setFullYear:function(){ms.setUTCFullYear.apply(this._,arguments)},setHours:function(){ms.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ms.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ms.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ms.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ms.setUTCSeconds.apply(this._,arguments)},setTime:function(){ms.setTime.apply(this._,arguments)}};var ms=Date.prototype;_s.year=Yt(function(t){return t=_s.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),_s.years=_s.year.range,_s.years.utc=_s.year.utc.range,_s.day=Yt(function(t){var e=new gs(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),_s.days=_s.day.range,_s.days.utc=_s.day.utc.range,_s.dayOfYear=function(t){var e=_s.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=_s[t]=Yt(function(t){return(t=_s.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=_s.year(t).getDay();return Math.floor((_s.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});_s[t+"s"]=n.range,_s[t+"s"].utc=n.utc.range,_s[t+"OfYear"]=function(t){var n=_s.year(t).getDay();return Math.floor((_s.dayOfYear(t)+(n+e)%7)/7)}}),_s.week=_s.sunday,_s.weeks=_s.sunday.range,_s.weeks.utc=_s.sunday.utc.range,_s.weekOfYear=_s.sundayOfYear;var vs={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,bs=/^%/;fo.locale=function(t){return{numberFormat:Vt(t),timeFormat:Ut(t)}};var ws=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=ws.numberFormat,fo.geo={},pe.prototype={s:0,t:0,add:function(t){_e(t,this.t,xs),_e(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new pe;fo.geo.stream=function(t,e){t&&ks.hasOwnProperty(t.type)?ks[t.type](t,e):ge(t,e)};var ks={Feature:function(t,e){ge(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)ge(n[i].geometry,e)}},Ms={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){me(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)me(n[i],e,0)},Polygon:function(t,e){ve(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ve(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)ge(n[i],e)}};fo.geo.area=function(t){return Cs=0,fo.geo.stream(t,Ts),Cs};var Cs,Ss=new pe,Ts={sphere:function(){Cs+=4*Vo},point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ss.reset(),Ts.lineStart=ye},polygonEnd:function(){var t=2*Ss;Cs+=t<0?4*Vo+t:t,Ts.lineStart=Ts.lineEnd=Ts.point=S}};fo.geo.bounds=function(){function t(t,e){y.push(b=[d=t,h=t]),e<u&&(u=e),e>f&&(f=e)}function e(e,n){var i=be([e*qo,n*qo]);if(m){var r=xe(m,i),a=[r[1],-r[0],0],o=xe(a,r);Ce(o),o=Se(o);var l=e-p,c=l>0?1:-1,_=o[0]*Uo*c,g=ko(l)>180;if(g^(c*p<_&&_<c*e)){var v=o[1]*Uo;v>f&&(f=v)}else if(_=(_+360)%360-180,g^(c*p<_&&_<c*e)){var v=-o[1]*Uo;v<u&&(u=v)}else n<u&&(u=n),n>f&&(f=n);g?e<p?s(d,e)>s(d,h)&&(h=e):s(e,h)>s(d,h)&&(d=e):h>=d?(e<d&&(d=e),e>h&&(h=e)):e>p?s(d,e)>s(d,h)&&(h=e):s(e,h)>s(d,h)&&(d=e)}else t(e,n);m=i,p=e}function n(){w.point=e}function i(){b[0]=d,b[1]=h,w.point=t,m=null}function r(t,n){if(m){var i=t-p;v+=ko(i)>180?i+(i>0?360:-360):i}else _=t,g=n;Ts.point(t,n),e(t,n)}function a(){Ts.lineStart()}function o(){r(_,g),Ts.lineEnd(),ko(v)>Wo&&(d=-(h=180)),b[0]=d,b[1]=h,m=null}function s(t,e){return(e-=t)<0?e+360:e}function l(t,e){return t[0]-e[0]}function c(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var d,u,h,f,p,_,g,m,v,y,b,w={point:t,lineStart:n,lineEnd:i,polygonStart:function(){w.point=r,w.lineStart=a,w.lineEnd=o,v=0,Ts.polygonStart()},polygonEnd:function(){Ts.polygonEnd(),w.point=t,w.lineStart=n,w.lineEnd=i,Ss<0?(d=-(h=180),u=-(f=90)):v>Wo?f=90:v<-Wo&&(u=-90),b[0]=d,b[1]=h}};return function(t){f=h=-(d=u=1/0),y=[],fo.geo.stream(t,w);var e=y.length;if(e){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<e;++i)n=y[i],c(n[0],r)||c(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,p=-1/0,e=a.length-1,i=0,r=a[e];i<=e;r=n,++i)n=a[i],(o=s(r[1],n[0]))>p&&(p=o,d=n[0],h=r[1])}return y=b=null,d===1/0||u===1/0?[[NaN,NaN],[NaN,NaN]]:[[d,u],[h,f]]}}(),fo.geo.centroid=function(t){As=js=Es=Os=Ls=Ns=Is=Ps=Ds=Rs=zs=0,fo.geo.stream(t,$s);var e=Ds,n=Rs,i=zs,r=e*e+n*n+i*i;return r<Go&&(e=Ns,n=Is,i=Ps,js<Wo&&(e=Es,n=Os,i=Ls),(r=e*e+n*n+i*i)<Go)?[NaN,NaN]:[Math.atan2(n,e)*Uo,ot(i/Math.sqrt(r))*Uo]};var As,js,Es,Os,Ls,Ns,Is,Ps,Ds,Rs,zs,$s={sphere:S,point:Ae,lineStart:Ee,lineEnd:Oe,polygonStart:function(){$s.lineStart=Le},polygonEnd:function(){$s.lineStart=Ee}},Ws=ze(Ie,Ve,Fe,[-Vo,-Vo/2]),Gs=1e9;fo.geo.clipExtent=function(){var t,e,n,i,r,a,o={stream:function(t){return r&&(r.valid=!1),r=a(t),r.valid=!0,r},extent:function(s){return arguments.length?(a=Be(t=+s[0][0],e=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[t,e],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return Xe(Je)}).raw=Je,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function t(t){var a=t[0],o=t[1];return e=null,n(a,o),e||(i(a,o),e)||r(a,o),e}var e,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=a.scale(),n=a.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(t)},t.stream=function(t){var e=a.stream(t),n=o.stream(t),i=s.stream(t);return{point:function(t,r){e.point(t,r),n.point(t,r),i.point(t,r)},sphere:function(){e.sphere(),n.sphere(),i.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},t.precision=function(e){return arguments.length?(a.precision(e),o.precision(e),s.precision(e),t):a.precision()},t.scale=function(e){return arguments.length?(a.scale(e),o.scale(.35*e),s.scale(e),t.translate(a.translate())):a.scale()},t.translate=function(e){if(!arguments.length)return a.translate();var c=a.scale(),d=+e[0],u=+e[1];return n=a.translate(e).clipExtent([[d-.455*c,u-.238*c],[d+.455*c,u+.238*c]]).stream(l).point,i=o.translate([d-.307*c,u+.201*c]).clipExtent([[d-.425*c+Wo,u+.12*c+Wo],[d-.214*c-Wo,u+.234*c-Wo]]).stream(l).point,r=s.translate([d-.205*c,u+.212*c]).clipExtent([[d-.214*c+Wo,u+.166*c+Wo],[d-.115*c-Wo,u+.234*c-Wo]]).stream(l).point,t},t.scale(1070)};var Vs,Hs,Fs,Ys,qs,Us,Bs={point:S,lineStart:S,lineEnd:S,polygonStart:function(){Hs=0,Bs.lineStart=Qe},polygonEnd:function(){Bs.lineStart=Bs.lineEnd=Bs.point=S,Vs+=ko(Hs/2)}},Xs={point:Ke,lineStart:S,lineEnd:S,polygonStart:S,polygonEnd:S},Js={point:en,lineStart:nn,lineEnd:rn,polygonStart:function(){Js.lineStart=an},polygonEnd:function(){Js.point=en,Js.lineStart=nn,Js.lineEnd=rn}};fo.geo.path=function(){function t(t){return t&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(t,o)),a.result()}function e(){return o=null,t}var n,i,r,a,o,s=4.5;return t.area=function(t){return Vs=0,fo.geo.stream(t,r(Bs)),Vs},t.centroid=function(t){return Es=Os=Ls=Ns=Is=Ps=Ds=Rs=zs=0,fo.geo.stream(t,r(Js)),zs?[Ds/zs,Rs/zs]:Ps?[Ns/Ps,Is/Ps]:Ls?[Es/Ls,Os/Ls]:[NaN,NaN]},t.bounds=function(t){return qs=Us=-(Fs=Ys=1/0),fo.geo.stream(t,r(Xs)),[[Fs,Ys],[qs,Us]]},t.projection=function(t){return arguments.length?(r=(n=t)?t.stream||ln(t):k,e()):n},t.context=function(t){return arguments.length?(a=null==(i=t)?new Ze:new on(t),"function"!=typeof s&&a.pointRadius(s),e()):i},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(a.pointRadius(+e),+e),t):s},t.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(t){return{stream:function(e){var n=new cn(e);for(var i in t)n[i]=t[i];return n}}},cn.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=un,fo.geo.projectionMutator=hn,(fo.geo.equirectangular=function(){return un(pn)}).raw=pn.invert=pn,fo.geo.rotation=function(t){function e(e){return e=t(e[0]*qo,e[1]*qo),e[0]*=Uo,e[1]*=Uo,e}return t=gn(t[0]%360*qo,t[1]*qo,t.length>2?t[2]*qo:0),e.invert=function(e){return e=t.invert(e[0]*qo,e[1]*qo),e[0]*=Uo,e[1]*=Uo,e},e},_n.invert=pn,fo.geo.circle=function(){function t(){var t="function"==typeof i?i.apply(this,arguments):i,e=gn(-t[0]*qo,-t[1]*qo,0).invert,r=[];return n(null,null,1,{point:function(t,n){r.push(t=e(t,n)),t[0]*=Uo,t[1]*=Uo}}),{type:"Polygon",coordinates:[r]}}var e,n,i=[0,0],r=6;return t.origin=function(e){return arguments.length?(i=e,t):i},t.angle=function(i){return arguments.length?(n=bn((e=+i)*qo,r*qo),t):e},t.precision=function(i){return arguments.length?(n=bn(e*qo,(r=+i)*qo),t):r},t.angle(90)},fo.geo.distance=function(t,e){var n,i=(e[0]-t[0])*qo,r=t[1]*qo,a=e[1]*qo,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);return Math.atan2(Math.sqrt((n=u*o)*n+(n=c*d-l*u*s)*n),l*d+c*u*s)},fo.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return fo.range(Math.ceil(a/g)*g,r,g).map(h).concat(fo.range(Math.ceil(c/m)*m,l,m).map(f)).concat(fo.range(Math.ceil(i/p)*p,n,p).filter(function(t){return ko(t%g)>Wo}).map(d)).concat(fo.range(Math.ceil(s/_)*_,o,_).filter(function(t){return ko(t%m)>Wo}).map(u))}var n,i,r,a,o,s,l,c,d,u,h,f,p=10,_=p,g=90,m=360,v=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[h(a).concat(f(l).slice(1),h(r).reverse().slice(1),f(c).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(a=+e[0][0],r=+e[1][0],c=+e[0][1],l=+e[1][1],a>r&&(e=a,a=r,r=e),c>l&&(e=c,c=l,l=e),t.precision(v)):[[a,c],[r,l]]},t.minorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],i>n&&(e=i,i=n,n=e),s>o&&(e=s,s=o,o=e),t.precision(v)):[[i,s],[n,o]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(g=+e[0],m=+e[1],t):[g,m]},t.minorStep=function(e){return arguments.length?(p=+e[0],_=+e[1],t):[p,_]},t.precision=function(e){return arguments.length?(v=+e,d=xn(s,o,90),u=kn(i,n,v),h=xn(c,l,90),f=kn(a,r,v),t):v},t.majorExtent([[-180,-90+Wo],[180,90-Wo]]).minorExtent([[-180,-80-Wo],[180,80+Wo]])},fo.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||i.apply(this,arguments),n||r.apply(this,arguments)]}}var e,n,i=Mn,r=Cn;return t.distance=function(){return fo.geo.distance(e||i.apply(this,arguments),n||r.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,e="function"==typeof n?null:n,t):i},t.target=function(e){return arguments.length?(r=e,n="function"==typeof e?null:e,t):r},t.precision=function(){return arguments.length?t:0},t},fo.geo.interpolate=function(t,e){return Sn(t[0]*qo,t[1]*qo,e[0]*qo,e[1]*qo)},fo.geo.length=function(t){return Qs=0,fo.geo.stream(t,Ks),Qs};var Qs,Ks={sphere:S,point:S,lineStart:Tn,lineEnd:S,polygonStart:S,polygonEnd:S},Zs=An(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(fo.geo.azimuthalEqualArea=function(){return un(Zs)}).raw=Zs;var tl=An(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},k);(fo.geo.azimuthalEquidistant=function(){return un(tl)}).raw=tl,(fo.geo.conicConformal=function(){return Xe(jn)}).raw=jn,(fo.geo.conicEquidistant=function(){return Xe(En)}).raw=En;var el=An(function(t){return 1/t},Math.atan);(fo.geo.gnomonic=function(){return un(el)}).raw=el,On.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Yo]},(fo.geo.mercator=function(){return Ln(On)}).raw=On;var nl=An(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return un(nl)}).raw=nl;var il=An(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(fo.geo.stereographic=function(){return un(il)}).raw=il,Nn.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Yo]},(fo.geo.transverseMercator=function(){var t=Ln(Nn),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=Nn,fo.geom={},fo.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,r=Ot(n),a=Ot(i),o=t.length,s=[],l=[];for(e=0;e<o;e++)s.push([+r.call(this,t[e],e),+a.call(this,t[e],e),e]);for(s.sort(Rn),e=0;e<o;e++)l.push([s[e][0],-s[e][1]]);var c=Dn(s),d=Dn(l),u=d[0]===c[0],h=d[d.length-1]===c[c.length-1],f=[];for(e=c.length-1;e>=0;--e)f.push(t[s[c[e]][2]]);for(e=+u;e<d.length-h;++e)f.push(t[s[d[e]][2]]);return f}var n=In,i=Pn;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e)},fo.geom.polygon=function(t){return Ao(t,rl),t};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var t,e=-1,n=this.length,i=this[n-1],r=0;++e<n;)t=i,i=this[e],r+=t[1]*i[0]-t[0]*i[1];return.5*r},rl.centroid=function(t){var e,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(t=-1/(6*this.area()));++i<r;)e=s,s=this[i],n=e[0]*s[1]-s[0]*e[1],a+=(e[0]+s[0])*n,o+=(e[1]+s[1])*n;return[a*t,o*t]},rl.clip=function(t){for(var e,n,i,r,a,o,s=Wn(t),l=-1,c=this.length-Wn(this),d=this[c-1];++l<c;){for(e=t.slice(),t.length=0,r=this[l],a=e[(i=e.length-s)-1],n=-1;++n<i;)o=e[n],zn(o,d,r)?(zn(a,d,r)||t.push($n(a,o,d,r)),t.push(o)):zn(a,d,r)&&t.push($n(a,o,d,r)),a=o;s&&t.push(t[0]),d=r}return t};var al,ol,sl,ll,cl,dl=[],ul=[];Bn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Jn),e.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(t,e){var n,i,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=ui(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.R&&(ci(this,n),t=n,n=t.U),n.C=!1,i.C=!0,di(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.L&&(di(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ci(this,i))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,i,r=t.U,a=t.L,o=t.R;if(n=a?o?ui(o):a:o,r?r.L===t?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=t.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=t.U,t=n.R,r.L=t,n.R=o,o.U=n):(n.U=r,r=n,t=n.R)):(i=t.C,t=n),t&&(t.U=r),!i){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===r.L){if(e=r.R,e.C&&(e.C=!1,r.C=!0,ci(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,di(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,ci(this,r),t=this._;break}}else if(e=r.L,e.C&&(e.C=!1,r.C=!0,di(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ci(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,di(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}},fo.geom.voronoi=function(t){function e(t){var e=new Array(t.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return hi(n(t),s).cells.forEach(function(n,s){var l=n.edges,c=n.site;(e[s]=l.length?l.map(function(t){var e=t.start();return[e.x,e.y]}):c.x>=i&&c.x<=a&&c.y>=r&&c.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(a(t,e)/Wo)*Wo,y:Math.round(o(t,e)/Wo)*Wo,i:e}})}var i=In,r=Pn,a=i,o=r,s=hl;return t?e(t):(e.links=function(t){return hi(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return hi(n(t)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Jn),s=-1,l=o.length,c=o[l-1].edge,d=c.l===a?c.r:c.l;++s<l;)c,r=d,c=o[s].edge,d=c.l===a?c.r:c.l,i<r.i&&i<d.i&&pi(a,r,d)<0&&e.push([t[i],t[r.i],t[d.i]])}),e},e.x=function(t){return arguments.length?(a=Ot(i=t),e):i},e.y=function(t){return arguments.length?(o=Ot(r=t),e):r},e.clipExtent=function(t){return arguments.length?(s=null==t?hl:t,e):s===hl?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===hl?null:s&&s[1]},e)};var hl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(t){return fo.geom.voronoi().triangles(t)},fo.geom.quadtree=function(t,e,n,i,r){function a(t){function a(t,e,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(t.leaf){var l=t.x,d=t.y;if(null!=l)if(ko(l-n)+ko(d-i)<.01)c(t,e,n,i,r,a,o,s);else{var u=t.point;t.x=t.y=t.point=null,c(t,u,l,d,r,a,o,s),c(t,e,n,i,r,a,o,s)}else t.x=n,t.y=i,t.point=e}else c(t,e,n,i,r,a,o,s)}function c(t,e,n,i,r,o,s,l){var c=.5*(r+s),d=.5*(o+l),u=n>=c,h=i>=d,f=h<<1|u;t.leaf=!1,t=t.nodes[f]||(t.nodes[f]=mi()),u?r=c:s=c,h?o=d:l=d,a(t,e,n,i,r,o,s,l)}var d,u,h,f,p,_,g,m,v,y=Ot(s),b=Ot(l);if(null!=e)_=e,g=n,m=i,v=r;else if(m=v=-(_=g=1/0),u=[],h=[],p=t.length,o)for(f=0;f<p;++f)d=t[f],d.x<_&&(_=d.x),d.y<g&&(g=d.y),d.x>m&&(m=d.x),d.y>v&&(v=d.y),u.push(d.x),h.push(d.y);else for(f=0;f<p;++f){var w=+y(d=t[f],f),x=+b(d,f);w<_&&(_=w),x<g&&(g=x),w>m&&(m=w),x>v&&(v=x),u.push(w),h.push(x)}var k=m-_,M=v-g;k>M?v=g+k:m=_+M;var C=mi();if(C.add=function(t){a(C,t,+y(t,++f),+b(t,f),_,g,m,v)},C.visit=function(t){vi(t,C,_,g,m,v)},C.find=function(t){return yi(C,t[0],t[1],_,g,m,v)},f=-1,null==e){for(;++f<p;)a(C,t[f],u[f],h[f],_,g,m,v);--f}else t.forEach(C.add);return u=h=t=d=null,C}var o,s=In,l=Pn;return(o=arguments.length)?(s=_i,l=gi,3===o&&(r=n,i=e,n=e=0),a(t)):(a.x=function(t){return arguments.length?(s=t,a):s},a.y=function(t){return arguments.length?(l=t,a):l},a.extent=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),a):null==e?null:[[e,n],[i,r]]},a.size=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=n=0,i=+t[0],r=+t[1]),a):null==e?null:[i-e,r-n]},a)},fo.interpolateRgb=bi,fo.interpolateObject=wi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(fl.source,"g");fo.interpolate=Mi,fo.interpolators=[function(t,e){var n=typeof e;return("string"===n?os.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?bi:ki:e instanceof ut?bi:Array.isArray(e)?Ci:"object"===n&&isNaN(e)?wi:xi)(t,e)}],fo.interpolateArray=Ci;var _l=function(){return k},gl=fo.map({linear:_l,poly:Li,quad:function(){return ji},cubic:function(){return Ei},sin:function(){return Ni},exp:function(){return Ii},circle:function(){return Pi},elastic:Di,back:Ri,bounce:function(){return zi}}),ml=fo.map({in:k,out:Ti,"in-out":Ai,"out-in":function(t){return Ai(Ti(t))}});fo.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.slice(0,e):t,i=e>=0?t.slice(e+1):"in";return n=gl.get(n)||_l,i=ml.get(i)||k,Si(i(n.apply(null,po.call(arguments,1))))},fo.interpolateHcl=$i,fo.interpolateHsl=Wi,fo.interpolateLab=Gi,fo.interpolateRound=Vi,fo.transform=function(t){var e=go.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Hi(n?n.matrix:vl)})(t)},Hi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var vl={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Ki,fo.layout={},fo.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(er(t[n]));return e}},fo.layout.chord=function(){function t(){var t,c,u,h,f,p={},_=[],g=fo.range(a),m=[];for(n=[],i=[],t=0,h=-1;++h<a;){for(c=0,f=-1;++f<a;)c+=r[h][f];_.push(c),m.push(fo.range(a)),t+=c}for(o&&g.sort(function(t,e){return o(_[t],_[e])}),s&&m.forEach(function(t,e){t.sort(function(t,n){return s(r[e][t],r[e][n])})}),t=(Ho-d*a)/t,c=0,h=-1;++h<a;){for(u=c,f=-1;++f<a;){var v=g[h],y=m[v][f],b=r[v][y],w=c,x=c+=b*t;p[v+"-"+y]={index:v,subindex:y,startAngle:w,endAngle:x,value:b}}i[v]={index:v,startAngle:u,endAngle:c,value:_[v]},c+=d}for(h=-1;++h<a;)for(f=h-1;++f<a;){var k=p[h+"-"+f],M=p[f+"-"+h];(k.value||M.value)&&n.push(k.value<M.value?{source:M,target:k}:{source:k,target:M})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,r,a,o,s,l,c={},d=0;return c.matrix=function(t){return arguments.length?(a=(r=t)&&r.length,n=i=null,c):r},c.padding=function(t){return arguments.length?(d=t,n=i=null,c):d},c.sortGroups=function(t){return arguments.length?(o=t,n=i=null,c):o},c.sortSubgroups=function(t){return arguments.length?(s=t,n=null,c):s},c.sortChords=function(t){return arguments.length?(l=t,n&&e(),c):l},c.chords=function(){return n||t(),n},c.groups=function(){return i||t(),i},c},fo.layout.force=function(){function t(t){return function(e,n,i,r){if(e.point!==t){var a=e.cx-t.x,o=e.cy-t.y,s=r-n,l=a*a+o*o;if(s*s/m<l){if(l<_){var c=e.charge/l;t.px-=a*c,t.py-=o*c}return!0}if(e.point&&l&&l<_){var c=e.pointCharge/l;t.px-=a*c,t.py-=o*c}}return!e.charge}}function e(t){t.px=fo.event.x,t.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},c=fo.dispatch("start","tick","end"),d=[1,1],u=.9,h=yl,f=bl,p=-30,_=wl,g=.1,m=.64,v=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,c.end({type:"end",alpha:r=0}),!0;var e,i,l,h,f,_,m,b,w,x=v.length,k=y.length;for(i=0;i<k;++i)l=y[i],h=l.source,f=l.target,b=f.x-h.x,w=f.y-h.y,(_=b*b+w*w)&&(_=r*o[i]*((_=Math.sqrt(_))-a[i])/_,b*=_,w*=_,f.x-=b*(m=h.weight+f.weight?h.weight/(h.weight+f.weight):.5),f.y-=w*m,h.x+=b*(m=1-m),h.y+=w*m);if((m=r*g)&&(b=d[0]/2,w=d[1]/2,i=-1,m))for(;++i<x;)l=v[i],l.x+=(b-l.x)*m,l.y+=(w-l.y)*m;if(p)for(lr(e=fo.geom.quadtree(v),r,s),i=-1;++i<x;)(l=v[i]).fixed||e.visit(t(l));for(i=-1;++i<x;)l=v[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*u,l.y-=(l.py-(l.py=l.y))*u);c.tick({type:"tick",alpha:r})},l.nodes=function(t){return arguments.length?(v=t,l):v},l.links=function(t){return arguments.length?(y=t,l):y},l.size=function(t){return arguments.length?(d=t,l):d},l.linkDistance=function(t){return arguments.length?(h="function"==typeof t?t:+t,l):h},l.distance=l.linkDistance,l.linkStrength=function(t){return arguments.length?(f="function"==typeof t?t:+t,l):f},l.friction=function(t){return arguments.length?(u=+t,l):u},l.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,l):p},l.chargeDistance=function(t){return arguments.length?(_=t*t,l):Math.sqrt(_)},l.gravity=function(t){return arguments.length?(g=+t,l):g},l.theta=function(t){return arguments.length?(m=t*t,l):Math.sqrt(m)},l.alpha=function(t){return arguments.length?(t=+t,r?t>0?r=t:(n.c=null,n.t=NaN,n=null,c.end({type:"end",alpha:r=0})):t>0&&(c.start({type:"start",alpha:r=t}),n=Dt(l.tick)),l):r},l.start=function(){function t(t,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<c;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[e],l=-1,d=s.length;++l<d;)if(!isNaN(o=s[l][t]))return o;return Math.random()*i}var e,n,i,r=v.length,c=y.length,u=d[0],_=d[1];for(e=0;e<r;++e)(i=v[e]).index=e,i.weight=0;for(e=0;e<c;++e)i=y[e],"number"==typeof i.source&&(i.source=v[i.source]),"number"==typeof i.target&&(i.target=v[i.target]),++i.source.weight,++i.target.weight;for(e=0;e<r;++e)i=v[e],isNaN(i.x)&&(i.x=t("x",u)),isNaN(i.y)&&(i.y=t("y",_)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof h)for(e=0;e<c;++e)a[e]=+h.call(this,y[e],e);else for(e=0;e<c;++e)a[e]=h;if(o=[],"function"==typeof f)for(e=0;e<c;++e)o[e]=+f.call(this,y[e],e);else for(e=0;e<c;++e)o[e]=f;if(s=[],"function"==typeof p)for(e=0;e<r;++e)s[e]=+p.call(this,v[e],e);else for(e=0;e<r;++e)s[e]=p;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",e).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,c,"on")};var yl=20,bl=1,wl=1/0;fo.layout.hierarchy=function(){function t(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(c=n.call(t,a,a.depth))&&(l=c.length)){for(var l,c,d;--l>=0;)o.push(d=c[l]),d.parent=a,d.depth=a.depth+1;i&&(a.value=0),a.children=c}else i&&(a.value=+i.call(t,a,a.depth)||0),delete a.children;return ur(r,function(t){var n,r;e&&(n=t.children)&&n.sort(e),i&&(r=t.parent)&&(r.value+=t.value)}),s}var e=pr,n=hr,i=fr;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(i=e,t):i},t.revalue=function(e){return i&&(dr(e,function(t){t.children&&(t.value=0)}),ur(e,function(e){var n;e.children||(e.value=+i.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},fo.layout.partition=function(){function t(e,n,i,r){var a=e.children;if(e.x=n,e.y=e.depth*r,e.dx=i,e.dy=r,a&&(o=a.length)){var o,s,l,c=-1;for(i=e.value?i/e.value:0;++c<o;)t(s=a[c],n,l=s.value*i,r),n+=l}}function e(t){var n=t.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,e(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return t(o[0],0,r[0],r[1]/e(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(t){return arguments.length?(r=t,n):r},cr(n,i)},fo.layout.pie=function(){function t(o){var s,l=o.length,c=o.map(function(n,i){return+e.call(t,n,i)}),d=+("function"==typeof i?i.apply(this,arguments):i),u=("function"==typeof r?r.apply(this,arguments):r)-d,h=Math.min(Math.abs(u)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=h*(u<0?-1:1),p=fo.sum(c),_=p?(u-l*f)/p:0,g=fo.range(l),m=[];return null!=n&&g.sort(n===xl?function(t,e){return c[e]-c[t]}:function(t,e){return n(o[t],o[e])}),g.forEach(function(t){m[t]={data:o[t],value:s=c[t],startAngle:d,endAngle:d+=s*_+f,padAngle:h}}),m}var e=Number,n=xl,i=0,r=Ho,a=0;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(r=e,t):r},t.padAngle=function(e){return arguments.length?(a=e,t):a},t};var xl={};fo.layout.stack=function(){function t(s,l){if(!(h=s.length))return s;var c=s.map(function(n,i){return e.call(t,n,i)}),d=c.map(function(e){return e.map(function(e,n){return[a.call(t,e,n),o.call(t,e,n)]})}),u=n.call(t,d,l);c=fo.permute(c,u),d=fo.permute(d,u);var h,f,p,_,g=i.call(t,d,l),m=c[0].length;for(p=0;p<m;++p)for(r.call(t,c[0][p],_=g[p],d[0][p][1]),f=1;f<h;++f)r.call(t,c[f][p],_+=d[f-1][p][1],d[f][p][1]);return s}var e=k,n=yr,i=br,r=vr,a=gr,o=mr;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:kl.get(e)||yr,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:Ml.get(e)||br,t):i},t.x=function(e){return arguments.length?(a=e,t):a},t.y=function(e){return arguments.length?(o=e,t):o},t.out=function(e){return arguments.length?(r=e,t):r},t};var kl=fo.map({"inside-out":function(t){var e,n,i=t.length,r=t.map(wr),a=t.map(xr),o=fo.range(i).sort(function(t,e){return r[t]-r[e]}),s=0,l=0,c=[],d=[];for(e=0;e<i;++e)n=o[e],s<l?(s+=a[n],c.push(n)):(l+=a[n],d.push(n));return d.reverse().concat(c)},reverse:function(t){return fo.range(t.length).reverse()},default:yr}),Ml=fo.map({silhouette:function(t){var e,n,i,r=t.length,a=t[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(t){var e,n,i,r,a,o,s,l,c,d=t.length,u=t[0],h=u.length,f=[];for(f[0]=l=c=0,n=1;n<h;++n){for(e=0,r=0;e<d;++e)r+=t[e][n][1];for(e=0,a=0,s=u[n][0]-u[n-1][0];e<d;++e){for(i=0,o=(t[e][n][1]-t[e][n-1][1])/(2*s);i<e;++i)o+=(t[i][n][1]-t[i][n-1][1])/s;a+=o*t[e][n][1]}f[n]=l-=r?a/r*s:0,l<c&&(c=l)}for(n=0;n<h;++n)f[n]-=c;return f},expand:function(t){var e,n,i,r=t.length,a=t[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];if(i)for(e=0;e<r;e++)t[e][n][1]/=i;else for(e=0;e<r;e++)t[e][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:br});fo.layout.histogram=function(){function t(t,a){for(var o,s,l=[],c=t.map(n,this),d=i.call(this,c,a),u=r.call(this,d,c,a),a=-1,h=c.length,f=u.length-1,p=e?1:1/h;++a<f;)o=l[a]=[],o.dx=u[a+1]-(o.x=u[a]),o.y=0;if(f>0)for(a=-1;++a<h;)(s=c[a])>=d[0]&&s<=d[1]&&(o=l[fo.bisect(u,s,1,f)-1],o.y+=p,o.push(t[a]));return l}var e=!0,n=Number,i=Sr,r=Mr;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=Ot(e),t):i},t.bins=function(e){return arguments.length?(r="number"==typeof e?function(t){return Cr(t,e)}:Ot(e),t):r},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},fo.layout.pack=function(){function t(t,a){var o=n.call(this,t,a),s=o[0],l=r[0],c=r[1],d=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,ur(s,function(t){t.r=+d(t.value)}),ur(s,Or),i){var u=i*(e?1:Math.max(2*s.r/l,2*s.r/c))/2;ur(s,function(t){t.r+=u}),ur(s,Or),ur(s,function(t){t.r-=u})}return Ir(s,l/2,c/2,e?1:1/Math.max(2*s.r/l,2*s.r/c)),o}var e,n=fo.layout.hierarchy().sort(Tr),i=0,r=[1,1];return t.size=function(e){return arguments.length?(r=e,t):r},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(i=+e,t):i},cr(t,n)},fo.layout.tree=function(){function t(t,r){var d=o.call(this,t,r),u=d[0],h=e(u);if(ur(h,n),h.parent.m=-h.z,dr(h,i),c)dr(u,a);else{var f=u,p=u,_=u;dr(u,function(t){t.x<f.x&&(f=t),t.x>p.x&&(p=t),t.depth>_.depth&&(_=t)});var g=s(f,p)/2-f.x,m=l[0]/(p.x+s(p,f)/2+g),v=l[1]/(_.depth||1);dr(u,function(t){t.x=(t.x+g)*m,t.y=t.depth*v})}return d}function e(t){for(var e,n={A:null,children:[t]},i=[n];null!=(e=i.pop());)for(var r,a=e.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:e,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(e.length){Wr(t);var a=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+s(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+s(t._,i._));t.parent.A=r(t,i,t.parent.A||n[0])}function i(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function r(t,e,n){if(e){for(var i,r=t,a=t,o=e,l=r.parent.children[0],c=r.m,d=a.m,u=o.m,h=l.m;o=zr(o),r=Rr(r),o&&r;)l=Rr(l),a=zr(a),a.a=t,i=o.z+u-r.z-c+s(o._,r._),i>0&&($r(Gr(o,t,n),t,i),c+=i,d+=i),u+=o.m,c+=r.m,h+=l.m,d+=a.m;o&&!zr(a)&&(a.t=o,a.m+=u-d),r&&!Rr(l)&&(l.t=r,l.m+=c-h,n=t)}return n}function a(t){t.x*=l[0],t.y=t.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=Dr,l=[1,1],c=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(c=null==(l=e)?a:null,t):c?null:l},t.nodeSize=function(e){return arguments.length?(c=null==(l=e)?null:a,t):c?l:null},cr(t,o)},fo.layout.cluster=function(){function t(t,a){var o,s=e.call(this,t,a),l=s[0],c=0;ur(l,function(t){var e=t.children;e&&e.length?(t.x=Hr(e),t.y=Vr(e)):(t.x=o?c+=n(t,o):0,t.y=0,o=t)});var d=Fr(l),u=Yr(l),h=d.x-n(d,u)/2,f=u.x+n(u,d)/2;return ur(l,r?function(t){t.x=(t.x-l.x)*i[0],t.y=(l.y-t.y)*i[1]}:function(t){t.x=(t.x-h)/(f-h)*i[0],t.y=(1-(l.y?t.y/l.y:1))*i[1]}),s}var e=fo.layout.hierarchy().sort(null).value(null),n=Dr,i=[1,1],r=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(r=null==(i=e),t):r?null:i},t.nodeSize=function(e){return arguments.length?(r=null!=(i=e),t):r?i:null},cr(t,e)},fo.layout.treemap=function(){function t(t,e){for(var n,i,r=-1,a=t.length;++r<a;)i=(n=t[r]).value*(e<0?0:e),n.area=isNaN(i)||i<=0?0:i}function e(n){var a=n.children;if(a&&a.length){var o,s,l,c=u(n),d=[],h=a.slice(),p=1/0,_="slice"===f?c.dx:"dice"===f?c.dy:"slice-dice"===f?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(t(h,c.dx*c.dy/n.value),d.area=0;(l=h.length)>0;)d.push(o=h[l-1]),d.area+=o.area,"squarify"!==f||(s=i(d,_))<=p?(h.pop(),p=s):(d.area-=d.pop().area,r(d,_,c,!1),_=Math.min(c.dx,c.dy),d.length=d.area=0,p=1/0);d.length&&(r(d,_,c,!0),d.length=d.area=0),a.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var a,o=u(e),s=i.slice(),l=[];for(t(s,o.dx*o.dy/e.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,r=0,a=1/0,o=-1,s=t.length;++o<s;)(n=t[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,e*=e,i?Math.max(e*r*p/i,i/(e*a*p)):1/0}function r(t,e,n,i){var r,a=-1,o=t.length,s=n.x,c=n.y,d=e?l(t.area/e):0;if(e==n.dx){for((i||d>n.dy)&&(d=n.dy);++a<o;)r=t[a],r.x=s,r.y=c,r.dy=d,s+=r.dx=Math.min(n.x+n.dx-s,d?l(r.area/d):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=d,n.dy-=d}else{for((i||d>n.dx)&&(d=n.dx);++a<o;)r=t[a],r.x=s,r.y=c,r.dx=d,c+=r.dy=Math.min(n.y+n.dy-c,d?l(r.area/d):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=d,n.dx-=d}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=c[0],a.dy=c[1]):a.dx=a.dy=0,o&&s.revalue(a),t([a],a.dx*a.dy/a.value),(o?n:e)(a),h&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,c=[1,1],d=null,u=qr,h=!1,f="squarify",p=.5*(1+Math.sqrt(5));return a.size=function(t){return arguments.length?(c=t,a):c},a.padding=function(t){function e(e){var n=t.call(a,e,e.depth);return null==n?qr(e):Ur(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Ur(e,t)}if(!arguments.length)return d;var i;return u=null==(d=t)?qr:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,a},a.round=function(t){return arguments.length?(l=t?Math.round:Number,a):l!=Number},a.sticky=function(t){return arguments.length?(h=t,o=null,a):h},a.ratio=function(t){return arguments.length?(p=t,a):p},a.mode=function(t){return arguments.length?(f=t+"",a):f},cr(a,s)},fo.random={normal:function(t,e){var n=arguments.length;return n<2&&(e=1),n<1&&(t=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return t+e*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var t=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=fo.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;n<t;n++)e+=Math.random();return e}}},fo.scale={};var Cl={floor:k,ceil:k};fo.scale.linear=function(){return ta([0,1],[0,1],Mi,!1)};var Sl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Tl=fo.format(".0e"),Al={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};fo.scale.pow=function(){return ca(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ua([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(jl)},fo.scale.category20=function(){return fo.scale.ordinal().range(El)},fo.scale.category20b=function(){return fo.scale.ordinal().range(Ol)},fo.scale.category20c=function(){return fo.scale.ordinal().range(Ll)};var jl=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Mt),El=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Mt),Ol=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Mt),Ll=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Mt);fo.scale.quantile=function(){return ha([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return pa([.5],[0,1])},fo.scale.identity=function(){return _a([0,1])},fo.svg={},fo.svg.arc=function(){function t(){var t=Math.max(0,+n.apply(this,arguments)),c=Math.max(0,+i.apply(this,arguments)),d=o.apply(this,arguments)-Yo,u=s.apply(this,arguments)-Yo,h=Math.abs(u-d),f=d>u?0:1;if(c<t&&(p=c,c=t,t=p),h>=Fo)return e(c,f)+(t?e(t,1-f):"")+"Z";var p,_,g,m,v,y,b,w,x,k,M,C,S=0,T=0,A=[];if((m=(+l.apply(this,arguments)||0)/2)&&(g=a===Nl?Math.sqrt(t*t+c*c):+a.apply(this,arguments),f||(T*=-1),c&&(T=ot(g/c*Math.sin(m))),t&&(S=ot(g/t*Math.sin(m)))),c){v=c*Math.cos(d+T),y=c*Math.sin(d+T),b=c*Math.cos(u-T),w=c*Math.sin(u-T);var j=Math.abs(u-d-2*T)<=Vo?0:1;if(T&&xa(v,y,b,w)===f^j){var E=(d+u)/2;v=c*Math.cos(E),y=c*Math.sin(E),b=w=null}}else v=y=0;if(t){x=t*Math.cos(u-S),k=t*Math.sin(u-S),M=t*Math.cos(d+S),C=t*Math.sin(d+S);var O=Math.abs(d-u+2*S)<=Vo?0:1;if(S&&xa(x,k,M,C)===1-f^O){var L=(d+u)/2;x=t*Math.cos(L),k=t*Math.sin(L),M=C=null}}else x=k=0;if(h>Wo&&(p=Math.min(Math.abs(c-t)/2,+r.apply(this,arguments)))>.001){_=t<c^f?0:1;var N=p,I=p;if(h<Vo){var P=null==M?[x,k]:null==b?[v,y]:$n([v,y],[M,C],[b,w],[x,k]),D=v-P[0],R=y-P[1],z=b-P[0],$=w-P[1],W=1/Math.sin(Math.acos((D*z+R*$)/(Math.sqrt(D*D+R*R)*Math.sqrt(z*z+$*$)))/2),G=Math.sqrt(P[0]*P[0]+P[1]*P[1]);I=Math.min(p,(t-G)/(W-1)),N=Math.min(p,(c-G)/(W+1))}if(null!=b){var V=ka(null==M?[x,k]:[M,C],[v,y],c,N,f),H=ka([b,w],[x,k],c,N,f);p===N?A.push("M",V[0],"A",N,",",N," 0 0,",_," ",V[1],"A",c,",",c," 0 ",1-f^xa(V[1][0],V[1][1],H[1][0],H[1][1]),",",f," ",H[1],"A",N,",",N," 0 0,",_," ",H[0]):A.push("M",V[0],"A",N,",",N," 0 1,",_," ",H[0])}else A.push("M",v,",",y);if(null!=M){var F=ka([v,y],[M,C],t,-I,f),Y=ka([x,k],null==b?[v,y]:[b,w],t,-I,f);p===I?A.push("L",Y[0],"A",I,",",I," 0 0,",_," ",Y[1],"A",t,",",t," 0 ",f^xa(Y[1][0],Y[1][1],F[1][0],F[1][1]),",",1-f," ",F[1],"A",I,",",I," 0 0,",_," ",F[0]):A.push("L",Y[0],"A",I,",",I," 0 0,",_," ",F[0])}else A.push("L",x,",",k)}else A.push("M",v,",",y),null!=b&&A.push("A",c,",",c," 0 ",j,",",f," ",b,",",w),A.push("L",x,",",k),null!=M&&A.push("A",t,",",t," 0 ",O,",",1-f," ",M,",",C);return A.push("Z"),A.join("")}function e(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}var n=ma,i=va,r=ga,a=Nl,o=ya,s=ba,l=wa;return t.innerRadius=function(e){return arguments.length?(n=Ot(e),t):n},t.outerRadius=function(e){return arguments.length?(i=Ot(e),t):i},t.cornerRadius=function(e){return arguments.length?(r=Ot(e),t):r},t.padRadius=function(e){return arguments.length?(a=e==Nl?Nl:Ot(e),t):a},t.startAngle=function(e){return arguments.length?(o=Ot(e),t):o},t.endAngle=function(e){return arguments.length?(s=Ot(e),t):s},t.padAngle=function(e){return arguments.length?(l=Ot(e),t):l},t.centroid=function(){var t=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,e=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Yo;return[Math.cos(e)*t,Math.sin(e)*t]},t};var Nl="auto";fo.svg.line=function(){return Ma(k)};var Il=fo.map({linear:Ca,"linear-closed":Sa,step:Ta,"step-before":Aa,"step-after":ja,basis:Pa,"basis-open":Da,"basis-closed":Ra,bundle:za,cardinal:La,"cardinal-open":Ea,"cardinal-closed":Oa,monotone:Fa});Il.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Pl=[0,2/3,1/3,0],Dl=[0,1/3,2/3,0],Rl=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var t=Ma(Ya);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},Aa.reverse=ja,ja.reverse=Aa,fo.svg.area=function(){return qa(k)},fo.svg.area.radial=function(){var t=qa(Ya);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},fo.svg.chord=function(){function t(t,s){var l=e(this,a,t,s),c=e(this,o,t,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var r=e.call(t,n,i),a=s.call(t,r,i),o=l.call(t,r,i)-Yo,d=c.call(t,r,i)-Yo;return{r:a,a0:o,a1:d,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(d),a*Math.sin(d)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Vo)+",1 "+e}function r(t,e,n,i){return"Q 0,0 "+i}var a=Mn,o=Cn,s=Ua,l=ya,c=ba;return t.radius=function(e){return arguments.length?(s=Ot(e),t):s},t.source=function(e){return arguments.length?(a=Ot(e),t):a},t.target=function(e){return arguments.length?(o=Ot(e),t):o},t.startAngle=function(e){return arguments.length?(l=Ot(e),t):l},t.endAngle=function(e){return arguments.length?(c=Ot(e),t):c},t},fo.svg.diagonal=function(){function t(t,r){var a=e.call(this,t,r),o=n.call(this,t,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=Mn,n=Cn,i=Ba;return t.source=function(n){return arguments.length?(e=Ot(n),t):e},t.target=function(e){return arguments.length?(n=Ot(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},fo.svg.diagonal.radial=function(){var t=fo.svg.diagonal(),e=Ba,n=t.projection;return t.projection=function(t){return arguments.length?n(Xa(e=t)):e},t},fo.svg.symbol=function(){function t(t,i){return(zl.get(e.call(this,t,i))||Ka)(n.call(this,t,i))}var e=Qa,n=Ja;return t.type=function(n){return arguments.length?(e=Ot(n),t):e},t.size=function(e){return arguments.length?(n=Ot(e),t):n},t};var zl=fo.map({circle:Ka,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Wl)),n=e*Wl;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/$l),n=e*$l/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/$l),n=e*$l/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});fo.svg.symbolTypes=zl.keys();var $l=Math.sqrt(3),Wl=Math.tan(30*qo);Lo.transition=function(t){for(var e,n,i=Gl||++Yl,r=io(t),a=[],o=Vl||{time:Date.now(),ease:Oi,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(e=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(n=c[d])&&ro(n,d,r,i,o),e.push(n)}return to(a,r,i)},Lo.interrupt=function(t){return this.each(null==t?Hl:Za(io(t)))};var Gl,Vl,Hl=Za(io()),Fl=[],Yl=0;Fl.call=Lo.call,Fl.empty=Lo.empty,Fl.node=Lo.node,Fl.size=Lo.size,fo.transition=function(t,e){return t&&t.transition?Gl?t.transition(e):t:fo.selection().transition(t)},fo.transition.prototype=Fl,Fl.select=function(t){var e,n,i,r=this.id,a=this.namespace,o=[];t=N(t);for(var s=-1,l=this.length;++s<l;){o.push(e=[]);for(var c=this[s],d=-1,u=c.length;++d<u;)(i=c[d])&&(n=t.call(i,i.__data__,d,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,d,a,r,i[a][r]),e.push(n)):e.push(null)}return to(o,a,r)},Fl.selectAll=function(t){var e,n,i,r,a,o=this.id,s=this.namespace,l=[];t=I(t);for(var c=-1,d=this.length;++c<d;)for(var u=this[c],h=-1,f=u.length;++h<f;)if(i=u[h]){a=i[s][o],n=t.call(i,i.__data__,h,c),l.push(e=[]);for(var p=-1,_=n.length;++p<_;)(r=n[p])&&ro(r,p,s,o,a),e.push(r)}return to(l,s,o)},Fl.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=q(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return to(r,this.namespace,this.id)},Fl.tween=function(t,e){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(t):B(this,null==e?function(e){e[i][n].tween.remove(t)}:function(r){r[i][n].tween.set(t,e)})},Fl.attr=function(t,e){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=o(n,t),function(t){this.setAttribute(s,e(t))})})}function a(t){return null==t?i:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=o(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var o="transform"==t?Ki:Mi,s=fo.ns.qualify(t);return eo(this,"attr."+t,e,s.local?a:r)},Fl.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(r));return i&&function(t){this.setAttribute(r,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(r.space,r.local));return i&&function(t){this.setAttributeNS(r.space,r.local,i(t))}}var r=fo.ns.qualify(t);return this.tween("attr."+t,r.local?i:n)},Fl.style=function(t,e,n){function i(){this.style.removeProperty(t)}function r(e){return null==e?i:(e+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(t);return r!==e&&(i=Mi(r,e),function(e){this.style.setProperty(t,i(e),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof t){a<2&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return eo(this,"style."+t,e,r)},Fl.styleTween=function(t,e,n){function i(i,r){var a=e.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(t));return a&&function(e){this.style.setProperty(t,a(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,i)},Fl.text=function(t){return eo(this,"text",t,no)},Fl.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},Fl.ease=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].ease:("function"!=typeof t&&(t=fo.ease.apply(fo,arguments)),B(this,function(i){i[n][e].ease=t}))},Fl.delay=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].delay:B(this,"function"==typeof t?function(i,r,a){i[n][e].delay=+t.call(i,i.__data__,r,a)}:(t=+t,function(i){i[n][e].delay=t}))},Fl.duration=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].duration:B(this,"function"==typeof t?function(i,r,a){i[n][e].duration=Math.max(1,t.call(i,i.__data__,r,a))}:(t=Math.max(1,t),function(i){i[n][e].duration=t}))},Fl.each=function(t,e){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Vl,a=Gl;try{Gl=n,B(this,function(e,r,a){Vl=e[i][n],t.call(e,e.__data__,r,a)})}finally{Vl=r,Gl=a}}else B(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(t,e)});return this},Fl.transition=function(){for(var t,e,n,i,r=this.id,a=++Yl,o=this.namespace,s=[],l=0,c=this.length;l<c;l++){s.push(t=[]);for(var e=this[l],d=0,u=e.length;d<u;d++)(n=e[d])&&(i=n[o][r],ro(n,d,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),t.push(n)}return to(s,o,a)},fo.svg.axis=function(){function t(t){t.each(function(){var t,c=fo.select(this),d=this.__chart__||n,u=this.__chart__=n.copy(),h=null==l?u.ticks?u.ticks.apply(u,s):u.domain():l,f=null==e?u.tickFormat?u.tickFormat.apply(u,s):k:e,p=c.selectAll(".tick").data(h,u),_=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Wo),g=fo.transition(p.exit()).style("opacity",Wo).remove(),m=fo.transition(p.order()).style("opacity",1),v=Math.max(r,0)+o,y=Xr(u),b=c.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),fo.transition(b));_.append("line"),_.append("text");var x,M,C,S,T=_.select("line"),A=m.select("line"),j=p.select("text").text(f),E=_.select("text"),O=m.select("text"),L="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(t=ao,x="x",C="y",M="x2",S="y2",j.attr("dy",L<0?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+L*a+"V0H"+y[1]+"V"+L*a)):(t=oo,x="y",C="x",M="y2",S="x2",j.attr("dy",".32em").style("text-anchor",L<0?"end":"start"),w.attr("d","M"+L*a+","+y[0]+"H0V"+y[1]+"H"+L*a)),T.attr(S,L*r),E.attr(C,L*v),A.attr(M,0).attr(S,L*r),O.attr(x,0).attr(C,L*v),u.rangeBand){var N=u,I=N.rangeBand()/2;d=u=function(t){return N(t)+I}}else d.rangeBand?d=u:g.call(t,u,d);_.call(t,d,u),m.call(t,u,u)})}var e,n=fo.scale.linear(),i=ql,r=6,a=6,o=3,s=[10],l=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e in Ul?e+"":ql,t):i},t.ticks=function(){return arguments.length?(s=_o(arguments),t):s},t.tickValues=function(e){return arguments.length?(l=e,t):l},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(r=+e,a=+arguments[n-1],t):r},t.innerTickSize=function(e){return arguments.length?(r=+e,t):r},t.outerTickSize=function(e){return arguments.length?(a=+e,t):a},t.tickPadding=function(e){return arguments.length?(o=+e,t):o},t.tickSubdivide=function(){return arguments.length&&t},t};var ql="bottom",Ul={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function t(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(_,k);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Bl[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var l,u=fo.transition(a),h=fo.transition(o);c&&(l=Xr(c),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(u)),d&&(l=Xr(d),h.attr("y",l[0]).attr("height",l[1]-l[0]),i(u)),e(u)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+u[+/e$/.test(t)]+","+h[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",u[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1]-u[0])}function i(t){t.select(".extent").attr("y",h[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function r(){function r(){32==fo.event.keyCode&&(A||(y=null,O[0]-=u[1],O[1]-=h[1],A=2),j())}function _(){32==fo.event.keyCode&&2==A&&(O[0]+=u[1],O[1]+=h[1],A=0,j())}function g(){var t=fo.mouse(w),r=!1;b&&(t[0]+=b[0],t[1]+=b[1]),A||(fo.event.altKey?(y||(y=[(u[0]+u[1])/2,(h[0]+h[1])/2]),O[0]=u[+(t[0]<y[0])],O[1]=h[+(t[1]<y[1])]):y=null),S&&m(t,c,0)&&(n(M),r=!0),T&&m(t,d,1)&&(i(M),r=!0),r&&(e(M),k({type:"brush",mode:A?"move":"resize"}))}function m(t,e,n){var i,r,o=Xr(e),l=o[0],c=o[1],d=O[n],_=n?h:u,g=_[1]-_[0];if(A&&(l-=d,c-=g+d),i=(n?p:f)?Math.max(l,Math.min(c,t[n])):t[n],A?r=(i+=d)+g:(y&&(d=Math.max(l,Math.min(c,2*y[n]-i))),d<i?(r=i,i=d):r=d),_[0]!=i||_[1]!=r)return n?s=null:a=null,_[0]=i,_[1]=r,!0}function v(){g(),M.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),fo.select("body").style("cursor",null),L.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),E(),k({type:"brushend"})}var y,b,w=this,x=fo.select(fo.event.target),k=l.of(w,arguments),M=fo.select(w),C=x.datum(),S=!/^(n|s)$/.test(C)&&c,T=!/^(e|w)$/.test(C)&&d,A=x.classed("extent"),E=tt(w),O=fo.mouse(w),L=fo.select(o(w)).on("keydown.brush",r).on("keyup.brush",_);if(fo.event.changedTouches?L.on("touchmove.brush",g).on("touchend.brush",v):L.on("mousemove.brush",g).on("mouseup.brush",v),M.interrupt().selectAll("*").interrupt(),A)O[0]=u[0]-O[0],O[1]=h[0]-O[1];else if(C){var N=+/w$/.test(C),I=+/^n/.test(C);b=[u[1-N]-O[0],h[1-I]-O[1]],O[0]=u[N],O[1]=h[I]}else fo.event.altKey&&(y=O.slice());M.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),g()}var a,s,l=O(t,"brushstart","brush","brushend"),c=null,d=null,u=[0,0],h=[0,0],f=!0,p=!0,_=Xl[0];return t.event=function(t){t.each(function(){var t=l.of(this,arguments),e={x:u,y:h,i:a,j:s},n=this.__chart__||e;this.__chart__=e,Gl?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,u=n.x,h=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=Ci(u,e.x),i=Ci(h,e.y);return a=s=null,function(r){u=e.x=n(r),h=e.y=i(r),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=e.i,s=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(c=e,_=Xl[!c<<1|!d],t):c},t.y=function(e){return arguments.length?(d=e,_=Xl[!c<<1|!d],t):d},t.clamp=function(e){return arguments.length?(c&&d?(f=!!e[0],p=!!e[1]):c?f=!!e:d&&(p=!!e),t):c&&d?[f,p]:c?f:d?p:null},t.extent=function(e){var n,i,r,o,l;return arguments.length?(c&&(n=e[0],i=e[1],d&&(n=n[0],i=i[0]),a=[n,i],c.invert&&(n=c(n),i=c(i)),i<n&&(l=n,n=i,i=l),n==u[0]&&i==u[1]||(u=[n,i])),d&&(r=e[0],o=e[1],c&&(r=r[1],o=o[1]),s=[r,o],d.invert&&(r=d(r),o=d(o)),o<r&&(l=r,r=o,o=l),r==h[0]&&o==h[1]||(h=[r,o])),t):(c&&(a?(n=a[0],i=a[1]):(n=u[0],i=u[1],c.invert&&(n=c.invert(n),i=c.invert(i)),i<n&&(l=n,n=i,i=l))),d&&(s?(r=s[0],o=s[1]):(r=h[0],o=h[1],d.invert&&(r=d.invert(r),o=d.invert(o)),o<r&&(l=r,r=o,o=l))),c&&d?[[n,r],[i,o]]:c?[n,i]:d&&[r,o])},t.clear=function(){return t.empty()||(u=[0,0],h=[0,0],a=s=null),t},t.empty=function(){return!!c&&u[0]==u[1]||!!d&&h[0]==h[1]},fo.rebind(t,l,"on")};var Bl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Xl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Jl=_s.format=ws.timeFormat,Ql=Jl.utc,Kl=Ql("%Y-%m-%dT%H:%M:%S.%LZ");Jl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Kl,so.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},so.toString=Kl.toString,_s.second=Yt(function(t){return new gs(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),_s.seconds=_s.second.range,_s.seconds.utc=_s.second.utc.range,_s.minute=Yt(function(t){return new gs(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),_s.minutes=_s.minute.range,_s.minutes.utc=_s.minute.utc.range,_s.hour=Yt(function(t){var e=t.getTimezoneOffset()/60;return new gs(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),_s.hours=_s.hour.range,_s.hours.utc=_s.hour.utc.range,_s.month=Yt(function(t){return t=_s.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),_s.months=_s.month.range,_s.months.utc=_s.month.utc.range;var Zl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],tc=[[_s.second,1],[_s.second,5],[_s.second,15],[_s.second,30],[_s.minute,1],[_s.minute,5],[_s.minute,15],[_s.minute,30],[_s.hour,1],[_s.hour,3],[_s.hour,6],[_s.hour,12],[_s.day,1],[_s.day,2],[_s.week,1],[_s.month,1],[_s.month,3],[_s.year,1]],ec=Jl.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Ie]]),nc={range:function(t,e,n){return fo.range(Math.ceil(t/n)*n,+e,n).map(co)},floor:k,ceil:k};tc.year=_s.year,_s.scale=function(){return lo(fo.scale.linear(),tc,ec)};var ic=tc.map(function(t){return[t[0].utc,t[1]]}),rc=Ql.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Ie]]);ic.year=_s.year.utc,_s.scale.utc=function(){return lo(fo.scale.linear(),ic,rc)},fo.text=Lt(function(t){return t.responseText}),fo.json=function(t,e){return Nt(t,"application/json",uo,e)},fo.html=function(t,e){return Nt(t,"text/html",ho,e)},fo.xml=Lt(function(t){return t.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(e,n,e,t):i)&&(t.exports=r)}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";(function(t){function n(t,e){this.canvas=null,this.dragging=!1,this.inner_color="#FFFFFF",this.outer_color="#D8B365",t&&e&&this.connect(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),t.extend(n.prototype,{connect:function(t,e){this.handle1=t,this.handle1&&this.handle1.connect(this),this.handle2=e,this.handle2&&this.handle2.connect(this)},destroy:function(){this.handle1&&this.handle1.disconnect(this),this.handle2&&this.handle2.disconnect(this),t(this.canvas).remove()},destroyIfInvalid:function(){this.handle1&&this.handle2&&!this.handle2.attachable(this.handle1)&&this.destroy()},redraw:function(){var e=this.handle1,n=this.handle2,i=e&&e.isMappedOver(),r=n&&n.isMappedOver(),a=(i?"start-ribbon":"")+" "+(r?"end-ribbon":""),o=t("#canvas-container");this.canvas||(this.canvas=document.createElement("canvas"),o.append(t(this.canvas)),this.dragging&&(this.canvas.style.zIndex="300")),this.canvas.setAttribute("handle1-id",e&&e.element.getAttribute?e.element.getAttribute("id"):""),this.canvas.setAttribute("handle2-id",n&&n.element.getAttribute?n.element.getAttribute("id"):"");var s=function(e){return t(e).offset().left-o.offset().left},l=function(e){return t(e).offset().top-o.offset().top};if(e&&n){var c=s(e.element)+5,d=l(e.element)+5,u=s(n.element)+5,h=l(n.element)+5,f=Math.min(c,u),p=Math.max(c,u),_=Math.min(d,h),g=Math.max(d,h),m=Math.min(Math.max(Math.abs(g-_)/2,100),300),v=f-100,y=_-100,b=p-f+200,w=g-_+200;this.canvas.style.left=v+"px",this.canvas.style.top=y+"px",this.canvas.setAttribute("width",b),this.canvas.setAttribute("height",w),this.canvas.setAttribute("class",a),c-=v,d-=y,u-=v,h-=y;var x=(this.canvas.getContext("2d"),null),k=null,M=1;if(i){var x=[-6,-3,0,3,6];M=5}else var x=[0];if(r){var k=[-6,-3,0,3,6];M=5}else var k=[0];for(var C=this,S=0;S<M;S++){var T=5,A=7;(x.length>1||k.length>1)&&(T=1,A=3),C.draw_outlined_curve(c,d,u,h,m,T,A,x[S%x.length],k[S%k.length])}}},draw_outlined_curve:function(t,e,n,i,r,a,o,s,l){var s=s||0,l=l||0,c=this.canvas.getContext("2d");c.lineCap="round",c.strokeStyle=this.outer_color,c.lineWidth=o,c.beginPath(),c.moveTo(t,e+s),c.bezierCurveTo(t+r,e+s,n-r,i+l,n,i+l),c.stroke(),c.strokeStyle=this.inner_color,c.lineWidth=a,c.beginPath(),c.moveTo(t,e+s),c.bezierCurveTo(t+r,e+s,n-r,i+l,n,i+l),c.stroke()}}),e.default=n}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=o(s),c=n(20),d=o(c),u=n(59),h=o(u),f=n(5),p=o(f),_=n(39),g=o(_),m=t.View.extend({el:"#center",model:null,options:{},defaults:{edit_mode:!1},events:{"click .toolbtn_modify_dataset":"enableModification","click .toolbtn_cancel_modifications":"render","click .toolbtn-download-dataset":"downloadDataset","click .toolbtn-import-dataset":"importIntoHistory","click .copy-link-to-clipboard":"copyToClipboard","click .make-private":"makeDatasetPrivate","click .remove-restrictions":"removeDatasetRestrictions","click .toolbtn_save_permissions":"savePermissions","click .toolbtn_save_modifications":"saveModifications"},select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(t){this.options=i.extend(this.options,t),this.fetchExtAndGenomes(),this.options.id&&this.fetchDataset()},fetchDataset:function(t){this.options=i.extend(this.options,t),this.model=new h.default.Item({id:this.options.id});var e=this;this.model.fetch({success:function(){e.options.show_permissions?e.showPermissions():e.options.show_version?e.fetchVersion():e.render()},error:function(t,e){void 0!==e.responseJSON?d.default.error(e.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):d.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},render:function(t){this.options=i.extend(this.options,t),r(".tooltip").remove();var e=this.templateDataset();this.$el.html(e({item:this.model})),r(".peek").html(this.model.get("peek")),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"})},fetchVersion:function(t){this.options=i.extend(this.options,t);var e=this;this.options.ldda_id?(this.ldda=new h.default.Ldda({id:this.options.ldda_id}),this.ldda.url=this.ldda.urlRoot+this.model.id+"/versions/"+this.ldda.id,this.ldda.fetch({success:function(){e.renderVersion()},error:function(t,e){void 0!==e.responseJSON?d.default.error(e.responseJSON.err_msg):d.default.error("An error occurred.")}})):(this.render(),d.default.error("Library dataset version requested but no id provided."))},renderVersion:function(){r(".tooltip").remove();var t=this.templateVersion();this.$el.html(t({item:this.model,ldda:this.ldda})),r(".peek").html(this.ldda.get("peek"))},enableModification:function(){r(".tooltip").remove();var t=this.templateModifyDataset();this.$el.html(t({item:this.model})),this.renderSelectBoxes({genome_build:this.model.get("genome_build"),file_ext:this.model.get("file_ext")}),r(".peek").html(this.model.get("peek")),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"})},downloadDataset:function(){var t=Galaxy.root+"api/libraries/datasets/download/uncompressed",e={ld_ids:this.id};this.processDownload(t,e)},processDownload:function(t,e,n){if(t&&e){e="string"==typeof e?e:r.param(e);var i="";r.each(e.split("&"),function(){var t=this.split("=");i+='<input type="hidden" name="'+t[0]+'" value="'+t[1]+'" />'}),r('<form action="'+t+'" method="'+(n||"post")+'">'+i+"</form>").appendTo("body").submit().remove(),d.default.info("Your download will begin soon.")}},importIntoHistory:function(){this.refreshUserHistoriesList(function(t){var e=t.templateBulkImportInModal();t.modal=Galaxy.modal,t.modal.show({closing_events:!0,title:(0,l.default)("Import into History"),body:e({histories:t.histories.models}),buttons:{Import:function(){t.importCurrentIntoHistory()},Close:function(){Galaxy.modal.hide()}}})})},refreshUserHistoriesList:function(t){var e=this;this.histories=new h.default.GalaxyHistories,this.histories.fetch({success:function(n){0===n.length?d.default.warning("You have to create history first. Click this to do so.","",{onclick:function(){window.location=Galaxy.root}}):t(e)},error:function(t,e){void 0!==e.responseJSON?d.default.error(e.responseJSON.err_msg):d.default.error("An error occurred.")}})},importCurrentIntoHistory:function(){this.modal.disableButton("Import");var t=this.modal.$("input[name=history_name]").val(),e=this;if(""!==t)r.post(Galaxy.root+"api/histories",{name:t}).done(function(t){e.processImportToHistory(t.id)}).fail(function(t,e,n){d.default.error("An error occurred.")}).always(function(){e.modal.enableButton("Import")});else{var n=r(this.modal.$el).find("select[name=dataset_import_single] option:selected").val();this.processImportToHistory(n),this.modal.enableButton("Import")}},processImportToHistory:function(t){var e=new h.default.HistoryItem;e.url=e.urlRoot+t+"/contents",a.getJSON(Galaxy.root+"history/set_as_current?id="+t),e.save({content:this.id,source:"library"},{success:function(){Galaxy.modal.hide(),d.default.success("Dataset imported. Click this to start analyzing it.","",{onclick:function(){window.location=Galaxy.root}})},error:function(t,e){void 0!==e.responseJSON?d.default.error("Dataset not imported. "+e.responseJSON.err_msg):d.default.error("An error occured. Dataset not imported. Please try again.")}})},showPermissions:function(t){var e=this.templateDatasetPermissions(),n=this;this.options=i.extend(this.options,t),r(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_dataset_roles.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1})),this.$el.html(e({item:this.model,is_admin:Galaxy.config.is_admin_user})),r.get(Galaxy.root+"api/libraries/datasets/"+n.id+"/permissions?scope=current").done(function(t){n.prepareSelectBoxes({fetched_permissions:t,is_admin:Galaxy.config.is_admin_user})}).fail(function(){d.default.error("An error occurred while attempting to fetch dataset permissions.")}),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),r("#center").css("overflow","auto")},_serializeRoles:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n][1]+":"+t[n][0].replace(":"," ").replace(","," &"));return e},prepareSelectBoxes:function(t){this.options=i.extend(this.options,t),this.accessSelectObject=new g.default.View(this._generate_select_options({selector:"access_perm",initialData:this._serializeRoles(this.options.fetched_permissions.access_dataset_roles)})),this.modifySelectObject=new g.default.View(this._generate_select_options({selector:"modify_perm",initialData:this._serializeRoles(this.options.fetched_permissions.modify_item_roles)})),this.manageSelectObject=new g.default.View(this._generate_select_options({selector:"manage_perm",initialData:this._serializeRoles(this.options.fetched_permissions.manage_dataset_roles)}))},_generate_select_options:function(t){var e={minimumInputLength:0,multiple:!0,placeholder:"Click to select a role",formatResult:function(t){return t.name+" type: "+t.type},formatSelection:function(t){return t.name},initSelection:function(t,e){var n=[];r(t.val().split(",")).each(function(){var t=this.split(":");n.push({id:t[0],name:t[1]})}),e(n)},dropdownCssClass:"bigdrop"};return e.container=this.$el.find("#"+t.selector),e.css=t.selector,e.initialData=t.initialData.join(","),e.ajax={url:Galaxy.root+"api/libraries/datasets/"+this.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(t,e){return{q:t,page_limit:10,page:e}},results:function(t,e){var n=10*e<t.total;return{results:t.roles,more:n}}},e},saveModifications:function(t){var e=!1,n=this.model,i=this.$el.find(".input_dataset_name").val();if(void 0!==i&&i!==n.get("name")){if(!(i.length>0))return void d.default.warning("Library dataset name has to be at least 1 character long.");n.set("name",i),e=!0}var r=this.$el.find(".input_dataset_misc_info").val();void 0!==r&&r!==n.get("misc_info")&&(n.set("misc_info",r),e=!0);var a=this.$el.find(".input_dataset_message").val();void 0!==a&&a!==n.get("message")&&(n.set("message",a),e=!0);var o=this.select_genome.$el.select2("data").id;void 0!==o&&o!==n.get("genome_build")&&(n.set("genome_build",o),e=!0);var s=this.select_extension.$el.select2("data").id;void 0!==s&&s!==n.get("file_ext")&&(n.set("file_ext",s),e=!0);var l=this;e?n.save(null,{patch:!0,success:function(t){l.render(),d.default.success("Changes to library dataset saved.")},error:function(t,e){void 0!==e.responseJSON?d.default.error(e.responseJSON.err_msg):d.default.error("An error occured while attempting to update the library dataset.")}}):(l.render(),d.default.info("Nothing has changed."))},copyToClipboard:function(e){e.preventDefault();var n=t.history.location.href;-1!==n.lastIndexOf("/permissions")&&(n=n.substr(0,n.lastIndexOf("/permissions"))),window.prompt("Copy to clipboard: Ctrl+C, Enter",n)},makeDatasetPrivate:function(){var t=this;r.post(Galaxy.root+"api/libraries/datasets/"+t.id+"/permissions?action=make_private").done(function(e){t.model.set({is_unrestricted:!1}),t.showPermissions({fetched_permissions:e}),d.default.success("The dataset is now private to you.")}).fail(function(){d.default.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var t=this;r.post(Galaxy.root+"api/libraries/datasets/"+t.id+"/permissions?action=remove_restrictions").done(function(e){t.model.set({is_unrestricted:!0}),t.showPermissions({fetched_permissions:e}),d.default.success("Access to this dataset is now unrestricted.")}).fail(function(){d.default.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(t){for(var e=[],n=t.length-1;n>=0;n--)e.push(t[n].id);return e},savePermissions:function(t){var e=this,n=this._extractIds(this.accessSelectObject.$el.select2("data")),i=this._extractIds(this.manageSelectObject.$el.select2("data")),a=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/libraries/datasets/"+e.id+"/permissions?action=set_permissions",{"access_ids[]":n,"manage_ids[]":i,"modify_ids[]":a}).done(function(t){e.showPermissions({fetched_permissions:t}),d.default.success("Permissions saved.")}).fail(function(){d.default.error("An error occurred while attempting to set dataset permissions.")})},fetchExtAndGenomes:function(){var t=this;0==this.list_genomes.length&&p.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(e){for(var n in e)t.list_extensions.push({id:e[n].extension,text:e[n].extension,description:e[n].description,description_url:e[n].description_url});t.list_extensions.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0}),t.list_extensions.unshift(t.auto)}}),0==this.list_extensions.length&&p.default.get({url:Galaxy.root+"api/genomes",success:function(e){for(var n in e)t.list_genomes.push({id:e[n][1],text:e[n][0]});t.list_genomes.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0})}})},renderSelectBoxes:function(t){var e=this,n="?",i="auto";void 0!==t&&(void 0!==t.genome_build&&(n=t.genome_build),void 0!==t.file_ext&&(i=t.file_ext)),this.select_genome=new g.default.View({css:"dataset-genome-select",data:e.list_genomes,container:e.$el.find("#dataset_genome_select"),value:n}),this.select_extension=new g.default.View({css:"dataset-extension-select",data:e.list_extensions,container:e.$el.find("#dataset_extension_select"),value:i})},templateDataset:function(){return i.template(['<div class="library_style_container">','<div class="d-flex mb-2">','<button data-toggle="tooltip" data-placement="top" title="Download dataset" class="btn btn-secondary toolbtn-download-dataset toolbar-item mr-1" type="button">','<span class="fa fa-download"></span>',"&nbsp;Download","</button>",'<button data-toggle="tooltip" data-placement="top" title="Import dataset into history" class="btn btn-secondary toolbtn-import-dataset toolbar-item mr-1" type="button">','<span class="fa fa-book"></span>',"&nbsp;to History","</button>",'<% if (item.get("can_user_modify")) { %>','<button data-toggle="tooltip" data-placement="top" title="Modify library item" class="btn btn-secondary toolbtn_modify_dataset toolbar-item mr-1" type="button">','<span class="fa fa-pencil"></span>',"&nbsp;Modify","</button>","<% } %>",'<% if (item.get("can_user_manage")) { %>','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" title="Manage permissions" class="btn btn-secondary toolbtn_change_permissions toolbar-item mr-1" type="button">','<span class="fa fa-group"></span>',"&nbsp;Permissions","</button>","</a>","<% } %>","</div>",'<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<% if (item.get("is_unrestricted")) { %>',"<div>",'This dataset is unrestricted so everybody with the link can access it. Just share <span class="copy-link-to-clipboard"><a href=""a>this page</a></span>.',"</div>","<% } %>",'<div class="dataset_table">','<table class="grid table table-striped table-sm">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><%= _.escape(item.get("name")) %></td>',"</tr>",'<% if (item.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(item.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (item.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(item.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (item.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (item.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (item.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (item.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (item.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(item.get("message")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (item.get("misc_info")) { %>',"<tr>",'<th scope="row">Misc. info</th>','<td scope="row"><%= _.escape(item.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>",'<% if ( item.get("uuid") !== "ok" ) { %>',"<tr>",'<th scope="row">UUID</th>','<td scope="row"><%= _.escape(item.get("uuid")) %></td>',"</tr>","<% } %>",'<% if ( item.get("state") !== "ok" ) { %>',"<tr>",'<th scope="row">State</th>','<td scope="row"><%= _.escape(item.get("state")) %></td>',"</tr>","<% } %>","</table>",'<% if (item.get("job_stderr")) { %>',"<h4>Job Standard Error</h4>",'<pre class="code">','<%= _.escape(item.get("job_stderr")) %>',"</pre>","<% } %>",'<% if (item.get("job_stdout")) { %>',"<h4>Job Standard Output</h4>",'<pre class="code">','<%= _.escape(item.get("job_stdout")) %>',"</pre>","<% } %>","<div>",'<pre class="peek">',"</pre>","</div>",'<% if (item.get("has_versions")) { %>',"<div>","<h3>Expired versions:</h3>","<ul>",'<% _.each(item.get("expired_versions"), function(version) { %>','<li><a title="See details of this version" href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>/versions/<%- version[0] %>"><%- version[1] %></a></li>',"<% }) %>","<ul>","</div>","<% } %>","</div>","</div>"].join(""))},templateVersion:function(){return i.template(['<div class="library_style_container">','<div class="d-flex mb-2">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go to latest dataset" class="btn btn-secondary toolbar-item mr-1" type="button">','<span class="fa fa-caret-left fa-lg"></span>',"&nbsp;Latest dataset","</button>","<a>","</div>",'<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="alert alert-warning">This is an expired version of the library dataset: <%= _.escape(item.get("name")) %></div>','<div class="dataset_table">','<table class="grid table table-striped table-sm">',"<tr>",'<th scope="row" id="id_row" data-id="<%= _.escape(ldda.id) %>">Name</th>','<td><%= _.escape(ldda.get("name")) %></td>',"</tr>",'<% if (ldda.get("file_ext")) { %>',"<tr>",'<th scope="row">Data type</th>','<td><%= _.escape(ldda.get("file_ext")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("genome_build")) { %>',"<tr>",'<th scope="row">Genome build</th>','<td><%= _.escape(ldda.get("genome_build")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("file_size")) { %>',"<tr>",'<th scope="row">Size</th>','<td><%= _.escape(ldda.get("file_size")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("date_uploaded")) { %>',"<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(ldda.get("date_uploaded")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("uploaded_by")) { %>',"<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(ldda.get("uploaded_by")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_data_lines")) { %>',"<tr>",'<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_data_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_comment_lines")) { %>',"<tr>",'<th scope="row">Comment Lines</th>','<td scope="row"><%= _.escape(ldda.get("metadata_comment_lines")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_columns")) { %>',"<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(ldda.get("metadata_columns")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("metadata_column_types")) { %>',"<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(ldda.get("metadata_column_types")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("message")) { %>',"<tr>",'<th scope="row">Message</th>','<td scope="row"><%= _.escape(ldda.get("message")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_blurb")) { %>',"<tr>",'<th scope="row">Miscellaneous blurb</th>','<td scope="row"><%= _.escape(ldda.get("misc_blurb")) %></td>',"</tr>","<% } %>",'<% if (ldda.get("misc_info")) { %>',"<tr>",'<th scope="row">Miscellaneous information</th>','<td scope="row"><%= _.escape(ldda.get("misc_info")) %></td>',"</tr>","<% } %>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>","</div>"].join(""))},templateModifyDataset:function(){return i.template(['<div class="library_style_container">','<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<div class="dataset_table">','<table class="grid table table-striped table-sm">',"<tr>",'<th class="dataset-first-column" scope="row" id="id_row" data-id="<%= _.escape(item.get("ldda_id")) %>">Name</th>','<td><input class="input_dataset_name form-control" type="text" placeholder="name" value="<%= _.escape(item.get("name")) %>"></td>',"</tr>","<tr>",'<th scope="row">Data type</th>',"<td>",'<span id="dataset_extension_select" class="dataset-extension-select" />',"</td>","</tr>","<tr>",'<th scope="row">Genome build</th>',"<td>",'<span id="dataset_genome_select" class="dataset-genome-select" />',"</td>","</tr>","<tr>",'<th scope="row">Size</th>','<td><%= _.escape(item.get("file_size")) %></td>',"</tr>","<tr>",'<th scope="row">Date uploaded (UTC)</th>','<td><%= _.escape(item.get("date_uploaded")) %></td>',"</tr>","<tr>",'<th scope="row">Uploaded by</th>','<td><%= _.escape(item.get("uploaded_by")) %></td>',"</tr>",'<tr scope="row">','<th scope="row">Data Lines</th>','<td scope="row"><%= _.escape(item.get("metadata_data_lines")) %></td>',"</tr>",'<th scope="row">Comment Lines</th>','<% if (item.get("metadata_comment_lines") === "") { %>','<td scope="row"><%= _.escape(item.get("metadata_comment_lines")) %></td>',"<% } else { %>",'<td scope="row">unknown</td>',"<% } %>","</tr>","<tr>",'<th scope="row">Number of Columns</th>','<td scope="row"><%= _.escape(item.get("metadata_columns")) %></td>',"</tr>","<tr>",'<th scope="row">Column Types</th>','<td scope="row"><%= _.escape(item.get("metadata_column_types")) %></td>',"</tr>","<tr>",'<th scope="row">Message</th>','<td scope="row"><input class="input_dataset_message form-control" type="text" placeholder="message" value="<%= _.escape(item.get("message")) %>"></td>',"</tr>","<tr>",'<th scope="row">Misc. blurb</th>','<td scope="row"><%= _.escape(item.get("misc_blurb")) %></td>',"</tr>","<tr>",'<th scope="row">Misc. information</th>','<td><input class="input_dataset_misc_info form-control" type="text" placeholder="info" value="<%= _.escape(item.get("misc_info")) %>"></td>',"</tr>",'<% if (item.get("tags")) { %>',"<tr>",'<th scope="row">Tags</th>','<td scope="row"><%= _.escape(item.get("tags")) %></td>',"</tr>","<% } %>","</table>","<div>",'<pre class="peek">',"</pre>","</div>","</div>",'<div class="d-flex">','<button data-toggle="tooltip" data-placement="top" title="Cancel modifications" class="btn btn-secondary toolbtn_cancel_modifications toolbar-item mr-1" type="button">','<span class="fa fa-times"></span>',"&nbsp;Cancel","</button>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-secondary toolbtn_save_modifications toolbar-item mr-1" type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>","</div>"].join(""))},templateDatasetPermissions:function(){return i.template(['<div class="library_style_container">','<div class="d-flex mb-2">','<a href="#folders/<%- item.get("folder_id") %>/datasets/<%- item.id %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to dataset" class="btn btn-secondary toolbar-item mr-1" type="button">','<span class="fa fa-file-o"></span>',"&nbsp;Dataset Details","</button>","<a>","</div>",'<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>','<% _.each(item.get("full_path"), function(path_item) { %>',"<% if (path_item[0] != item.id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are here"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<h1>Dataset: <%= _.escape(item.get("name")) %></h1>','<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any dataset on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% } %>","</div>",'<div class="dataset_table">',"<h2>Library-related permissions</h2>","<h4>Roles that can modify the library item</h4>",'<div id="modify_perm" class="modify_perm roles-selection"></div>','<div class="alert alert-info roles-selection">User with <strong>any</strong> of these roles can modify name, metadata, and other information about this library item.</div>',"<hr/>","<h2>Dataset-related permissions</h2>",'<div class="alert alert-warning">Changes made below will affect <strong>every</strong> library item that was created from this dataset and also every history this dataset is part of.</div>','<% if (!item.get("is_unrestricted")) { %>','<p>You can <span class="remove-restrictions"><a href="">remove all access restrictions</a></span> on this dataset.</p>',"<% } else { %>",'<p>You can <span class="make-private"><a href="">make this dataset private</a></span> to you.</p>',"<% } %>","<h4>Roles that can access the dataset</h4>",'<div id="access_perm" class="access_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User has to have <strong>all these roles</strong> in order to access this dataset."," Users without access permission <strong>cannot</strong> have other permissions on this dataset."," If there are no access roles set on the dataset it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on the dataset</h4>",'<div id="manage_perm" class="manage_perm roles-selection"></div>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions of this dataset. If you remove yourself you will lose the ability manage this dataset unless you are an admin.","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-secondary toolbtn_save_permissions  type="button">','<span class="fa fa-floppy-o"></span>',"&nbsp;Save","</button>","</div>","</div>"].join(""))},templateBulkImportInModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select id="dataset_import_single" name="dataset_import_single" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;">',"</input>","</div>","</div>"].join(""))}});e.default={LibraryDatasetView:m}}).call(e,n(2),n(1),n(0),n(0))},function(t,e,n){var i,r,a;!function(o){"use strict";r=[n(0)],i=o,void 0!==(a="function"==typeof i?i.apply(e,r):i)&&(t.exports=a)}(function(t,e){"use strict";/*!
 * jsTree 3.0.3
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options: 
 * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */
if(!t.jstree){var n,i,r=0,a=!1,o=!1,s=!1,l=[],c=t("script:last").attr("src"),d=document,u=d.createElement("LI");u.setAttribute("role","treeitem"),n=d.createElement("I"),n.className="jstree-icon jstree-ocl",u.appendChild(n),n=d.createElement("A"),n.className="jstree-anchor",n.setAttribute("href","#"),i=d.createElement("I"),i.className="jstree-icon jstree-themeicon",n.appendChild(i),u.appendChild(n),n=i=null,t.jstree={version:"3.0.3",defaults:{plugins:[]},plugins:{},path:c&&-1!==c.indexOf("/")?c.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g},t.jstree.create=function(e,n){var i=new t.jstree.core(++r),a=n;return n=t.extend(!0,{},t.jstree.defaults,n),a&&a.plugins&&(n.plugins=a.plugins),t.each(n.plugins,function(t,e){"core"!==t&&(i=i.plugin(e,n[e]))}),i.init(e,n),i},t.jstree.core=function(t){this._id=t,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[]}}},t.jstree.reference=function(e){var n=null,i=null;if(e&&e.id&&(e=e.id),!i||!i.length)try{i=t(e)}catch(t){}if(!i||!i.length)try{i=t("#"+e.replace(t.jstree.idregex,"\\$&"))}catch(t){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?n=i:t(".jstree").each(function(){var i=t(this).data("jstree");if(i&&i._model.data[e])return n=i,!1}),n},t.fn.jstree=function(n){var i="string"==typeof n,r=Array.prototype.slice.call(arguments,1),a=null;return this.each(function(){var o=t.jstree.reference(this),s=i&&o?o[n]:null;if(a=i&&s?s.apply(o,r):null,o||i||n!==e&&!t.isPlainObject(n)||t(this).data("jstree",new t.jstree.create(this,n)),(o&&!i||!0===n)&&(a=o||!1),null!==a&&a!==e)return!1}),null!==a&&a!==e?a:this},t.expr[":"].jstree=t.expr.createPseudo(function(n){return function(n){return t(n).hasClass("jstree")&&t(n).data("jstree")!==e}}),t.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:t.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1},t.jstree.core.prototype={plugin:function(e,n){var i=t.jstree.plugins[e];return i?(this._data[e]={},i.prototype=this,new i(n,this)):this},init:function(e,n){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=t(e).addClass("jstree jstree-"+this._id),this.settings=n,this.element.bind("destroyed",t.proxy(this.teardown,this)),this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(t){t||this.element.empty(),this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(t){}}}).on("click.jstree",".jstree-ocl",t.proxy(function(t){this.toggle_node(t.target)},this)).on("click.jstree",".jstree-anchor",t.proxy(function(e){e.preventDefault(),t(e.currentTarget).focus(),this.activate_node(e.currentTarget,e)},this)).on("keydown.jstree",".jstree-anchor",t.proxy(function(e){if("INPUT"===e.target.tagName)return!0;var n=null;switch(e.which){case 13:case 32:e.type="click",t(e.currentTarget).trigger(e);break;case 37:e.preventDefault(),this.is_open(e.currentTarget)?this.close_node(e.currentTarget):(n=this.get_prev_dom(e.currentTarget))&&n.length&&n.children(".jstree-anchor").focus();break;case 38:e.preventDefault(),n=this.get_prev_dom(e.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 39:e.preventDefault(),this.is_closed(e.currentTarget)?this.open_node(e.currentTarget,function(t){this.get_node(t,!0).children(".jstree-anchor").focus()}):(n=this.get_next_dom(e.currentTarget))&&n.length&&n.children(".jstree-anchor").focus();break;case 40:e.preventDefault(),n=this.get_next_dom(e.currentTarget),n&&n.length&&n.children(".jstree-anchor").focus();break;case 46:e.preventDefault(),n=this.get_node(e.currentTarget),n&&n.id&&"#"!==n.id&&(n=this.is_selected(n)?this.get_selected():n);break;case 113:e.preventDefault(),n=this.get_node(e.currentTarget)}},this)).on("load_node.jstree",t.proxy(function(e,n){if(n.status&&("#"!==n.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var i,r,a=[];for(i=0,r=this._data.core.selected.length;i<r;i++)a=a.concat(this._model.data[this._data.core.selected[i]].parents);for(a=t.vakata.array_unique(a),i=0,r=a.length;i<r;i++)this.open_node(a[i],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(t.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",t.proxy(function(){var t=this.settings.core.themes;this._data.core.themes.dots=t.dots,this._data.core.themes.stripes=t.stripes,this._data.core.themes.icons=t.icons,this.set_theme(t.name||"default",t.url),this.set_theme_variant(t.variant)},this)).on("loading.jstree",t.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",t.proxy(function(e){t(e.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",t.proxy(function(e){this.element.find(".jstree-hovered").not(e.currentTarget).mouseleave(),t(e.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",t.proxy(function(t){this.hover_node(t.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",t.proxy(function(t){this.dehover_node(t.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),t(document).off(".jstree-"+this._id)},trigger:function(t,e){e||(e={}),e.instance=this,this.element.triggerHandler(t.replace(".jstree","")+".jstree",e)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(e){var n=this.settings.core.strings;return t.isFunction(n)?n.call(this,e):n&&n[e]?n[e]:e},_firstChild:function(t){for(t=t?t.firstChild:null;null!==t&&1!==t.nodeType;)t=t.nextSibling;return t},_nextSibling:function(t){for(t=t?t.nextSibling:null;null!==t&&1!==t.nodeType;)t=t.nextSibling;return t},_previousSibling:function(t){for(t=t?t.previousSibling:null;null!==t&&1!==t.nodeType;)t=t.previousSibling;return t},get_node:function(e,n){e&&e.id&&(e=e.id);var i;try{if(this._model.data[e])e=this._model.data[e];else if(((i=t(e,this.element)).length||(i=t("#"+e.replace(t.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[i.closest(".jstree-node").attr("id")])e=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=t(e,this.element)).length||!i.hasClass("jstree"))return!1;e=this._model.data["#"]}return n&&(e="#"===e.id?this.element:t("#"+e.id.replace(t.jstree.idregex,"\\$&"),this.element)),e}catch(t){return!1}},get_path:function(t,e,n){if(!(t=t.parents?t:this.get_node(t))||"#"===t.id||!t.parents)return!1;var i,r,a=[];for(a.push(n?t.id:t.text),i=0,r=t.parents.length;i<r;i++)a.push(n?t.parents[i]:this.get_text(t.parents[i]));return a=a.reverse().slice(1),e?a.join(e):a},get_next_dom:function(e,n){var i;return e=this.get_node(e,!0),e[0]===this.element[0]?!!(i=this._firstChild(this.get_container_ul()[0]))&&t(i):!(!e||!e.length)&&(n?!!(i=this._nextSibling(e[0]))&&t(i):e.hasClass("jstree-open")?!!(i=this._firstChild(e.children(".jstree-children")[0]))&&t(i):null!==(i=this._nextSibling(e[0]))?t(i):e.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0))},get_prev_dom:function(e,n){var i;if(e=this.get_node(e,!0),e[0]===this.element[0])return!!(i=this.get_container_ul()[0].lastChild)&&t(i);if(!e||!e.length)return!1;if(n)return!!(i=this._previousSibling(e[0]))&&t(i);if(null!==(i=this._previousSibling(e[0]))){for(e=t(i);e.hasClass("jstree-open");)e=e.children(".jstree-children:eq(0)").children(".jstree-node:last");return e}return!(!(i=e[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&t(i)},get_parent:function(t){return!(!(t=this.get_node(t))||"#"===t.id)&&t.parent},get_children_dom:function(t){return t=this.get_node(t,!0),t[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!t||!t.length)&&t.children(".jstree-children").children(".jstree-node")},is_parent:function(t){return(t=this.get_node(t))&&(!1===t.state.loaded||t.children.length>0)},is_loaded:function(t){return(t=this.get_node(t))&&t.state.loaded},is_loading:function(t){return(t=this.get_node(t))&&t.state&&t.state.loading},is_open:function(t){return(t=this.get_node(t))&&t.state.opened},is_closed:function(t){return(t=this.get_node(t))&&this.is_parent(t)&&!t.state.opened},is_leaf:function(t){return!this.is_parent(t)},load_node:function(e,n){var i,r,a,o,s;if(t.isArray(e))return this._load_nodes(e.slice(),n),!0;if(!(e=this.get_node(e)))return n&&n.call(this,e,!1),!1;if(e.state.loaded){for(e.state.loaded=!1,i=0,r=e.children_d.length;i<r;i++){for(a=0,o=e.parents.length;a<o;a++)this._model.data[e.parents[a]].children_d=t.vakata.array_remove_item(this._model.data[e.parents[a]].children_d,e.children_d[i]);this._model.data[e.children_d[i]].state.selected&&(s=!0,this._data.core.selected=t.vakata.array_remove_item(this._data.core.selected,e.children_d[i])),delete this._model.data[e.children_d[i]]}e.children=[],e.children_d=[],s&&this.trigger("changed",{action:"load_node",node:e,selected:this._data.core.selected})}return e.state.loading=!0,this.get_node(e,!0).addClass("jstree-loading"),this._load_node(e,t.proxy(function(t){e=this._model.data[e.id],e.state.loading=!1,e.state.loaded=t;var i=this.get_node(e,!0);e.state.loaded&&!e.children.length&&i&&i.length&&!i.hasClass("jstree-leaf")&&i.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),i.removeClass("jstree-loading"),this.trigger("load_node",{node:e,status:t}),n&&n.call(this,e,t)},this)),!0},_load_nodes:function(t,e,n){var i,r,a=!0,o=function(){this._load_nodes(t,e,!0)},s=this._model.data;for(i=0,r=t.length;i<r;i++)!s[t[i]]||s[t[i]].state.loaded&&n||(this.is_loading(t[i])||this.load_node(t[i],o),a=!1);a&&e&&!e.done&&(e.call(this,t),e.done=!0)},_load_node:function(e,n){var i,r=this.settings.core.data;return r?t.isFunction(r)?r.call(this,e,t.proxy(function(i){!1===i&&n.call(this,!1),this["string"==typeof i?"_append_html_data":"_append_json_data"](e,"string"==typeof i?t(i):i,function(t){n.call(this,t)})},this)):"object"==typeof r?r.url?(r=t.extend(!0,{},r),t.isFunction(r.url)&&(r.url=r.url.call(this,e)),t.isFunction(r.data)&&(r.data=r.data.call(this,e)),t.ajax(r).done(t.proxy(function(i,r,a){var o=a.getResponseHeader("Content-Type");return-1!==o.indexOf("json")||"object"==typeof i?this._append_json_data(e,i,function(t){n.call(this,t)}):-1!==o.indexOf("html")||"string"==typeof i?this._append_html_data(e,t(i),function(t){n.call(this,t)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:e.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))},this)).fail(t.proxy(function(t){n.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:e.id,xhr:t})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(i=t.isArray(r)||t.isPlainObject(r)?JSON.parse(JSON.stringify(r)):r,"#"===e.id?this._append_json_data(e,i,function(t){n.call(this,t)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:e.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1))):"string"==typeof r?"#"===e.id?this._append_html_data(e,t(r),function(t){n.call(this,t)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:e.id})},this.settings.core.error.call(this,this._data.core.last_error),n.call(this,!1)):n.call(this,!1):"#"===e.id?this._append_html_data(e,this._data.core.original_container_html.clone(!0),function(t){n.call(this,t)}):n.call(this,!1)},_node_changed:function(t){(t=this.get_node(t))&&this._model.changed.push(t.id)},_append_html_data:function(e,n,i){e=this.get_node(e),e.children=[],e.children_d=[];var r,a,o,s=n.is("ul")?n.children():n,l=e.id,c=[],d=[],u=this._model.data,h=u[l],f=this._data.core.selected.length;for(s.each(t.proxy(function(e,n){(r=this._parse_model_from_html(t(n),l,h.parents.concat()))&&(c.push(r),d.push(r),u[r].children_d.length&&(d=d.concat(u[r].children_d)))},this)),h.children=c,h.children_d=d,a=0,o=h.parents.length;a<o;a++)u[h.parents[a]].children_d=u[h.parents[a]].children_d.concat(d);this.trigger("model",{nodes:d,parent:l}),"#"!==l?(this._node_changed(l),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==f&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(e,n,i){e=this.get_node(e),e.children=[],e.children_d=[],n.d&&"string"==typeof(n=n.d)&&(n=JSON.parse(n)),t.isArray(n)||(n=[n]);var r=null,a={df:this._model.default_state,dat:n,par:e.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(t,e){t.data&&(t=t.data);var n,i,r,a,o=t.dat,s=t.par,l=[],c=[],d=[],u=t.df,h=t.t_id,f=t.t_cnt,p=t.m,_=p[s],g=t.sel,m=function(t,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l=t.id.toString(),c={id:l,text:t.text||"",icon:t.icon===e||t.icon,parent:n,parents:i,children:t.children||[],children_d:t.children_d||[],data:t.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(c.state[r]=u[r]);if(t&&t.data&&t.data.jstree&&t.data.jstree.icon&&(c.icon=t.data.jstree.icon),t&&t.data&&(c.data=t.data,t.data.jstree))for(r in t.data.jstree)t.data.jstree.hasOwnProperty(r)&&(c.state[r]=t.data.jstree[r]);if(t&&"object"==typeof t.state)for(r in t.state)t.state.hasOwnProperty(r)&&(c.state[r]=t.state[r]);if(t&&"object"==typeof t.li_attr)for(r in t.li_attr)t.li_attr.hasOwnProperty(r)&&(c.li_attr[r]=t.li_attr[r]);if(c.li_attr.id||(c.li_attr.id=l),t&&"object"==typeof t.a_attr)for(r in t.a_attr)t.a_attr.hasOwnProperty(r)&&(c.a_attr[r]=t.a_attr[r]);for(t&&t.children&&!0===t.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),p[c.id]=c,r=0,a=c.children.length;r<a;r++)o=m(p[c.children[r]],c.id,i),s=p[o],c.children_d.push(o),s.children_d.length&&(c.children_d=c.children_d.concat(s.children_d));return delete t.data,delete t.children,p[c.id].original=t,c.state.selected&&d.push(c.id),c.id},v=function(t,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l,c=!1;do{c="j"+h+"_"+ ++f}while(p[c]);l={id:!1,text:"string"==typeof t?t:"",icon:"object"!=typeof t||t.icon===e||t.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(l.state[r]=u[r]);if(t&&t.id&&(l.id=t.id.toString()),t&&t.text&&(l.text=t.text),t&&t.data&&t.data.jstree&&t.data.jstree.icon&&(l.icon=t.data.jstree.icon),t&&t.data&&(l.data=t.data,t.data.jstree))for(r in t.data.jstree)t.data.jstree.hasOwnProperty(r)&&(l.state[r]=t.data.jstree[r]);if(t&&"object"==typeof t.state)for(r in t.state)t.state.hasOwnProperty(r)&&(l.state[r]=t.state[r]);if(t&&"object"==typeof t.li_attr)for(r in t.li_attr)t.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=t.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),t&&"object"==typeof t.a_attr)for(r in t.a_attr)t.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=t.a_attr[r]);if(t&&t.children&&t.children.length){for(r=0,a=t.children.length;r<a;r++)o=v(t.children[r],l.id,i),s=p[o],l.children.push(o),s.children_d.length&&(l.children_d=l.children_d.concat(s.children_d));l.children_d=l.children_d.concat(l.children)}return t&&t.children&&!0===t.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete t.data,delete t.children,l.original=t,p[l.id]=l,l.state.selected&&d.push(l.id),l.id};if(o.length&&o[0].id!==e&&o[0].parent!==e){for(i=0,r=o.length;i<r;i++)o[i].children||(o[i].children=[]),p[o[i].id.toString()]=o[i];for(i=0,r=o.length;i<r;i++)p[o[i].parent.toString()].children.push(o[i].id.toString()),_.children_d.push(o[i].id.toString());for(i=0,r=_.children.length;i<r;i++)n=m(p[_.children[i]],s,_.parents.concat()),c.push(n),p[n].children_d.length&&(c=c.concat(p[n].children_d));for(i=0,r=_.parents.length;i<r;i++)p[_.parents[i]].children_d=p[_.parents[i]].children_d.concat(c);a={cnt:f,mod:p,sel:g,par:s,dpc:c,add:d}}else{for(i=0,r=o.length;i<r;i++)(n=v(o[i],s,_.parents.concat()))&&(l.push(n),c.push(n),p[n].children_d.length&&(c=c.concat(p[n].children_d)));for(_.children=l,_.children_d=c,i=0,r=_.parents.length;i<r;i++)p[_.parents[i]].children_d=p[_.parents[i]].children_d.concat(c);a={cnt:f,mod:p,sel:g,par:s,dpc:c,add:d}}return a},s=function(e,n){if(this._cnt=e.cnt,this._model.data=e.mod,n){var r,a,o=e.add,s=e.sel,l=this._data.core.selected.slice(),c=this._model.data;if(s.length!==l.length||t.vakata.array_unique(s.concat(l)).length!==s.length){for(r=0,a=s.length;r<a;r++)-1===t.inArray(s[r],o)&&-1===t.inArray(s[r],l)&&(c[s[r]].state.selected=!1);for(r=0,a=l.length;r<a;r++)-1===t.inArray(l[r],s)&&(c[l[r]].state.selected=!0)}}e.add.length&&(this._data.core.selected=this._data.core.selected.concat(e.add)),this.trigger("model",{nodes:e.dpc,parent:e.par}),"#"!==e.par?(this._node_changed(e.par),this.redraw()):this.redraw(!0),e.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))),r=new window.Worker(this._wrk),r.onmessage=t.proxy(function(t){s.call(this,t.data,!0),this._data.core.working=!1,this._data.core.worker_queue.length&&this._append_json_data.apply(this,this._data.core.worker_queue.shift())},this),this._data.core.working?this._data.core.worker_queue.push([e,n,i]):(this._data.core.working=!0,r.postMessage(a))}catch(t){s.call(this,o(a),!1)}else s.call(this,o(a),!1)},_parse_model_from_html:function(e,n,i){i=i?[].concat(i):[],n&&i.unshift(n);var r,a,o,s,l,c=this._model.data,d={id:!1,text:!1,icon:!0,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(d.state[o]=this._model.default_state[o]);if(s=t.vakata.attributes(e,!0),t.each(s,function(e,n){if(n=t.trim(n),!n.length)return!0;d.li_attr[e]=n,"id"===e&&(d.id=n.toString())}),s=e.children("a").eq(0),s.length&&(s=t.vakata.attributes(s,!0),t.each(s,function(e,n){n=t.trim(n),n.length&&(d.a_attr[e]=n)})),s=e.children("a:eq(0)").length?e.children("a:eq(0)").clone():e.clone(),s.children("ins, i, ul").remove(),s=s.html(),s=t("<div />").html(s),d.text=this.settings.core.force_text?s.text():s.html(),s=e.data(),d.data=s?t.extend(!0,{},s):null,d.state.opened=e.hasClass("jstree-open"),d.state.selected=e.children("a").hasClass("jstree-clicked"),d.state.disabled=e.children("a").hasClass("jstree-disabled"),d.data&&d.data.jstree)for(o in d.data.jstree)d.data.jstree.hasOwnProperty(o)&&(d.state[o]=d.data.jstree[o]);s=e.children("a").children(".jstree-themeicon"),s.length&&(d.icon=!s.hasClass("jstree-themeicon-hidden")&&s.attr("rel")),d.state.icon&&(d.icon=d.state.icon),s=e.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(c[l]);return d.id=d.li_attr.id?d.li_attr.id.toString():l,s.length?(s.each(t.proxy(function(e,n){r=this._parse_model_from_html(t(n),d.id,i),a=this._model.data[r],d.children.push(r),a.children_d.length&&(d.children_d=d.children_d.concat(a.children_d))},this)),d.children_d=d.children_d.concat(d.children)):e.hasClass("jstree-closed")&&(d.state.loaded=!1),d.li_attr.class&&(d.li_attr.class=d.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),d.a_attr.class&&(d.a_attr.class=d.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),c[d.id]=d,d.state.selected&&this._data.core.selected.push(d.id),d.id},_parse_model_from_flat_json:function(t,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l=t.id.toString(),c=this._model.data,d=this._model.default_state,u={id:l,text:t.text||"",icon:t.icon===e||t.icon,parent:n,parents:i,children:t.children||[],children_d:t.children_d||[],data:t.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in d)d.hasOwnProperty(r)&&(u.state[r]=d[r]);if(t&&t.data&&t.data.jstree&&t.data.jstree.icon&&(u.icon=t.data.jstree.icon),t&&t.data&&(u.data=t.data,t.data.jstree))for(r in t.data.jstree)t.data.jstree.hasOwnProperty(r)&&(u.state[r]=t.data.jstree[r]);if(t&&"object"==typeof t.state)for(r in t.state)t.state.hasOwnProperty(r)&&(u.state[r]=t.state[r]);if(t&&"object"==typeof t.li_attr)for(r in t.li_attr)t.li_attr.hasOwnProperty(r)&&(u.li_attr[r]=t.li_attr[r]);if(u.li_attr.id||(u.li_attr.id=l),t&&"object"==typeof t.a_attr)for(r in t.a_attr)t.a_attr.hasOwnProperty(r)&&(u.a_attr[r]=t.a_attr[r]);for(t&&t.children&&!0===t.children&&(u.state.loaded=!1,u.children=[],u.children_d=[]),c[u.id]=u,r=0,a=u.children.length;r<a;r++)o=this._parse_model_from_flat_json(c[u.children[r]],u.id,i),s=c[o],u.children_d.push(o),s.children_d.length&&(u.children_d=u.children_d.concat(s.children_d));return delete t.data,delete t.children,c[u.id].original=t,u.state.selected&&this._data.core.selected.push(u.id),u.id},_parse_model_from_json:function(t,n,i){i=i?i.concat():[],n&&i.unshift(n);var r,a,o,s,l,c=!1,d=this._model.data,u=this._model.default_state;do{c="j"+this._id+"_"+ ++this._cnt}while(d[c]);l={id:!1,text:"string"==typeof t?t:"",icon:"object"!=typeof t||t.icon===e||t.icon,parent:n,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(r in u)u.hasOwnProperty(r)&&(l.state[r]=u[r]);if(t&&t.id&&(l.id=t.id.toString()),t&&t.text&&(l.text=t.text),t&&t.data&&t.data.jstree&&t.data.jstree.icon&&(l.icon=t.data.jstree.icon),t&&t.data&&(l.data=t.data,t.data.jstree))for(r in t.data.jstree)t.data.jstree.hasOwnProperty(r)&&(l.state[r]=t.data.jstree[r]);if(t&&"object"==typeof t.state)for(r in t.state)t.state.hasOwnProperty(r)&&(l.state[r]=t.state[r]);if(t&&"object"==typeof t.li_attr)for(r in t.li_attr)t.li_attr.hasOwnProperty(r)&&(l.li_attr[r]=t.li_attr[r]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=c),l.li_attr.id||(l.li_attr.id=l.id),t&&"object"==typeof t.a_attr)for(r in t.a_attr)t.a_attr.hasOwnProperty(r)&&(l.a_attr[r]=t.a_attr[r]);if(t&&t.children&&t.children.length){for(r=0,a=t.children.length;r<a;r++)o=this._parse_model_from_json(t.children[r],l.id,i),s=d[o],l.children.push(o),s.children_d.length&&(l.children_d=l.children_d.concat(s.children_d));l.children_d=l.children_d.concat(l.children)}return t&&t.children&&!0===t.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete t.data,delete t.children,l.original=t,d[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var t,e,n,i=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),r=document.createElement("UL");for(e=0,n=i.length;e<n;e++)(t=this.redraw_node(i[e],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&r.appendChild(t);this._model.force_full_redraw&&(r.className=this.get_container_ul()[0].className,this.element.empty().append(r)),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(t){t&&(this._model.force_full_redraw=!0),this._redraw()},redraw_node:function(e,n,i){var r=this.get_node(e),a=!1,o=!1,s=!1,l=!1,c=!1,d=!1,h="",f=document,p=this._model.data,_=!1,g=!1,m=null;if(!r)return!1;if("#"===r.id)return this.redraw(!0);if(n=n||0===r.children.length,e=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(r.id[0])?"\\3"+r.id[0]+" "+r.id.substr(1).replace(t.jstree.idregex,"\\$&"):r.id.replace(t.jstree.idregex,"\\$&"))):document.getElementById(r.id))e=t(e),i||(a=e.parent().parent()[0],a===this.element[0]&&(a=null),o=e.index()),n||!r.children.length||e.children(".jstree-children").length||(n=!0),n||(s=e.children(".jstree-children")[0]),g=e.attr("aria-selected"),_=e.children(".jstree-anchor")[0]===document.activeElement,e.remove();else if(n=!0,!i){if(!(null===(a="#"!==r.parent?t("#"+r.parent.replace(t.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&p[r.parent].state.opened))return!1;o=t.inArray(r.id,null===a?p["#"].children:p[r.parent].children)}e=u.cloneNode(!0),h="jstree-node ";for(l in r.li_attr)if(r.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?e.setAttribute(l,r.li_attr[l]):h+=r.li_attr[l]}g&&"false"!==g&&e.setAttribute("aria-selected",!0),r.state.loaded&&!r.children.length?h+=" jstree-leaf":(h+=r.state.opened&&r.state.loaded?" jstree-open":" jstree-closed",e.setAttribute("aria-expanded",r.state.opened&&r.state.loaded)),null!==r.parent&&p[r.parent].children[p[r.parent].children.length-1]===r.id&&(h+=" jstree-last"),e.id=r.id,e.className=h,h=(r.state.selected?" jstree-clicked":"")+(r.state.disabled?" jstree-disabled":"");for(c in r.a_attr)if(r.a_attr.hasOwnProperty(c)){if("href"===c&&"#"===r.a_attr[c])continue;"class"!==c?e.childNodes[1].setAttribute(c,r.a_attr[c]):h+=" "+r.a_attr[c]}if(h.length&&(e.childNodes[1].className="jstree-anchor "+h),(r.icon&&!0!==r.icon||!1===r.icon)&&(!1===r.icon?e.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===r.icon.indexOf("/")&&-1===r.icon.indexOf(".")?e.childNodes[1].childNodes[0].className+=" "+r.icon+" jstree-themeicon-custom":(e.childNodes[1].childNodes[0].style.backgroundImage="url("+r.icon+")",e.childNodes[1].childNodes[0].style.backgroundPosition="center center",e.childNodes[1].childNodes[0].style.backgroundSize="auto",e.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?e.childNodes[1].appendChild(f.createTextNode(r.text)):e.childNodes[1].innerHTML+=r.text,n&&r.children.length&&r.state.opened&&r.state.loaded){for(d=f.createElement("UL"),d.setAttribute("role","group"),d.className="jstree-children",l=0,c=r.children.length;l<c;l++)d.appendChild(this.redraw_node(r.children[l],n,!0));e.appendChild(d)}if(s&&e.appendChild(s),!i){for(a||(a=this.element[0]),l=0,c=a.childNodes.length;l<c;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){m=a.childNodes[l];break}m||(m=f.createElement("UL"),m.setAttribute("role","group"),m.className="jstree-children",a.appendChild(m)),a=m,o<a.childNodes.length?a.insertBefore(e,a.childNodes[o]):a.appendChild(e),_&&e.childNodes[1].focus()}return r.state.opened&&!r.state.loaded&&(r.state.opened=!1,setTimeout(t.proxy(function(){this.open_node(r.id,!1,0)},this),0)),e},open_node:function(n,i,r){var a,o,s,l;if(t.isArray(n)){for(n=n.slice(),a=0,o=n.length;a<o;a++)this.open_node(n[a],i,r);return!0}if(!(n=this.get_node(n))||"#"===n.id)return!1;if(r=r===e?this.settings.core.animation:r,!this.is_closed(n))return i&&i.call(this,n,!1),!1;if(this.is_loaded(n))s=this.get_node(n,!0),l=this,s.length&&(n.children.length&&!this._firstChild(s.children(".jstree-children")[0])&&(n.state.opened=!0,this.redraw_node(n,!0),s=this.get_node(n,!0)),r?(this.trigger("before_open",{node:n}),s.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(r,function(){this.style.display="",l.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),s[0].className=s[0].className.replace("jstree-closed","jstree-open"),s[0].setAttribute("aria-expanded",!0))),n.state.opened=!0,i&&i.call(this,n,!0),s.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),r&&s.length||this.trigger("after_open",{node:n});else{if(this.is_loading(n))return setTimeout(t.proxy(function(){this.open_node(n,i,r)},this),500);this.load_node(n,function(t,e){return e?this.open_node(t,i,r):!!i&&i.call(this,t,!1)})}},_open_to:function(e){if(!(e=this.get_node(e))||"#"===e.id)return!1;var n,i,r=e.parents;for(n=0,i=r.length;n<i;n+=1)"#"!==n&&this.open_node(r[n],!1,0);return t("#"+e.id.replace(t.jstree.idregex,"\\$&"),this.element)},close_node:function(n,i){var r,a,o,s;if(t.isArray(n)){for(n=n.slice(),r=0,a=n.length;r<a;r++)this.close_node(n[r],i);return!0}return!(!(n=this.get_node(n))||"#"===n.id)&&(!this.is_closed(n)&&(i=i===e?this.settings.core.animation:i,o=this,s=this.get_node(n,!0),s.length&&(i?s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(i,function(){this.style.display="",s.children(".jstree-children").remove(),o.trigger("after_close",{node:n})}):(s[0].className=s[0].className.replace("jstree-open","jstree-closed"),s.attr("aria-expanded",!1).children(".jstree-children").remove())),n.state.opened=!1,this.trigger("close_node",{node:n}),void(i&&s.length||this.trigger("after_close",{node:n}))))},toggle_node:function(e){var n,i;if(t.isArray(e)){for(e=e.slice(),n=0,i=e.length;n<i;n++)this.toggle_node(e[n]);return!0}return this.is_closed(e)?this.open_node(e):this.is_open(e)?this.close_node(e):void 0},open_all:function(t,e,n){if(t||(t="#"),!(t=this.get_node(t)))return!1;var i,r,a,o="#"===t.id?this.get_container_ul():this.get_node(t,!0);if(!o.length){for(i=0,r=t.children_d.length;i<r;i++)this.is_closed(this._model.data[t.children_d[i]])&&(this._model.data[t.children_d[i]].state.opened=!0);return this.trigger("open_all",{node:t})}n=n||o,a=this,o=this.is_closed(t)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(t,i){i&&this.is_parent(t)&&this.open_all(t,e,n)},e||0)}),0===n.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(n)})},close_all:function(e,n){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,r,a="#"===e.id?this.get_container_ul():this.get_node(e,!0),o=this;if(!a.length){for(i=0,r=e.children_d.length;i<r;i++)this._model.data[e.children_d[i]].state.opened=!1;return this.trigger("close_all",{node:e})}a=this.is_open(e)?a.find(".jstree-open").addBack():a.find(".jstree-open"),t(a.get().reverse()).each(function(){o.close_node(this,n||0)}),this.trigger("close_all",{node:e})},is_disabled:function(t){return(t=this.get_node(t))&&t.state&&t.state.disabled},enable_node:function(e){var n,i;if(t.isArray(e)){for(e=e.slice(),n=0,i=e.length;n<i;n++)this.enable_node(e[n]);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;e.state.disabled=!1,this.get_node(e,!0).children(".jstree-anchor").removeClass("jstree-disabled"),this.trigger("enable_node",{node:e})},disable_node:function(e){var n,i;if(t.isArray(e)){for(e=e.slice(),n=0,i=e.length;n<i;n++)this.disable_node(e[n]);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;e.state.disabled=!0,this.get_node(e,!0).children(".jstree-anchor").addClass("jstree-disabled"),this.trigger("disable_node",{node:e})},activate_node:function(t,n){if(this.is_disabled(t))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==e?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&(!n.shiftKey||this._data.core.last_clicked&&this.get_parent(t)&&this.get_parent(t)===this._data.core.last_clicked.parent))if(n.shiftKey){var i,r,a=this.get_node(t).id,o=this._data.core.last_clicked.id,s=this.get_node(this._data.core.last_clicked.parent).children,l=!1;for(i=0,r=s.length;i<r;i+=1)s[i]===a&&(l=!l),s[i]===o&&(l=!l),l||s[i]===a||s[i]===o?this.select_node(s[i],!1,!1,n):this.deselect_node(s[i],!1,n)}else this.is_selected(t)?this.deselect_node(t,!1,n):this.select_node(t,!1,!1,n);else!this.settings.core.multiple&&(n.metaKey||n.ctrlKey||n.shiftKey)&&this.is_selected(t)?this.deselect_node(t,!1,n):(this.deselect_all(!0),this.select_node(t,!1,!1,n),this._data.core.last_clicked=this.get_node(t));this.trigger("activate_node",{node:this.get_node(t)})},hover_node:function(t){if(!(t=this.get_node(t,!0))||!t.length||t.children(".jstree-hovered").length)return!1;var e=this.element.find(".jstree-hovered"),n=this.element;e&&e.length&&this.dehover_node(e),t.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(t)}),setTimeout(function(){n.attr("aria-activedescendant",t[0].id),t.attr("aria-selected",!0)},0)},dehover_node:function(t){if(!(t=this.get_node(t,!0))||!t.length||!t.children(".jstree-hovered").length)return!1;t.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(t)})},select_node:function(e,n,i,r){var a,o,s;if(t.isArray(e)){for(e=e.slice(),o=0,s=e.length;o<s;o++)this.select_node(e[o],n,i,r);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;a=this.get_node(e,!0),e.state.selected||(e.state.selected=!0,this._data.core.selected.push(e.id),i||(a=this._open_to(e)),a&&a.length&&a.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:e,selected:this._data.core.selected,event:r}),n||this.trigger("changed",{action:"select_node",node:e,selected:this._data.core.selected,event:r}))},deselect_node:function(e,n,i){var r,a,o;if(t.isArray(e)){for(e=e.slice(),r=0,a=e.length;r<a;r++)this.deselect_node(e[r],n,i);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;o=this.get_node(e,!0),e.state.selected&&(e.state.selected=!1,this._data.core.selected=t.vakata.array_remove_item(this._data.core.selected,e.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:e,selected:this._data.core.selected,event:i}),n||this.trigger("changed",{action:"deselect_node",node:e,selected:this._data.core.selected,event:i}))},select_all:function(t){var e,n,i=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),e=0,n=this._data.core.selected.length;e<n;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),t||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:i})},deselect_all:function(t){var e,n,i=this._data.core.selected.concat([]);for(e=0,n=this._data.core.selected.length;e<n;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked"),this.trigger("deselect_all",{selected:this._data.core.selected,node:i}),t||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(t){return!(!(t=this.get_node(t))||"#"===t.id)&&t.state.selected},get_selected:function(e){return e?t.map(this._data.core.selected,t.proxy(function(t){return this.get_node(t)},this)):this._data.core.selected.slice()},get_top_selected:function(e){var n,i,r,a,o=this.get_selected(!0),s={};for(n=0,i=o.length;n<i;n++)s[o[n].id]=o[n];for(n=0,i=o.length;n<i;n++)for(r=0,a=o[n].children_d.length;r<a;r++)s[o[n].children_d[r]]&&delete s[o[n].children_d[r]];o=[];for(n in s)s.hasOwnProperty(n)&&o.push(n);return e?t.map(o,t.proxy(function(t){return this.get_node(t)},this)):o},get_bottom_selected:function(e){var n,i,r=this.get_selected(!0),a=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||a.push(r[n].id);return e?t.map(a,t.proxy(function(t){return this.get_node(t)},this)):a},get_state:function(){var t,e={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},/*!
					'themes' : {
						'name' : this.get_theme(),
						'icons' : this._data.core.themes.icons,
						'dots' : this._data.core.themes.dots
					},
					*/
selected:[]}};for(t in this._model.data)this._model.data.hasOwnProperty(t)&&"#"!==t&&(this._model.data[t].state.opened&&e.core.open.push(t),this._model.data[t].state.selected&&e.core.selected.push(t));return e},set_state:function(n,i){if(n){if(n.core){var r,a,o,s;if(n.core.open)return t.isArray(n.core.open)?(r=!0,a=!1,o=this,t.each(n.core.open.concat([]),function(e,s){(a=o.get_node(s))&&(o.is_loaded(s)?(o.is_closed(s)&&o.open_node(s,!1,0),n&&n.core&&n.core.open&&t.vakata.array_remove_item(n.core.open,s)):(o.is_loading(s)||o.open_node(s,t.proxy(function(e,r){!r&&n&&n.core&&n.core.open&&t.vakata.array_remove_item(n.core.open,e.id),this.set_state(n,i)},o),0),r=!1))}),r&&(delete n.core.open,this.set_state(n,i)),!1):(delete n.core.open,this.set_state(n,i),!1);if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==e&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==e&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,i),!1;/*!
					if(state.core.themes) {
						if(state.core.themes.name) {
							this.set_theme(state.core.themes.name);
						}
						if(typeof state.core.themes.dots !== 'undefined') {
							this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
						}
						if(typeof state.core.themes.icons !== 'undefined') {
							this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
						}
						delete state.core.themes;
						delete state.core.open;
						this.set_state(state, callback);
						return false;
					}
					*/
if(n.core.selected)return s=this,this.deselect_all(),t.each(n.core.selected,function(t,e){s.select_node(e)}),delete n.core.selected,this.set_state(n,i),!1;if(t.isEmptyObject(n.core))return delete n.core,this.set_state(n,i),!1}return!t.isEmptyObject(n)||(n=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(e,n){this._data.core.state=!0===n?{}:this.get_state(),n&&t.isFunction(n)&&(this._data.core.state=n.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var i=this.get_container_ul()[0].className;e||this.element.html("<ul class='"+i+"'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.load_node("#",function(e,n){n&&(this.get_container_ul()[0].className=i,this.set_state(t.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(e){if(!(e=this.get_node(e))||"#"===e.id)return!1;var n=[],i=[];this._data.core.selected.concat([]);i.push(e.id),!0===e.state.opened&&n.push(e.id),this.get_node(e,!0).find(".jstree-open").each(function(){n.push(this.id)}),this._load_nodes(i,t.proxy(function(t){this.open_node(n,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:e,nodes:t})},this))},set_id:function(e,n){if(!(e=this.get_node(e))||"#"===e.id)return!1;var i,r,a=this._model.data;for(n=n.toString(),a[e.parent].children[t.inArray(e.id,a[e.parent].children)]=n,i=0,r=e.parents.length;i<r;i++)a[e.parents[i]].children_d[t.inArray(e.id,a[e.parents[i]].children_d)]=n;for(i=0,r=e.children.length;i<r;i++)a[e.children[i]].parent=n;for(i=0,r=e.children_d.length;i<r;i++)a[e.children_d[i]].parents[t.inArray(e.id,a[e.children_d[i]].parents)]=n;return i=t.inArray(e.id,this._data.core.selected),-1!==i&&(this._data.core.selected[i]=n),i=this.get_node(e.id,!0),i&&i.attr("id",n),delete a[e.id],e.id=n,a[n]=e,!0},get_text:function(t){return!(!(t=this.get_node(t))||"#"===t.id)&&t.text},set_text:function(e,n){var i,r;if(t.isArray(e)){for(e=e.slice(),i=0,r=e.length;i<r;i++)this.set_text(e[i],n);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(e.text=n,this.get_node(e,!0).length&&this.redraw_node(e.id),this.trigger("set_text",{obj:e,text:n}),!0)},get_json:function(t,e,n){if(!(t=this.get_node(t||"#")))return!1;e&&e.flat&&!n&&(n=[]);var i,r,a={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:t.li_attr,a_attr:t.a_attr,state:{},data:(!e||!e.no_data)&&t.data};if(e&&e.flat?a.parent=t.parent:a.children=[],!e||!e.no_state)for(i in t.state)t.state.hasOwnProperty(i)&&(a.state[i]=t.state[i]);if(e&&e.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id),e&&e.flat&&"#"!==t.id&&n.push(a),!e||!e.no_children)for(i=0,r=t.children.length;i<r;i++)e&&e.flat?this.get_json(t.children[i],e,n):a.children.push(this.get_json(t.children[i],e));return e&&e.flat?n:"#"===t.id?a.children:a},create_node:function(n,i,r,a,o){if(null===n&&(n="#"),!(n=this.get_node(n)))return!1;if(r=r===e?"last":r,!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,i,r,a,!0)});i||(i={text:this.get_string("New node")}),i.text===e&&(i.text=this.get_string("New node"));var s,l,c,d;switch("#"===n.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":s=this.get_node(n.parent),r=t.inArray(n.id,s.children),n=s;break;case"after":s=this.get_node(n.parent),r=t.inArray(n.id,s.children)+1,n=s;break;case"inside":case"first":r=0;break;case"last":r=n.children.length;break;default:r||(r=0)}if(r>n.children.length&&(r=n.children.length),i.id||(i.id=!0),!this.check("create_node",i,n,r))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===i.id&&delete i.id,!(i=this._parse_model_from_json(i,n.id,n.parents.concat())))return!1;for(s=this.get_node(i),l=[],l.push(i),l=l.concat(s.children_d),this.trigger("model",{nodes:l,parent:n.id}),n.children_d=n.children_d.concat(l),c=0,d=n.parents.length;c<d;c++)this._model.data[n.parents[c]].children_d=this._model.data[n.parents[c]].children_d.concat(l);for(i=s,s=[],c=0,d=n.children.length;c<d;c++)s[c>=r?c+1:c]=n.children[c];return s[r]=i.id,n.children=s,this.redraw_node(n,!0),a&&a.call(this,this.get_node(i)),this.trigger("create_node",{node:this.get_node(i),parent:n.id,position:r}),i.id},rename_node:function(e,n){var i,r,a;if(t.isArray(e)){for(e=e.slice(),i=0,r=e.length;i<r;i++)this.rename_node(e[i],n);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(a=e.text,this.check("rename_node",e,this.get_parent(e),n)?(this.set_text(e,n),this.trigger("rename_node",{node:e,text:n,old:a}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(e){var n,i,r,a,o,s,l,c,d,u;if(t.isArray(e)){for(e=e.slice(),n=0,i=e.length;n<i;n++)this.delete_node(e[n]);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;if(r=this.get_node(e.parent),a=t.inArray(e.id,r.children),u=!1,!this.check("delete_node",e,r,a))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==a&&(r.children=t.vakata.array_remove(r.children,a)),o=e.children_d.concat([]),o.push(e.id),c=0,d=o.length;c<d;c++){for(s=0,l=e.parents.length;s<l;s++)-1!==(a=t.inArray(o[c],this._model.data[e.parents[s]].children_d))&&(this._model.data[e.parents[s]].children_d=t.vakata.array_remove(this._model.data[e.parents[s]].children_d,a));this._model.data[o[c]].state.selected&&(u=!0,-1!==(a=t.inArray(o[c],this._data.core.selected))&&(this._data.core.selected=t.vakata.array_remove(this._data.core.selected,a)))}for(this.trigger("delete_node",{node:e,parent:r.id}),u&&this.trigger("changed",{action:"delete_node",node:e,selected:this._data.core.selected,parent:r.id}),c=0,d=o.length;c<d;c++)delete this._model.data[o[c]];return this.redraw_node(r,!0),!0},check:function(e,n,i,r,a){n=n&&n.id?n:this.get_node(n),i=i&&i.id?i:this.get_node(i);var o=e.match(/^move_node|copy_node|create_node$/i)?i:n,s=this.settings.core.check_callback;return"move_node"!==e&&"copy_node"!==e||a&&a.is_multi||n.id!==i.id&&t.inArray(n.id,i.children)!==r&&-1===t.inArray(i.id,n.children_d)?(o&&o.data&&(o=o.data),o&&o.functions&&(!1===o.functions[e]||!0===o.functions[e])?(!1===o.functions[e]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})}),o.functions[e]):!(!1===s||t.isFunction(s)&&!1===s.call(this,e,n,i,r,a)||s&&!1===s[e])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+e,data:JSON.stringify({chk:e,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:e,pos:r,obj:!(!n||!n.id)&&n.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(n,i,r,a,o){var s,l,c,d,u,h,f,p,_,g,m,v,y,b;if(i=this.get_node(i),r=r===e?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.move_node(n,i,r,a,!0)});if(t.isArray(n)){for(n=n.reverse().slice(),s=0,l=n.length;s<l;s++)this.move_node(n[s],i,r,a,o);return!0}if(!(n=n&&n.id?n:this.get_node(n))||"#"===n.id)return!1;if(c=(n.parent||"#").toString(),u=r.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,h=n.instance?n.instance:this._model.data[n.id]?this:t.jstree.reference(n.id),f=!h||!h._id||this._id!==h._id,d=h&&h._id&&c&&h._model.data[c]&&h._model.data[c].children?t.inArray(n.id,h._model.data[c].children):-1,f)return!!this.copy_node(n,i,r,a,o)&&(h&&h.delete_node(n),!0);switch("#"===u.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=t.inArray(i.id,u.children);break;case"after":r=t.inArray(i.id,u.children)+1;break;case"inside":case"first":r=0;break;case"last":r=u.children.length;break;default:r||(r=0)}if(r>u.children.length&&(r=u.children.length),!this.check("move_node",n,u,r,{core:!0,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===u.id){for(p=u.children.concat(),_=t.inArray(n.id,p),-1!==_&&(p=t.vakata.array_remove(p,_),r>_&&r--),_=[],g=0,m=p.length;g<m;g++)_[g>=r?g+1:g]=p[g];_[r]=n.id,u.children=_,this._node_changed(u.id),this.redraw("#"===u.id)}else{for(_=n.children_d.concat(),_.push(n.id),g=0,m=n.parents.length;g<m;g++){for(p=[],b=h._model.data[n.parents[g]].children_d,v=0,y=b.length;v<y;v++)-1===t.inArray(b[v],_)&&p.push(b[v]);h._model.data[n.parents[g]].children_d=p}for(h._model.data[c].children=t.vakata.array_remove_item(h._model.data[c].children,n.id),g=0,m=u.parents.length;g<m;g++)this._model.data[u.parents[g]].children_d=this._model.data[u.parents[g]].children_d.concat(_);for(p=[],g=0,m=u.children.length;g<m;g++)p[g>=r?g+1:g]=u.children[g];for(p[r]=n.id,u.children=p,u.children_d.push(n.id),u.children_d=u.children_d.concat(n.children_d),n.parent=u.id,_=u.parents.concat(),_.unshift(u.id),b=n.parents.length,n.parents=_,_=_.concat(),g=0,m=n.children_d.length;g<m;g++)this._model.data[n.children_d[g]].parents=this._model.data[n.children_d[g]].parents.slice(0,-1*b),Array.prototype.push.apply(this._model.data[n.children_d[g]].parents,_);this._node_changed(c),this._node_changed(u.id),this.redraw("#"===c||"#"===u.id)}return a&&a.call(this,n,u,r),this.trigger("move_node",{node:n,parent:u.id,position:r,old_parent:c,old_position:d,is_multi:h&&h._id&&h._id!==this._id,is_foreign:!h||!h._id,old_instance:h,new_instance:this}),!0},copy_node:function(n,i,r,a,o){var s,l,c,d,u,h,f,p,_,g;if(i=this.get_node(i),r=r===e?0:r,!i)return!1;if(!r.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.copy_node(n,i,r,a,!0)});if(t.isArray(n)){for(n=n.reverse().slice(),s=0,l=n.length;s<l;s++)this.copy_node(n[s],i,r,a,o);return!0}if(!(n=n&&n.id?n:this.get_node(n))||"#"===n.id)return!1;switch(p=(n.parent||"#").toString(),_=r.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,g=n.instance?n.instance:this._model.data[n.id]?this:t.jstree.reference(n.id),!g||!g._id||this._id!==g._id,"#"===_.id&&("before"===r&&(r="first"),"after"===r&&(r="last")),r){case"before":r=t.inArray(i.id,_.children);break;case"after":r=t.inArray(i.id,_.children)+1;break;case"inside":case"first":r=0;break;case"last":r=_.children.length;break;default:r||(r=0)}if(r>_.children.length&&(r=_.children.length),!this.check("copy_node",n,_,r,{core:!0,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(f=g?g.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n))return!1;if(!0===f.id&&delete f.id,!(f=this._parse_model_from_json(f,_.id,_.parents.concat())))return!1;for(d=this.get_node(f),n&&n.state&&!1===n.state.loaded&&(d.state.loaded=!1),c=[],c.push(f),c=c.concat(d.children_d),this.trigger("model",{nodes:c,parent:_.id}),u=0,h=_.parents.length;u<h;u++)this._model.data[_.parents[u]].children_d=this._model.data[_.parents[u]].children_d.concat(c);for(c=[],u=0,h=_.children.length;u<h;u++)c[u>=r?u+1:u]=_.children[u];return c[r]=d.id,_.children=c,_.children_d.push(d.id),_.children_d=_.children_d.concat(d.children_d),this._node_changed(_.id),this.redraw("#"===_.id),a&&a.call(this,d,_,r),this.trigger("copy_node",{node:d,original:n,parent:_.id,position:r,old_parent:p,old_position:g&&g._id&&p&&g._model.data[p]&&g._model.data[p].children?t.inArray(n.id,g._model.data[p].children):-1,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),d.id},cut:function(e){if(e||(e=this._data.core.selected.concat()),t.isArray(e)||(e=[e]),!e.length)return!1;var n,i,r,l=[];for(i=0,r=e.length;i<r;i++)(n=this.get_node(e[i]))&&n.id&&"#"!==n.id&&l.push(n);if(!l.length)return!1;a=l,s=this,o="move_node",this.trigger("cut",{node:e})},copy:function(e){if(e||(e=this._data.core.selected.concat()),t.isArray(e)||(e=[e]),!e.length)return!1;var n,i,r,l=[];for(i=0,r=e.length;i<r;i++)(n=this.get_node(e[i]))&&n.id&&"#"!==n.id&&l.push(n);if(!l.length)return!1;a=l,s=this,o="copy_node",this.trigger("copy",{node:e})},get_buffer:function(){return{mode:o,node:a,inst:s}},can_paste:function(){return!1!==o&&!1!==a},paste:function(t,e){if(!((t=this.get_node(t))&&o&&o.match(/^(copy_node|move_node)$/)&&a))return!1;this[o](a,t,e)&&this.trigger("paste",{parent:t.id,node:a,mode:o}),a=!1,o=!1,s=!1},edit:function(e,n){if(!(e=this.get_node(e)))return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;n="string"==typeof n?n:e.text,this.set_text(e,""),e=this._open_to(e);var i=this._data.core.rtl,r=this.element.width(),a=e.children(".jstree-anchor"),o=t("<span>"),/*!
				oi = obj.children("i:visible"),
				ai = a.children("i:visible"),
				w1 = oi.width() * oi.length,
				w2 = ai.width() * ai.length,
				*/
s=n,l=t("<div />",{css:{position:"absolute",top:"-200px",left:i?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),c=t("<input />",{value:s,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:t.proxy(function(){var n=o.children(".jstree-rename-input"),i=n.val();""===i&&(i=s),l.remove(),o.replaceWith(a),o.remove(),this.set_text(e,s),!1===this.rename_node(e,t("<div></div>").text(i)[this.settings.core.force_text?"text":"html"]())&&this.set_text(e,s)},this),keydown:function(t){var e=t.which;27===e&&(this.value=s),27!==e&&13!==e&&37!==e&&38!==e&&39!==e&&40!==e&&32!==e||t.stopImmediatePropagation(),27!==e&&13!==e||(t.preventDefault(),this.blur())},click:function(t){t.stopImmediatePropagation()},mousedown:function(t){t.stopImmediatePropagation()},keyup:function(t){c.width(Math.min(l.text("pW"+this.value).width(),r))},keypress:function(t){if(13===t.which)return!1}}),d={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""};o.attr("class",a.attr("class")).append(a.contents().clone()).append(c),a.replaceWith(o),l.css(d),c.css(d).width(Math.min(l.text("pW"+c[0].value).width(),r))[0].select()},set_theme:function(e,n){if(!e)return!1;if(!0===n){var i=this.settings.core.themes.dir;i||(i=t.jstree.path+"/themes"),n=i+"/"+e+"/style.css"}n&&-1===t.inArray(n,l)&&(t("head").append('<link rel="stylesheet" href="'+n+'" type="text/css" />'),l.push(n)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=e,this.element.addClass("jstree-"+e),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+e+"-responsive"),this.trigger("set_theme",{theme:e})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(t){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=t,t&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(e,n){var i,r,a,o;if(t.isArray(e)){for(e=e.slice(),i=0,r=e.length;i<r;i++)this.set_icon(e[i],n);return!0}return!(!(e=this.get_node(e))||"#"===e.id)&&(o=e.icon,e.icon=n,a=this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===n?this.hide_icon(e):!0===n?a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"):-1===n.indexOf("/")&&-1===n.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(n+" jstree-themeicon-custom").attr("rel",n)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+n+"') center center no-repeat").attr("rel",n)),!0)},get_icon:function(t){return!(!(t=this.get_node(t))||"#"===t.id)&&t.icon},hide_icon:function(e){var n,i;if(t.isArray(e)){for(e=e.slice(),n=0,i=e.length;n<i;n++)this.hide_icon(e[n]);return!0}return!(!(e=this.get_node(e))||"#"===e)&&(e.icon=!1,this.get_node(e,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(e){var n,i,r;if(t.isArray(e)){for(e=e.slice(),n=0,i=e.length;n<i;n++)this.show_icon(e[n]);return!0}return!(!(e=this.get_node(e))||"#"===e)&&(r=this.get_node(e,!0),e.icon=!r.length||r.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),e.icon||(e.icon=!0),r.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},t.vakata={},t.vakata.attributes=function(e,n){e=t(e)[0];var i=n?{}:[];return e&&e.attributes&&t.each(e.attributes,function(e,r){-1===t.inArray(r.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==r.nodeValue&&""!==t.trim(r.nodeValue)&&(n?i[r.nodeName]=r.nodeValue:i.push(r.nodeName))}),i},t.vakata.array_unique=function(t){var e,n,i,r=[];for(e=0,i=t.length;e<i;e++){for(n=0;n<=e&&t[e]!==t[n];n++);n===e&&r.push(t[e])}return r},t.vakata.array_remove=function(t,e,n){var i=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,i),t},t.vakata.array_remove_item=function(e,n){var i=t.inArray(n,e);return-1!==i?t.vakata.array_remove(e,i):e};var h=document.createElement("I");h.className="jstree-icon jstree-checkbox",t.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},t.jstree.plugins.checkbox=function(e,n){this.bind=function(){n.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",t.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",t.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",t.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(t.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",t.proxy(function(t,e){var n,i,r=this._model.data,a=(r[e.parent],e.nodes);for(n=0,i=a.length;n<i;n++)r[a[n]].state.checked=r[a[n]].original&&r[a[n]].original.state&&r[a[n]].original.state.checked,r[a[n]].state.checked&&this._data.checkbox.selected.push(a[n])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",t.proxy(function(e,n){var i,r,a,o,s,l,c=this._model.data,d=c[n.parent],u=n.nodes,h=[],f=this.settings.checkbox.cascade,p=this.settings.checkbox.tie_selection;if(-1!==f.indexOf("down"))if(d.state[p?"selected":"checked"]){for(r=0,a=u.length;r<a;r++)c[u[r]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(u)}else for(r=0,a=u.length;r<a;r++)if(c[u[r]].state[p?"selected":"checked"]){for(o=0,s=c[u[r]].children_d.length;o<s;o++)c[c[u[r]].children_d[o]].state[p?"selected":"checked"]=!0;this._data[p?"core":"checkbox"].selected=this._data[p?"core":"checkbox"].selected.concat(c[u[r]].children_d)}if(-1!==f.indexOf("up")){for(r=0,a=d.children_d.length;r<a;r++)c[d.children_d[r]].children.length||h.push(c[d.children_d[r]].parent);for(h=t.vakata.array_unique(h),o=0,s=h.length;o<s;o++)for(d=c[h[o]];d&&"#"!==d.id;){for(i=0,r=0,a=d.children.length;r<a;r++)i+=c[d.children[r]].state[p?"selected":"checked"];if(i!==a)break;d.state[p?"selected":"checked"]=!0,this._data[p?"core":"checkbox"].selected.push(d.id),(l=this.get_node(d,!0))&&l.length&&l.children(".jstree-anchor").addClass(p?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}}this._data[p?"core":"checkbox"].selected=t.vakata.array_unique(this._data[p?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",t.proxy(function(e,n){var i,r,a,o,s=n.node,l=this._model.data,c=this.get_node(s.parent),d=this.get_node(s,!0),u=this.settings.checkbox.cascade,h=this.settings.checkbox.tie_selection;if(-1!==u.indexOf("down"))for(this._data[h?"core":"checkbox"].selected=t.vakata.array_unique(this._data[h?"core":"checkbox"].selected.concat(s.children_d)),i=0,r=s.children_d.length;i<r;i++)o=l[s.children_d[i]],o.state[h?"selected":"checked"]=!0,o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1);if(-1!==u.indexOf("up"))for(;c&&"#"!==c.id;){for(a=0,i=0,r=c.children.length;i<r;i++)a+=l[c.children[i]].state[h?"selected":"checked"];if(a!==r)break;c.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(c.id),(o=this.get_node(c,!0))&&o.length&&o.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}-1!==u.indexOf("down")&&d.length&&d.find(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked")},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",t.proxy(function(t,e){var n,i,r,a=this.get_node("#"),o=this._model.data;for(n=0,i=a.children_d.length;n<i;n++)(r=o[a.children_d[n]])&&r.original&&r.original.state&&r.original.state.undetermined&&(r.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",t.proxy(function(e,n){var i,r,a,o=n.node,s=this.get_node(o,!0),l=this.settings.checkbox.cascade,c=this.settings.checkbox.tie_selection;if(o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1),-1!==l.indexOf("down"))for(i=0,r=o.children_d.length;i<r;i++)a=this._model.data[o.children_d[i]],a.state[c?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(i=0,r=o.parents.length;i<r;i++)a=this._model.data[o.parents[i]],a.state[c?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),(a=this.get_node(o.parents[i],!0))&&a.length&&a.children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked");for(a=[],i=0,r=this._data[c?"core":"checkbox"].selected.length;i<r;i++)-1!==l.indexOf("down")&&-1!==t.inArray(this._data[c?"core":"checkbox"].selected[i],o.children_d)||-1!==l.indexOf("up")&&-1!==t.inArray(this._data[c?"core":"checkbox"].selected[i],o.parents)||a.push(this._data[c?"core":"checkbox"].selected[i]);this._data[c?"core":"checkbox"].selected=t.vakata.array_unique(a),-1!==l.indexOf("down")&&s.length&&s.find(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked")},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",t.proxy(function(t,e){for(var n,i,r,a,o=this.get_node(e.parent),s=this._model.data,l=this.settings.checkbox.tie_selection;o&&"#"!==o.id;){for(r=0,n=0,i=o.children.length;n<i;n++)r+=s[o.children[n]].state[l?"selected":"checked"];if(r!==i)break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),(a=this.get_node(o,!0))&&a.length&&a.children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",t.proxy(function(e,n){var i,r,a,o,s,l=n.is_multi,c=n.old_parent,d=this.get_node(n.parent),u=this._model.data,h=this.settings.checkbox.tie_selection;if(!l)for(i=this.get_node(c);i&&"#"!==i.id;){for(r=0,a=0,o=i.children.length;a<o;a++)r+=u[i.children[a]].state[h?"selected":"checked"];if(r!==o)break;i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=d;i&&"#"!==i.id;){for(r=0,a=0,o=i.children.length;a<o;a++)r+=u[i.children[a]].state[h?"selected":"checked"];if(r===o)i.state[h?"selected":"checked"]||(i.state[h?"selected":"checked"]=!0,this._data[h?"core":"checkbox"].selected.push(i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").addClass(h?"jstree-clicked":"jstree-checked"));else{if(!i.state[h?"selected":"checked"])break;i.state[h?"selected":"checked"]=!1,this._data[h?"core":"checkbox"].selected=t.vakata.array_remove_item(this._data[h?"core":"checkbox"].selected,i.id),(s=this.get_node(i,!0))&&s.length&&s.children(".jstree-anchor").removeClass(h?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}},this))},this._undetermined=function(){var e,n,i=this._model.data,r=this.settings.checkbox.tie_selection,a=this._data[r?"core":"checkbox"].selected,o=[],s=this;for(e=0,n=a.length;e<n;e++)i[a[e]]&&i[a[e]].parents&&(o=o.concat(i[a[e]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var t,r=s.get_node(this);if(r.state.loaded)for(e=0,n=r.children_d.length;e<n;e++)t=i[r.children_d[e]],!t.state.loaded&&t.original&&t.original.state&&t.original.state.undetermined&&!0===t.original.state.undetermined&&(o.push(t.id),o=o.concat(t.parents));else r.original&&r.original.state&&r.original.state.undetermined&&!0===r.original.state.undetermined&&(o.push(r.id),o=o.concat(r.parents))}),o=t.vakata.array_unique(o),o=t.vakata.array_remove_item(o,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),e=0,n=o.length;e<n;e++)i[o[e]].state[r?"selected":"checked"]||(a=this.get_node(o[e],!0))&&a.length&&a.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(e,i,r){if(e=n.redraw_node.call(this,e,i,r)){var a,o,s=null;for(a=0,o=e.childNodes.length;a<o;a++)if(e.childNodes[a]&&e.childNodes[a].className&&-1!==e.childNodes[a].className.indexOf("jstree-anchor")){s=e.childNodes[a];break}s&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(s.className+=" jstree-checked"),s.insertBefore(h.cloneNode(!1),s.childNodes[0]))}return r||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(t.proxy(this._undetermined,this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(e){e=this.get_node(e);var n,i,r=this.settings.checkbox.cascade,a=this.settings.checkbox.tie_selection,o=this._data[a?"core":"checkbox"].selected,s=this._model.data;if(!e||!0===e.state[a?"selected":"checked"]||-1===r.indexOf("undetermined")||-1===r.indexOf("down")&&-1===r.indexOf("up"))return!1;if(!e.state.loaded&&!0===e.original.state.undetermined)return!0;for(n=0,i=e.children_d.length;n<i;n++)if(-1!==t.inArray(e.children_d[n],o)||!s[e.children_d[n]].state.loaded&&s[e.children_d[n]].original.state.undetermined)return!0;return!1},this.activate_node=function(e,i){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||t(i.target).hasClass("jstree-checkbox"))&&(i.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!t(i.target).hasClass("jstree-checkbox"))return n.activate_node.call(this,e,i);this.is_checked(e)?this.uncheck_node(e,i):this.check_node(e,i),this.trigger("activate_node",{node:this.get_node(e)})},this.check_node=function(e,n){if(this.settings.checkbox.tie_selection)return this.select_node(e,!1,!0,n);var i,r,a;if(t.isArray(e)){for(e=e.slice(),r=0,a=e.length;r<a;r++)this.check_node(e[r],n);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;i=this.get_node(e,!0),e.state.checked||(e.state.checked=!0,this._data.checkbox.selected.push(e.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:e,selected:this._data.checkbox.selected,event:n}))},this.uncheck_node=function(e,n){if(this.settings.checkbox.tie_selection)return this.deselect_node(e,!1,n);var i,r,a;if(t.isArray(e)){for(e=e.slice(),i=0,r=e.length;i<r;i++)this.uncheck_node(e[i],n);return!0}if(!(e=this.get_node(e))||"#"===e.id)return!1;a=this.get_node(e,!0),e.state.checked&&(e.state.checked=!1,this._data.checkbox.selected=t.vakata.array_remove_item(this._data.checkbox.selected,e.id),a.length&&a.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:e,selected:this._data.checkbox.selected,event:n}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var t,e;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),t=0,e=this._data.checkbox.selected.length;t<e;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var t,e,n=this._data.checkbox.selected.concat([]);for(t=0,e=this._data.checkbox.selected.length;t<e;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:n})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(!(t=this.get_node(t))||"#"===t.id)&&t.state.checked},this.get_checked=function(e){return this.settings.checkbox.tie_selection?this.get_selected(e):e?t.map(this._data.checkbox.selected,t.proxy(function(t){return this.get_node(t)},this)):this._data.checkbox.selected},this.get_top_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_top_selected(e);var n,i,r,a,o=this.get_checked(!0),s={};for(n=0,i=o.length;n<i;n++)s[o[n].id]=o[n];for(n=0,i=o.length;n<i;n++)for(r=0,a=o[n].children_d.length;r<a;r++)s[o[n].children_d[r]]&&delete s[o[n].children_d[r]];o=[];for(n in s)s.hasOwnProperty(n)&&o.push(n);return e?t.map(o,t.proxy(function(t){return this.get_node(t)},this)):o},this.get_bottom_checked=function(e){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(e);var n,i,r=this.get_checked(!0),a=[];for(n=0,i=r.length;n<i;n++)r[n].children.length||a.push(r[n].id);return e?t.map(a,t.proxy(function(t){return this.get_node(t)},this)):a}},t.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(e,n){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(e){var n=t.jstree.reference(e.reference),i=n.get_node(e.reference);n.create_node(i,{},"last",function(t){setTimeout(function(){n.edit(t)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(e){var n=t.jstree.reference(e.reference),i=n.get_node(e.reference);n.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(e){var n=t.jstree.reference(e.reference),i=n.get_node(e.reference);n.is_selected(i)?n.delete_node(n.get_selected()):n.delete_node(i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(e){var n=t.jstree.reference(e.reference),i=n.get_node(e.reference);n.is_selected(i)?n.cut(n.get_selected()):n.cut(i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(e){var n=t.jstree.reference(e.reference),i=n.get_node(e.reference);n.is_selected(i)?n.copy(n.get_selected()):n.copy(i)}},paste:{separator_before:!1,icon:!1,_disabled:function(e){return!t.jstree.reference(e.reference).can_paste()},separator_after:!1,label:"Paste",action:function(e){var n=t.jstree.reference(e.reference),i=n.get_node(e.reference);n.paste(i)}}}}}}},t.jstree.plugins.contextmenu=function(n,i){this.bind=function(){i.bind.call(this);var e=0;this.element.on("contextmenu.jstree",".jstree-anchor",t.proxy(function(t){t.preventDefault(),e=t.ctrlKey?t.timeStamp:0,this.is_loading(t.currentTarget)||this.show_contextmenu(t.currentTarget,t.pageX,t.pageY,t)},this)).on("click.jstree",".jstree-anchor",t.proxy(function(n){this._data.contextmenu.visible&&(!e||n.timeStamp-e>250)&&t.vakata.context.hide()},this)),t(document).on("context_hide.vakata",t.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&t.vakata.context.hide(),i.teardown.call(this)},this.show_contextmenu=function(n,i,r,a){if(!(n=this.get_node(n))||"#"===n.id)return!1;var o=this.settings.contextmenu,s=this.get_node(n,!0),l=s.children(".jstree-anchor"),c=!1,d=!1;(o.show_at_node||i===e||r===e)&&(c=l.offset(),i=c.left,r=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,a),d=o.items,t.isFunction(d)&&(d=d.call(this,n,t.proxy(function(t){this._show_contextmenu(n,i,r,t)},this))),t.isPlainObject(d)&&this._show_contextmenu(n,i,r,d)},this._show_contextmenu=function(e,n,i,r){var a=this.get_node(e,!0),o=a.children(".jstree-anchor");t(document).one("context_show.vakata",t.proxy(function(e,n){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";t(n.element).addClass(i)},this)),this._data.contextmenu.visible=!0,t.vakata.context.show(o,{x:n,y:i},r),this.trigger("show_contextmenu",{node:e,x:n,y:i})}},function(t){var e=!1,n={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};t.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(e){t(document).triggerHandler("context_"+e+".vakata",{reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_execute:function(e){return!(!(e=n.items[e])||e._disabled&&(!t.isFunction(e._disabled)||e._disabled({item:e,reference:n.reference,element:n.element}))||!e.action)&&e.action.call(null,{item:e,reference:n.reference,element:n.element,position:{x:n.position_x,y:n.position_y}})},_parse:function(e,i){if(!e)return!1;i||(n.html="",n.items=[]);var r,a="",o=!1;return i&&(a+="<ul>"),t.each(e,function(e,i){if(!i)return!0;n.items.push(i),!o&&i.separator_before&&(a+="<li class='vakata-context-separator'><a href='#' "+(t.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),o=!1,a+="<li class='"+(i._class||"")+(!0===i._disabled||t.isFunction(i._disabled)&&i._disabled({item:i,reference:n.reference,element:n.element})?" vakata-contextmenu-disabled ":"")+"' "+(i.shortcut?" data-shortcut='"+i.shortcut+"' ":"")+">",a+="<a href='#' rel='"+(n.items.length-1)+"'>",t.vakata.context.settings.icons&&(a+="<i ",i.icon&&(-1!==i.icon.indexOf("/")||-1!==i.icon.indexOf(".")?a+=" style='background:url(\""+i.icon+"\") center center no-repeat' ":a+=" class='"+i.icon+"' "),a+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),a+=(t.isFunction(i.label)?i.label({item:e,reference:n.reference,element:n.element}):i.label)+(i.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+i.shortcut+'">'+(i.shortcut_label||"")+"</span>":"")+"</a>",i.submenu&&(r=t.vakata.context._parse(i.submenu,!0))&&(a+=r),a+="</li>",i.separator_after&&(a+="<li class='vakata-context-separator'><a href='#' "+(t.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",o=!0)}),a=a.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),i&&(a+="</ul>"),i||(n.html=a,t.vakata.context._trigger("parse")),a.length>10&&a},_show_submenu:function(n){if(n=t(n),n.length&&n.children("ul").length){var i=n.children("ul"),r=n.offset().left+n.outerWidth(),a=n.offset().top,o=i.width(),s=i.height(),l=t(window).width()+t(window).scrollLeft(),c=t(window).height()+t(window).scrollTop();e?n[r-(o+10+n.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):n[r+o+10>l?"addClass":"removeClass"]("vakata-context-right"),a+s+10>c&&i.css("bottom","-1px"),i.show()}},show:function(i,r,a){var o,s,l,c,d,u,h,f;switch(n.element&&n.element.length&&n.element.width(""),!0){case!r&&!i:return!1;case!!r&&!!i:n.reference=i,n.position_x=r.x,n.position_y=r.y;break;case!r&&!!i:n.reference=i,o=i.offset(),n.position_x=o.left+i.outerHeight(),n.position_y=o.top;break;case!!r&&!i:n.position_x=r.x,n.position_y=r.y}i&&!a&&t(i).data("vakata_contextmenu")&&(a=t(i).data("vakata_contextmenu")),t.vakata.context._parse(a)&&n.element.html(n.html),n.items.length&&(s=n.element,l=n.position_x,c=n.position_y,d=s.width(),u=s.height(),h=t(window).width()+t(window).scrollLeft(),f=t(window).height()+t(window).scrollTop(),e&&(l-=s.outerWidth())<t(window).scrollLeft()+20&&(l=t(window).scrollLeft()+20),l+d+20>h&&(l=h-(d+20)),c+u+20>f&&(c=f-(u+20)),n.element.css({left:l,top:c}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),n.is_visible=!0,t.vakata.context._trigger("show"))},hide:function(){n.is_visible&&(n.element.hide().find("ul").hide().end().find(":focus").blur(),n.is_visible=!1,t.vakata.context._trigger("hide"))}},t(function(){e="rtl"===t("body").css("direction");var i=!1;n.element=t("<ul class='vakata-context'></ul>"),n.element.on("mouseenter","li",function(e){e.stopImmediatePropagation(),t.contains(this,e.relatedTarget)||(i&&clearTimeout(i),n.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),t(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),t.vakata.context._show_submenu(this))}).on("mouseleave","li",function(e){t.contains(this,e.relatedTarget)||t(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(e){t(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),t.vakata.context.settings.hide_onmouseleave&&(i=setTimeout(function(e){return function(){t.vakata.context.hide()}}(),t.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(e){e.preventDefault(),t(this).blur().parent().hasClass("vakata-context-disabled")||!1===t.vakata.context._execute(t(this).attr("rel"))||t.vakata.context.hide()}).on("keydown","a",function(e){var i=null;switch(e.which){case 13:case 32:e.type="mouseup",e.preventDefault(),t(e.currentTarget).trigger(e);break;case 37:n.is_visible&&(n.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 38:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),i.addClass("vakata-context-hover").children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 39:n.is_visible&&(n.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 40:n.is_visible&&(i=n.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),i.length||(i=n.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),i.addClass("vakata-context-hover").children("a").focus(),e.stopImmediatePropagation(),e.preventDefault());break;case 27:t.vakata.context.hide(),e.preventDefault()}}).on("keydown",function(t){t.preventDefault();var e=n.element.find(".vakata-contextmenu-shortcut-"+t.which).parent();e.parent().not(".vakata-context-disabled")&&e.mouseup()}).appendTo("body"),t(document).on("mousedown",function(e){n.is_visible&&!t.contains(n.element[0],e.target)&&t.vakata.context.hide()}).on("context_show.vakata",function(t,i){n.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),e&&n.element.addClass("vakata-context-rtl").css("direction","rtl"),n.element.find("ul").hide().end()})})}(t),t.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0},t.jstree.plugins.dnd=function(e,n){this.bind=function(){n.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",t.proxy(function(e){var n=this.get_node(e.target),i=this.is_selected(n)?this.get_selected().length:1;if(n&&n.id&&"#"!==n.id&&(1===e.which||"touchstart"===e.type)&&(!0===this.settings.dnd.is_draggable||t.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_selected(!0):[n])))return this.element.trigger("mousedown.jstree"),t.vakata.dnd.start(e,{jstree:!0,origin:this,obj:this.get_node(n,!0),nodes:i>1?this.get_selected():[n.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(i>1?i+" "+this.get_string("nodes"):this.get_text(e.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}},t(function(){var e=!1,n=!1,i=!1,r=t('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");t(document).bind("dnd_start.vakata",function(t,n){e=!1}).bind("dnd_move.vakata",function(a,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){var s,l,c,d,u,h,f,p,_,g,m,v,y,b,w=t.jstree.reference(o.event.target),x=!1,k=!1,M=!1;if(w&&w._data&&w._data.dnd)if(r.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==w.element[0]&&o.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((x=t(o.event.target).closest(".jstree-anchor"))&&x.length&&x.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(k=x.offset(),M=o.event.pageY-k.top,c=x.height(),h=M<c/3?["b","i","a"]:M>c-c/3?["a","i","b"]:M>c/2?["i","a","b"]:["i","b","a"],t.each(h,function(a,M){switch(M){case"b":s=k.left-6,l=k.top,d=w.get_parent(x),u=x.parent().index();break;case"i":y=w.settings.dnd.inside_pos,b=w.get_node(x.parent()),s=k.left-2,l=k.top+c/2+1,d=b.id,u="first"===y?0:"last"===y?b.children.length:Math.min(y,b.children.length);break;case"a":s=k.left-6,l=k.top+c,d=w.get_parent(x),u=x.parent().index()+1}for(/*!
								// TODO: moving inside, but the node is not yet loaded?
								// the check will work anyway, as when moving the node will be loaded first and checked again
								if(v === 'i' && !ins.is_loaded(p)) { }
								*/
f=!0,p=0,_=o.data.nodes.length;p<_;p++)if(g=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",m=u,"move_node"===g&&"a"===M&&o.data.origin&&o.data.origin===w&&d===w.get_parent(o.data.nodes[p])&&(v=w.get_node(d),m>t.inArray(o.data.nodes[p],v.children)&&(m-=1)),!(f=f&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(g,o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],d,m,{dnd:!0,ref:w.get_node(x.parent()),pos:M,is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin})))){w&&w.last_error&&(n=w.last_error());break}if(f)return"i"===M&&x.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(i=setTimeout(function(t,e){return function(){t.open_node(e)}}(w,x),w.settings.dnd.open_timeout)),e={ins:w,par:d,pos:"i"!==M||"last"!==y||0!==u||w.is_loaded(b)?u:"last"},r.css({left:s+"px",top:l+"px"}).show(),o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),n={},h=!0,!1}),!0===h))return}else{for(f=!0,p=0,_=o.data.nodes.length;p<_&&(f=f&&w.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[p]):o.data.nodes[p],"#","last",{dnd:!0,ref:w.get_node("#"),pos:"i",is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin}));p++);if(f)return e={ins:w,par:"#",pos:"last"},r.hide(),void o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok")}e=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),r.hide()}}).bind("dnd_scroll.vakata",function(t,n){n&&n.data&&n.data.jstree&&(r.hide(),e=!1,n.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(a,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree){r.hide();var s,l,c=[];if(e){for(s=0,l=o.data.nodes.length;s<l;s++)c[s]=o.data.origin?o.data.origin.get_node(o.data.nodes[s]):o.data.nodes[s],o.data.origin&&(c[s].instance=o.data.origin);e.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](c,e.par,e.pos)}else s=t(o.event.target).closest(".jstree"),s.length&&n&&n.error&&"check"===n.error&&(s=s.jstree(!0))&&s.settings.core.error.call(this,n)}}).bind("keyup keydown",function(e,n){(n=t.vakata.dnd._get())&&n.data&&n.data.jstree&&n.helper.find(".jstree-copy:eq(0)")[n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(e.metaKey||e.ctrlKey))?"show":"hide"]()})}),function(t){var e={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};t.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(e,n){var i=t.vakata.dnd._get();i.event=n,t(document).triggerHandler("dnd_"+e+".vakata",i)},_get:function(){return{data:e.data,element:e.element,helper:e.helper}},_clean:function(){e.helper&&e.helper.remove(),e.scroll_i&&(clearInterval(e.scroll_i),e.scroll_i=!1),e={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},t(document).off("mousemove touchmove",t.vakata.dnd.drag),t(document).off("mouseup touchend",t.vakata.dnd.stop)},_scroll:function(n){if(!e.scroll_e||!e.scroll_l&&!e.scroll_t)return e.scroll_i&&(clearInterval(e.scroll_i),e.scroll_i=!1),!1;if(!e.scroll_i)return e.scroll_i=setInterval(t.vakata.dnd._scroll,100),!1;if(!0===n)return!1;var i=e.scroll_e.scrollTop(),r=e.scroll_e.scrollLeft();e.scroll_e.scrollTop(i+e.scroll_t*t.vakata.dnd.settings.scroll_speed),e.scroll_e.scrollLeft(r+e.scroll_l*t.vakata.dnd.settings.scroll_speed),i===e.scroll_e.scrollTop()&&r===e.scroll_e.scrollLeft()||t.vakata.dnd._trigger("scroll",e.scroll_e)},start:function(n,i,r){"touchstart"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),e.is_drag&&t.vakata.dnd.stop({});try{n.currentTarget.unselectable="on",n.currentTarget.onselectstart=function(){return!1},n.currentTarget.style&&(n.currentTarget.style.MozUserSelect="none")}catch(t){}return e.init_x=n.pageX,e.init_y=n.pageY,e.data=i,e.is_down=!0,e.element=n.currentTarget,e.target=n.target,e.is_touch="touchstart"===n.type,!1!==r&&(e.helper=t("<div id='vakata-dnd'></div>").html(r).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),t(document).bind("mousemove touchmove",t.vakata.dnd.drag),t(document).bind("mouseup touchend",t.vakata.dnd.stop),!1},drag:function(n){if("touchmove"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),e.is_down){if(!e.is_drag){if(!(Math.abs(n.pageX-e.init_x)>(e.is_touch?t.vakata.dnd.settings.threshold_touch:t.vakata.dnd.settings.threshold)||Math.abs(n.pageY-e.init_y)>(e.is_touch?t.vakata.dnd.settings.threshold_touch:t.vakata.dnd.settings.threshold)))return;e.helper&&(e.helper.appendTo("body"),e.helper_w=e.helper.outerWidth()),e.is_drag=!0,t.vakata.dnd._trigger("start",n)}var i=!1,r=!1,a=!1,o=!1,s=!1,l=!1,c=!1,d=!1,u=!1,h=!1;return e.scroll_t=0,e.scroll_l=0,e.scroll_e=!1,t(t(n.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(t(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var i=t(this),r=i.offset();if(this.scrollHeight>this.offsetHeight&&(r.top+i.height()-n.pageY<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=1),n.pageY-r.top<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(r.left+i.width()-n.pageX<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=1),n.pageX-r.left<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=-1)),e.scroll_t||e.scroll_l)return e.scroll_e=t(this),!1}),e.scroll_e||(i=t(document),r=t(window),a=i.height(),o=r.height(),s=i.width(),l=r.width(),c=i.scrollTop(),d=i.scrollLeft(),a>o&&n.pageY-c<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=-1),a>o&&o-(n.pageY-c)<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=1),s>l&&n.pageX-d<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=-1),s>l&&l-(n.pageX-d)<t.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=1),(e.scroll_t||e.scroll_l)&&(e.scroll_e=i)),e.scroll_e&&t.vakata.dnd._scroll(!0),e.helper&&(u=parseInt(n.pageY+t.vakata.dnd.settings.helper_top,10),h=parseInt(n.pageX+t.vakata.dnd.settings.helper_left,10),a&&u+25>a&&(u=a-50),s&&h+e.helper_w>s&&(h=s-(e.helper_w+2)),e.helper.css({left:h+"px",top:u+"px"})),t.vakata.dnd._trigger("move",n),!1}},stop:function(n){if("touchend"===n.type&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(n.pageX=n.originalEvent.changedTouches[0].pageX,n.pageY=n.originalEvent.changedTouches[0].pageY,n.target=document.elementFromPoint(n.originalEvent.changedTouches[0].pageX-window.pageXOffset,n.originalEvent.changedTouches[0].pageY-window.pageYOffset)),e.is_drag)t.vakata.dnd._trigger("stop",n);else if("touchend"===n.type&&n.target===e.target){var i=setTimeout(function(){t(n.target).click()},100);t(n.target).one("click",function(){i&&clearTimeout(i)})}return t.vakata.dnd._clean(),!1}}}(t),t.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},t.jstree.plugins.search=function(e,n){this.bind=function(){n.bind.call(this),this._data.search.str="",this._data.search.dom=t(),this._data.search.res=[],this._data.search.opn=[],this.element.on("before_open.jstree",t.proxy(function(e,n){var i,r,a=this._data.search.res,o=[],s=t();if(a&&a.length&&(this._data.search.dom=t(this.element[0].querySelectorAll("#"+t.map(a,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(t.jstree.idregex,"\\$&"):e.replace(t.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this.settings.search.show_only_matches&&this._data.search.res.length)){for(i=0,r=a.length;i<r;i++)o=o.concat(this.get_node(a[i]).parents);o=t.vakata.array_remove_item(t.vakata.array_unique(o),"#"),s=o.length?t(this.element[0].querySelectorAll("#"+t.map(o,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(t.jstree.idregex,"\\$&"):e.replace(t.jstree.idregex,"\\$&")}).join(", #"))):t(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),s=s.add(this._data.search.dom),s.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){t(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)),this.settings.search.show_only_matches&&this.element.on("search.jstree",function(e,n){n.nodes.length&&(t(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),n.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){t(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(e,n){n.nodes.length&&t(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})},this.search=function(e,n){if(!1===e||""===t.trim(e.toString()))return this.clear_search();e=e.toString();var i=this.settings.search,r=!!i.ajax&&i.ajax,a=null,o=[],s=[];if(this._data.search.res.length&&this.clear_search(),!n&&!1!==r)return t.isFunction(r)?r.call(this,e,t.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(t.isArray(n)?t.vakata.array_unique(n):[],function(){this.search(e,!0)},!0)},this)):(r=t.extend({},r),r.data||(r.data={}),r.data.str=e,t.ajax(r).fail(t.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(r)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(t.proxy(function(n){n&&n.d&&(n=n.d),this._load_nodes(t.isArray(n)?t.vakata.array_unique(n):[],function(){this.search(e,!0)},!0)},this)));this._data.search.str=e,this._data.search.dom=t(),this._data.search.res=[],this._data.search.opn=[],a=new t.vakata.search(e,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),t.each(this._model.data,function(t,n){n.text&&(i.search_callback&&i.search_callback.call(this,e,n)||!i.search_callback&&a.search(n.text).isMatch)&&(!i.search_leaves_only||n.state.loaded&&0===n.children.length)&&(o.push(t),s=s.concat(n.parents))}),o.length&&(s=t.vakata.array_unique(s),this._search_open(s),this._data.search.dom=t(this.element[0].querySelectorAll("#"+t.map(o,function(e){return-1!=="0123456789".indexOf(e[0])?"\\3"+e[0]+" "+e.substr(1).replace(t.jstree.idregex,"\\$&"):e.replace(t.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=o,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),this.trigger("search",{nodes:this._data.search.dom,str:e,res:this._data.search.res})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=t()},this._search_open=function(e){var n=this;t.each(e.concat([]),function(i,r){if("#"===r)return!0;try{r=t("#"+r.replace(t.jstree.idregex,"\\$&"),n.element)}catch(t){}r&&r.length&&n.is_closed(r)&&(n._data.search.opn.push(r[0].id),n.open_node(r,function(){n._search_open(e)},0))})}},function(t){t.vakata.search=function(t,e,n){n=n||{},!1!==n.fuzzy&&(n.fuzzy=!0),t=n.caseSensitive?t:t.toLowerCase();var i,r,a,o,s=n.location||0,l=n.distance||100,c=n.threshold||.6,d=t.length;return d>32&&(n.fuzzy=!1),n.fuzzy&&(i=1<<d-1,r=function(){var e={},n=0;for(n=0;n<d;n++)e[t.charAt(n)]=0;for(n=0;n<d;n++)e[t.charAt(n)]|=1<<d-n-1;return e}(),a=function(t,e){var n=t/d,i=Math.abs(s-e);return l?n+i/l:i?1:n}),o=function(e){if(e=n.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!n.fuzzy)return{isMatch:!1,score:1};var o,l,u,h,f,p,_,g,m,v=e.length,y=c,b=e.indexOf(t,s),w=d+v,x=1,k=[];for(-1!==b&&(y=Math.min(a(0,b),y),-1!==(b=e.lastIndexOf(t,s+d))&&(y=Math.min(a(0,b),y))),b=-1,o=0;o<d;o++){for(u=0,h=w;u<h;)a(o,s+h)<=y?u=h:w=h,h=Math.floor((w-u)/2+u);for(w=h,p=Math.max(1,s-h+1),_=Math.min(s+h,v)+d,g=new Array(_+2),g[_+1]=(1<<o)-1,l=_;l>=p;l--)if(m=r[e.charAt(l-1)],g[l]=0===o?(g[l+1]<<1|1)&m:(g[l+1]<<1|1)&m|(f[l+1]|f[l])<<1|1|f[l+1],g[l]&i&&(x=a(o,l-1))<=y){if(y=x,b=l-1,k.push(b),!(b>s))break;p=Math.max(1,2*s-b)}if(a(o+1,s)>y)break;f=g}return{isMatch:b>=0,score:x}},!0===e?{search:o}:o(e)}}(t),t.jstree.defaults.sort=function(t,e){return this.get_text(t)>this.get_text(e)?1:-1},t.jstree.plugins.sort=function(e,n){this.bind=function(){n.bind.call(this),this.element.on("model.jstree",t.proxy(function(t,e){this.sort(e.parent,!0)},this)).on("rename_node.jstree create_node.jstree",t.proxy(function(t,e){this.sort(e.parent||e.node.parent,!1),this.redraw_node(e.parent||e.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",t.proxy(function(t,e){this.sort(e.parent,!1),this.redraw_node(e.parent,!0)},this))},this.sort=function(e,n){var i,r;if((e=this.get_node(e))&&e.children&&e.children.length&&(e.children.sort(t.proxy(this.settings.sort,this)),n))for(i=0,r=e.children_d.length;i<r;i++)this.sort(e.children_d[i],!1)}};var f=!1;t.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1},t.jstree.plugins.state=function(e,n){this.bind=function(){n.bind.call(this);var e=t.proxy(function(){this.element.on(this.settings.state.events,t.proxy(function(){f&&clearTimeout(f),f=setTimeout(t.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",t.proxy(function(t,n){this.element.one("restore_state.jstree",e),this.restore_state()||e()},this))},this.save_state=function(){var e={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};t.vakata.storage.set(this.settings.state.key,JSON.stringify(e))},this.restore_state=function(){var e=t.vakata.storage.get(this.settings.state.key);if(e)try{e=JSON.parse(e)}catch(t){return!1}return!(e&&e.ttl&&e.sec&&+new Date-e.sec>e.ttl)&&(e&&e.state&&(e=e.state),e&&t.isFunction(this.settings.state.filter)&&(e=this.settings.state.filter.call(this,e)),!!e&&(this.element.one("set_state.jstree",function(n,i){i.instance.trigger("restore_state",{state:t.extend(!0,{},e)})}),this.set_state(e),!0))},this.clear_state=function(){return t.vakata.storage.del(this.settings.state.key)}},function(t,e){t.vakata.storage={set:function(t,e){return window.localStorage.setItem(t,e)},get:function(t){return window.localStorage.getItem(t)},del:function(t){return window.localStorage.removeItem(t)}}}(t),t.jstree.defaults.types={"#":{},default:{}},t.jstree.plugins.types=function(n,i){this.init=function(t,n){var r,a;if(n&&n.types&&n.types.default)for(r in n.types)if("default"!==r&&"#"!==r&&n.types.hasOwnProperty(r))for(a in n.types.default)n.types.default.hasOwnProperty(a)&&n.types[r][a]===e&&(n.types[r][a]=n.types.default[a]);i.init.call(this,t,n),this._model.data["#"].type="#"},this.refresh=function(t,e){i.refresh.call(this,t,e),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",t.proxy(function(t,n){var i,r,a=this._model.data,o=n.nodes,s=this.settings.types,l="default";for(i=0,r=o.length;i<r;i++)l="default",a[o[i]].original&&a[o[i]].original.type&&s[a[o[i]].original.type]&&(l=a[o[i]].original.type),a[o[i]].data&&a[o[i]].data.jstree&&a[o[i]].data.jstree.type&&s[a[o[i]].data.jstree.type]&&(l=a[o[i]].data.jstree.type),a[o[i]].type=l,!0===a[o[i]].icon&&s[l].icon!==e&&(a[o[i]].icon=s[l].icon);a["#"].type="#"},this)),i.bind.call(this)},this.get_json=function(e,n,r){var a,o,s=this._model.data,l=n?t.extend(!0,{},n,{no_id:!1}):{},c=i.get_json.call(this,e,l,r);if(!1===c)return!1;if(t.isArray(c))for(a=0,o=c.length;a<o;a++)c[a].type=c[a].id&&s[c[a].id]&&s[c[a].id].type?s[c[a].id].type:"default",n&&n.no_id&&(delete c[a].id,c[a].li_attr&&c[a].li_attr.id&&delete c[a].li_attr.id);else c.type=c.id&&s[c.id]&&s[c.id].type?s[c.id].type:"default",n&&n.no_id&&(c=this._delete_ids(c));return c},this._delete_ids=function(e){if(t.isArray(e)){for(var n=0,i=e.length;n<i;n++)e[n]=this._delete_ids(e[n]);return e}return delete e.id,e.li_attr&&e.li_attr.id&&delete e.li_attr.id,e.children&&t.isArray(e.children)&&(e.children=this._delete_ids(e.children)),e},this.check=function(n,r,a,o,s){if(!1===i.check.call(this,n,r,a,o,s))return!1;r=r&&r.id?r:this.get_node(r),a=a&&a.id?a:this.get_node(a);var l,c,d,u,h=r&&r.id?t.jstree.reference(r.id):null;switch(h=h&&h._model&&h._model.data?h._model.data:null,n){case"create_node":case"move_node":case"copy_node":if("move_node"!==n||-1===t.inArray(r.id,a.children)){if(l=this.get_rules(a),l.max_children!==e&&-1!==l.max_children&&l.max_children===a.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(l.valid_children!==e&&-1!==l.valid_children&&-1===t.inArray(r.type,l.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;if(h&&r.children_d&&r.parents){for(c=0,d=0,u=r.children_d.length;d<u;d++)c=Math.max(c,h[r.children_d[d]].parents.length);c=c-r.parents.length+1}(c<=0||c===e)&&(c=1);do{if(l.max_depth!==e&&-1!==l.max_depth&&l.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+n,data:JSON.stringify({chk:n,pos:o,obj:!(!r||!r.id)&&r.id,par:!(!a||!a.id)&&a.id})},!1;a=this.get_node(a.parent),l=this.get_rules(a),c++}while(a)}}return!0},this.get_rules=function(t){if(!(t=this.get_node(t)))return!1;var n=this.get_type(t,!0);return n.max_depth===e&&(n.max_depth=-1),n.max_children===e&&(n.max_children=-1),n.valid_children===e&&(n.valid_children=-1),n},this.get_type=function(e,n){return!!(e=this.get_node(e))&&(n?t.extend({type:e.type},this.settings.types[e.type]):e.type)},this.set_type=function(n,i){var r,a,o,s,l;if(t.isArray(n)){for(n=n.slice(),a=0,o=n.length;a<o;a++)this.set_type(n[a],i);return!0}return r=this.settings.types,n=this.get_node(n),!(!r[i]||!n)&&(s=n.type,l=this.get_icon(n),n.type=i,(!0===l||r[s]&&r[s].icon&&l===r[s].icon)&&this.set_icon(n,r[i].icon===e||r[i].icon),!0)}},t.jstree.defaults.unique={case_sensitive:!1,duplicate:function(t,e){return t+" ("+e+")"}},t.jstree.plugins.unique=function(n,i){this.check=function(e,n,r,a,o){if(!1===i.check.call(this,e,n,r,a,o))return!1;if(n=n&&n.id?n:this.get_node(n),!(r=r&&r.id?r:this.get_node(r))||!r.children)return!0;var s,l,c="rename_node"===e?a:n.text,d=[],u=this.settings.unique.case_sensitive,h=this._model.data;for(s=0,l=r.children.length;s<l;s++)d.push(u?h[r.children[s]].text:h[r.children[s]].text.toLowerCase());switch(u||(c=c.toLowerCase()),e){case"delete_node":return!0;case"rename_node":return s=-1===t.inArray(c,d)||n.text&&n.text[u?"toString":"toLowerCase"]()===c,s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"create_node":return s=-1===t.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"copy_node":return s=-1===t.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s;case"move_node":return s=n.parent===r.id||-1===t.inArray(c,d),s||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+e,data:JSON.stringify({chk:e,pos:a,obj:!(!n||!n.id)&&n.id,par:!(!r||!r.id)&&r.id})}),s}return!0},this.create_node=function(n,r,a,o,s){if(!r||r.text===e){if(null===n&&(n="#"),!(n=this.get_node(n)))return i.create_node.call(this,n,r,a,o,s);if(a=a===e?"last":a,!a.toString().match(/^(before|after)$/)&&!s&&!this.is_loaded(n))return i.create_node.call(this,n,r,a,o,s);r||(r={});var l,c,d,u,h,f=this._model.data,p=this.settings.unique.case_sensitive,_=this.settings.unique.duplicate;for(c=l=this.get_string("New node"),d=[],u=0,h=n.children.length;u<h;u++)d.push(p?f[n.children[u]].text:f[n.children[u]].text.toLowerCase());for(u=1;-1!==t.inArray(p?c:c.toLowerCase(),d);)c=_.call(this,l,++u).toString();r.text=c}return i.create_node.call(this,n,r,a,o,s)}};var p=document.createElement("DIV");p.setAttribute("unselectable","on"),p.className="jstree-wholerow",p.innerHTML="&#160;",t.jstree.plugins.wholerow=function(e,n){this.bind=function(){n.bind.call(this),this.element.on("ready.jstree set_state.jstree",t.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",t.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",t.proxy(function(t,e){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",t.proxy(function(t,e){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var n,i,r=!1;for(n=0,i=e.selected.length;n<i;n++)(r=this.get_node(e.selected[n],!0))&&r.length&&r.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",t.proxy(function(t,e){this.get_node(e.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",t.proxy(function(t,e){this.get_node(e.node,!0).children(".jstree-wholerow")["hover_node"===t.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",t.proxy(function(e){e.preventDefault();var n=t.Event("contextmenu",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,pageX:e.pageX,pageY:e.pageY});t(e.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n)},this)).on("click.jstree",".jstree-wholerow",function(e){e.stopImmediatePropagation();var n=t.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});t(e.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",t.proxy(function(e){e.stopImmediatePropagation();var n=t.Event("click",{metaKey:e.metaKey,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey});t(e.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(n).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",t.proxy(function(t){return t.stopImmediatePropagation(),this.hover_node(t.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",t.proxy(function(t){this.dehover_node(t.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),n.teardown.call(this)},this.redraw_node=function(e,i,r){if(e=n.redraw_node.call(this,e,i,r)){var a=p.cloneNode(!0);-1!==t.inArray(e.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),e.insertBefore(a,e.childNodes[0])}return e}}}})},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=t.Model.extend({urlRoot:Galaxy.root+"api/groups"}),i=t.Collection.extend({url:Galaxy.root+"api/groups",model:n});e.default={Group:n,Groups:i}}).call(e,n(2))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){Galaxy.user||(Galaxy.user=new L.default.User(t.user_json)),Galaxy.masthead||(Galaxy.masthead=new E.default.View(t),Galaxy.modal=new I.default.View,(0,h.default)("#masthead").replaceWith(Galaxy.masthead.render().$el))}function a(t){new A.default.GalaxyApp(t)}function o(t){new v.default.GalaxyApp(t)}function s(t){new b.default.GalaxyApp(t)}function l(t){new g.default(t)}function c(t){new S.default.GalaxyApp(t)}function d(t){var e=new W.default.HistoryCollection([],{includeDeleted:t.includingDeleted,order:t.order,limitOnFirstFetch:t.limit,limitPerFetch:t.limit,currentHistoryId:t.current_history_id}),n=new q.default.MultiPanelColumns({el:(0,h.default)("#center").get(0),histories:e});e.fetchFirst({silent:!0}).done(function(){n.createColumns(),n.render(0)})}Object.defineProperty(e,"__esModule",{value:!0}),e.bundleEntries=void 0,e.mastheadEntry=r,e.adminToolshedEntry=a,e.tracksterEntry=o,e.circsterEntry=s,e.workflowEntry=l,e.libraryEntry=c,e.multiHistoryEntry=d;var u=n(0),h=i(u);n(193);var f=n(70),p=i(f),_=n(716),g=i(_),m=n(61),v=i(m),y=n(725),b=i(y),w=n(726),x=i(w),k=n(727),M=i(k),C=n(728),S=i(C),T=n(738),A=i(T),j=n(73),E=i(j),O=n(60),L=i(O),N=n(17),I=i(N),P=n(746),D=i(P),R=n(14),z=i(R),$=n(144),W=i($),G=n(748),V=i(G),H=n(57),F=i(H),Y=n(754),q=i(Y),U=n(157),B=i(U),X=n(755),J=i(X),Q=n(143),K=i(Q),Z=n(179),tt=i(Z),et=n(145),nt=i(et),it=n(71),rt=i(it),at=n(756),ot=i(at),st=n(759),lt=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(st),ct=n(760),dt=i(ct);window.Galaxy&&void 0===window.Galaxy.debug&&(0,rt.default)(window.Galaxy,"GalaxyApp");var ut=e.bundleEntries={library:c,masthead:r,workflow:l,trackster:o,circster:s,adminToolshed:a,pages:D.default,phyloviz:x.default.PhylovizView,createTabularDatasetChunkedView:z.default.createTabularDatasetChunkedView,multiHistory:d,history:B.default.historyEntry,History:W.default.History,HistoryContents:F.default.HistoryContents,SweepsterVisualization:M.default.SweepsterVisualization,SweepsterVisualizationView:M.default.SweepsterVisualizationView,HistoryCopyDialog:K.default,HistoryViewAnnotated:J.default,Trackster:v.default,StructureView:V.default,HDAListItemEdit:tt.default,HDAModel:nt.default,GalaxyApp:p.default,LegacyGridView:ot.default,run_stats:lt,ToolshedGroups:dt.default};window.bundleEntries=ut},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}function o(e){var n=t("#galaxy_tools").contents();if(0===n.length&&(n=t(document),t(this).removeClass("search_active"),n.find(".toolTitle").removeClass("search_match"),n.find(".toolSectionBody").hide(),n.find(".toolTitle").show(),n.find(".toolPanelLabel").show(),n.find(".toolSectionWrapper").each(function(){"recently_used_wrapper"!==t(this).attr("id")?t(this).show():t(this).hasClass("user_pref_visible")&&t(this).show()}),n.find("#search-no-results").hide(),n.find("#search-spinner").hide(),e)){n.find("#tool-search-query").val("search tools")}}function s(e,n){var i=y.default[n];if(i){var r=t('<i class="icon fa">&nbsp;</i>').addClass(i);e.before(r)}}Object.defineProperty(e,"__esModule",{value:!0});var l=n(3),c=a(l),d=n(5),u=a(d),h=n(717),f=a(h),p=n(718),_=a(p),g=n(719),m=a(g),v=n(216),y=a(v),b=n(724),w=a(b),x=n(10),k=a(x),M=n(229),C=a(M),S=n(20);!function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);e.default=t}(S);n(19),window.workflow_globals=window.workflow_globals||{},e.default=i.View.extend({initialize:function(e){function n(){var e=t('<form><label style="display:inline-block; width: 100%;">Save as name: </label><input type="text" id="workflow_rename" style="width: 80%;" autofocus/><br><label style="display:inline-block; width: 100%;">Annotation: </label><input type="text" id="wf_annotation" style="width: 80%;" /></form>');window.show_modal("Save As a New Workflow",e,{OK:function(){var e=t("#workflow_rename").val().length>0?t("#workflow_rename").val():"SavedAs_"+l.workflow.name,n=t("#wf_annotation").val().length>0?t("#wf_annotation").val():"";t.ajax({url:l.urls.workflow_save_as,type:"POST",data:{workflow_name:e,workflow_annotation:n,workflow_data:function(){return JSON.stringify(l.workflow.to_simple())}}}).done(function(t){window.onbeforeunload=void 0,window.location=Galaxy.root+"workflow/editor?id="+t,hide_modal()}).fail(function(){hide_modal(),alert("Saving this workflow failed. Please contact this site's administrator.")})},Cancel:hide_modal})}function i(){l.workflow.layout(),l.workflow.fit_canvas_to_nodes(),l.scroll_to_nodes(),l.canvas_manager.draw_overview()}function a(){t.jStorage.set("overview-off",!1),t("#overview-border").css("right","0px"),t("#close-viewport").css("background-position","0px 0px")}function s(){t.jStorage.set("overview-off",!0),t("#overview-border").css("right","20000px"),t("#close-viewport").css("background-position","12px 0px")}var l=window.workflow_globals.app=this;this.options=e,this.urls=e&&e.urls||{};var c=function(){if(l.workflow.check_changes_in_active_form(),workflow&&l.workflow.has_changes){var t=function(){window.onbeforeunload=void 0,window.document.location=l.urls.workflow_index};window.show_modal("Close workflow editor","There are unsaved changes to your workflow which will be lost.",{Cancel:hide_modal,"Save Changes":function(){d(null,t)}},{"Don't Save":t})}else window.document.location=l.urls.workflow_index},d=function(e,n){if(show_message("Saving workflow","progress"),l.workflow.check_changes_in_active_form(),!l.workflow.has_changes)return hide_modal(),void(n&&n());l.workflow.rectify_workflow_outputs(),u.default.request({url:Galaxy.root+"api/workflows/"+l.options.id,type:"PUT",data:{workflow:l.workflow.to_simple()},success:function(e){var i=t("<div/>").text(e.message);if(e.errors){i.addClass("warningmark");var r=t("<ul/>");t.each(e.errors,function(e,n){t("<li/>").text(n).appendTo(r)}),i.append(r)}else i.addClass("donemark");l.workflow.name=e.name,l.workflow.has_changes=!1,l.workflow.stored=!0,l.showWorkflowParameters(),e.errors?window.show_modal("Saving workflow",i,{Ok:hide_modal}):(n&&n(),hide_modal())},error:function(t){window.show_modal("Saving workflow failed.",t.err_msg,{Ok:hide_modal})}})};t("#tool-search-query").click(function(){t(this).focus(),t(this).select()}).keyup(function(){if(t(this).css("font-style","normal"),this.value.length<3)o(!1);else if(this.value!=this.lastValue){t(this).addClass("search_active");var e=this.value;this.timer&&clearTimeout(this.timer),t("#search-spinner").show(),this.timer=setTimeout(function(){t.get(l.urls.tool_search,{q:e},function(e){if(t("#search-no-results").hide(),t(".toolSectionWrapper").hide(),t(".toolSectionWrapper").find(".toolTitle").hide(),0!=e.length){var n=t.map(e,function(t,e){return"link-"+t});t(n).each(function(e,n){t("[id='"+n+"']").parent().addClass("search_match"),t("[id='"+n+"']").parent().show().parent().parent().show().parent().show()}),t(".toolPanelLabel").each(function(){for(var e=t(this),n=e.next(),i=!0;0!==n.length&&n.hasClass("toolTitle");){if(n.is(":visible")){i=!1;break}n=n.next()}i&&e.hide()})}else t("#search-no-results").show();t("#search-spinner").hide()},"json")},400)}this.lastValue=this.value}),this.canvas_manager=window.workflow_globals.canvas_manager=new _.default(this,t("#canvas-viewport"),t("#overview")),this.reset(),this.datatypes=JSON.parse(t.ajax({url:Galaxy.root+"api/datatypes",async:!1}).responseText),this.datatypes_mapping=JSON.parse(t.ajax({url:Galaxy.root+"api/datatypes/mapping",async:!1}).responseText),this.ext_to_type=this.datatypes_mapping.ext_to_class_name,this.type_to_type=this.datatypes_mapping.class_to_classes,this._workflowLoadAjax(l.options.id,{success:function(t){l.reset(),l.workflow.from_simple(t,!0),l.workflow.has_changes=!1,l.workflow.fit_canvas_to_nodes(),l.scroll_to_nodes(),l.canvas_manager.draw_overview();var e="";r.each(t.steps,function(n,i){var a="";n.errors&&(a+="<li>"+n.errors+"</li>"),r.each(t.upgrade_messages[i],function(t){a+="<li>"+t+"</li>"}),a&&(e+="<li>Step "+(parseInt(i,10)+1)+": "+l.workflow.nodes[i].name+"<ul>"+a+"</ul></li>")}),e?window.show_modal("Issues loading this workflow","Please review the following issues, possibly resulting from tool upgrades or changes.<p><ul>"+e+"</ul></p>",{Continue:hide_modal}):hide_modal(),l.showWorkflowParameters()},beforeSubmit:function(t){show_message("Loading workflow","progress")}}),window.make_popupmenu&&make_popupmenu(t("#workflow-options-button"),{Save:d,"Save As":n,Run:function(){window.location=Galaxy.root+"workflows/run?id="+l.options.id},"Edit Attributes":function(){l.workflow.clear_active_node()},"Auto Re-layout":i,Close:c});var h=t.jStorage.get("overview-size");void 0!==h&&t("#overview-border").css({width:h,height:h}),t.jStorage.get("overview-off")?s():a(),t("#overview-border").bind("dragend",function(e,n){var i=t(this).offsetParent(),r=i.offset(),a=Math.max(i.width()-(n.offsetX-r.left),i.height()-(n.offsetY-r.top));t.jStorage.set("overview-size",a+"px")}),t("#close-viewport").click(function(){"0px"===t("#overview-border").css("right")?s():a()}),window.onbeforeunload=function(){if(workflow&&l.workflow.has_changes)return"There are unsaved changes to your workflow which will be lost."},this.options.workflows.length>0&&t("#left").find(".toolMenu").append(this._buildToolPanelWorkflows()),t("div.toolSectionBody").hide(),t("div.toolSectionTitle > span").wrap("<a href='#'></a>");var f=null;t("div.toolSectionTitle").each(function(){var e=t(this).next("div.toolSectionBody");t(this).click(function(){e.is(":hidden")?(f&&f.slideUp("fast"),f=e,e.slideDown("fast")):(e.slideUp("fast"),f=null)})}),(0,C.default)("workflow-name","workflow-name",l.urls.rename_async,"new_name"),t("#workflow-tag").click(function(){return t(".tag-area").click(),!1}),(0,C.default)("workflow-annotation","workflow-annotation",l.urls.annotate_async,"new_annotation",25,!0,4)},_buildToolPanelWorkflows:function(){var e=this,n=t('<div class="toolSectionWrapper"><div class="toolSectionTitle"><a href="#"><span>Workflows</span></a></div><div class="toolSectionBody"><div class="toolSectionBg"/></div></div>');return r.each(this.options.workflows,function(i){if(i.id!==e.options.id){var r=new k.default.ButtonIcon({icon:"fa fa-copy",cls:"ui-button-icon-plain",tooltip:(0,c.default)("Copy and insert individual steps"),onclick:function(){i.step_count<2?e.copy_into_workflow(i.id,i.name):Galaxy.modal.show({title:(0,c.default)("Warning"),body:"This will copy "+i.step_count+" new steps into your workflow.",buttons:{Cancel:function(){Galaxy.modal.hide()},Copy:function(){Galaxy.modal.hide(),e.copy_into_workflow(i.id,i.name)}}})}}),a=t("<a/>").attr("href","#").html(i.name).on("click",function(){e.add_node_for_subworkflow(i.latest_id,i.name)});n.find(".toolSectionBg").append(t("<div/>").addClass("toolTitle").append(a).append(r.$el))}}),n},copy_into_workflow:function(e){var n=this;this._workflowLoadAjax(e,{success:function(e){n.workflow.from_simple(e,!1);var i="";t.each(e.upgrade_messages,function(e,r){i+="<li>Step "+(parseInt(e,10)+1)+": "+n.workflow.nodes[e].name+"<ul>",t.each(r,function(t,e){i+="<li>"+e+"</li>"}),i+="</ul></li>"}),i?window.show_modal("Subworkflow embedded with changes","Problems were encountered loading this workflow (possibly a result of tool upgrades). Please review the following parameters and then save.<ul>"+i+"</ul>",{Continue:hide_modal}):hide_modal()},beforeSubmit:function(t){show_message("Importing workflow","progress")}})},reset:function(){this.workflow&&this.workflow.remove_all(),this.workflow=window.workflow_globals.workflow=new f.default(this,t("#canvas-container"))},scroll_to_nodes:function(){var e,n,i=t("#canvas-viewport"),r=t("#canvas-container");n=r.width()<i.width()?(i.width()-r.width())/2:0,e=r.height()<i.height()?(i.height()-r.height())/2:0,r.css({left:n,top:e})},_workflowLoadAjax:function(e,n){t.ajax(u.default.merge(n,{url:this.urls.load_workflow,data:{id:e,_:"true"},dataType:"json",cache:!1}))},_moduleInitAjax:function(t,e){var n=this;u.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:e,success:function(e){t.init_field_data(e),t.update_field_data(e),n.workflow.activate_node(t)}})},add_node_for_tool:function(t,e){var n=this.workflow.create_node("tool",e,t);this._moduleInitAjax(n,{type:"tool",tool_id:t,_:"true"})},add_node_for_subworkflow:function(t,e){var n=this.workflow.create_node("subworkflow",e,t);this._moduleInitAjax(n,{type:"subworkflow",content_id:t,_:"true"})},add_node_for_module:function(t,e){var n=this.workflow.create_node(t,e);this._moduleInitAjax(n,{type:t,_:"true"})},display_file_list:function(t){var e="<select id='node_data_list' name='node_data_list'>";for(var n in t.output_terminals)e+="<option value='"+n+"'>"+n+"</option>";return e+="</select>"},showWorkflowParameters:function(){var e=/\$\{.+?\}/g,n=[],i=t("#workflow-parameters-container"),r=t("#workflow-parameters-box"),a="",o=[];t.each(this.workflow.nodes,function(i,r){r.config_form&&r.config_form.inputs&&u.default.deepeach(r.config_form.inputs,function(t){if("string"==typeof t.value){var n=t.value.match(e);n&&(o=o.concat(n))}}),r.post_job_actions&&t.each(r.post_job_actions,function(n,i){i.action_arguments&&t.each(i.action_arguments,function(t,n){var i=n.match(e);i&&(o=o.concat(i))})}),o&&t.each(o,function(e,i){-1===t.inArray(i,n)&&n.push(i)})}),n&&0!==n.length?(t.each(n,function(t,e){a+="<div>"+e.substring(2,e.length-1)+"</div>"}),i.html(a),r.show()):(i.html(a),r.hide())},showAttributes:function(){t(".right-content").hide(),t("#edit-attributes").show()},showForm:function(e,n){var i="right-content",r=i+"-"+n.id,a=t("#"+i);if(e&&0==a.find("#"+r).length){var o=t('<div id="'+r+'" class="'+i+'"/>');if(e.node=n,e.workflow=this.workflow,e.datatypes=this.datatypes,e.icon=y.default[n.type],e.cls="ui-portlet-narrow",n){var s="tool"==n.type?"Tool":"Default";o.append(new w.default[s](e).form.$el),a.append(o)}else Galaxy.emit.debug("workflow-view::initialize()","Node not found in workflow.")}t("."+i).hide(),a.find("#"+r).show(),a.show(),a.scrollTop()},isSubType:function(t,e){return t=this.ext_to_type[t],e=this.ext_to_type[e],this.type_to_type[t]&&e in this.type_to_type[t]},prebuildNode:function(e,n,i){var r=this,a=t("<div class='toolForm toolFormInCanvas'/>"),o=t("<div class='toolFormTitle unselectable'><span class='nodeTitle'>"+n+"</div></div>");s(o.find(".nodeTitle"),e),a.append(o),a.css("left",t(window).scrollLeft()+20),a.css("top",t(window).scrollTop()+20),a.append(t("<div class='toolFormBody'></div>"));var l=new m.default(this,{element:a});l.type=e,l.content_id=i;var c="<div><img height='16' align='middle' src='"+Galaxy.root+"static/images/loading_small_white_bg.gif'/> loading tool info...</div>";a.find(".toolFormBody").append(c);var d=t("<div class='buttons' style='float: right;'></div>");"subworkflow"!==e&&d.append(t("<div/>").addClass("fa-icon-button fa fa-files-o node-clone").click(function(t){l.clone()})),d.append(t("<div/>").addClass("fa-icon-button fa fa-times node-destroy").click(function(t){l.destroy()})),a.appendTo("#canvas-container");var u=t("#canvas-container").position(),h=t("#canvas-container").parent(),f=a.width(),p=a.height();return a.css({left:-u.left+h.width()/2-f/2,top:-u.top+h.height()/2-p/2}),d.prependTo(a.find(".toolFormTitle")),f+=d.width()+10,a.css("width",f),a.bind("dragstart",function(){r.workflow.activate_node(l)}).bind("dragend",function(){r.workflow.node_changed(this),r.workflow.fit_canvas_to_nodes(),r.canvas_manager.draw_overview()}).bind("dragclickonly",function(){r.workflow.activate_node(l)}).bind("drag",function(e,n){var i=t(this).offsetParent().offset(),r=n.offsetX-i.left,a=n.offsetY-i.top;t(this).css({left:r,top:a}),t(this).find(".terminal").each(function(){this.terminal.redraw()})}),l}})}).call(e,n(0),n(2),n(1))},function(t,e,n){"use strict";(function(t){function i(t,e){this.app=t,this.canvas_container=e,this.id_counter=0,this.nodes={},this.name=null,this.has_changes=!1,this.active_form_has_changes=!1,this.workflowOutputLabels={}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(410),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=n(20),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(o);t.extend(i.prototype,{canLabelOutputWith:function(t){return!t||!(t in this.workflowOutputLabels)},registerOutputLabel:function(t){t&&(this.workflowOutputLabels[t]=!0)},unregisterOutputLabel:function(t){t&&delete this.workflowOutputLabels[t]},updateOutputLabel:function(t,e){t&&this.unregisterOutputLabel(t),this.canLabelOutputWith(e)||s.warning("Workflow contains duplicate workflow output labels "+e+". This must be fixed before it can be saved."),e&&this.registerOutputLabel(e)},attemptUpdateOutputLabel:function(t,e,n){return!!this.canLabelOutputWith(n)&&(t.labelWorkflowOutput(e,n),t.nodeView.redrawWorkflowOutputs(),!0)},create_node:function(t,e,n){var i=this.app.prebuildNode(t,e,n);return this.add_node(i),this.fit_canvas_to_nodes(),this.app.canvas_manager.draw_overview(),this.activate_node(i),i},add_node:function(t){t.id=this.id_counter,t.element.attr("id","wf-node-step-"+t.id),t.element.attr("node-label",t.label),this.id_counter++,this.nodes[t.id]=t,this.has_changes=!0,t.workflow=this},remove_node:function(t){this.active_node==t&&this.clear_active_node(),delete this.nodes[t.id],this.has_changes=!0},remove_all:function(){var e=this;t.each(this.nodes,function(t,n){n.destroy(),e.remove_node(n)})},rectify_workflow_outputs:function(){var e=!1,n=!1;if(t.each(this.nodes,function(i,r){r.workflow_outputs&&r.workflow_outputs.length>0&&(e=!0),t.each(r.post_job_actions,function(t,e){"HideDatasetAction"===e.action_type&&(n=!0)})}),!1!==e||!1!==n){var i=this;t.each(this.nodes,function(n,r){if("tool"===r.type){var a=!1;null===r.post_job_actions&&(r.post_job_actions={},a=!0);var o=[];t.each(r.post_job_actions,function(t,e){"HideDatasetAction"==e.action_type&&o.push(t)}),o.length>0&&t.each(o,function(t,e){a=!0,delete r.post_job_actions[e]}),e&&t.each(r.output_terminals,function(t,e){if(!0==!r.isWorkflowOutput(e.name)){a=!0;var n={action_type:"HideDatasetAction",output_name:e.name,action_arguments:{}};r.post_job_actions["HideDatasetAction"+e.name]=null,r.post_job_actions["HideDatasetAction"+e.name]=n}}),i.active_node==r&&!0===a&&i.reload_active_node()}})}},to_simple:function(){var e={};return t.each(this.nodes,function(n,i){var r={};t.each(i.input_terminals,function(e,n){r[n.name]=null;var i=[];t.each(n.connectors,function(t,e){if(e.handle1){var a={id:e.handle1.node.id,output_name:e.handle1.name},o=n.attributes.input.input_subworkflow_step_id;void 0!==o&&(a.input_subworkflow_step_id=o),i[t]=a,r[n.name]=i}})});var a={};i.post_job_actions&&t.each(i.post_job_actions,function(t,e){var n={action_type:e.action_type,output_name:e.output_name,action_arguments:e.action_arguments};a[e.action_type+e.output_name]=null,a[e.action_type+e.output_name]=n}),i.workflow_outputs||(i.workflow_outputs=[]);var o={id:i.id,type:i.type,content_id:i.content_id,tool_version:i.config_form.version,tool_state:i.tool_state,errors:i.errors,input_connections:r,position:t(i.element).position(),annotation:i.annotation,post_job_actions:i.post_job_actions,uuid:i.uuid,label:i.label,workflow_outputs:i.workflow_outputs};e[i.id]=o}),{steps:e}},from_simple:function(e,n){var i=void 0===n||n,r=this,o=0;i?r.name=e.name:o=Object.keys(r.nodes).length;var s=o,l=!1;t.each(e.steps,function(e,n){var a=r.app.prebuildNode(n.type,n.name,n.content_id);i||(n.uuid=null,t.each(n.workflow_outputs,function(t,e){e.uuid=null})),a.init_field_data(n),n.position&&a.element.css({top:n.position.top,left:n.position.left}),a.id=parseInt(n.id)+o,a.element.attr("id","wf-node-step-"+a.id),a.element.attr("node-label",n.label),r.nodes[a.id]=a,s=Math.max(s,parseInt(e)+o),l||(a.workflow_outputs.length>0?l=!0:t.each(a.post_job_actions||[],function(t,e){"HideDatasetAction"===e.action_type&&(l=!0)}))}),r.id_counter=s+1,t.each(e.steps,function(e,n){var i=r.nodes[parseInt(e)+o];t.each(n.input_connections,function(e,n){n&&(t.isArray(n)||(n=[n]),t.each(n,function(t,n){var s=r.nodes[parseInt(n.id)+o],l=new a.default;l.connect(s.output_terminals[n.output_name],i.input_terminals[e]),l.redraw()}))}),l&&t.each(i.output_terminals,function(e,n){if(void 0===i.post_job_actions["HideDatasetAction"+n.name]){i.addWorkflowOutput(n.name);t(i.element).find(".callout."+n.name).find("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"),r.has_changes=!0}})})},check_changes_in_active_form:function(){this.active_form_has_changes&&(this.has_changes=!0,t("#right-content").find("form").submit(),this.active_form_has_changes=!1)},reload_active_node:function(){if(this.active_node){var t=this.active_node;this.clear_active_node(),this.activate_node(t)}},clear_active_node:function(){this.active_node&&(this.active_node.make_inactive(),this.active_node=null),document.activeElement.blur(),this.app.showAttributes()},activate_node:function(t){this.active_node!=t&&(this.check_changes_in_active_form(),this.clear_active_node(),this.app.showForm(t.config_form,t),t.make_active(),this.active_node=t)},node_changed:function(t,e){this.has_changes=!0,this.active_node==t&&e&&(this.check_changes_in_active_form(),this.app.showForm(t.config_form,t)),this.app.showWorkflowParameters()},layout:function(){this.check_changes_in_active_form(),this.has_changes=!0;var e={},n={};t.each(this.nodes,function(t,i){void 0===e[t]&&(e[t]=0),void 0===n[t]&&(n[t]=[])}),t.each(this.nodes,function(i,r){t.each(r.input_terminals,function(i,a){t.each(a.connectors,function(t,i){var a=i.handle1.node;e[r.id]+=1,n[a.id].push(r.id)})})});for(var i=[];;){var r=[];for(var a in e)0===e[a]&&r.push(a);if(0===r.length)break;i.push(r);for(var o in r){var s=r[o];delete e[s];for(var l in n[s])e[n[s][l]]-=1}}if(!e.length){var c=this.nodes,d=80;t.each(i,function(e,n){n.sort(function(e,n){return t(c[e].element).position().top-t(c[n].element).position().top});var i=0,r=30;t.each(n,function(e,n){var a=c[n],o=t(a.element);t(o).css({top:r,left:d}),i=Math.max(i,t(o).width()),r+=t(o).height()+30}),d+=i+80}),t.each(c,function(t,e){e.redraw()})}},bounds_for_all_nodes:function(){var e,n=1/0,i=-1/0,r=1/0,a=-1/0;return t.each(this.nodes,function(o,s){var l=t(s.element);e=l.position(),n=Math.min(n,e.left),i=Math.max(i,e.left+l.width()),r=Math.min(r,e.top),a=Math.max(a,e.top+l.width())}),{xmin:n,xmax:i,ymin:r,ymax:a}},fit_canvas_to_nodes:function(){function e(t,e){return Math.ceil(t/e)*e}function n(t,e){if(t<e||t>3*e){return-(t-(Math.ceil(t%e/e)+1)*e)}return 0}var i=this.bounds_for_all_nodes(),r=this.canvas_container.position(),a=this.canvas_container.parent(),o=n(i.xmin,100),s=n(i.ymin,100);o=Math.max(o,r.left),s=Math.max(s,r.top);var l=r.left-o,c=r.top-s,d=e(i.xmax+100,100)+o,u=e(i.ymax+100,100)+s;d=Math.max(d,-l+a.width()),u=Math.max(u,-c+a.height()),this.canvas_container.css({left:l,top:c,width:d,height:u}),this.canvas_container.children().each(function(){var e=t(this).position();t(this).css("left",e.left+o),t(this).css("top",e.top+s)})}}),e.default=i}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function n(t,e,n){this.app=t,this.cv=e,this.cc=this.cv.find("#canvas-container"),this.overview=n,this.oc=n.find("#overview-canvas"),this.ov=n.find("#overview-viewport"),this.init_drag(),this.init_copy_paste()}function i(t){this.panel=t}Object.defineProperty(e,"__esModule",{value:!0}),t.extend(n.prototype,{init_drag:function(){var e=this,n=function(t,n){t=Math.min(t,e.cv.width()/2),t=Math.max(t,-e.cc.width()+e.cv.width()/2),n=Math.min(n,e.cv.height()/2),n=Math.max(n,-e.cc.height()+e.cv.height()/2),e.cc.css({left:t,top:n}),e.cv.css({"background-position-x":t,"background-position-y":n}),e.update_viewport_overlay()};this.cc.each(function(){this.scroll_panel=new i(this)});var r,a;this.cv.bind("click",function(){document.activeElement.blur()}).bind("dragstart",function(){var n=t(this).offset(),i=e.cc.position();a=i.top-n.top,r=i.left-n.left}).bind("drag",function(t,e){n(e.offsetX+r,e.offsetY+a)}).bind("dragend",function(){e.app.workflow.fit_canvas_to_nodes(),e.draw_overview()}),this.overview.click(function(t){if(e.overview.hasClass("blockaclick"))e.overview.removeClass("blockaclick");else{var i=e.cc.width(),r=e.cc.height(),a=e.oc.width(),o=e.oc.height(),s=t.pageX-e.oc.offset().left-e.ov.width()/2,l=t.pageY-e.oc.offset().top-e.ov.height()/2;n(-s/a*i,-l/o*r),e.app.workflow.fit_canvas_to_nodes(),e.draw_overview()}}),this.ov.bind("drag",function(t,i){var r=e.cc.width(),a=e.cc.height(),o=e.oc.width(),s=e.oc.height(),l=i.offsetX-e.overview.offset().left,c=i.offsetY-e.overview.offset().top;n(-l/o*r,-c/s*a)}).bind("dragend",function(){e.overview.addClass("blockaclick"),e.app.workflow.fit_canvas_to_nodes(),e.draw_overview()}),t("#overview-border").bind("drag",function(n,i){var r=t(this).offsetParent(),a=r.offset(),o=Math.max(r.width()-(i.offsetX-a.left),r.height()-(i.offsetY-a.top));t(this).css({width:o,height:o}),e.draw_overview()}),t("#overview-border div").bind("drag",function(){})},init_copy_paste:function(){var t=this;document.addEventListener("copy",function(e){""===window.getSelection().toString()&&(t.app.workflow.active_node&&"subworkflow"!==t.app.workflow.active_node.type&&e.clipboardData.setData("application/json",JSON.stringify({nodeId:t.app.workflow.active_node.id})),e.preventDefault())}),document.addEventListener("paste",function(e){if(document.activeElement&&"textarea"!==document.activeElement.type&&"text"!==document.activeElement.type){var n;try{n=JSON.parse(e.clipboardData.getData("application/json")).nodeId}catch(t){}n&&t.app.workflow.nodes.hasOwnProperty(n)&&t.app.workflow.nodes[n].clone(),e.preventDefault()}})},update_viewport_overlay:function(){var t=this.cc,e=this.cv,n=this.oc,i=this.ov,r=t.width(),a=t.height(),o=n.width(),s=n.height(),l=t.position();i.css({left:-l.left/r*o,top:-l.top/a*s,width:e.width()/r*o-2,height:e.height()/a*s-2})},draw_overview:function(){var e,n,i,r,a=t("#overview-canvas"),o=a.parent().parent().width(),s=a.get(0).getContext("2d"),l=t("#canvas-container").width(),c=t("#canvas-container").height(),d=this.cv.width(),u=this.cv.height();l<d&&c<u?(i=l/d*o,r=(o-i)/2,e=c/u*o,n=(o-e)/2):l<c?(n=0,e=o,i=Math.ceil(e*l/c),r=(o-i)/2):(i=o,r=0,e=Math.ceil(i*c/l),n=(o-e)/2),a.parent().css({left:r,top:n,width:i,height:e}),a.attr("width",i),a.attr("height",e),t.each(this.app.workflow.nodes,function(n,r){s.fillStyle="#D2C099",s.strokeStyle="#D8B365",s.lineWidth=1;var a=t(r.element),o=a.position(),d=o.left/l*i,u=o.top/c*e,h=a.width()/l*i,f=a.height()/c*e;r.errors?(s.fillStyle="#FFCCCC",s.strokeStyle="#AA6666"):void 0!==r.workflow_outputs&&r.workflow_outputs.length>0&&(s.fillStyle="#E8A92D",s.strokeStyle="#E8A92D"),s.fillRect(d,u,h,f),s.strokeRect(d,u,h,f)}),this.update_viewport_overlay()}}),t.extend(i.prototype,{test:function(e,n){var i=this;clearTimeout(this.timeout);var r=e.pageX,a=e.pageY,o=t(this.panel),s=o.position(),l=o.width(),c=o.height(),d=o.parent(),u=d.width(),h=d.height(),f=d.offset(),p=f.left,_=f.top,g=p+d.width(),m=_+d.height(),v=-(l-u/2),y=-(c-h/2),b=u/2,w=h/2,x=!1,k=0;r-5<p?s.left<b&&(k=Math.min(23,b-s.left),o.css("left",s.left+k),x=!0):r+5>g?s.left>v&&(k=Math.min(23,s.left-v),o.css("left",s.left-k),x=!0):a-5<_?s.top<w&&(k=Math.min(23,w-s.top),o.css("top",s.top+k),x=!0):a+5>m&&s.top>y&&(k=Math.min(23,s.top-v),o.css("top",s.top-k+"px"),x=!0),x&&(n(),this.timeout=setTimeout(function(){i.test(e,n)},50))},stop:function(){clearTimeout(this.timeout)}}),e.default=n}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(5),s=a(o),l=n(720),c=a(l),d=t.Model.extend({initialize:function(t,e){this.app=t,this.element=e.element,this.input_terminals={},this.output_terminals={},this.errors={},this.workflow_outputs=[]},getWorkflowOutput:function(t){return i.findWhere(this.workflow_outputs,{output_name:t})},isWorkflowOutput:function(t){return void 0!==this.getWorkflowOutput(t)},removeWorkflowOutput:function(t){for(;this.isWorkflowOutput(t);){var e=this.getWorkflowOutput(t);this.workflow_outputs.splice(i.indexOf(this.workflow_outputs,e),1)}},addWorkflowOutput:function(t,e){if(!this.isWorkflowOutput(t)){var n={output_name:t};return e&&(n.label=e),this.workflow_outputs.push(n),!0}return!1},labelWorkflowOutput:function(t,e){var n=!1,i=null;if(this.isWorkflowOutput(t)){var r=this.getWorkflowOutput(t);i=r.label,r.label=e,n=i!=e}else n=this.addWorkflowOutput(t,e);return n&&(this.app.workflow.updateOutputLabel(i,e),this.markChanged(),this.nodeView.redrawWorkflowOutputs()),n},connectedOutputTerminals:function(){return this._connectedTerminals(this.output_terminals)},_connectedTerminals:function(t){var e=[];return r.each(t,function(t,n){n.connectors.length>0&&e.push(n)}),e},hasConnectedOutputTerminals:function(){var t=this.output_terminals;for(var e in t)if(t[e].connectors.length>0)return!0;return!1},connectedMappedInputTerminals:function(){return this._connectedMappedTerminals(this.input_terminals)},hasConnectedMappedInputTerminals:function(){var t=this.input_terminals;for(var e in t){var n=t[e];if(n.connectors.length>0&&n.isMappedOver())return!0}return!1},_connectedMappedTerminals:function(t){var e=[];return r.each(t,function(t,n){n.mapOver().isCollection&&n.connectors.length>0&&e.push(n)}),e},mappedInputTerminals:function(){return this._mappedTerminals(this.input_terminals)},_mappedTerminals:function(t){var e=[];return r.each(t,function(t,n){n.mapOver().isCollection&&e.push(n)}),e},hasMappedOverInputTerminals:function(){var t=!1;return i.each(this.input_terminals,function(e){e.mapOver().isCollection&&(t=!0)}),t},redraw:function(){r.each(this.input_terminals,function(t,e){e.redraw()}),r.each(this.output_terminals,function(t,e){e.redraw()})},clone:function(){var t=this,e={name:this.name,label:this.label,annotation:this.annotation,post_job_actions:this.post_job_actions},n=this.app.workflow.create_node(this.type,this.name,this.content_id);s.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{type:this.type,tool_id:this.content_id,tool_state:this.tool_state},success:function(i){var r=Object.assign({},i,e);n.init_field_data(r),n.update_field_data(r),t.app.workflow.activate_node(n)}})},destroy:function(){r.each(this.input_terminals,function(t,e){e.destroy()}),r.each(this.output_terminals,function(t,e){e.destroy()}),this.app.workflow.remove_node(this),r(this.element).remove()},make_active:function(){r(this.element).addClass("toolForm-active")},make_inactive:function(){var t=this.element.get(0);!function(e){e.removeChild(t),e.appendChild(t)}(t.parentNode),r(t).removeClass("toolForm-active")},set_tool_version:function(){"tool"===this.type&&this.config_form&&(this.tool_version=this.config_form.version,this.content_id=this.config_form.id)},init_field_data:function(t){t.type&&(this.type=t.type),this.name=t.name,this.config_form=t.config_form,this.set_tool_version(),this.tool_state=t.tool_state,this.errors=t.errors,this.tooltip=t.tooltip?t.tooltip:"",this.annotation=t.annotation,this.post_job_actions=t.post_job_actions?t.post_job_actions:{},this.label=t.label,this.uuid=t.uuid,this.workflow_outputs=t.workflow_outputs?t.workflow_outputs:[];var e=this,n=new c.default({el:this.element[0],node:e});e.nodeView=n,r.each(t.data_inputs,function(t,e){n.addDataInput(e)}),t.data_inputs.length>0&&t.data_outputs.length>0&&n.addRule(),r.each(t.data_outputs,function(t,e){n.addDataOutput(e)}),n.render(),this.app.workflow.node_changed(this,!0)},update_field_data:function(t){var e=this,n=e.nodeView,a=[];if(r.each(n.outputViews,function(e,n){var r=n.output.name,o=t.data_outputs,s=!1;i.each(o,function(t){t.name==r&&(s=!0)}),!1===s&&a.push(r)}),i.each(a,function(t){i.each(n.outputViews[t].terminalElement.terminal.connectors,function(t){t&&t.destroy()}),n.outputViews[t].remove(),delete n.outputViews[t],delete e.output_terminals[t]}),r.each(e.workflow_outputs,function(t,n){n&&!e.output_terminals[n.output_name]&&e.workflow_outputs.splice(t,1)}),r.each(t.data_outputs,function(t,i){n.outputViews[i.name]?(e.output_terminals[i.name].datatypes=i.extensions,e.output_terminals[i.name].destroyInvalidConnections()):n.addDataOutput(i)}),this.tool_state=t.tool_state,this.config_form=t.config_form,this.set_tool_version(),this.errors=t.errors,this.annotation=t.annotation,this.label=t.label,"post_job_actions"in t){var o=t.post_job_actions;this.post_job_actions=o||{}}e.nodeView.renderToolErrors();var s=n.$("div.inputs"),l=n.newInputsDiv(),c={};i.each(t.data_inputs,function(t){var n=e.nodeView.addDataInput(t,l);c[t.name]=n}),i.each(i.difference(i.values(n.terminalViews),i.values(c)),function(t){t.el.terminal.destroy()}),n.terminalViews=c,e.nodeView.render(),1==t.data_outputs.length&&"collection_type"in t.data_outputs[0]&&n.updateDataOutput(t.data_outputs[0]),s.replaceWith(l),"workflow_outputs"in t&&(this.workflow_outputs=t.workflow_outputs?t.workflow_outputs:[]),this.markChanged(),this.redraw()},error:function(t){var e=r(this.element).find(".toolFormBody");e.find("div").remove();var n="<div style='color: red; text-style: italic;'>"+t+"</div>";this.config_form=n,e.html(n),this.app.workflow.node_changed(this)},markChanged:function(){this.app.workflow.node_changed(this)}});e.default=d}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(721),l=r(s),c=n(723),d=r(c);e.default=t.View.extend({initialize:function(t){this.node=t.node,this.output_width=Math.max(150,this.$el.width()),this.tool_body=this.$el.find(".toolFormBody"),this.tool_body.find("div").remove(),this.newInputsDiv().appendTo(this.tool_body),this.terminalViews={},this.outputViews={}},render:function(){this.renderToolLabel(),this.renderToolErrors(),this.$el.css("width",Math.min(250,Math.max(this.$el.width(),this.output_width)))},renderToolLabel:function(){this.$(".nodeTitle").text(this.node.label||this.node.name),this.$el.attr("node-label",this.node.label)},renderToolErrors:function(){this.node.errors?this.$el.addClass("tool-node-error"):this.$el.removeClass("tool-node-error")},newInputsDiv:function(){return i("<div/>").addClass("inputs")},updateMaxWidth:function(t){this.output_width=Math.max(this.output_width,t)},addRule:function(){this.tool_body.append(i("<div/>").addClass("rule"))},addDataInput:function(t,e){var n=!0;e||(e=this.$(".inputs"),n=!1);var i=this.terminalViews[t.name],r="dataset_collection"==t.input_type?l.default.InputCollectionTerminalView:l.default.InputTerminalView;if(!i||i instanceof r||(i.el.terminal.destroy(),i=null),i){var a=i.el.terminal;a.update(t),a.destroyInvalidConnections()}else i=new r({node:this.node,input:t});this.terminalViews[t.name]=i;var o=i.el,s=new d.default.DataInputView({terminalElement:o,input:t,nodeView:this,skipResize:n}),c=s.$el;return e.append(c.prepend(i.terminalElements())),i},addDataOutput:function(t){var e=t.collection?l.default.OutputCollectionTerminalView:l.default.OutputTerminalView,n=new e({node:this.node,output:t}),i=new d.default.DataOutputView({output:t,terminalElement:n.el,nodeView:this});this.outputViews[t.name]=i,this.tool_body.append(i.$el.append(n.terminalElements()))},redrawWorkflowOutputs:function(){o.each(this.outputViews,function(t){t.redrawWorkflowOutput()})},updateDataOutput:function(t){this.node.output_terminals[t.name].update(t)}})}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(722),s=a(o),l=n(410),c=a(l);window.workflow_globals=window.workflow_globals||{};var d=t.View.extend({tagName:"div",className:"fa-icon-button fa fa-folder-o",initialize:function(t){this.$el.tooltip({delay:500,title:"Run tool in parallel over collection"}),this.model.bind("change",i.bind(this.render,this))},render:function(){this.model.mapOver.isCollection?this.$el.show():this.$el.hide()}}),u=d.extend({events:{click:"onClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(t){var e=this.model;!e.terminal.connected()&&e.mapOver.isCollection&&this.$el.css("color","red")},onMouseLeave:function(t){this.$el.css("color","black")},onClick:function(t){var e=this.model;!e.terminal.connected()&&e.mapOver.isCollection&&e.terminal.resetMapping()}}),h=t.View.extend({setupMappingView:function(t){var e=new this.terminalMappingClass({terminal:t}),n=new this.terminalMappingViewClass({model:e});n.render(),t.terminalMappingView=n,this.terminalMappingView=n},terminalElements:function(){return this.terminalMappingView?[this.terminalMappingView.el,this.el]:[this.el]}}),f=h.extend({className:"terminal input-terminal",initialize:function(t){var e=t.node,n=t.input,i=n.name,r="node-"+e.cid+"-input-"+i,a=this.terminalForInput(n);a.multiple||this.setupMappingView(a),this.el.terminal=a,this.$el.attr("input-name",i),this.$el.attr("id",r),this.id=r,a.node=e,a.name=i,e.input_terminals[i]=a},events:{dropinit:"onDropInit",dropstart:"onDropStart",dropend:"onDropEnd",drop:"onDrop",hover:"onHover"},onDropInit:function(t,e){var n=this.el.terminal;return r(e.drag).hasClass("output-terminal")&&n.canAccept(e.drag.terminal)},onDropStart:function(t,e){e.proxy.terminal&&(e.proxy.terminal.connectors[0].inner_color="#BBFFBB")},onDropEnd:function(t,e){e.proxy.terminal&&(e.proxy.terminal.connectors[0].inner_color="#FFFFFF")},onDrop:function(t,e){var n=this.el.terminal;new c.default(e.drag.terminal,n).redraw()},onHover:function(){var t=this.el,e=t.terminal;if(e.connectors.length>0){var n=r("<div class='callout'></div>").css({display:"none"}).appendTo("body").append(r("<div class='button'></div>").append(r("<div/>").addClass("fa-icon-button fa fa-times").click(function(){r.each(e.connectors,function(t,e){e&&e.destroy()}),n.remove()}))).bind("mouseleave",function(){r(this).remove()});n.css({top:r(t).offset().top-2,left:r(t).offset().left-n.width(),"padding-right":r(t).width()}).show()}}}),p=f.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:u,terminalForInput:function(t){return new s.default.InputTerminal({element:this.el,input:t})}}),_=f.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:u,terminalForInput:function(t){return new s.default.InputCollectionTerminal({element:this.el,input:t})}}),g=h.extend({className:"terminal output-terminal",initialize:function(t){var e=t.node,n=t.output,i=n.name,r="node-"+e.cid+"-output-"+i,a=this.terminalForOutput(n);this.setupMappingView(a),this.el.terminal=a,this.$el.attr("output-name",i),this.$el.attr("id",r),a.node=e,a.name=i,e.output_terminals[i]=a},events:{drag:"onDrag",dragstart:"onDragStart",dragend:"onDragEnd"},onDrag:function(t,e){var n=function(){var t=r(e.proxy).offsetParent().offset(),n=e.offsetX-t.left,i=e.offsetY-t.top;r(e.proxy).css({left:n,top:i}),e.proxy.terminal.redraw(),window.workflow_globals.canvas_manager.update_viewport_overlay()};n(),r("#canvas-container").get(0).scroll_panel.test(t,n)},onDragStart:function(t,e){r(e.available).addClass("input-terminal-active"),window.workflow_globals.workflow.check_changes_in_active_form();var n=r('<div class="drag-terminal" style="position: absolute;"></div>').appendTo("#canvas-container").get(0);n.terminal=new s.default.OutputTerminal({element:n});var i=new c.default;return i.dragging=!0,i.connect(this.el.terminal,n.terminal),n},onDragEnd:function(t,e){var n=e.proxy.terminal.connectors[0];n&&n.destroy(),r(e.proxy).remove(),r(e.available).removeClass("input-terminal-active"),r("#canvas-container").get(0).scroll_panel.stop()}}),m=g.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:d,terminalForOutput:function(t){var e=t.extensions;return new s.default.OutputTerminal({element:this.el,datatypes:e})}}),v=g.extend({terminalMappingClass:s.default.TerminalMapping,terminalMappingViewClass:d,terminalForOutput:function(t){var e=t.collection_type,n=t.collection_type_source;return new s.default.OutputCollectionTerminal({element:this.el,collection_type:e,collection_type_source:n,datatypes:t.extensions})}});e.default={InputTerminalView:p,OutputTerminalView:m,InputCollectionTerminalView:_,OutputCollectionTerminalView:v}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){this.collectionType=t,this.isCollection=!0,this.rank=t.split(":").length}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(o);window.workflow_globals=window.workflow_globals||{};var l={isCollection:!1,canMatch:function(){return!1},canMapOver:function(){return!1},toString:function(){return"NullCollectionType[]"},append:function(t){return t},equal:function(t){return t===this}},c={isCollection:!0,canMatch:function(t){return l!==t},canMapOver:function(){return!1},toString:function(){return"AnyCollectionType[]"},append:function(){return c},equal:function(t){return t===this}};t.extend(a.prototype,{append:function(t){return t===l?this:t===c?t:new a(this.collectionType+":"+t.collectionType)},canMatch:function(t){return t!==l&&(t===c||t.collectionType==this.collectionType)},canMapOver:function(t){if(t===l)return!1;if(t===c)return!1;if(this.rank<=t.rank)return!1;var e=t.collectionType;return this._endsWith(this.collectionType,e)},effectiveMapOver:function(t){var e=t.collectionType;return new a(this.collectionType.substring(0,this.collectionType.length-e.length-1))},equal:function(t){return t.collectionType==this.collectionType},toString:function(){return"CollectionType["+this.collectionType+"]"},_endsWith:function(t,e){return-1!==t.indexOf(e,t.length-e.length)}});var d=i.Model.extend({initialize:function(t){this.mapOver=t.mapOver||l,this.terminal=t.terminal,this.terminal.terminalMapping=this},disableMapOver:function(){this.setMapOver(l)},setMapOver:function(t){this.mapOver=t,this.trigger("change")}}),u=i.Model.extend({initialize:function(t){this.element=t.element,this.connectors=[]},connect:function(t){this.connectors.push(t),this.node&&this.node.markChanged()},disconnect:function(e){this.connectors.splice(t.inArray(e,this.connectors),1),this.node&&(this.node.markChanged(),this.resetMappingIfNeeded())},redraw:function(){t.each(this.connectors,function(t,e){e.redraw()})},destroy:function(){t.each(this.connectors.slice(),function(t,e){e.destroy()})},destroyInvalidConnections:function(){r.each(this.connectors,function(t){t&&t.destroyIfInvalid()})},setMapOver:function(t){this.multiple||this.mapOver().equal(t)||(this.terminalMapping.setMapOver(t),r.each(this.node.output_terminals,function(e){e.setMapOver(t)}))},mapOver:function(){return this.terminalMapping?this.terminalMapping.mapOver:l},isMappedOver:function(){return this.terminalMapping&&this.terminalMapping.mapOver.isCollection},resetMapping:function(){this.terminalMapping.disableMapOver()},resetMappingIfNeeded:function(){}}),h=u.extend({initialize:function(t){u.prototype.initialize.call(this,t),this.datatypes=t.datatypes},resetMappingIfNeeded:function(){this.node.hasConnectedOutputTerminals()||this.node.hasConnectedMappedInputTerminals()||r.each(this.node.mappedInputTerminals(),function(t){t.resetMappingIfNeeded()}),!this.node.hasMappedOverInputTerminals()&&this.resetMapping()},resetMapping:function(){this.terminalMapping.disableMapOver(),r.each(this.connectors,function(t){var e=t.handle2;e&&(e.resetMappingIfNeeded(),t.destroyIfInvalid())})}}),f=u.extend({initialize:function(t){u.prototype.initialize.call(this,t),this.update(t.input)},canAccept:function(t){return!this._inputFilled()&&this.attachable(t)},resetMappingIfNeeded:function(){this.mapOver().isCollection&&((this.node.hasConnectedMappedInputTerminals()||!this.node.hasConnectedOutputTerminals())&&this.resetMapping())},resetMapping:function(){this.terminalMapping.disableMapOver(),this.node.hasMappedOverInputTerminals()||r.each(this.node.output_terminals,function(t){t.resetMapping()})},connected:function(){return 0!==this.connectors.length},_inputFilled:function(){return!!this.connected()&&(!this.multiple||!!this._collectionAttached())},_collectionAttached:function(){if(this.connected()){var t=this.connectors[0].handle1;return!!t&&!!(t.isCollection||t.isMappedOver()||t.datatypes.indexOf("input_collection")>0)}return!1},_mappingConstraints:function(){if(!this.node)return[];var t=this.mapOver();if(t.isCollection)return[t];var e=[];return this.node.hasConnectedOutputTerminals()?e.push(r.first(r.values(this.node.output_terminals)).mapOver()):r.each(this.node.connectedMappedInputTerminals(),function(t){e.push(t.mapOver())}),e},_producesAcceptableDatatype:function(t){for(var e in this.datatypes){var n=this.datatypes[e];if("input"==n)return!0;var i=[];if(i=i.concat(t.datatypes),t.node.post_job_actions)for(var r in t.node.post_job_actions){var a=t.node.post_job_actions[r];"ChangeDatatypeAction"!=a.action_type||""!==a.output_name&&a.output_name!=t.name||!a.action_arguments||i.push(a.action_arguments.newtype)}for(var o in i){var s=i[o];if("input"==s||"_sniff_"==s||"input_collection"==s||window.workflow_globals.app.isSubType(i[o],n))return!0}}return!1},_otherCollectionType:function(t){var e=l;t.isCollection&&(e=t.collectionType);var n=t.mapOver();return n.isCollection&&(e=n.append(e)),e}}),p=f.extend({update:function(t){this.datatypes=t.extensions,this.multiple=t.multiple,this.collection=!1},connect:function(t){f.prototype.connect.call(this,t);var e=t.handle1;if(e){var n=this._otherCollectionType(e);n.isCollection&&this.setMapOver(n)}},attachable:function(t){var e=this._otherCollectionType(t),n=this.mapOver();if(e.isCollection){if(this.multiple)return!(this.connected()&&!this._collectionAttached())&&(1==e.rank&&this._producesAcceptableDatatype(t));if(n.isCollection&&n.canMatch(e))return this._producesAcceptableDatatype(t);return!!this._mappingConstraints().every(r.bind(e.canMatch,e))&&this._producesAcceptableDatatype(t)}return!n.isCollection&&this._producesAcceptableDatatype(t)}}),_=f.extend({update:function(t){this.multiple=!1,this.collection=!0,this.datatypes=t.extensions;var e=[];t.collection_types?r.each(t.collection_types,function(t){e.push(new a(t))}):e.push(c),this.collectionTypes=e},connect:function(t){f.prototype.connect.call(this,t);var e=t.handle1;if(e){var n=this._effectiveMapOver(e);this.setMapOver(n)}},_effectiveMapOver:function(t){var e=this.collectionTypes,n=this._otherCollectionType(t);if(!r.some(e,function(t){return t.canMatch(n)}))for(var i in e){var a=e[i];if(n.canMapOver(a)){var o=n.effectiveMapOver(a);if(o!=l)return o}}return l},_effectiveCollectionTypes:function(){var t=this.mapOver();return r.map(this.collectionTypes,function(e){return t.append(e)})},attachable:function(t){var e=this._otherCollectionType(t);if(e.isCollection){var n=this._effectiveCollectionTypes(),i=this.mapOver();if(r.some(n,function(t){return t.canMatch(e)}))return this._producesAcceptableDatatype(t);if(i.isCollection)return!1;if(r.some(this.collectionTypes,function(t){return e.canMapOver(t)})){var a=this._effectiveMapOver(t);if(!a.isCollection)return!1;if(this._mappingConstraints().every(a.canMatch))return this._producesAcceptableDatatype(t)}}return!1}}),g=u.extend({initialize:function(t){if(u.prototype.initialize.call(this,t),this.datatypes=t.datatypes,t.collection_type)this.collectionType=new a(t.collection_type);else{t.collection_type_source||console.log("Warning: No collection type or collection type source defined."),this.collectionType=c}this.isCollection=!0},update:function(t){var e;if(t.collection_type)e=new a(t.collection_type);else{t.collection_type_source||console.log("Warning: No collection type or collection type source defined."),e=c}e.collectionType!=this.collectionType.collectionType&&r.each(this.connectors,function(t){s.warning("Destroying a connection because collection type has changed."),t.destroy()}),this.collectionType=e}});e.default={InputTerminal:p,OutputTerminal:h,InputCollectionTerminal:_,OutputCollectionTerminal:g,TerminalMapping:d,CollectionTypeDescription:a,NULL_COLLECTION_TYPE_DESCRIPTION:l,ANY_COLLECTION_TYPE_DESCRIPTION:c}}).call(e,n(0),n(2),n(1))},function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0}),window.workflow_globals=window.workflow_globals||{};var i=t.View.extend({className:"form-row dataRow input-data-row",initialize:function(t){this.input=t.input,this.nodeView=t.nodeView,this.terminalElement=t.terminalElement,this.$el.attr("name",this.input.name).html(this.input.label),t.skipResize||(this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()),this.$el.css({position:"",left:"",top:"",display:""}),this.$el.remove())}}),r=t.View.extend({className:"form-row dataRow",initialize:function(t){this.output=t.output,this.terminalElement=t.terminalElement,this.nodeView=t.nodeView;var e=this.output,i=e.name,r=this.nodeView.node;if(e.extensions.indexOf("input")>=0||e.extensions.indexOf("input_collection")>=0||(i=i+" ("+e.extensions.join(", ")+")"),this.$el.html(i),this.calloutView=null,["tool","subworkflow"].indexOf(r.type)>=0){var o=new a({label:i,output:e,node:r});this.calloutView=o,this.$el.append(o.el),this.$el.hover(function(){o.hoverImage()},function(){o.resetImage()})}this.$el.css({position:"absolute",left:-1e3,top:-1e3,display:"none"}),n("body").append(this.el),this.nodeView.updateMaxWidth(this.$el.outerWidth()+17),this.$el.css({position:"",left:"",top:"",display:""}).detach()},redrawWorkflowOutput:function(){this.calloutView&&this.calloutView.resetImage()}}),a=t.View.extend({tagName:"div",initialize:function(t){this.label=t.label,this.node=t.node,this.output=t.output;var e=this,i=this.node;this.$el.attr("class","callout "+this.label).css({display:"none"}).append(n("<div class='buttons'></div>").append(n("<img/>").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png").click(function(){var t=e.output.name;i.isWorkflowOutput(t)?(i.removeWorkflowOutput(t),e.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")):(i.addWorkflowOutput(t),e.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png")),window.workflow_globals.workflow.has_changes=!0,window.workflow_globals.canvas_manager.draw_overview()}))).tooltip({delay:500,title:"Mark dataset as a workflow output. All unmarked datasets will be hidden."}),this.$el.css({top:"50%",margin:"-8px 0px 0px 0px",right:8}),this.$el.show(),this.resetImage()},resetImage:function(){this.node.isWorkflowOutput(this.output.name)?this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small.png"):this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-outline.png")},hoverImage:function(){this.$("img").attr("src",Galaxy.root+"static/images/fugue/asterisk-small-yellow.png")}});e.default={DataInputView:i,DataOutputView:r}}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}function a(t){var e=t.model.attributes,n=e.workflow,i=e.node;e.inputs.unshift({type:"text",name:"__annotation",label:"Annotation",fixed:!0,value:i.annotation,area:!0,help:"Add an annotation or notes to this step. Annotations are available when a workflow is viewed."}),e.inputs.unshift({type:"text",name:"__label",label:"Label",value:i.label,help:(0,d.default)("Add a step label."),fixed:!0,onchange:function(e){var r=!1;for(var a in n.nodes){var o=n.nodes[a];if(o.label&&o.label==e&&o.id!=i.id){r=!0;break}}var s=t.data.match("__label");t.element_list[s].model.set("error_text",r&&"Duplicate label. Please fix this before saving the workflow."),t.trigger("change")}})}function o(t,e,n,i){var r=i.node.post_job_actions;e=e||[],e.push(t);for(var a in t.inputs){var s=t.inputs[a];if(s.action){if(s.name="pja__"+n+"__"+s.action,s.pja_arg&&(s.name+="__"+s.pja_arg),s.payload)for(var l in s.payload)s.payload[s.name+"__"+l]=s.payload[l],delete s.payload[l];var c=r[s.action+n];if(c){for(var d in e)e[d].expanded=!0;s.pja_arg?s.value=c.action_arguments&&c.action_arguments[s.pja_arg]||s.value:s.value="true"}}s.inputs&&o(s,e.slice(0),n,i)}}function s(t,e){var n=[],i=[],r=e.datatypes,a=e.node,s=e.workflow;for(var l in r)n.push({0:r[l],1:r[l]});for(l in a.input_terminals)i.push(a.input_terminals[l].name);n.sort(function(t,e){return t.label>e.label?1:t.label<e.label?-1:0}),n.unshift({0:"Sequences",1:"Sequences"}),n.unshift({0:"Roadmaps",1:"Roadmaps"}),n.unshift({0:"Leave unchanged",1:"__empty__"});var c,u={title:"Configure Output: '"+t+"'",type:"section",flat:!0,inputs:[{label:"Label",type:"text",value:(c=a.getWorkflowOutput(t))&&c.label||"",help:"This will provide a short name to describe the output - this must be unique across workflows.",onchange:function(e){s.attemptUpdateOutputLabel(a,t,e)}},{action:"RenameDatasetAction",pja_arg:"newname",label:"Rename dataset",type:"text",value:"",ignore:"",help:'This action will rename the output dataset. Click <a href="https://galaxyproject.org/learn/advanced-workflow/variables/">here</a> for more information. Valid inputs are: <strong>'+i.join(", ")+"</strong>."},{action:"ChangeDatatypeAction",pja_arg:"newtype",label:"Change datatype",type:"select",ignore:"__empty__",value:"__empty__",options:n,help:"This action will change the datatype of the output to the indicated value."},{action:"TagDatasetAction",pja_arg:"tags",label:"Add Tags",type:"text",value:"",ignore:"",help:"This action will set tags for the dataset."},{action:"RemoveTagDatasetAction",pja_arg:"tags",label:"Remove Tags",type:"text",value:"",ignore:"",help:"This action will remove tags for the dataset."},{title:(0,d.default)("Assign columns"),type:"section",flat:!0,inputs:[{action:"ColumnSetAction",pja_arg:"chromCol",label:"Chrom column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"startCol",label:"Start column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"endCol",label:"End column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"strandCol",label:"Strand column",type:"integer",value:"",ignore:""},{action:"ColumnSetAction",pja_arg:"nameCol",label:"Name column",type:"integer",value:"",ignore:""}],help:"This action will set column assignments in the output dataset. Blank fields are ignored."}]};return o(u,[],t,e),u}function l(t){var e=t.model.attributes,n=e.inputs,i=e.node,r=i.post_job_actions,a=i.output_terminals&&Object.keys(i.output_terminals)[0];if(a){n.push({name:"pja__"+a+"__EmailAction",label:"Email notification",type:"boolean",value:String(Boolean(r["EmailAction"+a])),ignore:"false",help:(0,d.default)("An email notification will be sent when the job has completed."),payload:{host:window.location.host}}),n.push({name:"pja__"+a+"__DeleteIntermediatesAction",label:"Output cleanup",type:"boolean",value:String(Boolean(r["DeleteIntermediatesAction"+a])),ignore:"false",help:"Upon completion of this step, delete non-starred outputs from completed workflow steps if they are no longer required as inputs."});for(var o in i.output_terminals)n.push(s(o,e))}}Object.defineProperty(e,"__esModule",{value:!0});var c=n(3),d=r(c),u=n(5),h=r(u),f=n(26),p=r(f),_=n(55),g=r(_),m=t.View.extend({initialize:function(t){var e=this,n=t.node;this.form=new p.default(h.default.merge(t,{onchange:function(){h.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:{id:n.id,type:n.type,content_id:n.content_id,inputs:e.form.data.create()},success:function(t){n.update_field_data(t)}})}})),a(this.form),this.form.render()}}),v=t.View.extend({initialize:function(t){var e=this,n=t.node;this.form=new g.default(h.default.merge(t,{text_enable:"Set in Advance",text_disable:"Set at Runtime",narrow:!0,initial_errors:!0,cls:"ui-portlet-narrow",initialmodel:function(t,n){e._customize(n),t.resolve()},buildmodel:function(t,e){e.model.get("postchange")(t,e)},postchange:function(t,r){var a=r.model.attributes,o={tool_id:a.id,tool_version:a.version,type:"tool",inputs:i.extend(!0,{},r.data.create())};Galaxy.emit.debug("tool-form-workflow::postchange()","Sending current state.",o),h.default.request({type:"POST",url:Galaxy.root+"api/workflows/build_module",data:o,success:function(i){r.model.set(i.config_form),e._customize(r),r.update(i.config_form),r.errors(i.config_form),n.update_field_data(i),Galaxy.emit.debug("tool-form-workflow::postchange()","Received new model.",i),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form-workflow::postchange()","Refresh request failed.",e),t.reject()}})}}))},_customize:function(t){var e=t.model.attributes;h.default.deepeach(e.inputs,function(t){t.type&&(-1!=["data","data_collection"].indexOf(t.type)?(t.type="hidden",t.info="Data input '"+t.name+"' ("+h.default.textify(t.extensions)+")",t.value={__class__:"RuntimeValue"}):t.fixed||(t.collapsible_value={__class__:"RuntimeValue"},t.is_workflow=t.options&&0===t.options.length||-1!=["integer","float"].indexOf(t.type)))}),h.default.deepeach(e.inputs,function(t){"conditional"===t.type&&(t.test_param.collapsible_value=void 0)}),l(t),a(t)}});e.default={Default:m,Tool:v}}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(1),c=r(l),d=n(224),u=r(d),h=n(15),f=a(h),p=n(5),_=a(p),g=n(33),m=a(g),v=n(31),y=a(v);n(150);var b=t.Model.extend({is_visible:function(t,e){var n=t.getBoundingClientRect(),r=i("svg")[0].getBoundingClientRect();return!(n.right<0||n.left>r.right||n.bottom<0||n.top>r.bottom)}}),w={drawTicks:function(t,e,n,i,r){var a=t.append("g").selectAll("g").data(e).enter().append("g").selectAll("g").data(n).enter().append("g").attr("class","tick").attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+t.radius+",0)"}),o=[],s=[],l=function(t){return t.angle>Math.PI?"end":null};return r?(o=[0,0,0,-4],s=[4,0,"",".35em"],l=null):(o=[1,0,4,0],s=[0,4,".35em",""]),a.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",o[2]).attr("y1",o[3]).style("stroke","#000"),a.append("text").attr("x",s[0]).attr("y",s[1]).attr("dx",s[2]).attr("dy",s[3]).attr("text-anchor",l).attr("transform",i).text(function(t){return t.label})},formatNum:function(t,e){if(void 0===e&&(e=2),null===t)return null;var n=null;if(Math.abs(t)<1)n=t.toPrecision(e);else{var i=Math.round(t.toPrecision(e));t=Math.abs(t),t<1e3?n=i:t<1e6?n=Math.round((i/1e3).toPrecision(3)).toFixed(0)+"K":t<1e9&&(n=Math.round((i/1e6).toPrecision(3)).toFixed(0)+"M")}return n}},x=t.Model.extend({}),k=t.View.extend({className:"circster",initialize:function(t){this.genome=t.genome,this.label_arc_height=50,this.scale=1,this.circular_views=null,this.chords_views=null,this.model.get("drawables").on("add",this.add_track,this),this.model.get("drawables").on("remove",this.remove_track,this);var e=this.model.get("config");e.get("arc_dataset_height").on("change:value",this.update_track_bounds,this),e.get("track_gap").on("change:value",this.update_track_bounds,this)},get_circular_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"!==t.get("track_type")})},get_chord_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"===t.get("track_type")})},get_tracks_bounds:function(){var t=this.get_circular_tracks(),e=this.model.get("config").get_value("arc_dataset_height"),n=this.model.get("config").get_value("track_gap"),i=Math.min(this.$el.width(),this.$el.height())-20,r=i/2-t.length*(e+n)+n-this.label_arc_height,a=u.range(r,i/2,e+n);return c.map(a,function(t){return[t,t+e]})},render:function(){var t=this,e=t.$el.width(),n=t.$el.height(),i=this.get_circular_tracks(),r=this.get_chord_tracks(),a=t.model.get("config").get_value("total_gap"),o=this.get_tracks_bounds(),s=u.select(t.$el[0]).append("svg").attr("width",e).attr("height",n).attr("pointer-events","all").append("svg:g").call(u.behavior.zoom().on("zoom",function(){var e=d.event.scale;s.attr("transform","translate("+d.event.translate+") scale("+e+")"),t.scale!==e&&(t.zoom_drag_timeout&&clearTimeout(t.zoom_drag_timeout),t.zoom_drag_timeout=setTimeout(function(){},400))})).attr("transform","translate("+e/2+","+n/2+")").append("svg:g").attr("class","tracks");this.circular_views=i.map(function(e,n){var i=new T({el:s.append("g")[0],track:e,radius_bounds:o[n],genome:t.genome,total_gap:a});return i.render(),i}),this.chords_views=r.map(function(e){var n=new A({el:s.append("g")[0],track:e,radius_bounds:o[0],genome:t.genome,total_gap:a});return n.render(),n});var l=this.circular_views[this.circular_views.length-1].radius_bounds[1],c=[l,l+this.label_arc_height];this.label_track_view=new C({el:s.append("g")[0],track:new x,radius_bounds:c,genome:t.genome,total_gap:a}),this.label_track_view.render()},add_track:function(t){var e=this.model.get("config").get_value("total_gap");if("DiagonalHeatmapTrack"===t.get("track_type")){var n=this.circular_views[0].radius_bounds,i=new A({el:u.select("g.tracks").append("g")[0],track:t,radius_bounds:n,genome:this.genome,total_gap:e});i.render(),this.chords_views.push(i)}else{var r=this.get_tracks_bounds();c.each(this.circular_views,function(t,e){t.update_radius_bounds(r[e])}),c.each(this.chords_views,function(t){t.update_radius_bounds(r[0])});var a=this.circular_views.length,o=new T({el:u.select("g.tracks").append("g")[0],track:t,radius_bounds:r[a],genome:this.genome,total_gap:e});o.render(),this.circular_views.push(o)}},remove_track:function(t,e,n){var i=this.circular_views[n.index];this.circular_views.splice(n.index,1),i.$el.remove();var r=this.get_tracks_bounds();c.each(this.circular_views,function(t,e){t.update_radius_bounds(r[e])})},update_track_bounds:function(){var t=this.get_tracks_bounds();c.each(this.circular_views,function(e,n){e.update_radius_bounds(t[n])}),c.each(this.chords_views,function(e){e.update_radius_bounds(t[0])})}}),M=t.View.extend({tagName:"g",initialize:function(t){this.bg_stroke="#ddd",this.loading_bg_fill="#ffc",this.bg_fill="#ddd",this.total_gap=t.total_gap,this.track=t.track,this.radius_bounds=t.radius_bounds,this.genome=t.genome,this.chroms_layout=this._chroms_layout(),this.data_bounds=[],this.scale=1,this.parent_elt=u.select(this.$el[0])},get_fill_color:function(){var t=this.track.get("config").get_value("block_color");return t||(t=this.track.get("config").get_value("color")),t},render:function(){var t=this.parent_elt,e=this.chroms_layout,n=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]),r=t.selectAll("g").data(e).enter().append("svg:g"),a=r.append("path").attr("d",n).attr("class","chrom-background").style("stroke",this.bg_stroke).style("fill",this.loading_bg_fill);a.append("title").text(function(t){return t.data.chrom});var o=this,s=o.track.get("data_manager"),l=!s||s.data_is_ready();i.when(l).then(function(){i.when(o._render_data(t)).then(function(){a.style("fill",o.bg_fill),o.render_labels()})})},render_labels:function(){},update_radius_bounds:function(t){this.radius_bounds=t;var e=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]);this.parent_elt.selectAll("g>path.chrom-background").transition().duration(1e3).attr("d",e),this._transition_chrom_data(),this._transition_labels()},update_scale:function(t){var e=this.scale;if(this.scale=t,!(t<=e)){var n=this,r=new b;return this.parent_elt.selectAll("path.chrom-data").filter(function(t,e){return r.is_visible(this)}).each(function(e,r){var a,o=u.select(this),s=o.attr("chrom"),l=n.genome.get_chrom_region(s),d=n.track.get("data_manager");d.can_get_more_detailed_data(l)&&(a=n.track.get("data_manager").get_more_detailed_data(l,"Coverage",0,t),i.when(a).then(function(t){o.remove(),n._update_data_bounds();var e=c.find(n.chroms_layout,function(t){return t.data.chrom===s}),i=n.get_fill_color();n._render_chrom_data(n.parent_elt,e,t).style("stroke",i).style("fill",i)}))}),n}},_transition_chrom_data:function(){var t=this.track,e=this.chroms_layout,n=this.parent_elt.selectAll("g>path.chrom-data");if(n[0].length>0){var r=this;i.when(t.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){var a=c.reject(c.map(i,function(t,n){var i=null,a=r._get_path_function(e[n],t);return a&&(i=a(t.data)),i}),function(t){return null===t}),o=t.get("config").get_value("color");n.each(function(t,e){u.select(this).transition().duration(1e3).style("stroke",o).style("fill",o).attr("d",a[e])})})}},_transition_labels:function(){},_update_data_bounds:function(t){this.data_bounds=t||this.get_data_bounds(this.track.get("data_manager").get_genome_wide_data(this.genome)),this._transition_chrom_data()},_render_data:function(t){var e=this,n=this.chroms_layout,r=this.track,a=i.Deferred();return i.when(r.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){e.data_bounds=e.get_data_bounds(i),r.get("config").set_value("min_value",e.data_bounds[0],{silent:!0}),r.get("config").set_value("max_value",e.data_bounds[1],{silent:!0});var o=c.zip(n,i);c.each(o,function(n){var i=n[0],r=n[1];return e._render_chrom_data(t,i,r)});var s=e.get_fill_color();e.parent_elt.selectAll("path.chrom-data").style("stroke",s).style("fill",s),a.resolve(t)}),a},_render_chrom_data:function(t,e,n){},_get_path_function:function(t,e){},_chroms_layout:function(){var t=this.genome.get_chroms_info(),e=u.layout.pie().value(function(t){return t.len}).sort(null),n=e(t),i=2*Math.PI*this.total_gap/t.length;return c.map(n,function(t,e){var n=t.endAngle-i;return t.endAngle=n>t.startAngle?n:t.startAngle,t})}}),C=M.extend({initialize:function(t){M.prototype.initialize.call(this,t),this.innerRadius=this.radius_bounds[0],this.radius_bounds[0]=this.radius_bounds[1],this.bg_stroke="#fff",this.bg_fill="#fff",this.min_arc_len=.05},_render_data:function(t){var e=this,n=t.selectAll("g");n.selectAll("path").attr("id",function(t){return"label-"+t.data.chrom}),n.append("svg:text").filter(function(t){return t.endAngle-t.startAngle>e.min_arc_len}).attr("text-anchor","middle").append("svg:textPath").attr("class","chrom-label").attr("xlink:href",function(t){return"#label-"+t.data.chrom}).attr("startOffset","25%").text(function(t){return t.data.chrom});var i=function(t){var n=(t.endAngle-t.startAngle)/t.value,i=u.range(0,t.value,25e6).map(function(i,r){return{radius:e.innerRadius,angle:i*n+t.startAngle,label:0===r?0:r%3?null:e.formatNum(i)}});return i.length<4&&(i[i.length-1].label=e.formatNum(Math.round((i[i.length-1].angle-t.startAngle)/n))),i},r=function(t){return t.angle>Math.PI?"rotate(180)translate(-16)":null},a=c.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>e.min_arc_len});this.drawTicks(this.parent_elt,a,i,r)}});c.extend(C.prototype,w);var S=M.extend({initialize:function(t){M.prototype.initialize.call(this,t);var e=this.track.get("config");e.get("min_value").on("change:value",this._update_min_max,this),e.get("max_value").on("change:value",this._update_min_max,this),e.get("color").on("change:value",this._transition_chrom_data,this)},_update_min_max:function(){var t=this.track.get("config"),e=[t.get_value("min_value"),t.get_value("max_value")];this._update_data_bounds(e),this.parent_elt.selectAll(".min_max").text(function(t,n){return e[n]})},_quantile:function(t,e){return t.sort(u.ascending),u.quantile(t,e)},_render_chrom_data:function(t,e,n){var i=this._get_path_function(e,n);return i?t.datum(n.data).append("path").attr("class","chrom-data").attr("chrom",e.data.chrom).attr("d",i):null},_get_path_function:function(t,e){if("string"==typeof e||!e.data||0===e.data.length)return null;var n=u.scale.linear().domain(this.data_bounds).range(this.radius_bounds).clamp(!0),i=u.scale.linear().domain([0,e.data.length]).range([t.startAngle,t.endAngle]),r=u.svg.line.radial().interpolate("linear").radius(function(t){return n(t[1])}).angle(function(t,e){return i(e)});return u.svg.area.radial().interpolate(r.interpolate()).innerRadius(n(0)).outerRadius(r.radius()).angle(r.angle())},render_labels:function(){var t=this,e=function(){return"rotate(90)"},n=this.drawTicks(this.parent_elt,[this.chroms_layout[0]],this._data_bounds_ticks_fn(),e,!0).classed("min_max",!0);c.each(n,function(e){i(e).click(function(){new m.default.ConfigSettingCollectionView({collection:t.track.get("config")}).render_in_modal("Configure Track")})})},_transition_labels:function(){if(0!==this.data_bounds.length){var t=this,e=c.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>.08}),n=c.filter(e,function(t,e){return e%3==0}),i=c.flatten(c.map(n,function(e){return t._data_bounds_ticks_fn()(e)}));this.parent_elt.selectAll("g.tick").data(i).transition().attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+t.radius+",0)"})}},_data_bounds_ticks_fn:function(){var t=this;return function(e){return[{radius:t.radius_bounds[0],angle:e.startAngle,label:t.formatNum(t.data_bounds[0])},{radius:t.radius_bounds[1],angle:e.startAngle,label:t.formatNum(t.data_bounds[1])}]}},get_data_bounds:function(t){}});c.extend(S.prototype,w);var T=S.extend({get_data_bounds:function(t){var e=c.flatten(c.map(t,function(t){return t?c.map(t.data,function(t){return parseInt(t[1],10)||0}):0}));return[c.min(e),this._quantile(e,.98)||c.max(e)]}}),A=M.extend({render:function(){var t=this;i.when(t.track.get("data_manager").data_is_ready()).then(function(){i.when(t.track.get("data_manager").get_genome_wide_data(t.genome)).then(function(e){var n=[],i=t.genome.get_chroms_info();c.each(e,function(e,r){var a=i[r].chrom,o=c.map(e.data,function(e){var n=t._get_region_angle(a,e[1]),i=t._get_region_angle(e[3],e[4]);return{source:{startAngle:n,endAngle:n+.01},target:{startAngle:i,endAngle:i+.01}}});n=n.concat(o)}),t.parent_elt.append("g").attr("class","chord").selectAll("path").data(n).enter().append("path").style("fill",t.get_fill_color()).attr("d",u.svg.chord().radius(t.radius_bounds[0])).style("opacity",1)})})},update_radius_bounds:function(t){this.radius_bounds=t,this.parent_elt.selectAll("path").transition().attr("d",u.svg.chord().radius(this.radius_bounds[0]))},_get_region_angle:function(t,e){var n=c.find(this.chroms_layout,function(e){return e.data.chrom===t});return n.endAngle-(n.endAngle-n.startAngle)*(n.data.len-e)/n.data.len}}),j=t.View.extend({initialize:function(){_.default.cssLoadFile("static/style/circster.css");var t=new f.default.Genome(window.galaxy_config.app.genome),e=new f.default.GenomeVisualization(window.galaxy_config.app.viz_config);e.get("config").add([{key:"arc_dataset_height",label:"Arc Dataset Height",type:"int",value:25,view:"circster"},{key:"track_gap",label:"Gap Between Tracks",type:"int",value:5,view:"circster"},{key:"total_gap",label:"Gap [0-1]",type:"float",value:.4,view:"circster",hidden:!0}]),new k({el:i("#center .unified-panel-body"),genome:t,model:e}).render(),i("#center .unified-panel-header-inner").append(window.galaxy_config.app.viz_config.title+" "+window.galaxy_config.app.viz_config.dbkey);var n=y.default.create_icon_buttons_menu([{icon_class:"plus-button",title:(0,s.default)("Add tracks"),on_click:function(){f.default.select_datasets({dbkey:e.get("dbkey")},function(t){e.add_tracks(t)})}},{icon_class:"gear",title:(0,s.default)("Settings"),on_click:function(){new m.default.ConfigSettingCollectionView({collection:e.get("config")}).render_in_modal("Configure Visualization")}},{icon_class:"disk--arrow",title:(0,s.default)("Save"),on_click:function(){Galaxy.modal.show({title:(0,s.default)("Saving..."),body:"progress"}),i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:e.get("vis_id"),title:e.get("title"),dbkey:e.get("dbkey"),type:"trackster",vis_json:JSON.stringify(e)}}).success(function(t){Galaxy.modal.hide(),e.set("vis_id",t.vis_id)}).error(function(){Galaxy.modal.show({title:(0,s.default)("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{icon_class:"cross-circle",title:(0,s.default)("Close"),on_click:function(){window.top.location=Galaxy.root+"visualizations/list"}}],{tooltip_config:{placement:"bottom"}});n.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(n.$el),i(".menu-button").tooltip({placement:"bottom"})}});e.default={GalaxyApp:j}}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}function o(){function t(e,n,i,r){var a=e.children,d=0,u=e.dist||l;return u=u>1?1:u,e.dist=u,e.y0=null!==r?r.y0+u*o:c,a?(a.forEach(function(r){r.parent=e,d+=t(r,n,i,e)}),e.x0=d/a.length):(e.x0=s*i,s+=1),e.x=e.x0,e.y=e.y0,e.x0}var e=this,n=d.layout.hierarchy().sort(null).value(null),i=360,r="Linear",a=18,o=200,s=0,l=.5,c=50;return e.leafHeight=function(t){return void 0===t?a:(a=t,e)},e.layoutMode=function(t){return void 0===t?r:(r=t,e)},e.layoutAngle=function(t){return void 0===t?i:isNaN(t)||t<0||t>360?e:(i=t,e)},e.separation=function(t){return void 0===t?o:(o=t,e)},e.links=function(t){return d.layout.tree().links(t)},e.nodes=function(o,l){"[object Array]"===toString.call(o)&&(o=o[0]);var c=n.call(e,o,l),d=[],u=0,h=0;return window._d=o,window._nodes=c,c.forEach(function(t){u=t.depth>u?t.depth:u,d.push(t)}),d.forEach(function(t){t.children||(h+=1,t.depth=u)}),a="Circular"===r?i/h:a,s=0,t(d[0],u,a,null),d},e}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=a(s),c=n(192),d=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(c),u=n(15),h=a(u),f=n(14),p=a(f),_=n(31),g=a(_),m=t.View.extend({className:"UserMenuBase",isAcceptableValue:function(t,e,n){var i=t.val(),r=t.attr("displayLabel")||t.attr("id").replace("phyloViz","");return function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(i)?i>n?(alert(r+" is too large."),!1):!(i<e)||(alert(r+" is too small."),!1):(alert(r+" is not a number!"),!1)},hasIllegalJsonCharacters:function(t){return-1!==t.val().search(/"|'|\\/)&&(alert("Named fields cannot contain these illegal characters: double quote(\"), single guote('), or back slash(\\). "),!0)}}),v=h.default.Visualization.extend({defaults:{layout:"Linear",separation:250,leafHeight:18,type:"phyloviz",title:(0,l.default)("Title"),scaleFactor:1,translate:[0,0],fontSize:12,selectedNode:null,nodeAttrChangedTime:0},initialize:function(t){this.set("dataset",new p.default.Dataset({id:t.dataset_id}))},root:{},toggle:function(t){void 0!==t&&(t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null))},toggleAll:function(t){t.children&&0!==t.children.length&&(t.children.forEach(this.toggleAll),toggle(t))},getData:function(){return this.root},save:function(){function t(e){delete e.parent,e._selected&&delete e._selected,e.children&&e.children.forEach(t),e._children&&e._children.forEach(t)}t(this.root);var e=i.extend(!0,{},this.attributes);return e.selectedNode=null,show_message("Saving to Galaxy","progress"),r.ajax({url:this.url(),type:"POST",dataType:"json",data:{config:JSON.stringify(e),type:"phyloviz"},success:function(t){hide_modal()}})}}),y=t.View.extend({defaults:{nodeRadius:4.5},stdInit:function(t){var e=this;e.model.on("change:separation change:leafHeight change:fontSize change:nodeAttrChangedTime",e.updateAndRender,e),e.vis=t.vis,e.i=0,e.maxDepth=-1,e.width=t.width,e.height=t.height},updateAndRender:function(t){var e=(d.select(".vis"),this);t=t||e.model.root,e.renderNodes(t),e.renderLinks(t),e.addTooltips()},renderLinks:function(t){var e=this,n=(e.diagonal,e.duration,e.layoutMode,e.vis.selectAll("g.completeLink").data(e.tree.links(e.nodes),function(t){return t.target.id})),i=function(t){t.pos0=t.source.y0+" "+t.source.x0,t.pos1=t.source.y0+" "+t.target.x0,t.pos2=t.target.y0+" "+t.target.x0};n.enter().insert("svg:g","g.node").attr("class","completeLink").append("svg:path").attr("class","link").attr("d",function(t){return i(t),"M "+t.pos0+" L "+t.pos1}),n.transition().duration(500).select("path.link").attr("d",function(t){return i(t),"M "+t.pos0+" L "+t.pos1+" L "+t.pos2});n.exit().remove()},selectNode:function(t){var e=this;d.selectAll("g.node").classed("selectedHighlight",function(e){return t.id===e.id&&(t._selected?(delete t._selected,!1):(t._selected=!0,!0))}),e.model.set("selectedNode",t),r("#phyloVizSelectedNodeName").val(t.name),r("#phyloVizSelectedNodeDist").val(t.dist),r("#phyloVizSelectedNodeAnnotation").val(t.annotation||"")},addTooltips:function(){r(".tooltip").remove(),r(".node").attr("data-original-title",function(){var t=this.__data__,e=t.annotation||"None";return t?(t.name?t.name+"<br/>":"")+"Dist: "+t.dist+" <br/>Annotation1: "+e+(t.bootstrap?"<br/>Confidence level: "+Math.round(100*t.bootstrap):""):""}).tooltip({placement:"top",trigger:"hover"})}}),b=y.extend({initialize:function(t){var e=this;e.margins=t.margins,e.layoutMode="Linear",e.stdInit(t),e.layout(),e.updateAndRender(e.model.root)},layout:function(){var t=this;t.tree=(new o).layoutMode("Linear"),t.diagonal=d.svg.diagonal().projection(function(t){return[t.y,t.x]})},renderNodes:function(t){var e=this,n=e.model.get("fontSize")+"px";e.tree.separation(e.model.get("separation")).leafHeight(e.model.get("leafHeight"));var i=e.tree.separation(e.model.get("separation")).nodes(e.model.root),r=e.vis.selectAll("g.node").data(i,function(t){return t.name+t.id||(t.id=++e.i)});e.nodes=i,e.duration=500;var a=r.enter().append("svg:g").attr("class","node").on("dblclick",function(){d.event.stopPropagation()}).on("click",function(t){if(d.event.altKey)e.selectNode(t);else{if(t.children&&0===t.children.length)return;e.model.toggle(t),e.updateAndRender(t)}});"[object Array]"===toString.call(t)&&(t=t[0]),a.attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}),a.append("svg:circle").attr("r",1e-6).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),a.append("svg:text").attr("class","nodeLabel").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).style("fill-opacity",1e-6);var o=r.transition().duration(500);o.attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),o.select("circle").attr("r",e.defaults.nodeRadius).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.select("text").style("fill-opacity",1).style("font-size",n).text(function(t){return t.name&&""!==t.name?t.name:t.bootstrap?Math.round(100*t.bootstrap):""});var s=r.exit().transition().duration(500).remove();s.select("circle").attr("r",1e-6),s.select("text").style("fill-opacity",1e-6),i.forEach(function(t){t.x0=t.x,t.y0=t.y})}}),w=t.View.extend({className:"phyloviz",initialize:function(t){var e=this;e.MIN_SCALE=.05,e.MAX_SCALE=5,e.MAX_DISPLACEMENT=500,e.margins=[10,60,10,80],e.width=r("#PhyloViz").width(),e.height=r("#PhyloViz").height(),e.radius=e.width,e.data=t.data,r(window).resize(function(){e.width=r("#PhyloViz").width(),e.height=r("#PhyloViz").height(),e.render()}),e.phyloTree=new v(t.config),e.phyloTree.root=e.data,e.zoomFunc=d.behavior.zoom().scaleExtent([e.MIN_SCALE,e.MAX_SCALE]),e.zoomFunc.translate(e.phyloTree.get("translate")),e.zoomFunc.scale(e.phyloTree.get("scaleFactor")),e.navMenu=new x(e),e.settingsMenu=new k({phyloTree:e.phyloTree}),e.nodeSelectionView=new M({phyloTree:e.phyloTree}),e.search=new C,setTimeout(function(){e.zoomAndPan()},1e3)},render:function(){var t=this;r("#PhyloViz").empty(),t.mainSVG=d.select("#PhyloViz").append("svg:svg").attr("width",t.width).attr("height",t.height).attr("pointer-events","all").call(t.zoomFunc.on("zoom",function(){t.zoomAndPan()})),t.boundingRect=t.mainSVG.append("svg:rect").attr("class","boundingRect").attr("width",t.width).attr("height",t.height).attr("stroke","black").attr("fill","white"),t.vis=t.mainSVG.append("svg:g").attr("class","vis"),t.layoutOptions={model:t.phyloTree,width:t.width,height:t.height,vis:t.vis,margins:t.margins},r("#title").text("Phylogenetic Tree from "+t.phyloTree.get("title")+":");new b(t.layoutOptions)},zoomAndPan:function(t){var e,n;void 0!==t&&(e=t.zoom,n=t.translate);var i=this,r=i.zoomFunc.scale(),a=i.zoomFunc.translate(),o="",s="";switch(e){case"reset":r=1,a=[0,0];break;case"+":r*=1.1;break;case"-":r*=.9;break;default:"number"==typeof e?r=e:null!==d.event&&(r=d.event.scale)}if(!(r<i.MIN_SCALE||r>i.MAX_SCALE)){if(i.zoomFunc.scale(r),o="translate("+i.margins[3]+","+i.margins[0]+") scale("+r+")",null!==d.event)s="translate("+d.event.translate+")";else{if(void 0!==n){var l=n.split(",")[0],c=n.split(",")[1];isNaN(l)||isNaN(c)||(a=[a[0]+parseFloat(l),a[1]+parseFloat(c)])}i.zoomFunc.translate(a),s="translate("+a+")"}i.phyloTree.set("scaleFactor",r),i.phyloTree.set("translate",a),i.vis.attr("transform",s+o)}},reloadViz:function(){var t=this,e=r("#phylovizNexSelector :selected").val();r.getJSON(t.phyloTree.get("dataset").url(),{tree_index:e,data_type:"raw_data"},function(e){t.data=e.data,t.config=e,t.render()})}}),x=t.View.extend({initialize:function(t){var e=this;e.phylovizView=t,r("#panelHeaderRightBtns").empty(),r("#phyloVizNavBtns").empty(),r("#phylovizNexSelector").off(),e.initNavBtns(),e.initRightHeaderBtns(),r("#phylovizNexSelector").off().on("change",function(){e.phylovizView.reloadViz()})},initRightHeaderBtns:function(){var t=this,e=g.default.create_icon_buttons_menu([{icon_class:"gear",title:(0,l.default)("PhyloViz Settings"),on_click:function(){r("#SettingsMenu").show(),t.settingsMenu.updateUI()}},{icon_class:"disk",title:(0,l.default)("Save visualization"),on_click:function(){var e=r("#phylovizNexSelector option:selected").text();e&&t.phylovizView.phyloTree.set("title",e),t.phylovizView.phyloTree.save()}},{icon_class:"chevron-expand",title:"Search / Edit Nodes",on_click:function(){r("#nodeSelectionView").show()}},{icon_class:"information",title:(0,l.default)("Phyloviz Help"),on_click:function(){window.open("https://galaxyproject.org/learn/visualization/phylogenetic-tree/")}}],{tooltip_config:{placement:"bottom"}});r("#panelHeaderRightBtns").append(e.$el)},initNavBtns:function(){var t=this,e=g.default.create_icon_buttons_menu([{icon_class:"zoom-in",title:(0,l.default)("Zoom in"),on_click:function(){t.phylovizView.zoomAndPan({zoom:"+"})}},{icon_class:"zoom-out",title:(0,l.default)("Zoom out"),on_click:function(){t.phylovizView.zoomAndPan({zoom:"-"})}},{icon_class:"arrow-circle",title:"Reset Zoom/Pan",on_click:function(){t.phylovizView.zoomAndPan({zoom:"reset"})}}],{tooltip_config:{placement:"bottom"}});r("#phyloVizNavBtns").append(e.$el)}}),k=m.extend({className:"Settings",initialize:function(t){var e=this;e.phyloTree=t.phyloTree,e.el=r("#SettingsMenu"),e.inputs={separation:r("#phyloVizTreeSeparation"),leafHeight:r("#phyloVizTreeLeafHeight"),fontSize:r("#phyloVizTreeFontSize")},r("#settingsCloseBtn").off().on("click",function(){e.el.hide()}),r("#phylovizResetSettingsBtn").off().on("click",function(){e.resetToDefaults()}),r("#phylovizApplySettingsBtn").off().on("click",function(){e.apply()})},apply:function(){var t=this;t.isAcceptableValue(t.inputs.separation,50,2500)&&t.isAcceptableValue(t.inputs.leafHeight,5,30)&&t.isAcceptableValue(t.inputs.fontSize,5,20)&&r.each(t.inputs,function(e,n){t.phyloTree.set(e,n.val())})},updateUI:function(){var t=this;r.each(t.inputs,function(e,n){n.val(t.phyloTree.get(e))})},resetToDefaults:function(){r(".tooltip").remove();var t=this;r.each(t.phyloTree.defaults,function(e,n){t.phyloTree.set(e,n)}),t.updateUI()},render:function(){}}),M=m.extend({className:"Settings",initialize:function(t){var e=this;e.el=r("#nodeSelectionView"),e.phyloTree=t.phyloTree,e.UI={enableEdit:r("#phylovizEditNodesCheck"),saveChanges:r("#phylovizNodeSaveChanges"),cancelChanges:r("#phylovizNodeCancelChanges"),name:r("#phyloVizSelectedNodeName"),dist:r("#phyloVizSelectedNodeDist"),annotation:r("#phyloVizSelectedNodeAnnotation")},e.valuesOfConcern={name:null,dist:null,annotation:null},r("#nodeSelCloseBtn").off().on("click",function(){e.el.hide()}),e.UI.saveChanges.off().on("click",function(){e.updateNodes()}),e.UI.cancelChanges.off().on("click",function(){e.cancelChanges()}),function(t){t.fn.enable=function(e){return t(this).each(function(){e?t(this).removeAttr("disabled"):t(this).attr("disabled","disabled")})}}(i),e.UI.enableEdit.off().on("click",function(){e.toggleUI()})},toggleUI:function(){var t=this,e=t.UI.enableEdit.is(":checked");e||t.cancelChanges(),r.each(t.valuesOfConcern,function(n,i){t.UI[n].enable(e)}),e?(t.UI.saveChanges.show(),t.UI.cancelChanges.show()):(t.UI.saveChanges.hide(),t.UI.cancelChanges.hide())},cancelChanges:function(){var t=this,e=t.phyloTree.get("selectedNode");e&&r.each(t.valuesOfConcern,function(n,i){t.UI[n].val(e[n])})},updateNodes:function(){var t=this,e=t.phyloTree.get("selectedNode");if(e){if(!t.isAcceptableValue(t.UI.dist,0,1)||t.hasIllegalJsonCharacters(t.UI.name)||t.hasIllegalJsonCharacters(t.UI.annotation))return;r.each(t.valuesOfConcern,function(n,i){e[n]=t.UI[n].val()}),t.phyloTree.set("nodeAttrChangedTime",new Date)}else alert("No node selected")}}),C=m.extend({initialize:function(){var t=this;r("#phyloVizSearchBtn").on("click",function(){var e=r("#phyloVizSearchTerm"),n=r("#phyloVizSearchCondition").val().split("-"),i=n[0],a=n[1];t.hasIllegalJsonCharacters(e),"dist"===i&&t.isAcceptableValue(e,0,1),t.searchTree(i,a,e.val())})},searchTree:function(t,e,n){d.selectAll("g.node").classed("searchHighlight",function(i){var r=i[t];if(void 0!==r&&null!==r)if("dist"===t)switch(e){case"greaterEqual":return r>=+n;case"lesserEqual":return r<=+n;default:return}else if("name"===t||"annotation"===t)return-1!==r.toLowerCase().indexOf(n.toLowerCase())})}});e.default={PhylovizView:w}}).call(e,n(2),n(0),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(1),c=r(l),d=n(192),u=r(d),h=n(18),f=(a(h),n(15)),p=a(f),_=n(62),g=a(_),m=n(54),v=a(m),y=n(14),b=a(y),w=n(33),x=a(w),k=n(31),M=a(k),C=t.Model.extend({defaults:{inputs:null,values:null}}),S=t.Model.extend({defaults:{tool:null,tree_data:null},initialize:function(t){var e=this;this.get("tool").get("inputs").each(function(t){t.on("change:min change:max change:num_samples",function(t){t.get("in_ptree")&&e.set_tree_data()},e),t.on("change:in_ptree",function(t){t.get("in_ptree")?e.add_param(t):e.remove_param(t),e.set_tree_data()},e)}),t.config&&c.each(t.config,function(t){var n=e.get("tool").get("inputs").find(function(e){return e.get("name")===t.name});e.add_param(n),n.set(t)})},add_param:function(t){t.get("ptree_index")||(t.set("in_ptree",!0),t.set("ptree_index",this.get_tree_params().length))},remove_param:function(t){t.set("in_ptree",!1),t.set("ptree_index",null),c(this.get_tree_params()).each(function(t,e){t.set("ptree_index",e+1)})},set_tree_data:function(){var t=c.map(this.get_tree_params(),function(t){return{param:t,samples:t.get_samples()}}),e=0;this.set("tree_data",{name:"Root",id:e++,children:0!==t.length?function t(n,i){var r=n[i],a=r.param,o=(a.get("label"),r.samples);return n.length-1===i?c.map(o,function(t){return{id:e++,name:t,param:a,value:t}}):c.map(o,function(r){return{id:e++,name:r,param:a,value:r,children:t(n,i+1)}})}(t,0):null})},get_tree_params:function(){return c(this.get("tool").get("inputs").where({in_ptree:!0})).sortBy(function(t){return t.get("ptree_index")})},get_num_leaves:function(){return this.get_tree_params().reduce(function(t,e){return t*e.get_samples().length},1)},get_node_settings:function(t){var e=this.get("tool").get_inputs_dict(),n=t.parent;if(n)for(;0!==n.depth;)e[n.param.get("name")]=n.value,n=n.parent;var i=this,r=function t(e,n){return e.param&&(n[e.param.get("name")]=e.value),e.children?c.flatten(c.map(e.children,function(e){return t(e,c.clone(n))})):new C({inputs:i.get("tool").get("inputs"),values:n})}(t,e);return c.isArray(r)||(r=[r]),r},get_connected_nodes:function(t){for(var e=[],n=t.parent;n;)e.push(n),n=n.parent;return c.flatten([e,function t(e){return e.children?c.flatten([e,c.map(e.children,function(e){return t(e)})]):e}(t)])},get_leaf:function(t){for(var e=this.get("tree_data");e.children;)e=function(e){return c.find(e,function(e){return t[e.param.get("name")]===e.value})}(e.children);return e},toJSON:function(){return this.get_tree_params().map(function(t){return{name:t.get("name"),min:t.get("min"),max:t.get("max"),num_samples:t.get("num_samples")}})}}),T=t.Model.extend({defaults:{track:null,mode:"Pack",settings:null,regions:null},initialize:function(t){if(this.set("regions",t.regions),t.track){var e=c.extend({data_url:Galaxy.root+"dummy1",converted_datasets_state_url:Galaxy.root+"dummy2"},t.track);this.set("track",g.default.object_from_template(e,{},null))}},same_settings:function(t){var e=this.get("settings"),n=t.get("settings");for(var i in e)if(!n[i]||e[i]!==n[i])return!1;return!0},toJSON:function(){return{track:this.get("track").to_dict(),settings:this.get("settings"),regions:this.get("regions")}}}),A=t.Collection.extend({model:T}),j=p.default.Visualization.extend({defaults:c.extend({},p.default.Visualization.prototype.defaults,{dataset:null,tool:null,parameter_tree:null,regions:null,tracks:null,default_mode:"Pack"}),initialize:function(t){this.set("dataset",new b.default.Dataset(t.dataset)),this.set("tool",new v.default.Tool(t.tool)),this.set("regions",new p.default.GenomeRegionCollection(t.regions)),this.set("tracks",new A(t.tracks));var e=this.get("tool");this.set("tool_with_samplable_inputs",e),e.remove_inputs(["data","hidden_data","conditional","text"]),this.set("parameter_tree",new S({tool:e,config:t.tree_config}))},add_track:function(t){this.get("tracks").add(t)},toJSON:function(){return{id:this.get("id"),title:"Parameter exploration for dataset '"+this.get("dataset").get("name")+"'",type:"sweepster",dataset_id:this.get("dataset").id,tool_id:this.get("tool").id,regions:this.get("regions").toJSON(),tree_config:this.get("parameter_tree").toJSON(),tracks:this.get("tracks").toJSON()}}}),E=t.View.extend({tagName:"tr",TILE_LEN:250,initialize:function(t){this.canvas_manager=t.canvas_manager,this.render(),this.model.on("change:track change:mode",this.draw_tiles,this)},render:function(){var t=this.model.get("settings"),e=t.get("values"),n=i("<td/>").addClass("settings").appendTo(this.$el),r=i("<div/>").addClass("track-info").hide().appendTo(n);r.append(i("<div/>").css("font-weight","bold").text("Track Settings")),t.get("inputs").each(function(t){r.append(t.get("label")+": "+e[t.get("name")]+"<br/>")});var a=this,o=(i("<button/>").appendTo(r).text("Run on complete dataset").click(function(){r.toggle(),a.trigger("run_on_dataset",t)}),M.default.create_icon_buttons_menu([{title:(0,s.default)("Settings"),icon_class:"gear track-settings",on_click:function(){r.toggle()}},{title:(0,s.default)("Remove"),icon_class:"cross-circle",on_click:function(){a.$el.remove(),i(".tooltip").remove()}}]));n.prepend(o.$el),this.model.get("regions").each(function(){a.$el.append(i("<td/>").addClass("tile").html(i("<img/>").attr("src",Galaxy.root+"images/loading_large_white_bg.gif")))}),this.model.get("track")&&this.draw_tiles()},draw_tiles:function(){var t=this,e=this.model.get("track"),n=this.model.get("regions"),r=this.$el.find("td.tile");e&&i.when(e.data_manager.data_is_ready()).then(function(a){n.each(function(n,a){var o=n.length()/t.TILE_LEN,s=1/o,l=t.model.get("mode");i.when(e.data_manager.get_data(n,l,o,{})).then(function(o){var c=t.canvas_manager.new_canvas();c.width=t.TILE_LEN,c.height=e.get_canvas_height(o,l,s,c.width),e.draw_tile(o,c.getContext("2d"),l,n,s),i(r[a]).empty().append(c)})})})}}),O=t.View.extend({number_input_template:'<div class="form-row-input sweep"><input class="min" type="text" size="6" value="<%= min %>"> - <input class="max" type="text" size="6" value="<%= max %>"> samples: <input class="num_samples" type="text" size="1" value="<%= num_samples %>"></div>',select_input_template:'<div class="form-row-input sweep"><%= options %></div>',initialize:function(t){this.$el=t.tool_row,this.render()},render:function(){var t=this.model,e=(t.get("type"),this.$el.find(".form-row-input")),n=null;if(e.find(":input").change(function(){t.set("value",i(this).val())}),t instanceof v.default.IntegerToolParameter)n=i(c.template(this.number_input_template)(this.model.toJSON()));else if(t instanceof v.default.SelectToolParameter){var r=c.map(this.$el.find("select option"),function(t){return i(t).val()}),a=r.join(", ");n=i(c.template(this.select_input_template)({options:a}))}n.insertAfter(e);var o=this,l=M.default.create_icon_buttons_menu([{title:(0,s.default)("Add parameter to tree"),icon_class:"plus-button",on_click:function(){t.set("in_ptree",!0),e.hide(),n.show(),i(this).hide(),o.$el.find(".icon-button.toggle").show()}},{title:(0,s.default)("Remove parameter from tree"),icon_class:"toggle",on_click:function(){t.set("in_ptree",!1),n.hide(),e.show(),i(this).hide(),o.$el.find(".icon-button.plus-button").show()}}],{});this.$el.prepend(l.$el),t.get("in_ptree")?(e.hide(),o.$el.find(".icon-button.plus-button").hide()):(o.$el.find(".icon-button.toggle").hide(),n.hide()),c.each(["min","max","num_samples"],function(e){n.find("."+e).change(function(){t.set(e,parseFloat(i(this).val()))})})}}),L=t.View.extend({className:"tree-design",initialize:function(t){this.render()},render:function(){var t=new v.default.ToolFormView({model:this.model.get("tool")});t.render(),this.$el.append(t.$el);var e=this,n=e.model.get("tool").get("inputs");this.$el.find(".form-row").not(".form-actions").each(function(t){new O({model:n.at(t),tool_row:i(this)})})}}),N=t.View.extend({className:"tool-parameter-tree",initialize:function(t){this.model.on("change:tree_data",this.render,this)},render:function(){this.$el.children().remove();var t=this.model.get_tree_params();if(t.length){this.width=100*(2+t.length),this.height=15*this.model.get_num_leaves();var e=this,n=u.layout.cluster().size([this.height,this.width-160]),r=u.svg.diagonal().projection(function(t){return[t.y,t.x]}),a=n.nodes(this.model.get("tree_data")),o=c.uniq(c.pluck(a,"y"));c.each(t,function(t,n){var r=o[n+1],a=i("#center").position().left;e.$el.append(i("<div>").addClass("label").text(t.get("label")).css("left",r+a))});var s=u.select(this.$el[0]).append("svg").attr("width",this.width).attr("height",this.height+30).append("g").attr("transform","translate(40, 20)"),l=(s.selectAll("path.link").data(n.links(a)).enter().append("path").attr("class","link").attr("d",r),s.selectAll("g.node").data(a).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.y+","+t.x+")"}).on("mouseover",function(t){var n=c.pluck(e.model.get_connected_nodes(t),"id");l.filter(function(t){return void 0!==c.find(n,function(e){return e===t.id})}).style("fill","#f00")}).on("mouseout",function(){l.style("fill","#000")}));l.append("circle").attr("r",9),l.append("text").attr("dx",function(t){return t.children?-12:12}).attr("dy",3).attr("text-anchor",function(t){return t.children?"end":"start"}).text(function(t){return t.name})}}}),I=t.View.extend({className:"Sweepster",helpText:"<div><h4>Getting Started</h4><ol><li>Create a parameter tree by using the icons next to the tool's parameter names to add or remove parameters.<li>Adjust the tree by using parameter inputs to select min, max, and number of samples<li>Run the tool with different settings by clicking on tree nodes</ol></div>",initialize:function(t){this.canvas_manager=new p.default.CanvasManager(this.$el.parents("body")),this.tool_param_tree_view=new N({model:this.model.get("parameter_tree")}),this.track_collection_container=i("<table/>").addClass("tracks"),this.model.get("parameter_tree").on("change:tree_data",this.handle_node_clicks,this);var e=this;this.model.get("tracks").each(function(t){t.get("track").view=e}),this.config=x.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"},{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"}],{})},render:function(){var t=new L({model:this.model.get("parameter_tree")});i("#left").append(t.$el);var e=this,n=e.model.get("regions"),r=i("<tr/>").appendTo(this.track_collection_container);n.each(function(t){r.append(i("<th>").text(t.toString()))}),r.children().first().attr("colspan",2);var a=i("<div>").addClass("tiles");i("#right").append(a.append(this.track_collection_container)),e.model.get("tracks").each(function(t){e.add_track(t)});var o=i(this.helpText).addClass("help"),l=M.default.create_icon_buttons_menu([{title:(0,s.default)("Close"),icon_class:"cross-circle",on_click:function(){i(".tooltip").remove(),o.remove()}}]);o.prepend(l.$el.css("float","right")),i("#center").append(o),this.tool_param_tree_view.render(),i("#center").append(this.tool_param_tree_view.$el),this.handle_node_clicks();var d=M.default.create_icon_buttons_menu([{icon_class:"chevron-expand",title:"Set display mode"},{icon_class:"cross-circle",title:(0,s.default)("Close"),on_click:function(){window.top.location=Galaxy.root+"visualizations/list"}}],{tooltip_config:{placement:"bottom"}}),u=["Squish","Pack"],h={};c.each(u,function(t){h[t]=function(){e.model.set("default_mode",t),e.model.get("tracks").each(function(e){e.set("mode",t)})}}),make_popupmenu(d.$el.find(".chevron-expand"),h),d.$el.attr("style","float: right"),i("#right .unified-panel-header-inner").append(d.$el)},get_base_color:function(t){return this.config.get_value(t.toLowerCase()+"_color")||this.config.get_value("n_color")},run_tool_on_dataset:function(t){var e=this.model.get("tool"),n=e.get("name"),r=this.model.get("dataset");e.set_input_values(t.get("values")),i.when(e.rerun(r)).then(function(t){}),show_modal("Running "+n+" on complete dataset",n+" is running on dataset '"+r.get("name")+"'. Outputs are in the dataset's history.",{Ok:function(){hide_modal()}})},add_track:function(t){var e=this,n=this.model.get("parameter_tree");e.model.add_track(t);var i=new E({model:t,canvas_manager:e.canvas_manager});return i.on("run_on_dataset",e.run_tool_on_dataset,e),e.track_collection_container.append(i.$el),i.$el.hover(function(){var i=n.get_leaf(t.get("settings").get("values")),r=c.pluck(n.get_connected_nodes(i),"id");u.select(e.tool_param_tree_view.$el[0]).selectAll("g.node").filter(function(t){return void 0!==c.find(r,function(e){return e===t.id})}).style("fill","#f00")},function(){u.select(e.tool_param_tree_view.$el[0]).selectAll("g.node").style("fill","#000")}),t},handle_node_clicks:function(){var t=this,e=this.model.get("parameter_tree"),n=this.model.get("regions");u.select(this.tool_param_tree_view.$el[0]).selectAll("g.node").on("click",function(r,a){var o=t.model.get("tool"),s=t.model.get("dataset"),l=e.get_node_settings(r),d=i.Deferred();l.length>=10?show_modal("Whoa there cowboy!","You clicked on a node to try "+t.model.get("tool").get("name")+" with "+l.length+" different combinations of settings. You can only run 10 jobs at a time.",{Ok:function(){hide_modal(),d.resolve(!1)}}):d.resolve(!0),i.when(d).then(function(e){if(e){var r=c.map(l,function(e){var i=new T({settings:e,regions:n,mode:t.model.get("default_mode")});return t.add_track(i),i});c.each(r,function(e,r){setTimeout(function(){o.set_input_values(e.get("settings").get("values")),i.when(o.rerun(s,n)).then(function(n){var i=n.first(),r=i.get("track_config");r.dataset=i,r.tool=null,r.prefs=t.config.to_key_value_dict();var a=g.default.object_from_template(r,t,null);a.init_for_tool_data(),e.set("track",a)})},1e4*r)})}})})}});e.default={SweepsterVisualization:j,SweepsterVisualizationView:I}}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(5),o=(r(a),n(20)),s=r(o),l=n(6),c=r(l),d=n(59),u=(r(d),n(730)),h=r(u),f=n(732),p=r(f),_=n(734),g=r(_),m=n(735),v=r(m),y=n(411),b=r(y),w=n(736),x=r(w),k=n(737),M=r(k),C=t.Router.extend({initialize:function(){this.routesHit=0,t.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"libraries","page/:show_page":"libraries_page","library/:library_id/permissions":"library_permissions","folders/:folder_id/permissions":"folder_permissions","folders/:id":"folder_content","folders/:id/page/:show_page":"folder_page","folders/:folder_id/datasets/:dataset_id":"dataset_detail","folders/:folder_id/datasets/:dataset_id/permissions":"dataset_permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id":"dataset_version","folders/:folder_id/download/:format":"download","folders/:folder_id/import/:source":"import_datasets"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},trackPageview:function(){var e=t.history.getFragment();/^\//.test(e)||""==e||(e="/"+e),"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"library/list"+e)}}),S=c.default.SessionStorageModel.extend({defaults:{with_deleted:!1,without_restricted:!1,sort_order:"asc",sort_by:"name",library_page_size:20,folder_page_size:15}}),T=t.View.extend({libraryToolbarView:null,libraryListView:null,library_router:null,libraryView:null,folderToolbarView:null,folderListView:null,datasetView:null,initialize:function(){window.Galaxy.config.ga_code&&(!function(t,e,n,i,r,a,o){t.GoogleAnalyticsObject=r,t[r]=t[r]||function(){(t[r].q=t[r].q||[]).push(arguments)},t[r].l=1*new Date,a=e.createElement(n),o=e.getElementsByTagName(n)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(a,o)}(window,document,"script",0,"ga"),ga("create",window.Galaxy.config.ga_code,"auto"),ga("send","pageview")),Galaxy.libraries=this,this.preferences=new S({id:"global-lib-prefs"}),this.library_router=new C,this.library_router.on("route:libraries",function(){Galaxy.libraries.libraryToolbarView&&Galaxy.libraries.libraryToolbarView.$el.unbind("click"),Galaxy.libraries.libraryToolbarView=new g.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new p.default.LibraryListView}),this.library_router.on("route:libraries_page",function(t){null===Galaxy.libraries.libraryToolbarView?(Galaxy.libraries.libraryToolbarView=new g.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new p.default.LibraryListView({show_page:t})):Galaxy.libraries.libraryListView.render({show_page:t})}),this.library_router.on("route:folder_content",function(t){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderToolbarView.$el.unbind("click"),Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:t}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:t})}),this.library_router.on("route:folder_page",function(t,e){null===Galaxy.libraries.folderToolbarView?(Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:t}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:t,show_page:e})):Galaxy.libraries.folderListView.render({id:t,show_page:parseInt(e)})}),this.library_router.on("route:download",function(t,e){0===i("#folder_list_body").find(":checked").length?(s.default.info("You must select at least one dataset to download"),Galaxy.libraries.library_router.navigate("folders/"+t,{trigger:!0,replace:!0})):(Galaxy.libraries.folderToolbarView.download(e),Galaxy.libraries.library_router.navigate("folders/"+t,{trigger:!1,replace:!0}))}),this.library_router.on("route:dataset_detail",function(t,e){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:e,show_version:!1,show_permissions:!1})}),this.library_router.on("route:dataset_version",function(t,e,n){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:e,ldda_id:n,show_version:!0})}),this.library_router.on("route:dataset_permissions",function(t,e){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new b.default.LibraryDatasetView({id:e,show_permissions:!0})}),this.library_router.on("route:library_permissions",function(t){Galaxy.libraries.libraryView&&Galaxy.libraries.libraryView.$el.unbind("click"),Galaxy.libraries.libraryView=new x.default.LibraryView({id:t,show_permissions:!0})}),this.library_router.on("route:folder_permissions",function(t){Galaxy.libraries.folderView&&Galaxy.libraries.folderView.$el.unbind("click"),Galaxy.libraries.folderView=new M.default.FolderView({id:t,show_permissions:!0})}),this.library_router.on("route:import_datasets",function(t,e){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderListView?Galaxy.libraries.folderToolbarView.showImportModal({source:e}):(Galaxy.libraries.folderToolbarView=new v.default.FolderToolbarView({id:t}),Galaxy.libraries.folderListView=new h.default.FolderListView({id:t}),Galaxy.libraries.folderToolbarView.showImportModal({source:e}))}),t.history.start({pushState:!1})}});e.default={GalaxyApp:T}}).call(e,n(2),n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e){return function(n,i){return n.get("type")===i.get("type")?n.has(t)||i.has(t)?n.has(t)?i.has(t)?n.get(t).toLowerCase()>i.get(t).toLowerCase()?"asc"===e?1:-1:i.get(t).toLowerCase()>n.get(t).toLowerCase()?"asc"===e?-1:1:0:-1:1:0:"folder"===n.get("type")?-1:1}},r=function(t,e){return function(n,i){return n.get(t).toLowerCase()>i.get(t).toLowerCase()?"asc"===e?1:-1:i.get(t).toLowerCase()>n.get(t).toLowerCase()?"asc"===e?-1:1:0}};e.default={generateFolderComparator:i,generateLibraryComparator:r}},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),s=a(o),l=n(59),c=a(l),d=n(731),u=a(d),h=t.View.extend({el:"#folder_items_element",progress:0,progressStep:1,folderContainer:null,current_sort_order:"asc",current_sort_key:"name",events:{"click #select-all-checkboxes":"selectAll","click .dataset_row":"selectClickedRow","click .folder_row":"selectClickedRow","click .sort-folder-name":"sortColumnClicked","click .sort-folder-file_ext":"sortColumnClicked","click .sort-folder-description":"sortColumnClicked","click .sort-folder-state":"sortColumnClicked"},collection:null,defaults:{include_deleted:!1,page_count:null,show_page:null},initialize:function(t){this.options=i.defaults(this.options||{},this.defaults,t),this.modal=null,this.rowViews={},this.collection=new c.default.Folder,this.listenTo(this.collection,"add",this.renderOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"sort",this.rePaint),this.listenTo(this.collection,"reset",this.rePaint),this.fetchFolder()},fetchFolder:function(t){var t=t||{};this.options.include_deleted=t.include_deleted;var e=this;this.folderContainer=new c.default.FolderContainer({id:this.options.id}),this.folderContainer.url=this.folderContainer.attributes.urlRoot+this.options.id+"/contents",this.options.include_deleted&&(this.folderContainer.url=this.folderContainer.url+"?include_deleted=true"),this.folderContainer.fetch({success:function(t){e.folder_container=t,e.render()},error:function(t,e){void 0!==e.responseJSON?s.default.error(e.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},render:function(t){this.options=i.extend(this.options,t);var e=this.templateFolder();r(".tooltip").hide();var n,a=this.folderContainer.attributes.metadata.full_path;if(n=1===a.length?0:a[a.length-2][0],this.$el.html(e({path:this.folderContainer.attributes.metadata.full_path,parent_library_id:this.folderContainer.attributes.metadata.parent_library_id,id:this.options.id,upper_folder_id:n,order:this.current_sort_order})),this.options.dataset_id){var o=i.findWhere(self.rowViews,{id:this.options.dataset_id});o?o.showDatasetDetails():s.default.error("Requested dataset not found. Showing folder instead.")}else(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.paginate();r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),r("#center").css("overflow","auto")},paginate:function(t){this.options=i.extend(this.options,t),(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_items_count=this.folder_container.get("folder").models.length,this.options.page_count=Math.ceil(this.options.total_items_count/Galaxy.libraries.preferences.get("folder_page_size"));var e=Galaxy.libraries.preferences.get("folder_page_size")*(this.options.show_page-1),n=null;n=this.folder_container.get("folder").models.slice(e,e+Galaxy.libraries.preferences.get("folder_page_size")),this.options.items_shown=n.length,Galaxy.libraries.preferences.get("folder_page_size")*this.options.show_page>this.options.total_items_count+Galaxy.libraries.preferences.get("folder_page_size")&&(n=[]),Galaxy.libraries.folderToolbarView.renderPaginator(this.options),this.collection.reset(n)},rePaint:function(t){this.options=i.extend(this.options,t),this.removeAllRows(),this.renderAll(),this.checkEmptiness()},addAll:function(t){i.each(t,function(t){Galaxy.libraries.folderListView.collection.add(t,{current_sort_order:!1})}),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),this.checkEmptiness(),this.postRender()},postRender:function(){var t=this.folderContainer.attributes.metadata;t.contains_file_or_folder=void 0!==this.collection.findWhere({type:"file"})||void 0!==this.collection.findWhere({type:"folder"}),Galaxy.libraries.folderToolbarView.configureElements(t)},renderAll:function(){var t=this;i.each(this.collection.models.reverse(),function(e){t.renderOne(e)}),this.postRender()},renderOne:function(t){this.options.contains_file_or_folder=!0,t.set("folder_id",this.id);var e=new u.default.FolderRowView({model:t});this.rowViews[t.get("id")]=e,this.$el.find("#first_folder_item").after(e.el)},removeOne:function(t){this.$el.find("tr").filter(function(){return r(this).data("id")&&r(this).data("id")===t.id}).remove()},removeAllRows:function(){r(".library-row").remove()},checkEmptiness:function(){0===this.$el.find(".dataset_row").length&&0===this.$el.find(".folder_row").length?this.$el.find(".empty-folder-message").show():this.$el.find(".empty-folder-message").hide()},sortColumnClicked:function(t){t.preventDefault(),this.current_sort_order="asc"===this.current_sort_order?"desc":"asc",this.current_sort_key=t.currentTarget.className.replace("sort-folder-",""),this.collection.sortFolder(this.current_sort_key,this.current_sort_order),this.renderSortIcon()},selectAll:function(t){var e=t.target.checked,n=this;r(":checkbox","#folder_list_body").each(function(){this.checked=e;var t=r(this).closest("tr");e?n.makeDarkRow(t):n.makeWhiteRow(t)})},selectClickedRow:function(t){var e,n,i="";e=r(t.target).closest("tr"),"input"===t.target.localName?(i=t.target,n="input"):"td"===t.target.localName&&(i=e.find(":checkbox")[0],n="td"),i.checked?"td"===n?(i.checked="",this.makeWhiteRow(e)):"input"===n&&this.makeDarkRow(e):"td"===n?(i.checked="selected",this.makeDarkRow(e)):"input"===n&&this.makeWhiteRow(e)},makeDarkRow:function(t){t.removeClass("light").addClass("dark"),t.find("a").removeClass("light").addClass("dark"),t.find(".fa-file-o").removeClass("fa-file-o").addClass("fa-file"),t.find(".fa-folder-o").removeClass("fa-folder-o").addClass("fa-folder")},makeWhiteRow:function(t){t.removeClass("dark").addClass("light"),t.find("a").removeClass("dark").addClass("light"),t.find(".fa-file").removeClass("fa-file").addClass("fa-file-o"),t.find(".fa-folder").removeClass("fa-folder").addClass("fa-folder-o")},renderSortIcon:function(){"asc"===this.current_sort_order?(r('[class*="sort-icon"]').removeClass("fa-sort-alpha-desc").removeClass("fa-sort-alpha-asc"),r(".sort-icon-"+this.current_sort_key).addClass("fa-sort-alpha-asc")):r(".sort-icon-"+this.current_sort_key).addClass("fa-sort-alpha-desc")},templateFolder:function(){return i.template(['<ol class="breadcrumb">','<li class="breadcrumb-item"><a title="Return to the list of libraries" href="#">Libraries</a></li>',"<% _.each(path, function(path_item) { %>","<% if (path_item[0] != id) { %>",'<li class="breadcrumb-item"><a title="Return to this folder" href="#/folders/<%- path_item[0] %>"><%- path_item[1] %></a> </li> ',"<% } else { %>",'<li class="breadcrumb-item active"><span title="You are in this folder"><%- path_item[1] %></span></li>',"<% } %>","<% }); %>","</ol>",'<table data-library-id="<%- parent_library_id  %>" class="grid table table-sm">',"<thead>",'<th class="button_heading"></th>','<th class="mid" style="width: 20px; " title="Check to select all datasets"><input id="select-all-checkboxes" style="margin: 0;" type="checkbox"></th>','<th><a class="sort-folder-name" title="Click to reverse order" href="#">name</a> <span title="Sorted alphabetically" class="sort-icon-name fa fa-sort-alpha-<%- order %>"></span></th>','<th style="width:20%;"><a class="sort-folder-description" title="Click to reverse order" href="#">description</a> <span title="Sorted alphabetically" class="sort-icon-description fa"></span></th>','<th style="width:5%;"><a class="sort-folder-file_ext" title="Click to reverse order" href="#">data type</a> <span title="Sorted alphabetically" class="sort-icon-file_ext fa"></span></th>','<th style="width:10%;">size</th>','<th style="width:160px;">time updated (UTC)</th>','<th style="width:5%;"><a class="sort-folder-state" title="Click to reverse order" href="#">state</a> <span title="Sorted alphabetically" class="sort-icon-state fa"></span></th>','<th style="width:150px;"></th> ',"</thead>",'<tbody id="folder_list_body">','<tr id="first_folder_item">',"<td>",'<a href="#<% if (upper_folder_id !== 0){ print("folders/" + upper_folder_id)} %>" title="Go to parent folder" class="btn_open_folder btn btn-secondary btn-sm">..<a>',"</td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","<td></td>","</tr>","</tbody>","</table>",'<div class="empty-folder-message" style="display:none;">',"This folder is either empty or you do not have proper access permissions to see the contents. If you expected something to show up",' please consult the <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>"].join(""))}});e.default={FolderListView:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),s=a(o),l=n(59),c=a(l),d=n(411),u=a(d),h=t.View.extend({events:{"click .undelete_dataset_btn":"undeleteDataset","click .undelete_folder_btn":"undeleteFolder","click .edit_folder_btn":"startModifications","click .cancel_folder_btn":"cancelModifications","click .save_folder_btn":"saveModifications"},defaults:{type:null,visibility_config:{edit_folder_btn:!1,save_folder_btn:!1,cancel_folder_btn:!1,permission_folder_btn:!1},edit_mode:!1},initialize:function(t){this.options=i.defaults(t||{},this.defaults),this.render(this.options)},render:function(t){this.options=i.extend(this.options,t);var e=this.options.model,n=null;return"folder"===e.get("type")||"LibraryFolder"===e.get("model_class")?(this.options.type="folder",this.prepareButtons(e),n=e.get("deleted")?this.templateRowDeletedFolder():this.templateRowFolder()):"file"===e.get("type")||"LibraryDatasetDatasetAssociation"===e.get("model_class")||"LibraryDataset"===e.get("model_class")?(this.options.type="file",n=e.get("deleted")?this.templateRowDeletedFile():this.templateRowFile()):(Galaxy.emit.error("Unknown library item type found."),Galaxy.emit.error(e.get("type")||e.get("model_class"))),this.setElement(n({content_item:e,edit_mode:this.options.edit_mode,button_config:this.options.visibility_config})),this.$el.show(),this},prepareButtons:function(t){var e=this.options.visibility_config;!1===this.options.edit_mode?(e.save_folder_btn=!1,e.cancel_folder_btn=!1,!0===t.get("deleted")?(e.edit_folder_btn=!1,e.permission_folder_btn=!1):!1===t.get("deleted")&&(e.save_folder_btn=!1,e.cancel_folder_btn=!1,!0===t.get("can_modify")&&(e.edit_folder_btn=!0),!0===t.get("can_manage")&&(e.permission_folder_btn=!0))):!0===this.options.edit_mode&&(e.edit_folder_btn=!1,e.permission_folder_btn=!1,e.save_folder_btn=!0,e.cancel_folder_btn=!0),this.options.visibility_config=e},showDatasetDetails:function(){Galaxy.libraries.datasetView=new u.default.LibraryDatasetView({id:this.id})},undeleteDataset:function(t){r(".tooltip").hide();var e=this,n=r(t.target).closest("tr").data("id"),i=Galaxy.libraries.folderListView.collection.get(n);i.url=i.urlRoot+i.id+"?undelete=true",i.destroy({success:function(t,i){Galaxy.libraries.folderListView.collection.remove(n);var r=new c.default.Item(i);Galaxy.libraries.folderListView.collection.add(r),Galaxy.libraries.folderListView.collection.sortFolder("name","asc"),s.default.success("Dataset undeleted. Click this to see it.","",{onclick:function(){var t=e.model.get("folder_id");window.location=Galaxy.root+"library/list#folders/"+t+"/datasets/"+e.id}})},error:function(t,e){void 0!==e.responseJSON?s.default.error("Dataset was not undeleted. "+e.responseJSON.err_msg):s.default.error("An error occured! Dataset was not undeleted. Please try again.")}})},undeleteFolder:function(t){r(".tooltip").hide();var e=r(t.target).closest("tr").data("id"),n=Galaxy.libraries.folderListView.collection.get(e);n.url=n.urlRoot+n.id+"?undelete=true",n.destroy({success:function(t,n){Galaxy.libraries.folderListView.collection.remove(e);var i=new c.default.FolderAsModel(n);Galaxy.libraries.folderListView.collection.add(i),Galaxy.libraries.folderListView.collection.sortFolder("name","asc"),s.default.success("Folder undeleted.")},error:function(t,e){void 0!==e.responseJSON?s.default.error("Folder was not undeleted. "+e.responseJSON.err_msg):s.default.error("An error occured! Folder was not undeleted. Please try again.")}})},startModifications:function(){this.options.edit_mode=!0,this.repaint()},cancelModifications:function(){this.options.edit_mode=!1,this.repaint()},saveModifications:function(){var t=Galaxy.libraries.folderListView.collection.get(this.$el.data("id")),e=!1,n=this.$el.find(".input_folder_name").val();if(void 0!==n&&n!==t.get("name")){if(!(n.length>2))return void s.default.warning("Folder name has to be at least 3 characters long.");t.set("name",n),e=!0}var i=this.$el.find(".input_folder_description").val();if(void 0!==i&&i!==t.get("description")&&(t.set("description",i),e=!0),e){var r=this;t.save(null,{patch:!0,success:function(t){r.options.edit_mode=!1,r.repaint(t),s.default.success("Changes to folder saved.")},error:function(t,e){void 0!==e.responseJSON?s.default.error(e.responseJSON.err_msg):s.default.error("An error occured while attempting to update the folder.")}})}else this.options.edit_mode=!1,this.repaint(t),s.default.info("Nothing has changed.")},repaint:function(){r(".tooltip").hide();var t=this.$el;this.render(),t.replaceWith(this.$el),this.$el.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},templateRowFolder:function(){return i.template(['<tr class="folder_row light library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Folder" class="fa fa-folder-o"/>',"</td>",'<td class="mid"><input style="margin: 0;" type="checkbox"></td>',"<% if(!edit_mode) { %>","<td>",'<a href="#folders/<%- content_item.id %>"><%- content_item.get("name") %></a>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_folder_name" placeholder="name" ><%- content_item.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_folder_description" placeholder="description" ><%- content_item.get("description") %></textarea></td>',"<% } %>","<td>folder</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>","<% if(edit_mode) { %>",'<button data-toggle="tooltip" data-placement="top" title="Save changes" class="primary-button btn-sm save_folder_btn" type="button" style="<% if(button_config.save_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-floppy-o"/> Save',"</button>",'<button data-toggle="tooltip" data-placement="top" title="Discard changes" class="primary-button btn-sm cancel_folder_btn" type="button" style="<% if(button_config.cancel_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-times"/> Cancel',"</button>","<% } else if (!edit_mode){%>",'<button data-toggle="tooltip" data-placement="top" title="Modify \'<%- content_item.get("name") %>\'" class="primary-button btn-sm edit_folder_btn" type="button" style="<% if(button_config.edit_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-pencil"/> Edit',"</button>",'<a href="#/folders/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-sm permission_folder_btn" title="Permissions of \'<%- content_item.get("name") %>\'" style="<% if(button_config.permission_folder_btn === false) { print("display:none;") } %>">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowFile:function(){return i.template(['<tr class="dataset_row light library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Dataset" class="fa fa-file-o"/>',"</td>",'<td class="mid">','<input style="margin: 0;" type="checkbox">',"</td>","<td>",'<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>" class="library-dataset">','<%- content_item.get("name") %>',"<a>","</td>",'<td><%- content_item.get("message") %></td>','<td><%= _.escape(content_item.get("file_ext")) %></td>','<td><%= _.escape(content_item.get("file_size")) %></td>','<td><%= _.escape(content_item.get("update_time")) %></td>',"<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<% if (content_item.get("is_unrestricted")) { %>','<span data-toggle="tooltip" data-placement="top" title="Unrestricted dataset" style="color:grey;" class="fa fa-globe"/>',"<% } %>",'<% if (content_item.get("is_private")) { %>','<span data-toggle="tooltip" data-placement="top" title="Private dataset" style="color:grey;" class="fa fa-key"/>',"<% } %>",'<% if ((content_item.get("is_unrestricted") === false) && (content_item.get("is_private") === false)) { %>','<span data-toggle="tooltip" data-placement="top" title="Restricted dataset" style="color:grey;" class="fa fa-shield"/>',"<% } %>",'<% if (content_item.get("can_manage")) { %>','<a href="#folders/<%- content_item.get("folder_id") %>/datasets/<%- content_item.id %>/permissions">','<button data-toggle="tooltip" data-placement="top" class="primary-button btn-sm permissions-dataset-btn" title="Permissions of \'<%- content_item.get("name") %>\'">','<span class="fa fa-group"/> Manage',"</button>","</a>","<% } %>","</td>","</tr>"].join(""))},templateRowDeletedFile:function(){return i.template(['<tr class="active deleted_dataset library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Dataset" class="fa fa-file-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("message") %>',"</td>","<td>",'<%= _.escape(content_item.get("file_ext")) %>',"</td>","<td>",'<%= _.escape(content_item.get("file_size")) %>',"</td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td>",'<% if ( content_item.get("state") !== "ok" ) { %>','<%= _.escape(content_item.get("state")) %>',"<% } %>","</td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-sm undelete_dataset_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))},templateRowDeletedFolder:function(){return i.template(['<tr class="active deleted_folder light library-row" data-id="<%- content_item.id %>">','<td class="mid">','<span title="Folder" class="fa fa-folder-o"/>',"</td>","<td></td>",'<td style="color:grey;">','<%- content_item.get("name") %>',"</td>","<td>",'<%- content_item.get("description") %>',"</td>","<td>","folder","</td>","<td></td>","<td>",'<%= _.escape(content_item.get("update_time")) %>',"</td>","<td></td>","<td>",'<span data-toggle="tooltip" data-placement="top" title="Marked deleted" style="color:grey;" class="fa fa-ban"/>','<button data-toggle="tooltip" data-placement="top" title="Undelete \'<%- content_item.get("name") %>\'" class="primary-button btn-sm undelete_folder_btn" type="button" style="margin-left:1em;">','<span class="fa fa-unlock"/> Undelete',"</button>","</td>","</tr>"].join(""))}});e.default={FolderRowView:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(20),o=r(a),s=n(59),l=r(s),c=n(733),d=r(c),u=n(1),h=r(u),f=t.View.extend({el:"#libraries_element",events:{"click .sort-libraries-link":"sort_clicked"},defaults:{page_count:null,show_page:null,all_fetched:!1},initialize:function(t){this.options=h.default.defaults(this.options||{},t,this.defaults);var e=this;this.modal=null,this.collection=new l.default.Libraries,this.collection.url=this.collection.urlRoot+"?deleted=false",this.collection.fetch({success:function(){e.render()},error:function(t,e){void 0!==e.responseJSON?o.default.error(e.responseJSON.err_msg):o.default.error("An error occurred.")}})},render:function(t){this.options=h.default.extend(this.options,t),this.setElement("#libraries_element");var e=this.templateLibraryList(),n=null,r=null,a=function(t){return!0===t.get("public")};if(i(".tooltip").hide(),void 0!==t&&(r=void 0!==t.models?t.models:null),null!==this.collection&&null===r)this.sortLibraries(),n=Galaxy.libraries.preferences.get("with_deleted")?this.collection.models:this.collection.where({deleted:!1}),Galaxy.libraries.preferences.get("without_restricted")&&(n=h.default.filter(n,a));else if(null!==r){if(Galaxy.libraries.preferences.get("with_deleted"))n=r;else{var o=function(t){return!1===t.get("deleted")};n=h.default.filter(r,o)}Galaxy.libraries.preferences.get("without_restricted")&&(n=h.default.filter(n,a))}else n=[];(null===this.options.show_page||this.options.show_page<1)&&(this.options.show_page=1),this.options.total_libraries_count=n.length;var s=Galaxy.libraries.preferences.get("library_page_size")*(this.options.show_page-1);this.options.page_count=Math.ceil(this.options.total_libraries_count/Galaxy.libraries.preferences.get("library_page_size")),this.options.total_libraries_count>0&&s<this.options.total_libraries_count?(n=n.slice(s,s+Galaxy.libraries.preferences.get("library_page_size")),this.options.libraries_shown=n.length,Galaxy.libraries.preferences.get("library_page_size")*this.options.show_page>this.options.total_libraries_count+Galaxy.libraries.preferences.get("library_page_size")&&(n=[]),this.$el.html(e({length:1,order:Galaxy.libraries.preferences.get("sort_order"),search_term:Galaxy.libraries.libraryToolbarView.options.search_term})),Galaxy.libraries.libraryToolbarView.renderPaginator(this.options),this.renderRows(n)):(this.$el.html(e({length:0,order:Galaxy.libraries.preferences.get("sort_order"),search_term:Galaxy.libraries.libraryToolbarView.options.search_term})),Galaxy.libraries.libraryToolbarView.renderPaginator(this.options)),i('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),i("#center").css("overflow","auto")},fetchDeleted:function(){if(this.options.all_fetched)this.render();else{var t=this;this.collection.url=this.collection.urlRoot+"?deleted=true",this.collection.fetch({remove:!1,success:function(){t.options.all_fetched=!0,t.render()},error:function(t,e){void 0!==e.responseJSON?o.default.error(e.responseJSON.err_msg):o.default.error("An error occurred.")}})}},renderRows:function(t){for(var e=0;e<t.length;e++){var n=t[e];this.renderOne({library:n})}},renderOne:function(t){var e=t.library,n=new d.default.LibraryRowView(e);this.$el.find("#library_list_body").append(n.el)},sort_clicked:function(){"asc"===Galaxy.libraries.preferences.get("sort_order")?Galaxy.libraries.preferences.set({sort_order:"desc"}):Galaxy.libraries.preferences.set({sort_order:"asc"}),this.render()},sortLibraries:function(){"name"===Galaxy.libraries.preferences.get("sort_by")&&("asc"===Galaxy.libraries.preferences.get("sort_order")?this.collection.sortLibraries("name","asc"):"desc"===Galaxy.libraries.preferences.get("sort_order")&&this.collection.sortLibraries("name","desc"))},searchLibraries:function(t){if(""!==i.trim(t)){var e=null;e=this.collection.search(t),this.options.searching=!0,this.render({models:e,show_page:1})}else this.options.searching=!1,this.render()},templateLibraryList:function(){return h.default.template(['<div class="library_container table-responsive">',"<% if(length === 0) { %>","<% if(search_term.length > 0) { %>","<div>","There are no libraries matching your search. Try different keyword.","</div>","<% } else{ %>","<div>","There are no libraries visible to you here. If you expected some to show up please consult the",' <a href="https://galaxyproject.org/data-libraries/#permissions" target="_blank">library security wikipage</a>',' or visit the <a href="https://biostar.usegalaxy.org/" target="_blank">Galaxy support site</a>.',"</div>","<% }%>","<% } else{ %>",'<table class="grid table table-sm">',"<thead>",'<th style="width:30%;">','<a class="sort-libraries-link" title="Click to reverse order" href="#">',"name","</a>",'<span title="Sorted alphabetically" class="fa fa-sort-alpha-<%- order %>"/>',"</th>",'<th style="width:22%;">description</th>','<th style="width:22%;">synopsis</th> ','<th style="width:26%;"></th>',"</thead>",'<tbody id="library_list_body">',"</tbody>","</table>","<% }%>","</div>"].join(""))}});e.default={LibraryListView:f}}).call(e,n(2),n(0))},function(t,e,n){"use strict";(function(t,i,r){Object.defineProperty(e,"__esModule",{value:!0});var a=n(20),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=t.View.extend({events:{"click .edit_library_btn":"edit_button_clicked","click .cancel_library_btn":"cancel_library_modification","click .save_library_btn":"save_library_modification","click .delete_library_btn":"delete_library","click .undelete_library_btn":"undelete_library"},edit_mode:!1,element_visibility_config:{upload_library_btn:!1,edit_library_btn:!1,permission_library_btn:!1,save_library_btn:!1,cancel_library_btn:!1,delete_library_btn:!1,undelete_library_btn:!1},initialize:function(t){this.render(t)},render:function(t){void 0===t&&(t=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),console.log(t)),this.prepareButtons(t);var e=this.templateRow();return this.setElement(e({library:t,button_config:this.element_visibility_config,edit_mode:this.edit_mode})),this.$el.show(),this},repaint:function(t){this.$el.find('[data-toggle="tooltip"]').tooltip("dispose");var e=this.$el;this.render(),e.replaceWith(this.$el),this.$el.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},prepareButtons:function(t){var e=this.element_visibility_config;!1===this.edit_mode?(e.save_library_btn=!1,e.cancel_library_btn=!1,e.delete_library_btn=!1,!0===t.get("deleted")?(e.undelete_library_btn=!0,e.upload_library_btn=!1,e.edit_library_btn=!1,e.permission_library_btn=!1):!1===t.get("deleted")&&(e.save_library_btn=!1,e.cancel_library_btn=!1,e.undelete_library_btn=!1,!0===t.get("can_user_add")&&(e.upload_library_btn=!0),!0===t.get("can_user_modify")&&(e.edit_library_btn=!0),!0===t.get("can_user_manage")&&(e.permission_library_btn=!0))):!0===this.edit_mode&&(e.upload_library_btn=!1,e.edit_library_btn=!1,e.permission_library_btn=!1,e.save_library_btn=!0,e.cancel_library_btn=!0,e.delete_library_btn=!0,e.undelete_library_btn=!1),this.element_visibility_config=e},edit_button_clicked:function(){this.edit_mode=!0,this.repaint()},cancel_library_modification:function(){this.edit_mode=!1,this.repaint()},save_library_modification:function(){var t=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),e=!1,n=this.$el.find(".input_library_name").val();if(void 0!==n&&n!==t.get("name")){if(!(n.length>2))return void o.default.warning("Library name has to be at least 3 characters long.");t.set("name",n),e=!0}var i=this.$el.find(".input_library_description").val();void 0!==i&&i!==t.get("description")&&(t.set("description",i),e=!0);var r=this.$el.find(".input_library_synopsis").val();if(void 0!==r&&r!==t.get("synopsis")&&(t.set("synopsis",r),e=!0),e){var a=this;t.save(null,{patch:!0,success:function(t){a.edit_mode=!1,a.repaint(t),o.default.success("Changes to library saved.")},error:function(t,e){void 0!==e.responseJSON?o.default.error(e.responseJSON.err_msg):o.default.error("An error occured while attempting to update the library.")}})}else this.edit_mode=!1,this.repaint(t),o.default.info("Nothing has changed.")},delete_library:function(){var t=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),e=this;t.destroy({success:function(t){t.set("deleted",!0),Galaxy.libraries.libraryListView.collection.add(t),e.edit_mode=!1,!1===Galaxy.libraries.preferences.get("with_deleted")?(i(".tooltip").hide(),e.repaint(t),e.$el.remove()):!0===Galaxy.libraries.preferences.get("with_deleted")&&e.repaint(t),o.default.success("Library has been marked deleted.")},error:function(t,e){void 0!==e.responseJSON?o.default.error(e.responseJSON.err_msg):o.default.error("An error occured during deleting the library.")}})},undelete_library:function(){var t=Galaxy.libraries.libraryListView.collection.get(this.$el.data("id")),e=this;t.url=t.urlRoot+t.id+"?undelete=true",t.destroy({success:function(t){t.set("deleted",!1),Galaxy.libraries.libraryListView.collection.add(t),e.edit_mode=!1,e.repaint(t),o.default.success("Library has been undeleted.")},error:function(t,e){void 0!==e.responseJSON?o.default.error(e.responseJSON.err_msg):o.default.error("An error occured while undeleting the library.")}})},templateRow:function(){return r.template(['<tr class="<% if(library.get("deleted") === true) { print("active") } %>" style="display:none;" data-id="<%- library.get("id") %>">',"<% if(!edit_mode) { %>",'<% if(library.get("deleted")) { %>','<td style="color:grey;"><%- library.get("name") %></td>',"<% } else { %>",'<td><a href="#folders/<%- library.get("root_folder_id") %>"><%- library.get("name") %></a></td>',"<% } %>",'<% if(library.get("description")) { %>','<% if( (library.get("description")).length> 80 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("description")) %>"><%= _.escape(library.get("description")).substring(0, 80) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("description"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>",'<% if(library.get("synopsis")) { %>','<% if( (library.get("synopsis")).length> 120 ) { %>','<td data-toggle="tooltip" data-placement="bottom" title="<%= _.escape(library.get("synopsis")) %>"><%= _.escape(library.get("synopsis")).substring(0, 120) + "..." %></td>',"<% } else { %>",'<td><%= _.escape(library.get("synopsis"))%></td>',"<% } %>","<% } else { %>","<td></td>","<% } %>","<% } else if(edit_mode){ %>",'<td><textarea rows="4" class="form-control input_library_name" placeholder="name" ><%- library.get("name") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_description" placeholder="description" ><%- library.get("description") %></textarea></td>','<td><textarea rows="4" class="form-control input_library_synopsis" placeholder="synopsis" ><%- library.get("synopsis") %></textarea></td>',"<% } %>",'<td class="right-center">','<% if( (library.get("public")) && (library.get("deleted") === false) ) { %>','<span data-toggle="tooltip" data-placement="left" title="Unrestricted library" style="color:grey;" class="fa fa-globe fa-lg"> </span>',"<% }%>",'<button data-toggle="tooltip" data-placement="left" title="Modify \'<%- library.get("name") %>\'" class="btn btn-sm edit_library_btn" type="button" style="<% if(button_config.edit_library_btn === false) { print("display:none;") } %>"><span class="fa fa-pencil"></span> Edit</button>','<a data-toggle="tooltip" data-placement="left" title="Permissions of \'<%- library.get("name") %>\'" href="#library/<%- library.get("id") %>/permissions"><button class="btn btn-sm permission_library_btn" type="button" style="<% if(button_config.permission_library_btn === false) { print("display:none;") } %>"><span class="fa fa-group"></span> Manage</button></a>','<button data-toggle="tooltip" data-placement="left" title="Save changes" class="btn btn-sm save_library_btn" type="button" style="<% if(button_config.save_library_btn === false) { print("display:none;") } %>"><span class="fa fa-floppy-o"></span> Save</button>','<button data-toggle="tooltip" data-placement="left" title="Discard changes" class="btn btn-sm cancel_library_btn" type="button" style="<% if(button_config.cancel_library_btn === false) { print("display:none;") } %>"><span class="fa fa-times"></span> Cancel</button>','<button data-toggle="tooltip" data-placement="left" title="Delete \'<%- library.get("name") %>\'" class="btn btn-sm delete_library_btn" type="button" style="<% if(button_config.delete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-trash-o"></span> Delete</button>','<span data-toggle="tooltip" data-placement="left" title="Marked deleted" style="color:grey; <% if(button_config.undelete_library_btn === false) { print("display:none;") } %>" class="fa fa-ban fa-lg"></span>','<button data-toggle="tooltip" data-placement="left" title="Undelete \'<%- library.get("name") %>\' " class="btn btn-sm undelete_library_btn" type="button" style="<% if(button_config.undelete_library_btn === false) { print("display:none;") } %>"><span class="fa fa-unlock"></span> Undelete</button>',"</td>","</tr>"].join(""))}});e.default={LibraryRowView:s}}).call(e,n(2),n(0),n(1))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(20),c=a(l),d=n(59),u=a(d),h=t.View.extend({el:"#center",defaults:{search_term:""},events:{"click #create_new_library_btn":"createLibraryFromModal","click #include_deleted_chk":"includeDeletedChecked","click #exclude_restricted_chk":"excludeRestrictedChecked","click .page_size_prompt":"showPageSizePrompt","keyup .library-search-input":"searchLibraries"},initialize:function(t){this.options=i.defaults(this.options||{},t,this.defaults),this.render()},render:function(){var t=this.templateToolBar(),e=!1,n=!0;Galaxy.user&&(e=Galaxy.user.isAdmin(),n=Galaxy.user.isAnonymous()),this.$el.html(t({admin_user:e,anon_user:n})),e&&(this.$el.find("#include_deleted_chk")[0].checked=Galaxy.libraries.preferences.get("with_deleted"),this.$el.find("#exclude_restricted_chk")[0].checked=Galaxy.libraries.preferences.get("without_restricted"))},renderPaginator:function(t){this.options=i.extend(this.options,t);var e=this.templatePaginator();this.$el.find(".library-paginator").html(e({show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_libraries_count:this.options.total_libraries_count,libraries_shown:this.options.libraries_shown,library_page_size:Galaxy.libraries.preferences.get("library_page_size")}))},createLibraryFromModal:function(t){t.preventDefault(),t.stopPropagation();var e=this;this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,s.default)("Create New Library"),body:this.templateNewLibraryInModal(),buttons:{Create:function(){e.createNewLibrary()},Close:function(){e.modal.hide()}}})},createNewLibrary:function(){var t=this.serializeNewLibrary();if(this.validateNewLibrary(t)){var e=new u.default.Library,n=this;e.save(t,{success:function(t){Galaxy.libraries.libraryListView.collection.add(t),n.modal.hide(),n.clearLibraryModal(),Galaxy.libraries.libraryListView.render(),c.default.success("Library created.")},error:function(t,e){void 0!==e.responseJSON?c.default.error(e.responseJSON.err_msg):c.default.error("An error occured.")}})}else c.default.error("Library's name is missing.");return!1},showPageSizePrompt:function(t){t.preventDefault();var e=prompt("How many libraries per page do you want to see?",Galaxy.libraries.preferences.get("library_page_size"));null!=e&&e==parseInt(e)&&(Galaxy.libraries.preferences.set({library_page_size:parseInt(e)}),Galaxy.libraries.libraryListView.render({show_page:1}))},clearLibraryModal:function(){r("input[name='Name']").val(""),r("input[name='Description']").val(""),r("input[name='Synopsis']").val("")},serializeNewLibrary:function(){return{name:r("input[name='Name']").val(),description:r("input[name='Description']").val(),synopsis:r("input[name='Synopsis']").val()}},validateNewLibrary:function(t){return""!==t.name},includeDeletedChecked:function(t){t.target.checked?(Galaxy.libraries.preferences.set({with_deleted:!0}),Galaxy.libraries.libraryListView.fetchDeleted()):(Galaxy.libraries.preferences.set({with_deleted:!1}),Galaxy.libraries.libraryListView.render())},excludeRestrictedChecked:function(t){t.target.checked?Galaxy.libraries.preferences.set({without_restricted:!0}):Galaxy.libraries.preferences.set({without_restricted:!1}),Galaxy.libraries.libraryListView.render()},searchLibraries:function(t){var e=r(".library-search-input").val();this.options.search_term=e,Galaxy.libraries.libraryListView.searchLibraries(e)},templateToolBar:function(){return i.template(['<div class="library_style_container">','<div class="d-flex align-items-center mb-2">','<a class="mr-1" href="#" data-toggle="tooltip" data-placement="top" title="Go to first page">DATA LIBRARIES</a>','<div class="d-flex align-items-center library-paginator mr-1" />','<form class="form-inline mr-1">','<input type="text" class="form-control library-search-input mr-1" placeholder="Great Library" size="15">',"<% if(admin_user === true) { %>",'<div class="form-check mr-1">','<input class="form-check-input" id="include_deleted_chk" type="checkbox">','<label class="form-check-label" for="include_deleted_chk">include deleted</label>',"</div>",'<div class="form-check mr-1">','<input class="form-check-input" id="exclude_restricted_chk" type="checkbox">','<label class="form-check-label" for="exclude_restricted_chk">exclude restricted</label>',"</div>",'<button data-toggle="tooltip" data-placement="top" title="Create new library" id="create_new_library_btn" class="btn btn-secondary" type="button"><span class="fa fa-plus"></span> New Library</button>',"<% } %>","</form>",'<a class="library-help-button" data-toggle="tooltip" data-placement="top" title="See this screen annotated" href="https://galaxyproject.org/data-libraries/screen/list-of-libraries/" target="_blank">','<button class="btn btn-secondary" type="button"><span class="fa fa-question-circle"></span> Help</button>',"</a>","</div>",'<div id="libraries_element" />',"</div>"].join(""))},templatePaginator:function(){return i.template(['<ul class="pagination mr-1">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li class="page-item"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li class="page-item"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item"><a class="page-link" href="#page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="page-item active">','<a class="page-link" href="#page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li class="page-item"><a class="page-link" href="#page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item"><a class="page-link" href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item disabled"><a class="page-link" href="#page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>",'<span class="mr-1">',' <%- libraries_shown %> libraries shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- library_page_size %> per page" class="page_size_prompt">(change)</a>',"</span>",'<span class="mr-1">'," <%- total_libraries_count %> total","</span>"].join(""))},templateNewLibraryInModal:function(){return i.template(['<div id="new_library_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">','<input type="text" name="Synopsis" value="" placeholder="Synopsis">',"</form>","</div>"].join(""))}});e.default={LibraryToolbarView:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=o(s),c=n(5),d=o(c),u=n(20),h=o(u),f=n(59),p=o(f),_=n(39),g=o(_),m=n(85),v=o(m),y=n(190),b=o(y),w=n(191),x=o(w),k=n(153),M=o(k);n(412);var C=t.View.extend({el:"#center",events:{"click .toolbtn-create-folder":"createFolderFromModal","click .toolbtn-bulk-import":"importToHistoryModal","click .include-deleted-datasets-chk":"checkIncludeDeleted","click .toolbtn-bulk-delete":"deleteSelectedItems","click .toolbtn-show-locinfo":"showLocInfo","click .page-size-prompt":"showPageSizePrompt","click .toolbtn-collection-import":"showCollectionSelect"},defaults:{can_add_library_item:!1,contains_file_or_folder:!1,chain_call_control:{total_number:0,failed_number:0},disabled_jstree_element:"folders"},modal:null,jstree:null,histories:null,select_genome:null,select_extension:null,list_extensions:[],auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be. You can also upload compressed files, which will automatically be decompressed."},list_genomes:[],initialize:function(t){this.options=i.defaults(t||{},this.defaults),this.fetchExtAndGenomes(),this.render()},render:function(t){this.options=i.extend(this.options,t);var e=this.templateToolBar(),n={id:this.options.id,is_admin:!1,is_anonym:!0,multiple_add_dataset_options:!1};Galaxy.user&&(n.is_admin=Galaxy.user.isAdmin(),n.is_anonym=Galaxy.user.isAnonymous(),null===Galaxy.config.user_library_import_dir&&!1===Galaxy.config.allow_library_path_paste&&null===Galaxy.config.library_import_dir||(n.multiple_add_dataset_options=!0)),this.$el.html(e(n))},renderPaginator:function(t){this.options=i.extend(this.options,t);var e=this.templatePaginator();r("body").find(".folder-paginator").html(e({id:this.options.id,show_page:parseInt(this.options.show_page),page_count:parseInt(this.options.page_count),total_items_count:this.options.total_items_count,items_shown:this.options.items_shown,folder_page_size:Galaxy.libraries.preferences.get("folder_page_size")}))},configureElements:function(t){this.options=i.extend(this.options,t),!0===this.options.can_add_library_item?r(".add-library-items").show():r(".add-library-items").hide(),!0===this.options.contains_file_or_folder&&Galaxy.user?Galaxy.user.isAnonymous()?(r(".dataset-manipulation").show(),r(".logged-dataset-manipulation").hide()):(r(".logged-dataset-manipulation").show(),r(".dataset-manipulation").show()):(r(".logged-dataset-manipulation").hide(),r(".dataset-manipulation").hide()),this.$el.find('[data-toggle="tooltip"]').tooltip({trigger:"hover"})},createFolderFromModal:function(t){var e=this;t.preventDefault(),t.stopPropagation();var n=this.templateNewFolderInModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Create New Folder"),body:n(),buttons:{Create:function(){e.createNewFolderEvent()},Close:function(){Galaxy.modal.hide()}}})},createNewFolderEvent:function(){var e=this.serializeNewFolder();if(this.validateNewFolder(e)){var n,i=new p.default.FolderAsModel,r=t.history.fragment.split("/");n=r.indexOf("page")>-1?r[r.length-3]:r[r.length-1],i.url=i.urlRoot+n,i.save(e,{success:function(t){Galaxy.modal.hide(),h.default.success("Folder created."),t.set({type:"folder"}),Galaxy.libraries.folderListView.collection.add(t)},error:function(t,e){Galaxy.modal.hide(),void 0!==e.responseJSON?h.default.error(e.responseJSON.err_msg):h.default.error("An error occurred.")}})}else h.default.error("Folder's name is missing.");return!1},serializeNewFolder:function(){return{name:r("input[name='Name']").val(),description:r("input[name='Description']").val()}},validateNewFolder:function(t){return""!==t.name},importToHistoryModal:function(t){var e=this;t.preventDefault();var n=this.findCheckedRows(),i=this.templateImportIntoHistoryModal();if(0===n.length)h.default.info("You must select some datasets first.");else{this.fetchUserHistories().done(function(){e.modal=Galaxy.modal,e.modal.show({closing_events:!0,title:(0,l.default)("Import into History"),body:i({histories:e.histories.models}),buttons:{Import:function(){e.importAllIntoHistory()},Close:function(){Galaxy.modal.hide()}}})}).fail(function(t,e){void 0!==e.responseJSON?h.default.error(e.responseJSON.err_msg):h.default.error("An error occurred.")})}},fetchUserHistories:function(){return this.histories=new p.default.GalaxyHistories,this.histories.fetch()},importAllIntoHistory:function(){var t=this;this.modal.disableButton("Import");var e=this.modal.$("input[name=history_name]").val();if(""!==e)this.createNewHistory(e).done(function(e){t.processImportToHistory(e.id,e.name)}).fail(function(t,e,n){h.default.error("An error occurred.")}).always(function(){t.modal.enableButton("Import")});else{var n=r("select[name=import_to_history] option:selected").val(),i=r("select[name=import_to_history] option:selected").text();this.processImportToHistory(n,i),this.modal.enableButton("Import")}},createNewHistory:function(t){return r.post(Galaxy.root+"api/histories",{name:t})},processImportToHistory:function(t,e){for(var n=this.findCheckedItems(),i=[],r=n.dataset_ids.length-1;r>=0;r--){var o=n.dataset_ids[r],s=new p.default.HistoryItem;s.url=s.urlRoot+t+"/contents",s.content=o,s.source="library",i.push(s)}for(var l=n.folder_ids.length-1;l>=0;l--){var c=n.folder_ids[l],s=new p.default.HistoryItem;s.url=s.urlRoot+t+"/contents",s.content=c,s.source="library_folder",i.push(s)}this.initChainCallControl({length:i.length,action:"to_history",history_name:e}),a.getJSON(Galaxy.root+"history/set_as_current?id="+t),this.chainCallImportingIntoHistory(i,e)},updateProgress:function(){this.progress+=this.progressStep,r(".progress-bar-import").width(Math.round(this.progress)+"%");var t=Math.round(this.progress)+"% Complete";r(".completion_span").text(t)},download:function(t){var e=this.findCheckedItems(),n=Galaxy.root+"api/libraries/datasets/download/"+t,i={ld_ids:e.dataset_ids,folder_ids:e.folder_ids};this.processDownload(n,i,"get")},processDownload:function(t,e,n){if(t&&e){e="string"==typeof e?e:r.param(e);var i="";r.each(e.split("&"),function(){var t=this.split("=");i+='<input type="hidden" name="'+t[0]+'" value="'+t[1]+'" />'}),r('<form action="'+t+'" method="'+(n||"post")+'">'+i+"</form>").appendTo("body").submit().remove(),h.default.info("Your download will begin soon.")}else h.default.error("An error occurred.")},addFilesFromHistoryModal:function(){var t=this;this.histories=new p.default.GalaxyHistories,this.histories.fetch().done(function(){t.modal=Galaxy.modal;var e=t.templateAddFilesFromHistory();t.modal.show({closing_events:!0,title:(0,l.default)("Adding datasets from your history"),body:e({histories:t.histories.models}),buttons:{Add:function(){t.addAllDatasetsFromHistory()},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+t.id,{trigger:!0})}}),t.fetchAndDisplayHistoryContents(t.histories.models[0].id),r("#dataset_add_bulk").change(function(e){t.fetchAndDisplayHistoryContents(e.target.value)})}).fail(function(t,e){void 0!==e.responseJSON?h.default.error(e.responseJSON.err_msg):h.default.error("An error occurred.")})},importFilesFromPathModal:function(){var t=this;this.modal=Galaxy.modal;var e=this.templateImportPathModal();this.modal.show({closing_events:!0,title:(0,l.default)("Please enter paths to import"),body:e({}),buttons:{Import:function(){t.importFromPathsClicked(t)},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+t.id,{trigger:!0})}}),this.renderSelectBoxes()},fetchExtAndGenomes:function(){var t=this;d.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(e){t.list_extensions=[];for(var n in e)t.list_extensions.push({id:e[n].extension,text:e[n].extension,description:e[n].description,description_url:e[n].description_url});t.list_extensions.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0}),t.list_extensions.unshift(t.auto)},cache:!0}),d.default.get({url:Galaxy.root+"api/genomes",success:function(e){t.list_genomes=[];for(var n in e)t.list_genomes.push({id:e[n][1],text:e[n][0]});t.list_genomes.sort(function(t,e){return t.id>e.id?1:t.id<e.id?-1:0})},cache:!0})},renderSelectBoxes:function(){this.select_genome=new g.default.View({css:"library-genome-select",data:this.list_genomes,container:Galaxy.modal.$el.find("#library_genome_select"),value:"?"}),this.select_extension=new g.default.View({css:"library-extension-select",data:this.list_extensions,container:Galaxy.modal.$el.find("#library_extension_select"),value:"auto"})},importFilesFromGalaxyFolderModal:function(t){var e=this,n=this.templateBrowserModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Please select folders or files"),body:n({}),buttons:{Import:function(){e.importFromJstreePath(e,t)},Close:function(){Galaxy.modal.hide()}},closing_callback:function(){Galaxy.libraries.library_router.navigate("folders/"+e.id,{trigger:!0})}}),r(".libimport-select-all").bind("click",function(){r("#jstree_browser").jstree("check_all")}),r(".libimport-select-none").bind("click",function(){r("#jstree_browser").jstree("uncheck_all")}),this.renderSelectBoxes(),t.disabled_jstree_element="folders",this.renderJstree(t),r("input[type=radio]").change(function(n){"jstree-disable-folders"===n.target.value?(t.disabled_jstree_element="folders",e.renderJstree(t),r(".jstree-folders-message").hide(),r(".jstree-preserve-structure").hide(),r(".jstree-files-message").show()):"jstree-disable-files"===n.target.value&&(r(".jstree-files-message").hide(),r(".jstree-folders-message").show(),r(".jstree-preserve-structure").show(),t.disabled_jstree_element="files",e.renderJstree(t))})},renderJstree:function(t){this.options=i.extend(this.options,t);var e=t.source||"userdir",n=this.options.disabled_jstree_element;this.jstree=new p.default.Jstree,this.jstree.url=this.jstree.urlRoot+"?target="+e+"&format=jstree&disable="+n,this.jstree.fetch({success:function(t,e){r("#jstree_browser").jstree("destroy"),r("#jstree_browser").jstree({core:{data:t},plugins:["types","checkbox"],types:{folder:{icon:"jstree-folder"},file:{icon:"jstree-file"}},checkbox:{three_state:!1}})},error:function(t,e){void 0!==e.responseJSON?404001===e.responseJSON.err_code?h.default.warning(e.responseJSON.err_msg):h.default.error(e.responseJSON.err_msg):h.default.error("An error occurred.")}})},importFromPathsClicked:function(){var t=this.modal.$el.find(".preserve-checkbox").is(":checked"),e=this.modal.$el.find(".link-checkbox").is(":checked"),n=this.modal.$el.find(".spacetab-checkbox").is(":checked"),i=this.modal.$el.find(".posix-checkbox").is(":checked"),a=this.modal.$el.find(".tag-files").is(":checked"),o=this.select_extension.value(),s=this.select_genome.value(),l=r("textarea#import_paths").val(),c=[];if(l){this.modal.disableButton("Import"),l=l.split("\n");for(var d=l.length-1;d>=0;d--){var u=l[d].trim();0!==u.length&&c.push(u)}this.initChainCallControl({length:c.length,action:"adding_datasets"}),this.chainCallImportingFolders({paths:c,preserve_dirs:t,link_data:e,space_to_tab:n,to_posix_lines:i,source:"admin_path",file_type:o,tag_using_filenames:a,dbkey:s})}else h.default.info("Please enter a path relative to Galaxy root.")},initChainCallControl:function(t){var e;switch(t.action){case"adding_datasets":e=this.templateAddingDatasetsProgressBar(),this.modal.$el.find(".modal-body").html(e({folder_name:this.options.folder_name}));break;case"deleting_datasets":e=this.templateDeletingItemsProgressBar(),this.modal.$el.find(".modal-body").html(e());break;case"to_history":e=this.templateImportIntoHistoryProgressBar(),this.modal.$el.find(".modal-body").html(e({history_name:t.history_name}));break;default:Galaxy.emit.error("Wrong action specified.","datalibs")}this.progress=0,this.progressStep=100/t.length,this.options.chain_call_control.total_number=t.length,this.options.chain_call_control.failed_number=0},importFromJstreePath:function(t,e){var n=r("#jstree_browser").jstree().get_selected(!0),a=i.filter(n,function(t){return 0==t.state.disabled}),o=this.modal.$el.find(".preserve-checkbox").is(":checked"),s=this.modal.$el.find(".link-checkbox").is(":checked"),l=this.modal.$el.find(".spacetab-checkbox").is(":checked"),c=this.modal.$el.find(".posix-checkbox").is(":checked"),d=this.select_extension.value(),u=this.select_genome.value(),f=this.modal.$el.find(".tag-files").is(":checked"),p=a[0].type,_=[];if(a.length<1)h.default.info("Please select some items first.");else{this.modal.disableButton("Import");for(var g=a.length-1;g>=0;g--)void 0!==a[g].li_attr.full_path&&_.push(a[g].li_attr.full_path);if(this.initChainCallControl({length:_.length,action:"adding_datasets"}),"folder"===p){var m=e.source+"_folder";this.chainCallImportingFolders({paths:_,preserve_dirs:o,link_data:s,space_to_tab:l,to_posix_lines:c,source:m,file_type:d,dbkey:u,tag_using_filenames:f})}else if("file"===p){var m=e.source+"_file";this.chainCallImportingUserdirFiles({paths:_,file_type:d,dbkey:u,link_data:s,space_to_tab:l,to_posix_lines:c,source:m,tag_using_filenames:f})}}},fetchAndDisplayHistoryContents:function(t){var e=this;new p.default.HistoryContents({id:t}).fetch({success:function(n){var i=e.templateHistoryContents();e.histories.get(t).set({contents:n}),e.modal.$el.find(".library_selected_history_content").html(i({history_contents:n.models.reverse()})),e.modal.$el.find(".history-import-select-all").bind("click",function(){r(".library_selected_history_content [type=checkbox]").prop("checked",!0)}),e.modal.$el.find(".history-import-unselect-all").bind("click",function(){r(".library_selected_history_content [type=checkbox]").prop("checked",!1)})},error:function(t,e){void 0!==e.responseJSON?h.default.error(e.responseJSON.err_msg):h.default.error("An error occurred.")}})},addAllDatasetsFromHistory:function(){var t=this.modal.$el.find(".library_selected_history_content").find(":checked"),e=[],n=[],i=[];if(t.length<1)h.default.info("You must select some datasets first.");else{this.modal.disableButton("Add"),t.each(function(){var t=r(this).closest("li").data("id");if(t){var i=r(this).closest("li").data("name");e.push(t),n.push(i)}});for(var a=e.length-1;a>=0;a--){var o=e[a],s=new p.default.Item;s.url=Galaxy.root+"api/folders/"+this.options.id+"/contents","collection"===n[a]?s.set({from_hdca_id:o}):s.set({from_hda_id:o}),i.push(s)}this.initChainCallControl({length:i.length,action:"adding_datasets"}),this.chainCallAddingHdas(i)}},chainCallImportingIntoHistory:function(t,e){var n=this,i=t.pop();if(void 0===i)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected datasets imported into history. Click this to start analyzing it.","",{onclick:function(){window.location=Galaxy.root}}):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no datasets were imported into history."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the datasets could not be imported into history. Click this to see what was imported.","",{onclick:function(){window.location=Galaxy.root}}),Galaxy.modal.hide(),!0;r.when(i.save({content:i.content,source:i.source})).done(function(){n.updateProgress(),n.chainCallImportingIntoHistory(t,e)}).fail(function(){n.options.chain_call_control.failed_number+=1,n.updateProgress(),n.chainCallImportingIntoHistory(t,e)})},chainCallImportingUserdirFiles:function(t){var e=this,n=t.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(h.default.success("Selected files imported into the current folder"),Galaxy.modal.hide()):h.default.error("An error occured."),!0;r.when(r.post(Galaxy.root+"api/libraries/datasets?encoded_folder_id="+this.id+"&source="+t.source+"&path="+n+"&file_type="+t.file_type+"&link_data="+t.link_data+"&space_to_tab="+t.space_to_tab+"&to_posix_lines="+t.to_posix_lines+"&dbkey="+t.dbkey+"&tag_using_filenames="+t.tag_using_filenames)).done(function(n){e.updateProgress(),e.chainCallImportingUserdirFiles(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallImportingUserdirFiles(t)})},chainCallImportingFolders:function(t){var e=this,n=t.paths.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?(h.default.success("Selected folders and their contents imported into the current folder."),Galaxy.modal.hide()):h.default.error("An error occured."),!0;r.when(r.post(Galaxy.root+"api/libraries/datasets?encoded_folder_id="+this.id+"&source="+t.source+"&path="+n+"&preserve_dirs="+t.preserve_dirs+"&link_data="+t.link_data+"&to_posix_lines="+t.to_posix_lines+"&space_to_tab="+t.space_to_tab+"&file_type="+t.file_type+"&dbkey="+t.dbkey+"&tag_using_filenames="+t.tag_using_filenames)).done(function(n){e.updateProgress(),e.chainCallImportingFolders(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallImportingFolders(t)})},chainCallAddingHdas:function(t){var e=this;this.added_hdas=new p.default.Folder;var n=t.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected datasets from history added to the folder"):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no datasets were added to the folder."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the datasets could not be added to the folder"),Galaxy.modal.hide(),this.added_hdas;r.when(n.save({from_hda_id:n.get("from_hda_id")})).done(function(n){Galaxy.libraries.folderListView.collection.add(n),e.updateProgress(),e.chainCallAddingHdas(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallAddingHdas(t)})},chainCallDeletingItems:function(t){var e=this;this.deleted_items=new p.default.Folder;var n=t.pop();if(void 0===n)return 0===this.options.chain_call_control.failed_number?h.default.success("Selected items were deleted."):this.options.chain_call_control.failed_number===this.options.chain_call_control.total_number?h.default.error("There was an error and no items were deleted. Please make sure you have sufficient permissions."):this.options.chain_call_control.failed_number<this.options.chain_call_control.total_number&&h.default.warning("Some of the items could not be deleted. Please make sure you have sufficient permissions."),Galaxy.modal.hide(),this.deleted_items;n.destroy().done(function(i){if(Galaxy.libraries.folderListView.collection.remove(n.id),e.updateProgress(),Galaxy.libraries.folderListView.options.include_deleted){var r=null;"folder"===i.type||"LibraryFolder"===i.model_class?r=new p.default.FolderAsModel(i):"file"===i.type||"LibraryDataset"===i.model_class?r=new p.default.Item(i):(Galaxy.emit.error("Unknown library item type found.","datalibs"),Galaxy.emit.error(i.type||i.model_class,"datalibs")),Galaxy.libraries.folderListView.collection.add(r)}e.chainCallDeletingItems(t)}).fail(function(){e.options.chain_call_control.failed_number+=1,e.updateProgress(),e.chainCallDeletingItems(t)})},checkIncludeDeleted:function(t){t.target.checked?Galaxy.libraries.folderListView.fetchFolder({include_deleted:!0}):Galaxy.libraries.folderListView.fetchFolder({include_deleted:!1})},deleteSelectedItems:function(){var t=[],e=[],n=this.findCheckedRows();if(0===n.length)h.default.info("You must select at least one item for deletion.");else{var i=this.templateDeletingItemsProgressBar();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Deleting selected items"),body:i({}),buttons:{Close:function(){Galaxy.modal.hide()}}}),this.options.chain_call_control.total_number=0,this.options.chain_call_control.failed_number=0,n.each(function(){var n=r(this).closest("tr").data("id");void 0!==n&&("F"==n.substring(0,1)?e.push(n):t.push(n))});var a=t.length+e.length;this.progressStep=100/a,this.progress=0;for(var o=[],s=t.length-1;s>=0;s--){var c=new p.default.Item({id:t[s]});o.push(c)}for(var d=e.length-1;d>=0;d--){var u=new p.default.FolderAsModel({id:e[d]});o.push(u)}this.options.chain_call_control.total_number=a,this.chainCallDeletingItems(o)}},showLocInfo:function(){var t=this,e=null;null!==Galaxy.libraries.libraryListView?(e=Galaxy.libraries.libraryListView.collection.get(this.options.parent_library_id),this.showLocInfoModal(e)):(e=new p.default.Library({id:this.options.parent_library_id}),e.fetch({success:function(){t.showLocInfoModal(e)},error:function(t,e){void 0!==e.responseJSON?h.default.error(e.responseJSON.err_msg):h.default.error("An error occurred.")}}))},showLocInfoModal:function(t){var e=this.templateLocInfoInModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:(0,l.default)("Location Details"),body:e({library:t,options:this.options}),buttons:{Close:function(){Galaxy.modal.hide()}}})},showImportModal:function(t){switch(t.source){case"history":this.addFilesFromHistoryModal();break;case"importdir":this.importFilesFromGalaxyFolderModal({source:"importdir"});break;case"path":this.importFilesFromPathModal();break;case"userdir":this.importFilesFromGalaxyFolderModal({source:"userdir"});break;default:Galaxy.libraries.library_router.back(),h.default.error("Invalid import source.")}},showPageSizePrompt:function(t){t.preventDefault();var e=prompt("How many items per page do you want to see?",Galaxy.libraries.preferences.get("folder_page_size"));null!=e&&e==parseInt(e)&&(Galaxy.libraries.preferences.set({folder_page_size:parseInt(e)}),Galaxy.libraries.folderListView.render({id:this.options.id,show_page:1}))},findCheckedRows:function(){return r("#folder_list_body").find(":checked")},findCheckedItems:function(){var t=[],e=[];return this.findCheckedRows().each(function(){var n=r(this).closest("tr").data("id");"F"==n.substring(0,1)?t.push(n):e.push(n)}),{folder_ids:t,dataset_ids:e}},showCollectionSelect:function(t){var e=this;t.preventDefault();var n=this.findCheckedItems(),i=this.templateCollectionSelectModal();this.modal=Galaxy.modal,this.modal.show({closing_events:!0,title:"Create History Collection from Datasets",body:i({selected_datasets:n.dataset_ids.length}),buttons:{Continue:function(){e.showColectionBuilder(n.dataset_ids)},Close:function(){Galaxy.modal.hide()}}}),this.prepareCollectionTypeSelect(),this.prepareHistoryTypeSelect()},prepareCollectionTypeSelect:function(){var t=this;this.collectionType="list",this.select_collection_type=new g.default.View({css:"library-collection-type-select",container:this.modal.$el.find(".library-collection-type-select"),data:[{id:"list",text:"List"},{id:"paired",text:"Paired"},{id:"list:paired",text:"List of Pairs"},{id:"rules",text:"From Rules"}],value:"list",onchange:function(e){t.updateCollectionType(e)}})},prepareHistoryTypeSelect:function(){var t=this;this.fetchUserHistories().done(function(){for(var e=[],n=t.histories.length-1;n>=0;n--)e.unshift({id:t.histories.models[n].id,text:t.histories.models[n].get("name")});t.select_collection_history=new g.default.View({css:"library-collection-history-select",container:t.modal.$el.find(".library-collection-history-select"),data:e,value:e[0].id})})},updateCollectionType:function(t){this.collectionType=t},showColectionBuilder:function(e){var n=this,i=[],r=this.modal.$('input[type="radio"]:checked').val();if("selection"===r)for(var a=e.length-1;a>=0;a--){var o={},s=Galaxy.libraries.folderListView.folder_container.get("folder").get(e[a]);o.id=e[a],o.name=s.get("name"),o.deleted=s.get("deleted"),o.state=s.get("state"),i.push(o)}else"folder"===r&&(i=new t.Collection(Galaxy.libraries.folderListView.folder_container.get("folder").where({type:"file"})).toJSON());var l=this.modal.$("input[name=history_name]").val();if(""!==l)this.createNewHistory(l).done(function(t){h.default.success("History created"),n.collectionImport(i,t.id,t.name)}).fail(function(t,e,n){h.default.error("An error occurred.")});else{var c=this.select_collection_history.value(),d=this.select_collection_history.text();this.collectionImport(i,c,d)}},collectionImport:function(t,e,n){var i=this,r="Creating Collection in "+n,a=void 0,o=void 0;if("list"===this.collectionType)a=v.default.ListCollectionCreator,o=function(t,n,r){return t=t.map(function(t){return{id:t.id,name:t.name,src:"ldda"}}),i.createHDCA(t,i.collectionType,n,r,e)},v.default.collectionCreatorModal(t,{creationFn:o,title:r,defaultHideSourceItems:!0},a);else if("paired"===this.collectionType)a=b.default.PairCollectionCreator,o=function(t,n,r){return t=[{name:"forward",src:"ldda",id:t[0].id},{name:"reverse",src:"ldda",id:t[1].id}],i.createHDCA(t,i.collectionType,n,r,e)},v.default.collectionCreatorModal(t,{creationFn:o,title:r,defaultHideSourceItems:!0},a);else if("list:paired"===this.collectionType){var s=t.map(function(t){return{id:t.id,name:t.name,src:"ldda"}});x.default.pairedCollectionCreatorModal(s,{historyId:e,title:r,defaultHideSourceItems:!0})}else if("rules"===this.collectionType){var l=function(t,n,r,a){return i.createHDCA(t,n,r,a,e)};v.default.ruleBasedCollectionCreatorModal(t,"library_datasets","collections",{creationFn:l,defaultHideSourceItems:!0})}},createHDCA:function(t,e,n,i,r,a){return new M.default.HistoryDatasetCollection({history_content_type:"dataset_collection",collection_type:e,history_id:r,name:n,hide_source_items:i||!1,element_identifiers:t}).save(a)},templateToolBar:function(){return i.template(['<div class="library_style_container">','<div class="d-flex align-items-center mb-2">','<span class="mr-1">DATA LIBRARIES</span>',"<div>",'<form class="form-inline">','<div class="form-check logged-dataset-manipulation mr-1" style="display:none;">','<input class="form-check-input include-deleted-datasets-chk" id="include_deleted_datasets_chk" type="checkbox">','<label class="form-check-label" for="include_deleted_datasets_chk">include deleted</label>',"</div>",'<button style="display:none;" title="Create new folder" class="btn btn-secondary toolbtn-create-folder add-library-items add-library-items-folder mr-1" type="button">','<span class="fa fa-plus"></span> <span class="fa fa-folder"></span> Create Folder ',"</button>","<% if(multiple_add_dataset_options) { %>",'<div data-toggle="tooltip" data-placement="right" title="Add datasets to current folder" class="dropdown add-library-items add-library-items-datasets mr-1" style="display:none;">','<button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">','<span class="fa fa-plus"></span> <span class="fa fa-file"></span> Add Datasets <span class="caret"></span>',"</button>",'<div class="dropdown-menu">','<a class="dropdown-item" href="#folders/<%= id %>/import/history"> from History</a>',"<% if(Galaxy.config.user_library_import_dir !== null) { %>",'<a class="dropdown-item" href="#folders/<%= id %>/import/userdir"> from User Directory</a>',"<% } %>","<% if(Galaxy.config.library_import_dir !== null || Galaxy.config.allow_library_path_paste) { %>",'<h5 class="dropdown-header">Admins only</h5>',"<% if(Galaxy.config.library_import_dir !== null) { %>",'<a class="dropdown-item" href="#folders/<%= id %>/import/importdir">from Import Directory</a>',"<% } %>","<% if(Galaxy.config.allow_library_path_paste) { %>",'<a class="dropdown-item" href="#folders/<%= id %>/import/path">from Path</a>',"<% } %>","<% } %>","</div>","</div>","<% } else { %>",'<a data-placement="top" title="Add Datasets to Current Folder" style="display:none;" class="btn btn-secondary add-library-items add-library-items-datasets" href="#folders/<%= id %>/import/history" role="button">','<span class="fa fa-plus"></span><span class="fa fa-file"></span>',"</a>","<% } %>",'<div data-toggle="tooltip" data-placement="right" title="Import to history" class="dropdown mr-1">','<button type="button" class="primary-button dropdown-toggle add-to-history" data-toggle="dropdown">','<span class="fa fa-book"></span> To History <span class="caret"></span>',"</button>",'<div class="dropdown-menu" role="menu">','<a href="" class="toolbtn-bulk-import add-to-history-datasets dropdown-item">as Datasets</a>','<a href="" class="toolbtn-collection-import add-to-history-collection dropdown-item">as a Collection</a>',"</div>","</div>",'<div data-toggle="tooltip" data-placement="right" title="Download items as archive" class="dropdown dataset-manipulation mr-1" style="display:none; ">','<button type="button" class="primary-button dropdown-toggle" data-toggle="dropdown">','<span class="fa fa-save"></span> Download <span class="caret"></span>',"</button>",'<div class="dropdown-menu" role="menu">','<a class="dropdown-item" href="#/folders/<%= id %>/download/tgz">.tar.gz</a>','<a class="dropdown-item" href="#/folders/<%= id %>/download/tbz">.tar.bz</a>','<a class="dropdown-item" href="#/folders/<%= id %>/download/zip">.zip</a>',"</div>","</div>",'<button data-toggle="tooltip" data-placement="right" title="Mark items deleted" class="primary-button toolbtn-bulk-delete logged-dataset-manipulation mr-1" style="display:none;" type="button">','<span class="fa fa-trash"></span> Delete',"</button>",'<span class="mr-1" data-toggle="tooltip" data-placement="right" title="Show location details">','<button data-id="<%- id %>" class="primary-button toolbtn-show-locinfo" type="button">','<span class="fa fa-info-circle"></span>',"&nbsp;Details","</button>","</span>",'<span data-toggle="tooltip" data-placement="right" title="See this screen annotated">','<a class="library-help-button" href="https://galaxyproject.org/data-libraries/screen/folder-contents/" target="_blank">','<button class="primary-button" type="button">','<span class="fa fa-question-circle"></span>',"&nbsp;Help","</button>","</a>","</span>","</form>","</div>","</div>",'<div id="folder_items_element" />','<div class="d-flex justify-content-center align-items-center folder-paginator mt-2 mb-2" />',"</div>"].join(""))},templateLocInfoInModal:function(){return i.template(["<div>",'<table class="grid table table-sm">',"<thead>",'<th style="width: 25%;">library</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>",'<td><%- library.get("name") %></td>',"</tr>",'<% if(library.get("description") !== "") { %>',"<tr>","<td>description</td>",'<td><%- library.get("description") %></td>',"</tr>","<% } %>",'<% if(library.get("synopsis") !== "") { %>',"<tr>","<td>synopsis</td>",'<td><%- library.get("synopsis") %></td>',"</tr>","<% } %>",'<% if(library.get("create_time_pretty") !== "") { %>',"<tr>","<td>created</td>",'<td><span title="<%- library.get("create_time") %>"><%- library.get("create_time_pretty") %></span></td>',"</tr>","<% } %>","<tr>","<td>id</td>",'<td><%- library.get("id") %></td>',"</tr>","</tbody>","</table>",'<table class="grid table table-sm">',"<thead>",'<th style="width: 25%;">folder</th>',"<th></th>","</thead>","<tbody>","<tr>","<td>name</td>","<td><%- options.folder_name %></td>","</tr>",'<% if(options.folder_description !== "") { %>',"<tr>","<td>description</td>","<td><%- options.folder_description %></td>","</tr>","<% } %>","<tr>","<td>id</td>","<td><%- options.id %></td>","</tr>","</tbody>","</table>","</div>"].join(""))},templateNewFolderInModal:function(){return i.template(['<div id="new_folder_modal">',"<form>",'<input type="text" name="Name" value="" placeholder="Name" autofocus>','<input type="text" name="Description" value="" placeholder="Description">',"</form>","</div>"].join(""))},templateImportIntoHistoryModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"Select history: ",'<select name="import_to_history" style="width:50%; margin-bottom: 1em; " autofocus>',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>",'<div class="library-modal-item">',"or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" style="width:50%;" />',"</div>","</div>"].join(""))},templateImportIntoHistoryProgressBar:function(){return i.template(['<div class="import_text">',"Importing selected items to history <b><%= _.escape(history_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateAddingDatasetsProgressBar:function(){return i.template(['<div class="import_text">',"Adding selected datasets to library folder <b><%= _.escape(folder_name) %></b>","</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateDeletingItemsProgressBar:function(){return i.template(['<div class="import_text">',"</div>",'<div class="progress">','<div class="progress-bar progress-bar-import" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">','<span class="completion_span">0% Complete</span>',"</div>","</div>"].join(""))},templateBrowserModal:function(){return i.template(['<div id="file_browser_modal">','<div style="margin-bottom:1em;">','<label title="Switch to selecting files" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-folders" checked="checked"> Choose Files',"</label>",'<label title="Switch to selecting folders" class="radio-inline import-type-switch">','<input type="radio" name="jstree-radio" value="jstree-disable-files"> Choose Folders',"</label>","</div>",'<div class="alert alert-info jstree-files-message">All files you select will be imported into the current folder ignoring their folder structure.</div>','<div class="alert alert-info jstree-folders-message" style="display:none;">All files within the selected folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom:1em;">','<label class="checkbox-inline jstree-preserve-structure" style="display:none;">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<button title="Select all files" type="button" class="button primary-button libimport-select-all">',"Select all","</button>",'<button title="Select no files" type="button" class="button primary-button libimport-select-none">',"Unselect all","</button>","<hr />",'<div id="jstree_browser">',"</div>","<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<br>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateImportPathModal:function(){return i.template(['<div id="file_browser_modal">','<div class="alert alert-info jstree-folders-message">All files within the given folders and their subfolders will be imported into the current folder.</div>','<div style="margin-bottom: 0.5em;">','<label class="checkbox-inline">','<input class="preserve-checkbox" type="checkbox" value="preserve_directory_structure">',"Preserve directory structure","</label>",'<label class="checkbox-inline">','<input class="link-checkbox" type="checkbox" value="link_files">',"Link files instead of copying","</label>","<br>",'<label class="checkbox-inline">','<input class="posix-checkbox" type="checkbox" value="to_posix_lines" checked="checked">',"Convert line endings to POSIX","</label>",'<label class="checkbox-inline">','<input class="spacetab-checkbox" type="checkbox" value="space_to_tab">',"Convert spaces to tabs","</label>","</div>",'<textarea id="import_paths" class="form-control" rows="5" placeholder="Absolute paths (or paths relative to Galaxy root) separated by newline" autofocus></textarea>',"<hr />","<p>You can set extension type and genome for all imported datasets at once:</p>","<div>",'Type: <span id="library_extension_select" class="library-extension-select" />','Genome: <span id="library_genome_select" class="library-genome-select" />',"</div>","<div>",'<label class="checkbox-inline tag-files">',"Tag datasets based on file names",'<input class="tag-files" type="checkbox" value="tag_using_filenames">',"</label>","</div>","</div>"].join(""))},templateAddFilesFromHistory:function(){return i.template(['<div id="add_files_modal">',"<div>","1.&nbsp;Select history:&nbsp;",'<select id="dataset_add_bulk" name="dataset_add_bulk" style="width:66%; "> ',"<% _.each(histories, function(history) { %>",'<option value="<%= _.escape(history.get("id")) %>"><%= _.escape(history.get("name")) %></option>',"<% }); %>","</select>","</div>","<br/>",'<div class="library_selected_history_content">',"</div>","</div>"].join(""))},templateHistoryContents:function(){return i.template(["<p>2.&nbsp;Choose the datasets to import:</p>","<div>",'<button title="Select all datasets" type="button" class="button primary-button history-import-select-all">',"Select all","</button>",'<button title="Select all datasets" type="button" class="button primary-button history-import-unselect-all">',"Unselect all","</button>","</div>","<br>","<ul>","<% _.each(history_contents, function(history_item) { %>",'<% if (history_item.get("deleted") != true ) { %>','<% var item_name = history_item.get("name") %>','<% if (history_item.get("type") === "collection") { %>','<% var collection_type = history_item.get("collection_type") %>','<% if (collection_type === "list") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">',"<label>",'<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection)',"</label>","</li>","<% } else { %>",'<li><input style="margin: 0;" type="checkbox" onclick="return false;" disabled="disabled">','<span title="You can convert this collection into a collection of type list using the Collection Tools">','<%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %> (Dataset Collection of type <%= _.escape(collection_type) %> not supported.)',"</span>","</li>","<% } %>",'<% } else if (history_item.get("visible") === true && history_item.get("state") === "ok") { %>','<li data-id="<%= _.escape(history_item.get("id")) %>" data-name="<%= _.escape(history_item.get("type")) %>">','<label title="<%= _.escape(item_name) %>">','<input style="margin: 0;" type="checkbox"> <%= _.escape(history_item.get("hid")) %>: ','<%= item_name.length > 75 ? _.escape("...".concat(item_name.substr(-75))) : _.escape(item_name) %>',"</label>","</li>","<% } %>","<% } %>","<% }); %>","</ul>"].join(""))},templatePaginator:function(){return i.template(['<ul class="pagination mr-1">',"<% if ( ( show_page - 1 ) > 0 ) { %>","<% if ( ( show_page - 1 ) > page_count ) { %>",'<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } else { %>",'<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page - 1 ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>","<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/1"><span class="fa fa-angle-double-left"></span></a></li>','<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page - 1 ) %></a></li>',"<% } %>",'<li class="page-item active">','<a class="page-link" href="#folders/<%= id %>/page/<% print( show_page ) %>"><% print( show_page ) %></a>',"</li>","<% if ( ( show_page ) < page_count ) { %>",'<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page + 1 ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item"><a class="page-link" href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } else { %>",'<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( show_page  ) %>"><% print( show_page + 1 ) %></a></li>','<li class="page-item disabled"><a class="page-link" href="#folders/<%= id %>/page/<% print( page_count ) %>"><span class="fa fa-angle-double-right"></span></a></li>',"<% } %>","</ul>",'<span class="mr-1">',' <%- items_shown %> items shown <a href="" data-toggle="tooltip" data-placement="top" title="currently <%- folder_page_size %> per page" class="page-size-prompt">(change)</a>',"</span>",'<span class="mr-1">'," <%- total_items_count %> total","</span>"].join(""))},templateCollectionSelectModal:function(){return i.template(["<div>",'<div class="library-modal-item">',"<h4>Which datasets?</h4>",'<form class="form-inline">','<label class="radio-inline">','<input type="radio" name="radio_elements" id="selection_radio" value="selection" <% if (!selected_datasets) { %> disabled <% } else { %> checked <% } %> > current selection',"<% if (selected_datasets) { %>"," (<%- selected_datasets %>)","<% } %>","</label>",'<label class="radio-inline">','<input type="radio" name="radio_elements" id="folder_radio" value="folder" <% if (!selected_datasets) { %> checked <% } %> > all datasets in current folder',"</label>","</form>","</div>",'<div class="library-modal-item">',"<h4>Collection type</h4>",'<span class="library-collection-type-select"/>',"<h5>Which type to choose?</h5>","<ul>","<li>","List: Generic collection which groups any number of datasets into a set; similar to file system folder.","</li>","<li>","Paired: Simple collection containing exactly two sequence datasets; one reverse and the other forward.","</li>","<li>","List of Pairs: Advanced collection containing any number of Pairs; imagine as Pair-type collections inside of a List-type collection.","</li>","<li>","From Rules: Use Galaxy's rule builder to describe collections. This is more of an advanced feature that allows building any number of collections or any type.","</li>","</ul>","</div>",'<div class="library-modal-item">',"<h4>Select history</h4>",'<span class="library-collection-history-select"/>'," or create new: ",'<input type="text" name="history_name" value="" placeholder="name of the new history" />',"</div>","</div>"].join(""))}});e.default={FolderToolbarView:C}}).call(e,n(2),n(1),n(0),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),s=a(o),l=n(59),c=a(l),d=n(39),u=a(d),h=t.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(t){this.options=i.extend(this.options,t),this.options.id&&this.fetchLibrary()},fetchLibrary:function(t){this.options=i.extend(this.options,t),this.model=new c.default.Library({id:this.options.id});var e=this;this.model.fetch({success:function(){e.options.show_permissions&&e.showPermissions()},error:function(t,e){void 0!==e.responseJSON?s.default.error(e.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},showPermissions:function(t){this.options=i.extend(this.options,t),r(".tooltip").remove(),void 0!==this.options.fetched_permissions&&(0===this.options.fetched_permissions.access_library_role_list.length?this.model.set({is_unrestricted:!0}):this.model.set({is_unrestricted:!1}));var e=!1;Galaxy.user&&(e=Galaxy.user.isAdmin());var n=this.templateLibraryPermissions();this.$el.html(n({library:this.model,is_admin:e}));var a=this;r.get(Galaxy.root+"api/libraries/"+a.id+"/permissions?scope=current").done(function(t){a.prepareSelectBoxes({fetched_permissions:t})}).fail(function(){s.default.error("An error occurred while attempting to fetch library permissions.")}),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),r("#center").css("overflow","auto")},_serializeRoles:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n][1]+":"+t[n][0]);return e},prepareSelectBoxes:function(t){this.options=i.extend(this.options,t);var e=this.options.fetched_permissions,n=this,r=this._serializeRoles(e.access_library_role_list),a=this._serializeRoles(e.add_library_item_role_list),o=this._serializeRoles(e.manage_library_role_list),s=this._serializeRoles(e.modify_library_role_list);n.accessSelectObject=new u.default.View(this._createSelectOptions(this,"access_perm",r,!0)),n.addSelectObject=new u.default.View(this._createSelectOptions(this,"add_perm",a,!1)),n.manageSelectObject=new u.default.View(this._createSelectOptions(this,"manage_perm",o,!1)),n.modifySelectObject=new u.default.View(this._createSelectOptions(this,"modify_perm",s,!1))},_createSelectOptions:function(t,e,n,i){return i=!0===i&&i,{minimumInputLength:0,css:e,multiple:!0,placeholder:"Click to select a role",container:t.$el.find("#"+e),ajax:{url:Galaxy.root+"api/libraries/"+t.id+"/permissions?scope=available&is_library_access="+i,dataType:"json",quietMillis:100,data:function(t,e){return{q:t,page_limit:10,page:e}},results:function(t,e){var n=10*e<t.total;return{results:t.roles,more:n}}},formatResult:function(t){return t.name+" type: "+t.type},formatSelection:function(t){return t.name},initSelection:function(t,e){var n=[];r(t.val().split(",")).each(function(){var t=this.split(":");n.push({id:t[0],name:t[1]})}),e(n)},initialData:n,dropdownCssClass:"bigdrop"}},makeDatasetPrivate:function(){var t=this;r.post(Galaxy.root+"api/libraries/datasets/"+t.id+"/permissions?action=make_private").done(function(e){t.model.set({is_unrestricted:!1}),t.showPermissions({fetched_permissions:e}),s.default.success("The dataset is now private to you.")}).fail(function(){s.default.error("An error occurred while attempting to make dataset private.")})},removeDatasetRestrictions:function(){var t=this;r.post(Galaxy.root+"api/libraries/datasets/"+t.id+"/permissions?action=remove_restrictions").done(function(e){t.model.set({is_unrestricted:!0}),t.showPermissions({fetched_permissions:e}),s.default.success("Access to this dataset is now unrestricted.")}).fail(function(){s.default.error("An error occurred while attempting to make dataset unrestricted.")})},_extractIds:function(t){for(var e=[],n=t.length-1;n>=0;n--)e.push(t[n].id);return e},savePermissions:function(t){var e=this,n=this._extractIds(this.accessSelectObject.$el.select2("data")),i=this._extractIds(this.addSelectObject.$el.select2("data")),a=this._extractIds(this.manageSelectObject.$el.select2("data")),o=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/libraries/"+e.id+"/permissions?action=set_permissions",{"access_ids[]":n,"add_ids[]":i,"manage_ids[]":a,"modify_ids[]":o}).done(function(t){e.showPermissions({fetched_permissions:t}),s.default.success("Permissions saved.")}).fail(function(){s.default.error("An error occurred while attempting to set library permissions.")})},templateLibraryPermissions:function(){return i.template(['<div class="library_style_container">',"<div>",'<a href="#">','<button data-toggle="tooltip" data-placement="top" title="Go back to the list of Libraries" class="btn btn-secondary primary-button" type="button">','<span class="fa fa-list"/>',"&nbsp;Libraries","</button>","</a>","</div>","<h1>",'Library: <%= _.escape(library.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any library on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Library permissions</h2>","<h4>Roles that can access the library</h4>",'<div id="access_perm" class="access_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can access this library. If there are no access roles set on the library it is considered <strong>unrestricted</strong>.","</div>","<h4>Roles that can manage permissions on this library</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this library (includes giving access).","</div>","<h4>Roles that can add items to this library</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this library (folders and datasets).","</div>","<h4>Roles that can modify this library</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this library (name, synopsis, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications made on this page" class="btn btn-secondary toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}});e.default={LibraryView:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),s=a(o),l=n(59),c=a(l),d=n(39),u=a(d),h=t.View.extend({el:"#center",model:null,options:{},events:{"click .toolbtn_save_permissions":"savePermissions"},initialize:function(t){this.options=i.extend(this.options,t),this.options.id&&this.fetchFolder()},fetchFolder:function(t){this.options=i.extend(this.options,t),this.model=new c.default.FolderAsModel({id:this.options.id});var e=this;this.model.fetch({success:function(){e.options.show_permissions&&e.showPermissions()},error:function(t,e){void 0!==e.responseJSON?s.default.error(e.responseJSON.err_msg+" Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}}):s.default.error("An error occurred. Click this to go back.","",{onclick:function(){Galaxy.libraries.library_router.back()}})}})},showPermissions:function(t){this.options=i.extend(this.options,t),r(".tooltip").remove();var e=!1;Galaxy.user&&(e=Galaxy.user.isAdmin());var n=this.templateFolderPermissions();this.$el.html(n({folder:this.model,is_admin:e}));var a=this;r.get(Galaxy.root+"api/folders/"+a.id+"/permissions?scope=current").done(function(t){a.prepareSelectBoxes({fetched_permissions:t})}).fail(function(){s.default.error("An error occurred while attempting to fetch folder permissions.")}),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),r("#center").css("overflow","auto")},_serializeRoles:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n][1]+":"+t[n][0]);return e},prepareSelectBoxes:function(t){this.options=i.extend(this.options,t);var e=this.options.fetched_permissions,n=this,r=this._serializeRoles(e.add_library_item_role_list),a=this._serializeRoles(e.manage_folder_role_list),o=this._serializeRoles(e.modify_folder_role_list);n.addSelectObject=new u.default.View(this._createSelectOptions(this,"add_perm",r,!1)),n.manageSelectObject=new u.default.View(this._createSelectOptions(this,"manage_perm",a,!1)),n.modifySelectObject=new u.default.View(this._createSelectOptions(this,"modify_perm",o,!1))},_createSelectOptions:function(t,e,n){return{minimumInputLength:0,css:e,multiple:!0,placeholder:"Click to select a role",container:t.$el.find("#"+e),ajax:{url:Galaxy.root+"api/folders/"+t.id+"/permissions?scope=available",dataType:"json",quietMillis:100,data:function(t,e){return{q:t,page_limit:10,page:e}},results:function(t,e){var n=10*e<t.total;return{results:t.roles,more:n}}},formatResult:function(t){return t.name+" type: "+t.type},formatSelection:function(t){return t.name},initSelection:function(t,e){var n=[];r(t.val().split(",")).each(function(){var t=this.split(":");n.push({id:t[0],name:t[1]})}),e(n)},initialData:n.join(","),dropdownCssClass:"bigdrop"}},_extractIds:function(t){for(var e=[],n=t.length-1;n>=0;n--)e.push(t[n].id);return e},savePermissions:function(t){var e=this,n=this._extractIds(this.addSelectObject.$el.select2("data")),i=this._extractIds(this.manageSelectObject.$el.select2("data")),a=this._extractIds(this.modifySelectObject.$el.select2("data"));r.post(Galaxy.root+"api/folders/"+e.id+"/permissions?action=set_permissions",{"add_ids[]":n,"manage_ids[]":i,"modify_ids[]":a}).done(function(t){e.showPermissions({fetched_permissions:t}),s.default.success("Permissions saved.")}).fail(function(){s.default.error("An error occurred while attempting to set folder permissions.")})},templateFolderPermissions:function(){return i.template(['<div class="library_style_container">',"<div>",'<a href="#/folders/<%= folder.get("parent_id") %>">','<button data-toggle="tooltip" data-placement="top" title="Go back to the parent folder" class="btn btn-secondary primary-button" type="button">','<span class="fa fa-caret-left fa-lg"/>',"&nbsp;Parent folder","</button>","</a>","</div>","<h1>",'Folder: <%= _.escape(folder.get("name")) %>',"</h1>",'<div class="alert alert-warning">',"<% if (is_admin) { %>","You are logged in as an <strong>administrator</strong> therefore you can manage any folder on this Galaxy instance. Please make sure you understand the consequences.","<% } else { %>","You can assign any number of roles to any of the following permission types. However please read carefully the implications of such actions.","<% }%>","</div>",'<div class="dataset_table">',"<h2>Folder permissions</h2>","<h4>","Roles that can manage permissions on this folder","</h4>",'<div id="manage_perm" class="manage_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can manage permissions on this folder.","</div>","<h4>","Roles that can add items to this folder","</h4>",'<div id="add_perm" class="add_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can add items to this folder (folders and datasets).","</div>","<h4>","Roles that can modify this folder","</h4>",'<div id="modify_perm" class="modify_perm roles-selection"/>','<div class="alert alert-info roles-selection">',"User with <strong>any</strong> of these roles can modify this folder (name, etc.).","</div>",'<button data-toggle="tooltip" data-placement="top" title="Save modifications" class="btn btn-secondary toolbtn_save_permissions primary-button" type="button">','<span class="fa fa-floppy-o"/>',"&nbsp;Save","</button>","</div>","</div>"].join(""))}});e.default={FolderView:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(739),a=i(r),o=n(740),s=i(o),l=n(741),c=i(l),d=n(742),u=i(d),h=n(743),f=i(h),p=n(744),_=i(p),g=n(745),m=i(g),v=t.Router.extend({initialize:function(){this.routesHit=0,t.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"toolsheds",sheds:"toolsheds",queue:"queue",workflows:"workflows","status/r/:repositories":"status",status:"status","categories/s/:tool_shed":"categories","category/s/:tool_shed/c/:cateory_id":"repositories","repository/s/:tool_shed/r/:repository_id":"repository"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})}}),y=t.View.extend({app_config:{known_views:["toolsheds","queue","status","categories","repositories","repoository"]},initialize:function(){Galaxy.admintoolshedapp=this,this.admin_toolshed_router=new v,this.admin_toolshed_router.on("route:queue",function(){Galaxy.admintoolshedapp.adminRepoQueueView?Galaxy.admintoolshedapp.adminRepoQueueView.reDraw():Galaxy.admintoolshedapp.adminRepoQueueView=new f.default.RepoQueueView}),this.admin_toolshed_router.on("route:toolsheds",function(){Galaxy.admintoolshedapp.adminShedListView?Galaxy.admintoolshedapp.adminShedListView.reDraw():Galaxy.admintoolshedapp.adminShedListView=new a.default.ShedListView}),this.admin_toolshed_router.on("route:categories",function(t){Galaxy.admintoolshedapp.adminShedCategoriesView?Galaxy.admintoolshedapp.adminShedCategoriesView.reDraw({tool_shed:t.replace(/\//g,"%2f")}):Galaxy.admintoolshedapp.adminShedCategoriesView=new s.default.CategoryView({tool_shed:t.replace(/\//g,"%2f")})}),this.admin_toolshed_router.on("route:repositories",function(t,e){Galaxy.admintoolshedapp.adminShedCategoryView?Galaxy.admintoolshedapp.adminShedCategoryView.reDraw({tool_shed:t.replace(/\//g,"%2f"),category_id:e}):Galaxy.admintoolshedapp.adminShedCategoryView=new c.default.Category({tool_shed:t.replace(/\//g,"%2f"),category_id:e})}),this.admin_toolshed_router.on("route:repository",function(t,e){Galaxy.admintoolshedapp.adminRepositoryView?Galaxy.admintoolshedapp.adminRepositoryView.reDraw({tool_shed:t.replace(/\//g,"%2f"),repository_id:e}):Galaxy.admintoolshedapp.adminRepositoryView=new u.default.RepoDetails({tool_shed:t.replace(/\//g,"%2f"),repository_id:e})}),this.admin_toolshed_router.on("route:status",function(t){Galaxy.admintoolshedapp.adminRepoStatusView?Galaxy.admintoolshedapp.adminRepoStatusView.reDraw({repositories:t.split("|")}):Galaxy.admintoolshedapp.adminRepoStatusView=new _.default.RepoStatus({repositories:t.split("|")})}),this.admin_toolshed_router.on("route:workflows",function(){Galaxy.admintoolshedapp.adminWorkflowsView?Galaxy.admintoolshedapp.adminWorkflowsView.reDraw():Galaxy.admintoolshedapp.adminWorkflowsView=new m.default.Workflows}),t.history.start({pushState:!1})}});e.default={GalaxyApp:y}}).call(e,n(2))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(147),l=r(s),c=n(148),d=r(c),u=t.View.extend({defaults:{tool_sheds:[{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"}]},initialize:function(t){this.options=i.defaults(this.options||{},this.defaults),this.model=new l.default.ShedsCollection,this.listenTo(this.model,"sync",this.render),this.model.fetch()},el:"#center",render:function(t){this.options=i.defaults(this.options||{},t,this.defaults);var e=this.templateToolshedList;this.$el.html(e({title:(0,o.default)("Configured Galaxy Tool Sheds"),tool_sheds:this.model.models,queue:d.default.queueLength()}))},reDraw:function(t){this.$el.empty(),this.render(t)},templateToolshedList:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_toolsheds">','<div class="form-row">','<table class="grid">',"<% _.each(tool_sheds, function(shed) { %>",'<tr class="libraryTitle">',"<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a class="view-info shed-selector" href="#/categories/s/<%= shed.get("url") %>"><%= shed.get("name") %></a>',"</div>","</td>","</tr>","<% }); %>","</table>","</div>",'<div style="clear: both"></div>',"</div>"].join(""))});e.default={ShedListView:u}}).call(e,n(2),n(1))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(147),s=a(o),l=n(148),c=a(l);n(69);var d=t.View.extend({el:"#center",defaults:{tool_shed:"https://toolshed.g2.bx.psu.edu/"},initialize:function(t){var e=t.tool_shed.replace(/\//g,"%2f");this.options=i.defaults(this.options||t,this.defaults),this.model=new s.default.Categories,this.listenTo(this.model,"sync",this.render),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.model.tool_shed=e,this.model.fetch()},render:function(t){this.options=i.extend(this.options,t),this.options.categories=this.model.models,this.options.queue=c.default.queueLength();var e=this.templateCategoryList;this.$el.html(e(this.options)),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var e=this;r("#search_box").autocomplete({source:function(t,n){var i=e.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:t.term,tool_shed_url:i};r.post(a,o,function(t){console.log(t);var e=c.default.shedParser(t);n(e)})},minLength:3,select:function(n,i){var r=i.item.value,a=(Galaxy.root,e.model.tool_shed,"repository/s/"+e.model.tool_shed+"/r/"+r);t.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(t){this.$el.empty(),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.initialize(t)},templateCategoryList:i.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner" style="layout: inline;">Categories in <%= tool_shed.replace(/%2f/g, "/") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_categories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" name="search" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>","<th>Name</th>","<th>Description</th>","<th>Repositories</th>","</tr>","</thead>","<% _.each(categories, function(category) { %>","<tr>","<td>",'<a href="#/category/s/<%= tool_shed %>/c/<%= category.get("id") %>"><%= category.get("name") %></a>',"</td>",'<td><%= category.get("description") %></td>','<td><%= category.get("repositories") %></td>',"</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});e.default={CategoryView:d}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(147),s=a(o),l=n(148),c=a(l);n(69);var d=t.View.extend({el:"#center",initialize:function(t){this.model=new s.default.CategoryCollection,this.listenTo(this.model,"sync",this.render);var e=t.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+e+"&category_id="+t.category_id,this.model.tool_shed=e,this.model.category=t.category_id,this.model.fetch()},render:function(t){this.options=i.extend(this.options,t);var e=this.templateCategoryContents;this.$el.html(e({category:this.model.models[0],tool_shed:this.model.tool_shed,queue:c.default.queueLength()})),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var e=this;r("#search_box").autocomplete({source:function(t,n){var i=e.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:t.term,tool_shed_url:i};r.post(a,o,function(t){var e=c.default.shedParser(t);n(e)})},minLength:3,select:function(n,i){var r=i.item.value,a="repository/s/"+e.model.tool_shed+"/r/"+r;t.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(t){this.$el.empty(),this.initialize(t)},templateCategoryContents:i.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repositories in <%= category.get("name") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_repositories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" name="search" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>",'<th style="width: 10%;">Owner</th>','<th style="width: 15%;">Name</th>',"<th>Synopsis</th>",'<th style="width: 10%;">Type</th>',"</tr>","</thead>",'<% _.each(category.get("repositories"), function(repository) { %>',"<tr>","<td><%= repository.owner %></td>","<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a href="#/repository/s/<%= tool_shed %>/r/<%= repository.id %>"><%= repository.name %></a>',"</div>","</td>","<td><%= repository.description %></td>","<td><%= repository.type %></td>","</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});e.default={Category:d}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(147),s=a(o),l=n(412),c=(a(l),n(5)),d=a(c),u=n(17),h=a(u),f=n(26),p=a(f),_=n(148),g=a(_),m=t.View.extend({el:"#center",initialize:function(t){this.options=i.defaults(this.options||{},this.defaults),this.model=new s.default.RepositoryCollection,this.listenTo(this.model,"sync",this.render);var e=t.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+e+"&repository_id="+t.repository_id,this.model.tool_shed_url=t.tool_shed.replace(/%2f/g,"/"),this.model.tool_shed=e,this.model.category=t.repository_id,this.model.fetch()},render:function(t){var e=this.templateRepoDetails,n=this.model.models[0];this.options={repository:n.get("repository"),tool_shed:this.model.tool_shed,queue:g.default.queueLength()};var a=Object.keys(this.options.repository.metadata).sort(function(t,e){return parseInt(t.split(":")[0]-e.split(":")[0])}),o={},s=this.options.repository.metadata;a.forEach(function(t){o[t]=s[t]}),this.options.repository.metadata=o,this.options.current_changeset=this.options.current_changeset||a[a.length-1],this.options.current_metadata=this.options.repository.metadata[this.options.current_changeset],this.options.current_metadata.tool_shed_url=this.model.tool_shed_url,this.options.tools=this.options.current_metadata.tools,this.options.repository_dependencies_template=this.templateRepoDependencies,this.options.repository_dependency_template=this.templateRepoDependency,this.options.tps_template_global_select=this.templateGlobalSectionSelect,this.options.tps_template_tool_select=this.templateToolSectionSelect,this.options.tps_select_options=this.templatePanelSelectOptions,this.options.tool_dependencies=n.get("tool_dependencies"),this.options.shed_tool_conf=this.templateShedToolConf({shed_tool_confs:n.get("shed_conf")}),this.options.panel_section_dict=n.get("panel_section_dict"),this.options.api_url=Galaxy.root+"api/tool_shed_repositories/install?async=True",this.options=i.extend(this.options,t),this.$el.html(e(this.options)),this.checkInstalled(this.options.current_metadata),this.bindEvents(),r("#center").css("overflow","auto")},bindEvents:function(){var t=this;r("#changeset").on("change",function(){t.options.current_changeset=r("#changeset").find("option:selected").text(),t.options.current_metadata=t.options.repository.metadata[t.options.current_changeset],t.checkInstalled(t.options.current_metadata),t.reDraw(t.options)}),r("#tool_panel_section_select").on("change",function(){t.tpsSelection()}),r("#install_repository").on("click",function(e){r("#repository_installation");e.preventDefault();var n={};n.repositories=JSON.stringify([[r("#install_repository").attr("data-tsrid"),r("#changeset").find("option:selected").val()]]),n.tool_shed_repository_ids=JSON.stringify([r("#install_repository").attr("data-tsrid")]),n.tool_shed_url=t.model.tool_shed_url,n.install_tool_dependencies=r("#install_tool_dependencies").val(),n.install_repository_dependencies=r("#install_repository_dependencies").val(),n.install_resolver_dependencies=r("#install_resolver_dependencies").val();t.panelSelect(n);n.tool_panel_section=JSON.stringify(t.panelSelect(n)),n.shed_tool_conf=r("select[name='shed_tool_conf']").find("option:selected").val(),n.changeset=r("#changeset").find("option:selected").val();var i=r("#repository_installation").attr("action");t.prepareInstall(n,i)}),r("#queue_install").on("click",function(e){t.options.current_changeset=r("#changeset").find("option:selected").text(),t.options.current_metadata=t.options.repository.metadata[t.options.current_changeset];var n=(t.options.current_changeset,{});i.each(Object.keys(t.options.current_metadata),function(e){n[e]||(n[e]=t.options.current_metadata[e])}),n.install_tool_dependencies=r("#install_tool_dependencies").val(),n.install_repository_dependencies=r("#install_repository_dependencies").val(),n.install_resolver_dependencies=r("#install_resolver_dependencies").val(),n.tool_panel_section=JSON.stringify(t.panelSelect({})),n.shed_tool_conf=r("select[name='shed_tool_conf']").find("option:selected").val(),n.tool_shed_url=t.model.tool_shed_url,"/"==n.tool_shed_url.substr(-1)&&(n.tool_shed_url=n.tool_shed_url.substr(0,n.tool_shed_url.length-1)),g.default.addToQueue(n),t.checkInstalled(n)}),r(".tool_panel_section_picker").on("change",function(){r(this).find("option:selected").val()==r("#tool_panel_section_select").find("option:selected").val()?r(this).attr("default","active"):r(this).removeAttr("default")}),r(function(){r("#repository_dependencies").jstree()}),r(".tool_form").on("click",function(){var e=r(this).attr("data-guid"),n=(r(this).attr("data-clean"),r(this).attr("data-name")),i=r(this).attr("data-desc"),a=t.model.tool_shed_url,o=r("#repository_details").attr("data-tsrid"),s=r("#changeset").find("option:selected").val(),l=Galaxy.root+"api/tool_shed/tool_json",c={guid:e,tool_shed_url:a,tsr_id:o,changeset:s};r.get(l,c,function(t){t.cls="ui-portlet-plain";var e=new p.default(t);d.default.deepeach(t.inputs,function(t){t.type&&-1!=["data","data_collection"].indexOf(t.type)&&(t.type="hidden",t.info="Data input '"+t.name+"' ("+d.default.textify(t.extensions)+")")});var r=new h.default.View,a="<u>"+n+"</u> "+i;r.show({closing_events:!0,title:a,body:e.$el,buttons:{Close:function(){r.hide()}}})})})},checkInstalled:function(t){var e=this,n={name:t.name,owner:t.owner},i=!1;e.repoQueued(t);r.get(Galaxy.root+"api/tool_shed_repositories",n,function(n){for(var a=0;a<n.length;a++){var o=n[a],s=!o.deleted&&!o.uninstalled,l=o.changeset_revision==t.changeset_revision||o.installed_changeset_revision==t.changeset_revision;o.name==t.repository.name&&o.owner==t.repository.owner&&s&&l&&(i=!0),i?(r("#install_repository").prop("disabled",!0),r("#install_repository").val("This revision is already installed")):(r("#install_repository").prop("disabled",!1),r("#install_repository").val("Install this revision"))}e.repoQueued(t)||i?(r("#queue_install").hide(),r("#queue_install").val("This revision is already in the queue")):(r("#queue_install").show(),r("#queue_install").val("Install this revision later"))})},panelSelect:function(t){var e={};return r("#tool_panel_section_select").length?t.tool_panel_section_id=r("#tool_panel_section_select").find("option:selected").val():t.new_tool_panel_section=r("#new_tool_panel_section").val(),r(".tool_panel_section_picker").each(function(){var t=r(this).attr("name"),n=r(this).attr("data-toolguid");e[n]="tool_panel_section_id"===t?{tool_panel_section:r(this).find("option:selected").val(),action:"append"}:{tool_panel_section:r(this).val(),action:"create"}}),e},reDraw:function(t){this.$el.empty(),this.render(t)},repoQueued:function(t){var e=this;if(localStorage.repositories){var n,i=e.queueKey(t);return localStorage.repositories&&(n=JSON.parse(localStorage.repositories)),!(!n||!n.hasOwnProperty(i))}},queueKey:function(t){var e=this.model.tool_shed_url;return"/"==e.substr(-1)&&(e=e.substr(0,e.length-1)),e+"|"+t.repository_id+"|"+t.changeset_revision},tpsSelection:function(){new_tps=r("#tool_panel_section_select").find("option:selected").val(),r('.tool_panel_section_picker[default="active"]').each(function(){r(this).val(new_tps)})},prepareInstall:function(t,e){var n=this;r.post(e,t,function(t){var e=JSON.parse(t);n.doInstall(e)})},doInstall:function(e){var n=Galaxy.root+"admin_toolshed/install_repositories",i=e.repositories,a="status/r/"+i.join("|");r.post(n,e,function(t){console.log("Initializing repository installation succeeded")}),t.history.navigate(a,{trigger:!0,replace:!0})},templateRepoDetails:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repository information for <strong><%= repository.name %></strong> from <strong><%= repository.owner %></strong></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="repository_details" data-tsrid="<%= repository.id %>">','<form id="repository_installation" name="install_repository" method="post" action="<%= api_url %>">','<input type="hidden" id="repositories" name="<%= repository.id %>" value="ID" />','<input type="hidden" id="tool_shed_url" name="tool_shed_url" value="<%= tool_shed %>" />','<div class="toolForm">','<div class="toolFormTitle">Changeset</div>','<div class="toolFormBody changeset">','<select id="changeset" name="changeset" style="margin: 5px;">',"<% _.each(Object.keys(repository.metadata), function(changeset) { %>",'<% if (changeset == current_changeset) { var selected = "selected "; } else { var selected = ""; } %>','<option <%= selected %>value="<%= changeset.split(":")[1] %>"><%= changeset %></option>',"<% }); %>","</select>",'<input class="btn btn-primary preview-button" data-tsrid="<%= current_metadata.repository.id %>" type="submit" id="install_repository" name="install_repository" value="Install this revision now" />','<input class="btn btn-primary preview-button" type="button" id="queue_install" name="queue_install" value="Install this revision later" />','<div class="toolParamHelp" style="clear: both;">Please select a revision and review the settings below before installing.</div>',"</div>","</div>","<%= shed_tool_conf %>","<% if (current_metadata.has_repository_dependencies) { %>",'<div class="toolFormTitle">Repository dependencies for <strong id="current_changeset"><%= current_changeset %></strong></div>','<div class="toolFormBody">','<p id="install_repository_dependencies_checkbox">','<input type="checkbox" checked id="install_repository_dependencies" />','<label for="install_repository_dependencies">Install repository dependencies</label>',"</p>","<% current_metadata.repository_dependency_template = repository_dependency_template; %>",'<div class="tables container-table" id="repository_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="repository_dependencies_table">',"Repository dependencies &ndash; <em>installation of these additional repositories is required</em>","</a>","</div>","<%= repository_dependencies_template(current_metadata) %>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tool_dependencies) { %>",'<div class="toolFormTitle">Tool dependencies</div>','<div class="toolFormBody">','<p id="install_resolver_dependencies_checkbox">','<input type="checkbox" checked id="install_resolver_dependencies" />','<label for="install_resolver_dependencies">Install resolver dependencies</label>',"</p>",'<p id="install_tool_dependencies_checkbox">','<input type="checkbox" checked id="install_tool_dependencies" />','<label for="install_tool_dependencies">Install tool dependencies</label>',"</p>",'<div class="tables container-table" id="tool_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="tool_dependencies_table">',"Tool dependencies &ndash; <em>repository tools require handling of these dependencies</em>","</a>","</div>",'<table class="tables container-table" id="tool_dependencies_table" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Version</th>","<th>Type</th>","</tr>","</thead>",'<tbody id="tool_deps">',"<% _.each(tool_dependencies[current_changeset], function(dependency) { %>",'<tr class="datasetRow tool_dependency_row" style="display: table-row;">','<td style="padding-left: 40px;">',"<%= dependency.name %></td>","<td><%= dependency.version %></td>","<td><%= dependency.type %></td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tools_for_display_in_tool_panel) { %>",'<div class="toolFormTitle">Tools &ndash; <em>click the name to preview the tool and use the pop-up menu to inspect all metadata</em></div>','<div class="toolFormBody">','<div class="tables container-table" id="tools_toggle">','<table class="tables container-table" id="valid_tools" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Description</th>","<th>Version</th>","<th><%= tps_template_global_select({tps: panel_section_dict, tps_select_options: tps_select_options}) %></tr>","</thead>",'<tbody id="tools_in_repo">',"<% _.each(current_metadata.tools, function(tool) { %>",'<tr id="libraryItem-<%= tool.clean %>" class="tool_row" style="display: table-row;" style="width: 15%">','<td style="padding-left: 40px;">','<div id="tool-<%= tool.clean %>" class="menubutton split popup" style="float: left;">','<a class="tool_form view-info" data-toggle="modal" data-target="toolform_<%= tool.clean %>" data-clean="<%= tool.clean %>" data-guid="<%= tool.guid %>" data-name="<%= tool.name %>" data-desc="<%= tool.description %>"><%= tool.name %></a>',"</div>","</td>","<td><%= tool.description %></td>",'<td style="width: 15%"><%= tool.version %></td>','<td style="width: 35%" id="tool_tps_<%= tool.clean %>">',"<%= tps_template_tool_select({tool: tool, tps: panel_section_dict, tps_select_options: tps_select_options}) %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","</form>","</div>"].join("")),templateRepoDependencies:i.template(['<div class="toolFormTitle">Repository Dependencies</div>','<div class="toolFormBody tables container-table" id="repository_dependencies">',"<ul>","<li>Repository installation requires the following","<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","<% } %>","</li>","</ul>","</div>"].join("")),templateRepoDependency:i.template(['<li id="metadata_<%= id %>" class="datasetRow repository_dependency_row">',"Repository <b><%= repository.name %></b> revision <b><%= changeset_revision %></b> owned by <b><%= repository.owner %></b>","<% if (has_repository_dependencies) { %>",'<ul class="child_dependencies">',"<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","</ul>","<% } %>","</li>"].join("")),templateShedToolConf:i.template(['<div class="toolFormTitle">Shed tool configuration file:</div>','<div class="toolFormBody">','<div class="form-row">','<select name="shed_tool_conf">',"<% _.each(shed_tool_confs.options, function(conf) { %>",'<option value="<%= conf.value %>"><%= conf.label %></option>',"<% }); %>","</select>",'<div class="toolParamHelp" style="clear: both;">Select the file whose <b>tool_path</b> setting you want used for installing repositories.</div>',"</div>","</div>"].join("")),templateToolDependency:i.template(["<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% if (dependency.includes_tool_dependencies) { %>","<% dependency.tool_dependency_template = tool_dependency_template %>","<%= tool_dependency_template(dependency) %>","<% } %>","<% }); %>","<% } %>"].join("")),templateGlobalSectionCreate:i.template(['<div id="tool_panel_section">','<div class="form-row" id="new_tps">','<input id="new_tool_panel_section" name="new_tool_panel_section" type="textfield" value="" size="40"/>','<input class="btn btn-primary" type="button" id="select_existing" value="Select existing" />','<div class="toolParamHelp" style="clear: both;">',"Add a new tool panel section to contain the installed tools (optional).","</div>","</div>","</div>"].join("")),templateGlobalSectionSelect:i.template(['<div id="tool_panel_section">','<div class="toolFormTitle">Tool Panel Section</div>','<div class="toolFormBody">','<div class="tab-pane" id="select_tps">','<select name="<%= name %>" id="<%= tps.id %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input class="btn btn-primary" type="button" id="create_new" value="Create new" />','<div class="toolParamHelp" style="clear: both;">',"Select an existing tool panel section to contain the installed tools (optional).","</div>","</div>","</div>","</div>"].join("")),templateToolSectionCreate:i.template(['<div id="new_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="form-row">','<input data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" size="40" name="new_tool_panel_section" id="new_tool_panel_section_<%= tool.clean %>" type="text">','<input id="per_tool_select_<%= tool.clean %>" class="btn btn-primary" data-toolguid="<%= tool.guid %>" value="Select existing" id="select_existing_<%= tool.clean %>" type="button">',"</div>"].join("")),templateToolSectionSelect:i.template(['<div id="select_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="tps_creator">','<select default="active" style="width: 30em;" data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" name="tool_panel_section_id" id="tool_panel_section_select_<%= tool.clean %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input id="per_tool_create_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="btn btn-primary create-tps-button" data-toolguid="<%= tool.guid %>" value="Create new" id="create_new_<%= tool.clean %>" type="button">','<div style="clear: both;" class="toolParamHelp"></div>',"</div>"].join("")),templatePanelSelectOptions:i.template(["<% _.each(sections, function(section) { %>",'<option value="<%= section.id %>"><%= section.name %></option>',"<% }); %>"].join(""))});e.default={RepoDetails:m}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(147),c=a(l),d=n(148),u=a(d),h=t.View.extend({el:"#center",defaults:[{}],initialize:function(t){var e=this;this.model=new c.default.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),e.render()},render:function(t){var e=this,n=e.templateRepoQueue,r=e.model.models;e.$el.html(n({title:(0,s.default)("Repository Installation Queue"),repositories:r,queue:u.default.queueLength()})),i("#center").css("overflow","auto"),e.bindEvents()},bindEvents:function(){var e=this;i(".install_one").on("click",function(){var t=e.loadFromQueue(i(this).attr("data-repokey"));e.installFromQueue(t,i(this).attr("data-repokey"))}),i(".remove_one").on("click",function(){var t=i(this).attr("data-repokey"),e=JSON.parse(localStorage.repositories);if(e.hasOwnProperty(t)){var n=e[t].repository.id;delete e[t],i("#queued_repository_"+n).remove()}localStorage.repositories=JSON.stringify(e)}),i("#clear_queue").on("click",function(){localStorage.repositories="{}"}),i("#from_workflow").on("click",function(){t.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(e,n){var r=Object();r.install_tool_dependencies=e.install_tool_dependencies,r.install_repository_dependencies=e.install_repository_dependencies,r.install_resolver_dependencies=e.install_resolver_dependencies,r.tool_panel_section=e.tool_panel_section,r.shed_tool_conf=e.shed_tool_conf,r.repositories=JSON.stringify([[e.repository.id,e.changeset_revision]]),r.tool_shed_repository_ids=JSON.stringify([e.repository.id]),r.tool_shed_url=n.split("|")[0],r.changeset=e.changeset_revision;var a=Galaxy.root+"api/tool_shed_repositories/install?async=True";if(i("#queued_repository_"+e.repository.id).remove(),localStorage.repositories){void 0===n&&(n=u.default.queueKey(e));var o=JSON.parse(localStorage.repositories);o.hasOwnProperty(n)&&(delete o[n],localStorage.repositories=JSON.stringify(o))}i.post(a,r,function(e){var n=JSON.parse(e),r=n.repositories,a="status/r/"+r.join("|");i.post(Galaxy.root+"admin_toolshed/install_repositories",n,function(t){console.log("Initializing repository installation succeeded")}),t.history.navigate(a,{trigger:!0,replace:!0})})},loadFromQueue:function(t){var e=JSON.parse(localStorage.repositories);if(e.hasOwnProperty(t))return e[t]},reDraw:function(t){this.$el.empty(),this.initialize(t),this.model.fetch(),this.render(t)},templateRepoQueue:r.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))});e.default={RepoQueueView:h}}).call(e,n(2),n(0),n(1))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(147),c=a(l),d=n(148),u=a(d),h=t.View.extend({el:"#center",initialize:function(t){this.options=i.defaults(this.options||[{}],t,this.defaults),this.model=new c.default.RepoStatus,this.listenTo(this.model,"sync",this.render),this.model.url+="?repositories="+this.options.repositories.join("|"),this.model.fetch(),this.timer=setInterval(function(t){var e=["installed","error"],n=!0;i.some(t.model.models,function(t){repo_id=t.get("id");var i=t.get("status").toLowerCase();if(-1===e.indexOf(i))return n=!1,!0}),n?clearInterval(t.timer):t.model.fetch()},2e3,this)},close:function(){clearInterval(this.timer)},render:function(t){this.options=i.extend(this.options,t);var e=this.templateRepoStatus;this.$el.html(e({title:(0,s.default)("Repository Status"),repositories:this.model.models,queue:u.default.queueLength()})),r("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){},reDraw:function(t){this.$el.empty(),this.initialize(t)},templateRepoStatus:i.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".state-color-new,",".state-color-deactivated,",".state-color-uninstalled { border-color:#bfbfbf; background:#eee }",".state-color-cloning,",".state-color-setting-tool-versions,",".state-color-installing-repository-dependencies,",".state-color-installing-tool-dependencies,",".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }",".state-color-installed { border-color:#20b520; background:#b0f1b0 }",".state-color-error { border-color:#dd1b15; background:#f9c7c5 }","</style>",'<table id="grid-table" class="grid">','<thead id="grid-table-header">',"<tr>",'<th id="null-header">Name<span class="sort-arrow"></span></th>','<th id="null-header">Description<span class="sort-arrow"></span></th>','<th id="null-header">Owner<span class="sort-arrow"></span></th>','<th id="null-header">Revision<span class="sort-arrow"></span></th>','<th id="null-header">Installation Status<span class="sort-arrow"></span></th>',"</tr>","</thead>",'<tbody id="grid-table-body">',"<% _.each(repositories, function(repository) { %>","<tr>","<td>",'<div id="" class="">','<label id="repo-name-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("name") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-desc-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("description") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-user-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("owner") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-changeset-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("changeset_revision") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="RepositoryStatus-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<div class="repo-status count-box state-color-<%= repository.get("status").toLowerCase().replace(/ /g, "-") %>" id="RepositoryStatus-<%= repository.get("id") %>">','<%= repository.get("status") %>',"</div>","</label>","</div>","</td>","</tr>","<% }); %>","</tbody>",'<tfoot id="grid-table-footer"></tfoot>',"</table>"].join(""))});e.default={RepoStatus:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(147),c=a(l),d=n(148),u=a(d),h=t.View.extend({el:"#center",defaults:[{}],initialize:function(t){var e=this;this.model=new c.default.WorkflowTools,this.listenTo(this.model,"sync",this.render),this.model.fetch(),e.render()},render:function(t){var e=this,n=e.templateWorkflows,r=e.model.models;e.$el.html(n({title:(0,s.default)("Workflows Missing Tools"),workflows:r,queue:u.default.queueLength()})),i("#center").css("overflow","auto"),e.bindEvents()},bindEvents:function(){var e,n=this;i(".show_wf_repo").on("click",function(){var n=i(this).attr("data-toolids"),r=i(this).attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:n};i.get(a,o,function(n){e=n.repository.id;var i="repository/s/"+r.replace(/:/g,"%3a").replace(/\//g,"%2f")+"/r/"+n.repository.id;t.history.navigate(i,{trigger:!0,replace:!0})})}),i(".queue_wf_repo").on("click",function(){var t=i(this),n=t.attr("data-toolids"),r=t.attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:n};i.get(a,o,function(n){e=n.repository.id,o={tool_shed_url:r,repository_id:e},i.get(a,o,function(e){var n=Object.keys(e.repository.metadata),i=n[0],a=e.repository.metadata[i];a.tool_shed_url=r,u.default.addToQueue(a),t.remove()})})}),i("#from_workflow").on("click",n.loadWorkflows)},reDraw:function(t){this.$el.empty(),this.initialize(t)},templateWorkflows:r.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }","</style>",'<table id="workflows_missing_tools" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Workflows</th>','<th class="datasetRow">Tool IDs</th>','<th class="datasetRow">Shed</th>','<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Actions</th>',"</tr>","</thead>","<tbody>","<% _.each(workflows, function(workflow) { %>","<tr>",'<td class="datasetRow">','<ul class="workflow_names">','<% _.each(workflow.get("workflows"), function(name) { %>','<li class="workflow_names"><%= name %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow">','<ul class="workflow_tools">','<% _.each(workflow.get("tools"), function(tool) { %>','<li class="workflow_tools"><%= tool %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow"><%= workflow.get("shed") %></td>','<td class="datasetRow"><%= workflow.get("repository") %></td>','<td class="datasetRow"><%= workflow.get("owner") %></td>','<td class="datasetRow">','<ul class="workflow_tools">','<li class="workflow_tools">','<input type="button" class="show_wf_repo btn btn-primary" data-shed="<%= workflow.get("shed") %>" data-owner="<%= workflow.get("owner") %>" data-repo="<%= workflow.get("repository") %>" data-toolids="<%= workflow.get("tools").join(",") %>" value="Show Repository" /></li>',"</ul>","</td>","</tr>","<% }); %>","</ul>","</div>"].join(""))});e.default={Workflows:h}}).call(e,n(2),n(0),n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}function r(t){var e,n,i,r;switch(t){case h.ITEM_HISTORY:e="History",n="Histories",i="history",r="History";break;case h.ITEM_DATASET:e="Dataset",n="Datasets",i="dataset",r="HistoryDatasetAssociation";break;case h.ITEM_WORKFLOW:e="Workflow",n="Workflows",i="workflow",r="StoredWorkflow";break;case h.ITEM_PAGE:e="Page",n="Pages",i="page",r="Page";break;case h.ITEM_VISUALIZATION:e="Visualization",n="Visualizations",i="visualization",r="Visualization"}var a="list_"+n.toLowerCase()+"_for_selection";return{singular:e,plural:n,controller:i,iclass:r,list_ajax_url:list_objects_url.replace("LIST_ACTION",a)}}function a(e,n,i){var r=set_accessible_url.replace("ITEM_CONTROLLER",e);t.ajax({type:"POST",url:r,data:{id:n,accessible:"True"},error:function(){alert("Making "+i+" accessible failed")}})}function o(){t(document).ajaxError(function(t,e){var n=e.responseText||e.statusText||"Could not connect to server";return show_modal("Server error",n,{"Ignore error":hide_modal}),!1}),t("[name=page_content]").wymeditor({skin:"galaxy",basePath:editor_base_path,iframeBasePath:iframe_base_path,boxHtml:"<table class='wym_box' width='100%' height='100%'><tr><td><div class='wym_area_top'>"+u.TOOLS+"</div></td></tr><tr height='100%'><td><div class='wym_area_main' style='height: 100%;'>"+u.IFRAME+u.STATUS+"</div></div></td></tr></table>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:(0,l.default)("Superscript"),css:"wym_tools_superscript"},{name:"Subscript",title:(0,l.default)("Subscript"),css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"}]});var e=t.wymeditors(0),n=function(n){show_modal("Saving page","progress"),t.ajax({url:save_url,type:"POST",data:{id:page_id,content:e.xhtml(),annotations:JSON.stringify(new Object),_:"true"},success:function(){n()}})};t("#save-button").click(function(){n(function(){hide_modal()})}),t("#close-button").click(function(){window.document.location=page_list_url});var i=t("<div class='galaxy-page-editor-button'><a id='insert-galaxy-link' class='action-button popup' href='#'>Paragraph type</a></div>");t(".wym_area_top").append(i);var r={};t.each(e._options.containersItems,function(t,n){var i=n.name;r[n.title.replace("_"," ")]=function(){e.container(i)}}),make_popupmenu(i,r);var a=t("<div><a id='insert-galaxy-link' class='action-button popup' href='#'>Insert Link to Galaxy Object</a></div>").addClass("galaxy-page-editor-button");t(".wym_area_top").append(a),make_popupmenu(a,{"Insert History Link":function(){e.dialog(h.DIALOG_HISTORY_LINK)},"Insert Dataset Link":function(){e.dialog(h.DIALOG_DATASET_LINK)},"Insert Workflow Link":function(){e.dialog(h.DIALOG_WORKFLOW_LINK)},"Insert Page Link":function(){e.dialog(h.DIALOG_PAGE_LINK)},"Insert Visualization Link":function(){e.dialog(h.DIALOG_VISUALIZATION_LINK)}});var o=t("<div><a id='embed-galaxy-object' class='action-button popup' href='#'>Embed Galaxy Object</a></div>").addClass("galaxy-page-editor-button");t(".wym_area_top").append(o),make_popupmenu(o,{"Embed History":function(){e.dialog(h.DIALOG_EMBED_HISTORY)},"Embed Dataset":function(){e.dialog(h.DIALOG_EMBED_DATASET)},"Embed Workflow":function(){e.dialog(h.DIALOG_EMBED_WORKFLOW)},"Embed Visualization":function(){e.dialog(h.DIALOG_EMBED_VISUALIZATION)}})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var s=n(3),l=i(s);n(149),n(226),n(747),n(225);var c=n(24),d=i(c),u=window.WYMeditor,h={ITEM_HISTORY:"item_history",ITEM_DATASET:"item_dataset",ITEM_WORKFLOW:"item_workflow",ITEM_PAGE:"item_page",ITEM_VISUALIZATION:"item_visualization",DIALOG_HISTORY_LINK:"link_history",DIALOG_DATASET_LINK:"link_dataset",DIALOG_WORKFLOW_LINK:"link_workflow",DIALOG_PAGE_LINK:"link_page",DIALOG_VISUALIZATION_LINK:"link_visualization",DIALOG_EMBED_HISTORY:"embed_history",DIALOG_EMBED_DATASET:"embed_dataset",DIALOG_EMBED_WORKFLOW:"embed_workflow",DIALOG_EMBED_PAGE:"embed_page",DIALOG_EMBED_VISUALIZATION:"embed_visualization"};u.editor.prototype.dialog=function(e,n,i){function o(){t("#set_link_id").click(function(){t("#link_attribute_label").text("ID/Name");var e=t(".wym_href");e.addClass("wym_id").removeClass("wym_href"),c&&e.val(t(c).attr("id")),t(this).remove()})}var s=this,l=s.uniqueStamp(),c=s.selected();if(e==u.DIALOG_LINK){c&&(t(s._options.hrefSelector).val(t(c).attr(u.HREF)),t(s._options.srcSelector).val(t(c).attr(u.SRC)),t(s._options.titleSelector).val(t(c).attr(u.TITLE)),t(s._options.altSelector).val(t(c).attr(u.ALT)));var f,p;c&&(f=t(c).attr("href"),void 0==f&&(f=""),void 0==(p=t(c).attr("title"))&&(p="")),show_modal("Create Link","<div><div><label id='link_attribute_label'>URL <span style='float: right; font-size: 90%'><a href='#' id='set_link_id'>Create in-page anchor</a></span></label><br><input type='text' class='wym_href' value='"+f+"' size='40' /></div><div><label>Title</label><br><input type='text' class='wym_title' value='"+p+"' size='40' /></div><div>",{"Make link":function(){var e=t(s._options.hrefSelector).val()||"",n=t(".wym_id").val()||"",i=t(s._options.titleSelector).val()||"";if(e||n){s._exec(u.CREATE_LINK,l);var r=t("a[href="+l+"]",s._doc.body);r.attr(u.HREF,e).attr(u.TITLE,i).attr("id",n),0===r.text().indexOf("wym-")&&r.text(i)}hide_modal()},Cancel:function(){hide_modal()}},{},o)}if(e==u.DIALOG_IMAGE)return s._selected_image&&(t(s._options.dialogImageSelector+" "+s._options.srcSelector).val(t(s._selected_image).attr(u.SRC)),t(s._options.dialogImageSelector+" "+s._options.titleSelector).val(t(s._selected_image).attr(u.TITLE)),t(s._options.dialogImageSelector+" "+s._options.altSelector).val(t(s._selected_image).attr(u.ALT))),void show_modal("Image","<div class='row'><label>URL</label><br><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>Alt text</label><br><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>Title</label><br><input type='text' class='wym_title' value='' size='40' /></div>",{Insert:function(){var e=t(s._options.srcSelector).val();e.length>0&&(s._exec(u.INSERT_IMAGE,l),t("img[src$="+l+"]",s._doc.body).attr(u.SRC,e).attr(u.TITLE,t(s._options.titleSelector).val()).attr(u.ALT,t(s._options.altSelector).val())),hide_modal()},Cancel:function(){hide_modal()}});if(e==u.DIALOG_TABLE&&show_modal("Table","<div class='row'><label>Caption</label><br><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>Summary</label><br><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>Number Of Rows<br></label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>Number Of Cols<br></label><input type='text' class='wym_cols' value='2' size='3' /></div>",{Insert:function(){var e=t(s._options.rowsSelector).val(),n=t(s._options.colsSelector).val();if(e>0&&n>0){var i=s._doc.createElement(u.TABLE),r=null,a=t(s._options.captionSelector).val();i.createCaption().innerHTML=a;for(var o=0;o<e;o++){r=i.insertRow(o);for(var l=0;l<n;l++)r.insertCell(l)}t(i).attr("summary",t(s._options.summarySelector).val());var c=t(s.findUp(s.container(),u.MAIN_CONTAINERS)).get(0);c&&c.parentNode?t(c).after(i):t(s._doc.body).append(i)}hide_modal()},Cancel:function(){hide_modal()}}),e==h.DIALOG_HISTORY_LINK||e==h.DIALOG_DATASET_LINK||e==h.DIALOG_WORKFLOW_LINK||e==h.DIALOG_PAGE_LINK||e==h.DIALOG_VISUALIZATION_LINK){var _;switch(e){case h.DIALOG_HISTORY_LINK:_=r(h.ITEM_HISTORY);break;case h.DIALOG_DATASET_LINK:_=r(h.ITEM_DATASET);break;case h.DIALOG_WORKFLOW_LINK:_=r(h.ITEM_WORKFLOW);break;case h.DIALOG_PAGE_LINK:_=r(h.ITEM_PAGE);break;case h.DIALOG_VISUALIZATION_LINK:_=r(h.ITEM_VISUALIZATION)}var g=new d.default({url_base:_.list_ajax_url,embedded:!0});Galaxy.modal.show({title:"Insert Link to "+_.singular,body:t("<div/>").append(g.$el).append(t("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected "+_.plural.toLowerCase()+" accessible so that they can viewed by everyone.")),closing_events:!0,buttons:{Insert:function(){var e=!1;null!=t("#make-importable:checked").val()&&(e=!0);new Array;g.$("input[name=id]:checked").each(function(){var n=t(this).val();e&&a(_.controller,n,_.singular);var i=get_name_and_link_url+n,r=i.replace("ITEM_CONTROLLER",_.controller);t.getJSON(r,function(e){s._exec(u.CREATE_LINK,l);var i=t("a[href="+l+"]",s._doc.body).text();""==i||i==l?s.insert("<a href='"+e.link+"'>"+_.singular+" '"+e.name+"'</a>"):t("a[href="+l+"]",s._doc.body).attr(u.HREF,e.link).attr(u.TITLE,_.singular+n)})}),Galaxy.modal.hide()},Close:function(){Galaxy.modal.hide()}}})}if(e==h.DIALOG_EMBED_HISTORY||e==h.DIALOG_EMBED_DATASET||e==h.DIALOG_EMBED_WORKFLOW||e==h.DIALOG_EMBED_PAGE||e==h.DIALOG_EMBED_VISUALIZATION){var _;switch(e){case h.DIALOG_EMBED_HISTORY:_=r(h.ITEM_HISTORY);break;case h.DIALOG_EMBED_DATASET:_=r(h.ITEM_DATASET);break;case h.DIALOG_EMBED_WORKFLOW:_=r(h.ITEM_WORKFLOW);break;case h.DIALOG_EMBED_PAGE:_=r(h.ITEM_PAGE);break;case h.DIALOG_EMBED_VISUALIZATION:_=r(h.ITEM_VISUALIZATION)}var g=new d.default({url_base:_.list_ajax_url,embedded:!0});Galaxy.modal.show({title:"Insert Link to "+_.singular,body:t("<div/>").append(g.$el).append(t("<div/>").append('<input id="make-importable" type="checkbox" checked/>').append("Make the selected "+_.plural.toLowerCase()+" accessible so that they can viewed by everyone.")),closing_events:!0,buttons:{Embed:function(){var e=!1;null!=t("#make-importable:checked").val()&&(e=!0),g.$("input[name=id]:checked").each(function(){var n=t(this).val(),i=t("label[for='"+n+"']:first").text();e&&a(_.controller,n,_.singular);var r=_.iclass+"-"+n,o=["<div id='",r,"' class='embedded-item ",_.singular.toLowerCase()," placeholder'>","<p class='title'>","Embedded Galaxy ",_.singular," '",i,"'","</p>","<p class='content'>","[Do not edit this block; Galaxy will fill it in with the annotated ",_.singular.toLowerCase()," when it is displayed.]","</p>","</div>"].join("");s.insert(o)}),Galaxy.modal.hide()},Close:function(){Galaxy.modal.hide()}}})}}}).call(e,n(0))},function(module,exports,__webpack_require__){(function(jQuery,$){if(!WYMeditor)var WYMeditor={};!function(){if(window.console&&console.firebug)WYMeditor.console=window.console;else{var t=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];WYMeditor.console={};for(var e=0;e<t.length;++e)WYMeditor.console[t[e]]=function(){}}}(),jQuery.extend(WYMeditor,{VERSION:"0.5-rc1",INSTANCES:[],STRINGS:[],SKINS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",CSS_PATH:"{Wym_Css_Path}",WYM_PATH:"{Wym_Wym_Path}",SKINS_DEFAULT_PATH:"skins/",SKINS_DEFAULT_CSS:"skin.css",SKINS_DEFAULT_JS:"skin.js",LANG_DEFAULT_PATH:"lang/",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",ALT:"alt",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:new Array("p","h1","h2","h3","h4","h5","h6","pre","blockquote"),BLOCKS:new Array("address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr"),KEY:{BACKSPACE:8,ENTER:13,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,CURSOR:new Array(37,38,39,40),DELETE:46},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(t,e){this._index=WYMeditor.INSTANCES.push(this)-1,this._element=t,this._options=e,this._html=jQuery(t).val(),this._options.html&&(this._html=this._options.html),this._options.basePath=this._options.basePath||this.computeBasePath(),this._options.skinPath=this._options.skinPath||this._options.basePath+WYMeditor.SKINS_DEFAULT_PATH+this._options.skin+"/",this._options.wymPath=this._options.wymPath||this.computeWymPath(),this._options.langPath=this._options.langPath||this._options.basePath+WYMeditor.LANG_DEFAULT_PATH,this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT,this._options.jQueryPath=this._options.jQueryPath||this.computeJqueryPath(),this.init()}}),jQuery.fn.wymeditor=function(t){return t=jQuery.extend({html:"",basePath:!1,skinPath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,styles:!1,stylesheet:!1,skin:"default",initSkin:!0,loadSkin:!0,lang:"en",direction:"ltr",boxHtml:"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div><div class='wym_area_left'></div><div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div><div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div><div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div></div>",logoHtml:"<a class='wym_wymeditor_link' href='http://www.wymeditor.org/'>WYMeditor</a>",iframeHtml:"<div class='wym_iframe wym_section'><iframe src='/page/get_editor_iframe' onload='this.contentWindow.parent.WYMeditor.INSTANCES["+WYMeditor.INDEX+"].initIframe(this)'></iframe></div>",editorStyles:[],toolsHtml:"<div class='wym_tools wym_section'><h2>{Tools}</h2><ul>"+WYMeditor.TOOLS_ITEMS+"</ul></div>",toolsItemHtml:"<li class='"+WYMeditor.TOOL_CLASS+"'><a href='#' name='"+WYMeditor.TOOL_NAME+"' title='"+WYMeditor.TOOL_TITLE+"'>"+WYMeditor.TOOL_TITLE+"</a></li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:"<div class='wym_containers wym_section'><h2>{Containers}</h2><ul>"+WYMeditor.CONTAINERS_ITEMS+"</ul></div>",containersItemHtml:"<li class='"+WYMeditor.CONTAINER_CLASS+"'><a href='#' name='"+WYMeditor.CONTAINER_NAME+"'>"+WYMeditor.CONTAINER_TITLE+"</a></li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:"<div class='wym_classes wym_section'><h2>{Classes}</h2><ul>"+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:"<li><a href='#' name='"+WYMeditor.CLASS_NAME+"'>"+WYMeditor.CLASS_TITLE+"</a></li>",classesItems:[],statusHtml:"<div class='wym_status wym_section'><h2>{Status}</h2></div>",htmlHtml:"<div class='wym_html wym_section'><h2>{Source_Code}</h2><textarea class='wym_html_val'></textarea></div>",boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",altSelector:".wym_alt",textSelector:".wym_text",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",submitSelector:".wym_submit",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:"menubar=no,titlebar=no,toolbar=no,resizable=no,width=560,height=300,top=0,left=0",dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:"<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'><html dir='"+WYMeditor.DIRECTION+"'><head><link rel='stylesheet' type='text/css' media='screen' href='"+WYMeditor.CSS_PATH+"' /><title>"+WYMeditor.DIALOG_TITLE+"</title><script type='text/javascript' src='"+WYMeditor.JQUERY_PATH+"'><\/script><script type='text/javascript' src='"+WYMeditor.WYM_PATH+"'><\/script></head>"+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:"<body class='wym_dialog wym_dialog_link' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><fieldset><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_LINK+"' /><legend>{Link}</legend><div class='row'><label>{URL}</label><input type='text' class='wym_href' value='' size='40' /></div><div class='row'><label>{Title}</label><input type='text' class='wym_title' value='' size='40' /></div><div class='row row-indent'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogImageHtml:"<body class='wym_dialog wym_dialog_image' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><fieldset><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_IMAGE+"' /><legend>{Image}</legend><div class='row'><label>{URL}</label><input type='text' class='wym_src' value='' size='40' /></div><div class='row'><label>{Alternative_Text}</label><input type='text' class='wym_alt' value='' size='40' /></div><div class='row'><label>{Title}</label><input type='text' class='wym_title' value='' size='40' /></div><div class='row row-indent'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogTableHtml:"<body class='wym_dialog wym_dialog_table' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><fieldset><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_TABLE+"' /><legend>{Table}</legend><div class='row'><label>{Caption}</label><input type='text' class='wym_caption' value='' size='40' /></div><div class='row'><label>{Summary}</label><input type='text' class='wym_summary' value='' size='40' /></div><div class='row'><label>{Number_Of_Rows}</label><input type='text' class='wym_rows' value='3' size='3' /></div><div class='row'><label>{Number_Of_Cols}</label><input type='text' class='wym_cols' value='2' size='3' /></div><div class='row row-indent'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogPasteHtml:"<body class='wym_dialog wym_dialog_paste' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'><form><input type='hidden' class='wym_dialog_type' value='"+WYMeditor.DIALOG_PASTE+"' /><fieldset><legend>{Paste_From_Word}</legend><div class='row'><textarea class='wym_text' rows='10' cols='50'></textarea></div><div class='row'><input class='wym_submit' type='button' value='{Submit}' /><input class='wym_cancel' type='button'value='{Cancel}' /></div></fieldset></form></body>",dialogPreviewHtml:"<body class='wym_dialog wym_dialog_preview' onload='WYMeditor.INIT_DIALOG("+WYMeditor.INDEX+")'></body>",dialogStyles:[],stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},t),this.each(function(){new WYMeditor.editor(jQuery(this),t)})},jQuery.extend({wymeditors:function(t){return WYMeditor.INSTANCES[t]}}),WYMeditor.editor.prototype.init=function(){if(jQuery.browser.msie)var WymClass=new WYMeditor.WymClassExplorer(this);else if(jQuery.browser.mozilla)var WymClass=new WYMeditor.WymClassMozilla(this);else if(jQuery.browser.opera)var WymClass=new WYMeditor.WymClassOpera(this);else if(jQuery.browser.safari||jQuery.browser.chrome)var WymClass=new WYMeditor.WymClassSafari(this);if(WymClass){jQuery.isFunction(this._options.preInit)&&this._options.preInit(this);var SaxListener=new WYMeditor.XhtmlSaxListener;jQuery.extend(SaxListener,WymClass),this.parser=new WYMeditor.XhtmlParser(SaxListener),(this._options.styles||this._options.stylesheet)&&this.configureEditorUsingRawCss(),this.helper=new WYMeditor.XmlHelper;for(var prop in WymClass)this[prop]=WymClass[prop];this._box=jQuery(this._element).hide().after(this._options.boxHtml).next().addClass("wym_box_"+this._index),jQuery.isFunction(jQuery.fn.data)&&(jQuery.data(this._box.get(0),WYMeditor.WYM_INDEX,this._index),jQuery.data(this._element.get(0),WYMeditor.WYM_INDEX,this._index));var h=WYMeditor.Helper,iframeHtml=this._options.iframeHtml;iframeHtml=h.replaceAll(iframeHtml,WYMeditor.INDEX,this._index),iframeHtml=h.replaceAll(iframeHtml,WYMeditor.IFRAME_BASE_PATH,this._options.iframeBasePath);var boxHtml=jQuery(this._box).html();boxHtml=h.replaceAll(boxHtml,WYMeditor.LOGO,this._options.logoHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS,this._options.toolsHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS,this._options.containersHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES,this._options.classesHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.HTML,this._options.htmlHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.IFRAME,iframeHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.STATUS,this._options.statusHtml);for(var aTools=eval(this._options.toolsItems),sTools="",i=0;i<aTools.length;i++){var oTool=aTools[i];if(oTool.name&&oTool.title)var sTool=this._options.toolsItemHtml;var sTool=h.replaceAll(sTool,WYMeditor.TOOL_NAME,oTool.name);sTool=h.replaceAll(sTool,WYMeditor.TOOL_TITLE,this._options.stringDelimiterLeft+oTool.title+this._options.stringDelimiterRight),sTool=h.replaceAll(sTool,WYMeditor.TOOL_CLASS,oTool.css),sTools+=sTool}boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS_ITEMS,sTools);for(var aClasses=eval(this._options.classesItems),sClasses="",i=0;i<aClasses.length;i++){var oClass=aClasses[i];if(oClass.name&&oClass.title)var sClass=this._options.classesItemHtml;sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,oClass.title),sClasses+=sClass}boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES_ITEMS,sClasses);for(var aContainers=eval(this._options.containersItems),sContainers="",i=0;i<aContainers.length;i++){var oContainer=aContainers[i];if(oContainer.name&&oContainer.title)var sContainer=this._options.containersItemHtml;sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_NAME,oContainer.name),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_TITLE,this._options.stringDelimiterLeft+oContainer.title+this._options.stringDelimiterRight),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_CLASS,oContainer.css),sContainers+=sContainer}boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS_ITEMS,sContainers),boxHtml=this.replaceStrings(boxHtml),jQuery(this._box).html(boxHtml),jQuery(this._box).find(this._options.htmlSelector).hide(),this.loadSkin()}},WYMeditor.editor.prototype.bindEvents=function(){var wym=this;jQuery(this._box).find(this._options.toolSelector).click(function(){return wym._iframe.contentWindow.focus(),wym.exec(jQuery(this).attr(WYMeditor.NAME)),!1}),jQuery(this._box).find(this._options.containerSelector).click(function(){return wym.container(jQuery(this).attr(WYMeditor.NAME)),!1}),jQuery(this._box).find(this._options.htmlValSelector).keyup(function(){jQuery(wym._doc.body).html(jQuery(this).val())}).focus(function(){jQuery(this).toggleClass("hasfocus")}).blur(function(){jQuery(this).toggleClass("hasfocus")}),jQuery(this._box).find(this._options.classSelector).click(function(){var aClasses=eval(wym._options.classesItems),sName=jQuery(this).attr(WYMeditor.NAME),oClass=WYMeditor.Helper.findByName(aClasses,sName);if(oClass){var jqexpr=oClass.expr;wym.toggleClass(sName,jqexpr)}return wym._iframe.contentWindow.focus(),!1}),jQuery(this._options.updateSelector).bind(this._options.updateEvent,function(){wym.update()})},WYMeditor.editor.prototype.ready=function(){return null!=this._doc},WYMeditor.editor.prototype.box=function(){return this._box},WYMeditor.editor.prototype.html=function(t){if("string"!=typeof t)return jQuery(this._doc.body).html();jQuery(this._doc.body).html(t)},WYMeditor.editor.prototype.xhtml=function(){return this.parser.parse(this.html())},WYMeditor.editor.prototype.exec=function(t){switch(t){case WYMeditor.CREATE_LINK:(this.container()||this._selected_image)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:this.update(),this.toggleHtml(),jQuery(this._box).find(this._options.htmlSelector).is(":visible")||this.listen();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW,this._options.dialogFeaturesPreview);break;default:this._exec(t)}},WYMeditor.editor.prototype.container=function(t){if(!t)return this.selected();var e=null;if(t.toLowerCase()==WYMeditor.TH){switch(e=this.container(),e.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:var n=new Array(WYMeditor.TD,WYMeditor.TH);e=this.findUp(this.container(),n)}null!=e&&(t=e.tagName.toLowerCase()==WYMeditor.TD?WYMeditor.TH:WYMeditor.TD,this.switchTo(e,t),this.update())}else{var n=new Array(WYMeditor.P,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE);if(e=this.findUp(this.container(),n)){var i=null;if(t.toLowerCase()==WYMeditor.BLOCKQUOTE){var r=this.findUp(this.container(),WYMeditor.BLOCKQUOTE);if(null==r)i=this._doc.createElement(t),e.parentNode.insertBefore(i,e),i.appendChild(e),this.setFocusToNode(i.firstChild);else{var a=r.childNodes,o=a.length,s=null;o>0&&(s=a.item(0));for(var l=0;l<o;l++)r.parentNode.insertBefore(a.item(0),r);r.parentNode.removeChild(r),s&&this.setFocusToNode(s)}}else this.switchTo(e,t);this.update()}}},WYMeditor.editor.prototype.toggleClass=function(t,e){var n=this._selected_image?this._selected_image:jQuery(this.selected());n=jQuery(n).parentsOrSelf(e),jQuery(n).toggleClass(t),jQuery(n).attr(WYMeditor.CLASS)||jQuery(n).removeAttr(this._class)},WYMeditor.editor.prototype.findUp=function(t,e){if(t){var n=t.tagName.toLowerCase();if(typeof e==WYMeditor.STRING)for(;n!=e&&n!=WYMeditor.BODY;)t=t.parentNode,n=t.tagName.toLowerCase();else for(var i=!1;!i&&n!=WYMeditor.BODY;){for(var r=0;r<e.length;r++)if(n==e[r]){i=!0;break}i||(t=t.parentNode,n=t.tagName.toLowerCase())}return n!=WYMeditor.BODY?t:null}return null},WYMeditor.editor.prototype.switchTo=function(t,e){var n=this._doc.createElement(e),i=jQuery(t).html();t.parentNode.replaceChild(n,t),jQuery(n).html(i),this.setFocusToNode(n)},WYMeditor.editor.prototype.replaceStrings=function(sVal){if(!WYMeditor.STRINGS[this._options.lang])try{eval(jQuery.ajax({url:this._options.langPath+this._options.lang+".js",async:!1}).responseText)}catch(t){return WYMeditor.console.error("WYMeditor: error while parsing language file."),sVal}for(var key in WYMeditor.STRINGS[this._options.lang])sVal=WYMeditor.Helper.replaceAll(sVal,this._options.stringDelimiterLeft+key+this._options.stringDelimiterRight,WYMeditor.STRINGS[this._options.lang][key]);return sVal},WYMeditor.editor.prototype.encloseString=function(t){return this._options.stringDelimiterLeft+t+this._options.stringDelimiterRight},WYMeditor.editor.prototype.status=function(t){jQuery(this._box).find(this._options.statusSelector).html(t)},WYMeditor.editor.prototype.update=function(){var t=this.xhtml();jQuery(this._element).val(t),jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(t)},WYMeditor.editor.prototype.dialog=function(t,e,n){var i=e||this._wym._options.dialogFeatures,r=window.open("","dialog",i);if(r){var a="";switch(t){case WYMeditor.DIALOG_LINK:a=this._options.dialogLinkHtml;break;case WYMeditor.DIALOG_IMAGE:a=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:a=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:a=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:a=this._options.dialogPreviewHtml;break;default:a=n}var o=WYMeditor.Helper,s=this._options.dialogHtml;s=o.replaceAll(s,WYMeditor.BASE_PATH,this._options.basePath),s=o.replaceAll(s,WYMeditor.DIRECTION,this._options.direction),s=o.replaceAll(s,WYMeditor.CSS_PATH,this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS),s=o.replaceAll(s,WYMeditor.WYM_PATH,this._options.wymPath),s=o.replaceAll(s,WYMeditor.JQUERY_PATH,this._options.jQueryPath),s=o.replaceAll(s,WYMeditor.DIALOG_TITLE,this.encloseString(t)),s=o.replaceAll(s,WYMeditor.DIALOG_BODY,a),s=o.replaceAll(s,WYMeditor.INDEX,this._index),s=this.replaceStrings(s);var l=r.document;l.write(s),l.close()}},WYMeditor.editor.prototype.toggleHtml=function(){jQuery(this._box).find(this._options.htmlSelector).toggle()},WYMeditor.editor.prototype.uniqueStamp=function(){return"wym-"+(new Date).getTime()},WYMeditor.editor.prototype.paste=function(t){var e,n=this.selected(),i=t.split(this._newLine+this._newLine),r=new RegExp(this._newLine,"g");if(n&&n.tagName.toLowerCase()!=WYMeditor.BODY)for(x=i.length-1;x>=0;x--)e=i[x],e=e.replace(r,"<br />"),jQuery(n).after("<p>"+e+"</p>");else for(x=0;x<i.length;x++)e=i[x],e=e.replace(r,"<br />"),jQuery(this._doc.body).append("<p>"+e+"</p>")},WYMeditor.editor.prototype.insert=function(t){null!=this._iframe.contentWindow.getSelection().focusNode?this._exec(WYMeditor.INSERT_HTML,t):this.paste(t)},WYMeditor.editor.prototype.wrap=function(t,e){null!=this._iframe.contentWindow.getSelection().focusNode&&this._exec(WYMeditor.INSERT_HTML,t+this._iframe.contentWindow.getSelection().toString()+e)},WYMeditor.editor.prototype.unwrap=function(){null!=this._iframe.contentWindow.getSelection().focusNode&&this._exec(WYMeditor.INSERT_HTML,this._iframe.contentWindow.getSelection().toString())},WYMeditor.editor.prototype.addCssRules=function(t,e){var n=t.styleSheets[0];if(n)for(var i=0;i<e.length;i++){var r=e[i];r.name&&r.css&&this.addCssRule(n,r)}},WYMeditor.editor.prototype.computeBasePath=function(){return jQuery(jQuery.grep(jQuery("script"),function(t){return t.src&&t.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src").replace(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/,"")},WYMeditor.editor.prototype.computeWymPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(t){return t.src&&t.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.editor.prototype.computeJqueryPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(t){return t.src&&t.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.editor.prototype.computeCssPath=function(){return jQuery(jQuery.grep(jQuery("link"),function(t){return t.href&&t.href.match(/wymeditor\/skins\/(.*)screen\.css(\?.*)?$/)})).attr("href")},WYMeditor.editor.prototype.configureEditorUsingRawCss=function(){var t=new WYMeditor.WymCssParser;this._options.stylesheet?t.parse(jQuery.ajax({url:this._options.stylesheet,async:!1}).responseText):t.parse(this._options.styles,!1),0==this._options.classesItems.length&&(this._options.classesItems=t.css_settings.classesItems),0==this._options.editorStyles.length&&(this._options.editorStyles=t.css_settings.editorStyles),0==this._options.dialogStyles.length&&(this._options.dialogStyles=t.css_settings.dialogStyles)},WYMeditor.editor.prototype.listen=function(){jQuery(this._doc.body).bind("mousedown",this.mousedown);for(var t=this._doc.body.getElementsByTagName("img"),e=0;e<t.length;e++)jQuery(t[e]).bind("mousedown",this.mousedown)},WYMeditor.editor.prototype.mousedown=function(t){WYMeditor.INSTANCES[this.ownerDocument.title]._selected_image=this.tagName.toLowerCase()==WYMeditor.IMG?this:null,t.stopPropagation()},WYMeditor.loadCss=function(t){var e=document.createElement("link");e.rel="stylesheet",e.href=t,jQuery("head").get(0).appendChild(e)},WYMeditor.editor.prototype.loadSkin=function(){if(this._options.loadSkin&&!WYMeditor.SKINS[this._options.skin]){var found=!1,rExp=new RegExp(this._options.skin+"/"+WYMeditor.SKINS_DEFAULT_CSS+"$");jQuery("link").each(function(){this.href.match(rExp)&&(found=!0)}),found||WYMeditor.loadCss(this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS)}jQuery(this._box).addClass("wym_skin_"+this._options.skin),this._options.initSkin&&!WYMeditor.SKINS[this._options.skin]&&eval(jQuery.ajax({url:this._options.skinPath+WYMeditor.SKINS_DEFAULT_JS,async:!1}).responseText),WYMeditor.SKINS[this._options.skin]&&WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this)},WYMeditor.INIT_DIALOG=function(index){var wym=window.opener.WYMeditor.INSTANCES[index],doc=window.document,selected=wym.selected(),dialogType=jQuery(wym._options.dialogTypeSelector).val(),sStamp=wym.uniqueStamp();switch(dialogType){case WYMeditor.DIALOG_LINK:selected&&selected.tagName&&selected.tagName.toLowerCase!=WYMeditor.A&&(selected=jQuery(selected).parentsOrSelf(WYMeditor.A)),!selected&&wym._selected_image&&(selected=jQuery(wym._selected_image).parentsOrSelf(WYMeditor.A))}jQuery.isFunction(wym._options.preInitDialog)&&wym._options.preInitDialog(wym,window);var styles=doc.styleSheets[0],aCss=eval(wym._options.dialogStyles);wym.addCssRules(doc,aCss),selected&&(jQuery(wym._options.hrefSelector).val(jQuery(selected).attr(WYMeditor.HREF)),jQuery(wym._options.srcSelector).val(jQuery(selected).attr(WYMeditor.SRC)),jQuery(wym._options.titleSelector).val(jQuery(selected).attr(WYMeditor.TITLE)),jQuery(wym._options.altSelector).val(jQuery(selected).attr(WYMeditor.ALT))),wym._selected_image&&(jQuery(wym._options.dialogImageSelector+" "+wym._options.srcSelector).val(jQuery(wym._selected_image).attr(WYMeditor.SRC)),jQuery(wym._options.dialogImageSelector+" "+wym._options.titleSelector).val(jQuery(wym._selected_image).attr(WYMeditor.TITLE)),jQuery(wym._options.dialogImageSelector+" "+wym._options.altSelector).val(jQuery(wym._selected_image).attr(WYMeditor.ALT))),jQuery(wym._options.dialogLinkSelector+" "+wym._options.submitSelector).click(function(){var t=jQuery(wym._options.hrefSelector).val();t.length>0&&(wym._exec(WYMeditor.CREATE_LINK,sStamp),jQuery("a[href="+sStamp+"]",wym._doc.body).attr(WYMeditor.HREF,t).attr(WYMeditor.TITLE,jQuery(wym._options.titleSelector).val())),window.close()}),jQuery(wym._options.dialogImageSelector+" "+wym._options.submitSelector).click(function(){var t=jQuery(wym._options.srcSelector).val();t.length>0&&(wym._exec(WYMeditor.INSERT_IMAGE,sStamp),jQuery("img[src$="+sStamp+"]",wym._doc.body).attr(WYMeditor.SRC,t).attr(WYMeditor.TITLE,jQuery(wym._options.titleSelector).val()).attr(WYMeditor.ALT,jQuery(wym._options.altSelector).val())),window.close()}),jQuery(wym._options.dialogTableSelector+" "+wym._options.submitSelector).click(function(){var t=jQuery(wym._options.rowsSelector).val(),e=jQuery(wym._options.colsSelector).val();if(t>0&&e>0){var n=wym._doc.createElement(WYMeditor.TABLE),i=null,r=jQuery(wym._options.captionSelector).val(),a=n.createCaption();for(a.innerHTML=r,x=0;x<t;x++)for(i=n.insertRow(x),y=0;y<e;y++)i.insertCell(y);jQuery(n).attr("summary",jQuery(wym._options.summarySelector).val());var o=jQuery(wym.findUp(wym.container(),WYMeditor.MAIN_CONTAINERS)).get(0);o&&o.parentNode?jQuery(o).after(n):jQuery(wym._doc.body).append(n)}window.close()}),jQuery(wym._options.dialogPasteSelector+" "+wym._options.submitSelector).click(function(){var t=jQuery(wym._options.textSelector).val();wym.paste(t),window.close()}),jQuery(wym._options.dialogPreviewSelector+" "+wym._options.previewSelector).html(wym.xhtml()),jQuery(wym._options.cancelSelector).mousedown(function(){window.close()}),jQuery.isFunction(wym._options.postInitDialog)&&wym._options.postInitDialog(wym,window)},WYMeditor.XmlHelper=function(){return this._entitiesDiv=document.createElement("div"),this},WYMeditor.XmlHelper.prototype.tag=function(t,e,n){return e=e||!1,n=n||!1,"<"+t+(e?this.tagOptions(e):"")+(n?">":" />")},WYMeditor.XmlHelper.prototype.contentTag=function(t,e,n){return n=n||!1,"<"+t+(n?this.tagOptions(n):"")+">"+e+"</"+t+">"},WYMeditor.XmlHelper.prototype.cdataSection=function(t){return"<![CDATA["+t+"]]>"},WYMeditor.XmlHelper.prototype.escapeOnce=function(t){return this._fixDoubleEscape(this.escapeEntities(t))},WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(t){return t.replace(/&amp;([a-z]+|(#\d+));/gi,"&$1;")},WYMeditor.XmlHelper.prototype.tagOptions=function(t){var e=this;e._formated_options="";for(var n in t){var i=t[n];"function"!=typeof i&&i.length>0&&(parseInt(n)==n&&"object"==typeof i&&(n=i.shift(),i=i.pop()),""!=n&&""!=i&&(e._formated_options+=" "+n+'="'+e.escapeOnce(i)+'"'))}return e._formated_options},WYMeditor.XmlHelper.prototype.escapeEntities=function(t,e){this._entitiesDiv.innerHTML=t,this._entitiesDiv.textContent=t;var n=this._entitiesDiv.innerHTML;return void 0===e&&(0!=e&&(n=n.replace('"',"&quot;")),1==e&&(n=n.replace('"',"&#039;"))),n},WYMeditor.XmlHelper.prototype.parseAttributes=function(t){var e=[],n=t.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(n.toString()!=t)for(var i in n){var r=n[i];if("function"!=typeof r&&0!=r.length){var a=new RegExp("(\\w+)\\s*"+r);if(match=t.match(a)){var o=r.replace(/^[\s=]+/,""),s=o.charAt(0);s='"'==s?'"':"'"==s?"'":"",""!=s&&(o='"'==s?o.replace(/^"|"+$/g,""):o.replace(/^'|'+$/g,"")),t=t.replace(match[0],""),e.push([match[1],o])}}}return e},WYMeditor.XhtmlValidator={_attributes:{core:{except:["base","head","html","meta","param","script","style","title"],attributes:["class","id","style","title","accesskey","tabindex"]},language:{except:["base","br","hr","iframe","param","script"],attributes:{dir:["ltr","rtl"],0:"lang",1:"xml:lang"}},keyboard:{attributes:{accesskey:/^(\w){1}$/,tabindex:/^(\d)+$/}}},_events:{window:{only:["body"],attributes:["onload","onunload"]},form:{only:["form","input","textarea","select","a","label","button"],attributes:["onchange","onsubmit","onreset","onselect","onblur","onfocus"]},keyboard:{except:["base","bdo","br","frame","frameset","head","html","iframe","meta","param","script","style","title"],attributes:["onkeydown","onkeypress","onkeyup"]},mouse:{except:["base","bdo","br","head","html","meta","param","script","style","title"],attributes:["onclick","ondblclick","onmousedown","onmousemove","onmouseover","onmouseout","onmouseup"]}},_tags:{a:{attributes:{0:"charset",1:"coords",2:"href",3:"hreflang",4:"name",rel:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon)+$/,rev:/^(alternate|designates|stylesheet|start|next|prev|contents|index|glossary|copyright|chapter|section|subsection|appendix|help|bookmark| |shortcut|icon)+$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/,5:"type"}},0:"abbr",1:"acronym",2:"address",area:{attributes:{0:"alt",1:"coords",2:"href",nohref:/^(true|false)$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/},required:["alt"]},3:"b",base:{attributes:["href"],required:["href"]},bdo:{attributes:{dir:/^(ltr|rtl)$/},required:["dir"]},4:"big",blockquote:{attributes:["cite"]},5:"body",6:"br",button:{attributes:{disabled:/^(disabled)$/,type:/^(button|reset|submit)$/,0:"value"},inside:"form"},7:"caption",8:"cite",9:"code",col:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"},inside:"colgroup"},colgroup:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"}},10:"dd",del:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},11:"div",12:"dfn",13:"dl",14:"dt",15:"em",fieldset:{inside:"form"},form:{attributes:{0:"action",1:"accept",2:"accept-charset",3:"enctype",method:/^(get|post)$/},required:["action"]},head:{attributes:["profile"]},16:"h1",17:"h2",18:"h3",19:"h4",20:"h5",21:"h6",22:"hr",html:{attributes:["xmlns"]},23:"i",img:{attributes:["alt","src","height","ismap","longdesc","usemap","width"],required:["alt","src"]},input:{attributes:{0:"accept",1:"alt",checked:/^(checked)$/,disabled:/^(disabled)$/,maxlength:/^(\d)+$/,2:"name",readonly:/^(readonly)$/,size:/^(\d)+$/,3:"src",type:/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text)$/,4:"value"},inside:"form"},ins:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},24:"kbd",label:{attributes:["for"],inside:"form"},25:"legend",26:"li",link:{attributes:{0:"charset",1:"href",2:"hreflang",media:/^(all|braille|print|projection|screen|speech|,|;| )+$/i,rel:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,rev:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,3:"type"},inside:"head"},map:{attributes:["id","name"],required:["id"]},meta:{attributes:{0:"content","http-equiv":/^(content\-type|expires|refresh|set\-cookie)$/i,1:"name",2:"scheme"},required:["content"]},27:"noscript",object:{attributes:["archive","classid","codebase","codetype","data","declare","height","name","standby","type","usemap","width"]},28:"ol",optgroup:{attributes:{0:"label",disabled:/^(disabled)$/},required:["label"]},option:{attributes:{0:"label",disabled:/^(disabled)$/,selected:/^(selected)$/,1:"value"},inside:"select"},29:"p",param:{attributes:{0:"type",valuetype:/^(data|ref|object)$/,1:"valuetype",2:"value"},required:["name"]},30:"pre",q:{attributes:["cite"]},31:"samp",script:{attributes:{type:/^(text\/ecmascript|text\/javascript|text\/jscript|text\/vbscript|text\/vbs|text\/xml)$/,0:"charset",defer:/^(defer)$/,1:"src"},required:["type"]},select:{attributes:{disabled:/^(disabled)$/,multiple:/^(multiple)$/,0:"name",1:"size"},inside:"form"},32:"small",33:"span",34:"strong",style:{attributes:{0:"type",media:/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/},required:["type"]},35:"sub",36:"sup",table:{attributes:{0:"border",1:"cellpadding",2:"cellspacing",frame:/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,rules:/^(none|groups|rows|cols|all)$/,3:"summary",4:"width"}},tbody:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},td:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},textarea:{attributes:["cols","rows","disabled","name","readonly"],required:["cols","rows"],inside:"form"},tfoot:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom)$/,2:"baseline"}},th:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},thead:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},37:"title",tr:{attributes:{align:/^(right|left|center|justify|char)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},38:"tt",39:"ul",40:"var"},skiped_attributes:[],skiped_attribute_values:[],getValidTagAttributes:function(t,e){var n={},i=this.getPossibleTagAttributes(t);for(var r in e){var a=e[r],o=WYMeditor.Helper;o.contains(this.skiped_attributes,r)||o.contains(this.skiped_attribute_values,a)||"function"!=typeof a&&o.contains(i,r)&&(this.doesAttributeNeedsValidation(t,r)?this.validateAttribute(t,r,a)&&(n[r]=a):n[r]=a)}return n},getUniqueAttributesAndEventsForTag:function(t){var e=[];if(this._tags[t]&&this._tags[t].attributes)for(k in this._tags[t].attributes)e.push(parseInt(k)==k?this._tags[t].attributes[k]:k);return e},getDefaultAttributesAndEventsForTags:function(){var t=[];for(var e in this._events)t.push(this._events[e]);for(var e in this._attributes)t.push(this._attributes[e]);return t},isValidTag:function(t){if(this._tags[t])return!0;for(var e in this._tags)if(this._tags[e]==t)return!0;return!1},getDefaultAttributesAndEventsForTag:function(t){var e=[];if(this.isValidTag(t)){var n=this.getDefaultAttributesAndEventsForTags();for(var i in n){var r=n[i];if("object"==typeof r){var a=WYMeditor.Helper;if(r.except&&a.contains(r.except,t)||r.only&&!a.contains(r.only,t))continue;var o=r.attributes?r.attributes:r.events;for(var s in o)e.push("string"!=typeof o[s]?s:o[s])}}}return e},doesAttributeNeedsValidation:function(t,e){return this._tags[t]&&(this._tags[t].attributes&&this._tags[t].attributes[e]||this._tags[t].required&&WYMeditor.Helper.contains(this._tags[t].required,e))},validateAttribute:function(t,e,n){return!(this._tags[t]&&this._tags[t].attributes&&this._tags[t].attributes[e]&&n.length>0&&!n.match(this._tags[t].attributes[e])||this._tags[t]&&this._tags[t].required&&WYMeditor.Helper.contains(this._tags[t].required,e)&&0==n.length)&&void 0!==this._tags[t]},getPossibleTagAttributes:function(t){return this._possible_tag_attributes||(this._possible_tag_attributes={}),this._possible_tag_attributes[t]||(this._possible_tag_attributes[t]=this.getUniqueAttributesAndEventsForTag(t).concat(this.getDefaultAttributesAndEventsForTag(t))),this._possible_tag_attributes[t]}},WYMeditor.ParallelRegex=function(t){return this._case=t,this._patterns=[],this._labels=[],this._regex=null,this},WYMeditor.ParallelRegex.prototype.addPattern=function(t,e){e=e||!0;var n=this._patterns.length;this._patterns[n]=t,this._labels[n]=e,this._regex=null},WYMeditor.ParallelRegex.prototype.match=function(t){if(0==this._patterns.length)return[!1,""];var e=t.match(this._getCompoundedRegex());if(!e)return[!1,""];for(var n=e[0],i=1;i<e.length;i++)if(e[i])return[this._labels[i-1],n];return[!0,e[0]]},WYMeditor.ParallelRegex.prototype._getCompoundedRegex=function(){if(null==this._regex){for(var t=0,e=this._patterns.length;t<e;t++)this._patterns[t]="("+this._untokenizeRegex(this._tokenizeRegex(this._patterns[t]).replace(/([\/\(\)])/g,"\\$1"))+")";this._regex=new RegExp(this._patterns.join("|"),this._getPerlMatchingFlags())}return this._regex},WYMeditor.ParallelRegex.prototype._tokenizeRegex=function(t){return t.replace(/\(\?(i|m|s|x|U)\)/,"~~~~~~Tk1$1~~~~~~").replace(/\(\?(\-[i|m|s|x|U])\)/,"~~~~~~Tk2$1~~~~~~").replace(/\(\?\=(.*)\)/,"~~~~~~Tk3$1~~~~~~").replace(/\(\?\!(.*)\)/,"~~~~~~Tk4$1~~~~~~").replace(/\(\?\<\=(.*)\)/,"~~~~~~Tk5$1~~~~~~").replace(/\(\?\<\!(.*)\)/,"~~~~~~Tk6$1~~~~~~").replace(/\(\?\:(.*)\)/,"~~~~~~Tk7$1~~~~~~")},WYMeditor.ParallelRegex.prototype._untokenizeRegex=function(t){return t.replace(/~~~~~~Tk1(.{1})~~~~~~/,"(?$1)").replace(/~~~~~~Tk2(.{2})~~~~~~/,"(?$1)").replace(/~~~~~~Tk3(.*)~~~~~~/,"(?=$1)").replace(/~~~~~~Tk4(.*)~~~~~~/,"(?!$1)").replace(/~~~~~~Tk5(.*)~~~~~~/,"(?<=$1)").replace(/~~~~~~Tk6(.*)~~~~~~/,"(?<!$1)").replace(/~~~~~~Tk7(.*)~~~~~~/,"(?:$1)")},WYMeditor.ParallelRegex.prototype._getPerlMatchingFlags=function(){return this._case?"m":"mi"},WYMeditor.StateStack=function(t){return this._stack=[t],this},WYMeditor.StateStack.prototype.getCurrent=function(){return this._stack[this._stack.length-1]},WYMeditor.StateStack.prototype.enter=function(t){this._stack.push(t)},WYMeditor.StateStack.prototype.leave=function(){return 1!=this._stack.length&&(this._stack.pop(),!0)},WYMeditor.LEXER_ENTER=1,WYMeditor.LEXER_MATCHED=2,WYMeditor.LEXER_UNMATCHED=3,WYMeditor.LEXER_EXIT=4,WYMeditor.LEXER_SPECIAL=5,WYMeditor.Lexer=function(t,e,n){return e=e||"accept",this._case=n||!1,this._regexes={},this._parser=t,this._mode=new WYMeditor.StateStack(e),this._mode_handlers={},this._mode_handlers[e]=e,this},WYMeditor.Lexer.prototype.addPattern=function(t,e){var e=e||"accept";void 0===this._regexes[e]&&(this._regexes[e]=new WYMeditor.ParallelRegex(this._case)),this._regexes[e].addPattern(t),void 0===this._mode_handlers[e]&&(this._mode_handlers[e]=e)},WYMeditor.Lexer.prototype.addEntryPattern=function(t,e,n){void 0===this._regexes[e]&&(this._regexes[e]=new WYMeditor.ParallelRegex(this._case)),this._regexes[e].addPattern(t,n),void 0===this._mode_handlers[n]&&(this._mode_handlers[n]=n)},WYMeditor.Lexer.prototype.addExitPattern=function(t,e){void 0===this._regexes[e]&&(this._regexes[e]=new WYMeditor.ParallelRegex(this._case)),this._regexes[e].addPattern(t,"__exit"),void 0===this._mode_handlers[e]&&(this._mode_handlers[e]=e)},WYMeditor.Lexer.prototype.addSpecialPattern=function(t,e,n){void 0===this._regexes[e]&&(this._regexes[e]=new WYMeditor.ParallelRegex(this._case)),this._regexes[e].addPattern(t,"_"+n),void 0===this._mode_handlers[n]&&(this._mode_handlers[n]=n)},WYMeditor.Lexer.prototype.mapHandler=function(t,e){this._mode_handlers[t]=e},WYMeditor.Lexer.prototype.parse=function(t){if(void 0===this._parser)return!1;for(var e,n=t.length;"object"==typeof(e=this._reduce(t));){var t=e[0],i=e[1],r=e[2],a=e[3];if(!this._dispatchTokens(i,r,a))return!1;if(""==t)return!0;if(t.length==n)return!1;n=t.length}return!!e&&this._invokeParser(t,WYMeditor.LEXER_UNMATCHED)},WYMeditor.Lexer.prototype._dispatchTokens=function(t,e,n){return n=n||!1,!!this._invokeParser(t,WYMeditor.LEXER_UNMATCHED)&&("boolean"==typeof n?this._invokeParser(e,WYMeditor.LEXER_MATCHED):this._isModeEnd(n)?!!this._invokeParser(e,WYMeditor.LEXER_EXIT)&&this._mode.leave():this._isSpecialMode(n)?(this._mode.enter(this._decodeSpecial(n)),!!this._invokeParser(e,WYMeditor.LEXER_SPECIAL)&&this._mode.leave()):(this._mode.enter(n),this._invokeParser(e,WYMeditor.LEXER_ENTER)))},WYMeditor.Lexer.prototype._isModeEnd=function(t){return"__exit"===t},WYMeditor.Lexer.prototype._isSpecialMode=function(t){return"_"==t.substring(0,1)},WYMeditor.Lexer.prototype._decodeSpecial=function(t){return t.substring(1)},WYMeditor.Lexer.prototype._invokeParser=function(content,is_match){if(!/ +/.test(content)&&(""===content||0==content))return!0;var current=this._mode.getCurrent(),handler=this._mode_handlers[current],result;return eval("result = this._parser."+handler+"(content, is_match);"),result},WYMeditor.Lexer.prototype._reduce=function(t){var e=this._regexes[this._mode.getCurrent()].match(t),n=e[1],i=e[0];if(i){var r=t.indexOf(n),a=t.substr(0,r);return t=t.substring(r+n.length),[t,a,n,i]}return!0},WYMeditor.XhtmlLexer=function(t){return jQuery.extend(this,new WYMeditor.Lexer(t,"Text")),this.mapHandler("Text","Text"),this.addTokens(),this.init(),this},WYMeditor.XhtmlLexer.prototype.init=function(){},WYMeditor.XhtmlLexer.prototype.addTokens=function(){this.addCommentTokens("Text"),this.addScriptTokens("Text"),this.addCssTokens("Text"),this.addTagTokens("Text")},WYMeditor.XhtmlLexer.prototype.addCommentTokens=function(t){this.addEntryPattern("\x3c!--",t,"Comment"),this.addExitPattern("--\x3e","Comment")},WYMeditor.XhtmlLexer.prototype.addScriptTokens=function(t){this.addEntryPattern("<script",t,"Script"),this.addExitPattern("<\/script>","Script")},WYMeditor.XhtmlLexer.prototype.addCssTokens=function(t){this.addEntryPattern("<style",t,"Css"),this.addExitPattern("</style>","Css")},WYMeditor.XhtmlLexer.prototype.addTagTokens=function(t){this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*>",t,"OpeningTag"),this.addEntryPattern("<[a-z0-9:-]+[\\/ \\>]+",t,"OpeningTag"),this.addInTagDeclarationTokens("OpeningTag"),this.addSpecialPattern("</\\s*[a-z0-9:-]+\\s*>",t,"ClosingTag")},WYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens=function(t){this.addSpecialPattern("\\s+",t,"Ignore"),this.addAttributeTokens(t),this.addExitPattern("/>",t),this.addExitPattern(">",t)},WYMeditor.XhtmlLexer.prototype.addAttributeTokens=function(t){this.addSpecialPattern("\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\s*(?==)\\s*",t,"TagAttributes"),this.addEntryPattern('=\\s*"',t,"DoubleQuotedAttribute"),this.addPattern('\\\\"',"DoubleQuotedAttribute"),this.addExitPattern('"',"DoubleQuotedAttribute"),this.addEntryPattern("=\\s*'",t,"SingleQuotedAttribute"),this.addPattern("\\\\'","SingleQuotedAttribute"),this.addExitPattern("'","SingleQuotedAttribute"),this.addSpecialPattern("=\\s*[^>\\s]*",t,"UnquotedAttribute")},WYMeditor.XhtmlParser=function(t,e){var e=e||"Text";return this._Lexer=new WYMeditor.XhtmlLexer(this),this._Listener=t,this._mode=e,this._matches=[],this._last_match="",this._current_match="",this},WYMeditor.XhtmlParser.prototype.parse=function(t){return this._Lexer.parse(this.beforeParsing(t)),this.afterParsing(this._Listener.getResult())},WYMeditor.XhtmlParser.prototype.beforeParsing=function(t){return(t.match(/class="MsoNormal"/)||t.match(/ns = "urn:schemas-microsoft-com/))&&this._Listener.avoidStylingTagsAndAttributes(),this._Listener.beforeParsing(t)},WYMeditor.XhtmlParser.prototype.afterParsing=function(t){return this._Listener._avoiding_tags_implicitly&&this._Listener.allowStylingTagsAndAttributes(),this._Listener.afterParsing(t)},WYMeditor.XhtmlParser.prototype.Ignore=function(t,e){return!0},WYMeditor.XhtmlParser.prototype.Text=function(t){return this._Listener.addContent(t),!0},WYMeditor.XhtmlParser.prototype.Comment=function(t,e){return this._addNonTagBlock(t,e,"addComment")},WYMeditor.XhtmlParser.prototype.Script=function(t,e){return this._addNonTagBlock(t,e,"addScript")},WYMeditor.XhtmlParser.prototype.Css=function(t,e){return this._addNonTagBlock(t,e,"addCss")},WYMeditor.XhtmlParser.prototype._addNonTagBlock=function(t,e,n){switch(e){case WYMeditor.LEXER_ENTER:this._non_tag=t;break;case WYMeditor.LEXER_UNMATCHED:this._non_tag+=t;break;case WYMeditor.LEXER_EXIT:switch(n){case"addComment":this._Listener.addComment(this._non_tag+t);break;case"addScript":this._Listener.addScript(this._non_tag+t);break;case"addCss":this._Listener.addCss(this._non_tag+t)}}return!0},WYMeditor.XhtmlParser.prototype.OpeningTag=function(t,e){switch(e){case WYMeditor.LEXER_ENTER:this._tag=this.normalizeTag(t),this._tag_attributes={};break;case WYMeditor.LEXER_SPECIAL:this._callOpenTagListener(this.normalizeTag(t));break;case WYMeditor.LEXER_EXIT:this._callOpenTagListener(this._tag,this._tag_attributes)}return!0},WYMeditor.XhtmlParser.prototype.ClosingTag=function(t,e){return this._callCloseTagListener(this.normalizeTag(t)),!0},WYMeditor.XhtmlParser.prototype._callOpenTagListener=function(t,e){var e=e||{};this.autoCloseUnclosedBeforeNewOpening(t),this._Listener.isBlockTag(t)?(this._Listener._tag_stack.push(t),this._Listener.fixNestingBeforeOpeningBlockTag(t,e),this._Listener.openBlockTag(t,e),this._increaseOpenTagCounter(t)):this._Listener.isInlineTag(t)?this._Listener.inlineTag(t,e):(this._Listener.openUnknownTag(t,e),this._increaseOpenTagCounter(t)),this._Listener.last_tag=t,this._Listener.last_tag_opened=!0,this._Listener.last_tag_attributes=e},WYMeditor.XhtmlParser.prototype._callCloseTagListener=function(t){if(this._decreaseOpenTagCounter(t))if(this.autoCloseUnclosedBeforeTagClosing(t),this._Listener.isBlockTag(t)){var e=this._Listener._tag_stack.pop();if(0==e)return;e!=t&&(t=e),this._Listener.closeBlockTag(t)}else this._Listener.closeUnknownTag(t);else this._Listener.closeUnopenedTag(t);this._Listener.last_tag=t,this._Listener.last_tag_opened=!1},WYMeditor.XhtmlParser.prototype._increaseOpenTagCounter=function(t){this._Listener._open_tags[t]=this._Listener._open_tags[t]||0,this._Listener._open_tags[t]++},WYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter=function(t){return!!this._Listener._open_tags[t]&&(this._Listener._open_tags[t]--,0==this._Listener._open_tags[t]&&(this._Listener._open_tags[t]=void 0),!0)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening=function(t){this._autoCloseUnclosed(t,!1)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing=function(t){this._autoCloseUnclosed(t,!0)},WYMeditor.XhtmlParser.prototype._autoCloseUnclosed=function(t,e){var e=e||!1;if(this._Listener._open_tags)for(var n in this._Listener._open_tags){var i=this._Listener._open_tags[n];i>0&&this._Listener.shouldCloseTagAutomatically(n,t,e)&&this._callCloseTagListener(n,!0)}},WYMeditor.XhtmlParser.prototype.getTagReplacements=function(){return this._Listener.getTagReplacements()},WYMeditor.XhtmlParser.prototype.normalizeTag=function(t){t=t.replace(/^([\s<\/>]*)|([\s<\/>]*)$/gm,"").toLowerCase();var e=this._Listener.getTagReplacements();return e[t]?e[t]:t},WYMeditor.XhtmlParser.prototype.TagAttributes=function(t,e){return WYMeditor.LEXER_SPECIAL==e&&(this._current_attribute=t),!0},WYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute=function(t,e){return WYMeditor.LEXER_UNMATCHED==e&&(this._tag_attributes[this._current_attribute]=t),!0},WYMeditor.XhtmlParser.prototype.SingleQuotedAttribute=function(t,e){return WYMeditor.LEXER_UNMATCHED==e&&(this._tag_attributes[this._current_attribute]=t),!0},WYMeditor.XhtmlParser.prototype.UnquotedAttribute=function(t,e){return this._tag_attributes[this._current_attribute]=t.replace(/^=/,""),!0},WYMeditor.XhtmlSaxListener=function(){return this.output="",this.helper=new WYMeditor.XmlHelper,this._open_tags={},this.validator=WYMeditor.XhtmlValidator,this._tag_stack=[],this.avoided_tags=[],this.entities={"&nbsp;":"&#160;","&iexcl;":"&#161;","&cent;":"&#162;","&pound;":"&#163;","&curren;":"&#164;","&yen;":"&#165;","&brvbar;":"&#166;","&sect;":"&#167;","&uml;":"&#168;","&copy;":"&#169;","&ordf;":"&#170;","&laquo;":"&#171;","&not;":"&#172;","&shy;":"&#173;","&reg;":"&#174;","&macr;":"&#175;","&deg;":"&#176;","&plusmn;":"&#177;","&sup2;":"&#178;","&sup3;":"&#179;","&acute;":"&#180;","&micro;":"&#181;","&para;":"&#182;","&middot;":"&#183;","&cedil;":"&#184;","&sup1;":"&#185;","&ordm;":"&#186;","&raquo;":"&#187;","&frac14;":"&#188;","&frac12;":"&#189;","&frac34;":"&#190;","&iquest;":"&#191;","&Agrave;":"&#192;","&Aacute;":"&#193;","&Acirc;":"&#194;","&Atilde;":"&#195;","&Auml;":"&#196;","&Aring;":"&#197;","&AElig;":"&#198;","&Ccedil;":"&#199;","&Egrave;":"&#200;","&Eacute;":"&#201;","&Ecirc;":"&#202;","&Euml;":"&#203;","&Igrave;":"&#204;","&Iacute;":"&#205;","&Icirc;":"&#206;","&Iuml;":"&#207;","&ETH;":"&#208;","&Ntilde;":"&#209;","&Ograve;":"&#210;","&Oacute;":"&#211;","&Ocirc;":"&#212;","&Otilde;":"&#213;","&Ouml;":"&#214;","&times;":"&#215;","&Oslash;":"&#216;","&Ugrave;":"&#217;","&Uacute;":"&#218;","&Ucirc;":"&#219;","&Uuml;":"&#220;","&Yacute;":"&#221;","&THORN;":"&#222;","&szlig;":"&#223;","&agrave;":"&#224;","&aacute;":"&#225;","&acirc;":"&#226;","&atilde;":"&#227;","&auml;":"&#228;","&aring;":"&#229;","&aelig;":"&#230;","&ccedil;":"&#231;","&egrave;":"&#232;","&eacute;":"&#233;","&ecirc;":"&#234;","&euml;":"&#235;","&igrave;":"&#236;","&iacute;":"&#237;","&icirc;":"&#238;","&iuml;":"&#239;","&eth;":"&#240;","&ntilde;":"&#241;","&ograve;":"&#242;","&oacute;":"&#243;","&ocirc;":"&#244;","&otilde;":"&#245;","&ouml;":"&#246;","&divide;":"&#247;","&oslash;":"&#248;","&ugrave;":"&#249;","&uacute;":"&#250;","&ucirc;":"&#251;","&uuml;":"&#252;","&yacute;":"&#253;","&thorn;":"&#254;","&yuml;":"&#255;","&OElig;":"&#338;","&oelig;":"&#339;","&Scaron;":"&#352;","&scaron;":"&#353;","&Yuml;":"&#376;","&fnof;":"&#402;","&circ;":"&#710;","&tilde;":"&#732;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;","&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;","&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&ndash;":"&#8211;","&mdash;":"&#8212;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&sbquo;":"&#8218;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&bull;":"&#8226;","&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&lsaquo;":"&#8249;","&rsaquo;":"&#8250;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&trade;":"&#8482;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;","&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&minus;":"&#8722;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;","&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"},this.block_tags=["a","abbr","acronym","address","area","b","base","bdo","big","blockquote","body","button","caption","cite","code","col","colgroup","dd","del","div","dfn","dl","dt","em","fieldset","form","head","h1","h2","h3","h4","h5","h6","html","i","ins","kbd","label","legend","li","map","noscript","object","ol","optgroup","option","p","param","pre","q","samp","script","select","small","span","strong","style","sub","sup","table","tbody","td","textarea","tfoot","th","thead","title","tr","tt","ul","var","extends"],this.inline_tags=["br","hr","img","input"],this},WYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically=function(t,e,n){var n=n||!1;return!("td"!=t||!(n&&"tr"==e||!n&&"td"==e))||!("option"!=t||!(n&&"select"==e||!n&&"option"==e))},WYMeditor.XhtmlSaxListener.prototype.beforeParsing=function(t){return this.output="",t},WYMeditor.XhtmlSaxListener.prototype.afterParsing=function(t){return t=this.replaceNamedEntities(t),t=this.joinRepeatedEntities(t),t=this.removeEmptyTags(t),t=this.removeBrInPre(t)},WYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities=function(t){for(var e in this.entities)t=t.replace(new RegExp(e,"g"),this.entities[e]);return t},WYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities=function(t){var e="em|strong|sub|sup|acronym|pre|del|address";return t.replace(new RegExp("</("+e+")><\\1>",""),"").replace(new RegExp("(s*<("+e+")>s*){2}(.*)(s*</\\2>s*){2}",""),"<$2>$3<$2>")},WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags=function(t){return t.replace(new RegExp("<("+this.block_tags.join("|").replace(/\|td/,"").replace(/\|p/,"").replace(/\|th/,"")+")>(<br />|&#160;|&nbsp;|\\s)*</\\1>","g"),"")},WYMeditor.XhtmlSaxListener.prototype.removeBrInPre=function(t){var e=t.match(new RegExp("<pre[^>]*>(.*?)</pre>","gmi"));if(e)for(var n=0;n<e.length;n++)t=t.replace(e[n],e[n].replace(new RegExp("<br />","g"),String.fromCharCode(13,10)));return t},WYMeditor.XhtmlSaxListener.prototype.getResult=function(){return this.output},WYMeditor.XhtmlSaxListener.prototype.getTagReplacements=function(){return{b:"strong",i:"em"}},WYMeditor.XhtmlSaxListener.prototype.addContent=function(t){this.output+=t},WYMeditor.XhtmlSaxListener.prototype.addComment=function(t){this.remove_comments&&(this.output+=t)},WYMeditor.XhtmlSaxListener.prototype.addScript=function(t){this.remove_scripts||(this.output+=t)},WYMeditor.XhtmlSaxListener.prototype.addCss=function(t){this.remove_embeded_styles||(this.output+=t)},WYMeditor.XhtmlSaxListener.prototype.openBlockTag=function(t,e){this.output+=this.helper.tag(t,this.validator.getValidTagAttributes(t,e),!0)},WYMeditor.XhtmlSaxListener.prototype.inlineTag=function(t,e){this.output+=this.helper.tag(t,this.validator.getValidTagAttributes(t,e))},WYMeditor.XhtmlSaxListener.prototype.openUnknownTag=function(t,e){},WYMeditor.XhtmlSaxListener.prototype.closeBlockTag=function(t){this.output=this.output.replace(/<br \/>$/,"")+this._getClosingTagContent("before",t)+"</"+t+">"+this._getClosingTagContent("after",t)},WYMeditor.XhtmlSaxListener.prototype.closeUnknownTag=function(t){},WYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag=function(t){this.output+="</"+t+">"},WYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes=function(){this.avoided_tags=["div","span"],this.validator.skiped_attributes=["style"],this.validator.skiped_attribute_values=["MsoNormal","main1"],this._avoiding_tags_implicitly=!0},WYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes=function(){this.avoided_tags=[],this.validator.skiped_attributes=[],this.validator.skiped_attribute_values=[],this._avoiding_tags_implicitly=!1},WYMeditor.XhtmlSaxListener.prototype.isBlockTag=function(t){return!WYMeditor.Helper.contains(this.avoided_tags,t)&&WYMeditor.Helper.contains(this.block_tags,t)},WYMeditor.XhtmlSaxListener.prototype.isInlineTag=function(t){return!WYMeditor.Helper.contains(this.avoided_tags,t)&&WYMeditor.Helper.contains(this.inline_tags,t)},WYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag=function(t,e){this._insertContentWhenClosingTag("after",t,e)},WYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag=function(t,e){this._insertContentWhenClosingTag("before",t,e)},WYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag=function(t,e){"li"==t||"ul"!=t&&"ol"!=t||!this.last_tag||this.last_tag_opened||"li"!=this.last_tag||(this.output=this.output.replace(/<\/li>$/,""),this.insertContentAfterClosingTag(t,"</li>"))},WYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag=function(t,e,n){this["_insert_"+t+"_closing"]||(this["_insert_"+t+"_closing"]=[]),this["_insert_"+t+"_closing"][e]||(this["_insert_"+t+"_closing"][e]=[]),this["_insert_"+t+"_closing"][e].push(n)},WYMeditor.XhtmlSaxListener.prototype._getClosingTagContent=function(t,e){return this["_insert_"+t+"_closing"]&&this["_insert_"+t+"_closing"][e]&&this["_insert_"+t+"_closing"][e].length>0?this["_insert_"+t+"_closing"][e].pop():""},WYMeditor.WymCssLexer=function(t,e){var e=void 0===e||e;return jQuery.extend(this,new WYMeditor.Lexer(t,e?"Ignore":"WymCss")),this.mapHandler("WymCss","Ignore"),1==e&&(this.addEntryPattern("/\\*[<\\s]*WYMeditor[>\\s]*\\*/","Ignore","WymCss"),this.addExitPattern("/\\*[</\\s]*WYMeditor[>\\s]*\\*/","WymCss")),this.addSpecialPattern("[\\sa-z1-6]*\\.[a-z-_0-9]+","WymCss","WymCssStyleDeclaration"),this.addEntryPattern("/\\*","WymCss","WymCssComment"),this.addExitPattern("\\*/","WymCssComment"),this.addEntryPattern("{","WymCss","WymCssStyle"),this.addExitPattern("}","WymCssStyle"),this.addEntryPattern("/\\*","WymCssStyle","WymCssFeedbackStyle"),this.addExitPattern("\\*/","WymCssFeedbackStyle"),this},WYMeditor.WymCssParser=function(){return this._in_style=!1,this._has_title=!1,this.only_wym_blocks=!0,this.css_settings={classesItems:[],editorStyles:[],dialogStyles:[]},this},WYMeditor.WymCssParser.prototype.parse=function(t,e){var e=void 0===e?this.only_wym_blocks:e;this._Lexer=new WYMeditor.WymCssLexer(this,e),this._Lexer.parse(t)},WYMeditor.WymCssParser.prototype.Ignore=function(t,e){return!0},WYMeditor.WymCssParser.prototype.WymCssComment=function(t,e){return!t.match(/end[a-z0-9\s]*wym[a-z0-9\s]*/im)&&(e==WYMeditor.LEXER_UNMATCHED&&(this._in_style?this._current_item[this._current_element]&&(this._current_item[this._current_element].expressions?this._current_item[this._current_element].expressions.push(t):this._current_item[this._current_element].expressions=[t]):(this._has_title=!0,this._current_item={title:WYMeditor.Helper.trim(t)}),this._in_style=!0),!0)},WYMeditor.WymCssParser.prototype.WymCssStyle=function(t,e){return e==WYMeditor.LEXER_UNMATCHED?""!=(t=WYMeditor.Helper.trim(t))&&(this._current_item[this._current_element].style=t):e==WYMeditor.LEXER_EXIT&&(this._in_style=!1,this._has_title=!1,this.addStyleSetting(this._current_item)),!0},WYMeditor.WymCssParser.prototype.WymCssFeedbackStyle=function(t,e){return e==WYMeditor.LEXER_UNMATCHED&&(this._current_item[this._current_element].feedback_style=t.replace(/^([\s\/\*]*)|([\s\/\*]*)$/gm,"")),!0},WYMeditor.WymCssParser.prototype.WymCssStyleDeclaration=function(t){t=t.replace(/^([\s\.]*)|([\s\.*]*)$/gm,"");var e="";if(t.indexOf(".")>0){var n=t.split(".");this._current_element=n[1];var e=n[0]}else this._current_element=t;return this._has_title||(this._current_item={title:(e?e.toUpperCase()+": ":"")+this._current_element},this._has_title=!0),this._current_item[this._current_element]||(this._current_item[this._current_element]={name:this._current_element}),e&&(this._current_item[this._current_element].tags?this._current_item[this._current_element].tags.push(e):this._current_item[this._current_element].tags=[e]),!0},WYMeditor.WymCssParser.prototype.addStyleSetting=function(t){for(var e in t){var n=t[e];"object"==typeof n&&"title"!=e&&(this.css_settings.classesItems.push({name:WYMeditor.Helper.trim(n.name),title:t.title,expr:WYMeditor.Helper.trim((n.expressions||n.tags).join(", "))}),n.feedback_style&&this.css_settings.editorStyles.push({name:"."+WYMeditor.Helper.trim(n.name),css:n.feedback_style}),n.style&&this.css_settings.dialogStyles.push({name:"."+WYMeditor.Helper.trim(n.name),css:n.style}))}},jQuery.fn.isPhantomNode=function(){return 3==this[0].nodeType&&!/[^\t\n\r ]/.test(this[0].data)},WYMeditor.isPhantomNode=function(t){return 3==t.nodeType&&!/[^\t\n\r ]/.test(t.data)},WYMeditor.isPhantomString=function(t){return!/[^\t\n\r ]/.test(t)},jQuery.fn.parentsOrSelf=function(t){var e=this;return 3==e[0].nodeType&&(e=e.parents().slice(0,1)),1==e.filter(t).size()?e:e.parents(t).slice(0,1)},WYMeditor.Helper={replaceAll:function(t,e,n){var i=new RegExp(e,"g");return t.replace(i,n)},insertAt:function(t,e,n){return t.substr(0,n)+e+t.substring(n)},trim:function(t){return t.replace(/^(\s*)|(\s*)$/gm,"")},contains:function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},indexOf:function(t,e){for(var n=-1,i=0;i<t.length;i++)if(t[i]==e){n=i;break}return n},findByName:function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.name==e)return i}return null}},WYMeditor.WymClassExplorer=function(t){this._wym=t,this._class="className",this._newLine="\r\n"},WYMeditor.WymClassExplorer.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),jQuery(this._doc.body).html(this._wym._html);var wym=this;this._doc.body.onfocus=function(){wym._doc.designMode="on",wym._doc=iframe.contentWindow.document},this._doc.onbeforedeactivate=function(){wym.saveCaret()},this._doc.onkeyup=function(){wym.saveCaret(),wym.keyup()},this._doc.onclick=function(){wym.saveCaret()},this._doc.body.onbeforepaste=function(){wym._iframe.contentWindow.event.returnValue=!1},this._doc.body.onpaste=function(){wym._iframe.contentWindow.event.returnValue=!1,wym.paste(window.clipboardData.getData("Text"))},this._initialized&&(jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()),this._initialized=!0,this._doc.designMode="on";try{this._doc=iframe.contentWindow.document}catch(t){}},WYMeditor.WymClassExplorer.prototype._exec=function(t,e){switch(t){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.findUp(this.container(),WYMeditor.LI);if(n){var i=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||i.tagName.toLowerCase()==WYMeditor.OL||i.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(t)}break;default:e?this._doc.execCommand(t,!1,e):this._doc.execCommand(t)}this.listen()},WYMeditor.WymClassExplorer.prototype.selected=function(){var t=this._iframe.contentWindow.document.caretPos;if(null!=t&&void 0!=t.parentElement)return t.parentElement()},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.addCssRule=function(t,e){t.addRule(e.name,e.css)},WYMeditor.WymClassExplorer.prototype.insert=function(t){var e=this._doc.selection.createRange();if(jQuery(e.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{e.pasteHTML(t)}catch(t){}else this.paste(t)},WYMeditor.WymClassExplorer.prototype.wrap=function(t,e){var n=this._doc.selection.createRange();if(jQuery(n.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{n.pasteHTML(t+n.text+e)}catch(t){}},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var t=this._doc.selection.createRange();if(jQuery(t.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{var e=t.text;this._exec("Cut"),t.pasteHTML(e)}catch(t){}},WYMeditor.WymClassExplorer.prototype.keyup=function(){this._selected_image=null},WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(t){var e=this._doc.selection.createRange();e.moveToElementText(t),e.collapse(!1),e.move("character",-1),e.select(),t.focus()},WYMeditor.WymClassMozilla=function(t){this._wym=t,this._class="class",this._newLine="\n"},WYMeditor.WymClassMozilla.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this.html(this._wym._html),this.enableDesignMode(),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery(this._doc).bind("focus",this.enableDesignMode),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassMozilla.prototype.html=function(t){if("string"!=typeof t)return jQuery(this._doc.body).html();try{this._doc.designMode="off"}catch(t){}t=t.replace(/<em(\b[^>]*)>/gi,"<i$1>").replace(/<\/em>/gi,"</i>").replace(/<strong(\b[^>]*)>/gi,"<b$1>").replace(/<\/strong>/gi,"</b>"),jQuery(this._doc.body).html(t),this.enableDesignMode()},WYMeditor.WymClassMozilla.prototype._exec=function(t,e){if(!this.selected())return!1;switch(t){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.selected(),i=this._iframe.contentWindow.getSelection(),r=i.anchorNode;if("#text"==r.nodeName&&(r=r.parentNode),n=this.findUp(n,WYMeditor.BLOCKS),r=this.findUp(r,WYMeditor.BLOCKS),n&&n==r&&n.tagName.toLowerCase()==WYMeditor.LI){var a=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||a.tagName.toLowerCase()==WYMeditor.OL||a.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(t,"",null)}break;default:e?this._doc.execCommand(t,"",e):this._doc.execCommand(t,"",null)}this.selected().tagName.toLowerCase()==WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.listen()},WYMeditor.WymClassMozilla.prototype.selected=function(){var t=this._iframe.contentWindow.getSelection(),e=t.focusNode;return e?"#text"==e.nodeName?e.parentNode:e:null},WYMeditor.WymClassMozilla.prototype.addCssRule=function(t,e){t.insertRule(e.name+" {"+e.css+"}",t.cssRules.length)},WYMeditor.WymClassMozilla.prototype.keydown=function(t){var e=WYMeditor.INSTANCES[this.title],n=null;if(t.keyCode===WYMeditor.KEY.ENTER&&(n=e.selected())){var i=$(n),r=(i.parent(),i.parents(".embedded-item"));if(r.size()){var a=$("<p/>");return i.hasClass("title")?r.before(a):i.hasClass("content")&&r.after(a),e.setFocusToNode(a.get(0)),!1}}if(t.ctrlKey){if(66==t.keyCode)return e._exec(WYMeditor.BOLD),!1;if(73==t.keyCode)return e._exec(WYMeditor.ITALIC),!1}else 13==t.keyCode&&(t.shiftKey||(n=e.selected())&&n.tagName.toLowerCase()==WYMeditor.PRE&&(t.preventDefault(),e.insert("<p></p>")))},WYMeditor.WymClassMozilla.prototype.keyup=function(t){var e=WYMeditor.INSTANCES[this.title];e._selected_image=null;var n=null;if(13!=t.keyCode||t.shiftKey){if(8!=t.keyCode&&17!=t.keyCode&&46!=t.keyCode&&224!=t.keyCode&&!t.metaKey&&!t.ctrlKey){n=e.selected();var i=n.tagName.toLowerCase();"strong"!=i&&"b"!=i&&"em"!=i&&"i"!=i&&"sub"!=i&&"sup"!=i&&"a"!=i||(i=n.parentNode.tagName.toLowerCase()),i==WYMeditor.BODY&&e._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)}}else jQuery(e._doc.body).children(WYMeditor.BR).remove()},WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){if("off"==this.designMode)try{this.designMode="on",this.execCommand("styleWithCSS","",!1)}catch(t){}},WYMeditor.WymClassMozilla.prototype.setFocusToNode=function(t){var e=document.createRange();e.selectNode(t);var n=this._iframe.contentWindow.getSelection();n.addRange(e),n.collapse(t,t.childNodes.length),this._iframe.contentWindow.focus()},WYMeditor.WymClassMozilla.prototype.openBlockTag=function(t,e){var e=this.validator.getValidTagAttributes(t,e);if("span"==t&&e.style){var n=this.getTagForStyle(e.style);if(!n)return;this._tag_stack.pop();var t=n;this._tag_stack.push(n),e.style=""}this.output+=this.helper.tag(t,e,!0)},WYMeditor.WymClassMozilla.prototype.getTagForStyle=function(t){return/bold/.test(t)?"strong":/italic/.test(t)?"em":/sub/.test(t)?"sub":!!/sub/.test(t)&&"super"},WYMeditor.WymClassOpera=function(t){this._wym=t,this._class="class",this._newLine="\r\n"},WYMeditor.WymClassOpera.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassOpera.prototype._exec=function(t,e){e?this._doc.execCommand(t,!1,e):this._doc.execCommand(t),this.listen()},WYMeditor.WymClassOpera.prototype.selected=function(){var t=this._iframe.contentWindow.getSelection(),e=t.focusNode;return e?"#text"==e.nodeName?e.parentNode:e:null},WYMeditor.WymClassOpera.prototype.addCssRule=function(t,e){t.insertRule(e.name+" {"+e.css+"}",t.cssRules.length)},WYMeditor.WymClassOpera.prototype.keydown=function(t){var e=WYMeditor.INSTANCES[this.title],n=e._iframe.contentWindow.getSelection();startNode=n.getRangeAt(0).startContainer,jQuery(startNode).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]||jQuery(startNode).parentsOrSelf("li")||t.keyCode==WYMeditor.KEY.ENTER||t.keyCode==WYMeditor.KEY.LEFT||t.keyCode==WYMeditor.KEY.UP||t.keyCode==WYMeditor.KEY.RIGHT||t.keyCode==WYMeditor.KEY.DOWN||t.keyCode==WYMeditor.KEY.BACKSPACE||t.keyCode==WYMeditor.KEY.DELETE||e._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassOpera.prototype.keyup=function(t){WYMeditor.INSTANCES[this.title]._selected_image=null},WYMeditor.WymClassOpera.prototype.setFocusToNode=function(t){},WYMeditor.WymClassSafari=function(t){this._wym=t,this._class="class",this._newLine="\n"},WYMeditor.WymClassSafari.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentDocument;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this.html(this._wym._html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()},WYMeditor.WymClassSafari.prototype._exec=function(t,e){if(!this.selected())return!1;switch(t){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var n=this.selected(),i=this._iframe.contentWindow.getSelection(),r=i.anchorNode;if("#text"==r.nodeName&&(r=r.parentNode),n=this.findUp(n,WYMeditor.BLOCKS),r=this.findUp(r,WYMeditor.BLOCKS),n&&n==r&&n.tagName.toLowerCase()==WYMeditor.LI){var a=n.parentNode.parentNode;(n.parentNode.childNodes.length>1||a.tagName.toLowerCase()==WYMeditor.OL||a.tagName.toLowerCase()==WYMeditor.UL)&&this._doc.execCommand(t,"",null)}break;case WYMeditor.INSERT_ORDEREDLIST:case WYMeditor.INSERT_UNORDEREDLIST:this._doc.execCommand(t,"",null);var n=this.selected(),o=this.findUp(n,WYMeditor.MAIN_CONTAINERS);o&&jQuery(o).replaceWith(jQuery(o).html());break;default:e?this._doc.execCommand(t,"",e):this._doc.execCommand(t,"",null)}var o=this.selected();o&&o.tagName.toLowerCase()==WYMeditor.BODY&&this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.listen()},WYMeditor.WymClassSafari.prototype.selected=function(){var t=this._iframe.contentWindow.getSelection(),e=t.focusNode;return e?"#text"==e.nodeName?e.parentNode:e:null},WYMeditor.WymClassSafari.prototype.addCssRule=function(t,e){t.insertRule(e.name+" {"+e.css+"}",t.cssRules.length)},WYMeditor.WymClassSafari.prototype.keydown=function(t){var e=WYMeditor.INSTANCES[this.title];if(t.keyCode===WYMeditor.KEY.ENTER){var n=e.selected();if(n){var i=$(n),r=(i.parent(),i.parents(".embedded-item"));if(r.size()){var a=$("<p/>");return i.hasClass("title")?r.before(a):i.hasClass("content")&&r.after(a),e.setFocusToNode(a.get(0)),!1}}}if(t.ctrlKey){if(66==t.keyCode)return e._exec(WYMeditor.BOLD),!1;if(73==t.keyCode)return e._exec(WYMeditor.ITALIC),!1}},WYMeditor.WymClassSafari.prototype.keyup=function(t){var e=WYMeditor.INSTANCES[this.title];e._selected_image=null;var n=null;if(13!=t.keyCode||t.shiftKey||(jQuery(e._doc.body).children(WYMeditor.BR).remove(),(n=e.selected())&&n.tagName.toLowerCase()==WYMeditor.PRE&&e._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)),13==t.keyCode&&t.shiftKey&&e._exec("InsertLineBreak"),8!=t.keyCode&&17!=t.keyCode&&46!=t.keyCode&&224!=t.keyCode&&!t.metaKey&&!t.ctrlKey){n=e.selected();var i=n.tagName.toLowerCase();"strong"!=i&&"b"!=i&&"em"!=i&&"i"!=i&&"sub"!=i&&"sup"!=i&&"a"!=i&&"span"!=i||(i=n.parentNode.tagName.toLowerCase()),i!=WYMeditor.BODY&&i!=WYMeditor.DIV||e._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)}},WYMeditor.WymClassSafari.prototype.setFocusToNode=function(t){var e=this._iframe.contentDocument.createRange();e.selectNode(t);var n=this._iframe.contentWindow.getSelection();n.addRange(e),n.collapse(t,t.childNodes.length),this._iframe.contentWindow.focus()},WYMeditor.WymClassSafari.prototype.openBlockTag=function(t,e){var e=this.validator.getValidTagAttributes(t,e);if("span"==t&&e.style){var n=this.getTagForStyle(e.style);if(!n)return;this._tag_stack.pop();var t=n;this._tag_stack.push(n),e.style="","string"==typeof e.class&&(e.class=e.class.replace(/apple-style-span/gi,""))}this.output+=this.helper.tag(t,e,!0)},WYMeditor.WymClassSafari.prototype.getTagForStyle=function(t){return/bold/.test(t)?"strong":/italic/.test(t)?"em":/sub/.test(t)?"sub":!!/super/.test(t)&&"sup"},window.WYMeditor=WYMeditor}).call(exports,__webpack_require__(0),__webpack_require__(0))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(749),l=o(s),c=n(751),d=o(c),u=n(752),h=o(u),f=n(58),p=o(f),_=n(6),g=o(_),m=n(3);o(m);n(192);window.JobDAG=l.default;var v=t.View.extend(g.default.LoggableMixin).extend({_logNamespace:"history",className:"history-structure-component",_INITIAL_ZOOM_LEVEL:1,_MIN_ZOOM_LEVEL:.25,_LINK_ID_SEP:"-to-",_VERTEX_NAME_DATA_KEY:"vertex-name",JobItemClass:h.default.JobListItemView,ContentItemClass:p.default.DatasetListItemView,initialize:function(t){this.log(this+"(HistoryStructureComponent).initialize:",t),this.component=t.component,this._liMap={},this._createVertexItems(),this.zoomLevel=t.zoomLevel||this._INITIAL_ZOOM_LEVEL,this.layout=this._createLayout(t.layoutOptions)},_createVertexItems:function(){var t=this;t.component.eachVertex(function(e){var n,i=e.data.job?"job":"copy";"job"===i?n=t._createJobListItem(e):"copy"===i&&(n=t._createContentListItem(e)),t._liMap[e.name]=n}),t.debug("_liMap:",t._liMap)},_createJobListItem:function(t){this.debug("_createJobListItem:",t);var e=this,n=t.data,r=new d.default.Job(n.job),a=i.map(r.get("outputs"),function(t){return e.model.contents.get(t.type_id)});r.outputCollection.reset(a),r.outputCollection.historyId=e.model.id;var o=new e.JobItemClass({model:r,tool:n.tool,jobData:n});return e.listenTo(o,"expanding expanded collapsing collapsed",e.renderGraph),e.listenTo(o.foldout,"view:expanding view:expanded view:collapsing view:collapsed",e.renderGraph),o},_createContentListItem:function(t){this.debug("_createContentListItem:",t);var e=this,n=t.data;n=e.model.contents.get(n.type_id);var i=new e.ContentItemClass({model:n});return e.listenTo(i,"expanding expanded collapsing collapsed",e.renderGraph),i},layoutDefaults:{linkSpacing:16,linkWidth:0,linkHeight:0,jobWidth:300,jobHeight:300,jobSpacing:12,linkAdjX:4,linkAdjY:0},_createLayout:function(t){t=i.defaults(i.clone(t||{}),this.layoutDefaults);var e=this,n=i.values(e.component.vertices),r=i.extend(t,{nodeMap:{},links:[],svg:{width:0,height:0}});return n.forEach(function(t,e){var n={name:t.name,x:0,y:0};r.nodeMap[t.name]=n}),e.component.edges(function(t){var e={source:t.source,target:t.target};r.links.push(e)}),r},render:function(t){this.debug(this+".render:",t);var e=this;e.$el.html(["<header></header>",'<nav class="controls"></nav>','<figure class="graph"></figure>',"<footer></footer>"].join(""));var n=e.$graph();return e.component.eachVertex(function(t){e._liMap[t.name].render(0).$el.appendTo(n).data(e._VERTEX_NAME_DATA_KEY,t.name)}),e.renderGraph(),this},$graph:function(){return this.$(".graph")},renderGraph:function(t){function e(){n._updateLayout(),n.$graph().css("transform",["scale(",n.zoomLevel,",",n.zoomLevel,")"].join("")).width(n.layout.svg.width).height(n.layout.svg.height),n.renderSVG(),n.component.eachVertex(function(t){var e=n._liMap[t.name],i=n.layout.nodeMap[t.name];e.$el.css({top:i.y,left:i.x})})}this.debug(this+".renderGraph:",t);var n=this;return this.$el.is(":visible")?e():i.delay(e,0),this},_updateLayout:function(){this.debug(this+"._updateLayout:");var t=this,e=t.layout;e.linkHeight=e.linkSpacing*i.size(e.nodeMap),e.svg.height=e.linkHeight+e.jobHeight,e.svg.width=0;var n=0,r=e.linkHeight;return i.each(e.nodeMap,function(t,i){t.x=n,t.y=r,n+=e.jobWidth+e.jobSpacing}),e.svg.width=e.linkWidth=Math.max(e.svg.width,n),e.links.forEach(function(t){var n=e.nodeMap[t.source],i=e.nodeMap[t.target];t.x1=n.x+e.linkAdjX,t.y1=n.y+e.linkAdjY,t.x2=i.x+e.linkAdjX,t.y2=i.y+e.linkAdjY}),this.debug(JSON.stringify(e,null,"  ")),this.layout},renderSVG:function(){function t(t){d3.select(this).classed("highlighted",!0),n._liMap[t.source].$el.addClass("highlighted"),n._liMap[t.target].$el.addClass("highlighted")}function e(t){d3.select(this).classed("highlighted",!1),n._liMap[t.source].$el.removeClass("highlighted"),n._liMap[t.target].$el.removeClass("highlighted")}this.debug(this+".renderSVG:");var n=this,i=n.layout,r=d3.select(this.$graph().get(0)).select("svg");r.empty()&&(r=d3.select(this.$graph().get(0)).append("svg")),r.attr("width",i.svg.width).attr("height",i.svg.height);var a=r.selectAll(".connection").data(i.links);return a.enter().append("path").attr("class","connection").attr("id",function(t){return[t.source,t.target].join(n._LINK_ID_SEP)}).on("mouseover",t).on("mouseout",e),a.attr("d",function(t){return n._connectionPath(t)}),r.node()},_connectionPath:function(t){var e=(t.x2-t.x1)/this.layout.svg.width*this.layout.linkHeight;return["M",t.x1,",",t.y1," ","C",t.x1+0,",",t.y1-e," ",t.x2-0,",",t.y2-e," ",t.x2,",",t.y2].join("")},events:{"mouseover .graph > .list-item":function(t){this.highlightConnected(t.currentTarget,!0)},"mouseout  .graph > .list-item":function(t){this.highlightConnected(t.currentTarget,!1)}},highlightConnected:function(t,e){this.debug("highlightConnected",t,e),e=void 0===e||e;var n=this,i=n.component,o=e?r.prototype.addClass:r.prototype.removeClass,s=e?"connection highlighted":"connection",l=o.call(a(t),"highlighted"),c=l.data(n._VERTEX_NAME_DATA_KEY);i.edges({target:c}).forEach(function(t){var e=t.source,i=n._liMap[e];o.call(i.$el,"highlighted"),n.$("#"+e+n._LINK_ID_SEP+c).attr("class",s)}),i.vertices[c].eachEdge(function(t){var e=t.target,i=n._liMap[e];o.call(i.$el,"highlighted"),n.$("#"+c+n._LINK_ID_SEP+e).attr("class",s)})},zoom:function(t){return this.zoomLevel=Math.min(1,Math.max(this._MIN_ZOOM_LEVEL,t)),this.renderGraph()},toString:function(){return"HistoryStructureComponent("+this.model.id+")"}}),y=v.extend({className:v.prototype.className+" vertical",layoutDefaults:i.extend(i.clone(v.prototype.layoutDefaults),{linkAdjX:0,linkAdjY:4}),_updateLayout:function(){this.debug(this+"._updateLayout:");var t=this,e=t.layout;e.linkWidth=e.linkSpacing*i.size(e.nodeMap),e.svg.width=e.linkWidth+e.jobWidth,e.svg.height=0;var n=e.linkWidth,r=0;return i.each(e.nodeMap,function(i,a){i.x=n,i.y=r;var o=t._liMap[a];r+=o.$el.height()+e.jobSpacing}),e.linkHeight=e.svg.height=Math.max(e.svg.height,r),e.links.forEach(function(t){var n=e.nodeMap[t.source],i=e.nodeMap[t.target];t.x1=n.x+e.linkAdjX,t.y1=n.y+e.linkAdjY,t.x2=i.x+e.linkAdjX,t.y2=i.y+e.linkAdjY}),this.debug(JSON.stringify(e,null,"  ")),e},_connectionPath:function(t){var e=(t.y2-t.y1)/this.layout.svg.height*this.layout.linkWidth;return["M",t.x1,",",t.y1," ","C",t.x1-e,",",t.y1+0," ",t.x2-e,",",t.y2-0," ",t.x2,",",t.y2].join("")},toString:function(){return"VerticalHistoryStructureComponent("+this.model.id+")"}}),b=t.View.extend(g.default.LoggableMixin).extend({_logNamespace:"history",className:"history-structure",_layoutToComponentClass:{horizontal:v,vertical:y},_DEFAULT_LAYOUT:"vertical",initialize:function(t){this.layout=i.contains(t.layout,i.keys(this._layoutToComponentClass))?t.layout:this._DEFAULT_LAYOUT,this.log(this+"(HistoryStructureView).initialize:",t,this.model),this._processTools(t.tools),this._processJobs(t.jobs),this._createDAG()},_processTools:function(t){return this.tools=t||{},this.tools},_processJobs:function(t){return this.jobs=t||[],this.jobs},_createDAG:function(){this.dag=new l.default({historyContents:this.model.contents.toJSON(),tools:this.tools,jobs:this.jobs,excludeSetMetadata:!0,excludeErroredJobs:!0}),this.debug(this+".dag:",this.dag),this._createComponents()},_createComponents:function(){this.log(this+"._createComponents");var t=this;return t.componentViews=t.dag.weakComponentGraphArray().map(function(e){return t._createComponent(e)}),t.componentViews},_createComponent:function(t){return this.log(this+"._createComponent:",t),new(0,this._layoutToComponentClass[this.layout])({model:this.model,component:t})},render:function(t){this.log(this+".render:",t);var e=this;return e.$el.addClass("clear").html(['<div class="controls"></div>','<div class="components"></div>'].join("")),e.componentViews.forEach(function(t){t.render().$el.appendTo(e.$components())}),e},$components:function(){return this.$(".components")},changeLayout:function(t){if(!(t in this._layoutToComponentClass))throw new Error(this+": unknown layout: "+t);return this.layout=t,this._createComponents(),this.render()},toString:function(){return"HistoryStructureView("+this.model.id+")"}});e.default=b}).call(e,n(2),n(1),n(0),n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(750),a=i(r),o=n(71),s=i(o),l=a.default.Graph,c=function(e){e=e||{};var n=this;n.filters=[],n._jobsData=[],n._historyContentsMap={},n._toolMap={},n._outputIdToJobMap={},n.noInputJobs=[],n.noOutputJobs=[],n.filteredSetMetadata=[],n.filteredErroredJobs=[],n.dataKeys=["jobs","historyContents","tools"],l.call(n,!0,t.pick(e,n.dataKeys),t.omit(e,n.dataKeys))};c.prototype=new a.default.Graph,c.prototype.constructor=c,(0,s.default)(c),c.prototype.init=function(e){e=e||{};var n=this;return n.options=t.defaults(e,{excludeSetMetadata:!1}),n.filters=n._initFilters(),l.prototype.init.call(n,e),n},c.prototype._initFilters=function(){var e=this,n=[];return e.options.excludeSetMetadata&&(e.filteredSetMetadata=[],n.push(function(t){return"__SET_METADATA__"!==t.job.tool_id||(e.filteredSetMetadata.push(t.job.id),!1)})),e.options.excludeErroredJobs&&(e.filteredErroredJobs=[],n.push(function(t){return"error"!==t.job.state||(e.filteredErroredJobs.push(t.job.id),!1)})),t.isArray(e.options.filters)&&(n=n.concat(e.options.filters)),e.debug("filters len:",n.length),n},c.prototype.read=function(e){var n=this;return t.has(e,"historyContents")&&t.has(e,"jobs")&&t.has(e,"tools")?(n.preprocessHistoryContents(e.historyContents||[]).preprocessTools(e.tools||{}).preprocessJobs(e.jobs||[]),n.createGraph(n._filterJobs()),n):l.prototype.read.call(this,e)},c.prototype.preprocessHistoryContents=function(e){this.info("processing history");var n=this;return n._historyContentsMap={},e.forEach(function(e,i){n._historyContentsMap[e.id]=t.clone(e)}),n},c.prototype.preprocessTools=function(e){this.info("processing tools");var n=this;return n._toolMap={},t.each(e,function(e,i){n._toolMap[i]=t.clone(e)}),n},c.prototype.preprocessJobs=function(e){this.info("processing jobs");var n=this;return n._outputIdToJobMap={},n._jobsData=n.sort(e).map(function(e){return n.preprocessJob(t.clone(e))}),n},c.prototype.sort=function(t){function e(t,e){return t.create_time>e.create_time?1:t.create_time<e.create_time?-1:0}return t.sort(e)},c.prototype.preprocessJob=function(e,n){var i=this,r={job:e};return r.inputs=i._processInputs(e),0===t.size(r.inputs)&&i.noInputJobs.push(e.id),r.outputs=i._processOutputs(e),0===t.size(r.outputs)&&i.noOutputJobs.push(e.id),r.tool=i._toolMap[e.tool_id],r},c.prototype._processInputs=function(e){var n=this,i=e.inputs,r={};return t.each(i,function(e,i){e=t.clone(n._validateInputOutput(e)),e.name=i,e.content=n._historyContentsMap[e.id],r[e.id]=e}),r},c.prototype._validateInputOutput=function(t){if(!t.id)throw new Error("No id on job input/output: ",JSON.stringify(t));if(!t.src||"hda"!==t.src)throw new Error("Bad src on job input/output: ",JSON.stringify(t));return t},c.prototype._processOutputs=function(e){var n=this,i=e.outputs,r={};return t.each(i,function(i,a){i=t.clone(n._validateInputOutput(i)),i.name=a,i.content=n._historyContentsMap[i.id],r[i.id]=i,n._outputIdToJobMap[i.id]=e.id}),r},c.prototype._filterJobs=function(){var t=this;return t._jobsData.filter(function(e,n){return t._filterJob(e,n)})},c.prototype._filterJob=function(t,e){for(var n=this,i=0;i<n.filters.length;i++)if(!n.filters[i].call(n,t))return n.debug("\t job",t.job.id," has been filtered out by function:\n",n.filters[i]),!1;return!0},c.prototype.createGraph=function(e){var n=this;return n.debug("connections:"),t.each(e,function(t){var e=t.job.id;n.debug("\t",e,t),n.createVertex(e,t)}),t.each(e,function(e){var i=e.job.id;t.each(e.inputs,function(t,e){var r=n._outputIdToJobMap[e];if(!r){r=n.createJobLessVertex(e).name}n.createEdge(r,i,n.directed,{dataset:e})})}),n.debug("final graph: ",JSON.stringify(n.toVerticesAndEdges(),null,"  ")),n},c.prototype.createJobLessVertex=function(t){var e="copy-"+t;return this.createVertex(e,this._historyContentsMap[t])},c.prototype.weakComponentGraphArray=function(){var t=this;return this.weakComponents().map(function(e){return e.vertices.sort(function(t,e){var n=t.data.job?t.data.job.create_time:t.data.create_time,i=e.data.job?e.data.job.create_time:e.data.create_time;return n>i?1:n<i?-1:0}),new Graph(t.directed,e)})},c.prototype._jobsDataMap=function(){var t={};return this._jobsData.forEach(function(e){t[e.job.id]=e}),t},e.default=c}).call(e,n(1))},function(t,e,n){"use strict";function i(t,e){for(var n in e)if(e.hasOwnProperty(n)&&(!t.hasOwnProperty(n)||t[n]!==e[n]))return!1;return!0}function r(t,e){var n="function"==typeof e?e:void 0,r="object"===(void 0===e?"undefined":c(e))?e:void 0,a=[],o=0;for(var s in t)if(t.hasOwnProperty(s)){var l=t[s];n?a.push(n.call(l,l,s,o)):r?"object"===(void 0===l?"undefined":c(l))&&i(l,r)&&a.push(l):a.push(l),o+=1}return a}function a(t,e,n){var i=this;return i.source=void 0!==t?t:null,i.target=void 0!==e?e:null,i.data=n||null,i}function o(t,e){var n=this;return n.name=void 0!==t?t:"(unnamed)",n.data=e||null,n.edges={},n.degree=0,n}function s(t,e,n){return this.directed=t||!1,this.init(n).read(e)}function l(t,e,n){function i(t){return Math.floor(Math.random()*t)}for(var r={nodes:[],links:[]},a=0;a<e;a++)r.nodes.push({name:a});for(a=0;a<n;a++)r.links.push({source:i(e),target:i(e)});return new s(t,r)}Object.defineProperty(e,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};a.prototype.toString=function(){return this.source+"->"+this.target},a.prototype.toJSON=function(){var t={source:this.source,target:this.target};return this.data&&(t.data=this.data),t},o.prototype.toString=function(){return"Vertex("+this.name+")"},o.prototype.eachEdge=function(t){return r(this.edges,t)},o.prototype.toJSON=function(){return{name:this.name,data:this.data}};var d=function(t,e){var n=this;return n.graph=t,n.processFns=e||{vertexEarly:function(t,e){},edge:function(t,e,n){},vertexLate:function(t,e){}},n._cache={},n};d.prototype.search=function(t){var e=this;return t in e._cache?e._cache[t]:(t instanceof o||(t=e.graph.vertices[t]),e._cache[t.name]=e._search(t))},d.prototype._search=function(t,e){return e=e||{discovered:{},edges:[]}},d.prototype.searchTree=function(t){return this._searchTree(this.search(t))},d.prototype._searchTree=function(t){var e=this;return new s(!0,{edges:t.edges,vertices:Object.keys(t.discovered).map(function(t){return e.graph.vertices[t].toJSON()})})};var u=function(t,e){var n=this;return d.call(this,t,e),n};u.prototype=new d,u.prototype.constructor=u,u.prototype._search=function(t,e){function n(t,n){var a=this;i.processFns.edge&&i.processFns.edge.call(i,a,n,e),e.discovered[t.name]||(e.discovered[t.name]=!0,e.edges.push({source:a.name,target:t.name}),r.push(t))}e=e||{discovered:{},edges:[]};var i=this,r=[];for(e.discovered[t.name]=!0,r.push(t);r.length;){var a=r.shift();i.processFns.vertexEarly&&i.processFns.vertexEarly.call(i,a,e),i.graph.eachAdjacent(a,n),i.processFns.vertexLate&&i.processFns.vertexLate.call(i,a,e)}return e};var h=function(t,e){var n=this;return d.call(this,t,e),n};h.prototype=new d,h.prototype.constructor=h,h.prototype._search=function(t,e){function n(t,n){var a=this;r.processFns.edge&&r.processFns.edge.call(r,a,n,e),e.discovered[t.name]||(e.edges.push({source:a.name,target:t.name}),i(t))}function i(t){e.discovered[t.name]=!0,r.processFns.vertexEarly&&r.processFns.vertexEarly.call(r,t,e),e.entryTimes[t.name]=a++,r.graph.eachAdjacent(t,n),r.processFns.vertexLate&&r.processFns.vertexLate.call(r,t,e),e.exitTimes[t.name]=a++}e=e||{discovered:{},edges:[],entryTimes:{},exitTimes:{}};var r=this,a=0;return i(t),e},window.Graph=s,s.prototype.init=function(t){t=t||{};var e=this;return e.allowReflexiveEdges=t.allowReflexiveEdges||!1,e.vertices={},e.numEdges=0,e},s.prototype.read=function(t){if(!t)return this;var e=this;return t.hasOwnProperty("nodes")?e.readNodesAndLinks(t):t.hasOwnProperty("vertices")?e.readVerticesAndEdges(t):e},s.prototype.readNodesAndLinks=function(t){if(!t||!t.hasOwnProperty("nodes"))return this;var e=this;return t.nodes.forEach(function(t){e.createVertex(t.name,t.data)}),(t.links||[]).forEach(function(n,i){var r=t.nodes[n.source].name,a=t.nodes[n.target].name;e.createEdge(r,a,e.directed)}),e},s.prototype.readVerticesAndEdges=function(t){if(!t||!t.hasOwnProperty("vertices"))return this;var e=this;return t.vertices.forEach(function(t){e.createVertex(t.name,t.data)}),(t.edges||[]).forEach(function(t,n){e.createEdge(t.source,t.target,e.directed)}),e},s.prototype.createVertex=function(t,e){return this.vertices[t]?this.vertices[t]:this.vertices[t]=new o(t,e)},s.prototype.createEdge=function(t,e,n,i){var r=t===e;if(!this.allowReflexiveEdges&&r)return null;var o=this.vertices[t],s=this.vertices[e];if(!o||!s)return null;var l=this,c=new a(t,e,i);return o.edges[e]=c,o.degree+=1,l.numEdges+=1,r||n||l.createEdge(e,t,!0),c},s.prototype.edges=function(t){return Array.prototype.concat.apply([],this.eachVertex(function(e){return e.eachEdge(t)}))},s.prototype.eachVertex=function(t){return r(this.vertices,t)},s.prototype.adjacent=function(t){var e=this;return r(t.edges,function(t){return e.vertices[t.target]})},s.prototype.eachAdjacent=function(t,e){var n=this;return r(t.edges,function(i){var r=n.vertices[i.target];return e.call(t,r,i)})},s.prototype.print=function(){var t=this;return console.log("Graph has "+Object.keys(t.vertices).length+" vertices"),t.eachVertex(function(t){console.log(t.toString()),t.eachEdge(function(t){console.log("\t "+t)})}),t},s.prototype.toDOT=function(){var t=this,e=[];return e.push("graph bler {"),t.edges(function(t){e.push("\t"+t.from+" -- "+t.to+";")}),e.push("}"),e.join("\n")},s.prototype.toNodesAndLinks=function(){var t=this,e={};return{nodes:t.eachVertex(function(t,n,i){return e[t.name]=i,t.toJSON()}),links:t.edges(function(t){var n=t.toJSON();return n.source=e[t.source],n.target=e[t.target],n})}},s.prototype.toVerticesAndEdges=function(){var t=this;return{vertices:t.eachVertex(function(t,e){return t.toJSON()}),edges:t.edges(function(t){return t.toJSON()})}},s.prototype.breadthFirstSearch=function(t,e){return new u(this).search(t)},s.prototype.breadthFirstSearchTree=function(t,e){return new u(this).searchTree(t)},s.prototype.depthFirstSearch=function(t,e){return new h(this).search(t)},s.prototype.depthFirstSearchTree=function(t,e){return new h(this).searchTree(t)},s.prototype.weakComponents=function(){var t,e=this,n=this,i=[];for(e.directed&&(n=new s(!1,e.toNodesAndLinks())),t=Object.keys(n.vertices);t.length;){var r=n.vertices[t.shift()];i.push(function(i){var r=new h(n)._search(i);return t=t.filter(function(t){return!(t in r.discovered)}),{vertices:Object.keys(r.discovered).map(function(t){return e.vertices[t].toJSON()}),edges:r.edges.map(function(t){var n=void 0!==e.vertices[t.target].edges[t.source];if(e.directed&&n){var i=t.source;t.source=t.target,t.target=i}return t})}}(r))}return i},s.prototype.weakComponentGraph=function(){var t=this.weakComponents();return new s(this.directed,{vertices:t.reduce(function(t,e){return t.concat(e.vertices)},[]),edges:t.reduce(function(t,e){return t.concat(e.edges)},[])})},s.prototype.weakComponentGraphArray=function(){var t=this;return this.weakComponents().map(function(e){return new s(t.directed,e)})},e.default={Vertex:o,Edge:a,BreadthFirstSearch:u,DepthFirstSearch:h,Graph:s,randGraph:l}},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(57),o=r(a),s=n(37),l=r(s),c=n(86),d=r(c),u=n(6),h=r(u),f=n(3),p=(r(f),h.default.SearchableModelMixin),_=t.Model.extend(h.default.LoggableMixin).extend(h.default.mixin(p,{_logNamespace:"jobs",defaults:{model_class:"Job",tool_id:null,exit_code:null,inputs:{},outputs:{},params:{},create_time:null,update_time:null,state:l.default.NEW},parse:function(t,e){return t.params=this.parseParams(t.params),t},parseParams:function(t){var e={};return i.each(t,function(t,n){e[n]=JSON.parse(t)}),e},initialize:function(t,e){this.debug(this+"(Job).initialize",t,e),this.set("params",this.parseParams(this.get("params")),{silent:!0}),this.outputCollection=t.outputCollection||new o.default.HistoryContents([]),this._setUpListeners()},_setUpListeners:function(){this.on("change:state",function(t,e){this.log(this+" has changed state:",t,e),this.inReadyState()&&this.trigger("state:ready",t,e,this.previous("state"))})},inReadyState:function(){return i.contains(l.default.READY_STATES,this.get("state"))},hasDetails:function(){return!i.isEmpty(this.get("outputs"))},urlRoot:Galaxy.root+"api/jobs",toString:function(){return["Job(",this.get("id"),":",this.get("tool_id"),")"].join("")}})),g=t.Collection.extend(h.default.LoggableMixin).extend({_logNamespace:"jobs",model:_,urlRoot:Galaxy.root+"api/jobs",url:function(){return this.urlRoot},intialize:function(t,e){console.debug(t,e)},ids:function(){return this.map(function(t){return t.get("id")})},notReady:function(){return this.filter(function(t){return!t.inReadyState()})},haveDetails:function(){return this.all(function(t){return t.hasDetails()})},queueDetailFetching:function(){var t=this,e=new d.default.AjaxQueue(this.map(function(t){return function(){return t.fetch({silent:!0})}}));return e.done(function(){t.trigger("details-loaded")}),e},matches:function(t){return this.filter(function(e){return e.matches(t)})},toString:function(){return["JobCollection(",this.length,")"].join("")}},{fromHistory:function(t){console.debug(this);var e=this,n=new e([]);return n.fetch({data:{history_id:t}}).done(function(){window.queue=n.queueDetailFetching()}),n}});e.default={Job:_,JobCollection:g}}).call(e,n(2),n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(67),a=i(r),o=n(753),s=i(o),l=n(6),c=i(l),d=n(3),u=i(d),h=a.default.FoldoutListItemView,f=h.extend({className:h.prototype.className+" job",id:function(){return["job",this.model.get("id")].join("-")},foldoutPanelClass:s.default.DatasetList,initialize:function(t){t.logger&&(this.logger=this.model.logger=t.logger),this.log(this+".initialize:",t),h.prototype.initialize.call(this,t),this.tool=t.tool||{},this.jobData=t.jobData||{},this.linkTarget=t.linkTarget||"_blank"},_swapNewRender:function(t){return h.prototype._swapNewRender.call(this,t),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_getFoldoutPanelOptions:function(){var e=h.prototype._getFoldoutPanelOptions.call(this);return t.extend(e,{collection:this.model.outputCollection,selecting:!1})},_labelParamMap:function(){var e=this.model.get("params"),n={};return t.each(this.tool.inputs,function(t){t.label&&"DataToolParameter"!==t.model_class&&(n[t.label]=e[t.name])}),n},_labelInputMap:function(){var e=this,n={};return t.each(this.jobData.inputs,function(t){var i=e._findToolInput(t.name);i&&(n[i.label]=t)}),n},_findToolInput:function(e){var n=this.tool.inputs,i=t.findWhere(n,{name:e});return i||this._findRepeatToolInput(e,n)},_findRepeatToolInput:function(e,n){n=n||this.tool.inputs;var i=t.find(n,function(t){return 0===e.indexOf(t.name)});if(i){return t.find(i.inputs,function(t){return-1!==e.indexOf(t.name)})}},toString:function(){return"JobListItemView("+this.model+")"}});f.prototype.templates=function(){var e=(c.default.wrapTemplate(['<div class="list-element">','<div class="id"><%- model.id %></div>','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),c.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- view.tool.name %></span>',"</div>",'<div class="subtitle">','<span class="description"><%- view.tool.description %></span','<span class="create-time">'," ",(0,u.default)("Created"),": <%= new Date( job.create_time ).toString() %>, ","</span","</div>","</div>"],"job")),n=c.default.wrapTemplate(['<div class="subtitle">','<span class="description"><%- view.tool.description %></span',"</div>"],"job"),i=c.default.wrapTemplate(['<div class="details">','<div class="params">',"<% _.each( view._labelInputMap(), function( input, label ){ %>",'<div class="input" data-input-name="<%- input.name %>" data-input-id="<%- input.id %>">','<label class="prompt"><%- label %></label>','<span class="value"><%- input.content.name %></span>',"</div>","<% }) %>","<% _.each( view._labelParamMap(), function( param, label ){ %>",'<div class="param" data-input-name="<%- param.name %>">','<label class="prompt"><%- label %></label>','<span class="value"><%- param %></span>',"</div>","<% }) %>","</div>","</div>"],"job");return t.extend({},h.prototype.templates,{titleBar:e,subtitle:n,details:i})}(),e.default={JobListItemView:f}}).call(e,n(1))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(158),a=i(r),o=n(58),s=i(o),l=n(6),c=(i(l),n(3)),d=i(c),u=a.default.ListPanel,h=u.extend({_logNamespace:"dataset",viewClass:s.default.DatasetListItemView,className:u.prototype.className+" dataset-list",noneFoundMsg:(0,d.default)("No matching datasets found"),initialize:function(t){u.prototype.initialize.call(this,t)},toString:function(){return"DatasetList("+this.collection+")"}});e.default={DatasetList:h}},function(t,e,n){"use strict";(function(t){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(1),l=i(s),c=n(2),d=i(c),u=n(144),h=r(u),f=n(176),p=r(f),_=n(184),g=r(_),m=n(143),v=r(m),y=n(156),b=r(y),w=n(6),x=r(w),k=n(86),M=r(k);n(159);var C=d.View.extend(x.default.LoggableMixin).extend({_logNamespace:"history",tagName:"div",className:"history-column flex-column flex-row-container",id:function(){return this.model?"history-column-"+this.model.get("id"):""},initialize:function(t){t=t||{},this.purgeAllowed=!l.isUndefined(t.purgeAllowed)&&t.purgeAllowed,this.panel=t.panel||this.createPanel(t),this.setUpListeners()},createPanel:function(t){return new p.default.HistoryViewEdit(l.defaults(t,{model:this.model,purgeAllowed:this.purgeAllowed,dragItems:!0,$scrollContainer:function(){return this.$el}}))},setUpListeners:function(){var t=this;this.once("rendered",function(){t.trigger("rendered:initial",t)}),this.setUpPanelListeners()},setUpPanelListeners:function(){var t=this;this.listenTo(this.panel,{rendered:function(){t.trigger("rendered",t)},"view:expanded view:rendered":function(t){t.$(".rerun-btn").off()}},this)},inView:function(t,e){var n=this.$el.offset().left;return!(n+this.$el.width()<t||n>e)},$panel:function(){return this.$(".history-panel")},render:function(t){t=void 0!==t?t:"fast";var e=this.model?this.model.toJSON():{};return this.$el.html(this.template(e)),this.renderPanel(t),this.panel.$el.css("display","flex"),this.setUpBehaviors(),this},setUpBehaviors:function(){},template:function(e){return e=l.extend(e||{},{isCurrentHistory:this.currentHistory}),t('\n            <div class="panel-controls mb-1">\n                <div class="flex-row flex-column-container no-gutters justify-content-between">\n                    '+this.controlsLeftTemplate({history:e,view:this})+"\n                    "+this.controlsRightTemplate({history:e,view:this})+'\n                </div>\n            </div>\n            <div class="inner flex-row flex-column-container">\n                <div id="history-'+e.id+'" class="history-column history-panel flex-column"></div>\n            </div>')},renderPanel:function(t){return t=void 0!==t?t:"fast",this.panel.setElement(this.$panel()).render(t),this.currentHistory&&this.panel.$list().before(this.panel._renderDropTargetHelp()),this},events:{"click .switch-to.btn":function(){this.model.setAsCurrent()},"click .delete-history":function(){var t=this;this.model._delete().done(function(e){t.render()})},"click .undelete-history":function(){var t=this;this.model.undelete().done(function(e){t.render()})},"click .purge-history":function(){var t=this;window.confirm((0,o.default)("This will permanently remove the data. Are you sure?"))&&this.model.purge().done(function(e){t.render()})},"click .copy-history":"copy"},copy:function(){(0,v.default)(this.model)},controlsLeftTemplate:l.template('\n        <div class="text-left col-8">\n            <% if( data.history.isCurrentHistory ){ %>\n                <strong class="current-label">\n                    '+(0,o.default)("Current History")+'\n                </strong>\n            <% } else { %>\n                <button class="switch-to btn btn-secondary">\n                    '+(0,o.default)("Switch to")+"\n                </button>\n            <% } %>\n        </div>",{variable:"data"}),controlsRightTemplate:l.template('<div class="text-right col-4">\n            <% if( !data.history.purged ){ %>\n                <div class="panel-menu btn-group">\n                    <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">\n                        <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <% if( !data.history.deleted ){ %>\n                            <li><a href="javascript:void(0);" class="copy-history">\n                                '+(0,o.default)("Copy")+'\n                            </a></li>\n                            <li><a href="javascript:void(0);" class="delete-history">\n                                '+(0,o.default)("Delete")+'\n                            </a></li>\n                        <% } else /* if is deleted */ { %>\n                            <li><a href="javascript:void(0);" class="undelete-history">\n                                '+(0,o.default)("Undelete")+'\n                            </a></li>\n                        <% } %>\n                        <% if( data.view.purgeAllowed ){ %>\n                            <li><a href="javascript:void(0);" class="purge-history">\n                                '+(0,o.default)("Purge")+"\n                            </a></li>\n                        <% } %>\n                    </ul>\n                </div>\n            <% } %>\n        </div>",{variable:"data"}),toString:function(){return"HistoryViewColumn("+(this.panel?this.panel:"")+")"}}),S=d.View.extend(x.default.LoggableMixin).extend({_logNamespace:"history",className:"multi-panel-history",initialize:function(t){t=t||{},this.log(this+".init",t),this.$el.addClass(this.className),this.options={columnWidth:312,borderWidth:1,columnGap:8,headerHeight:29,footerHeight:0,controlsHeight:20},this.perPage=t.perPage||10,this.hdaQueue=new M.default.NamedAjaxQueue([],!1),this.collection=null,this.columnMap={},this.columnOptions=t.columnOptions||{},this.historySearch=null,this.datasetSearch=null,this.setCollection(t.histories),this.setUpListeners()},setUpListeners:function(){var t=this;this.on("end-of-scroll",function(){t.collection.fetchMore()})},setCollection:function(t){return this.stopListening(this.collection),this.collection=t||new h.default.HistoryCollection,this.setUpCollectionListeners(),this.createColumns(),this.hdaQueue.clear(),this.trigger("new-collection",this),this},addModels:function(t,e,n){var i=this;return n=n||{},t=l.isArray(t)?t:[t],t.forEach(function(t){i.addColumn(t,!1)}),this},setUpCollectionListeners:function(){this.listenTo(this.collection,{error:this.errorHandler,add:this.addModels,"all-fetched":this._postFetchAll,"new-current":this.addAsCurrentColumn,"set-as-current":this.setCurrentHistory,"change:deleted change:purged":this.handleDeletedHistory,sort:function(){this.renderColumns(0)}})},_postFetchAll:function(t){if(this.$(".histories-loading-indicator").remove(),!this.historySearch){var e=this.$(".outer-middle");e.scrollLeft(e.scrollLeft()+24)}},setCurrentHistory:function(t){this.log("setCurrentHistory:",t);var e=l.findWhere(this.columnMap,{currentHistory:!0});e&&(e.currentHistory=!1,e.$el.height(""));var n=this.columnMap[this.collection.currentHistoryId];return n.currentHistory=!0,this.collection.sort(),this._recalcFirstColumnHeight(),n},handleDeletedHistory:function(t){if(t.get("deleted")||t.get("purged")){this.log("handleDeletedHistory",this.collection.includeDeleted,t);var e=this.columnMap[t.id];if(!e)return;e.model.id===this.collection.currentHistoryId||this.collection.includeDeleted||this.removeColumn(e)}},errorHandler:function(t,e,n){if(!e||0!==e.status||0!==e.readyState){if(this.error(t,e,n),l.isString(t)&&l.isString(e)){var i=t,r=e;return b.default.errorModal(i,r,n)}return e&&502===e.status?b.default.badGatewayErrorModal():b.default.ajaxErrorModal(t,e,n)}},_ajaxErrorHandler:function(){b.default.ajaxErrorModal.apply(null,l.toArray(arguments))},create:function(t){return this.collection.create({current:!0})},createColumns:function(t,e){var n=this;e=e||this.options.columnOptions,this.columnMap={},this.collection.each(function(t,i){n.columnMap[t.id]=n.createColumn(t,e)})},createColumn:function(t,e){e=l.extend({},e,{model:t,purgeAllowed:Galaxy.config.allow_user_dataset_purge});var n=new C(e);return t.id===this.collection.currentHistoryId&&(n.currentHistory=!0),this.setUpColumnListeners(n),this.datasetSearch&&(n.panel.searchItems(this.datasetSearch),this.queueHdaFetchDetails(n)),n},addColumn:function(t,e){e=void 0===e||e;var n=this.createColumn(t);return this.columnMap[t.id]=n,e&&this.renderColumns(),n},addAsCurrentColumn:function(t,e,n){var i=this,r=this.addColumn(t,!1);return this.setCurrentHistory(t),r.once("rendered",function(){i.queueHdaFetch(r)}),r},removeColumn:function(e,n){var i=this;if(n=void 0===n||n,this.log("removeColumn",e),e){var r=this.options.columnWidth+this.options.columnGap;e.$el.fadeOut("fast",function(){n&&(t(i).remove(),i.$(".middle").width(i.$(".middle").width()-r),i.checkColumnsInView(),i._recalcFirstColumnHeight()),i.stopListening(e.panel),i.stopListening(e),delete i.columnMap[e.model.id],e.remove()})}},setUpColumnListeners:function(t){var e=this;this.listenTo(t,{"in-view":this.queueHdaFetch}),this.listenTo(t.panel,{"view:draggable:dragstart":function(t,n,i,r){e._dropData=JSON.parse(t.dataTransfer.getData("text")),e.currentColumnDropTargetOn()},"view:draggable:dragend":function(t,n,i,r){e._dropData=null,e.currentColumnDropTargetOff()},"droptarget:drop":function(t,n,i){var r=e._dropData.filter(function(t){return i.model.contents.isCopyable(t)});e._dropData=null;var a=new M.default.NamedAjaxQueue;0!==i.model.contents.currentPage&&a.add({name:"fetch-front-page",fn:function(){return i.model.contents.fetchPage(0)}}),r.reverse().forEach(function(t){a.add({name:"copy-"+t.id,fn:function(){return i.model.contents.copy(t)}})}),a.start(),a.done(function(t){i.model.fetch()})}})},columnMapLength:function(){return Object.keys(this.columnMap).length},sortedFilteredColumns:function(t){return t=t||this.filters,t&&t.length?this.sortedColumns().filter(function(e,n){return e.currentHistory||l.every(t.map(function(t){return t.call(e)}))}):this.sortedColumns()},sortedColumns:function(){var t=this;return this.collection.map(function(e,n){return t.columnMap[e.id]})},render:function(t){return t=void 0!==t?t:this.fxSpeed,this.log(this+".render"),this.$el.html(this.mainTemplate),this.renderColumns(t),this.setUpBehaviors(),this.trigger("rendered",this),this},renderColumns:function(t){t=l.isNumber(t)?t:this.fxSpeed;var e=this.sortedFilteredColumns(),n=this.$(".middle").empty();return this._addColumns(e,t),this.collection.allFetched||n.append(this.loadingIndicatorTemplate),this.trigger("columns-rendered",e,this),(!this.datasetSearch||e.length>1)&&(this.checkColumnsInView(),this._recalcFirstColumnHeight()),e},_addColumns:function(t,e){e=l.isNumber(e)?e:this.fxSpeed;var n=this.$(".middle"),i=n.children(".history-column").length;n.width(this._calcMiddleWidth(t.length+i)),t.forEach(function(t,i){t.delegateEvents().render(e).$el.appendTo(n)})},_calcMiddleWidth:function(t){return t*(this.options.columnWidth+this.options.columnGap)+this.options.columnGap+16},queueHdaFetch:function(t){var e=t.model.contents;if(0===e.length&&t.model.contentsShown()){var n={silent:!0},i=l.values(e.storage.allExpanded()).join();i&&(n.details=i),this.hdaQueue.add({name:t.model.id,fn:function(){return e.fetchCurrentPage(n).done(function(){t.panel.renderItems()}).done(function(){g.default.FETCH_STATE_ON_ADD||e.jobStateSummariesCollection.fetch()})}}),this.hdaQueue.running||this.hdaQueue.start()}},queueHdaFetchDetails:function(t){var e=t.model.contents;!(0===e.length&&t.model.contentsShown())&&e.haveDetails()||(this.hdaQueue.add({name:t.model.id,fn:function(){return e.progressivelyFetchDetails().done(function(){t.panel._renderEmptyMessage()})}}),this.hdaQueue.running||this.hdaQueue.start())},renderInfo:function(t){return this.$(".header .header-info").text(t)},events:{"click .done.btn":"close","click .create-new.btn":"create","click #include-deleted":"_clickToggleDeletedHistories","click .order .set-order":"_chooseOrder","click #toggle-deleted":"_clickToggleDeletedDatasets","click #toggle-hidden":"_clickToggleHiddenDatasets"},close:function(t){window.location=Galaxy.root},_clickToggleDeletedHistories:function(e){this.toggleDeletedHistories(t(e.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleDeletedHistories:function(t){window.location=t?Galaxy.root+"history/view_multiple?include_deleted_histories=True":Galaxy.root+"history/view_multiple"},_clickToggleDeletedDatasets:function(e){this.toggleDeletedDatasets(t(e.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleDeletedDatasets:function(t){t=void 0!==t&&t,this.sortedFilteredColumns().forEach(function(e,n){l.delay(function(){e.panel.toggleShowDeleted(t,!1)},200*n)})},_clickToggleHiddenDatasets:function(e){this.toggleHiddenDatasets(t(e.currentTarget).is(":checked")),this.toggleOptionsPopover()},toggleHiddenDatasets:function(t){t=void 0!==t&&t,this.sortedFilteredColumns().forEach(function(e,n){l.delay(function(){e.panel.toggleShowHidden(t,!1)},200*n)})},_chooseOrder:function(e){var n=this,i=this.collection,r=t(e.currentTarget).data("order");this.$(".current-order").text(this.orderDescriptions[r]),this.toggleOptionsPopover(),i.setOrder(r);var a=i.slice(0,1);i.fetchFirst().done(function(){i.unshift(a,{silent:!0}),n.createColumns(),n.hdaQueue.clear(),n.render()}),this.once("columns-rendered",this._scrollLeft)},_scrollLeft:function(t){t=l.isNumber(t)?t:0,this.$(".outer-middle").scrollLeft(t)},setUpBehaviors:function(){var e=this;this._moreOptionsPopover(),this.$("#search-histories").searchInput({name:"search-histories",placeholder:(0,o.default)("search histories"),onfirstsearch:function(t){e.$("#search-histories").searchInput("toggle-loading"),e.renderInfo((0,o.default)("loading all histories for search")),e.collection.fetchAll().done(function(){e.$("#search-histories").searchInput("toggle-loading"),e.renderInfo("")})},onsearch:function(t){e.historySearch=t,e.filters=[function(){return e.model.matchesAll(e.historySearch)}],e.renderColumns(0)},onclear:function(t){e.historySearch=null,e.filters=[],e.renderColumns(0)}}),this.$("#search-datasets").searchInput({name:"search-datasets",placeholder:(0,o.default)("search all datasets"),onfirstsearch:function(t){e.hdaQueue.clear(),e.$("#search-datasets").searchInput("toggle-loading"),e.datasetSearch=t,e.sortedFilteredColumns().forEach(function(n){n.panel.searchItems(t),e.queueHdaFetchDetails(n)}),e.hdaQueue.progress(function(t){e.renderInfo([(0,o.default)("searching"),t.curr+1,(0,o.default)("of"),t.total].join(" "))}),e.hdaQueue.deferred.done(function(){e.renderInfo(""),e.$("#search-datasets").searchInput("toggle-loading")})},onsearch:function(t){e.datasetSearch=t,e.sortedFilteredColumns().forEach(function(e){e.panel.searchItems(t)})},onclear:function(t){e.datasetSearch=null,e.sortedFilteredColumns().forEach(function(t){t.panel.clearSearch()})}}),t(window).resize(function(){e._recalcFirstColumnHeight()});var n=l.debounce(function(){var t=e._viewport();e.checkColumnsInView(t),e.checkForEndOfScroll(t)},100);this.$(".middle").parent().scroll(n)},_moreOptionsPopover:function(){return this.$(".open-more-options.btn").popover({container:".header",placement:"bottom",html:!0,content:t(this.optionsPopoverTemplate(this))})},toggleOptionsPopover:function(t){this.$(".open-more-options.btn").popover("toggle")},_recalcFirstColumnHeight:function(){var t=this.$(".history-column").first(),e=this.$(".middle").height(),n=t.find(".panel-controls").height();t.height(e).find(".inner").height(e-n)},_viewport:function(){var t=this.$(".middle").parent(),e=t.offset().left;return{left:e,right:e+t.width()}},columnsInView:function(t){var e=t||this._viewport();return this.sortedFilteredColumns().filter(function(t){return t.currentHistory||t.inView(e.left,e.right)})},checkColumnsInView:function(){this.columnsInView().forEach(function(t){t.trigger("in-view",t)})},checkForEndOfScroll:function(t){t=t||this._viewport();var e=this.$(".middle");e.parent().scrollLeft()+t.right>=e.width()-16&&this.trigger("end-of-scroll")},currentColumnDropTargetOn:function(){var t=this.columnMap[this.collection.currentHistoryId];t&&(t.panel.dataDropped=function(t){},t.panel.dropTargetOn())},currentColumnDropTargetOff:function(){var t=this.columnMap[this.collection.currentHistoryId];t&&(t.panel.dataDropped=p.default.HistoryViewEdit.prototype.dataDrop,t.panel.dropTarget=!1,t.panel.$(".history-drop-target").remove())},toString:function(){return"MultiPanelColumns("+(this.columns?this.columns.length:0)+")"},mainTemplate:'\n        <div class="header flex-column-container">\n            <div class="control-column control-column-left flex-column">\n                <div id="search-histories" class="search-control"></div>\n                <div id="search-datasets" class="search-control"></div>\n                <a class="open-more-options btn btn-secondary" tabindex="3">\n                    <span class="fa fa-ellipsis-h"></span>\n                </a>\n            </div>\n            <div class="control-column control-column-center flex-column">\n                <div class="header-info">\n                </div>\n            </div>\n            <div class="control-column control-column-right flex-column">\n                <button class="create-new btn btn-secondary" tabindex="4">\n                    '+(0,o.default)("Create new")+'\n                </button>\n            </div>\n        </div>\n        <div class="outer-middle flex-row flex-row-container">\n            <div class="middle flex-column-container flex-row"></div>\n        </div>\n        <div class="footer flex-column-container"></div>',loadingIndicatorTemplate:'\n        <div class="histories-loading-indicator">\n            <span class="fa fa-spin fa-spinner"></span>\n            '+(0,o.default)("Loading histories")+" ...\n        </div>",orderDescriptions:{update_time:(0,o.default)("most recent first"),"update_time-asc":(0,o.default)("least recent first"),name:(0,o.default)("name, a to z"),"name-dsc":(0,o.default)("name, z to a"),size:(0,o.default)("size, large to small"),"size-asc":(0,o.default)("size, small to large")},optionsPopoverTemplate:l.template(['<div class="more-options d-flex flex-column">','<div class="order btn-group mb-2">','<button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">',(0,o.default)("Order histories by")+" ",'<span class="current-order"><%- view.orderDescriptions[ view.collection.order ] %></span> ','<span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">',"<% _.each( view.orderDescriptions, function( text, order ){ %>",'<li class="dropdown-item"><a href="javascript:void(0);" class="set-order" data-order="<%- order %>">',"<%- text %>","</a></li>","<% }); %>","</ul>","</div>",'<div class="checkbox"><label><input id="include-deleted" type="checkbox"','<%= view.collection.includeDeleted? " checked" : "" %>>',(0,o.default)("Include deleted histories"),"</label></div>",'<div class="checkbox"><label><input id="toggle-deleted" type="checkbox">',(0,o.default)("Include deleted datasets"),"</label></div>",'<div class="checkbox"><label><input id="toggle-hidden" type="checkbox">',(0,o.default)("Include hidden datasets"),"</label></div>","</div>"].join(""),{variable:"view"})});e.default={MultiPanelColumns:S}}).call(e,n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(157),o=r(a),s=n(160),l=(r(s),n(161)),c=(r(l),n(6)),d=(r(c),n(3)),u=r(d),h=o.default.HistoryView,f=h.extend({className:h.prototype.className+" annotated-history-panel",_buildNewRender:function(){var t=h.prototype._buildNewRender.call(this);return this.renderHistoryAnnotation(t),t},renderHistoryAnnotation:function(t){var e=this.model.get("annotation");e&&t.find("> .controls .subtitle").text(e)},renderItems:function(e){e=e||this.$el,h.prototype.renderItems.call(this,e);var n=e.find("> .controls");n.find(".contents-container.headers").remove();t('<div class="contents-container headers"/>').append([t('<div class="history-content header"/>').text((0,u.default)("Dataset")),t('<div class="additional-info header"/>').text((0,u.default)("Annotation"))]).appendTo(n);return self.views},_renderItemView$el:function(e){return t('<div class="contents-container"/>').append([e.render(0).$el,t('<div class="additional-info"/>').text(e.model.get("annotation")||"")])},events:i.extend(i.clone(h.prototype.events),{"click .contents-container":function(e){e.stopPropagation(),t(e.currentTarget).find(".list-item .title-bar").click()},"click .icon-btn":function(e){e.stopPropagation();var n=t(e.currentTarget);n.length&&"dropdown"===n.attr("data-toggle")&&n.dropdown("toggle")}}),_clickSectionLink:function(e){var n=t(e.currentTarget).parent().parent().data("section");this.openSection(n)},toString:function(){return"AnnotatedHistoryView("+(this.model?this.model.get("name"):"")+")"}});e.default={AnnotatedHistoryView:f}}).call(e,n(0),n(1))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(5),l=o(s),c=n(757),d=o(c),u=n(758),h=o(u),f=n(41),p=o(f);t.ajaxSettings.traditional=!0,e.default=i.View.extend({grid:null,initialize:function(t){this.grid=new d.default,this.dict_format=t.dict_format,this.title=t.title,this.title_id=t.title_id;var e=this;if(window.add_tag_to_grid_filter=function(t,n){var i=t+(void 0!==n&&""!==n?":"+n:"");r("#advanced-search").is(":visible")||(r("#standard-search").slideToggle("fast"),r("#advanced-search").slideToggle("fast")),e.add_filter_condition("tags",i)},this.dict_format)if(this.setElement("<div/>"),t.url_base&&!t.items){var n=t.url_data||{};a.each(t.filters,function(t,e){n["f-"+e]=t}),r.ajax({url:t.url_base+"?"+r.param(n),success:function(n){n.embedded=t.embedded,n.filters=t.filters||{},e.init_grid(n)}})}else this.init_grid(t);else this.setElement("#grid-container"),this.init_grid(t);t.use_panels&&r("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(t){t&&r.inArray("history",t)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&l.default.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var n=this.grid.get("url_base");if(n=n.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",n),this.$el.html(h.default.grid(e)),this.$el.find("#grid-table-header").html(h.default.header(e)),this.$el.find("#grid-table-body").html(h.default.body(e)),this.$el.find("#grid-table-footer").html(h.default.footer(e)),e.message){this.$el.find("#grid-message").html(h.default.message(e));var i=this;e.use_hide_message&&setTimeout(function(){i.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),window.init_refresh_on_change&&window.init_refresh_on_change()},init_grid_controls:function(){var t=this;this.$el.find(".operation-button").each(function(){r(this).off(),r(this).click(function(){return t.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){r(this).off(),r(this).click(function(){r(this).select()}).keyup(function(){r(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){r(this).off(),r(this).click(function(){return t.set_sort_condition(r(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){r(this).off(),r(this).submit(function(){var e=r(this).attr("column_key"),n=r("#input-"+e+"-filter"),i=n.val();return n.val(""),t.add_filter_condition(e,i),!1})}),this.$el.find(".text-filter-val > a").each(function(){r(this).off(),r(this).click(function(){return r(this).parent().remove(),t.remove_filter_condition(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){r(this).off(),r(this).click(function(){return t.set_categorical_filter(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){r(this).off(),r(this).click(function(){return t.$el.find("#standard-search").slideToggle("fast"),t.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){t.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var t=r(this).find("input.grid-row-select-checkbox"),e=r(this).find("span.grid-selected-count"),n=function(){e.text(r(t).filter(":checked").length)};r(t).each(function(){r(this).change(n)}),n()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var t=this.grid.attributes,e=this;this.$el.find(".page-link > a").each(function(){r(this).click(function(){return e.set_page(r(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){r(this).click(function(){return e.execute({href:r(this).attr("href"),target:r(this).attr("target")}),!1})}),0!==t.items.length&&a.each(t.items,function(n,i){var r=e.$("#grid-"+n.encode_id+"-popup").off(),o=new p.default(r);a.each(t.operations,function(t){e._add_operation(o,t,n)})})},_add_operation:function(t,e,n){var i=this,a=n.operation_config[e.label];a.allowed&&e.allow_popup&&t.addItem({html:e.label,href:a.url_args,target:a.target,confirmation_text:e.confirm,func:function(t){t.preventDefault();var a=r(t.target).html();e.onclick?e.onclick(n.encode_id):i.execute(this.findItemByHtml(a))}})},add_filter_condition:function(t,e){if(""===e)return!1;this.grid.add_filter(t,e,!0);var n=r(h.default.filter_element(t,e)),i=this;n.click(function(){r(this).remove(),i.remove_filter_condition(t,e)}),this.$el.find("#"+t+"-filtering-criteria").append(n),this.go_page_one(),this.execute()},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),this.go_page_one(),this.execute()},set_sort_condition:function(t){var e=this.grid.get("sort_key"),n=t;-1!==e.indexOf(t)&&"-"!==e.substring(0,1)&&(n="-"+t),this.$el.find(".sort-arrow").remove();var i="-"==n.substring(0,1)?"&uarr;":"&darr;",a=r("<span>"+i+"</span>").addClass("sort-arrow");this.$el.find("#"+t+"-header").append(a),this.grid.set("sort_key",n),this.go_page_one(),this.execute()},set_categorical_filter:function(t,e){var n=this.grid.get("categorical_filters")[t],i=this.grid.get("filters")[t],a=this;this.$el.find("."+t+"-filter").each(function(){var o=r.trim(r(this).text()),s=n[o],l=s[t];if(l==e)r(this).empty(),r(this).addClass("current-filter"),r(this).append(o);else if(l==i){r(this).empty();var c=r('<a href="#">'+o+"</a>");c.click(function(){a.set_categorical_filter(t,l)}),r(this).removeClass("current-filter"),r(this).append(c)}}),this.grid.add_filter(t,e),this.go_page_one(),this.execute()},set_page:function(t){var e=this;this.$el.find(".page-link").each(function(){var n,i=r(this).attr("id"),a=parseInt(i.split("-")[2],10),o=e.grid.get("cur_page");if(a===t)n=r(this).children().text(),r(this).empty(),r(this).addClass("inactive-link"),r(this).text(n);else if(a===o){n=r(this).text(),r(this).empty(),r(this).removeClass("inactive-link");var s=r('<a href="#">'+n+"</a>");s.click(function(){e.set_page(a)}),r(this).append(s)}}),"all"===t?this.grid.set("cur_page",t):this.grid.set("cur_page",parseInt(t,10)),this.execute()},submit_operation:function(t,e){var n=r(t).val();if(this.$el.find('input[name="id"]:checked').length<1)return!1;var i=a.findWhere(this.grid.attributes.operations,{label:n});i&&!e&&(e=i.confirm||"");var o=[];this.$el.find("input[name=id]:checked").each(function(){o.push(r(this).val())});var s={operation:n,id:o,confirmation_text:e};return"top"!=i.target&&"center"!=i.target||(s=a.extend(s,{href:i.href,target:i.target})),this.execute(s),!0},check_all_items:function(){var t=this.$(".grid-row-select-checkbox"),e=this.$("#check_all").prop("checked");a.each(t,function(t){r(t).prop("checked",e)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!==t&&void 0!==t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(t){var e=null,n=null,i=null,a=null,o=null;if(t&&(n=t.href,i=t.operation,e=t.id,a=t.confirmation_text,o=t.target,void 0!==n&&-1!=n.indexOf("operation="))){var s=n.split("?");if(s.length>1)for(var l=s[1],c=l.split("&"),d=0;d<c.length;d++)-1!=c[d].indexOf("operation")?(i=c[d].split("=")[1],i=i.replace(/\+/g," ")):-1!=c[d].indexOf("id")&&(e=c[d].split("=")[1])}return i&&e?!(a&&""!==a&&"None"!=a&&"null"!=a&&!confirm(a))&&(i=i.toLowerCase(),this.grid.set({operation:i,item_ids:e}),"top"==o?window.top.location=n+"?"+r.param(this.grid.get_url_data()):"center"==o?r("#galaxy_main").attr("src",n+"?"+r.param(this.grid.get_url_data())):this.grid.can_async_op(i)||this.dict_format?this.update_grid():this.go_to(o,n),!1):n?(this.go_to(o,n),!1):(this.grid.get("async")||this.dict_format?this.update_grid():this.go_to(o,n),!1)},go_to:function(t,e){var n=this.grid.get("async");this.grid.set("async",!1);var i=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",i),e||(e=this.grid.get("url_base")+"?"+r.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0,async:n}),t){case"center":r("#galaxy_main").attr("src",e);break;case"top":window.top.location=e;break;default:window.location=e}},update_grid:function(){var t=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var e=this;r.ajax({type:t,url:e.grid.get("url_base"),data:e.grid.get_url_data(),error:function(){alert("Grid refresh failed")},success:function(t){var n=e.grid.get("embedded"),i=e.grid.get("insert"),a=e.$el.find("#advanced-search").is(":visible"),o=e.dict_format?t:r.parseJSON(t);o.embedded=n,o.insert=i,o.advanced_search=a,e.init_grid(o),e.$el.find(".loading-elt-overlay").hide()},complete:function(){e.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(e,n(0),n(2),n(0),n(1))},function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.Model.extend({defaults:{url_base:"",async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},can_async_op:function(t){return-1!==n.indexOf(this.attributes.async_ops,t)},add_filter:function(t,e,n){if(n){var i,r=this.attributes.filters[t];if(null===r||void 0===r)i=e;else if("string"==typeof r)if("All"==r||r==e)i=e;else{var a=[];a[0]=r,a[1]=e,i=a}else i=r,-1===i.indexOf(e)&&i.push(e);this.attributes.filters[t]=i}else this.attributes.filters[t]=e},remove_filter:function(t,e){var i=this.attributes.filters[t];if(null===i||void 0===i)return!1;if("string"==typeof i)this.attributes.filters[t]="";else{var r=n.indexOf(i,e);-1!==r&&(i[r]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);var e=this;return n.each(n.pairs(e.attributes.filters),function(e){t["f-"+e[0]]=e[1]}),t},get_url:function(t){return this.get("url_base")+"?"+i.param(this.get_url_data())+"&"+i.param(t)}})}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),a=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={grid:function(t){var e="";return e=t.embedded?this.grid_header(t)+this.grid_table(t):'<div class="loading-elt-overlay"></div><table><tr><td width="75%">'+this.grid_header(t)+'</td><td></td><td></td></tr><tr><td width="100%" id="grid-message" valign="top"></td><td></td><td></td></tr></table>'+this.grid_table(t),t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'+t.info_text+"</div>"),e},grid_table:function(){return'\n            <form method="post" onsubmit="return false;">\n                <table id="grid-table" class="grid">\n                    <thead id="grid-table-header"></thead>\n                    <tbody id="grid-table-body"></tbody>\n                    <tfoot id="grid-table-footer"></tfoot>\n                </table>\n            </form>'},grid_header:function(t){var e='<div class="grid-header">';if(t.embedded||(e+="<h2>"+t.title+"</h2>"),t.global_actions){e+='<ul class="manage-table-actions">';var n=t.global_actions.length>=3;n&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');var i=!0,r=!1,a=void 0;try{for(var o,s=t.global_actions[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;e+='<li><a class="action-button use-target" target="'+l.target+'" href="'+l.url_args+'" onclick="return false;" >'+l.label+"</a></li>"}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}n&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");var n=!0,i=!1,r=void 0;try{for(var a,o=t.columns[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.visible&&(e+='<th id="'+s.key+'-header">',s.href?e+='<a href="'+s.href+'" class="sort-link" sort_key="'+s.key+'">'+s.label+"</a>":e+=s.label,e+='<span class="sort-arrow">'+s.extra+"</span></th>")}}catch(t){i=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return e+="</tr>"},body:function(e){var n="";0===e.items.length&&(n+='<tr><td colspan="100"><em>No Items</em></td></tr>');var i=!0,r=!1,a=void 0;try{for(var o,s=e.items[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;n+="<tr ",e.current_item_id==l.id&&(n+='class="current"'),n+=">",e.show_item_checkboxes&&(n+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+l.encode_id+'" id="'+l.encode_id+'" class="grid-row-select-checkbox" /></td>');var c=!0,d=!1,u=void 0;try{for(var h,f=e.columns[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;if(p.visible){var _="";p.nowrap&&(_='style="white-space:nowrap;"');var g=l.column_config[p.label],m=g.link,v=g.value,y=g.target;"string"===t.type(v)&&(v=v.replace(/\/\//g,"/"));var b="",w="";p.attach_popup&&(b="grid-"+l.encode_id+"-popup",w="menubutton",""!==m&&(w+=" split"),w+=" popup"),n+="<td "+_+">",m?(0!==e.operations.length&&(n+='<div id="'+b+'" class="'+w+'" style="float: left;">'),n+='<a class="menubutton-label use-target" target="'+y+'" href="'+m+'" onclick="return false;">'+v+"</a>",0!==e.operations.length&&(n+="</div>")):n+='<div id="'+b+'" class="'+w+'"><label id="'+p.label_id_prefix+l.encode_id+'" for="'+l.encode_id+'">'+(v||"")+"</label></div>",n+="</td>"}}}catch(t){d=!0,u=t}finally{try{!c&&f.return&&f.return()}finally{if(d)throw u}}n+="</tr>"}}catch(t){r=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}return n},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var n=t.num_page_links,i=t.cur_page_num,r=t.num_pages,a=n/2,o=i-a,s=0;o<=0&&(o=1,s=a-(i-o));var l,c=a+s,d=i+c;d<=r?l=0:(d=r,l=c-(d+1-i)),0!==l&&(o-=l)<1&&(o=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(e+='<span class="page-link" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var u=o;u<d+1;u++)u==t.cur_page_num?e+='<span class="page-link inactive-link" id="page-link-'+u+'">'+u+"</span>":e+='<span class="page-link" id="page-link-'+u+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+u+'">'+u+"</a></span>";d<r&&(e+='...<span class="page-link" id="page-link-'+r+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+r+'">'+r+"</a></span>"),e+="</span>",e+='\n                    <span class="page-link" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span>\n                    </td>\n                </tr>'}if(t.show_item_checkboxes){e+='\n                <tr>\n                    <input type="hidden" id="operation" name="operation" value="">\n                    <td></td>\n                    <td colspan="100">\n                        For <span class="grid-selected-count"></span> selected items: \n            ';var h=!0,f=!1,p=void 0;try{for(var _,g=t.operations[Symbol.iterator]();!(h=(_=g.next()).done);h=!0){var m=_.value;m.allow_multiple&&(e+='<input type="button" value="'+m.label+'" class="operation-button action-button">&nbsp;')}}catch(t){f=!0,p=t}finally{try{!h&&g.return&&g.return()}finally{if(f)throw p}}e+="</td></tr>"}var v=!1,y=!0,b=!1,w=void 0;try{for(var x,k=t.operations[Symbol.iterator]();!(y=(x=k.next()).done);y=!0){if(x.value.global_operation){v=!0;break}}}catch(t){b=!0,w=t}finally{try{!y&&k.return&&k.return()}finally{if(b)throw w}}if(v){e+='<tr><td colspan="100">';var M=!0,C=!1,S=void 0;try{for(var T,A=t.operations[Symbol.iterator]();!(M=(T=A.next()).done);M=!0){var j=T.value;j.global_operation&&(e+='<a class="action-button" href="'+j.global_operation+'">'+j.label+"</a>")}}catch(t){C=!0,S=t}finally{try{!M&&A.return&&A.return()}finally{if(C)throw S}}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'+t.legend+"</td></tr>"),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'+e+'message transient-message">'+i.escape(t.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(t){var e=t.default_filter_dict,n=t.filters,i="none";t.advanced_search&&(i="block");var r=!1,a=!0,o=!1,s=void 0;try{for(var l,c=t.columns[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;if("advanced"==d.filterable){var u=d.key,h=n[u],f=e[u];h&&f&&h!=f&&(i="block"),r=!0}}}catch(t){o=!0,s=t}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}var p="block";"block"==i&&(p="none");var _='<div id="standard-search" style="display: '+p+';"><table><tr><td style="padding: 0;"><table>',g=!0,m=!1,v=void 0;try{for(var y,b=t.columns[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var w=y.value;"standard"==w.filterable&&(_+=this.grid_column_filter(t,w))}}catch(t){m=!0,v=t}finally{try{!g&&b.return&&b.return()}finally{if(m)throw v}}_+="</table></td></tr><tr><td>",r&&(_+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),_+="</td></tr></table></div>",_+='<div id="advanced-search" style="display: '+i+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';var x=!0,k=!1,M=void 0;try{for(var C,S=t.columns[Symbol.iterator]();!(x=(C=S.next()).done);x=!0){var T=C.value;"advanced"==T.filterable&&(_+=this.grid_column_filter(t,T))}}catch(t){k=!0,M=t}finally{try{!x&&S.return&&S.return()}finally{if(k)throw M}}return _+="</table></div>"},grid_column_filter:function(e,n){var i=e.filters,r=n.label,a=n.key;"advanced"==n.filterable&&(r=r.toLowerCase());var o="<tr>";if("advanced"==n.filterable&&(o+='<td align="left" style="padding-left: 10px">'+r+":</td>"),o+='<td style="padding-bottom: 1px;">',n.is_text){o+='<form class="text-filter-form" column_key="'+a+'" action="'+e.url+'" method="get" >';var s=!0,l=!1,c=void 0;try{for(var d,u=e.columns[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value,f=i[h.key];f&&"All"!=f&&(h.is_text&&(f=JSON.stringify(f)),o+='<input type="hidden" id="'+h.key+'" name="f-'+h.key+'" value="'+f+'"/>')}}catch(t){l=!0,c=t}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}o+='<span id="'+a+'-filtering-criteria">';var p=i[a];if(p){var _=t.type(p);if("string"==_&&"All"!=p&&(o+=this.filter_element(a,p)),"array"==_)for(var g in p){var m=p;m=m.slice(g),o+=this.filter_element(a,p[g])}}o+="</span>";var v="",y=20;"standard"==n.filterable&&(v=n.label.toLowerCase(),v.length<20&&(y=v.length),y+=4),o+='\n                <span class="search-box">\n                    <input class="search-box-input" id="input-'+a+'-filter" name="f-'+a+'" type="text" placeholder="'+v+'" size="'+y+'"/>\n                    <button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;">\n                        <i class="fa fa-search"></i>\n                    </button>\n                </span>\n            </form>'}else{o+='<span id="'+a+'-filtering-criteria">';var b=!1;for(var w in e.categorical_filters[a]){var x=e.categorical_filters[a][w],k="",M="";for(var C in x)k=C,M=x[C];b&&(o+=" | "),b=!0;var S=i[a];S&&x[a]&&S==M?o+='<span class="categorical-filter '+a+'-filter current-filter">'+w+"</span>":o+='<span class="categorical-filter '+a+'-filter"><a href="javascript:void(0);" filter_key="'+k+'" filter_val="'+M+'">'+w+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(t,e){return'<span class="text-filter-val">'+(e=a.default.sanitize(e))+'<a href="javascript:void(0);" filter_key="'+t+'" filter_val="'+e+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(e,n(0),n(1))},function(t,e,n){"use strict";(function(t){function i(t,e){return new Date(t.getFullYear(),t.getMonth(),t.getDate()-e,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function r(t,e){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()-e,t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function a(){var t=new Date;return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),0,0)}function o(e,n,o,s){function d(){var t=c.select(this).attr("class");t=t.split(" "),c.selectAll("."+t[0]).filter("."+t[1]).style("cursor","zoom-in").transition().duration(750).attr("height",w).attr("width",y),c.select(this).style("cursor","default").transition().duration(750).attr("height",w*b).attr("width",y*b)}var u,h=e,f=[],p=a();for(u=0;u<24;u++)f.push(r(p,u));var _=[];for(u=0;u<30;u++)_.push(i(p,u));var g={top:60,right:30,bottom:50,left:60},m=0;"hours"==o?m=12.5:"days"==o&&(m=10);var v,y=300+g.left+g.right,b=1.75;v=0!==c.max(h)?150/c.max(h):1;var w=150+g.top+g.bottom;t(".charts").css("height",w*b);var x=c.select("#"+n).attr("width",y).attr("height",w).attr("preserveAspectRatio","xMidYMin").attr("viewBox","0 0 "+y+" "+w).on("click",d),k=x.selectAll("g").data(h).enter().append("g").attr("transform",function(t,e){var n=g.left;return"translate("+(n+=+e*m)+","+g.top+")"}).on("mouseenter",function(t){for(var e=1,n=t;n>=10;)n/=10,e++;var i=4*e+10;c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("transform","translate( "+(g.left-5)+", "+(150-t*v+g.top+10)+" )").attr("visibility","visible").text(t),c.select(l.event.target.parentElement).select(".tool_tip").attr("width",i+"px").attr("height","15px").select("rect").attr("transform","translate( "+(g.left-i)+", "+(150-t*v+g.top)+" )").attr("width",i+"px").attr("height","15px").attr("fill","#ebd9b2")}).on("mouseleave",function(t){c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("visibility","hidden"),c.select(l.event.target.parentElement).select(".tool_tip").select("rect").attr("width","0").attr("height","0").attr("fill","").text(t)});x.append("g").append("text").attr("class","title").attr("text-anchor","end").attr("transform",function(){return"translate( 300,15 )"}).text(s),x.append("g").attr("class","axis").append("path").attr("class","x").attr("d",function(){var t=g.left,e=g.top+150;return"M"+t+" "+e+" L "+(t+300)+" "+e});var M=c.scale.linear().range([150,0]),C=c.svg.axis().scale(M).orient("left").tickFormat(function(t){return c.round(t*c.max(h),0)});x.append("g").attr("class","y axis").attr("id","y_"+n).attr("text-anchor","end").attr("transform","translate( "+g.left+","+g.top+")").call(C).select(".domain"),x.append("g").append("text").attr("class","ax_title").attr("transform",function(){var t=c.select("#y_"+n).node();return"translate("+(g.left-t.getBoundingClientRect().width-5)+","+(g.top+t.getBoundingClientRect().height/2-30)+")rotate(-90)"}).text("Number of Jobs"),k.append("rect").attr("y",function(t){return 150-t*v}).attr("height",function(t){return t*v}).attr("width",m-1);var S=!1;if("hours"==o){k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",3).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( "+m/2+", 150)"}),k.append("text").attr("fill","rgb(0,0,0)").attr("transform","translate( 10, 160 )").text(function(t,e){return f[e].getHours()<10?"0"+String(f[e].getHours()):f[e].getHours()});var T="";S=!1,k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(t,e){var n=0;return f[e].getDate()!=T&&(S?n=20:(n=27,S=!0),T=f[e].getDate()),n}).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( 0, 150)"}),T="";var A="";S=!1,k.append("text").attr("fill","rgb(0,0,0)").attr("pointer-events","none").text(function(t,e){var n="";return f[e].getDate()!=A&&(n=String(f[e].toLocaleString("en-us",{month:"long"})),n+=" "+String(f[e].getDate()),A=f[e].getDate()),n}).attr("transform",function(t,e){var n=150,i=c.select(this).node().getBBox().width;return f[e].getDate()!=T&&(S?n+=18:(n+=26,S=!0),T=f[e].getDate()),"translate( "+(i+2)+", "+n+" )"})}else if("days"==o){k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",3).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( "+m/2+", 150)"}),k.append("text").attr("fill","rgb(0,0,0)").attr("transform","translate( 9, 160 )").text(function(t,e){return _[e].getDate()<10?"0"+String(_[e].getDate()):_[e].getDate()});var j="";S=!1,k.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(t,e){var n=0;return _[e].getMonth()!=j&&(S?n=20:(n=27,S=!0),j=_[e].getMonth()),n}).attr("stroke","black").attr("stroke-width",1).attr("pointer-events","none").attr("transform",function(){return"translate( 0, 150)"}),j="";var E="";S=!1,k.append("text").attr("fill","rgb(0,100,0)").attr("pointer-events","none").text(function(t,e){var n="";return _[e].getMonth()!=E&&(n=String(_[e].toLocaleString("en-us",{month:"long"})),n+=" "+String(_[e].getFullYear()),E=_[e].getMonth()),n}).attr("transform",function(t,e){var n=150,i=c.select(this).node().getBBox().width;return _[e].getMonth()!=j&&(S?n+=18:(n+=26,S=!0),j=_[e].getMonth()),"translate( "+(i+2)+", "+n+" )"})}x.append("g").attr("class","tool_tip").append("rect"),x.select(".tool_tip").append("text"),"jc_dy_chart"!=n&&"jc_hr_chart"!=n||c.select("#"+n).attr("height",w*b).attr("width",y*b).style("cursor","default")}function s(t,e,n){function i(){var t=c.select(this).attr("class");t=t.split(" "),c.selectAll("."+t[0]).filter("."+t[1]).style("cursor","zoom-in").transition().duration(750).attr("height",s).attr("width",d),c.select(this).style("cursor","default").transition().duration(750).attr("height",s*a).attr("width",d*a)}var r=t,a=1.75,o={top:60,right:30,bottom:50,left:60},s=150+o.top+o.bottom,d=300+o.left+o.right,u=c.scale.linear().domain([0,c.max(r)]).range([0,300]);r=c.layout.histogram().bins(u.ticks(20))(r);for(var h=[],f=0;f<r.length;f++)h.push(r[f].length);var p;p=0!==c.max(r)?150/c.max(h):1;var _=c.scale.linear().domain([0,c.max(r,function(t){return t.y})]).range([150,0]),g=function(t){var e=Math.floor(t/60),n=Math.floor(t-60*e);return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},m=c.select("#"+e).attr("viewBox","0 0 "+d+" "+s).attr("width",d).attr("height",s).attr("preserveAspectRatio","xMidYMin").on("click",i);m.append("g").append("text").attr("class","title").attr("transform",function(){return"translate( 300,15 )"}).text(n);var v,y=m.selectAll(".bar").data(r).enter().append("g").attr("class","bar").attr("transform",function(t){return"translate("+(+u(t.x)+o.left)+","+(+_(t.y)+o.top)+")"}).on("mouseenter",function(t){for(var e=0,n=t.length;n>=1;)n/=10,e++;var i=4*e+10;c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("transform","translate( "+(o.left-5)+", "+(150-t.length*p+o.top+10)+" )").attr("visibility","visible").text(t.length),c.select(l.event.target.parentElement).select(".tool_tip").attr("width",i+"px").attr("height","15px").select("rect").attr("transform","translate( "+(o.left-i)+", "+(150-t.length*p+o.top)+" )").attr("width",i+"px").attr("height","15px").attr("fill","#ebd9b2")}).on("mouseleave",function(){c.select(l.event.target.parentElement).select(".tool_tip").select("text").attr("visibility","hidden"),c.select(l.event.target.parentElement).select(".tool_tip").select("rect").attr("width","0").attr("height","0").attr("fill","")});v=void 0===r[0]?1:u(r[0].dx),y.append("rect").attr("x",1).attr("width",v-1).attr("height",function(t){return 150-_(t.y)});var b=c.svg.axis().scale(u).orient("bottom").tickFormat(g);m.append("g").attr("class","x axis").attr("id","x_"+e).attr("transform","translate( "+o.left+","+(150+o.top)+")").call(b),m.append("g").append("text").attr("class","ax_title").attr("transform",function(){var t=c.select("#x_"+e).node();return"translate("+(o.left+t.getBoundingClientRect().width/2+30)+","+(o.top+150+t.getBoundingClientRect().height+10)+")"}).text("ETA - hrs:mins");var w=c.svg.axis().scale(_).orient("left");m.append("g").attr("class","y axis").attr("id","y_"+e).attr("transform","translate( "+o.left+","+o.top+")").call(w),m.append("g").append("text").attr("class","ax_title").attr("transform",function(){var t=c.select("#y_"+e).node();return"translate("+(o.left-t.getBoundingClientRect().width-5)+","+(o.top+t.getBoundingClientRect().height/2-30)+")rotate(-90)"}).text("Number of Jobs"),m.append("g").attr("class","tool_tip").append("rect"),m.select(".tool_tip").append("text")}Object.defineProperty(e,"__esModule",{value:!0}),e.create_chart=o,e.create_histogram=s;var l=n(192),c=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(l)}).call(e,n(0))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(761),a=i(r),o=n(763),s=i(o),l=t.Router.extend({routes:{"":"groups",":group_id":"group_page"}}),c=t.View.extend({groupListView:null,groupDetailView:null,collection:null,initialize:function(){window.globalTS.groups=this,this.ts_router=new l,this.ts_router.on("route:groups",function(){window.globalTS.groups.groupListView=new a.default.GroupListView}),this.ts_router.on("route:group_page",function(t){window.globalTS.groups.groupDetailView=new s.default.GroupDetailView({group_id:t})}),t.history.start({pushState:!1})}});e.default={ToolshedGroups:c}}).call(e,n(2))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(20),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(o),l=n(413),c=a(l),d=n(762),u=a(d),h=t.View.extend({el:"#groups_element",defaults:{},initialize:function(t){this.options=i.defaults(this.options||{},this.defaults,t);var e=this;window.globalTS.groups.collection=new c.default.Groups,window.globalTS.groups.collection.fetch({success:function(t){e.render()},error:function(t,e){void 0!==e.responseJSON?s.error(e.responseJSON.err_msg):s.error("An error occurred.")}})},fetch:function(){},render:function(t){this.options=i.extend(this.options,t),r(".tooltip").hide();var e=this.templateGroupsList();this.$el.html(e({length:window.globalTS.groups.collection.models.length})),this.renderRows(window.globalTS.groups.collection.models),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),r("#center").css("overflow","auto")},renderRows:function(t){for(var e=0;e<t.length;e++){var n=t[e];this.renderOne({group:n})}},renderOne:function(t){var e=new u.default.GroupListRowView(t);this.$el.find("#group_list_body").append(e.el)},templateGroupsList:function(){var t=[];return t.push('<div id="groups">'),t.push("</div>"),t.push('<div class="groups_container table-responsive">'),t.push("<% if(length === 0) { %>"),t.push("<div>There are no groups yet.</div>"),t.push("<% } else{ %>"),t.push('<table class="grid table table-sm">'),t.push("   <thead>"),t.push("     <th>Name</th>"),t.push("     <th>Members</th> "),t.push("     <th>Repositories</th>"),t.push("   </thead>"),t.push('   <tbody id="group_list_body">'),t.push("   </tbody>"),t.push("</table>"),t.push("<% }%>"),t.push("</div>"),i.template(t.join(""))}});e.default={GroupListView:h}}).call(e,n(2),n(1),n(0))},function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0});var i=t.View.extend({events:{},initialize:function(t){this.render(t.group)},render:function(t){var e=this.templateRow();return this.setElement(e({group:t})),this.$el.show(),this},templateRow:function(){return n.template(['<tr class="" data-id="<%- group.get("id") %>">','<td><a href="groups#/<%= group.get("id") %>"><%= _.escape(group.get("name")) %></a></td>','<td><%= group.get("total_members") %></td>','<td><%= group.get("total_repos") %></td>',"</tr>"].join(""))}});e.default={GroupListRowView:i}}).call(e,n(2),n(1))},function(t,e,n){"use strict";(function(t,i,r){Object.defineProperty(e,"__esModule",{value:!0});var a=n(20),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(413),l=function(t){return t&&t.__esModule?t:{default:t}}(s),c=t.View.extend({el:"#groups_element",options:{},app:null,initialize:function(t){this.options=i.extend(this.options,t),this.app=window.globalTS.groups,null!==this.app.collection?(this.model=this.app.collection.get(this.options.group_id),this.render()):this.fetchGroup()},fetchGroup:function(t){var e=this;this.options=i.extend(this.options,t),this.model=new l.default.Group({id:this.options.group_id}),this.model.fetch({success:function(t){console.log("received data: "),console.log(t),e.render()},error:function(t,e){void 0!==e.responseJSON?o.error(e.responseJSON.err_msg):o.error("An error occurred.")}})},render:function(){var t=this.templateRow();this.$el.html(t({group:this.model})),r('#center [data-toggle="tooltip"]').tooltip({trigger:"hover"}),r("#center").css("overflow","auto")},templateRow:function(){return i.template(["<div>",'<h3><%= _.escape(group.get("name")) %></h3>','<p class="" style="color:gray;">','A group of <%= group.get("members").length %> members with <%= group.get("repositories").length %> repositories and a total of <%= group.get("total_downloads") %> combined repository clones.</p>',"<h3>Members</h3>",'<table class="grid table table-sm">',"<thead>","<th>Name</th>","<th>Repositories</th>","<th>Registered</th>","</thead>","<tbody>",'<% _.each(group.get("members"), function(member) { %>',"<tr>","<td>","<%= _.escape(member.username) %>","</td>","<td>",'<a data-toggle="tooltip" data-placement="top" title="Repositories of <%= _.escape(member.username) %>" href="/repository/browse_repositories_by_user?user_id=<%= member.id %>&use_panels=true" id="<%= member.id %>"><%= member.user_repos_count %></a>',"</td>","<td>","<%= member.time_created %>","</td>","</tr>","<% }); %>","</tbody>","</table>","<h3>Repositories</h3>",'<table class="grid table table-sm">',"<thead>","<th>Name</th>","<th>Description</th>","<th>Clones</th>","<th>Owner</th>","<th>Categories</th>","<th>Created</th>","<th>Updated</th>","<th>Rating</th>","<th>Verified</th>","</thead>","<tbody>",'<% _.each(group.get("repositories"), function(repo) { %>',"<tr>","<td>",'<a data-toggle="tooltip" data-placement="top" title="Details of <%= _.escape(repo.name) %>" href="/view/<%= _.escape(repo.owner) %>/<%= _escape(repo.name) %>" id="<%= repo.id %>"><%= _.escape(repo.name) %></a>',"</td>","<td>","<%= _.escape(repo.description) %>","</td>","<td>","<%= repo.times_downloaded %>","</td>","<td>","<%= _.escape(repo.owner) %>","</td>","<td>","<% _.each((repo.categories), function(cat) { %>",'<a data-toggle="tooltip" data-placement="top" title="Repositories in <%= cat.name %>" href="/repository/browse_repositories_in_category?id=<%= cat.id %>&use_panels=true"><%= cat.name %></a><br/>',"<% }); %>","</td>",'<td data-toggle="tooltip" data-placement="top" title="<%= repo.time_created_full %>">',"<%= repo.time_created %>","</td>",'<td data-toggle="tooltip" data-placement="top" title="<%= repo.time_updated_full %>">',"<%= repo.time_updated %>","</td>","<td>","<%= repo.ratings_mean %>","</td>","<td>","<%= repo.approved %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>"].join(""))}});e.default={GroupDetailView:c}}).call(e,n(2),n(1),n(0))}],[715]);
