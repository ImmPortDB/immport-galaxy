webpackJsonp([3],[,,,,,,,,,,,function(t,e,i){"use strict";function n(t,e){return function(i){if(t.hasOwnProperty(i))return t[i];if(!e)throw new Error("I do not know how to modify the following string: "+i+". Change your TeX file or submit a feature request at https://github.com/digitalheir/tex-to-unicode/issues.");return i+e}}Object.defineProperty(e,"__esModule",{value:!0}),e.lookupOrAppend=n},,function(t,e,i){"use strict";function n(t){return"("+t+")"}Object.defineProperty(e,"__esModule",{value:!0}),e.simpleSuffix=function(t){return function(e){return e+t}},e.isSingleTerm=/^.$|^[0-9]+$/,e.addParenthesis=n},function(t,e,i){"use strict";(function(t,n,a){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),s=r(o),l=i(31),c=r(l),u=t.Model.extend({}),d=t.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new u;n.each(n.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var i=e.split("metadata_")[1];t.set(i,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),h=d.extend({defaults:n.extend({},d.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(t){d.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=a.Deferred();return a.getJSON(this.attributes.chunk_url,{offset:t.attributes.offset}).success(function(i){var n;""!==i.ck_data?(n=i,t.attributes.offset=i.offset):(t.attributes.at_eof=!0,n=null),e.resolve(n)}),e}}),f=t.Collection.extend({model:d}),_=t.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new m({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),a.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=a("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=a("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),i=a("<thead/>").appendTo(t),n=a("<tr/>").appendTo(i);if(e)n.append("<th>"+e.join("</th><th>")+"</th>");else for(var r=1;r<=this.model.get_metadata("columns");r++)n.append("<th>"+r+"</th>");var o=this,s=this.model.get("first_data_chunk");s?this._renderChunk(s):a.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,i){var n=a("<td>").text(t),r=this.model.get_metadata("column_types");return void 0!==i?n.attr("colspan",i).addClass("stringalign"):r&&e<r.length&&("str"!==r[e]&&"list"!==r[e]||n.addClass("stringalign")),n},_renderRow:function(t){var e=t.split("\t"),i=a("<tr>"),r=this.model.get_metadata("columns");return this.row_count%2!=0&&i.addClass("dark_row"),e.length===r?n.each(e,function(t,e){i.append(this._renderCell(t,e))},this):e.length>r?(n.each(e.slice(0,r-1),function(t,e){i.append(this._renderCell(t,e))},this),i.append(this._renderCell(e.slice(r-1).join("\t"),r-1))):1===e.length?i.append(this._renderCell(t,0,r)):(n.each(e,function(t,e){i.append(this._renderCell(t,e))},this),n.each(n.range(r-e.length),function(){i.append(a("<td>"))})),this.row_count++,i},_renderChunk:function(t){var e=this.$el.find("table");n.each(t.ck_data.split("\n"),function(t,i){""!==t&&e.append(this._renderRow(t))},this)}}),p=_.extend({initialize:function(t){_.prototype.initialize.call(this,t);var e=n.find(this.$el.parents(),function(t){return"auto"===a(t).css("overflow")});e||(e=window),this.scroll_elt=a(e)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),v=_.extend({initialize:function(t){_.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),m=t.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){var e=parent.Galaxy;if(e&&e.modal&&(this.modal=e.modal),e&&e.frame&&(this.frame=e.frame),this.modal&&this.frame){var i=t.model,n=i.get("metadata");if(i.get("file_ext")){if(this.file_ext=i.get("file_ext"),"bed"==this.file_ext){if(!(n.get("chromCol")&&n.get("startCol")&&n.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=n.get("chromCol")-1,this.col.start=n.get("startCol")-1,this.col.end=n.get("endCol")-1}if("vcf"==this.file_ext){var a=function(t,e){for(var i=0;i<e.length;i++)if(e[i].match(t))return i;return-1};if(this.col.chrom=a("Chrom",n.get("column_names")),this.col.start=a("Pos",n.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start)return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.")}if(void 0!==this.col.chrom){if(!i.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=i.id,!i.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=i.get("url_viz"),i.get("genome_build")&&(this.genome_build=i.get("genome_build"));var r=new c.default.IconButtonView({model:new c.default.IconButton({title:(0,s.default)("Visualize"),icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(r.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){var e=this;if(null!==this.col.chrom){var i=a(t.target).parent(),n=i.children().eq(this.col.chrom).html(),r=i.children().eq(this.col.start).html(),o=this.col.end?i.children().eq(this.col.end).html():r;if(!n.match("^#")&&""!==n&&function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(r)){var l={dataset_id:this.dataset_id,gene_region:n+":"+r+"-"+o},c=i.offset(),u=c.left-10,d=c.top-a(window).scrollTop()+3;a("#btn_viz").css({position:"fixed",top:d+"px",left:u+"px"}),a("#btn_viz").off("click"),a("#btn_viz").click(function(){e.frame.add({title:(0,s.default)("Trackster"),url:e.url_viz+"/trackster?"+a.param(l)})}),a("#btn_viz").show()}else a("#btn_viz").hide()}},hide:function(){this.$("#btn_viz").hide()}}),g=function(t){t.model||(t.model=new h(t.dataset_config));var e=t.parent_elt,i=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var n=i?new v(t):new p(t);return n.render(),e&&(e.append(n.$el),n.expand_to_container()),n};e.default={Dataset:d,TabularDataset:h,DatasetCollection:f,TabularDatasetChunkedView:_,createTabularDatasetChunkedView:g}}).call(e,i(2),i(1),i(0))},function(t,e,i){"use strict";(function(t,n){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),o=a(r),s=i(1),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(s),c=i(14),u=a(c),d=i(18),h=a(d),f=i(33),_=a(f),p=i(24),v=a(p),m=i(80),g=a(m),w={toJSON:function(){var t=this,e={};return l.each(t.constructor.to_json_keys,function(i){var n=t.get(i);i in t.constructor.to_json_mappers&&(n=t.constructor.to_json_mappers[i](n,t)),e[i]=n}),e}},y=function(e,i){var n=new v.default({url_base:Galaxy.root+"visualization/list_history_datasets",filters:e,embedded:!0}),a=new v.default({url_base:Galaxy.root+"visualization/list_library_datasets",embedded:!0}),r=new g.default.View;r.add({id:"histories",title:(0,o.default)("Histories"),$el:t("<div/>").append(n.$el)}),r.add({id:"libraries",title:(0,o.default)("Libraries"),$el:t("<div/>").append(a.$el)}),Galaxy.modal.show({title:(0,o.default)("Select datasets for new tracks"),body:r.$el,closing_events:!0,buttons:{Cancel:function(){Galaxy.modal.hide()},Add:function(){var e=[];r.$("input.grid-row-select-checkbox[name=id]:checked").each(function(){window.console.log(t(this).val()),e[e.length]=t.ajax({url:Galaxy.root+"api/datasets/"+t(this).val(),dataType:"json",data:{data_type:"track_config",hda_ldda:"histories"==r.current()?"hda":"ldda"}})}),t.when.apply(t,e).then(function(){var e=arguments[0]instanceof Array?t.map(arguments,function(t){return t[0]}):[arguments[0]];i(e)}),Galaxy.modal.hide()}}})},b=function(t){this.default_font=void 0!==t?t:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};l.extend(b.prototype,{load_pattern:function(t,e){var i=this.patterns,n=this.dummy_context,a=new Image;a.src=Galaxy.root+"static/images"+e,a.onload=function(){i[t]=n.createPattern(a,"repeat")}},get_pattern:function(t){return this.patterns[t]},new_canvas:function(){var e=t("<canvas/>")[0];return e.manager=this,e}});var x=n.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(t){this.clear()},get_elt:function(t){var e=this.attributes.obj_cache,i=this.attributes.key_ary,n=t.toString(),a=l.indexOf(i,function(t){return t.toString()===n});return-1!==a&&(e[n].stale?(i.splice(a,1),delete e[n]):this.move_key_to_end(t,a)),e[n]},set_elt:function(t,e){var i=this.attributes.obj_cache,n=this.attributes.key_ary,a=t.toString(),r=this.attributes.num_elements;if(!i[a]){if(n.length>=r){delete i[n.shift().toString()]}n.push(t)}return i[a]=e,e},move_key_to_end:function(t,e){this.attributes.key_ary.splice(e,1),this.attributes.key_ary.push(t)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),k=x.extend({defaults:l.extend({},x.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(t,e){return!0},can_subset:function(t){return!1}}),initialize:function(t){x.prototype.initialize.call(this);var e=this.get("init_data");e&&this.add_data(e)},add_data:function(t){this.get("num_elements")<t.length&&this.set("num_elements",t.length);var e=this;l.each(t,function(t){e.set_data(t.region,t)})},data_is_ready:function(){var e=this.get("dataset"),i=t.Deferred(),n="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",a=new h.default.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:e.get("hda_ldda"),data_type:n},dataType:"json"},interval:5e3,success_fn:function(t){return"pending"!==t}});return t.when(a.go()).then(function(t){i.resolve("ok"===t||"data"===t)}),i},search_features:function(e){var i=this.get("dataset"),n={query:e,hda_ldda:i.get("hda_ldda"),data_type:"features"};return t.getJSON(i.url(),n)},load_data:function(e,i,n,a){var r=this.get("dataset"),o={data_type:this.get("data_type"),chrom:e.get("chrom"),low:e.get("start"),high:e.get("end"),mode:i,resolution:n,hda_ldda:r.get("hda_ldda")};t.extend(o,a);var s=this.get("filters_manager");if(s){for(var l=[],c=s.filters,u=0;u<c.length;u++)l.push(c[u].name);o.filter_cols=JSON.stringify(l)}var d=this,h=t.getJSON(r.url(),o,function(t){t.region=e,d.set_data(e,t)});return this.set_data(e,h),h},get_data:function(t,e,i,n){var a=this.get_elt(t);if(a&&(h.default.is_deferred(a)||this.get("data_mode_compatible")(a,e)))return a;for(var r,o,s=this.get("key_ary"),l=this.get("obj_cache"),c=0;c<s.length;c++)if(r=s[c],r.contains(t)&&(o=!0,a=l[r.toString()],h.default.is_deferred(a)||this.get("data_mode_compatible")(a,e)&&this.get("can_subset")(a))){if(this.move_key_to_end(r,c),!h.default.is_deferred(a)){var u=this.subset_entry(a,t);this.set_data(t,u),a=u}return a}if(!o&&t.length()<this.attributes.min_region_size){t=t.copy();var d=this.most_recently_added();!d||t.get("start")>d.get("start")?t.set("end",t.get("start")+this.attributes.min_region_size):t.set("start",t.get("end")-this.attributes.min_region_size),t.set("genome",this.attributes.genome),t.trim()}return this.load_data(t,e,i,n)},set_data:function(t,e){this.set_elt(t,e)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(e,i,n,a,r){var o=this._mark_stale(e);if(!o||!this.get("data_mode_compatible")(o,i))return void console.log("ERROR: problem with getting more data: current data is not compatible");var s=e.get("start");r===this.DEEP_DATA_REQ?t.extend(a,{start_val:o.data.length+1}):r===this.BROAD_DATA_REQ&&(s=(o.max_high?o.max_high:o.data[o.data.length-1][2])+1);var l=e.copy().set("start",s),c=this,u=this.load_data(l,i,n,a),d=t.Deferred();return this.set_data(e,d),t.when(u).then(function(t){t.data&&(t.data=o.data.concat(t.data),t.max_low&&(t.max_low=o.max_low),t.message&&(t.message=t.message.replace(/[0-9]+/,t.data.length))),c.set_data(e,t),d.resolve(t)}),d},can_get_more_detailed_data:function(t){var e=this.get_elt(t);return"bigwig"===e.dataset_type&&e.data.length<8e3},get_more_detailed_data:function(t,e,i,n,a){var r=this._mark_stale(t);return r?(a||(a={}),"bigwig"===r.dataset_type&&(a.num_samples=1e3*n),this.load_data(t,e,i,a)):void console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(t){var e=this.get_elt(t);return e||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),t.toString()),e.stale=!0,e},get_genome_wide_data:function(e){var i=this,n=!0,a=l.map(e.get("chroms_info").chrom_info,function(t){var e=i.get_elt(new S({chrom:t.chrom,start:0,end:t.len}));return e||(n=!1),e});if(n)return a;var r=t.Deferred();return t.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(t){i.add_data(t.data),r.resolve(t.data)}),r},subset_entry:function(t,e){var i={bigwig:function(t,e){return l.filter(t,function(t){return t[0]>=e.get("start")&&t[0]<=e.get("end")})},refseq:function(e,i){var n=i.get("start")-t.region.get("start");return t.data.slice(n,n+i.length())}},n=t.data;return!t.region.same(e)&&t.dataset_type in i&&(n=i[t.dataset_type](t.data,e)),{region:e,data:n,dataset_type:t.dataset_type}}}),C=k.extend({initialize:function(t){var e=new n.Model;e.urlRoot=t.data_url,this.set("dataset",e)},load_data:function(t,e,i,n){return t.length()<=1e5?k.prototype.load_data.call(this,t,e,i,n):{data:null,region:t}}}),T=n.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(t){this.id=t.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(t){var e=l.find(this.get_chroms_info(),function(e){return e.chrom===t});return new S({chrom:e.chrom,end:e.len})},get_chrom_len:function(t){return l.find(this.get_chroms_info(),function(e){return e.chrom===t}).len}}),S=n.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(t){return this.attributes.chrom===t.get("chrom")&&this.attributes.start===t.get("start")&&this.attributes.end===t.get("end")},initialize:function(t){if(t.from_str){var e=t.from_str.split(":"),i=e[0],n=e[1].split("-");this.set({chrom:i,start:parseInt(n[0],10),end:parseInt(n[1],10)})}this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end"),this.on("change",function(){this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end")},this)},copy:function(){return new S({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(t){var e=this.get("chrom"),i=t.get("chrom"),n=this.get("start"),a=t.get("start"),r=this.get("end"),o=t.get("end");return e&&i&&e!==i?S.overlap_results.DIF_CHROMS:n<a?r<a?S.overlap_results.BEFORE:r<o?S.overlap_results.OVERLAP_START:S.overlap_results.CONTAINS:n>a?n>o?S.overlap_results.AFTER:r<=o?S.overlap_results.CONTAINED_BY:S.overlap_results.OVERLAP_END:r>=o?S.overlap_results.CONTAINS:S.overlap_results.CONTAINED_BY},trim:function(t){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var e=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>e&&(this.attributes.end=e-1)}return this},contains:function(t){return this.compute_overlap(t)===S.overlap_results.CONTAINS},overlaps:function(t){return 0===l.intersection([this.compute_overlap(t)],[S.overlap_results.DIF_CHROMS,S.overlap_results.BEFORE,S.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),M=n.Collection.extend({model:S}),O=n.Model.extend({defaults:{region:null,note:""},initialize:function(t){this.set("region",new S(t.region))}}),z=n.Collection.extend({model:O}),A=n.Model.extend(w).extend({defaults:{mode:"Auto"},initialize:function(t){this.set("dataset",new u.default.Dataset(t.dataset));var e=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",_.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs));var i=this.get("preloaded_data");i=i?i.data:[],this.set("data_manager",new k({dataset:this.get("dataset"),init_data:i}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(t,e){return 0===l.size(t)&&(t={name:e.get("config").get("name").get("value"),color:e.get("config").get("color").get("value")}),t},dataset:function(t){return{id:t.id,hda_ldda:t.get("hda_ldda")}}}}),P=n.Collection.extend({model:A}),R=n.Model.extend({defaults:{title:"",type:""},urlRoot:Galaxy.root+"api/visualizations",save:function(){return t.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),E=R.extend(w).extend({defaults:l.extend({},R.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(t){this.set("drawables",new P(t.tracks));var e=[];this.set("config",_.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs)),this.unset("tracks"),this.get("drawables").each(function(t){t.unset("preloaded_data")})},add_tracks:function(t){this.get("drawables").add(t)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(t,e){return{obj_type:"View",prefs:{name:e.get("title"),content_visible:!0},drawables:e.get("drawables")}}}}),j=n.Router.extend({initialize:function(t){var e=this;this.view=t.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w+]+:[\d,]+-[\d,]+)$/,"change_location"),this.view.on("navigate",function(t){e.navigate(t)})},change_location:function(t){this.view.go_to(t)}});e.default={BackboneTrack:A,BrowserBookmark:O,BrowserBookmarkCollection:z,Cache:x,CanvasManager:b,Genome:T,GenomeDataManager:k,GenomeRegion:S,GenomeRegionCollection:M,GenomeVisualization:E,GenomeReferenceDataManager:C,TrackBrowserRouter:j,Visualization:R,select_datasets:y}}).call(e,i(0),i(2))},,,function(t,e,i){"use strict";(function(t,i){function n(t){t+="";for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){return"promise"in t},r=t.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(t){return!0}},go:function(){var t=i.Deferred(),e=this,n=e.get("ajax_settings"),a=e.get("success_fn"),r=e.get("interval");return function e(){i.ajax(n).success(function(i){a(i)?t.resolve(i):setTimeout(e,r)})}(),t}}),o=function(t){t||(t="#ffffff"),"string"==typeof t&&(t=[t]);for(var e=0;e<t.length;e++)t[e]=parseInt(t[e].slice(1),16);var i,n,a,r,o,s,l,c,u,d,h,f=function(t,e,i){return(299*t+587*e+114*i)/1e3},_=!1,p=0;do{for(i=Math.round(16777215*Math.random()),n=(16711680&i)>>16,a=(65280&i)>>8,r=255&i,u=f(n,a,r),_=!0,e=0;e<t.length;e++)if(o=t[e],s=(16711680&o)>>16,l=(65280&o)>>8,c=255&o,d=f(s,l,c),h=function(t,e,i,n,a,r){return Math.max(t,n)-Math.min(t,n)+(Math.max(e,a)-Math.min(e,a))+(Math.max(i,r)-Math.min(i,r))}(n,a,r,s,l,c),Math.abs(u-d)<40||h<200){_=!1;break}p++}while(!_&&p<=10);return"#"+(16777216+i).toString(16).substr(1,6)};e.default={commatize:n,is_deferred:a,ServerStateDeferred:r,get_random_color:o}}).call(e,i(2),i(0))},function(t,e,i){"use strict";var n=i(0),a=function(t){return t&&t.__esModule?t:{default:t}}(n),r=a.default;r.fn.make_text_editable=function(t){var e="num_cols"in t?t.num_cols:30,i="num_rows"in t?t.num_rows:4,n="use_textarea"in t&&t.use_textarea,a="on_finish"in t?t.on_finish:null,o="help_text"in t?t.help_text:null,s=r(this);return s.addClass("editable-text").click(function(o){if(!(r(this).children(":input").length>0)){s.removeClass("editable-text");var l,c,u=function(t){s.find(":input").remove(),""!==t?s.text(t):s.html("<br>"),s.addClass("editable-text"),a&&a(t)},d="cur_text"in t?t.cur_text:s.text();n?(l=r("<textarea/>").attr({rows:i,cols:e}).text(r.trim(d)).keyup(function(t){27===t.keyCode&&u(d)}),c=r("<button/>").text("Done").click(function(){return u(l.val()),!1})):l=r("<input type='text'/>").attr({value:r.trim(d),size:e}).blur(function(){u(d)}).keyup(function(t){27===t.keyCode?r(this).trigger("blur"):13===t.keyCode&&u(r(this).val()),t.stopPropagation()}),s.text(""),s.append(l),c&&s.append(c),l.focus(),l.select(),o.stopPropagation()}}),o&&s.attr("title",o).tooltip(),s}},,,,,function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(9),o=a(r),s=i(1),l=a(s),c=i(5),u=n(c),d=i(78),h=n(d),f=i(79),_=n(f),p=i(41),v=n(p),m=i(34),g=n(m);t.ajaxSettings.traditional=!0,e.default=o.View.extend({grid:null,initialize:function(e){this.grid=new h.default,this.title=e.title,this.active_tab=e.active_tab;var i=this;if(window.add_tag_to_grid_filter=function(e,n){var a=e+(void 0!==n&&""!==n?":"+n:"");t("#advanced-search").is(":visible")||(t("#standard-search").slideToggle("fast"),t("#advanced-search").slideToggle("fast")),i.add_filter_condition("tags",a)},e.url_base&&!e.items){g.default.markViewAsLoading(this);var n=e.url_data||{};l.each(e.filters,function(t,e){n["f-"+e]=t}),t.ajax({url:e.url_base+"?"+t.param(n),success:function(t){t.embedded=e.embedded,t.filters=e.filters||{},i.init_grid(t)}})}else this.setElement("<div>"),this.init_grid(e);e.use_panels&&t("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(e){e&&t.inArray("history",e)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&u.default.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var i=this.grid.get("url_base");if(i=i.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",i),this.$el.html(_.default.grid(e)),this.$el.find("#grid-table-header").html(_.default.header(e)),this.$el.find("#grid-table-body").html(_.default.body(e)),this.$el.find("#grid-table-footer").html(_.default.footer(e)),e.message){this.$el.find("#grid-message").html(_.default.message(e));var n=this;e.use_hide_message&&window.setTimeout(function(){n.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),window.init_refresh_on_change&&window.init_refresh_on_change()},init_grid_controls:function(){var e=this;this.$el.find(".operation-button").each(function(){t(this).off(),t(this).click(function(){return e.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){t(this).off(),t(this).click(function(){t(this).select()}).keyup(function(){t(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){t(this).off(),t(this).click(function(){return e.set_sort_condition(t(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){t(this).off(),t(this).submit(function(){var i=t(this).attr("column_key"),n=t("#input-"+i+"-filter"),a=n.val();return n.val(""),e.add_filter_condition(i,a),!1})}),this.$el.find(".text-filter-val > a").each(function(){t(this).off(),t(this).click(function(){return t(this).parent().remove(),e.remove_filter_condition(t(this).attr("filter_key"),t(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){t(this).off(),t(this).click(function(){return e.set_categorical_filter(t(this).attr("filter_key"),t(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){t(this).off(),t(this).click(function(){return e.$el.find("#standard-search").slideToggle("fast"),e.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){e.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var e=t(this).find("input.grid-row-select-checkbox"),i=t(this).find("span.grid-selected-count"),n=function(){i.text(t(e).filter(":checked").length)};t(e).each(function(){t(this).change(n)}),n()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var e=this.grid.attributes,i=this;this.$el.find(".page-link-grid > a").each(function(){t(this).click(function(){return i.set_page(t(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){t(this).click(function(){return i.execute({href:t(this).attr("href"),target:t(this).attr("target")}),!1})}),0!==e.items.length&&l.each(e.items,function(t,n){var a=i.$("#grid-"+t.encode_id+"-popup").off(),r=new v.default(a);l.each(e.operations,function(e){i.add_operation(r,e,t)})})},add_operation:function(e,i,n){var a=this,r=n.operation_config[i.label];r.allowed&&i.allow_popup&&e.addItem({html:i.label,href:r.url_args,target:r.target,confirmation_text:i.confirm,func:function(e){e.preventDefault();var r=t(e.target).html();i.onclick?i.onclick(n.encode_id):a.execute(this.findItemByHtml(r))}})},add_filter_condition:function(e,i){if(""===i)return!1;this.grid.add_filter(e,i,!0);var n=t(_.default.filter_element(e,i)),a=this;n.click(function(){t(this).remove(),a.remove_filter_condition(e,i)}),this.$el.find("#"+e+"-filtering-criteria").append(n),this.go_page_one(),this.execute()},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),this.go_page_one(),this.execute()},set_sort_condition:function(e){var i=this.grid.get("sort_key"),n=e;-1!==i.indexOf(e)&&"-"!==i.substring(0,1)&&(n="-"+e),this.$el.find(".sort-arrow").remove();var a="-"==n.substring(0,1)?"&uarr;":"&darr;",r=t("<span>"+a+"</span>").addClass("sort-arrow");this.$el.find("#"+e+"-header").append(r),this.grid.set("sort_key",n),this.go_page_one(),this.execute()},set_categorical_filter:function(e,i){var n=this.grid.get("categorical_filters")[e],a=this.grid.get("filters")[e],r=this;this.$el.find("."+e+"-filter").each(function(){var o=t.trim(t(this).text()),s=n[o],l=s[e];if(l==i)t(this).empty(),t(this).addClass("current-filter"),t(this).append(o);else if(l==a){t(this).empty();var c=t('<a href="#">'+o+"</a>");c.click(function(){r.set_categorical_filter(e,l)}),t(this).removeClass("current-filter"),t(this).append(c)}}),this.grid.add_filter(e,i),this.go_page_one(),this.execute()},set_page:function(e){var i=this;this.$el.find(".page-link").each(function(){var n,a=t(this).attr("id"),r=parseInt(a.split("-")[2],10),o=i.grid.get("cur_page");if(r===e)n=t(this).children().text(),t(this).empty(),t(this).addClass("inactive-link"),t(this).text(n);else if(r===o){n=t(this).text(),t(this).empty(),t(this).removeClass("inactive-link");var s=t('<a href="#">'+n+"</a>");s.click(function(){i.set_page(r)}),t(this).append(s)}}),"all"===e?this.grid.set("cur_page",e):this.grid.set("cur_page",parseInt(e,10)),this.execute()},submit_operation:function(e,i){var n=t(e).val();if(this.$el.find('input[name="id"]:checked').length<1)return!1;var a=l.findWhere(this.grid.attributes.operations,{label:n});a&&!i&&(i=a.confirm||"");var r=[];this.$el.find("input[name=id]:checked").each(function(){r.push(t(this).val())});var o={operation:n,id:r,confirmation_text:i};return"top"!=a.target&&"center"!=a.target||(o=l.extend(o,{href:a.href,target:a.target})),this.execute(o),!0},check_all_items:function(){var e=this.$(".grid-row-select-checkbox"),i=this.$("#check_all").prop("checked");l.each(e,function(e){t(e).prop("checked",i)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!==t&&void 0!==t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(e){var i=null,n=null,a=null,r=null,o=null;if(e&&(n=e.href,a=e.operation,i=e.id,r=e.confirmation_text,o=e.target,void 0!==n&&-1!=n.indexOf("operation="))){var s=n.split("?");if(s.length>1)for(var l=s[1],c=l.split("&"),u=0;u<c.length;u++)-1!=c[u].indexOf("operation")?(a=c[u].split("=")[1],a=a.replace(/\+/g," ")):-1!=c[u].indexOf("id")&&(i=c[u].split("=")[1])}return a&&i?!(r&&""!==r&&"None"!=r&&"null"!=r&&!window.confirm(r))&&(a=a.toLowerCase(),this.grid.set({operation:a,item_ids:i}),"top"==o?window.top.location=n+"?"+t.param(this.grid.get_url_data()):"center"==o?t("#galaxy_main").attr("src",n+"?"+t.param(this.grid.get_url_data())):this.update_grid(),!1):n?(this.go_to(o,n),!1):(this.update_grid(),!1)},go_to:function(e,i){var n=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",n),i||(i=this.grid.get("url_base")+"?"+t.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0}),e){case"center":t("#galaxy_main").attr("src",i);break;case"top":window.top.location=i;break;default:window.location=i}},update_grid:function(){var e=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var i=this;t.ajax({type:e,url:i.grid.get("url_base"),data:i.grid.get_url_data(),error:function(){alert("Grid refresh failed")},success:function(t){var e=i.grid.get("embedded"),n=i.grid.get("insert"),a=i.$el.find("#advanced-search").is(":visible"),r=t;r.embedded=e,r.insert=n,r.advanced_search=a,i.init_grid(r),i.$el.find(".loading-elt-overlay").hide()},complete:function(){i.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(e,i(0))},,,,function(t,e,i){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i(29)),n(i(30)),n(i(94))},function(t,e,i){"use strict";function n(t,e,i,n){if(void 0===n&&(n={writable:!0,enumerable:!0,configurable:!0}),!(t instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0!==e){if(!(e instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===n)n={writable:!0,enumerable:!0,configurable:!0};else if(!(n instanceof Object))throw new TypeError('"attributes" isn\'t an Object instance');if(void 0===i)for(var a in e)void 0!==e[a]&&Object.defineProperty(t,a,Object.create(n,{value:{value:e[a]}}));else if(i instanceof Array)i.forEach(function(i){void 0!==e[i]&&Object.defineProperty(t,i,Object.create(n,{value:{value:e[i]}}))});else{if(!(i instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var r in i){var a=i[r];void 0!==e[a]&&Object.defineProperty(t,r,Object.create(n,{value:{value:e[a]}}))}}}}function a(t,e,i,n){if(void 0===n&&(n=!0),!(t instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0===e)return!0;if(!(e instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===n&&(n=!0),void 0===i){for(var a in e)if(t[a]!==e[a]&&(void 0!==e[a]||!n))return!1}else{if(i instanceof Array)return i.every(function(i){return t[i]===e[i]||void 0===e[i]&&n});if(!(i instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var r in i){var a=i[r];if(t[r]!==e[a]&&(void 0!==e[a]||!n))return!1}}return!0}function r(t){return"number"==typeof t}function o(t){return"string"==typeof t}function s(t,e){if(!t)throw new Error(e);return t}function l(t,e){if(!(t instanceof Object))throw new TypeError(e||"Expected Object");return t}function c(t,e){if("string"!=typeof t)throw new TypeError(e||"Expected string");return t}function u(t,e){if(!d(t))throw new TypeError(e||"Expected Array");return t}function d(t){return!!t&&t.constructor===Array}function h(t,e){return[].concat.apply([],t.map(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.updateProperties=n,e.testProperties=a,e.mustBeNumber=function(t,e){if(!r(t))throw new TypeError(e||"Expected number");return t},e.isNumber=r,e.isString=o,e.mustNotBeUndefined=s,e.mustBeObject=l,e.mustBeString=c,e.mustBeArray=u,e.isArray=d,e.mconcat=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduceRight(t)},e.snd=function(t){return t[1]},e.concatMap=h},function(t,e,i){"use strict";function n(t){return r(t)||o(t)}function a(t){return e.measureTypes.hasOwnProperty(t)}function r(t){return a(t.type)&&X.isNumber(t.value)}function o(t){return p(t.expression)}function s(t){if(void 0===t)return!1;switch(t){case"Parentheses":case"Square":case"Dollar":return!0;default:return!1}}function l(t,e){return void 0!==t&&(void 0===e?"string"==typeof t.name:e===t.name)}function c(t){return void 0!==t&&"string"==typeof t.text}function u(t){return void 0!==t&&X.isArray(t.latex)}function d(t){return t.arguments instanceof Array}function h(t){return t===W.SUP||t===W.SUB}function f(t){switch(t){case"#":return"\\#";case"$":return"\\$";case"%":return"\\%";case"^":return"\\^{}";case"&":return"\\&";case"{":return"\\{";case"}":return"\\}";case"~":return"\\~{}";case"\\":return"\\textbackslash{}";case"_":return"\\_{}";default:return t}}function _(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return 0===e.length?"string"==typeof t.type:e.some(function(e){return t.type===e})}function p(t){return m(t)||v(t)}function v(t){return A(t)||w(t)||y(t)||x(t)||k(t)||C(t)||S(t)||z(t)}function m(t){return A(t)||g(t)||y(t)||x(t)||k(t)||C(t)||S(t)||z(t)}function g(t){return void 0!==t&&void 0!==t.type&&c(t)&&_(t,e.typeTeXRaw)}function w(t){return void 0!==t&&"string"==typeof t.string&&"number"==typeof t.category}function y(t){return l(t)&&d(t)&&_(t,e.typeTeXComm,e.typeTeXCommS)}function b(t){return y(t)&&0===t.arguments.length}function x(t,i){return _(t,e.typeTeXEnv)}function k(t){return u(t)&&_(t)&&s(t.type)}function C(t){return void 0!==t&&"boolean"==typeof t.noNewPage&&(void 0===t.measure||n(t.measure))}function T(t){return h(t.type)}function S(t){return u(t)&&_(t,e.typeTeXBraces)}function M(t){return _(t,"FixArg")}function O(t){return _(t,"OptArg")}function z(t){return c(t)&&_(t,e.typeTeXComment)}function A(t){return void 0!==t&&0===Object.keys(t).length}function P(t){return{type:"FixArg",latex:t}}function R(t){return 1===t.length?{type:"OptArg",latex:t}:{type:"MOptArg",latex:t}}function E(t){return{type:"SymArg",latex:[t]}}function j(t){return{type:"ParArg",latex:[t]}}function q(t){return{type:"MOptArg",latex:t}}function $(t){return{type:"MSymArg",latex:t}}function L(t){return{type:"MParArg",latex:t}}function I(t){return{name:t,arguments:[],type:e.typeTeXCommS}}function D(t){return{text:t,type:e.typeTeXRaw,characterCategories:J.convertToTeXCharsDefault(t)}}function N(t,e,i,n){return{latex:n,type:t,startSymbol:e,endSymbol:i}}function G(t){return{latex:[t],type:e.typeTeXBraces}}function B(t){return{text:t,type:e.typeTeXComment}}function U(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return{name:t,arguments:i,type:e.typeTeXComm}}function F(t,e,i){return{type:t,symbol:e,arguments:i}}function V(t,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return{name:t,latex:i,arguments:n,type:e.typeTeXEnv}}function H(t){var e=[];return Y(t,e),e.join("")}function Y(t,e){if(y(t))e.push("\\",t.name),t.arguments.forEach(function(t){return Y(t,e)});else{if(x(t))throw new Error("not supported yet");if(k(t))e.push(t.startSymbol),t.latex.forEach(function(t){return Y(t,e)}),e.push(t.endSymbol);else if(C(t))e.push("\n");else if(T(t))e.push(t.symbol),t.arguments&&t.arguments.forEach(function(t){return Y(t,e)});else if(S(t))e.push("{"),t.latex.forEach(function(t){return Y(t,e)}),e.push("}");else if(z(t))e.push("%"+t.text+"\n");else if(g(t))e.push(t.text);else{if(w(t))throw new Error("not supported yet");if(M(t))e.push("{"),t.latex.forEach(function(t){return Y(t,e)}),e.push("}");else{if(!O(t))throw new Error("Did not recognize "+JSON.stringify(t));e.push("["),t.latex.forEach(function(t){return Y(t,e)}),e.push("]")}}}}Object.defineProperty(e,"__esModule",{value:!0});var X=i(29),J=i(45);e.isMeasure=n,e.measureTypes={pt:!0,mm:!0,cm:!0,in:!0,ex:!0,em:!0},e.isMeasureType=a,e.isBuiltInMeasure=r,e.isCustomMeasure=o,e.mathTypes={Parentheses:"Parentheses",Square:"Square",Dollar:"Dollar"},e.isMathType=s,e.isNameHaving=l,e.isTextHaving=c,e.isLaTeXHaving=u,e.isArgumentHaving=d,e.typeTeXSeq="TeXSeq",e.typeTeXEnv="TeXEnv",e.typeTeXBraces="TeXBraces",e.typeTeXComment="TeXComment",e.typeTeXRaw="TeXRaw",e.typeTeXComm="TeXComm",e.typeTeXCommS="TeXCommS";var W;!function(t){t[t.SUP=0]="SUP",t[t.SUB=1]="SUB"}(W=e.SubOrSuperSymbol||(e.SubOrSuperSymbol={})),e.isSubOrSuperSymbol=h,e.fromStringLaTeX=function(t){return D(e.protectString(t))},e.protectString=function(t){for(var e=[],i=0;i<t.length;i++)e.push(f(t.charAt(i)));return e.join()},e.protectChar=f,e.isTypeHaving=_,e.isLaTeXBlock=p,e.isLaTeXNoRaw=v,e.isLaTeXRaw=m,e.isTeXRaw=g,e.isTeXChar=w,e.isTeXComm=y,e.isTeXCommS=b,e.isTeXEnv=x,e.isTeXMath=k,e.isTeXLineBreak=C,e.isSubOrSuperScript=T,e.isTeXBraces=S,e.isFixArg=M,e.isOptArg=O,e.isTeXComment=z,e.isTeXEmpty=A,e.newFixArg=P,e.newOptArg=R,e.newSymArg=E,e.newParArg=j,e.newMOptArg=q,e.newMSymArg=$,e.newMParArg=L,e.newCommandS=I,e.newTeXRaw=D,e.newTeXMath=N,e.newTeXBraces=G,e.newTeXMathDol=function(t){return N("Dollar","$","$",t)},e.newTeXComment=B,e.newTeXComm=U,e.newSubOrSuperScript=F,e.newTeXEnv=V,e.stringifyLaTeX=H},function(t,e,i){"use strict";(function(t,i,n){Object.defineProperty(e,"__esModule",{value:!0});var a=t.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),r=t.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return!i.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(t),!1)},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",n(e)}}),o=t.Collection.extend({model:a}),s=t.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var i=n("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&i.tooltip(e.attributes.tooltip_config);var a=e.get("options");a&&make_popupmenu(i,a)}),this}}),l=function(t,e){e||(e={});var n=new o(i.map(t,function(t){return new a(i.extend(t,e))}));return new s({collection:n})};e.default={IconButton:a,IconButtonView:r,IconButtonCollection:o,IconButtonMenuView:s,create_icon_buttons_menu:l}}).call(e,i(2),i(1),i(0))},function(t,e,i){"use strict";(function(t){function i(e,i){i=i||window.location.search.substr(1);var n=new RegExp(e+"=([^&#$]+)","g"),a=i.match(n);if(a&&a.length)return a=t.map(a,function(t){return decodeURIComponent(t.substr(e.length+1).replace(/\+/g," "))}),1===a.length?a[0]:a}function n(t){if(!t)return{};var e={};return t.split("&").forEach(function(t){var i=t.split("=");e[i[0]]=decodeURI(i[1])}),e}Object.defineProperty(e,"__esModule",{value:!0}),e.default={get:i,parse:n}}).call(e,i(1))},function(t,e,i){"use strict";(function(t){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),r=n(a),o=i(2),s=n(o),l=i(18),c=function(t){return t&&t.__esModule?t:{default:t}}(l),u=s.Model.extend({initialize:function(t){var e=this.get("key");this.set("id",e);var i=r.find([{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0}],function(t){return t.key===e});i&&this.set(r.extend({},i,t)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",c.default.get_random_color()))},set_value:function(t,e){var i=this.get("type");"float"===i?t=parseFloat(t):"int"===i&&(t=parseInt(t,10)),this.set({value:t},e)}}),d=s.Collection.extend({model:u,to_key_value_dict:function(){var t={};return this.each(function(e){t[e.get("key")]=e.get("value")}),t},get_value:function(t){var e=this.get(t);if(e)return e.get("value")},set_value:function(t,e,i){var n=this.get(t);if(n)return n.set_value(e,i)},set_default_value:function(t,e){var i=this.get(t);if(i)return i.set("default_value",e)}},{from_models_and_saved_values:function(t,e){return e&&(t=r.map(t,function(t){return r.extend({},t,{value:e[t.key]})})),new d(t)}}),h=s.View.extend({className:"config-settings-view",render:function(){var e=this.$el;return this.collection.each(function(i,n){if(!i.get("hidden")){var a="param_"+n,o=i.get("type"),s=i.get("value"),l=t("<div class='form-row' />").appendTo(e);if(l.append(t("<label />").attr("for",a).text(i.get("label")+":")),"bool"===o)l.append(t('<input type="checkbox" />').attr("id",a).attr("name",a).attr("checked",s));else if("text"===o)l.append(t('<input type="text"/>').attr("id",a).val(s).click(function(){t(this).select()}));else if("select"===o){var u=t("<select />").attr("id",a);r.each(i.get("options"),function(e){t("<option/>").text(e.label).attr("value",e.value).appendTo(u)}),u.val(s),l.append(u)}else if("color"===o){var d=t("<div/>").appendTo(l),h=t("<input />").attr("id",a).attr("name",a).val(s).css("float","left").appendTo(d).click(function(e){t(".tooltip").removeClass("in");var i=t(this).siblings(".tooltip").addClass("in");i.css({left:t(this).position().left+t(this).width()+5,top:t(this).position().top-t(i).height()/2+t(this).height()/2}).show(),i.click(function(t){t.stopPropagation()}),t(document).bind("click.color-picker",function(){i.hide(),t(document).unbind("click.color-picker")}),e.stopPropagation()}),f=t("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(d).attr("title","Set new random color").tooltip(),_=t("<div class='tooltip right' style='position: absolute;' />").appendTo(d).hide(),p=t("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(_);t("<div class='tooltip-arrow'></div>").appendTo(_);var v=t.farbtastic(p,{width:100,height:100,callback:h,color:s});d.append(t("<div/>").css("clear","both")),function(t){f.click(function(){t.setColor(c.default.get_random_color())})}(v)}else l.append(t("<input />").attr("id",a).attr("name",a).val(s));i.help&&l.append(t("<div class='help'/>").text(i.help))}}),this},render_in_modal:function(e){var i=this,n=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc")},a=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc"),i.update_from_form()},r=function(t){27===(t.keyCode||t.which)?n():13===(t.keyCode||t.which)&&a()};t(window).bind("keypress.check_enter_esc",r),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:e||"Configure",body:this.$el,buttons:{Cancel:n,OK:a}})},update_from_form:function(){var t=this;this.collection.each(function(e,i){if(!e.get("hidden")){var n="param_"+i,a=t.$el.find("#"+n).val();"bool"===e.get("type")&&(a=t.$el.find("#"+n).is(":checked")),e.set_value(a)}})}});e.default={ConfigSetting:u,ConfigSettingCollection:d,ConfigSettingCollectionView:h}}).call(e,i(0))},function(t,e,i){"use strict";function n(t,e){function i(){var i=['<div class="loading-indicator">','<div class="loading-indicator-text">','<span class="fa fa-spinner fa-spin fa-lg"></span>','<span class="loading-indicator-message">loading...</span>',"</div>","</div>"].join("\n"),n=o(i).hide().css(e.css||{position:"fixed"}),a=n.children(".loading-indicator-text");return e.cover?(n.css({"z-index":2,top:t.css("top"),bottom:t.css("bottom"),left:t.css("left"),right:t.css("right"),opacity:.5,"background-color":"white","text-align":"center"}),a=n.children(".loading-indicator-text").css({"margin-top":"20px"})):(a=n.children(".loading-indicator-text").css({margin:"12px 0px 0px 10px",opacity:"0.85",color:"grey"}),a.children(".loading-indicator-message").css({margin:"0px 8px 0px 0px","font-style":"italic"})),n}var n=this;return e=r.default.extend({cover:!1},e||{}),n.show=function(e,a,r){return e=e||"loading...",a=a||"fast",t.parent().find(".loading-indicator").remove(),n.$indicator=i().insertBefore(t),n.message(e),n.$indicator.fadeIn(a,r),n},n.message=function(t){n.$indicator.find("i").text(t)},n.hide=function(t,e){return t=t||"fast",n.$indicator&&n.$indicator.length?n.$indicator.fadeOut(t,function(){n.$indicator.remove(),e&&e()}):e&&e(),n},n}Object.defineProperty(e,"__esModule",{value:!0});var a=i(0),r=function(t){return t&&t.__esModule?t:{default:t}}(a),o=r.default,s=function(t){t.setElement(o('<div><div class="loading"></div></div>')),new n(t.$(".loading")).show()};e.default={LoadingIndicator:n,markViewAsLoading:s}},,,,,,,function(t,e,i){"use strict";(function(t,i,n,a){Object.defineProperty(e,"__esModule",{value:!0});var r=t.View.extend({initialize:function(t,e){this.$button=t,this.$button.length||(this.$button=i("<div/>")),this.options=e||[],this.$button.data("popupmenu",this);var n=this;this.$button.click(function(t){return i(".popmenu-wrapper").remove(),n._renderAndShow(t),!1})},_renderAndShow:function(t){this.render(),this.$el.appendTo("body").css(this._getShownPosition(t)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var t=this;this.$el.find("li").each(function(e,n){var a=t.options[e];a.func&&i(this).children("a.popupmenu-option").click(function(e){a.func.call(t,e,a),e.preventDefault()})})}return this},template:function(t,e){return['<ul id="',t,'-menu" class="dropdown-menu">',this._templateOptions(e),"</ul>"].join("")},_templateOptions:function(t){return t.length?n.map(t,function(t){return t.divider?'<li class="divider"></li>':t.header?['<li class="head"><a href="javascript:void(0);">',t.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',t.href||"javascript:void(0);",'"',t.target?' target="'+t.target+'"':"",">",t.checked?'<span class="fa fa-check"></span>':"",t.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(t){var e=this.$el.width(),n=t.pageX-e/2;return n=Math.min(n,i(document).scrollLeft()+i(window).width()-e-5),n=Math.max(n,i(document).scrollLeft()+5),{top:t.pageY,left:n}},_setUpCloseBehavior:function(){function t(t){if(i(document).off("click.close_popup"),window&&window.parent!==window)try{i(window.parent.document).off("click.close_popup")}catch(t){}else try{i("iframe#galaxy_main").contents().off("click.close_popup")}catch(t){}e.remove()}var e=this;if(i("html").one("click.close_popup",t),window&&window.parent!==window)try{i(window.parent.document).find("html").one("click.close_popup",t)}catch(t){}else try{i("iframe#galaxy_main").contents().one("click.close_popup",t)}catch(t){}},addItem:function(t,e){return e=e>=0?e:this.options.length,this.options.splice(e,0,t),this},removeItem:function(t){return t>=0&&this.options.splice(t,1),this},findIndexByHtml:function(t){for(var e=0;e<this.options.length;e++)if(n.has(this.options[e],"html")&&this.options[e].html===t)return e;return null},findItemByHtml:function(t){return this.options[this.findIndexByHtml(t)]},toString:function(){return"PopupMenu"}});r.create=function(t,e){return new r(t,e)},r.make_popupmenu=function(t,e){var o=[];return n.each(e,function(t,e){var i={html:e};null===t?i.header=!0:"function"===a.type(t)&&(i.func=t),o.push(i)}),new r(i(t),o)},r.convertLinksToOptions=function(t,e){t=i(t),e=e||"a";var n=[];return t.find(e).each(function(t,e){var a={},r=i(t);if(a.html=r.text(),r.attr("href")){var o=r.attr("href"),s=r.attr("target"),l=r.attr("confirm");a.func=function(){if(!l||confirm(l))switch(s){case"_parent":window.parent.location=o;break;case"_top":window.top.location=o;break;default:window.location=o}}}n.push(a)}),n},r.fromExistingDom=function(t,e,n){t=i(t),e=i(e);var a=r.convertLinksToOptions(e,n);return e.remove(),new r(t,a)},r.make_popup_menus=function(t,e,n){t=t||document,e=e||"div[popupmenu]",n=n||function(t,e){return"#"+t.attr("popupmenu")};var a=[];return i(t).find(e).each(function(){var e=i(this),o=i(t).find(n(e,t));a.push(r.fromDom(o,e)),o.addClass("popup")}),a},e.default=r}).call(e,i(2),i(0),i(1),i(0))},,function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=i(35),a=function(t){return t&&t.__esModule?t:{default:t}}(n),r=i(90),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),s=i(91),l=i(28);e.default={props:{source:{type:String,required:!0},id:{type:String,required:!0},viewRender:{type:Boolean,requried:!1,default:!0}},data:function(){return{citations:[],content:"",errors:[]}},computed:{formattedReferences:function(){var t=this;return this.citations.reduce(function(e,i){return e.concat('<p class="formatted-reference">'+t.formattedReference(i)+"</p>")},"")}},created:function(){var e=this;a.default.get(Galaxy.root+"api/"+this.source+"/"+this.id+"/citations").then(function(i){e.content="";var n=!0,a=!1,r=void 0;try{for(var s,l=i.data[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;try{var u={fields:{},entryType:void 0},d=o.toJSON(c.content);if(d){d=t.first(d),u.entryType=d.entryType||void 0;for(var h in d.entryTags)u.fields[h.toLowerCase()]=d.entryTags[h]}e.citations.push(u),e.content+=c.content}catch(t){console.warn("Error parsing bibtex: "+t)}}}catch(t){a=!0,r=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw r}}}).catch(function(t){console.error(t)})},methods:{formattedReference:function(t){var e=t.entryType,i=t.fields,n="",a=this._asSentence((i.author?i.author:"")+(i.year?" ("+i.year+")":""))+" ",r=i.title||"",o=i.pages?"pp. "+i.pages:"",c=i.address;if("article"==e){var u=(i.volume?i.volume:"")+(i.number?" ("+i.number+")":"")+(o?", "+o:"");n=a+this._asSentence(r)+(i.journal?"In <em>"+i.journal+", ":"")+this._asSentence(u)+this._asSentence(i.address)+"</em>"}else n="inproceedings"==e||"proceedings"==e?a+this._asSentence(r)+(i.booktitle?"In <em>"+i.booktitle+", ":"")+(o||"")+(c?", "+c:"")+".</em>":"mastersthesis"==e||"phdthesis"==e?a+this._asSentence(r)+(i.howpublished?i.howpublished+". ":"")+(i.note?i.note+".":""):"techreport"==e?a+this._asSentence(r)+this._asSentence(i.institution)+this._asSentence(i.number)+this._asSentence(i.type):"book"==e||"inbook"==e||"incollection"==e?a+" "+this._formatBookInfo(i):a+" "+this._asSentence(r)+this._asSentence(i.howpublished)+this._asSentence(i.note);var d="";i.doi&&(d="http://dx.doi.org/"+i.doi,n+='[<a href="'+d+'" target="_blank">doi:'+i.doi+"</a>]");var h=i.url||d;return h&&(n+='[<a href="'+h+'" target="_blank">Link</a>]'),(0,s.convertLaTeX)({onError:function(t,e){return"{"+(0,l.stringifyLaTeX)(e)+"}"}},n)},_formatBookInfo:function(t){var e="";return t.chapter&&(e+=t.chapter+" in "),t.title&&(e+="<em>"+t.title+"</em>"),t.editor&&(e+=", Edited by "+t.editor+", "),t.publisher&&(e+=", "+t.publisher),t.pages&&(e+=", pp. "+t.pages),t.series&&(e+=", <em>"+t.series+"</em>"),t.volume&&(e+=", Vol."+t.volume),t.issn&&(e+=", ISBN: "+t.issn),e+"."},_asSentence:function(t){return t&&t.trim()?t+". ":""},toggleViewRender:function(){this.viewRender=!this.viewRender}}}}).call(e,i(1))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.supportedMarkups={ascii:!0,unicode:!0,html:!0}},function(t,e,i){"use strict";function n(t){return a(e.defaultCategories,t)}function a(t,e){for(var i=[],n=0;n<e.length;n++){var a=e.charAt(n);i.push({string:a,category:t(a)})}return i}Object.defineProperty(e,"__esModule",{value:!0}),e.defaultCategories=function(t){switch(t){case"\\":return 0;case"{":return 1;case"}":return 2;case"$":return 3;case"&":return 4;case"\r":return 5;case"#":return 6;case"^":return 7;case"_":return 8;case"\0":return 9;case" ":return 10;case"~":return 13;case"%":return 14;case"d":return 15;default:return 11}},e.convertToTeXCharsDefault=n,e.convertToTeXChars=a},function(t,e,i){!function(e,i){t.exports=i()}(0,function(){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);this._=t}function a(t){return t instanceof n}function r(t){return"[object Array]"==={}.toString.call(t)}function o(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function s(t,e){return{status:!1,index:-1,value:null,furthest:t,expected:[e]}}function l(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var i=t.furthest===e.furthest?u(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:i}}function c(t,e){var i=t.slice(0,e).split("\n");return{offset:e,line:i.length,column:i[i.length-1].length+1}}function u(t,e){var i=t.length,n=e.length;if(0===i)return e;if(0===n)return t;for(var a={},r=0;r<i;r++)a[t[r]]=!0;for(var o=0;o<n;o++)a[e[o]]=!0;var s=[];for(var l in a)a.hasOwnProperty(l)&&s.push(l);return s.sort(),s}function d(t){if(!a(t))throw new Error("not a parser: "+t)}function h(t){if(!r(t))throw new Error("not an array: "+t)}function f(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function _(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=y(t),i=0;i<e.length;i++){var n=e.charAt(i);if("i"!==n&&"m"!==n&&"u"!==n)throw new Error('unsupported regexp flag "'+n+'": '+t)}}function p(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function v(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function m(t){return 1===t.length?t[0]:"one of "+t.join(", ")}function g(t,e){var i=e.index,n=i.offset;if(n===t.length)return", got the end of the input";var a=n>0?"'...":"'",r=t.length-n>12?"...'":"'";return" at line "+i.line+" column "+i.column+", got "+a+t.slice(n,n+12)+r}function w(t,e){return"expected "+m(e.expected)+g(t,e)}function y(t){var e=""+t;return e.slice(e.lastIndexOf("/")+1)}function b(t){return RegExp("^(?:"+t.source+")",y(t))}function x(){for(var t=[].slice.call(arguments),e=t.length,i=0;i<e;i+=1)d(t[i]);return n(function(i,n){for(var a,r=new Array(e),s=0;s<e;s+=1){if(a=l(t[s]._(i,n),a),!a.status)return a;r[s]=a.value,n=a.index}return l(o(n,r),a)})}function k(){for(var t={},e=0,i=[].slice.call(arguments),s=i.length,c=0;c<s;c+=1){var u=i[c];if(!a(u)){if(r(u)&&2===u.length&&"string"==typeof u[0]&&a(u[1])){var d=u[0];if(t[d])throw new Error("seqObj: duplicate key "+d);t[d]=!0,e++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===e)throw new Error("seqObj expects at least one named parser, found zero");return n(function(t,e){for(var n,a={},c=0;c<s;c+=1){var u,d;if(r(i[c])?(u=i[c][0],d=i[c][1]):(u=null,d=i[c]),n=l(d._(t,e),n),!n.status)return n;u&&(a[u]=n.value),e=n.index}return l(o(e,a),n)})}function C(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return p(e),x.apply(null,t).map(function(t){return e.apply(null,t)})}function T(t){var e={};for(var i in t)({}).hasOwnProperty.call(t,i)&&function(i){var n=function(){return t[i](e)};e[i]=G(n)}(i);return e}function S(){var t=[].slice.call(arguments),e=t.length;if(0===e)return R("zero alternates");for(var i=0;i<e;i+=1)d(t[i]);return n(function(e,i){for(var n,a=0;a<t.length;a+=1)if(n=l(t[a]._(e,i),n),n.status)return n;return n})}function M(t,e){return O(t,e).or(P([]))}function O(t,e){d(t),d(e);var i=e.then(t).many();return t.chain(function(t){return i.map(function(e){return[t].concat(e)})})}function z(t){v(t);var e="'"+t+"'";return n(function(i,n){var a=n+t.length,r=i.slice(n,a);return r===t?o(a,r):s(n,e)})}function A(t,e){_(t),arguments.length>=2?f(e):e=0;var i=b(t),a=""+t;return n(function(t,n){var r=i.exec(t.slice(n));if(r){if(0<=e&&e<=r.length){var l=r[0],c=r[e];return o(n+l.length,c)}return s(n,"valid match group (0 to "+r.length+") in "+a)}return s(n,a)})}function P(t){return n(function(e,i){return o(i,t)})}function R(t){return n(function(e,i){return s(i,t)})}function E(t){if(a(t))return n(function(e,i){var n=t._(e,i);return n.index=i,n.value="",n});if("string"==typeof t)return E(z(t));if(t instanceof RegExp)return E(A(t));throw new Error("not a string, regexp, or parser: "+t)}function j(t){return d(t),n(function(e,i){var n=t._(e,i),a=e.slice(i,n.index);return n.status?s(i,'not "'+a+'"'):o(i,null)})}function q(t){return p(t),n(function(e,i){var n=e.charAt(i);return i<e.length&&t(n)?o(i+1,n):s(i,"a character matching "+t)})}function $(t){return q(function(e){return t.indexOf(e)>=0})}function L(t){return q(function(e){return t.indexOf(e)<0})}function I(t){return n(t(o,s))}function D(t,e){return q(function(i){return t<=i&&i<=e}).desc(t+"-"+e)}function N(t){return p(t),n(function(e,i){for(var n=i;n<e.length&&t(e.charAt(n));)n++;return o(n,e.slice(i,n))})}function G(t,e){arguments.length<2&&(e=t,t=void 0);var i=n(function(t,n){return i._=e()._,i._(t,n)});return t?i.desc(t):i}function B(){return R("fantasy-land/empty")}var U=n.prototype;U.parse=function(t){if("string"!=typeof t)throw new Error(".parse must be called with a string as its argument");var e=this.skip(Y)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:c(t,e.furthest),expected:e.expected}},U.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var i=w(t,e),n=new Error(i);throw n.type="ParsimmonError",n.result=e,n},U.or=function(t){return S(this,t)},U.trim=function(t){return this.wrap(t,t)},U.wrap=function(t,e){return C(t,this,e,function(t,e){return e})},U.thru=function(t){return t(this)},U.then=function(t){return d(t),x(this,t).map(function(t){return t[1]})},U.many=function(){var t=this;return n(function(e,i){for(var n=[],a=void 0;;){if(a=l(t._(e,i),a),!a.status)return l(o(i,n),a);i=a.index,n.push(a.value)}})},U.tie=function(){return this.map(function(t){h(t);for(var e="",i=0;i<t.length;i++)v(t[i]),e+=t[i];return e})},U.times=function(t,e){var i=this;return arguments.length<2&&(e=t),f(t),f(e),n(function(n,a){for(var r=[],s=void 0,c=void 0,u=0;u<t;u+=1){if(s=i._(n,a),c=l(s,c),!s.status)return c;a=s.index,r.push(s.value)}for(;u<e&&(s=i._(n,a),c=l(s,c),s.status);u+=1)a=s.index,r.push(s.value);return l(o(a,r),c)})},U.result=function(t){return this.map(function(){return t})},U.atMost=function(t){return this.times(0,t)},U.atLeast=function(t){return C(this.times(t),this.many(),function(t,e){return t.concat(e)})},U.map=function(t){p(t);var e=this;return n(function(i,n){var a=e._(i,n);return a.status?l(o(a.index,t(a.value)),a):a})},U.skip=function(t){return x(this,t).map(function(t){return t[0]})},U.mark=function(){return C(F,this,F,function(t,e,i){return{start:t,value:e,end:i}})},U.node=function(t){return C(F,this,F,function(e,i,n){return{name:t,value:i,start:e,end:n}})},U.sepBy=function(t){return M(this,t)},U.sepBy1=function(t){return O(this,t)},U.lookahead=function(t){return this.skip(E(t))},U.notFollowedBy=function(t){return this.skip(j(t))},U.desc=function(t){var e=this;return n(function(i,n){var a=e._(i,n);return a.status||(a.expected=[t]),a})},U.fallback=function(t){return this.or(P(t))},U.ap=function(t){return C(t,this,function(t,e){return t(e)})},U.chain=function(t){var e=this;return n(function(i,n){var a=e._(i,n);return a.status?l(t(a.value)._(i,a.index),a):a})},U.concat=U.or,U.empty=B,U.of=P,U["fantasy-land/ap"]=U.ap,U["fantasy-land/chain"]=U.chain,U["fantasy-land/concat"]=U.concat,U["fantasy-land/empty"]=U.empty,U["fantasy-land/of"]=U.of,U["fantasy-land/map"]=U.map;var F=n(function(t,e){return o(e,c(t,e))}),V=n(function(t,e){return e>=t.length?s(e,"any character"):o(e+1,t.charAt(e))}),H=n(function(t,e){return o(t.length,t.slice(e))}),Y=n(function(t,e){return e<t.length?s(e,"EOF"):o(e,null)}),X=A(/[0-9]/).desc("a digit"),J=A(/[0-9]*/).desc("optional digits"),W=A(/[a-z]/i).desc("a letter"),K=A(/[a-z]*/i).desc("optional letters"),Z=A(/\s*/).desc("optional whitespace"),Q=A(/\s+/).desc("whitespace");n.all=H,n.alt=S,n.any=V,n.createLanguage=T,n.custom=I,n.digit=X,n.digits=J,n.empty=B,n.eof=Y,n.fail=R,n.formatError=w,n.index=F,n.isParser=a,n.lazy=G,n.letter=W,n.letters=K,n.lookahead=E,n.makeFailure=s,n.makeSuccess=o,n.noneOf=L,n.notFollowedBy=j,n.of=P,n.oneOf=$,n.optWhitespace=Z,n.Parser=n,n.range=D,n.regex=A,n.regexp=A,n.sepBy=M,n.sepBy1=O,n.seq=x,n.seqMap=C,n.seqObj=k,n.string=z,n.succeed=P,n.takeWhile=N,n.test=q,n.whitespace=Q,n["fantasy-land/empty"]=B,n["fantasy-land/of"]=P,t.exports=n}])})},function(t,e,i){"use strict";function n(t){return new Error("I do not know command "+t)}Object.defineProperty(e,"__esModule",{value:!0}),e.unknownCommandError=n},function(t,e,i){"use strict";function n(t,e,i,n){return{name:t,optionalArguments:e,argumentCount:i,apply:n}}function a(t,e,i){return{name:t,optionalArguments:e,argumentCount:i}}function r(t,e){return{name:t,optionalArguments:0,argumentCount:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.createCommandHandler=n,e.createKnownCommandWithOptArgs=a,e.createKnownCommandWithArgs=r},function(t,e,i){"use strict";function n(t){return"bb"===t||"mathbb"===t||"textbb"===t}function a(t){return"bf"===t||"mathbf"===t||"textbf"===t}function r(t){return"mono"===t}function o(t){return"frak"===t||"mathfrak"===t||"textfrak"===t}function s(t){return"it"===t||"mathit"===t||"textit"===t}function l(t){return"tt"===t||"mathtt"===t||"texttt"===t}function c(t){return"cal"===t||"mathcal"===t||"textcal"===t}function u(t){return"sup"===t||"mathsup"===t||"textsup"===t||"superscript"===t||"mathsuperscript"===t||"textsuperscript"===t}function d(t){return"sub"===t||"mathsub"===t||"textsub"===t||"subscript"===t||"mathsubscript"===t||"textsubscript"===t}function h(t){return e.formattingText.hasOwnProperty(t)||e.formattingMath.hasOwnProperty(t)||e.formattingNoMode.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.formattingText={textbb:!0,textbf:!0,textfrak:!0,textit:!0,texttt:!0,textcal:!0,textsup:!0,textsub:!0,textsuperscript:!0,textsubscript:!0},e.formattingNoMode={bb:!0,bf:!0,frak:!0,it:!0,tt:!0,cal:!0,mono:!0,sup:!0,sub:!0,superscript:!0,subscript:!0},e.formattingMath={mathbb:!0,mathbf:!0,mathfrak:!0,mathit:!0,mathtt:!0,mathcal:!0,mathsup:!0,mathsub:!0,mathsuperscript:!0,mathsubscript:!0},e.isBbCmd=n,e.isBfCmd=a,e.isMonoCmd=r,e.isFrakCmd=o,e.isItCmd=s,e.isTtCmd=l,e.isCalCmd=c,e.isSupCmd=u,e.isSubCmd=d,e.isFormattingCmd=h},function(t,e,i){"use strict";function n(t){return e.superscriptCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.superscriptCharacters={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",a:"ᵃ",b:"ᵇ",c:"ᶜ",d:"ᵈ",e:"ᵉ",f:"ᶠ",g:"ᵍ",h:"ʰ",i:"ⁱ",j:"ʲ",k:"ᵏ",l:"ˡ",m:"ᵐ",n:"ⁿ",o:"ᵒ",p:"ᵖ",r:"ʳ",s:"ˢ",t:"ᵗ",u:"ᵘ",v:"ᵛ",w:"ʷ",x:"ˣ",y:"ʸ",z:"ᶻ",A:"ᴬ",B:"ᴮ",D:"ᴰ",E:"ᴱ",G:"ᴳ",H:"ᴴ",I:"ᴵ",J:"ᴶ",K:"ᴷ",L:"ᴸ",M:"ᴹ",N:"ᴺ",O:"ᴼ",P:"ᴾ",R:"ᴿ",T:"ᵀ",U:"ᵁ",V:"ⱽ",W:"ᵂ","α":"ᵅ","β":"ᵝ","γ":"ᵞ","δ":"ᵟ","∊":"ᵋ","θ":"ᶿ","ι":"ᶥ","Φ":"ᶲ","φ":"ᵠ","χ":"ᵡ"},e.isSuperscriptCharacter=n,e.translateCharToSuperscript=function(t){return n(t)?e.superscriptCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.oneArgsCommands.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(126),r=i(127),o=i(49);e.oneArgsCommands=Object.assign({},a.spaceCmds1arg,o.formattingText,o.formattingMath,o.formattingNoMode,r.diacriticsTextMode,r.diacriticsMathMode,{cyrchar:!0,vec:!0,mono:!0}),e.is1argsCommand=n},,,function(t,e,i){"use strict";(function(t,n){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),s=i(18),l=a(s),c=i(14),u=a(c),d=i(63),h=(a(d),{hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}}),f=t.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(t){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new f(this.toJSON())},set_value:function(t){this.set("value",t||"")}}),_=t.Collection.extend({model:f}),p=f.extend({}),v=f.extend({set_value:function(t){this.set("value",parseInt(t,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),m=v.extend({set_value:function(t){this.set("value",parseFloat(t))}}),g=f.extend({get_samples:function(){return o.map(this.get("options"),function(t){return t[0]})}});f.subModelTypes={integer:v,float:m,data:p,select:g};var w=t.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(t){this.set("inputs",new _(o.map(t.inputs,function(t){return new(f.subModelTypes[t.type]||f)(t)})))},toJSON:function(){var e=t.Model.prototype.toJSON.call(this);return e.inputs=this.get("inputs").map(function(t){return t.toJSON()}),e},remove_inputs:function(t){var e=this,i=e.get("inputs").filter(function(e){return-1!==t.indexOf(e.get("type"))});e.get("inputs").remove(i)},copy:function(e){var i=new w(this.toJSON());if(e){var n=new t.Collection;i.get("inputs").each(function(t){t.get_samples()&&n.push(t)}),i.set("inputs",n)}return i},apply_search_results:function(t){return-1!==o.indexOf(t,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(t,e){this.get("inputs").find(function(e){return e.get("name")===t}).set("value",e)},set_input_values:function(t){var e=this;o.each(o.keys(t),function(i){e.set_input_value(i,t[i])})},run:function(){return this._run()},rerun:function(t,e){return this._run({action:"rerun",target_dataset_id:t.id,regions:e})},get_inputs_dict:function(){var t={};return this.get("inputs").each(function(e){t[e.get("name")]=e.get("value")}),t},_run:function(t){var e=o.extend({tool_id:this.id,inputs:this.get_inputs_dict()},t),i=n.Deferred(),a=new l.default.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});return n.when(a.go()).then(function(t){i.resolve(new u.default.DatasetCollection(t))}),i}});o.extend(w.prototype,h);var y=(t.View.extend({}),t.Collection.extend({model:w})),b=t.Model.extend(h),x=t.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){o.each(this.attributes.elems,function(t){t.show()}),this.show(),this.set("open",!1)},apply_search_results:function(t){var e,i=!0;o.each(this.attributes.elems,function(n){n instanceof b?(e=n,e.hide()):n instanceof w&&n.apply_search_results(t)&&(i=!1,e&&e.show())}),i?this.hide():(this.show(),this.set("open",!0))}});o.extend(x.prototype,h);var k=t.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var t=this.attributes.query;if(t.length<this.attributes.min_chars_for_search)return void this.set("results",null);var e=t;this.timer&&clearTimeout(this.timer),n("#search-clear-btn").hide(),n("#search-spinner").show();var i=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+e),n.get(i.urlRoot,{q:e},function(t){i.set("results",t),n("#search-spinner").hide(),n("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});o.extend(k.prototype,h);var C=t.Model.extend({initialize:function(e){this.attributes.tool_search=e.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=e.tools,this.attributes.layout=new t.Collection(this.parse(e.layout))},parse:function(t){var e=this,i=function t(i){var n=i.model_class;if(n.indexOf("Tool")===n.length-4)return e.attributes.tools.get(i.id);if("ToolSection"===n){var a=o.map(i.elems,t);return i.elems=a,new x(i)}return"ToolSectionLabel"===n?new b(i):void 0};return o.map(t,i)},clear_search_results:function(){this.get("layout").each(function(t){t instanceof x?t.clear_search_results():t.show()})},apply_search_results:function(){var t=this.get("tool_search").get("results");if(null===t)return void this.clear_search_results();var e=null;this.get("layout").each(function(i){i instanceof b?(e=i,e.hide()):i instanceof w?i.apply_search_results(t)&&e&&e.show():(e=null,i.apply_search_results(t))})}}),T=t.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),S=T.extend({tagName:"div",render:function(){var t=n("<div/>");t.append(R.tool_link(this.model.toJSON()));var e=this.model.get("form_style",null);if("upload1"===this.model.id)t.find("a").on("click",function(t){t.preventDefault(),Galaxy.upload.show()});else if("regular"===e){var i=this;t.find("a").on("click",function(t){t.preventDefault(),Galaxy.router.push("/",{tool_id:i.model.id,version:i.model.get("version")})})}return this.$el.append(t),this}}),M=T.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(n("<span/>").text(this.model.attributes.text)),this}}),O=T.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){T.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(R.panel_section(this.model.toJSON()));var t=this.$el.find(".toolSectionBody");return o.each(this.model.attributes.elems,function(e){if(e instanceof w){var i=new S({model:e,className:"toolTitle"});i.render(),t.append(i.$el)}else if(e instanceof b){var n=new M({model:e});n.render(),t.append(n.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),z=t.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","change :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(R.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),n("#messagebox").is(":visible")&&this.$el.css("top","95px"),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(t){if(this.model.attributes.clear_key&&this.model.attributes.clear_key===t.which)return this.clear(),!1;this.model.set("query",this.$el.find(":input").val())}}),A=t.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var t=this,e=new z({model:this.model.get("tool_search")});return e.render(),t.$el.append(e.$el),this.model.get("layout").each(function(e){if(e instanceof x){var i=new O({model:e});i.render(),t.$el.append(i.$el)}else if(e instanceof w){var n=new S({model:e,className:"toolTitleNoSection"});n.render(),t.$el.append(n.$el)}else if(e instanceof b){var a=new M({model:e});a.render(),t.$el.append(a.$el)}}),t.$el.find("a.tool-link").click(function(e){var i=n(this).attr("class").split(/\s+/)[0],a=t.model.get("tools").get(i);t.trigger("tool_link_click",e,a)}),this},handle_search_results:function(){var t=this.model.get("tool_search").get("results");t&&0===t.length?n("#search-no-results").show():n("#search-no-results").hide()}}),P=t.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(R.tool_form(this.model.toJSON()))}}),R=(t.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new A({collection:this.collection}),this.tool_form_view=new P},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var t=this;this.tool_panel_view.on("tool_link_click",function(e,i){e.preventDefault(),t.show_tool(i)})},show_tool:function(t){var e=this;t.fetch().done(function(){e.tool_form_view.model=t,e.tool_form_view.render(),e.tool_form_view.$el.show(),n("#left").width("650px")})}}),{tool_search:o.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:o.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:o.template(['<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">','<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="badge badge-default badge-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<span class="tool-old-link">',"<%- name %>","</span>"," <%- description %>","</a>"].join("")),tool_form:o.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});e.default={ToolParameter:f,IntegerToolParameter:v,SelectToolParameter:g,Tool:w,ToolCollection:y,ToolSearch:k,ToolPanel:C,ToolPanelView:A,ToolFormView:P}}).call(e,i(2),i(0))},function(t,e,i){"use strict";(function(t,n){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(3),o=a(r),s=i(5),l=(a(s),i(152)),c=a(l),u=i(10),d=a(u),h=i(26),f=a(h),_=i(25),p=a(_),v=i(66),m=a(v),g=i(40),w=a(g);e.default=f.default.extend({initialize:function(t){var e=this;this.deferred=new c.default,f.default.prototype.initialize.call(this,t),this._update(this.model.get("initialmodel")),this.model.get("listen_to_history")&&parent.Galaxy&&parent.Galaxy.currHistoryPanel&&this.listenTo(parent.Galaxy.currHistoryPanel.collection,"change",function(){e.model.get("onchange")()}),this.$el.on("remove",function(){e._destroy()})},_update:function(t){var e=this;t=t||this.model.get("buildmodel"),t?(this.deferred.reset(),this.deferred.execute(function(i){t(i,e),i.then(function(){e._render()})})):this._render()},_destroy:function(){var t=this;this.$el.off().hide(),this.deferred.execute(function(){f.default.prototype.remove.call(t),Galaxy.emit.debug("tool-form-base::_destroy()","Destroy view.")})},_render:function(){var e=this,i=this.model.attributes;this.model.set({title:i.fixed_title||"<b>"+i.name+"</b> "+i.description+" (Galaxy Version "+i.version+")",operations:!i.hide_operations&&this._operations(),onchange:function(){e.deferred.reset(),e.deferred.execute(function(t){e.model.get("postchange")(t,e)})}}),this.render(),this.model.get("collapsible")||this.$el.append(t("<div/>").addClass("ui-margin-top-large").append(this._footer())),this.show_message&&this.message.update({status:"success",message:"Now you are using '"+i.name+"' version "+i.version+", id '"+i.id+"'.",persistent:!1}),this.show_message=!0},_operations:function(){var t=this,e=this.model.attributes,i=new d.default.ButtonMenu({icon:"fa-cubes",title:!e.narrow&&"Versions"||null,tooltip:"Select another tool version"});if(!e.sustain_version&&e.versions&&e.versions.length>1)for(var n in e.versions){var a=e.versions[n];a!=e.version&&i.addMenu({title:"Switch to "+a,version:a,icon:"fa-cube",onclick:function(){t.model.set("id",e.id.replace(e.version,this.version)),t.model.set("version",this.version),t._update()}})}else i.$el.hide();var r=new d.default.ButtonMenu({id:"options",icon:"fa-caret-down",title:!e.narrow&&"Options"||null,tooltip:"View available options"});return e.biostar_url&&(r.addMenu({icon:"fa-question-circle",title:"Question?",onclick:function(){window.open(e.biostar_url+"/p/new/post/")}}),r.addMenu({icon:"fa-search",title:(0,o.default)("Search"),onclick:function(){window.open(e.biostar_url+"/local/search/page/?q="+e.name)}})),r.addMenu({icon:"fa-share",title:(0,o.default)("Share"),onclick:function(){prompt("Copy to clipboard: Ctrl+C, Enter",window.location.origin+Galaxy.root+"root?tool_id="+e.id)}}),Galaxy.user&&Galaxy.user.get("is_admin")&&r.addMenu({icon:"fa-download",title:(0,o.default)("Download"),onclick:function(){window.location.href=Galaxy.root+"api/tools/"+e.id+"/download"}}),e.requirements&&e.requirements.length>0&&r.addMenu({icon:"fa-info-circle",title:(0,o.default)("Requirements"),onclick:function(){!this.requirements_visible||t.portlet.collapsed?(this.requirements_visible=!0,t.portlet.expand(),t.message.update({persistent:!0,message:t._templateRequirements(e),status:"info"})):(this.requirements_visible=!1,t.message.update({message:""}))}}),e.sharable_url&&r.addMenu({icon:"fa-external-link",title:(0,o.default)("See in Tool Shed"),onclick:function(){window.open(e.sharable_url)}}),p.default.load({type:"tool-menu",callback:function(t){t.each(function(t){var i=t.toJSON();i.activate&&i.config.function&&r.addMenu({icon:i.config.icon,title:i.config.title,onclick:function(){new Function("options",i.config.function)(e)}})})}}),{menu:r,versions:i}},_footer:function(){var e=this.model.attributes,i=t("<div/>").append(this._templateHelp(e));if(e.citations){var n=w.default.extend(m.default),a=document.createElement("div");i.append(a),new n({propsData:{id:e.id,source:"tools"}}).$mount(a)}return i},_templateHelp:function(e){var i=t("<div/>").addClass("ui-form-help").append(e.help);return i.find("a").attr("target","_blank"),i.find("img").each(function(){var e=t(this).attr("src");-1!==e.indexOf("admin_toolshed")&&t(this).attr("src",Galaxy.root+e)}),i},_templateRequirements:function(e){var i=e.requirements.length;if(i>0){var a="This tool requires ";n.each(e.requirements,function(t,e){a+=t.name+(t.version?" (Version "+t.version+")":"")+(e<i-2?", ":e==i-2?" and ":"")});var r=t("<a/>").attr("target","_blank").attr("href","https://galaxyproject.org/tools/requirements/").text("here");return t("<span/>").append(a+". Click ").append(r).append(" for more information.")}return"No requirements found."}})}).call(e,i(0),i(1))},,,,,function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),o=(a(r),i(2)),s=a(o),l=i(6),c=n(l),u=i(3),d=n(u),h=s.Model.extend(c.default.LoggableMixin).extend({_logNamespace:"user",urlRoot:function(){return Galaxy.root+"api/users"},defaults:{id:null,username:"("+(0,d.default)("anonymous user")+")",email:"",total_disk_usage:0,nice_total_disk_usage:"",quota_percent:null,is_admin:!1},initialize:function(t){this.log("User.initialize:",t),this.on("loaded",function(t,e){this.log(this+" has loaded:",t,e)}),this.on("change",function(t,e){this.log(this+" has changed:",t,e.changes)})},isAnonymous:function(){return!this.get("email")},isAdmin:function(){return this.get("is_admin")},loadFromApi:function(t,e){t=t||h.CURRENT_ID_STR,e=e||{};var i=this,n=e.success;return e.success=function(t,e){i.trigger("loaded",t,e),n&&n(t,e)},t===h.CURRENT_ID_STR&&(e.url=this.urlRoot+"/"+h.CURRENT_ID_STR),s.Model.prototype.fetch.call(this,e)},clearSessionStorage:function(){for(var t in sessionStorage)0===t.indexOf("history:")?sessionStorage.removeItem(t):"history-panel"===t&&sessionStorage.removeItem(t)},toString:function(){var t=[this.get("username")];return this.get("id")&&(t.unshift(this.get("id")),t.push(this.get("email"))),"User("+t.join(":")+")"}});h.CURRENT_ID_STR="current",h.getCurrentUserFromApi=function(t){var e=new h;return e.loadFromApi(h.CURRENT_ID_STR,t),e};s.Collection.extend(c.default.LoggableMixin).extend({model:h,urlRoot:function(){return Galaxy.root+"api/users"}});e.default={User:h}},function(t,e,i){"use strict";(function(t){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=i(3),u=a(c),d=i(1),h=n(d),f=i(2),_=n(f),p=i(62),v=a(p),m=i(15),g=a(m),w=i(31),y=a(w),b=i(32),x=a(b),k=i(24),C=a(k),T=i(5),S=a(T);i(163),i(162),i(164),i(69),i(166),i(150),i(149),i(165),i(19);var M=function(e){function i(t){return r(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return s(i,e),l(i,[{key:"initialize",value:function(t){this.baseURL=t,S.default.cssLoadFile("static/style/jquery.rating.css"),S.default.cssLoadFile("static/style/autocomplete_tagging.css"),S.default.cssLoadFile("static/style/jquery-ui/smoothness/jquery-ui.css"),S.default.cssLoadFile("static/style/library.css"),S.default.cssLoadFile("static/style/trackster.css")}},{key:"save_viz",value:function(){var e=this;Galaxy.modal.show({title:"Saving...",body:"progress"});var i=[];t(".bookmark").each(function(){i.push({position:t(e).children(".position").text(),annotation:t(e).children(".annotation").text()})});var n=this.view.overview_drawable?this.view.overview_drawable.config.get_value("name"):null,a={view:this.view.to_dict(),viewport:{chrom:this.view.chrom,start:this.view.low,end:this.view.high,overview:n},bookmarks:i};return t.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:this.view.vis_id,title:this.view.config.get_value("name"),dbkey:this.view.dbkey,type:"trackster",vis_json:JSON.stringify(a)}}).success(function(t){Galaxy.modal.hide(),e.view.vis_id=t.vis_id,e.view.has_changes=!1,window.history.pushState({},"",t.url+window.top.location.hash)}).error(function(){Galaxy.modal.show({title:(0,u.default)("Could Not Save"),body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{key:"createButtonMenu",value:function(){var e=this,i=y.default.create_icon_buttons_menu([{icon_class:"plus-button",title:(0,u.default)("Add tracks"),on_click:function(){g.default.select_datasets({dbkey:e.view.dbkey},function(t){h.each(t,function(t){e.view.add_drawable(v.default.object_from_template(t,e.view,e.view))})})}},{icon_class:"block--plus",title:(0,u.default)("Add group"),on_click:function(){e.view.add_drawable(new v.default.DrawableGroup(e.view,e.view,{name:"New Group"}))}},{icon_class:"bookmarks",title:(0,u.default)("Bookmarks"),on_click:function(){window.force_right_panel("0px"==t("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:(0,u.default)("Circster"),on_click:function(){window.top.location=e.baseURL+"visualization/circster?id="+e.view.vis_id}},{icon_class:"disk--arrow",title:(0,u.default)("Save"),on_click:function(){e.save_viz()}},{icon_class:"cross-circle",title:(0,u.default)("Close"),on_click:function(){e.handle_unsaved_changes(e.view)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=i,i}},{key:"add_bookmark",value:function(e,i,n){var a=this,r=t("#right .unified-panel-body"),o=t("<div/>").addClass("bookmark").appendTo(r),s=t("<div/>").addClass("position").appendTo(o);t("<a href=''/>").text(e).appendTo(s).click(function(){return a.view.go_to(e),!1});var l=t("<div/>").text(i).appendTo(o);if(n){var c=t("<div/>").addClass("delete-icon-container").prependTo(o).click(function(){return o.slideUp("fast"),o.remove(),a.view.has_changes=!0,!1});t("<a href=''/>").addClass("icon-button delete").appendTo(c),l.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return this.view.has_changes=!0,o}},{key:"create_visualization",value:function(e,i,n,a,r){var o=this;return this.view=new v.default.TracksterView(h.extend(e,{header:!1})),this.view.editor=!0,t.when(this.view.load_chroms_deferred).then(function(t){var e=null;if(i){var s=i.chrom,l=i.start,c=i.end;e=i.overview,s&&void 0!==l&&c?o.view.change_chrom(s,l,c):o.view.change_chrom(t[0].chrom)}else o.view.change_chrom(t[0].chrom);if(n)for(var u=0;u<n.length;u++)o.view.add_drawable(v.default.object_from_template(n[u],o.view,o.view));for(var d=0;d<o.view.drawables.length;d++)if(o.view.drawables[d].config.get_value("name")===e){o.view.set_overview(o.view.drawables[d]);break}if(a)for(var h,f=0;f<a.length;f++)h=a[f],o.add_bookmark(h.position,h.annotation,r);o.view.has_changes=!1}),this.set_up_router({view:this.view}),this.view}},{key:"set_up_router",value:function(t){new g.default.TrackBrowserRouter(t),_.history.start()}},{key:"init_keyboard_nav",value:function(e){t(document).keyup(function(i){if(!t(i.srcElement).is(":input"))switch(i.which){case 37:e.move_fraction(.25);break;case 38:e.viewport_container.scrollTop(e.viewport_container.scrollTop()-20);break;case 39:e.move_fraction(-.25);break;case 40:e.viewport_container.scrollTop(e.viewport_container.scrollTop()+20)}})}},{key:"handle_unsaved_changes",value:function(e){var i=this;e.has_changes?Galaxy.modal.show({title:(0,u.default)("Close visualization"),body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){Galaxy.modal.hide()},"Leave without Saving":function(){t(window).off("beforeunload"),window.top.location=Galaxy.root+"visualizations/list"},Save:function(){t.when(i.save_viz()).then(function(){window.top.location=Galaxy.root+"visualizations/list"})}}}):window.top.location=Galaxy.root+"visualizations/list"}}]),i}(_.Model),O=function(e){function i(t){return r(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t))}return s(i,e),l(i,[{key:"initialize",value:function(){var e=this;this.ui=new M(Galaxy.root),this.ui.createButtonMenu(),this.ui.buttonMenu.$el.attr("style","float: right"),t("#center .unified-panel-header-inner").append(this.ui.buttonMenu.$el),t("#right .unified-panel-title").append("Bookmarks"),t("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),t("#right-border").click(function(){e.ui.view.resize_window()}),window.force_right_panel("hide"),window.galaxy_config.app.id?this.view_existing():x.default.get("dataset_id")?this.choose_existing_or_new():this.view_new()}},{key:"choose_existing_or_new",value:function(){var t=this,e=x.default.get("dbkey"),i={},n={dbkey:e,dataset_id:x.default.get("dataset_id"),hda_ldda:x.default.get("hda_ldda"),gene_region:x.default.get("gene_region")};e&&(i["f-dbkey"]=e),Galaxy.modal.show({title:"View Data in a New or Saved Visualization?",body:"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>"+(e||"Not available.")+"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>",buttons:{Cancel:function(){window.top.location=Galaxy.root+"visualizations/list"},"View in saved visualization":function(){t.view_in_saved(n)},"View in new visualization":function(){t.view_new()}}})}},{key:"view_in_saved",value:function(e){var i=this,n=new C.default({url_base:Galaxy.root+"visualization/list_tracks",embedded:!0});Galaxy.modal.show({title:(0,u.default)("Add Data to Saved Visualization"),body:n.$el,buttons:{Cancel:function(){window.top.location=Galaxy.root+"visualizations/list"},"Add to visualization":function(){t(window.parent.document).find("input[name=id]:checked").each(function(){e.id=t(i).val(),window.top.location=Galaxy.root+"visualization/trackster?"+t.param(e)})}}})}},{key:"view_existing",value:function(){var e=window.galaxy_config.app.viz_config;this.ui.create_visualization({container:t("#center .unified-panel-body"),name:e.title,vis_id:e.vis_id,dbkey:e.dbkey},e.viewport,e.tracks,e.bookmarks,!0),this.init_editor()}},{key:"view_new",value:function(){var e=this;t.ajax({url:Galaxy.root+"api/genomes?chrom_info=True",data:{},error:function(){alert("Couldn't create new browser.")},success:function(i){Galaxy.modal.show({title:(0,u.default)("New Visualization"),body:e.template_view_new(i),buttons:{Cancel:function(){window.top.location=Galaxy.root+"visualizations/list"},Create:function(){e.create_browser(t("#new-title").val(),t("#new-dbkey").val()),Galaxy.modal.hide()}}});var n=i.map(function(t){return t[1]});window.galaxy_config.app.default_dbkey&&h.contains(n,window.galaxy_config.app.default_dbkey)&&t("#new-dbkey").val(window.galaxy_config.app.default_dbkey),t("#new-title").focus(),t("select[name='dbkey']").select2(),t("#overlay").css("overflow","auto")}})}},{key:"template_view_new",value:function(t){for(var e='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',i=0;i<t.length;i++)e+='<option value="'+t[i][1]+'">'+t[i][0]+"</option>";return e+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'+Galaxy.root+'custom_builds" target="_top">Add a Custom Build</a></div></form>'}},{key:"init_editor",value:function(){var e=this;t("#center .unified-panel-title").text(this.ui.view.config.get_value("name")+" ("+this.ui.view.dbkey+")"),window.galaxy_config.app.add_dataset&&t.ajax({url:Galaxy.root+"api/datasets/"+window.galaxy_config.app.add_dataset,data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(t){e.ui.view.add_drawable(v.default.object_from_template(t,e.ui.view,e.ui.view))}}),t("#add-bookmark-button").click(function(){var t=e.ui.view.chrom+":"+e.ui.view.low+"-"+e.ui.view.high;return e.ui.add_bookmark(t,"Bookmark description",!0)}),this.ui.init_keyboard_nav(this.ui.view),t(window).on("beforeunload",function(){if(e.ui.view.has_changes)return"There are unsaved changes to your visualization that will be lost if you leave this page."})}},{key:"create_browser",value:function(e,i){t(document).trigger("convert_to_values"),this.ui.create_visualization({container:t("#center .unified-panel-body"),name:e,dbkey:i},window.galaxy_config.app.gene_region),this.init_editor(),this.ui.view.editor=!0}}]),i}(_.View);e.default={TracksterUI:M,GalaxyApp:O}}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}function r(t,e){$[t.attr("id")]=e}function o(e,i,n,a){n=".group",$[e.attr("id")]=a,e.bind("drag",{handle:"."+i,relative:!0},function(e,i){var a,r,o,s,l,c=t(this),u=c.parent(),d=u.children(".track,.group"),h=$[t(this).attr("id")];if(r=t(this).parents(n),0!==r.length){o=r.position().top,s=o+r.outerHeight();var f=$[r.attr("id")];if(i.offsetY<o)return t(this).insertBefore(r),f.remove_drawable(h),void f.container.add_drawable_before(h,f);if(i.offsetY>s)return t(this).insertAfter(r),f.remove_drawable(h),void f.container.add_drawable(h)}for(r=null,l=0;l<d.length;l++)if(a=t(d.get(l)),o=a.position().top,s=o+a.outerHeight(),a.is(n)&&this!==a.get(0)&&i.offsetY>=o&&i.offsetY<=s)return i.offsetY-o<s-i.offsetY?a.find(".content-div").prepend(this):a.find(".content-div").append(this),h.container&&h.container.remove_drawable(h),void $[a.attr("id")].add_drawable(h);for(l=0;l<d.length&&(a=t(d.get(l)),!(i.offsetY<a.position().top)||a.hasClass("reference-track")||a.hasClass("intro"));l++);l===d.length?this!==d.get(l-1)&&(u.append(this),$[u.attr("id")].move_drawable(h,l)):this!==d.get(l)&&(t(this).insertBefore(d.get(l)),$[u.attr("id")].move_drawable(h,i.deltaY>0?l-1:l))}).bind("dragstart",function(){t(this).addClass("dragging")}).bind("dragend",function(){t(this).removeClass("dragging")})}function s(t,e){e||(e=0);var i=Math.pow(10,e);return Math.round(t*i)/i}function l(e){var i=t.Deferred();return t.ajax({type:"HEAD",url:e,beforeSend:function(t){t.setRequestHeader("Range","bytes=0-10")},success:function(t,e,n){i.resolve(206===n.status)}}),i}Object.defineProperty(e,"__esModule",{value:!0});var c=i(3),u=a(c),d=i(1),h=n(d),f=i(2),_=n(f),p=i(15),v=a(p),m=i(81),g=a(m),w=i(18),y=a(w),b=i(82),x=a(b),k=i(83),C=a(k),T=i(84),S=a(T),M=i(14),O=a(M),z=i(54),A=a(z),P=i(33),R=a(P),E=i(137),j=a(E);i(19);var q=h.extend,$={},L="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",I=["Histogram","Line","Filled","Intensity"],D=function t(e,i,n){if(t.id_counter||(t.id_counter=0),this.id=t.id_counter++,this.view=e,this.container=i,this.drag_handle_class=n.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=R.default.ConfigSettingCollection.from_models_and_saved_values(this.build_config_params(),n.prefs),this.config.get_value("name")||this.config.set_value("name",n.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,!1!==n.header){var a=new g.default.TrackHeaderView({model:this,id:this.id});this.header_div=a.$el,this.container_div.append(this.header_div);var r=a.icons_div;this.action_icons=a.action_icons,this.container_div.hover(function(){r.show()},function(){r.hide()})}};D.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(t){t.config.get_value("content_visible")?(t.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),t.hide_contents(),t.config.set_value("content_visible",!1)):(t.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),t.config.set_value("content_visible",!0),t.show_contents())}},{name:"settings_icon",title:(0,u.default)("Edit settings"),css_class:"gear",on_click_fn:function(t){new R.default.ConfigSettingCollectionView({collection:t.config}).render_in_modal("Configure Track")}},{name:"remove_icon",title:(0,u.default)("Remove"),css_class:"remove-icon",on_click_fn:function(e){t(".tooltip").remove(),e.remove()}}],q(D.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],build_config_params:function(){return this.config_params},config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(t){},to_dict:function(){},set_name:function(t){this.old_name=this.config.get_value("name"),this.config.set_value("name",t)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var e=this.view;this.container_div.hide(0,function(){t(this).remove(),e.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var N=function(t,e,i){D.call(this,t,e,i),this.obj_type=i.obj_type,this.drawables=[]};q(N.prototype,D.prototype,{unpack_drawables:function(t){this.drawables=[];for(var e,i=0;i<t.length;i++)e=st(t[i],this.view,this),this.add_drawable(e)},init:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].init()},_draw:function(t){for(var e=0;e<this.drawables.length;e++)this.drawables[e]._draw(t)},to_dict:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:t}},add_drawable:function(t){this.drawables.push(t),t.container=this,this.changed()},add_drawable_before:function(t,e){this.changed();var i=this.drawables.indexOf(e);return-1!==i&&(this.drawables.splice(i,0,t),!0)},replace_drawable:function(t,e,i){var n=this.drawables.indexOf(t);return-1!==n&&(this.drawables[n]=e,i&&t.container_div.replaceWith(e.container_div),this.changed()),n},remove_drawable:function(t){var e=this.drawables.indexOf(t);return-1!==e&&(this.drawables.splice(e,1),t.container=null,this.changed(),!0)},move_drawable:function(t,e){var i=this.drawables.indexOf(t);return-1!==i&&(this.drawables.splice(i,1),this.drawables.splice(e,0,t),this.changed(),!0)},get_drawables:function(){return this.drawables},get_tracks:function(t){for(var e,i=this.drawables.slice(0),n=[];0!==i.length;)e=i.shift(),e instanceof t?n.push(e):e.drawables&&(i=i.concat(e.drawables));return n}});var G=function(e,i,n){if(q(n,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),N.call(this,e,i,n),this.content_div=t("<div/>").addClass("content-div").attr("id","group_"+this.id+"_content_div").appendTo(this.container_div),r(this.container_div,this),r(this.content_div,this),o(this.container_div,this.drag_handle_class,".group",this),this.filters_manager=new S.default.FiltersManager(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(t("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in n&&this.unpack_drawables(n.drawables),"filters"in n){var a=this.filters_manager;this.filters_manager=new S.default.FiltersManager(this,n.filters),a.parent_div.replaceWith(this.filters_manager.parent_div),n.filters.visible&&this.setup_multitrack_filtering()}};q(G.prototype,D.prototype,N.prototype,{action_icons_def:[D.prototype.action_icons_def[0],D.prototype.action_icons_def[1],{name:"composite_icon",title:(0,u.default)("Show composite track"),css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_composite_track()}},{name:"filters_icon",title:(0,u.default)("Filters"),css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?(t.filters_manager.clear_filters(),t._restore_filter_managers()):(t.setup_multitrack_filtering(),t.request_draw({clear_tile_cache:!0})),t.filters_manager.toggle()}},D.prototype.action_icons_def[2]],build_container_div:function(){var e=t("<div/>").addClass("group").attr("id","group_"+this.id);return this.container&&this.container.content_div.append(e),e},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var e=this.drawables.length;if(0===e)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===e)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof Q),this.action_icons.filters_icon.hide();else{var i,n,a,r=this.drawables[0].get_type(),o=0;for(i=0;i<e&&(a=this.drawables[i],a.get_type()===r);i++)a instanceof nt&&o++;if(this.drawables[0]instanceof et?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),t(".tooltip").remove()),o>1&&o===this.drawables.length){var s,l={};for(a=this.drawables[0],n=0;n<a.filters_manager.filters.length;n++)s=a.filters_manager.filters[n],l[s.name]=[s];for(i=1;i<this.drawables.length;i++)for(a=this.drawables[i],n=0;n<a.filters_manager.filters.length;n++)s=a.filters_manager.filters[n],s.name in l&&l[s.name].push(s);this.filters_manager.remove_all();for(var c in l){var u=l[c];if(u.length===o){var d=new S.default.NumberFilter({name:u[0].name,index:u[0].index});this.filters_manager.add_filter(d)}}this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].filters_manager=this.saved_filters_managers[t];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var t=0;t<this.drawables.length;t++){var e=this.drawables[t];this.saved_filters_managers.push(e.filters_manager),e.filters_manager=this.filters_manager}}this.filters_manager.init_filters()},show_composite_track:function(){var t=new Q(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,t,!0),t.request_draw()},add_drawable:function(t){N.prototype.add_drawable.call(this,t),this.update_icons()},remove_drawable:function(t){N.prototype.remove_drawable.call(this,t),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var t=q(N.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),t},request_draw:function(t){h.each(this.drawables,function(e){e.request_draw(t)})}});var B=_.View.extend({initialize:function(t){q(t,{obj_type:"View"}),N.call(this,"View",t.container,t),this.chrom=null,this.vis_id=t.vis_id,this.dbkey=t.dbkey,this.stand_alone=void 0===t.stand_alone||t.stand_alone,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new v.default.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=R.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:t.name})},render:function(){this.requested_redraw=!1;var e=this.container,i=this;this.top_container=t("<div/>").addClass("top-container").appendTo(e),this.browser_content_div=t("<div/>").addClass("content").appendTo(e),this.bottom_container=t("<div/>").addClass("bottom-container").appendTo(e),this.top_labeltrack=t("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=t("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,r(this.viewport_container,i),this.intro_div=t("<div/>").addClass("intro").appendTo(this.viewport_container),t("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){v.default.select_datasets({dbkey:i.dbkey},function(t){h.each(t,function(t){i.add_drawable(st(t,i,i))})})}),this.nav_container=t("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=t("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=t("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=t("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=t("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=t("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=t("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=t("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=t("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=t("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);var n=function(e){"focusout"!==e.type&&13!==(e.keyCode||e.which)&&27!==(e.keyCode||e.which)||(27!==(e.keyCode||e.which)&&i.go_to(t(this).val()),t(this).hide(),t(this).val(""),i.location_span.show(),i.chrom_select.show()),e.stopPropagation()};this.nav_input=t("<input/>").addClass("nav-input").hide().bind("keyup focusout",n).appendTo(this.nav_controls),this.location_span=t("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){i.location_span.hide(),i.chrom_select.hide(),i.nav_input.val(i.chrom+":"+i.low+"-"+i.high),i.nav_input.css("display","inline-block"),i.nav_input.select(),i.nav_input.focus(),i.nav_input.autocomplete({source:function(e,n){var a=[],r=t.map(i.get_tracks(nt),function(t){return t.data_manager.search_features(e.term).success(function(t){a=a.concat(t)})});t.when.apply(t,r).done(function(){n(t.map(a,function(t){return{label:t[0],value:t[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=t("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=t("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){i.zoom_out()}).appendTo(this.nav_controls),this.zi_link=t("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){i.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){i.change_chrom(i.chrom_select.val())}),this.browser_content_div.click(function(e){t(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(t){i.zoom_in(t.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(t,e){this.current_x=e.offsetX}).bind("drag",function(t,e){var n=e.offsetX-this.current_x;this.current_x=e.offsetX;var a=Math.round(n/i.viewport_container.width()*(i.max_high-i.max_low));i.move_delta(-a)}),this.overview_close.click(function(){i.reset_overview()}),this.viewport_container.bind("draginit",function(t,e){if(t.clientX>i.viewport_container.width()-16)return!1}).bind("dragstart",function(t,e){e.original_low=i.low,e.current_height=t.clientY,e.current_x=e.offsetX}).bind("drag",function(e,n){var a=t(this),r=n.offsetX-n.current_x,o=a.scrollTop()-(e.clientY-n.current_height);a.scrollTop(o),n.current_height=e.clientY,n.current_x=n.offsetX;var s=Math.round(r/i.viewport_container.width()*(i.high-i.low));i.move_delta(s)}),this.top_labeltrack.bind("dragstart",function(e,n){return t("<div/>").addClass("zoom-area").css("height",i.browser_content_div.height()+i.top_labeltrack.height()+1).appendTo(t(this))}).bind("drag",function(e,n){t(n.proxy).css({left:Math.min(e.pageX,n.startX)-i.container.offset().left,width:Math.abs(e.pageX-n.startX)});var a=Math.min(e.pageX,n.startX)-i.container.offset().left,r=Math.max(e.pageX,n.startX)-i.container.offset().left,o=i.high-i.low,s=i.viewport_container.width();i.update_location(Math.round(a/s*o)+i.low,Math.round(r/s*o)+i.low)}).bind("dragend",function(e,n){var a=Math.min(e.pageX,n.startX),r=Math.max(e.pageX,n.startX),o=i.high-i.low,s=i.viewport_container.width(),l=i.low;i.low=Math.round(a/s*o)+l,i.high=Math.round(r/s*o)+l,t(n.proxy).remove(),i.request_redraw()}),this.add_label_track(new Z(this,{content_div:this.top_labeltrack})),t(window).bind("resize",function(){this.resize_timer&&window.clearTimeout(this.resize_timer),this.resize_timer=window.setTimeout(function(){i.resize_window()},500)}),t(document).bind("redraw",function(){i.redraw()}),this.reset(),t(window).trigger("resize")},get_base_color:function(t){return this.config.get_value(t.toLowerCase()+"_color")||this.config.get_value("n_color")}});q(B.prototype,N.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(t,e,i,n){var a=this;this.timer&&window.clearTimeout(this.timer),n?this.timer=window.setTimeout(function(){a.trigger("navigate",t+":"+e+"-"+i)},500):this.trigger("navigate",t+":"+e+"-"+i)},update_location:function(t,e){this.location_span.text(y.default.commatize(t)+" - "+y.default.commatize(e)),this.nav_input.val(this.chrom+":"+y.default.commatize(t)+"-"+y.default.commatize(e));var i=this.chrom_select.val();""!==i&&this.trigger_navigate(i,this.low,this.high,!0)},load_chroms:function(e){var i=this;e.num=100;var n=t.Deferred();return t.ajax({url:Galaxy.root+"api/genomes/"+this.dbkey,data:e,dataType:"json",success:function(e){if(0!==e.chrom_info.length){if(e.reference){var a=new tt(i);i.add_label_track(a),i.reference_track=a}i.chrom_data=e.chrom_info,i.chrom_select.html(""),i.chrom_select.append(t('<option value="">Select Chrom/Contig</option>'));for(var r=0,o=i.chrom_data.length;r<o;r++){var s=i.chrom_data[r].chrom,l=t("<option>");l.text(s),l.val(s),i.chrom_select.append(l)}e.prev_chroms&&i.chrom_select.append(t('<option value="previous">Previous 100</option>')),e.next_chroms&&i.chrom_select.append(t('<option value="next">Next 100</option>')),i.chrom_start_index=e.start_index,n.resolve(e.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: "+this.dbkey)}}),n},change_chrom:function(e,i,n){var a=this;if(!a.chrom_data)return void a.load_chroms_deferred.then(function(){a.change_chrom(e,i,n)});if(e&&"None"!==e){if("previous"===e)return void a.load_chroms({low:this.chrom_start_index-100});if("next"===e)return void a.load_chroms({low:this.chrom_start_index+100});var r=t.grep(a.chrom_data,function(t,i){return t.chrom===e})[0];if(void 0===r)return void a.load_chroms({chrom:e},function(){a.change_chrom(e,i,n)});if(e!==a.chrom){a.chrom=e,a.chrom_select.val(a.chrom),a.max_high=r.len-1,a.reset();for(var o=0,s=a.drawables.length;o<s;o++){var l=a.drawables[o];l.init&&l.init()}a.reference_track&&a.reference_track.init()}void 0===i&&void 0===n?(a.low=0,a.high=a.max_high):(a.low=void 0!==i?Math.max(i,0):0,void 0===n?(a.low=Math.max(a.low-15,0),a.high=a.low+30):a.high=Math.min(n,a.max_high)),a.request_redraw()}},go_to:function(t){t=t.replace(/,/g,""),t=t.replace(/:|-/g," ");var e=t.split(/\s+/),i=e[0],n=e[1]?parseInt(e[1],10):void 0,a=e[2]?parseInt(e[2],10):void 0;this.change_chrom(i,n,a)},move_fraction:function(t){var e=this,i=e.high-e.low;this.move_delta(t*i)},move_delta:function(t){var e=this,i=e.high-e.low;e.low-t<e.max_low?(e.low=e.max_low,e.high=e.max_low+i):e.high-t>e.max_high?(e.high=e.max_high,e.low=e.max_high-i):(e.high-=t,e.low-=t),e.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&window.clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=window.setTimeout(function(){e.request_redraw()},200);var n=e.chrom_select.val();this.trigger_navigate(n,e.low,e.high,!0)},add_drawable:function(t){N.prototype.add_drawable.call(this,t),t.init(),this.changed(),this.update_intro_div();var e=this;t.config.on("change",function(){e.changed()})},add_label_track:function(t){t.view=this,t.init(),this.label_tracks.push(t)},remove_drawable:function(e,i){if(N.prototype.remove_drawable.call(this,e),i){var n=this;e.container_div.hide(0,function(){t(this).remove(),n.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(t,e){var i=this,n=e?[e]:i.drawables;h.each(n,function(e){var n=h.find(i.tracks_to_be_redrawn,function(t){return t[0]===e});n?n[1]=t:i.tracks_to_be_redrawn.push([e,t])}),this.requested_redraw||(window.requestAnimationFrame(function(){i._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var t=this.low,e=this.high;t<this.max_low&&(t=this.max_low),e>this.max_high&&(e=this.max_high);var i=this.high-this.low;0!==this.high&&i<this.min_separation&&(e=t+this.min_separation),this.low=Math.floor(t),this.high=Math.ceil(e),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var n=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,a=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0;this.overview_box.css({left:n,width:Math.max(13,a)}).show(),a<13&&this.overview_box.css("left",n-(13-a)/2),this.overview_highlight&&this.overview_highlight.css({left:n,width:a}),h.each(this.tracks_to_be_redrawn,function(t){var e=t[0],i=t[1];e&&e._draw(i)}),this.tracks_to_be_redrawn=[],h.each(this.label_tracks,function(t){t._draw()})},zoom_in:function(t,e){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var i=this.high-this.low,n=i/2+this.low,a=i/this.zoom_factor/2;t&&(n=t/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(n-a),this.high=Math.round(n+a),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var t=this.high-this.low,e=t/2+this.low,i=t*this.zoom_factor/2;this.low=Math.round(e-i),this.high=Math.round(e+i),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(t){if(this.overview_drawable){if(this.overview_drawable.dataset.id===t.dataset.id)return;this.overview_viewport.find(".track").remove()}var e=t.copy({content_div:this.overview_viewport}),i=this;e.header_div.hide(),e.is_overview=!0,i.overview_drawable=e,this.overview_drawable.postdraw_actions=function(){i.overview_highlight.show().height(i.overview_drawable.content_div.height()),i.overview_viewport.height(i.overview_drawable.content_div.height()+i.overview_box.outerHeight()),i.overview_close.show(),i.resize_window()},i.overview_drawable.request_draw(),this.changed()},reset_overview:function(){t(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),this.resize_window(),this.overview_drawable=null}});var U=A.default.Tool.extend({defaults:{track:null},initialize:function(t){A.default.Tool.prototype.initialize.call(this,t);var e=!0;void 0!==t.tool_state&&void 0!==t.tool_state.hidden&&(e=t.tool_state.hidden),this.set("hidden",e),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(t){return h.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),F=_.View.extend({events:{"change :input":"update_value"},render:function(){var e=this.$el.addClass("param-row"),i=this.model;t("<div>").addClass("param-label").text(i.get("label")).appendTo(e),t("<div/>").addClass("param-input").html(i.get("html")).appendTo(e).find(":input").val(i.get("value")),t("<div style='clear: both;'/>").appendTo(e)},update_value:function(e){this.model.set_value(t(e.target).val())}}),V=_.View.extend({initialize:function(t){this.model.on("change:hidden",this.set_visible,this)},render:function(){var e=this,i=this.model,n=this.$el.addClass("dynamic-tool").hide();n.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).keydown(function(t){t.stopPropagation()}),t("<div class='tool-name'>").appendTo(n).text(i.get("name")),i.get("inputs").each(function(t){var e=new F({model:t});e.render(),n.append(e.$el)}),n.find("input").click(function(){t(this).select()});var a=t("<div>").addClass("param-row").appendTo(n),r=t("<input type='submit'>").attr("value","Run on complete dataset").appendTo(a);t("<input type='submit'>").attr("value","Run on visible region").appendTo(a).click(function(){e.run_on_region()}),r.click(function(){e.run_on_dataset()}),i.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var t=0;t<this.params.length;t++)this.params[t].update_value()},run_on_dataset:function(){var t=this.model;this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:t.id},null,function(e){Galaxy.modal.show({title:t.get("name")+" is Running",body:t.get("name")+" is running on the complete dataset. Tool outputs are in dataset's history.",buttons:{Close:function(){Galaxy.modal.hide()}}})})},run_on_region:function(){var t,e=this.model.get("track"),i=this.model,n=new v.default.GenomeRegion({chrom:e.view.chrom,start:e.view.low,end:e.view.high}),a={target_dataset_id:e.dataset.id,action:"rerun",tool_id:i.id,regions:[n.toJSON()]},r=i.get("name")+e.tool_region_and_parameters_str(n);if(e.container===e.view){var o=new G(e.view,e.view,{name:e.config.get_value("name")}),s=e.container.replace_drawable(e,o,!1);o.container_div.insertBefore(e.view.content_div.children()[s]),o.add_drawable(e),e.container_div.appendTo(o.content_div),t=o}else t=e.container;var l=new e.constructor(e.view,t,{name:r,hda_ldda:"hda"});l.init_for_tool_data(),l.change_mode(e.mode),l.set_filters_manager(e.filters_manager.copy(l)),l.update_icons(),t.add_drawable(l),l.tiles_div.text("Starting job."),this.run(a,l,function(t){l.set_dataset(new O.default.Dataset(t)),l.tiles_div.text("Running job."),l.init()})},run:function(e,i,n){e.inputs=this.model.get_inputs_dict();var a=new y.default.ServerStateDeferred({ajax_settings:{url:Galaxy.root+"api/tools",data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});t.when(a.go()).then(function(t){"no converter"===t?(i.container_div.addClass("error"),i.content_div.text(L)):t.error?(i.container_div.addClass("error"),i.content_div.text("Tool cannot be rerun: "+t.message)):n(t)})}}),H=function(t,e){C.default.Scaler.call(this,e),this.filter=t};H.prototype.gen_val=function(t){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(t[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var Y=function(e,i,n,a,r){this.track=e,this.region=i,this.low=i.get("start"),this.high=i.get("end"),this.w_scale=n,this.canvas=a,this.html_elt=t("<div class='track-tile'/>").append(a),this.data=r,this.stale=!1};Y.prototype.predisplay_actions=function(){};var X=function(t,e,i,n,a){Y.call(this,t,e,i,n,a)};X.prototype.predisplay_actions=function(){};var J=function(t,e,i,n,a,r,o,s,l,c,u){Y.call(this,t,e,i,n,a),this.mode=r,this.all_slotted=s,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=c,this.other_tiles_features_drawn={},this.seq_data=u};q(J.prototype,Y.prototype),J.prototype.predisplay_actions=function(){};var W=function(e,i,n){q(n,{drag_handle_class:"draghandle"}),D.call(this,e,i,n),this.dataset=null,n.dataset&&(this.dataset=n.dataset instanceof _.Model?n.dataset:new O.default.Dataset(n.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in n?n.data_query_wait:5e3,this.data_manager="data_manager"in n?n.data_manager:new v.default.GenomeDataManager({dataset:this.dataset,genome:new v.default.Genome({key:e.dbkey,chroms_info:{chrom_info:e.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=t("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in n&&!n.resize||this.add_resize_handle())};q(W.prototype,D.prototype,{action_icons_def:[{name:"mode_icon",title:(0,u.default)("Set display mode"),css_class:"chevron-expand",on_click_fn:function(){}},D.prototype.action_icons_def[0],{name:"overview_icon",title:(0,u.default)("Set as overview"),css_class:"application-dock-270",on_click_fn:function(t){t.view.set_overview(t)}},D.prototype.action_icons_def[1],{name:"filters_icon",title:(0,u.default)("Filters"),css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?t.filters_manager.clear_filters():t.filters_manager.init_filters(),t.filters_manager.toggle()}},{name:"tools_icon",title:(0,u.default)("Tool"),css_class:"hammer",on_click_fn:function(e){e.tool.toggle(),e.tool.is_visible()?e.set_name(e.config.get_value("name")+e.tool_region_and_parameters_str()):e.revert_name(),t(".tooltip").remove()}},{name:"param_space_viz_icon",title:(0,u.default)("Tool parameter space visualization"),css_class:"arrow-split",on_click_fn:function(e){var i="\n                    <strong>Tool</strong>:"+e.tool.get("name")+"<br/>\n                    <strong>Dataset</strong>:"+e.config.get_value("name")+'<br/>\n                    <strong>Region(s)</strong>:\n                        <select name="regions">\n                            <option value="cur">current viewing area</option>\n                            <option value="bookmarks">bookmarks</option>\n                            <option value="both">current viewing area and bookmarks</option>\n                        </select>\n                    ',n=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc")},a=function(){var i,n=t('select[name="regions"] option:selected').val(),a=new v.default.GenomeRegion({chrom:(void 0).view.chrom,start:(void 0).view.low,end:(void 0).view.high}),r=h.map(t(".bookmark"),function(e){return new v.default.GenomeRegion({from_str:t(e).children(".position").text()})});i="cur"===n?[a]:"bookmarks"===n?r:[a].concat(r),Galaxy.modal.hide(),window.top.location.href=Galaxy.root+"visualization/sweepster?"+t.param({dataset_id:e.dataset.id,hda_ldda:e.dataset.get("hda_ldda"),regions:JSON.stringify(new _.Collection(i).toJSON())})};Galaxy.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:i,buttons:{No:n,Yes:a}})}},D.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&D.prototype.can_draw.call(this)},build_container_div:function(){return t("<div/>").addClass("track").attr("id","track_"+this.id)},set_dataset:function(t){this.dataset=t,this.data_manager.set("dataset",t)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var e=this,i=!1,n=!1,a=t("<div class='track-resize'>");t(e.container_div).hover(function(){e.config.get_value("content_visible")&&(i=!0,a.show())},function(){i=!1,n||a.hide()}),a.hide().bind("dragstart",function(i,a){n=!0,a.original_height=t(e.content_div).height()}).bind("drag",function(i,n){var a=Math.min(Math.max(n.original_height+n.deltaY,e.min_height_px),e.max_height_px);t(e.tiles_div).css("height",a),e.visible_height_px=e.max_height_px===a?0:a,e.on_resize()}).bind("dragend",function(t,r){e.tile_cache.clear(),n=!1,i||a.hide(),e.config.set_value("height",e.visible_height_px),e.changed()}).appendTo(e.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof Z?"LabelTrack":this instanceof tt?"ReferenceTrack":this instanceof et?"LineTrack":this instanceof rt?"ReadTrack":this instanceof at?"VariantTrack":this instanceof Q?"CompositeTrack":this instanceof nt?"FeatureTrack":""},show_message:function(e){return this.tiles_div.remove(),t("<span/>").addClass("message").html(e).appendTo(this.content_div)},init:function(e){var i=this;if(i.enabled=!1,i.tile_cache.clear(),i.data_manager.clear(),i.content_div.children().remove(),i.container_div.removeClass("nodata error pending"),i.tiles_div=t("<div/>").addClass("tiles").appendTo(i.content_div),i.dataset.id){var n=t.Deferred(),a={hda_ldda:i.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:i.view.chrom,retry:e};return t.getJSON(this.dataset.url(),a,function(e){if(e&&"error"!==e&&"error"!==e.kind)"no converter"===e?(i.container_div.addClass("error"),i.show_message(L)):"no data"===e||void 0!==e.data&&(null===e.data||0===e.data.length)?(i.container_div.addClass("nodata"),i.show_message("No data for this chrom/contig.")):"pending"===e?(i.container_div.addClass("pending"),i.show_message("Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background."),window.setTimeout(function(){i.init()},i.data_query_wait)):"data"!==e&&"data"!==e.status||(e.valid_chroms&&(i.valid_chroms=e.valid_chroms,i.update_icons()),i.tiles_div.text("Ready for display"),i.view.chrom?(i.tiles_div.text(""),i.tiles_div.css("height",i.visible_height_px+"px"),i.enabled=!0,t.when.apply(t,i.predraw_init()).done(function(){n.resolve(),i.container_div.removeClass("nodata error pending"),i.request_draw()})):n.resolve());else{i.container_div.addClass("error");var a=i.show_message("Cannot display dataset due to an error. ");e.message&&(a.append(t("<a href='javascript:void(0);'></a>").text("View error").click(function(){Galaxy.modal.show({title:(0,u.default)("Trackster Error"),body:"<pre>"+e.message+"</pre>",buttons:{Close:function(){Galaxy.modal.hide()}}})})),a.append(t("<span/>").text(" ")),a.append(t("<a href='javascript:void(0);'></a>").text("Try again").click(function(){i.init(!0)})))}}),this.update_icons(),n}},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var i=t.data;if(i&&void 0!==i.min&&void 0!==i.max){var n=i.min,a=i.max;n=Math.floor(Math.min(0,Math.max(n,i.mean-2*i.sd))),a=Math.ceil(Math.max(0,Math.min(a,i.mean+2*i.sd))),e.config.set_default_value("min_value",n),e.config.set_default_value("max_value",a),e.config.set_value("min_value",n),e.config.set_value("max_value",a)}})},get_drawables:function(){return this}});var K=function(e,i,n){W.call(this,e,i,n);var a=this;if(o(a.container_div,a.drag_handle_class,".group",a),this.filters_manager=new S.default.FiltersManager(this,"filters"in n?n.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=n.tool?new U(h.extend(n.tool,{track:this,tool_state:n.tool_state})):null,this.tile_cache=new v.default.Cache(10),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var r=new V({model:this.tool});r.render(),this.dynamic_tool_div=r.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=t("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=t("<div/>").addClass("overlay").appendTo(this.content_div),n.mode&&this.change_mode(n.mode)};q(K.prototype,D.prototype,W.prototype,{action_icons_def:W.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(e){t(".tooltip").remove(),e.slotters[e.view.resolution_px_b].max_rows*=2,e.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(t){var e=this.to_dict();q(e,{data_manager:this.data_manager});var i=new this.constructor(this.view,t,e);return i.change_mode(this.mode),i.enabled=this.enabled,i},set_filters_manager:function(t){this.filters_manager=t,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var i=t.data;if(isNaN(parseFloat(e.config.get_value("min_value")))||isNaN(parseFloat(e.config.get_value("max_value")))){var n=i.min,a=i.max;n=Math.floor(Math.min(0,Math.max(n,i.mean-2*i.sd))),a=Math.ceil(Math.max(0,Math.min(a,i.mean+2*i.sd))),e.config.set_value("min_value",n),e.config.set_value("max_value",a)}})},change_mode:function(t){var e=this;return e.mode=t,e.config.set_value("mode",t),"Auto"===t&&this.data_manager.clear(),e.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: "+e.mode+")"),e},update_icons:function(){var t=this;t.action_icons.filters_icon.toggle(t.filters_available),t.action_icons.tools_icon.toggle(null!==t.tool),t.action_icons.param_space_viz_icon.toggle(null!==t.tool)},_gen_tile_cache_key:function(t,e){return t+"_"+e},request_draw:function(t){t&&t.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(t,this)},before_draw:function(){this.max_height_px=0},_draw:function(e){var i=this;if(this.can_draw()){var n=e&&e.clear_after,a=this.view.low,r=this.view.high,o=this.view.container.width(),s=this.view.resolution_px_b,l=1/s;this.is_overview&&(a=this.view.max_low,r=this.view.max_high,s=o/(this.view.max_high-this.view.max_low),l=1/s),this.before_draw(),this.tiles_div.children().addClass("remove");for(var c,u,d=Math.floor(400*l),f=Math.floor(a/d),_=[],p=[];f*d<r;)c=new v.default.GenomeRegion({chrom:this.view.chrom,start:f*d,end:Math.min((f+1)*d,this.view.max_high)}),u=this.draw_helper(c,s,e),_.push(u),t.when(u).then(function(t){p.push(t)}),f+=1;n||this.tiles_div.children(".remove").removeClass("remove").remove(),t.when.apply(t,_).then(function(){i.tiles_div.children(".remove").remove(),p=h.filter(p,function(t){return null!==t}),0!==p.length&&i.postdraw_actions(p,o,s,n)})}},_add_yaxis_label:function(e,i){var n=this,a="max"===e?"top":"bottom",r="max"===e?"max":"min",o="max"===e?"max_value":"min_value",l=this.container_div.find(".yaxislabel."+a),c=s(this.config.get_value(o),1);i=i||function(){n.request_draw({clear_tile_cache:!0})},0!==l.length?l.text(c):(l=t("<div/>").text(c).make_text_editable({num_cols:12,on_finish:function(e){t(".tooltip").remove(),this.config.set_value(o,s(e,1)),i()},help_text:"Set "+r+" value"}).addClass("yaxislabel "+a).css("color",this.config.get_value("label_color")),this.container_div.prepend(l))},postdraw_actions:function(t,e,i,n){var a=this;h.filter(t,function(t){return t instanceof X}).length>0?(this.max_height_px=0,h.each(t,function(t){t instanceof X||(t.html_elt.remove(),a.draw_helper(t.region,i,{force:!0,mode:"Coverage"}))}),this._add_yaxis_label("max")):(this.container_div.find(".yaxislabel").remove(),h.find(t,function(t){return t.has_icons})&&h.each(t,function(t){t.has_icons||t.html_elt.css("padding-top",20)}))},get_mode:function(t){return this.mode},update_auto_mode:function(t){},_get_drawables:function(){return[this]},draw_helper:function(e,i,n){var a=this;n||(n={});var r=n.force,o=n.mode||this.mode,s=1/i,l=this._get_drawables(),c=this._gen_tile_cache_key(i,e),u=r?void 0:this.tile_cache.get_elt(c);if(u)return function(t){return t&&"track"in t}(u)&&this.show_tile(u,i),u;if(!1===n.data_fetch)return null;var d=function(){var t=h.find(I,function(t){return t===o})?"Coverage":o,i=h.map(l,function(i){return i.data_manager.get_data(e,t,s,a.data_url_extra_params)});return a.view.reference_track&&i.push(a.view.reference_track.data_manager.get_data(e,o,s,a.view.reference_track.data_url_extra_params)),i},f=t.Deferred();return this.tile_cache.set_elt(c,f),t.when.apply(t,d()).then(function(){var r,o=d(),s=o;if(h.find(o,function(t){return y.default.is_deferred(t)}))return a.tile_cache.set_elt(c,void 0),void t.when(a.draw_helper(e,i,n)).then(function(t){f.resolve(t)});a.view.reference_track&&(r=a.view.reference_track.data_manager.subset_entry(o.pop(),e));var u=[],_=[];h.each(l,function(t,e){var n=s[e];"Auto"===t.mode&&(t.mode=t.get_mode(n),t.update_auto_mode(t.mode)),u.push(t.mode),_.push(t.get_canvas_height(n,t.mode,i,w))});var p,v=a.view.canvas_manager.new_canvas(),m=e.get("start"),g=e.get("end"),w=Math.ceil((g-m)*i)+a.left_offset,b=h.max(_);v.width=w,v.height=n.height||b;var x=v.getContext("2d");x.translate(a.left_offset,0),l.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),h.each(l,function(t,n){p=t.draw_tile(s[n],x,u[n],e,i,r)}),void 0!==p&&(a.tile_cache.set_elt(c,p),a.show_tile(p,i)),f.resolve(p)}),f},get_canvas_height:function(t,e,i,n){return this.visible_height_px},_draw_line_track_tile:function(t,e,i,n,a){-1!==[void 0,null].indexOf(this.config.get_value("min_value"))&&this.config.set_value("min_value",0),-1!==[void 0,null,0].indexOf(this.config.get_value("max_value"))&&this.config.set_value("max_value",h.max(h.map(t.data,function(t){return t[1]}))||0);var r=e.canvas;return new C.default.LinePainter(t.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i).draw(e,r.width,r.height,a),new X(this,n,a,r,t.data)},draw_tile:function(t,e,i,n,a,r){},show_tile:function(t,e){var i=t.html_elt;t.predisplay_actions();var n=Math.round((t.low-(this.is_overview?this.view.max_low:this.view.low))*e);this.left_offset&&(n-=this.left_offset),i.css("left",n),i.hasClass("remove")?i.removeClass("remove"):this.tiles_div.append(i),i.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,i.height()-2),i.parent().children().css("height",this.max_height_px+"px");var a=this.max_height_px;0!==this.visible_height_px&&(a=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height",a+"px")},tool_region_and_parameters_str:function(t){var e=this;return" - region=["+(void 0!==t?t.toString():"all")+"], parameters=["+h.values(e.tool.get_inputs_dict()).join(", ")+"]"},data_and_mode_compatible:function(t,e){return"Auto"===e||("Coverage"===e?"bigwig"===t.dataset_type:"bigwig"!==t.dataset_type&&"no_detail"!==t.extra_info)},can_subset:function(t){return!t.message&&"no_detail"!==t.extra_info&&("bigwig"!==t.dataset_type||t.data[1][0]-t.data[0][0]==1)},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var Z=function(t,e){W.call(this,t,e,{resize:!1,header:!1}),this.container_div.addClass("label-track")};q(Z.prototype,W.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(e){for(var i=this.view,n=i.high-i.low,a=Math.floor(Math.pow(10,Math.floor(Math.log(n)/Math.log(10)))),r=Math.floor(i.low/a)*a,o=this.view.container.width(),s=t("<div/>").addClass("label-container");r<i.high;){var l=Math.floor((r-i.low)/n*o);s.append(t("<div/>").addClass("pos-label").text(y.default.commatize(r)).css({left:l})),r+=a}this.content_div.children(":first").remove(),this.content_div.append(s)}});var Q=function(t,e,i){if(K.call(this,t,e,i),this.drawables=[],"drawables"in i){for(var n,a=0;a<i.drawables.length;a++)n=i.drawables[a],this.drawables[a]=st(n,t,null),n.left_offset>this.left_offset&&(this.left_offset=n.left_offset);this.enabled=!0}h.each(this.drawables,function(t){(t instanceof nt||t instanceof rt)&&t.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};q(Q.prototype,K.prototype,{display_modes:I,build_config_params:function(){return h.union(D.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},action_icons_def:[{name:"composite_icon",title:(0,u.default)("Show individual tracks"),css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_group()}}].concat(K.prototype.action_icons_def),to_dict:N.prototype.to_dict,add_drawable:N.prototype.add_drawable,unpack_drawables:N.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var t=this.visible_height_px;h.each(this.drawables,function(e){e.visible_height_px=t}),W.prototype.on_resize.call(this)},change_mode:function(t){K.prototype.change_mode.call(this,t);for(var e=0;e<this.drawables.length;e++)this.drawables[e].change_mode(t)},init:function(){for(var e=[],i=0;i<this.drawables.length;i++)e.push(this.drawables[i].init());var n=this;t.when.apply(t,e).then(function(){n.enabled=!0,n.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:D.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var t,e=new G(this.view,this.container,{name:this.config.get_value("name")}),i=0;i<this.drawables.length;i++)t=this.drawables[i],t.update_icons(),e.add_drawable(t),t.container=e,e.content_div.append(t.container_div);this.container.replace_drawable(this,e,!0),e.request_draw({clear_tile_cache:!0})},before_draw:function(){var t=h.min(h.map(this.drawables,function(t){return t.config.get_value("min_value")})),e=h.max(h.map(this.drawables,function(t){return t.config.get_value("max_value")}));this.config.set_value("min_value",t),this.config.set_value("max_value",e),h.each(this.drawables,function(i){i.config.set_value("min_value",t),i.config.set_value("max_value",e)})},update_all_min_max:function(){var t=this.config.get_value("min_value"),e=this.config.get_value("max_value");h.each(this.drawables,function(i){i.config.set_value("min_value",t),i.config.set_value("max_value",e)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(t,e,i,n){var a,r=-1;for(a=0;a<t.length;a++){var o=t[a].html_elt.find("canvas").height();o>r&&(r=o)}for(a=0;a<t.length;a++){var s=t[a];s.html_elt.find("canvas").height()!==r&&(this.draw_helper(s.region,i,{force:!0,height:r}),s.html_elt.remove())}var l=this,c=function(){l.update_all_min_max()};this._add_yaxis_label("min",c),this._add_yaxis_label("max",c)}});var tt=function(t){K.call(this,t,{content_div:t.top_labeltrack},{resize:!1,header:!1}),this.left_offset=t.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url=Galaxy.root+"api/genomes/"+this.view.dbkey,this.data_url_extra_params={reference:!0},this.data_manager=new v.default.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};q(tt.prototype,D.prototype,K.prototype,{build_config_params:function(){return h.union(D.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}])},init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:D.prototype.can_draw,draw_helper:function(t,e,i){var n,a=this.tiles_div.is(":visible"),r=null;return e>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),n=!0,r=K.prototype.draw_helper.call(this,t,e,i)):(n=!1,this.tiles_div.hide()),a!==n&&this.view.resize_viewport(),r},can_subset:function(t){return!0},draw_tile:function(t,e,i,n,a){var r=this.data_manager.subset_entry(t,n),o=r.data,s=e.canvas;e.font=e.canvas.manager.default_font,e.textAlign="center";for(var l=0,c=o.length;l<c;l++)e.fillStyle=this.view.get_base_color(o[l]),e.fillText(o[l],Math.floor(l*a),10);return new Y(this,n,a,s,r)}});var et=function(e,i,n){this.mode="Histogram",K.call(this,e,i,n),this.left_offset=30;var a=this;t.when(l(Galaxy.root+"datasets/"+this.dataset.id+"/display")).then(function(t){t&&(a.data_manager=new j.default.BBIDataManager({dataset:a.dataset}))})};q(et.prototype,D.prototype,K.prototype,{display_modes:I,build_config_params:function(){return h.union(D.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(t,e,i,n,a){return this._draw_line_track_tile(t,e,i,n,a)},can_subset:function(t){return t.data[1][0]-t.data[0][0]==1},postdraw_actions:function(t,e,i,n){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var it=function(t,e,i){this.mode="Heatmap",K.call(this,t,e,i)};q(it.prototype,D.prototype,K.prototype,{display_modes:["Heatmap"],build_config_params:function(){return h.union(D.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){})},draw_tile:function(t,e,i,n,a){var r=e.canvas;return new C.default.DiagonalHeatmapPainter(t.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i).draw(e,r.width,r.height,a),new Y(this,n,a,r,t.data)}});var nt=function(t,e,i){K.call(this,t,e,i),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};q(nt.prototype,D.prototype,K.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return h.union(D.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=C.default.ArcLinkedFeaturePainter:this.painter=C.default.LinkedFeaturePainter},postdraw_actions:function(e,i,n,a){var r=this;if(K.prototype.postdraw_actions.call(this,e,i,n,a),0===h.filter(e,function(t){return t instanceof X}).length){var o={};h.each(h.pluck(e,"incomplete_features"),function(t){h.each(t,function(t){o[t[0]]=t})}),h.each(e,function(e){var i=h.omit(o,h.map(e.incomplete_features,function(t){return t[0]}));if(i=h.omit(i,h.keys(e.other_tiles_features_drawn)),0!==h.size(i)){var n={data:h.values(i)},a=r.view.canvas_manager.new_canvas(),s=a.getContext("2d");a.height=Math.max(e.canvas.height,r.get_canvas_height(n,e.mode,e.w_scale,100)),a.width=e.canvas.width,s.drawImage(e.canvas,0,0),s.translate(r.left_offset,0);var l=r.draw_tile(n,s,e.mode,e.region,e.w_scale,e.seq_data);t(e.canvas).replaceWith(t(l.canvas)),e.canvas=a,h.extend(e.other_tiles_features_drawn,o)}})}if(this.filters_manager){var s,l=this.filters_manager.filters;for(s=0;s<l.length;s++)l[s].update_ui_elt();for(var c,u,d=!1,f=0;f<e.length;f++)if(e[f].data.length)for(c=e[f].data[0],s=0;s<l.length;s++)if(u=l[s],u.applies_to(c)&&u.min!==u.max){d=!0;break}this.filters_available!==d&&(this.filters_available=d,this.filters_available||this.filters_manager.hide(),this.update_icons())}if(e[0]instanceof J){for(var _=!0,p=0;p<e.length;p++)if(!e[p].all_slotted){_=!1;break}this.action_icons.show_more_rows_icon.toggle(!_)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(t){"Auto"===this.mode&&("no_detail"===t&&(t="feature spans"),this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/"+t+")"))},incremental_slots:function(t,e,i){var n=this.view.canvas_manager.dummy_context,a=this.slotters[t];return a&&a.mode===i||(a=new x.default.FeatureSlotter(t,i,100,function(t){return n.measureText(t)}),this.slotters[t]=a),a.slot_features(e)},get_mode:function(t){return"no_detail"===t.extra_info||this.is_overview?"no_detail":this.view.high-this.view.low>12e3?"Squish":"Pack"},get_canvas_height:function(t,e,i,n){if("Coverage"===e||"bigwig"===t.dataset_type)return this.summary_draw_height;var a=this.incremental_slots(i,t.data,e),r=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return Math.max(this.min_height_px,r.get_required_height(a,n))},draw_tile:function(t,e,i,n,a,r,o){var s=this,l=e.canvas,c=n.get("start"),u=n.get("end"),d=this.left_offset;if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,i,n,a);var h=[],f=this.slotters[a].slots,_=!0;if(t.data)for(var p=this.filters_manager.filters,v=0,m=t.data.length;v<m;v++){for(var g,w=t.data[v],y=!1,b=0,x=p.length;b<x;b++)if(g=p[b],g.update_attrs(w),!g.keep(w)){y=!0;break}y||(h.push(w),w[0]in f||(_=!1))}var k=this.filters_manager.alpha_filter?new H(this.filters_manager.alpha_filter):null,C=this.filters_manager.height_filter?new H(this.filters_manager.height_filter):null,T=new this.painter(h,c,u,this.config.to_key_value_dict(),i,k,C,r,function(t){return s.view.get_base_color(t)}),S=null,M=null;if(e.fillStyle=this.config.get_value("block_color"),e.font=e.canvas.manager.default_font,e.textAlign="right",t.data){var O=T.draw(e,l.width,l.height,a,f);S=O.feature_mapper,M=O.incomplete_features,S.translation=-d}return o?void 0:new J(s,n,a,l,t.data,i,t.message,_,S,M,r)}});var at=function(t,e,i){K.call(this,t,e,i),this.painter=C.default.VariantPainter,this.summary_draw_height=30,this.left_offset=30};q(at.prototype,D.prototype,K.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return h.union(D.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(t,e,i,n,a){if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,"Histogram",n,a);var r=this.view;return new this.painter(t.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i,function(t){return r.get_base_color(t)}).draw(e,e.canvas.width,e.canvas.height,a),new Y(this,n,a,e.canvas,t.data)},get_canvas_height:function(t,e,i,n){if("bigwig"===t.dataset_type)return this.summary_draw_height;var a=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;return 0===a&&0!==t.data.length&&(a=t.data[0][7].match(/,/g),a=null===a?1:a.length+1),new this.painter(null,null,null,this.config.to_key_value_dict(),e).get_required_height(a)},predraw_init:function(){var t=[W.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||t.push(this.dataset.fetch()),t},postdraw_actions:function(e,i,n,a){K.prototype.postdraw_actions.call(this,e,i,n,a);var r=h.filter(e,function(t){return t instanceof X}),o=this.dataset.get_metadata("sample_names");if(0===r.length&&this.config.get_value("show_labels")&&o&&o.length>1){var s;if(0===this.container_div.find(".yaxislabel.variant").length&&(s=this.config.get_value("summary_height")/2,this.tiles_div.prepend(t("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":s+"px",top:(this.config.get_value("summary_height")-s)/2+"px"})),this.config.get_value("show_sample_data"))){var l=o.join("<br/>");this.tiles_div.prepend(t("<div/>").html(l).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}s=("Squish"===this.mode?5:10)+"px",t(this.tiles_div).find(".sample").css({"font-size":s,"line-height":s}),t(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var rt=function(t,e,i){nt.call(this,t,e,i),this.painter=C.default.ReadPainter,this.update_icons()};q(rt.prototype,D.prototype,K.prototype,nt.prototype,{build_config_params:function(){return h.union(D.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var ot={CompositeTrack:Q,DrawableGroup:G,DiagonalHeatmapTrack:it,FeatureTrack:nt,LineTrack:et,ReadTrack:rt,VariantTrack:at,VcfTrack:at},st=function(t,e,i){if("copy"in t)return t.copy(i);var n=t.obj_type;return n||(n=t.track_type),new ot[n](e,i,t)};e.default={TracksterView:B,DrawableGroup:G,LineTrack:et,FeatureTrack:nt,DiagonalHeatmapTrack:it,ReadTrack:rt,VariantTrack:at,CompositeTrack:Q,object_from_template:st}}).call(e,i(0))},function(t,e,i){"use strict";(function(t,n,a){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),s=r(o),l=i(5),c=r(l),u=i(10),d=r(u),h=i(17),f=r(h),_=i(55),p=r(_),v=i(25),m=r(v),g=t.View.extend({initialize:function(t){var e=this;this.modal=parent.Galaxy.modal||new f.default.View,this.form=new p.default(c.default.merge({listen_to_history:!0,always_refresh:!1,buildmodel:function(t,i){var a=i.model.attributes,r="",o={},l=a.job_id;l?r=Galaxy.root+"api/jobs/"+l+"/build_for_rerun":(r=Galaxy.root+"api/tools/"+a.id+"/build",o=n.extend({},Galaxy.params),o.tool_id&&delete o.tool_id),a.version&&(o.tool_version=a.version),c.default.get({url:r,data:o,success:function(n){if(!n.display)return void(window.location=Galaxy.root);i.model.set(n),e._customize(i),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model ready.",n),t.resolve()},error:function(e,r){var o=e&&e.err_msg||"Uncaught error.";401==r?window.location=Galaxy.root+"user/login?"+n.param({redirect:Galaxy.root+"?tool_id="+a.id}):i.$el.is(":empty")?i.$el.prepend(new d.default.Message({message:o,status:"danger",persistent:!0,large:!0}).$el):Galaxy.modal&&Galaxy.modal.show({title:(0,s.default)("Tool request failed"),body:o,buttons:{Close:function(){Galaxy.modal.hide()}}}),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model request failed.",e),t.reject()}})},postchange:function(t,e){var i={tool_id:e.model.get("id"),tool_version:e.model.get("version"),inputs:n.extend(!0,{},e.data.create())};e.wait(!0),Galaxy.emit.debug("tool-form::postchange()","Sending current state.",i),c.default.request({type:"POST",url:Galaxy.root+"api/tools/"+e.model.get("id")+"/build",data:i,success:function(i){e.update(i),e.wait(!1),Galaxy.emit.debug("tool-form::postchange()","Received new model.",i),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form::postchange()","Refresh request failed.",e),t.reject()}})}},t)),this.deferred=this.form.deferred,this.setElement("<div/>"),this.$el.append(this.form.$el)},_customize:function(t){var e=this,i=t.model.attributes,n=new d.default.Button({icon:"fa-check",tooltip:"Execute: "+i.name+" ("+i.version+")",title:(0,s.default)("Execute"),cls:"btn btn-primary ui-clear-float",wait_cls:"btn btn-info ui-clear-float",onclick:function(){n.wait(),t.portlet.disable(),e.submit(i,function(){n.unwait(),t.portlet.enable()})}});if(i.buttons={execute:n},i.job_id&&i.job_remap){if("job_produced_collection_elements"===i.job_remap)var a="Replace elements in collection ?",r="The previous run of this tool failed. Use this option to replace the failed element(s) in the dataset collectio that were produced during the previous tool run.";else var a="Resume dependencies from this job ?",r="The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run.";i.inputs.push({label:a,name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",i.job_id],["No","__ignore__"]],help:r})}var o={};Galaxy.user.attributes.preferences&&"extra_user_preferences"in Galaxy.user.attributes.preferences&&(o=JSON.parse(Galaxy.user.attributes.preferences.extra_user_preferences)),"true"===("use_cached_job|use_cached_job_checkbox"in o&&o["use_cached_job|use_cached_job_checkbox"])&&i.inputs.push({label:"BETA: Attempt to re-use jobs with identical parameters ?",help:"This may skip executing jobs that you have already run",name:"use_cached_job",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["No",!1],["Yes",!0]]})},submit:function(t,e){var i=this,r={tool_id:t.id,tool_version:t.version,inputs:this.form.data.create()};if(this.form.trigger("reset"),!i.validate(r))return Galaxy.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(e&&e());if(t.action!==Galaxy.root+"tool_runner/index"){var o=n("<form/>").attr({action:t.action,method:t.method,enctype:t.enctype});return a.each(r.inputs,function(t,e){o.append(n("<input/>").attr({name:e,value:t}))}),o.hide().appendTo("body").submit().remove(),void(e&&e())}Galaxy.emit.debug("tool-form::submit()","Validation complete.",r),c.default.request({type:"POST",url:Galaxy.root+"api/tools",data:r,success:function(t){if(e&&e(),i.$el.children().hide(),i.$el.append(i._templateSuccess(t)),t.jobs&&t.jobs.length>0){i.$el.append(n("<div/>",{id:"webhook-view"}));new m.default.WebhookView({type:"tool",toolId:r.tool_id})}parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.refreshContents()},error:function(t){e&&e(),Galaxy.emit.debug("tool-form::submit","Submission failed.",t);var n=!1;if(t&&t.err_data){var a=i.form.data.matchResponse(t.err_data);for(var o in a){i.form.highlight(o,a[o]),n=!0;break}}n||i.modal.show({title:(0,s.default)("Job submission failed"),body:i._templateError(r,t&&t.err_msg),buttons:{Close:function(){i.modal.hide()}}})}})},validate:function(t){var e=this,i=t.inputs,n=-1,a=null;for(var r in i){var o=i[r],s=this.form.data.match(r),l=this.form.field_list[s],c=this.form.input_list[s];if(s&&c&&l){if(!c.optional&&null==o)return this.form.highlight(s),!1;if(l.validate){var u=function(){e.form.trigger("reset")},d=l.validate(u);if(!d.valid)return this.form.highlight(s,d.message),!1}if(o&&o.batch){var h=o.values.length,f=h>0&&o.values[0]&&o.values[0].src;if(f)if(null===a)a=f;else if(a!==f)return this.form.highlight(s,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===n)n=h;else if(n!==h)return this.form.highlight(s,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+h+"</b> selection(s) while a previous field contains <b>"+n+"</b>."),!1}}else Galaxy.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0},_templateSuccess:function(t){if(t.jobs&&t.jobs.length>0){var e=t.jobs.length,i=1==e?"1 job has":e+" jobs have",r=n("<div/>").addClass("donemessagelarge").append(n("<p/>").text(i+" been successfully added to the queue - resulting in the following datasets:"));return a.each(t.outputs,function(t){r.append(n("<p/>").addClass("messagerow").append(n("<b/>").text(t.hid+": "+t.name)))}),r.append(n("<p/>").append("<b/>").text("You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.")),r}return this._templateError(t,"Invalid success response. No jobs found.")},_templateError:function(t,e){return n("<div/>").addClass("errormessagelarge").append(n("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. "+(e||""))).append(n("<pre/>").text(JSON.stringify(t,null,4)))}});e.default={View:g}}).call(e,i(2),i(0),i(1))},,,function(t,e,i){"use strict";function n(t){i(88)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(43),r=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,function(){return a[t]})}(o);var s=i(136),l=i(23),c=n,u=Object(l.a)(r.a,s.a,s.b,!1,c,null,null);e.default=u.exports},,,,function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){return this._init(t||{},e||{})}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=a(o),l=i(2),c=a(l),u=i(6),d=n(u),h=i(60),f=n(h),_=i(72),p=n(_),v=i(71),m=n(v),g=i(3),w=n(g);(0,m.default)(r,"GalaxyApp");var y="galaxy:debug:namespaces",b=!1;try{b="true"==localStorage.getItem("galaxy:debug")}catch(t){console.log((0,w.default)("localStorage not available for debug flag retrieval"))}r.prototype._init=function(t,e){var i=this;return s.extend(i,c.Events),b&&(i.logger=console,console.debug("debugging galaxy:","options:",t,"bootstrapped:",e)),i._processOptions(t),i.root=t.root||"/",i.params=t.params||{},i.session_csrf_token=t.session_csrf_token||null,i._initConfig(t.config||{}),i._patchGalaxy(window.Galaxy),i._initLogger(i.options.loggerOptions||{}),i.debug("GalaxyApp.options: ",i.options),i.debug("GalaxyApp.config: ",i.config),i.debug("GalaxyApp.logger: ",i.logger),i._initLocale(),i.debug("GalaxyApp.localize: ",i.localize),i.config=t.config||{},i.debug("GalaxyApp.config: ",i.config),i._initUser(t.user||{}),i.debug("GalaxyApp.user: ",i.user),i._initUserLocale(),i.debug("currentLocale: ",sessionStorage.getItem("currentLocale")),i._setUpListeners(),i.trigger("ready",i),i},r.prototype.defaultOptions={patchExisting:!0,root:"/",session_csrf_token:null},r.prototype._processOptions=function(t){var e=this,i=e.defaultOptions;e.options={};for(var n in i)i.hasOwnProperty(n)&&(e.options[n]=t.hasOwnProperty(n)?t[n]:i[n]);return e},r.prototype._initConfig=function(t){var e=this;return e.config=t,e.config.debug=b||e.config.debug,e},r.prototype._patchGalaxy=function(t){var e=this;if(e.options.patchExisting&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},r.prototype._initLogger=function(t){var e=this;if(e.config.debug){t.consoleLogger=t.consoleLogger||console,t.consoleLevel=t.consoleLevel||p.default.MetricsLogger.ALL;try{t.consoleNamespaceWhitelist=localStorage.getItem(y).split(",")}catch(t){}try{t.consoleFlattenMessages="true"==localStorage.getItem("galaxy:debug:flatten")}catch(t){}console.log(t.consoleFlattenMessages)}return e.logger=new p.default.MetricsLogger(t),e.emit={},["log","debug","info","warn","error","metric"].map(function(t){e.emit[t]=function(i){e.logger.emit(t,arguments[0],Array.prototype.slice.call(arguments,1))}}),e.config.debug&&(d.default.LoggableMixin.logger=e.logger),e},r.prototype._initLocale=function(t){var e=this;return e.debug("_initLocale:",t),e.localize=w.default,window._l=e.localize,e},r.prototype._initUserLocale=function(t){var e=this,i=!!e.config.default_locale&&e.config.default_locale.toLowerCase(),n={};e.user&&e.user.attributes.preferences&&"extra_user_preferences"in e.user.attributes.preferences&&(n=JSON.parse(e.user.attributes.preferences.extra_user_preferences));var a="localization|locale"in n&&n["localization|locale"].toLowerCase();"auto"==a&&(a=!1);var r="undefined"==typeof navigator?"__root":(navigator.language||navigator.userLanguage||"__root").toLowerCase(),o=a||i||r;sessionStorage.setItem("currentLocale",o)},r.prototype._initUser=function(t){var e=this;return e.debug("_initUser:",t),e.user=new f.default.User(t),e.user.logger=e.logger,e},r.prototype._setUpListeners=function(){var e=this;return e.lastAjax={},t(document).bind("ajaxSend",function(t,i,n){var a=n.data;try{a=JSON.parse(a)}catch(t){}e.lastAjax={url:location.href.slice(0,-1)+n.url,data:a}}),e},r.prototype.debugging=function(t){var e=this;try{if(void 0===t)return"true"===localStorage.getItem("galaxy:debug");if(t)return localStorage.setItem("galaxy:debug",!0),!0;localStorage.removeItem("galaxy:debug"),e.debuggingNamespaces(null)}catch(t){console.log((0,w.default)("localStorage not available for debug flag retrieval"))}return!1},r.prototype.debuggingNamespaces=function(t){var e=this;try{if(void 0===t){var i=localStorage.getItem(y);return"string"==typeof i?i.split(","):[]}null===t?localStorage.removeItem(y):localStorage.setItem(y,t);var n=e.debuggingNamespaces();return e.logger&&(e.logger.options.consoleNamespaceWhitelist=n),n}catch(t){console.log((0,w.default)("localStorage not available for debug namespace retrieval"))}},r.prototype.toString=function(){return"GalaxyApp("+(this.user?this.user.get("email")||"(anonymous)":"uninitialized")+")"},window.Galaxy=window.Galaxy||new r,e.default={GalaxyApp:r}}).call(e,i(0))},,function(t,e,i){"use strict";(function(t){function i(t){t=t||{};var e=this;return e.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,e.userId=e.userId||t.userId||null,e.consoleLogger=t.consoleLogger||null,e._init(t),e}function n(t){var e=String(t);return"[object Object]"==e&&(e=JSON.stringify(t)),e}function a(t){return this._init(t||{})}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};i.ALL=0,i.LOG=0,i.DEBUG=10,i.INFO=20,i.WARN=30,i.ERROR=40,i.METRIC=50,i.NONE=100,i.defaultOptions={logLevel:i.NONE,consoleLevel:i.NONE,defaultNamespace:"Galaxy",consoleNamespaceWhitelist:null,consoleFlattenMessages:!1,clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},i.prototype._init=function(t){var e=this;e.options={};for(var n in i.defaultOptions)i.defaultOptions.hasOwnProperty(n)&&(e.options[n]=t.hasOwnProperty(n)?t[n]:i.defaultOptions[n]);return e.options.logLevel=e._parseLevel(e.options.logLevel),e.options.consoleLevel=e._parseLevel(e.options.consoleLevel),e._sending=!1,e._waiting=null,e._postSize=e.options.postSize,e._initCache(),e},i.prototype._initCache=function(){try{this.cache=new a({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(t){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",t]),this.options.logLevel=i.NONE}},i.prototype._parseLevel=function(t){var e=void 0===t?"undefined":r(t);if("number"===e)return t;if("string"===e){var n=t.toUpperCase();if(i.hasOwnProperty(n))return i[n]}throw new Error("Unknown log level: "+t)},i.prototype.emit=function(t,e,i){var n=this;return e=e||n.options.defaultNamespace,t&&i?(t=n._parseLevel(t),t>=n.options.logLevel&&n._addToCache(t,e,i),n.consoleLogger&&t>=n.options.consoleLevel&&n._emitToConsole(t,e,i),n):n},i.prototype._addToCache=function(t,e,i){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);var n=this;try{n.cache.add(n._buildEntry(t,e,i))>=n._postSize&&n._postCache()}catch(t){n._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",e,i]),n._emitToConsole("error","MetricsLogger",[t])}return n},i.prototype._buildEntry=function(t,e,i){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var n={level:t,namespace:this.options.clientPrefix+e,args:i};return this.options.addTime&&(n.time=(new Date).toISOString()),n},i.prototype._postCache=function(e){if(e=e||{},this._emitToConsole("info","MetricsLogger",["_postCache",e,this._postSize]),!this.options.postUrl||this._sending)return t.when({});var i=this,n=e.count||i._postSize,a=i.cache.get(n),r=a.length,o="function"==typeof i.options.getPingData?i.options.getPingData():{};return o.metrics=JSON.stringify(a),i._sending=!0,t.post(i.options.postUrl,o).always(function(){i._sending=!1}).fail(function(t,e,n){i._postSize=i.options.maxCacheSize,i.emit("error","MetricsLogger",["_postCache error:",t.readyState,t.status,t.responseJSON||t.responseText])}).done(function(t){"function"==typeof i.options.onServerResponse&&i.options.onServerResponse(t),i.cache.remove(r),i._postSize=i.options.postSize})},i.prototype._delayPost=function(){var t=this;t._waiting=setTimeout(function(){t._waiting=null},t.options.delayPostInMs)},i.prototype._emitToConsole=function(t,e,a){var r=this,o=r.options.consoleNamespaceWhitelist;if(!r.consoleLogger)return r;if(o&&-1===o.indexOf(e))return r;var s=Array.prototype.slice.call(a,0);return s.unshift(e),r.options.consoleFlattenMessages&&(s=[s.map(n).join(" ")]),t>=i.METRIC&&"function"==typeof r.consoleLogger.info?r.consoleLogger.info.apply(r.consoleLogger,s):t>=i.ERROR&&"function"==typeof r.consoleLogger.error?r.consoleLogger.error.apply(r.consoleLogger,s):(t>=i.WARN&&"function"==typeof r.consoleLogger.warn?r.consoleLogger.warn.apply(r.consoleLogger,s):t>=i.INFO&&"function"==typeof r.consoleLogger.info?r.consoleLogger.info.apply(r.consoleLogger,s):t>=i.DEBUG&&"function"==typeof r.consoleLogger.debug?r.consoleLogger.debug.apply(r.consoleLogger,s):"function"==typeof r.consoleLogger.log&&r.consoleLogger.log.apply(r.consoleLogger,s),r)},i.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.debug=function(){this.emit(i.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.info=function(){this.emit(i.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.warn=function(){this.emit(i.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.error=function(){this.emit(i.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.metric=function(){this.emit(i.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},a.defaultOptions={maxSize:5e3},a.prototype._init=function(t){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!t.key)throw new Error("LoggingCache needs key for localStorage");return this.key=t.key,this._initStorage(),this.maxSize=t.maxSize||a.defaultOptions.maxSize,this},a.prototype._hasStorage=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}},a.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},a.prototype.add=function(t){var e=this,i=e._fetchAndParse(),n=i.length+1-e.maxSize;return n>0&&i.splice(0,n),i.push(t),e._unparseAndStore(i),i.length},a.prototype._fetchAndParse=function(){var t=this;return JSON.parse(localStorage.getItem(t.key))},a.prototype._unparseAndStore=function(t){var e=this;return localStorage.setItem(e.key,JSON.stringify(t))},a.prototype.length=function(){return this._fetchAndParse().length},a.prototype.get=function(t){return this._fetchAndParse().slice(0,t)},a.prototype.remove=function(t){var e=this._fetchAndParse(),i=e.splice(0,t);return this._unparseAndStore(e),i},a.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},a.prototype.stringify=function(t){return JSON.stringify(this.get(t))},a.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},e.default={MetricsLogger:i,LoggingCache:a}}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(9),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),o=i(74),s=n(o),l=i(76),c=n(l),u=i(142),d=n(u),h=r.View.extend({initialize:function(e){var i=this;this.options=e,this.setElement(this._template()),this.$navbarBrandLink=this.$(".navbar-brand"),this.$navbarBrandImage=this.$(".navbar-brand-image"),this.$navbarBrandTitle=this.$(".navbar-brand-title"),this.$navbarTabs=this.$(".navbar-nav"),this.$quoteMeter=this.$(".quota-meter-container"),this.collection=new s.default.Collection,this.collection.on("add",function(t){i.$navbarTabs.append(new s.default.Tab({model:t}).render().$el)}).on("reset",function(){i.$navbarTabs.empty()}).on("dispatch",function(t){i.collection.each(function(e){t(e)})}).fetch(this.options),this.highlight(e.active_view),Galaxy.frame=this.frame=new c.default({collection:this.collection}),Galaxy.quotaMeter=this.quotaMeter=new d.default.UserQuotaMeter({model:Galaxy.user,el:this.$quoteMeter}),t(window).on("click",function(e){var i=t(e.target).closest("a[download]");1==i.length&&(0===t("iframe[id=download]").length&&t("body").append(t("<iframe/>").attr("id","download").hide()),t("iframe[id=download]").attr("src",i.attr("href")),e.preventDefault())}).on("beforeunload",function(){var t="";if(i.collection.each(function(e){var i=e.get("onbeforeunload")&&e.get("onbeforeunload")();i&&(t+=i+" ")}),""!==t)return t})},render:function(){return this.$navbarBrandTitle.html("ImmPort Galaxy "+(this.options.brand&&"/ "+this.options.brand||"")),this.$navbarBrandLink.attr("href",this.options.logo_url),this.$navbarBrandImage.attr("src",this.options.logo_src),this.quotaMeter.render(),this},highlight:function(t){this.collection.forEach(function(e){e.set("active",e.id==t)})},_template:function(){return'\n            <nav id="masthead" class="navbar navbar-expand fixed-top justify-content-center navbar-dark">\n                <a class="navbar-brand">\n                    <img class="navbar-brand-image"/>\n                    <span class="navbar-brand-title"/>\n                </a>\n                <ul class="navbar-nav"/>\n                <div class="quota-meter-container"/>\n            </nav>'}});e.default={View:h}}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(9),o=a(r),s=i(1),l=a(s),c=i(75),u=i(25),d=n(u),h=i(3),f=n(h),_=i(5),p=n(_),v=o.Collection.extend({model:o.Model.extend({defaults:{visible:!0,target:"_parent"}}),fetch:function(e){e=e||{},this.reset();var i=new c.CommunicationServerView;this.add(i.render()),this.add({id:"analysis",title:(0,f.default)("Analyze Data"),url:"",tooltip:(0,f.default)("Analysis home view")}),this.add({id:"workflow",title:(0,f.default)("Workflow"),tooltip:(0,f.default)("Chain tools into workflows"),disabled:!Galaxy.user.id,url:"workflows/list"}),this.add({id:"visualization",title:(0,f.default)("Visualize"),url:"visualizations/list",tooltip:(0,f.default)("Visualize datasets"),disabled:!Galaxy.user.id,menu:[{title:(0,f.default)("Create Visualization"),url:"visualizations"},{title:(0,f.default)("Interactive Environments"),url:"visualization/gie_list",target:"galaxy_main"},{title:(0,f.default)("Saved Visualizations"),url:"visualizations/list",target:"_frame"}]}),this.add({id:"shared",title:(0,f.default)("Shared Data"),url:"library/index",tooltip:(0,f.default)("Access published resources"),menu:[{title:(0,f.default)("Data Libraries"),url:"library/list"},{title:(0,f.default)("Histories"),url:"histories/list_published"},{title:(0,f.default)("Workflows"),url:"workflows/list_published"},{title:(0,f.default)("Visualizations"),url:"visualizations/list_published"},{title:(0,f.default)("Pages"),url:"pages/list_published"}]}),d.default.load({type:"masthead",callback:function(e){t(document).ready(function(){e.each(function(t){var e=t.toJSON();if(e.activate){var i={id:e.id,icon:e.config.icon,url:e.config.url,tooltip:e.config.tooltip,onclick:e.config.function&&new Function(e.config.function)};Galaxy.page?Galaxy.page.masthead.collection.add(i):Galaxy.masthead&&Galaxy.masthead.collection.add(i),p.default.appendScriptStyle(e)}})})}}),Galaxy.user.get("is_admin")&&this.add({id:"admin",title:(0,f.default)("Admin"),url:"admin",tooltip:(0,f.default)("Administer this Galaxy"),cls:"admin-only"});var n={id:"help",title:(0,f.default)("Help"),tooltip:(0,f.default)("Support, contact, and community"),menu:[{title:(0,f.default)("Support"),url:e.support_url,target:"_blank"},{title:(0,f.default)("Search"),url:e.search_url,target:"_blank"},{title:(0,f.default)("Mailing Lists"),url:e.mailing_lists,target:"_blank"},{title:(0,f.default)("Videos"),url:e.screencasts_url,target:"_blank"},{title:(0,f.default)("Wiki"),url:e.wiki_url,target:"_blank"},{title:(0,f.default)("How to Cite Galaxy"),url:e.citation_url,target:"_blank"},{title:(0,f.default)("Interactive Tours"),url:"tours"}]};e.terms_url&&n.menu.push({title:(0,f.default)("Terms and Conditions"),url:e.terms_url,target:"_blank"}),e.biostar_url&&n.menu.unshift({title:(0,f.default)("Ask a question"),url:"biostar/biostar_question_redirect",target:"_blank"}),e.biostar_url&&n.menu.unshift({title:(0,f.default)("Galaxy Biostar"),url:e.biostar_url_redirect,target:"_blank"}),this.add(n);var a={};return a=Galaxy.user.id?{id:"user",title:(0,f.default)("User"),cls:"loggedin-only",tooltip:(0,f.default)("Account and saved data"),menu:[{title:(0,f.default)("Logged in as")+" "+Galaxy.user.get("email")},{title:(0,f.default)("Preferences"),url:"user"},{title:(0,f.default)("Custom Builds"),url:"custom_builds"},{title:(0,f.default)("Logout"),url:"user/logout?session_csrf_token="+Galaxy.session_csrf_token,target:"_top",divider:!0},{title:(0,f.default)("Saved Datasets"),url:"datasets/list",target:"_top"},{title:(0,f.default)("Saved Histories"),url:"histories/list",target:"_top"},{title:(0,f.default)("Saved Pages"),url:"pages/list",target:"_top"},{title:(0,f.default)("Saved Visualizations"),url:"visualizations/list",target:"_top"}]}:e.allow_user_creation?{id:"user",title:(0,f.default)("Login or Register"),cls:"loggedout-only",tooltip:(0,f.default)("Account registration or login"),menu:[{title:(0,f.default)("Login"),url:"user/login",target:"galaxy_main",noscratchbook:!0},{title:(0,f.default)("Register"),url:"user/create",target:"galaxy_main",noscratchbook:!0}]}:{id:"user",title:(0,f.default)("Login"),cls:"loggedout-only",tooltip:(0,f.default)("Login"),url:"user/login",target:"galaxy_main",noscratchbook:!0},this.add(a),(new t.Deferred).resolve().promise()}}),m=o.View.extend({initialize:function(t){this.model=t.model,this.setElement(this._template()),this.$link=this.$(".nav-link"),this.$note=this.$(".nav-note"),this.$menu=this.$(".dropdown-menu"),this.listenTo(this.model,"change",this.render,this)},events:{"click .nav-link":"_toggleClick"},render:function(){var e=this;return t(".tooltip").remove(),this.$el.removeClass().addClass(this.model.get("disabled")&&"disabled").addClass(this.model.get("active")&&"active").addClass(this.model.get("menu")&&"dropdown").attr("id",this.model.id).css({visibility:this.model.get("visible")&&"visible"||"hidden"}),this.model.set("url",this._formatUrl(this.model.get("url"))),this.$note.html(this.model.get("note")||"").removeClass().addClass("nav-note").addClass(this.model.get("note_cls")).css({display:this.model.get("show_note")&&"block"||"none"}),this.$link.html(this.model.get("title")||"").removeClass().addClass("nav-link").addClass(this.model.get("cls")).addClass(this.model.get("icon")&&"nav-icon fa "+this.model.get("icon")).addClass(this.model.get("menu")&&"dropdown-toggle").addClass(this.model.get("toggle")&&"toggle").attr("target",this.model.get("target")).attr("href",this.model.get("url")).attr("title",this.model.get("tooltip")).tooltip("dispose"),this.model.get("tooltip")&&this.$link.tooltip({placement:"bottom"}),this.model.get("menu")&&this.model.get("show_menu")?(this.$menu.show(),t("#dd-helper").show().off().on("click",function(){t("#dd-helper").hide(),e.model.set("show_menu",!1)})):(this.$menu.hide(),t("#dd-helper").hide()),this.$menu.empty().removeClass(),this.model.get("menu")&&(l.each(this.model.get("menu"),function(i){e.$menu.append(e._buildMenuItem(i)),i.divider&&e.$menu.append(t("<div/>").addClass("dropdown-divider"))}),this.$menu.addClass("dropdown-menu"),this.$link.append(t("<b/>").addClass("caret"))),this},_buildMenuItem:function(e){var i=this;return e=l.defaults(e||{},{title:"",url:"",target:"_parent",noscratchbook:!1}),e.url=this._formatUrl(e.url),t("<a/>").addClass("dropdown-item").attr("href",e.url).attr("target",e.target).html(e.title).on("click",function(t){t.preventDefault(),i.model.set("show_menu",!1),e.onclick?e.onclick():Galaxy.frame.add(e)})},buildLink:function(e,i){return t("<div/>").append(t("<a/>").attr("href",Galaxy.root+i).html(e)).html()},_toggleClick:function(e){var i=this,n=this.model;e.preventDefault(),t(".tooltip").hide(),n.trigger("dispatch",function(t){n.id!==t.id&&t.get("menu")&&t.set("show_menu",!1)}),n.get("disabled")?(this.$link.popover&&this.$link.popover("dispose"),this.$link.popover({html:!0,placement:"bottom",content:"Please "+this.buildLink("login","user/login?use_panels=True")+" or "+this.buildLink("register","user/create?use_panels=True")+" to use this feature."}).popover("show"),window.setTimeout(function(){i.$link.popover("dispose")},3e3)):n.get("menu")?n.set("show_menu",!0):n.get("onclick")?n.get("onclick")():Galaxy.frame.add(n.attributes)},_formatUrl:function(t){return"string"==typeof t&&-1===t.indexOf("//")&&"/"!=t.charAt(0)?Galaxy.root+t:t},_template:function(){return'\n            <li class="nav-item">\n                <a class="nav-link"/>\n                <div class="nav-note"/>\n                <div class="dropdown-menu"/>\n            </li>'}});e.default={Collection:v,Tab:m}}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.CommunicationServerView=void 0;var r=i(9),o=a(r),s=i(1),l=a(s),c=i(3),u=n(c),d=i(17),h=n(d),f=e.CommunicationServerView=o.View.extend({initialize:function(){this.modal=null},makeModalIframe:function(e){var i=window.Galaxy.config.communication_server_host,n=window.Galaxy.config.communication_server_port,a=l.escape(window.Galaxy.user.attributes.username),r=l.escape(window.Galaxy.config.persistent_communication_rooms),o="?username="+a+"&persistent_communication_rooms="+r,s=i+":"+n+o,c=null,u=null,d='<iframe class="f-iframe fade in communication-iframe" src="'+s+'"> </iframe>';return t(".chat-modal").length>0&&t(".chat-modal").remove(),f.modal=new h.default.View({body:d,height:350,width:600,closing_events:!0,title_separator:!1,cls:"ui-modal chat-modal"}),f.modal.show(),c=t(".chat-modal .modal-header"),u=t(".chat-modal .modal-body"),c.addClass("modal-header-body"),u.addClass("modal-header-body"),c.find("h4").remove(),c.removeAttr("min-height padding border"),c.append('<i class="fa fa-comment" aria-hidden="true" title="Communicate with other users"></i><i class="fa fa-expand expand-compress-modal" aria-hidden="true" title="Maximize"></i><i class="fa fa-times close-modal" aria-hidden="true" title="Close"></i>'),t(".close-modal").click(function(e){t(".chat-modal").css("display","none")}),t(".expand-compress-modal").click(function(e){t(".expand-compress-modal").hasClass("fa-expand")?(t(".chat-modal .modal-dialog").width("1000px"),t(".chat-modal .modal-body").height("575px"),t(".expand-compress-modal").removeClass("fa-expand").addClass("fa-compress"),t(".expand-compress-modal").attr("title","Minimize"),t(".expand-compress-modal").css("margin-left","96.2%")):(t(".chat-modal .modal-dialog").width("600px"),t(".chat-modal .modal-body").height("350px"),t(".expand-compress-modal").removeClass("fa-compress").addClass("fa-expand"),t(".expand-compress-modal").attr("title","Maximize"),t(".expand-compress-modal").css("margin-left","93.2%"))}),this},render:function(){var t=this;return{id:"show-chat-online",icon:"fa-comment-o",tooltip:(0,u.default)("Chat online"),visible:!1,onclick:t.makeModalIframe}}})}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(9),o=a(r),s=i(1),l=a(s),c=i(77),u=n(c),d=i(14),h=n(d),f=i(15),_=n(f),p=i(61),v=n(p),m=i(3),g=n(m);e.default=o.View.extend({initialize:function(t){var e=this;t=t||{},this.frames=new u.default.View({visible:!1}),this.setElement(this.frames.$el),this.buttonActive=t.collection.add({id:"enable-scratchbook",icon:"fa-th",tooltip:(0,g.default)("Enable/Disable Scratchbook"),onclick:function(){e.active=!e.active,e.buttonActive.set({toggle:e.active,show_note:e.active,note_cls:e.active&&"fa fa-check"}),e.active||e.frames.hide()},onbeforeunload:function(){if(e.frames.length()>0)return"You opened "+e.frames.length()+" frame(s) which will be lost."}}),this.buttonLoad=t.collection.add({id:"show-scratchbook",icon:"fa-eye",tooltip:(0,g.default)("Show/Hide Scratchbook"),show_note:!0,visible:!1,onclick:function(t){e.frames.visible?e.frames.hide():e.frames.show()}}),this.frames.on("add remove",function(){this.visible&&0===this.length()&&this.hide(),e.buttonLoad.set({note:this.length(),visible:this.length()>0})}).on("show hide ",function(){e.buttonLoad.set({toggle:this.visible,icon:this.visible&&"fa-eye"||"fa-eye-slash"})}),this.history_cache={}},addDataset:function(t){var e=this,i=null;if(Galaxy&&Galaxy.currHistoryPanel){var n=Galaxy.currHistoryPanel.collection.historyId;this.history_cache[n]={name:Galaxy.currHistoryPanel.model.get("name"),dataset_ids:[]},Galaxy.currHistoryPanel.collection.each(function(t){!t.get("deleted")&&t.get("visible")&&e.history_cache[n].dataset_ids.push(t.get("id"))})}var a=function(t,i){if(t){var n=e.history_cache[t.get("history_id")];if(n&&n.dataset_ids){var a=n.dataset_ids,r=a.indexOf(t.get("id"));if(-1!==r&&r+i>=0&&r+i<a.length)return a[r+i]}}},r=function(t,n,r){var o=a(t,n);o?e._loadDataset(o,function(t,e){i=t,r.model.set(e)}):r.model.trigger("change")};this._loadDataset(t,function(t,n){i=t,e.add(l.extend({menu:[{icon:"fa fa-chevron-circle-left",tooltip:(0,g.default)("Previous in History"),onclick:function(t){r(i,-1,t)},disabled:function(){return!a(i,-1)}},{icon:"fa fa-chevron-circle-right",tooltip:(0,g.default)("Next in History"),onclick:function(t){r(i,1,t)},disabled:function(){return!a(i,1)}}]},n))})},_loadDataset:function(e,i){var n=this,a=new h.default.Dataset({id:e});t.when(a.fetch()).then(function(){var t=l.find(["tabular","interval"],function(t){return-1!==a.get("data_type").indexOf(t)}),r=a.get("name"),o=n.history_cache[a.get("history_id")];o&&(r=o.name+": "+r),i(a,t?{title:r,url:null,content:h.default.createTabularDatasetChunkedView({model:new h.default.TabularDataset(a.toJSON()),embedded:!0,height:"100%"}).$el}:{title:r,url:Galaxy.root+"datasets/"+e+"/display/?preview=True",content:null})})},addTrackster:function(e){var i=this,n=new _.default.Visualization({id:e});t.when(n.fetch()).then(function(){var t=new v.default.TracksterUI(Galaxy.root),e={title:n.get("name"),type:"other",content:function(e){var i={container:e,name:n.get("title"),id:n.id,dbkey:n.get("dbkey"),stand_alone:!1},a=n.get("latest_revision"),r=a.config.view.drawables;l.each(r,function(t){t.dataset={hda_ldda:t.hda_ldda,id:t.dataset_id}}),t.create_visualization(i,a.config.viewport,a.config.view.drawables,a.config.bookmarks,!1)}};i.add(e)})},add:function(e){if("_blank"==e.target)window.open(e.url);else if("_top"==e.target||"_parent"==e.target||"_self"==e.target)window.location=e.url;else if(!this.active||e.noscratchbook){var i=t(window.parent.document).find("#galaxy_main");"galaxy_main"==e.target||"center"==e.target?0===i.length?window.location=this._build_url(e.url,{use_panels:!0}):i.attr("src",e.url):window.location=e.url}else e.url=this._build_url(e.url,{hide_panels:!0,hide_masthead:!0}),this.frames.add(e)},_build_url:function(e,i){if(e)return e+=-1==e.indexOf("?")?"?":"&",e+=t.param(i,!0)}})}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(3),r=function(t){return t&&t.__esModule?t:{default:t}}(a),o=i(9),s=n(o),l=i(1),c=n(l),u=s.View.extend({initialize:function(e){this.model=e&&e.model||new s.Model(e),this.setElement(t("<div/>").addClass("corner frame")),this.$el.append(t("<div/>").addClass("f-header corner").append(t("<div/>").addClass("f-title")).append(t("<div/>").addClass("f-icon f-close fa fa-close").tooltip({title:(0,r.default)("Close"),placement:"bottom"}))).append(t("<div/>").addClass("f-content")).append(t("<div/>").addClass("f-resize f-icon corner fa fa-expand").tooltip({title:"Resize"})).append(t("<div/>").addClass("f-cover")),this.$header=this.$(".f-header"),this.$title=this.$(".f-title"),this.$content=this.$(".f-content"),this.render(),this.listenTo(this.model,"change",this.render,this)},render:function(){var e=this,i=this.model.attributes;this.$title.html(i.title||""),this.$header.find(".f-icon-left").remove(),c.each(i.menu,function(i){var n=t("<div/>").addClass("f-icon-left").addClass(i.icon);c.isFunction(i.disabled)&&i.disabled()?n.attr("disabled",!0):n.on("click",function(){i.onclick(e)}).tooltip({title:i.tooltip||"",placement:"bottom"}),e.$header.append(n)}),i.url?this.$content.html(t("<iframe/>").addClass("f-iframe").attr("scrolling","auto").attr("src",i.url+(-1===i.url.indexOf("?")?"?":"&")+"widget=True")):i.content&&(c.isFunction(i.content)?i.content(e.$content):e.$content.html(i.content))}}),d=s.View.extend({defaultOptions:{frame:{cols:6,rows:3},rows:1e3,cell:130,margin:5,scroll:5,top_min:40,frame_max:9,visible:!0},cols:0,top:0,top_max:0,frame_z:0,frame_counter:0,frame_uid:0,frame_list:{},frame_shadow:null,visible:!1,event:{},initialize:function(e){var i=this;this.options=c.defaults(e||{},this.defaultOptions),this.visible=this.options.visible,this.top=this.top_max=this.options.top_min,this.setElement(t("<div/>").addClass("galaxy-frame").append(t("<div/>").addClass("frame-background")).append(t("<div/>").addClass("frame-menu frame-scroll-up fa fa-chevron-up fa-2x")).append(t("<div/>").addClass("frame-menu frame-scroll-down fa fa-chevron-down fa-2x"))),this.frame_shadow=new s.View({el:t("<div/>").addClass("corner frame-shadow")}),this.$el.append(this.frame_shadow.$el),this._frameInit(this.frame_shadow,"#frame-shadow"),this._frameResize(this.frame_shadow,{width:0,height:0}),this.frame_list["#frame-shadow"]=this.frame_shadow,this.visible?this.show():this.hide(),this._panelRefresh(),t(window).resize(function(){i.visible&&i._panelRefresh()})},render:function(){this.$(".frame-scroll-up")[this.top!=this.options.top_min&&"show"||"hide"](),this.$(".frame-scroll-down")[this.top!=this.top_max&&"show"||"hide"]()},add:function(e){if(this.frame_counter>=this.options.frame_max)Galaxy.modal.show({title:(0,r.default)("Warning"),body:"You have reached the maximum number of allowed frames ("+this.options.frame_max+").",buttons:{Close:function(){Galaxy.modal.hide()}}});else{var i="#frame-"+this.frame_uid++;if(0!==t(i).length)Galaxy.modal.show({title:(0,r.default)("Error"),body:"This frame already exists. This page might contain multiple frame managers.",buttons:{Close:function(){Galaxy.modal.hide()}}});else{this.top=this.options.top_min;var n=new u(e);this.$el.append(n.$el),e.width=this._toPixelCoord("width",this.options.frame.cols),e.height=this._toPixelCoord("height",this.options.frame.rows),this.frame_z=parseInt(n.$el.css("z-index")),this.frame_list[i]=n,this.frame_counter++,this._frameInit(n,i),this._frameResize(n,{width:e.width,height:e.height}),this._frameInsert(n,{top:0,left:0},!0),this.visible||this.show(),this.trigger("add")}}},del:function(t){var e=this,i=t.$el;i.fadeOut("fast",function(){i.remove(),delete e.frame_list[t.id],e.frame_counter--,e._panelRefresh(!0),e._panelAnimationComplete(),e.trigger("remove")})},show:function(){this.visible=!0,this.$el.fadeIn("fast"),this.trigger("show")},hide:function(){this.event.type||(this.visible=!1,this.$el.fadeOut("fast",function(){t(this).hide()}),this.trigger("hide"))},length:function(){return this.frame_counter},events:{mousemove:"_eventFrameMouseMove",mouseup:"_eventFrameMouseUp",mouseleave:"_eventFrameMouseUp",mousewheel:"_eventPanelScroll",DOMMouseScroll:"_eventPanelScroll","mousedown .frame":"_eventFrameMouseDown","mousedown .frame-background":"_eventHide","mousedown .frame-scroll-up":"_eventPanelScroll_up","mousedown .frame-scroll-down":"_eventPanelScroll_down","mousedown .f-close":"_eventFrameClose"},_eventFrameMouseDown:function(e){t(".tooltip").hide(),this.event.type||((t(e.target).hasClass("f-header")||t(e.target).hasClass("f-title"))&&(this.event.type="drag"),t(e.target).hasClass("f-resize")&&(this.event.type="resize"),this.event.type&&(e.preventDefault(),this.event.target=this._frameIdentify(e.target),this.event.xy={x:e.originalEvent.pageX,y:e.originalEvent.pageY},this._frameDragStart(this.event.target)))},_eventFrameMouseMove:function(t){if(this.event.type){var e={x:t.originalEvent.pageX,y:t.originalEvent.pageY},i={x:e.x-this.event.xy.x,y:e.y-this.event.xy.y};this.event.xy=e;var n=this._frameScreen(this.event.target);if("resize"==this.event.type){n.width+=i.x,n.height+=i.y;var a=this.options.cell-this.options.margin-1;n.width=Math.max(n.width,a),n.height=Math.max(n.height,a),this._frameResize(this.event.target,n),n.width=this._toGridCoord("width",n.width)+1,n.height=this._toGridCoord("height",n.height)+1,n.width=this._toPixelCoord("width",n.width),n.height=this._toPixelCoord("height",n.height),this._frameResize(this.frame_shadow,n),this._frameInsert(this.frame_shadow,{top:this._toGridCoord("top",n.top),left:this._toGridCoord("left",n.left)})}else if("drag"==this.event.type){n.left+=i.x,n.top+=i.y,this._frameOffset(this.event.target,n);var r={top:this._toGridCoord("top",n.top),left:this._toGridCoord("left",n.left)};0!==r.left&&r.left++,this._frameInsert(this.frame_shadow,r)}}},_eventFrameMouseUp:function(t){this.event.type&&(this._frameDragStop(this.event.target),this.event.type=null)},_eventFrameClose:function(t){this.event.type||(t.preventDefault(),this.del(this._frameIdentify(t.target)))},_eventHide:function(t){this.event.type||this.hide()},_eventPanelScroll:function(e){if(!this.event.type&&this.visible){0!==t(e.srcElement).parents(".frame").length?e.stopPropagation():(e.preventDefault(),this._panelScroll(e.originalEvent.detail?e.originalEvent.detail:e.originalEvent.wheelDelta/-3))}},_eventPanelScroll_up:function(t){this.event.type||(t.preventDefault(),this._panelScroll(-this.options.scroll))},_eventPanelScroll_down:function(t){this.event.type||(t.preventDefault(),this._panelScroll(this.options.scroll))},_frameIdentify:function(e){return this.frame_list["#"+t(e).closest(".frame").attr("id")]},_frameDragStart:function(e){this._frameFocus(e,!0);var i=this._frameScreen(e);this._frameResize(this.frame_shadow,i),this._frameGrid(this.frame_shadow,e.grid_location),e.grid_location=null,this.frame_shadow.$el.show(),t(".f-cover").show()},_frameDragStop:function(e){this._frameFocus(e,!1);var i=this._frameScreen(this.frame_shadow);this._frameResize(e,i),this._frameGrid(e,this.frame_shadow.grid_location,!0),this.frame_shadow.grid_location=null,this.frame_shadow.$el.hide(),t(".f-cover").hide(),this._panelAnimationComplete()},_toGridCoord:function(t,e){var i="width"==t||"height"==t?1:-1;return"top"==t&&(e-=this.top),parseInt((e+i*this.options.margin)/this.options.cell,10)},_toPixelCoord:function(t,e){var i="width"==t||"height"==t?1:-1,n=e*this.options.cell-i*this.options.margin;return"top"==t&&(n+=this.top),n},_toGrid:function(t){return{top:this._toGridCoord("top",t.top),left:this._toGridCoord("left",t.left),width:this._toGridCoord("width",t.width),height:this._toGridCoord("height",t.height)}},_toPixel:function(t){return{top:this._toPixelCoord("top",t.top),left:this._toPixelCoord("left",t.left),width:this._toPixelCoord("width",t.width),height:this._toPixelCoord("height",t.height)}},_isCollision:function(t){for(var e in this.frame_list){var i=this.frame_list[e];if(null!==i.grid_location&&function(t,e){return!(t.left>e.left+e.width-1||t.left+t.width-1<e.left||t.top>e.top+e.height-1||t.top+t.height-1<e.top)}(t,i.grid_location))return!0}return!1},_locationRank:function(t){return t.top*this.cols+t.left},_panelRefresh:function(e){this.cols=parseInt(t(window).width()/this.options.cell,10)+1,this._frameInsert(null,null,e)},_panelAnimationComplete:function(){var e=this;t(".frame").promise().done(function(){e._panelScroll(0,!0)})},_panelScroll:function(t,e){var i=this.top-this.options.scroll*t;if(i=Math.max(i,this.top_max),i=Math.min(i,this.options.top_min),this.top!=i){for(var n in this.frame_list){var a=this.frame_list[n];if(null!==a.grid_location){var r={top:a.screen_location.top-(this.top-i),left:a.screen_location.left};this._frameOffset(a,r,e)}}this.top=i}this.render()},_frameInit:function(t,e){t.id=e,t.screen_location={},t.grid_location={},t.grid_rank=null,t.$el.attr("id",e.substring(1))},_frameInsert:function(e,i,n){var a=this,r=[];e&&(e.grid_location=null,r.push([e,this._locationRank(i)])),c.each(this.frame_list,function(t){null!==t.grid_location&&(t.grid_location=null,r.push([t,t.grid_rank]))}),r.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),c.each(r,function(t){a._framePlace(t[0],n)}),this.top_max=0,c.each(this.frame_list,function(t){null!==t.grid_location&&(a.top_max=Math.max(a.top_max,t.grid_location.top+t.grid_location.height))}),this.top_max=t(window).height()-this.top_max*this.options.cell-2*this.options.margin,this.top_max=Math.min(this.top_max,this.options.top_min),this.render()},_framePlace:function(t,e){t.grid_location=null;for(var i=this._toGrid(this._frameScreen(t)),n=!1,a=0;a<this.options.rows;a++){for(var r=0;r<Math.max(1,this.cols-i.width);r++)if(i.top=a,i.left=r,!this._isCollision(i)){n=!0;break}if(n)break}n?this._frameGrid(t,i,e):console.log("Grid dimensions exceeded.")},_frameFocus:function(t,e){t.$el.css("z-index",this.frame_z+(e?1:0))},_frameOffset:function(t,e,i){if(t.screen_location.left=e.left,t.screen_location.top=e.top,i){this._frameFocus(t,!0);var n=this;t.$el.animate({top:e.top,left:e.left},"fast",function(){n._frameFocus(t,!1)})}else t.$el.css({top:e.top,left:e.left})},_frameResize:function(t,e){t.$el.css({width:e.width,height:e.height}),t.screen_location.width=e.width,t.screen_location.height=e.height},_frameGrid:function(t,e,i){t.grid_location=e,this._frameOffset(t,this._toPixel(e),i),t.grid_rank=this._locationRank(e)},_frameScreen:function(t){var e=t.screen_location;return{top:e.top,left:e.left,width:e.width,height:e.height}}});e.default={View:d}}).call(e,i(0))},function(t,e,i){"use strict";(function(t,i,n){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.Model.extend({defaults:{url_base:"",title_id:void 0,async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},add_filter:function(t,e,i){if(i){var n,a=this.attributes.filters[t];if(null===a||void 0===a)n=e;else if("string"==typeof a)if("All"==a||a==e)n=e;else{var r=[];r[0]=a,r[1]=e,n=r}else n=a,-1===n.indexOf(e)&&n.push(e);this.attributes.filters[t]=n}else this.attributes.filters[t]=e},remove_filter:function(t,e){var n=this.attributes.filters[t];if(null===n||void 0===n)return!1;if("string"==typeof n)this.attributes.filters[t]="";else{var a=i.indexOf(n,e);-1!==a&&(n[a]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);var e=this;return i.each(i.pairs(e.attributes.filters),function(e){t["f-"+e[0]]=e[1]}),t},get_url:function(t){return this.get("url_base")+"?"+n.param(this.get_url_data())+"&"+n.param(t)}})}).call(e,i(2),i(1),i(0))},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=i(5),a=function(t){return t&&t.__esModule?t:{default:t}}(n),r=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r);e.default={grid:function(t){var e=void 0;return e=t.embedded?this.grid_header(t)+this.grid_table(t):'\n                <div class="loading-elt-overlay"></div>\n                <table class="grid-table">\n                    <tr>\n                        <td width="75%">'+this.grid_header(t)+'</td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td width="100%" id="grid-message" valign="top"></td>\n                        <td></td>\n                        <td></td>\n                    </tr>\n                </table>\n                '+this.grid_table(t)+"\n            ",t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'+t.info_text+"</div>"),e},grid_table:function(){return'\n            <form method="post" onsubmit="return false;">\n                <table id="grid-table" class="grid">\n                    <thead id="grid-table-header"></thead>\n                    <tbody id="grid-table-body"></tbody>\n                    <tfoot id="grid-table-footer"></tfoot>\n                </table>\n            </form>'},grid_header:function(t){var e='<div class="grid-header">';if(!t.embedded){var i="";t.title_id&&(i+=' id="'+t.title_id+'"'),e+="<h2"+i+">"+t.title+"</h2>"}if(t.global_actions){e+='<ul class="manage-table-actions">';var n=t.global_actions.length>=3;n&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');var a=!0,r=!1,o=void 0;try{for(var s,l=t.global_actions[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;e+='<li><a class="action-button use-target" target="'+c.target+'" href="'+c.url_args+'" onclick="return false;" >'+c.label+"</a></li>"}}catch(t){r=!0,o=t}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}n&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");var i=!0,n=!1,a=void 0;try{for(var r,o=t.columns[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;s.visible&&(e+='<th id="'+s.key+'-header">',s.sortable?e+='<a href="javascript:void(0)" class="sort-link" sort_key="'+s.key+'">'+s.label+"</a>":e+=s.label,e+='<span class="sort-arrow">'+s.extra+"</span></th>")}}catch(t){n=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(n)throw a}}return e+="</tr>"},body:function(e){var i="";0===e.items.length&&(i+='<tr><td colspan="100"><em>No Items</em></td></tr>');var n=!0,a=!1,r=void 0;try{for(var o,s=e.items[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;i+="<tr ",e.current_item_id==l.id&&(i+='class="current"'),i+=">",e.show_item_checkboxes&&(i+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+l.encode_id+'" id="'+l.encode_id+'" class="grid-row-select-checkbox" /></td>');var c=!0,u=!1,d=void 0;try{for(var h,f=e.columns[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var _=h.value;if(_.visible){var p="";_.nowrap&&(p='style="white-space:nowrap;"');var v=l.column_config[_.label],m=v.link,g=v.value,w=v.target;"string"===t.type(g)&&(g=g.replace(/\/\//g,"/"));var y="";_.attach_popup&&(y="grid-"+l.encode_id+"-popup"),i+="<td "+p+">",_.delayed?i+='<div class="delayed-value-'+_.key+'" data-id="'+l.encode_id+'" data-value="'+g+'"><span class="fa fa-spinner fa-spin"></span></div>':_.attach_popup&&m?i+='<div class="btn-group">\n                                    <button class="btn btn-secondary use-target" target="'+w+'" href="'+m+'" onclick="return false;">'+g+'</button>\n                                    <button id="'+y+'" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"/>\n                                </div>':_.attach_popup?i+='<button id="'+y+'" class="btn dropdown-toggle" data-toggle="dropdown">'+g+"</button>":i+=m?'<a class="use-target" target="'+w+'" href="'+m+'" onclick="return false;">'+g+"</a>":"<label>"+(g||"")+"</label>",i+="</td>"}}}catch(t){u=!0,d=t}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}i+="</tr>"}}catch(t){a=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(a)throw r}}return i},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var i=t.num_page_links,n=t.cur_page_num,a=t.num_pages,r=i/2,o=n-r,s=0;o<=0&&(o=1,s=r-(n-o));var l,c=r+s,u=n+c;u<=a?l=0:(u=a,l=c-(u+1-n)),0!==l&&(o-=l)<1&&(o=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(e+='<span class="page-link-grid" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var d=o;d<u+1;d++)d==t.cur_page_num?e+='<span class="page-link-grid inactive-link" id="page-link-'+d+'">'+d+"</span>":e+='<span class="page-link-grid" id="page-link-'+d+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+d+'">'+d+"</a></span>";u<a&&(e+='...<span class="page-link-grid" id="page-link-'+a+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+a+'">'+a+"</a></span>"),e+="</span>",e+='\n                    <span class="page-link-grid" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span>\n                    </td>\n                </tr>'}if(t.show_item_checkboxes){e+='\n                <tr>\n                    <input type="hidden" id="operation" name="operation" value="">\n                    <td></td>\n                    <td colspan="100">\n                        For <span class="grid-selected-count"></span> selected items: \n            ';var h=!0,f=!1,_=void 0;try{for(var p,v=t.operations[Symbol.iterator]();!(h=(p=v.next()).done);h=!0){var m=p.value;m.allow_multiple&&(e+='<input type="button" value="'+m.label+'" class="operation-button action-button">&nbsp;')}}catch(t){f=!0,_=t}finally{try{!h&&v.return&&v.return()}finally{if(f)throw _}}e+="</td></tr>"}var g=!1,w=!0,y=!1,b=void 0;try{for(var x,k=t.operations[Symbol.iterator]();!(w=(x=k.next()).done);w=!0){if(x.value.global_operation){g=!0;break}}}catch(t){y=!0,b=t}finally{try{!w&&k.return&&k.return()}finally{if(y)throw b}}if(g){e+='<tr><td colspan="100">';var C=!0,T=!1,S=void 0;try{for(var M,O=t.operations[Symbol.iterator]();!(C=(M=O.next()).done);C=!0){var z=M.value;z.global_operation&&(e+='<a class="action-button" href="'+z.global_operation+'">'+z.label+"</a>")}}catch(t){T=!0,S=t}finally{try{!C&&O.return&&O.return()}finally{if(T)throw S}}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'+t.legend+"</td></tr>"),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'+e+'message transient-message">'+o.escape(t.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(t){var e=t.default_filter_dict,i=t.filters,n="none";t.advanced_search&&(n="block");var a=!1,r=!0,o=!1,s=void 0;try{for(var l,c=t.columns[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value;if("advanced"==u.filterable){var d=u.key,h=i[d],f=e[d];h&&f&&h!=f&&(n="block"),a=!0}}}catch(t){o=!0,s=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw s}}var _="block";"block"==n&&(_="none");var p='<div id="standard-search" style="display: '+_+';"><table><tr><td style="padding: 0;"><table>',v=!0,m=!1,g=void 0;try{for(var w,y=t.columns[Symbol.iterator]();!(v=(w=y.next()).done);v=!0){var b=w.value;"standard"==b.filterable&&(p+=this.grid_column_filter(t,b))}}catch(t){m=!0,g=t}finally{try{!v&&y.return&&y.return()}finally{if(m)throw g}}p+="</table></td></tr><tr><td>",a&&(p+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),p+="</td></tr></table></div>",p+='<div id="advanced-search" style="display: '+n+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';var x=!0,k=!1,C=void 0;try{for(var T,S=t.columns[Symbol.iterator]();!(x=(T=S.next()).done);x=!0){var M=T.value;"advanced"==M.filterable&&(p+=this.grid_column_filter(t,M))}}catch(t){k=!0,C=t}finally{try{!x&&S.return&&S.return()}finally{if(k)throw C}}return p+="</table></div>"},grid_column_filter:function(e,i){var n=e.filters,a=i.label,r=i.key;"advanced"==i.filterable&&(a=a.toLowerCase());var o="<tr>";if("advanced"==i.filterable&&(o+='<td align="left" style="padding-left: 10px">'+a+":</td>"),o+='<td style="padding-bottom: 1px;">',i.is_text){o+='<form class="text-filter-form" column_key="'+r+'" action="'+e.url+'" method="get" >';var s=!0,l=!1,c=void 0;try{for(var u,d=e.columns[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value,f=n[h.key];f&&"All"!=f&&(h.is_text&&(f=JSON.stringify(f)),o+='<input type="hidden" id="'+h.key+'" name="f-'+h.key+'" value="'+f+'"/>')}}catch(t){l=!0,c=t}finally{try{!s&&d.return&&d.return()}finally{if(l)throw c}}o+='<span id="'+r+'-filtering-criteria">';var _=n[r];if(_){var p=t.type(_);if("string"==p&&"All"!=_&&(o+=this.filter_element(r,_)),"array"==p)for(var v in _){var m=_;m=m.slice(v),o+=this.filter_element(r,_[v])}}o+="</span>";var g="",w=20;"standard"==i.filterable&&(g=i.label.toLowerCase(),g.length<20&&(w=g.length),w+=4),o+='\n                <span class="search-box">\n                    <input class="search-box-input" id="input-'+r+'-filter" name="f-'+r+'" type="text" placeholder="'+g+'" size="'+w+'"/>\n                    <button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;">\n                        <i class="fa fa-search"></i>\n                    </button>\n                </span>\n            </form>'}else{o+='<span id="'+r+'-filtering-criteria">';var y=!1;for(var b in e.categorical_filters[r]){var x=e.categorical_filters[r][b],k="",C="";for(var T in x)k=T,C=x[T];y&&(o+=" | "),y=!0;var S=n[r];S&&x[r]&&S==C?o+='<span class="categorical-filter '+r+'-filter current-filter">'+b+"</span>":o+='<span class="categorical-filter '+r+'-filter"><a href="javascript:void(0);" filter_key="'+k+'" filter_val="'+C+'">'+b+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(t,e){return'<span class="text-filter-val">'+(e=a.default.sanitize(e))+'<a href="javascript:void(0);" filter_key="'+t+'" filter_val="'+e+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(e,i(0))},,function(t,e,i){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(a),o=t.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(n("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(n("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(t){t.stopPropagation()}),this.$el.append(n("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var t=this;this.icons_div=n("<div/>").addClass("track-icons").hide().appendTo(this.$el),r.each(this.model.action_icons_def,function(e){t.add_action_icon(e.name,e.title,e.css_class,e.on_click_fn,e.prepend,e.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(t,e,i,a,r,o){var s=this;this.action_icons[t]=n("<a/>").attr("title",e).addClass("icon-button").addClass(i).tooltip().click(function(){a(s.model)}).appendTo(this.icons_div),o&&this.action_icons[t].hide()},set_display_modes:function(t,e){if(t){this.model.display_modes=t,this.model.mode=e||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: "+this.mode+")");for(var i=this.model,n={},a=0,r=i.display_modes.length;a<r;a++){var o=i.display_modes[a];n[o]=function(t){return function(){i.change_mode(t)}}(o)}make_popupmenu(this.action_icons.mode_icon,n)}}});e.default={TrackHeaderView:o}}).call(e,i(2),i(0))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(n),r=a.extend,o=function(t,e){this.slot=t,this.feature=e},s=function(t,e,i,n){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=i,this.measureText=n};r(s.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),i=Math.ceil(t[2]*this.w_scale),n=t[3];if(void 0!==n&&this.include_label){var a=this.measureText(n).width+7;e-a>=0?e-=a:i+=a}return[e,i]},_find_slot:function(t){for(var e=t[0],i=t[1],n=0;n<=this.max_rows;n++){var a=!1,r=this.start_end_dct[n];if(void 0!==r)for(var o=0,s=r.length;o<s;o++){var l=r[o];if(i>l[0]&&e<l[1]){a=!0;break}}if(!a)return n}return-1},slot_features:function(t){for(var e,i,n=this.start_end_dct,a=[],r=0,s=0,l=t.length;s<l;s++){e=t[s],i=e[0];var c=this.slots[i];if(c){if(e[1]<c.feature[1]||c.feature[2]<e[2])for(var u=this._get_draw_coords(c.feature),d=this._get_draw_coords(e),h=this.start_end_dct[c.slot],f=0;f<h.length;f++){var _=h[f];_[0]===u[0]&&_[1]===u[1]&&(h[f]=d)}r=Math.max(r,this.slots[i].slot)}else a.push(s)}for(var p=0,v=a.length;p<v;p++){e=t[a[p]],i=e[0];var m=this._get_draw_coords(e),g=this._find_slot(m);g>=0&&(void 0===n[g]&&(n[g]=[]),n[g].push(m),this.slots[i]=new o(g,e),r=Math.max(r,g))}return r+1}}),e.default={FeatureSlotter:s}},function(t,e,i){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var i=t[0],n=t[1],a=e[0],r=e[1];return i<a?n<=a?f:n<=r?p:_:i>r?g:n<=r?m:v}function s(t,e){var i=o(t,e);return i!==f&&i!==g}function l(t,e,i,n,a,r){void 0===r&&(r=4);var o,s=n-e,l=a-i,c=Math.floor(Math.sqrt(s*s+l*l)/r),u=s/c,d=l/c;for(o=0;o<c;o++,e+=u,i+=d)o%2==0&&t.fillRect(e,i,r,1)}function c(t,e,i,n){var a=e-n/2,r=e+n/2,o=i-Math.sqrt(3*n/2);t.beginPath(),t.moveTo(a,o),t.lineTo(r,o),t.lineTo(e,i),t.lineTo(a,o),t.strokeStyle=this.fillStyle,t.fill(),t.stroke(),t.closePath()}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=i(1),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(d),f=1001,_=1002,p=1003,v=1004,m=1005,g=1006,w=function(){function t(e){r(this,t),this.default_val=e||1}return u(t,[{key:"gen_val",value:function(t){return this.default_val}}]),t}(),y=function t(e){r(this,t),this.incomplete_features=e.incomplete_features,this.feature_mapper=e.feature_mapper},b=function(){function t(e,i,n,a,o){r(this,t),this.data=e,this.default_prefs={},this.view_start=i,this.view_end=n,this.prefs=h.extend({},this.default_prefs,a),this.mode=o}return u(t,[{key:"draw",value:function(t,e,i,n){}},{key:"get_start_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,-.5)}},{key:"get_end_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,.5)}},{key:"get_draw_pos",value:function(t,e){return this._chrom_pos_to_draw_pos(t,e,0)}},{key:"_chrom_pos_to_draw_pos",value:function(t,e,i){return Math.floor(e*(Math.max(0,t-this.view_start)+i))}}],[{key:"default_prefs",get:function(){return{}}}]),t}(),x=function(t){function e(t,i,a,o,s){return r(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s))}return a(e,t),u(e,[{key:"draw",value:function(t,e,i,n){var a=!1,r=this.prefs.min_value,o=this.prefs.max_value,s=o-r,l=i,c=this.view_start,u=this.mode,d=this.data;t.save();var f=Math.round(i+r/s*i);"Intensity"!==u&&(t.fillStyle="#aaa",t.fillRect(0,f,e,1)),t.beginPath();var _,p,v;v=d.length>1?h.map(d.slice(0,-1),function(t,e){return Math.ceil((d[e+1][0]-d[e][0])*n)}):[10];for(var m,g=this.prefs.block_color||this.prefs.color,w=parseInt(g.slice(1),16),y=(16711680&w)>>16,b=(65280&w)>>8,x=255&w,k=!1,C=!1,T=0,S=d.length;T<S;T++)if(t.fillStyle=t.strokeStyle=g,k=C=!1,m=v[T],_=Math.floor((d[T][0]-c-.5)*n),null!==(p=d[T][1])){if(p<r?(C=!0,p=r):p>o&&(k=!0,p=o),"Histogram"===u)p=Math.round(p/s*l),t.fillRect(_,f,m,-p);else if("Intensity"===u){var M=(p-r)/s,O=Math.round(y+(255-y)*(1-M)),z=Math.round(b+(255-b)*(1-M)),A=Math.round(x+(255-x)*(1-M));t.fillStyle="rgb("+O+","+z+","+A+")",t.fillRect(_,0,m,l)}else p=Math.round(l-(p-r)/s*l),a?t.lineTo(_,p):(a=!0,"Filled"===u?(t.moveTo(_,l),t.lineTo(_,p)):t.moveTo(_,p));if(t.fillStyle=this.prefs.overflow_color,k||C){var P;"Histogram"===u||"Intensity"===u?P=m:(_-=2,P=4),k&&t.fillRect(_,0,P,3),C&&t.fillRect(_,l-3,P,3)}t.fillStyle=g}else a&&"Filled"===u&&t.lineTo(_,l),a=!1;"Filled"===u?(a&&(t.lineTo(_,f),t.lineTo(0,f)),t.fill()):t.stroke(),t.restore()}}],[{key:"default_prefs",get:function(){return{min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"}}}]),e}(b),k=function(){function t(e){r(this,t),this.feature_positions={},this.slot_height=e,this.translation=0,this.y_translation=0}return u(t,[{key:"map_feature_data",value:function(t,e,i,n){this.feature_positions[e]||(this.feature_positions[e]=[]),this.feature_positions[e].push({data:t,x_start:i,x_end:n})}},{key:"get_feature_data",value:function(t,e){var i,n=Math.floor((e-this.y_translation)/this.slot_height);if(!this.feature_positions[n])return null;t+=this.translation;for(var a=0;a<this.feature_positions[n].length;a++)if(i=this.feature_positions[n][a],t>=i.x_start&&t<=i.x_end)return i.data}}]),t}(),C=function(t){function e(t,i,a,o,s,l,c){r(this,e);var u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s));return u.alpha_scaler=l||new w,u.height_scaler=c||new w,u.max_label_length=200,u}return a(e,t),u(e,[{key:"get_required_height",value:function(t,e){var i=this.get_row_height(),n=i,a=this.mode;return"no_detail"!==a&&"Squish"!==a&&"Pack"!==a||(i=t*n),i+this.get_top_padding(e)}},{key:"get_top_padding",value:function(t){return 0}},{key:"draw",value:function(t,e,i,n,a){t.save(),t.fillStyle=this.prefs.block_color,t.textAlign="right";for(var r,o=this.get_row_height(),s=new k(o),l=[],c=0,u=this.data.length;c<u;c++){var d=this.data[c],h=d[0],f=d[1],_=d[2],p=a&&void 0!==a[h]?a[h].slot:null;("Dense"===this.mode||null!==p)&&f<this.view_end&&_>this.view_start&&(r=this.draw_element(t,this.mode,d,p,this.view_start,this.view_end,n,o,e),s.map_feature_data(d,p,r[0],r[1]),(f<this.view_start||_>this.view_end)&&l.push(d))}return t.restore(),s.y_translation=this.get_top_padding(e),new y({incomplete_features:l,feature_mapper:s})}},{key:"draw_element",value:function(t,e,i,n,a,r,o,s,l){return[0,0]}}],[{key:"default_prefs",get:function(){return{block_color:"#FFF",connector_color:"#FFF"}}}]),e}(b),T=function(t){function e(t,i,a,o,s,l,c){r(this,e);var u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s,l,c));return u.draw_background_connector=!0,u.draw_individual_connectors=!1,u}return a(e,t),u(e,[{key:"get_row_height",value:function(){var t=this.mode;return"Dense"===t?10:"no_detail"===t?3:"Squish"===t?5:10}},{key:"draw_element",value:function(t,e,i,n,a,r,o,s,l){var c=i[1],u=i[2],d=i[3],h=i[4],f=Math.floor(Math.max(0,(c-a-.5)*o)),_=Math.ceil(Math.min(l,Math.max(0,(u-a-.5)*o))),p=f,v=_,m=("Dense"===e?0:0+n)*s+this.get_top_padding(l),g=null,w=null,y=h&&"+"!==h&&"."!==h?this.prefs.reverse_strand_color:this.prefs.block_color,b=this.prefs.label_color;if(t.globalAlpha=this.alpha_scaler.gen_val(i),"Dense"===e&&(n=1),"no_detail"===e)t.fillStyle=y,t.fillRect(f,m+5,_-f,1);else{var x=i[5],k=i[6],C=i[7],T=!0;x&&k&&(g=Math.floor(Math.max(0,(x-a)*o)),w=Math.ceil(Math.min(l,Math.max(0,(k-a)*o))));var S,M;if("Squish"===e?(S=1,M=3,T=!1):(S=5,M=9),C){var O,z;"Squish"===e||"Dense"===e?(O=m+Math.floor(1.5)+1,z=1):h?(O=m,z=M):(O+=2.5,z=1),this.draw_background_connector&&("Squish"===e||"Dense"===e?t.fillStyle="#ccc":h?"+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand")):t.fillStyle="#ccc",t.fillRect(f,O,_-f,z));for(var A=0,P=C.length;A<P;A++){var R,E,j=C[A],q=Math.floor(Math.max(0,(j[0]-a-.5)*o)),$=Math.ceil(Math.min(l,Math.max((j[1]-a-.5)*o)));if(!(q>$)){if(t.fillStyle=y,t.fillRect(q,m+(M-S)/2+1,$-q,S),void 0!==g&&k>x&&!(q>w||$<g)){var L=Math.max(q,g),I=Math.min($,w);t.fillRect(L,m+1,I-L,M),1===C.length&&"Pack"===e&&("+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),L+14<I&&(L+=2,I-=2),t.fillRect(L,m+1,I-L,M))}this.draw_individual_connectors&&R&&this.draw_connector(t,R,E,q,$,m),R=q,E=$}}if("Pack"===e){t.globalAlpha=1,t.fillStyle="white";var D=this.height_scaler.gen_val(i),N=Math.ceil(M*D),G=Math.round((M-N)/2);1!==D&&(t.fillRect(f,O+1,_-f,G),t.fillRect(f,O+M-G+1,_-f,G))}}else t.fillStyle=y,t.fillRect(f,m+1,_-f,M),h&&T&&("+"===h?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===h&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),t.fillRect(f,m+1,_-f,M));t.globalAlpha=1,d&&"Pack"===e&&c>a&&(t.fillStyle=b,0===a&&f-t.measureText(d).width<0?(t.textAlign="left",t.fillText(d,_+2,m+8,this.max_label_length),v+=t.measureText(d).width+2):(t.textAlign="right",t.fillText(d,f-2,m+8,this.max_label_length),p-=t.measureText(d).width+2))}return t.globalAlpha=1,[p,v]}}]),e}(C),S=function(t){function e(t,i,a,o,s,l,c,u,d){r(this,e);var h=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s,l,c));return h.ref_seq=u?u.data:null,h.base_color_fn=d,h}return a(e,t),u(e,[{key:"get_row_height",value:function(){var t,e=this.mode;return"Dense"===e?t=10:"Squish"===e?t=5:(t=10,this.prefs.show_insertions&&(t*=2)),t}},{key:"_parse_cigar",value:function(t){var e="MIDNSHP=X",i=[[0,0]],n=i[0],a=0,r=h.map(t.match(/[0-9]+[MIDNSHP=X]/g),function(t){var r=parseInt(t.slice(0,-1),10),o=t.slice(-1);return"N"===o?0!==n[1]&&(n=[a+r,a+r],i.push(n)):-1==="ISHP".indexOf(o)&&(n[1]+=r,a+=r),[e.indexOf(o),r]});return{blocks:i,cigar:r}}},{key:"draw_read",value:function(t,e,i,n,a,r,l,u,d,h){var f=function(t){return Math.floor(Math.max(0,(t-a-.5)*i))};t.textAlign="center";var g,w,y=[a,r],b=0,x=0,k=Math.round(i/2),C=t.canvas.manager.char_width_px,T="+"===d?this.prefs.detail_block_color:this.prefs.reverse_strand_color,S="Pack"===e,M=S?9:3,O=n+1,z=new R(t,M,i,e),A=[],P=[],E=this._parse_cigar(u);u=E.cigar,A=E.blocks;for(var j=0;j<A.length;j++){var q=A[j];s([l+q[0],l+q[1]],y)&&(g=f(l+q[0]),w=f(l+q[1]),g===w&&(w+=1),t.fillStyle=T,t.fillRect(g,O,w-g,M))}for(var $=0,L=u.length;$<L;$++){var I=u[$],D="MIDNSHP=X"[I[0]],N=I[1],G=l+b;if(g=f(G),w=f(G+N),s([G,G+N],y))switch(g===w&&(w+=1),D){case"H":case"S":case"P":break;case"M":b+=N;break;case"=":case"X":var B="";"X"===D?B=h.slice(x,x+N):this.ref_seq&&(B=this.ref_seq.slice(Math.max(0,G-a),Math.min(G-a+N,r-a)));for(var U=Math.max(G,a),F=0;F<B.length;F++)if(B&&!this.prefs.show_differences||"X"===D){var V=Math.floor(Math.max(0,(U+F-a)*i));t.fillStyle=this.base_color_fn(B[F]),S&&i>C?t.fillText(B[F],V,n+9):i>.05&&t.fillRect(V-k,O,Math.max(1,Math.round(i)),M)}"X"===D&&(x+=N),b+=N;break;case"N":t.fillStyle="#ccc",t.fillRect(g,O+(M-1)/2,w-g,1),b+=N;break;case"D":z.draw_deletion(g,O,N),b+=N;break;case"I":var H=g-k;if(s([G,G+N],y)){var Y=h.slice(x,x+N);if(this.prefs.show_insertions){var X=g-(w-g)/2;if(("Pack"===e||"Auto"===this.mode)&&void 0!==h&&i>C){switch(t.fillStyle="yellow",t.fillRect(X-k,n-9,w-g,9),P[P.length]={type:"triangle",data:[H,n+4,5]},t.fillStyle="#ccc",o([G,G+N],y)){case p:Y=Y.slice(a-G);break;case v:Y=Y.slice(0,G-r);break;case m:break;case _:Y=Y.slice(a-G,G-r)}for(var J=0,W=Y.length;J<W;J++){var K=Math.floor(Math.max(0,(G+J-a)*i));t.fillText(Y[J],K-(w-g)/2,n)}}else t.fillStyle="yellow",t.fillRect(X,n+("Dense"!==this.mode?2:5),w-g,"Dense"!==e?3:9)}else("Pack"===e||"Auto"===this.mode)&&void 0!==h&&i>C&&P.push({type:"text",data:[Y.length,H,n+9]})}x+=N}else b=function(t,e,i){return-1!=="M=NXD".indexOf(e)&&(t+=i),t}(b,D,N),x=function(t,e,i){return-1!=="IX".indexOf(e)&&(t+=i),t}(x,D,N)}t.fillStyle="yellow";for(var Z,Q,tt,et=0;et<P.length;et++)Z=P[et],Q=Z.type,tt=Z.data,"text"===Q?(t.save(),t.font="bold "+t.font,t.fillText(tt[0],tt[1],tt[2]),t.restore()):"triangle"===Q&&c(t,tt[0],tt[1],tt[2])}},{key:"draw_element",value:function(t,e,i,n,a,r,o,s,c){var u=i[1],d=i[2],h=i[3],f=Math.floor(Math.max(-.5*o,(u-a-.5)*o)),_=Math.ceil(Math.min(c,Math.max(0,(d-a-.5)*o))),p=("Dense"===e?0:0+n)*s,v="Pack"===e?9:3;if(i[5]instanceof Array){var m=!0;i[4][1]>=a&&i[4][0]<=r&&i[4][2]?this.draw_read(t,e,o,p,a,r,i[4][0],i[4][2],i[4][3],i[4][4]):m=!1,i[5][1]>=a&&i[5][0]<=r&&i[5][2]?this.draw_read(t,e,o,p,a,r,i[5][0],i[5][2],i[5][3],i[5][4]):m=!1;var g=Math.ceil(Math.min(c,Math.max(-.5*o,(i[4][1]-a-.5)*o))),w=Math.floor(Math.max(-.5*o,(i[5][0]-a-.5)*o));if(m&&w>g){t.fillStyle="#ccc";var y=p+1+(v-1)/2;l(t,g,y,w,y)}}else this.draw_read(t,e,o,p,a,r,u,i[4],i[5],i[6]);return"Pack"===e&&u>=a&&"."!==h&&(t.fillStyle=this.prefs.label_color,0===a&&f-t.measureText(h).width<0?(t.textAlign="left",t.fillText(h,_+2,p+9,this.max_label_length)):(t.textAlign="right",t.fillText(h,f-2,p+9,this.max_label_length))),[0,0]}}]),e}(C),M=function(t){function e(t,i,a,o,s,l,c){r(this,e);var u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s,l,c));return u.longest_feature_length=u.calculate_longest_feature_length(),u.draw_background_connector=!1,u.draw_individual_connectors=!0,u}return a(e,t),u(e,[{key:"calculate_longest_feature_length",value:function(){for(var t=0,e=0,i=this.data.length;e<i;e++){var n=this.data[e],a=n[1],r=n[2];t=Math.max(t,r-a)}return t}},{key:"get_top_padding",value:function(t){var e=this.view_end-this.view_start,i=t/e;return Math.min(128,Math.ceil(this.longest_feature_length/2*i))}},{key:"draw_connector",value:function(t,e,i,n,a,r){var o=(i+n)/2;n-o>0&&(t.beginPath(),t.arc(o,r,n-o,Math.PI,0),t.stroke())}}]),e}(T),O=function(){function t(e,i){r(this,t),Array.isArray(e)?this.rgb=e:6==e.length?this.rgb=e.match(/.{2}/g).map(function(t){return parseInt(t,16)}):7==e.length?this.rgb=e.substring(1,7).match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=e.split("").map(function(t){return parseInt(t+t,16)}),this.alpha="number"==typeof i?i:1}return u(t,[{key:"eval",value:function(){return this}},{key:"toCSS",value:function(){return this.alpha<1?"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")}},{key:"toHSL",value:function(){var t,e,i=this.rgb[0]/255,n=this.rgb[1]/255,a=this.rgb[2]/255,r=this.alpha,o=Math.max(i,n,a),s=Math.min(i,n,a),l=(o+s)/2,c=o-s;if(o===s)t=e=0;else{switch(e=l>.5?c/(2-o-s):c/(o+s),o){case i:t=(n-a)/c+(n<a?6:0);break;case n:t=(a-i)/c+2;break;case a:t=(i-n)/c+4}t/=6}return{h:360*t,s:e,l:l,a:r}}},{key:"toARGB",value:function(){return"#"+[Math.round(255*this.alpha)].concat(this.rgb).map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")}},{key:"mix",value:function(e,i){var n=this,a=i,r=2*a-1,o=n.toHSL().a-e.toHSL().a,s=((r*o==-1?r:(r+o)/(1+r*o))+1)/2,l=1-s;return new t([n.rgb[0]*s+e.rgb[0]*l,n.rgb[1]*s+e.rgb[1]*l,n.rgb[2]*s+e.rgb[2]*l],n.alpha*a+e.alpha*(1-a))}}]),t}(),z=function(){function t(e,i,n,a){r(this,t),this.start_color=new O(e),this.end_color=new O(i),this.start_value=n,this.end_value=a,this.value_range=a-n}return u(t,[{key:"map_value",value:function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t=(t-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-t).toCSS()}}]),t}(),A=function(){function t(e,i,n,a,o){r(this,t),this.positive_ramp=new z(i,n,0,o),this.negative_ramp=new z(i,e,0,-a),this.start_value=a,this.end_value=o}return u(t,[{key:"map_value",value:function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t>=0?this.positive_ramp.map_value(t):this.negative_ramp.map_value(-t)}}]),t}(),P=function(t){function e(t,i,a,o,s){r(this,e);var l,c,u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s));if(void 0===u.prefs.min_value){var d=1/0;for(l=0,c=u.data.length;l<c;l++)d=Math.min(d,u.data[l][6]);u.prefs.min_value=d}if(void 0===u.prefs.max_value){var h=-1/0;for(l=0,c=u.data.length;l<c;l++)h=Math.max(h,u.data[l][6]);u.prefs.max_value=h}return u}return a(e,t),u(e,[{key:"draw",value:function(t,e,i,n){var a,r,o,s,l,c,u=this.prefs.min_value,d=this.prefs.max_value,h=this.view_start,f=1/Math.sqrt(2),_=new A(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,u,d),p=function(t){return(t-h)*n};t.save(),t.rotate(-45*Math.PI/180),t.scale(f,f);for(var v=0,m=this.data.length;v<m;v++)a=this.data[v],r=p(a[1]),o=p(a[2]),s=p(a[4]),l=p(a[5]),c=a[6],t.fillStyle=_.map_value(c),t.fillRect(r,s,o-r,l-s);t.restore()}}],[{key:"default_prefs",get:function(){return{min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"}}}]),e}(b),R=function(){function t(e,i,n,a){r(this,t),this.ctx=e,this.row_height=i,this.px_per_base=n,this.draw_details=("Pack"===a||"Auto"===a)&&n>=e.canvas.manager.char_width_px,this.delete_details_thickness=.2}return u(t,[{key:"draw_deletion",value:function(t,e,i){this.ctx.fillStyle="black";var n=(this.draw_details?this.delete_details_thickness:1)*this.row_height;e+=.5*(this.row_height-n),this.ctx.fillRect(t,e,i*this.px_per_base,n)}}]),t}(),E=function(t){function e(t,i,a,o,s,l){r(this,e);var c=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,a,o,s));return c.base_color_fn=l,c.divider_height=1,c}return a(e,t),u(e,[{key:"get_row_height",value:function(){var t=this.mode;return"Dense"===t?10:"Squish"===t?5:10}},{key:"get_required_height",value:function(t){var e=this.prefs.summary_height;return t>1&&this.prefs.show_sample_data&&(e+=this.divider_height+t*this.get_row_height()),e}},{key:"draw",value:function(t,e,i,n){t.save();var a,r,o,s,l,c,u,d,f,_,p,v=function(t,e){var i=t.length,n=e.length,a=0,r=1,o=null;return"-"===e?(o="deletion",r=t.length):0===t.indexOf(e)&&i>n?(o="deletion",r=i-n,a=n):0===e.indexOf(t)&&i<n&&(o="insertion",r=n-i,a=n),null!==o?{type:o,start:a,len:r}:{}},m=Math.max(1,Math.floor(n)),g=this.data.length?this.data[0][7].split(",").length:0,w="Squish"===this.mode?5:10,y=n<.1?w:"Squish"===this.mode?3:9,b=!0,x=new R(t,w,n,this.mode);1===g&&(w=y=n<t.canvas.manager.char_width_px?this.prefs.summary_height:w,x.row_height=w,b=!1),this.prefs.show_sample_data&&b&&(t.fillStyle="#F3F3F3",t.globalAlpha=1,t.fillRect(0,this.prefs.summary_height-this.divider_height,e,this.divider_height)),t.textAlign="center";for(var k=0;k<this.data.length;k++)if(a=this.data[k],r=a[1],o=a[3],s=[a[4].split(",")],l=a[7].split(","),c=a.slice(8),s=h.map(h.flatten(s),function(t){var e={type:"snp",value:t,start:0},i=v(o,t);return h.extend(e,i)}),!(r<this.view_start||r>this.view_end)){if(b)for(t.fillStyle="#999999",t.globalAlpha=1,p=0;p<s.length;p++)for(d=this.get_start_draw_pos(r+s[p].start,n),t.fillRect(d,0,m,this.prefs.summary_height),f=this.prefs.summary_height,p=0;p<s.length;p++){t.fillStyle="deletion"===s[p].type?"black":this.base_color_fn(s[p].value);var C=c/l.length,T=Math.ceil(this.prefs.summary_height*C);t.fillRect(d,f-T,m,T),f-=T}if(this.prefs.show_sample_data)for(f=b?this.prefs.summary_height+this.divider_height:0,p=0;p<l.length;p++,f+=w)if(_=l[p]?l[p].split(/\/|\|/):["0","0"],u=null,_[0]===_[1]?"."===_[0]||"0"!==_[0]&&(u=s[parseInt(_[0],10)-1],t.globalAlpha=1):(u="0"!==_[0]?_[0]:_[1],u=s[parseInt(u,10)-1],t.globalAlpha=.5),u)if(d=this.get_start_draw_pos(r+u.start,n),"snp"===u.type){var S=u.value;t.fillStyle=this.base_color_fn(S),x.draw_details?t.fillText(S,this.get_draw_pos(r,n),f+w):t.fillRect(d,f+1,m,y)}else"deletion"===u.type&&x.draw_deletion(d,f+1,u.len)}t.restore()}}]),e}(b);e.default={Scaler:w,LinePainter:x,LinkedFeaturePainter:T,ReadPainter:S,ArcLinkedFeaturePainter:M,DiagonalHeatmapPainter:P,VariantPainter:E}},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),a=function(t){return t&&t.__esModule?t:{default:t}}(n),r=i(1),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),s=o.extend,l=function(t){this.manager=null,this.name=t.name,this.index=t.index,this.tool_id=t.tool_id,this.tool_exp_name=t.tool_exp_name};s(l.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var c=function(e,i,n){return t("<a/>").attr("href","javascript:void(0);").attr("title",e).addClass("icon-button").addClass(i).tooltip().click(n)},u=function(e){l.call(this,e),this.low="low"in e?e.low:-Number.MAX_VALUE,this.high="high"in e?e.high:Number.MAX_VALUE,this.min="min"in e?e.min:Number.MAX_VALUE,this.max="max"in e?e.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var i=this;i.parent_div=t("<div/>").addClass("filter-row slider-row");var n=t("<div/>").addClass("elt-label").appendTo(i.parent_div);t("<span/>").addClass("slider-name").text(i.name+"  ").appendTo(n);var a=t("<span/>").text(this.low+"-"+this.high),r=t("<span/>").addClass("slider-value").appendTo(n).append("[").append(a).append("]");i.values_span=a;var o=t("<div/>").addClass("slider").appendTo(i.parent_div);i.control_element=t("<div/>").attr("id",i.name+"-filter-control").appendTo(o),i.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(t,e){i.slide(t,e)},change:function(t,e){i.control_element.slider("option","slide").call(i.control_element,t,e)}}),i.slider=i.control_element,i.slider_label=a,function(e,i,n){e.click(function(){var e=i.text(),a=parseFloat(n.slider("option","max")),r=a<=1?4:a<=1e6?a.toString().length:6,o=!1,s=t(this).parents(".slider-row");s.addClass("input"),n.slider("option","values")&&(r=2*r+1,o=!0),i.text(""),t("<input type='text'/>").attr("size",r).attr("maxlength",r).attr("value",e).appendTo(i).focus().select().click(function(t){t.stopPropagation()}).blur(function(){t(this).remove(),i.text(e),s.removeClass("input")}).keyup(function(e){if(27===e.keyCode)t(this).trigger("blur");else if(13===e.keyCode){var i=n.slider("option","min"),a=n.slider("option","max"),r=function(t){return isNaN(t)||t>a||t<i},l=t(this).val();if(o){if(l=l.split("-"),l=[parseFloat(l[0]),parseFloat(l[1])],r(l[0])||r(l[1]))return alert("Parameter value must be in the range ["+i+"-"+a+"]"),t(this)}else if(l=parseFloat(l),r(l))return alert("Parameter value must be in the range ["+i+"-"+a+"]"),t(this);n.slider(o?"values":"value",l),s.removeClass("input")}})})}(r,a,i.control_element);var s=t("<div/>").addClass("display-controls").appendTo(i.parent_div);this.transparency_icon=c("Use filter for data transparency","layer-transparent",function(){i.manager.alpha_filter!==i?(i.manager.alpha_filter=i,i.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),i.transparency_icon.addClass("active").show()):(i.manager.alpha_filter=null,i.transparency_icon.removeClass("active")),i.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(s).hide(),this.height_icon=c("Use filter for data height","arrow-resize-090",function(){i.manager.height_filter!==i?(i.manager.height_filter=i,i.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),i.height_icon.addClass("active").show()):(i.manager.height_filter=null,i.height_icon.removeClass("active")),i.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(s).hide(),i.parent_div.hover(function(){i.transparency_icon.show(),i.height_icon.show()},function(){i.manager.alpha_filter!==i&&i.transparency_icon.hide(),i.manager.height_filter!==i&&i.height_icon.hide()}),t("<div style='clear: both;'/>").appendTo(i.parent_div)};s(u.prototype,{to_dict:function(){var t=l.prototype.to_dict.call(this);return s(t,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new u({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(t,e){return e-t<=2?.01:1},slide:function(t,e){var i=e.values;this.values_span.text(i[0]+"-"+i[1]),this.low=i[0],this.high=i[1];var n=this;setTimeout(function(){i[0]===n.low&&i[1]===n.high&&n.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(t){return t.length>this.index},_keep_val:function(t){return isNaN(t)||t>=this.low&&t<=this.high},keep:function(t){if(!this.applies_to(t))return!0;var e=t[this.index];if(e instanceof Array){for(var i=!0,n=0;n<e.length;n++)if(!this._keep_val(e[n])){i=!1;break}return i}return this._keep_val(t[this.index])},update_attrs:function(t){var e=!1;if(!this.applies_to(t))return e;var i=t[this.index];i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++){var a=i[n];a<this.min&&(this.min=Math.floor(a),e=!0),a>this.max&&(this.max=Math.ceil(a),e=!0)}return e},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var t=this.slider.slider("option","min"),e=this.slider.slider("option","max");(this.min<t||this.max>e)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var d=function(e,i){if(this.track=e,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=t("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}),i&&"filters"in i){for(var n,a=("alpha_filter"in i?i.alpha_filter:null),r=("height_filter"in i?i.height_filter:null),o=i.filters,s=0;s<o.length;s++)"number"===o[s].type?(n=new u(o[s]),this.add_filter(n),n.name===a&&(this.alpha_filter=n,n.transparency_icon.addClass("active").show()),n.name===r&&(this.height_filter=n,n.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",o[s]);"visible"in i&&i.visible&&this.parent_div.show()}if(0!==this.filters.length){var l=t("<div/>").addClass("param-row").appendTo(this.parent_div),c=this;t("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(l).click(function(){c.run_on_dataset()})}};s(d.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var t,e={},i=[],n=0;n<this.filters.length;n++)t=this.filters[n],i.push(t.to_dict());return e.filters=i,e.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,e.height_filter=this.height_filter?this.height_filter.name:null,e.visible=this.parent_div.is(":visible"),e},copy:function(t){for(var e=new d(t),i=0;i<this.filters.length;i++)e.add_filter(this.filters[i].copy());return e},add_filter:function(t){t.manager=this,this.parent_div.append(t.parent_div),this.filters.push(t)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var t=0;t<this.filters.length;t++){this.filters[t].update_ui_elt()}},clear_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.slider.slider("option","values",[e.min,e.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var e,i,n=(function(t,e,i){return e in t||(t[e]=i),t[e]}),r={},o=0;o<this.filters.length;o++)e=this.filters[o],e.tool_id&&(e.min!==e.low&&(i=n(r,e.tool_id,[]),i[i.length]=e.tool_exp_name+" >= "+e.low),e.max!==e.high&&(i=n(r,e.tool_id,[]),i[i.length]=e.tool_exp_name+" <= "+e.high));var s=[];for(var l in r)s[s.length]=[l,r[l]];!function e(i,n){var r=n[0],o=r[0],s=r[1],l="("+s.join(") and (")+")",c={cond:l,input:i,target_dataset_id:i,tool_id:o};n=n.slice(1),t.getJSON(run_tool_url,c,function(t){t.error?Galaxy.modal.show({title:(0,a.default)("Filter Dataset"),body:"Error running tool "+o,buttons:{Close:Galaxy.modal.hide()}}):0===n.length?Galaxy.modal.show({title:(0,a.default)("Filtering Dataset"),body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:Galaxy.modal.hide()}}):e(t.dataset_id,n)})}(this.track.dataset_id,s)}}),e.default={FiltersManager:d,NumberFilter:u}}).call(e,i(0))},,,,function(t,e,i){var n=i(89);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var a=i(38).default;a("ecbbbcd8",n,!0,{})},function(t,e,i){e=t.exports=i(27)(void 0),e.push([t.i,".citations-formatted{word-wrap:break-word}.citations-bibtex-text{width:100%;height:500px}.citation-padding{padding:5px 10px}",""])},function(t,e,i){!function(t){function e(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(t){this.input=t},this.getEntries=function(){return this.entries},this.isWhitespace=function(t){return" "==t||"\r"==t||"\t"==t||"\n"==t},this.match=function(t,e){if(void 0!=e&&null!=e||(e=!0),this.skipWhitespace(e),this.input.substring(this.pos,this.pos+t.length)!=t)throw"Token mismatch, expected "+t+", found "+this.input.substring(this.pos);this.pos+=t.length,this.skipWhitespace(e)},this.tryMatch=function(t,e){return void 0!=e&&null!=e||(e=!0),this.skipWhitespace(e),this.input.substring(this.pos,this.pos+t.length)==t},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(t){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==t){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(t)}},this.value_braces=function(){var t=0;this.match("{",!1);for(var e=this.pos,i=!1;;){if(!i)if("}"==this.input[this.pos]){if(!(t>0)){var n=this.pos;return this.match("}",!1),this.input.substring(e,n)}t--}else if("{"==this.input[this.pos])t++;else if(this.pos>=this.input.length-1)throw"Unterminated value";i="\\"==this.input[this.pos]&&0==i,this.pos++}},this.value_comment=function(){for(var t="",e=0;!this.tryMatch("}",!1)||0!=e;){if(t+=this.input[this.pos],"{"==this.input[this.pos]&&e++,"}"==this.input[this.pos]&&e--,this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(start);this.pos++}return t},this.value_quotes=function(){this.match('"',!1);for(var t=this.pos,e=!1;;){if(!e){if('"'==this.input[this.pos]){var i=this.pos;return this.match('"',!1),this.input.substring(t,i)}if(this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(t)}e="\\"==this.input[this.pos]&&0==e,this.pos++}},this.single_value=function(){var t=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var e=this.key();if(e.match("^[0-9]+$"))return e;if(this.months.indexOf(e.toLowerCase())>=0)return e.toLowerCase();throw"Value expected:"+this.input.substring(t)+" for key: "+e},this.value=function(){var t=[];for(t.push(this.single_value());this.tryMatch("#");)this.match("#"),t.push(this.single_value());return t.join("")},this.key=function(t){for(var e=this.pos;;){if(this.pos>=this.input.length)throw"Runaway key";if(this.notKey.indexOf(this.input[this.pos])>=0)return t&&","!=this.input[this.pos]?(this.pos=e,null):this.input.substring(e,this.pos);this.pos++}},this.key_equals_value=function(){var t=this.key();if(this.tryMatch("=")){this.match("=");var e=this.value();return t=t.trim(),[t,e]}throw"... = value expected, equals sign missing:"+this.input.substring(this.pos)},this.key_value_list=function(){var t=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[t[0]]=t[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)t=this.key_equals_value(),this.currentEntry.entryTags[t[0]]=t[1]},this.entry_body=function(t){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=t.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(t){this.entry_body(t)},this.alernativeCitationKey=function(){this.entries.forEach(function(t){!t.citationKey&&t.entryTags&&(t.citationKey="",t.entryTags.author&&(t.citationKey+=t.entryTags.author.split(",")[0]+=", "),t.citationKey+=t.entryTags.year)})},this.bibtex=function(){for(;this.matchAt();){var t=this.directive();this.match("{"),"@STRING"==t.toUpperCase()?this.string():"@PREAMBLE"==t.toUpperCase()?this.preamble():"@COMMENT"==t.toUpperCase()?this.comment():this.entry(t),this.match("}")}this.alernativeCitationKey()}}t.toJSON=function(t){var i=new e;return i.setInput(t),i.bibtex(),i.entries},t.toBibtex=function(t){var e="";for(var i in t){if(e+="@"+t[i].entryType,e+="{",t[i].citationKey&&(e+=t[i].citationKey+", "),t[i].entry&&(e+=t[i].entry),t[i].entryTags){var n="";for(var a in t[i].entryTags)0!=n.length&&(n+=", "),n+=a+"= {"+t[i].entryTags[a]+"}";e+=n}e+="}\n\n"}return e}}(e)},function(t,e,i){"use strict";function n(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),n(i(92)),n(i(93)),n(i(44)),n(i(47)),n(i(13)),n(i(48)),n(i(134)),n(i(135)),n(i(51))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.aliases={mathfrak:"frak",mathcal:"cal",mathbb:"bb",mathbf:"bf",dfrac:"frac",ldots:"dots"}},function(t,e,i){"use strict";function n(t,e){return r(t,s.mustNotBeUndefined(s.mustBeOk(s.latexParser.parse(e)).value))}function a(t){return r({translateTo:"unicode",mode:"Any"},s.mustNotBeUndefined(s.mustBeOk(s.latexParser.parse(t)).value))}function r(t,e){var i=t.translateTo;switch(i){case"html":throw new Error("Unsupported format: '"+i+"'. Use one of: "+Object.keys(o.supportedMarkups));case"unicode":default:return l.convertLaTeXBlocksToUnicode(t,e).result}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(44),s=i(28),l=i(95);e.convertLaTeX=n,e.convertLaTeXToUnicode=a,e.convertLaTeXBlocks=r},function(t,e,i){"use strict";function n(t,e){var i=t.length,n=e.length;if(0===i)return e;if(0===n)return t;for(var a={},r=0;r<i;r++)a[t[r]]=!0;for(var o=0;o<n;o++)a[e[o]]=!0;var s=[];for(var l in a)a.hasOwnProperty(l)&&s.push(l);return s.sort(),s}function a(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var i=t.furthest===e.furthest?n(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:i}}function r(t,e,i,n){return k.Parser(function(r,o){for(var s=n,l=0,c=void 0;o<r.length;){var u=e._(r,o);if(u.status){o=S.mustBeNumber(u.index);break}var d=t._(r,o);if(b(d))return d;if(c=S.mustNotBeUndefined(a(d,c)),b(c))return c;l++;var h=S.mustNotBeUndefined(c.value);s=i(s,h),o=S.mustBeNumber(c.index)}return x(a(k.makeSuccess(o,s),c))})}function o(t,e){return r(t,e,function(t,e){return t.concat([e])},[])}function s(t){return k.Parser(function(e,i){var n=e.charAt(i);if(i>=e.length||t(n))return M.makeFailure(i,"text character");var a=[n];i++;for(var r=e.charAt(i);!t(r)&&i<e.length;)a.push(r),i++,r=e.charAt(i);return k.makeSuccess(i,a.join(""))})}function l(t){return s(u(t)).map(function(t){return T.newTeXRaw(t)})}function c(t,i){return(void 0===i?e.specialCharsDefault:i).hasOwnProperty(t)}function u(t){return function(e){return t.hasOwnProperty(e)}}function d(t,i,n){switch(void 0===i&&(i="_"),void 0===n&&(n="^"),t){case"Math":return e.latexBlockParserMathMode(i,n);default:return e.latexBlockParserTextMode}}function h(t){return t>="A"&&t<="Z"}function f(t){return t>="a"&&t<="z"}function _(t){return q.then(o(d(t,"_"),$)).map(C.newFixArg)}function p(t){return P.then(o(d(t),R)).map(C.newOptArg)}function v(t){return k.alt(_(t),p(t))}function m(t){return k.alt(k.string("{}").map(function(){return[]}),v(t).map(function(t){return t}).atLeast(0)).map(function(t){return t})}function g(t){return k.seqMap(e.commandSymbol,k.alt(e.specialChar,e.takeTill(e.endCmd)),m(t),function(t,e,i){return void 0!==i?C.newTeXComm.apply(void 0,[e].concat(i)):C.newTeXComm(e)}).map(function(t){return t})}function w(t,i,n){return k.seqMap(e.subOrSuperscriptSymbolParser(i,n),m(t),function(t,e){return C.newSubOrSuperScript(t,t===C.SubOrSuperSymbol.SUB?i:n,e)}).map(function(t){return t})}function y(t){return void 0!==t&&!0===t.status}function b(t){return void 0!==t&&!1===t.status}function x(t){if(!y(t))throw new Error("Expected parse to be success: "+JSON.stringify(t));return t}Object.defineProperty(e,"__esModule",{value:!0});var k=i(46),C=i(30),T=i(30),S=i(29),M=i(46);e.defaultParserConf={verbatimEnvironments:["verbatim"]},e.takeTill=function(t){return k.takeWhile(function(e){return!t(e)})};var O=k.regexp(/[^\n]*/),z=k.regexp(/\n?/),A=(k.regexp(/\s*/m),k.string("%")),P=k.string("["),R=k.string("]");e.notTextDefault={$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},e.notTextMathMode={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},e.notTextMathModeAndNotClosingBracket={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},e.notTextDefaultAndNotClosingBracket={$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},e.textParser=l;var E=(l(e.notTextDefault),l(e.notTextDefaultAndNotClosingBracket),k.regexp(/ */).map(T.newTeXRaw));e.comment=A.then(O).skip(z).map(C.newTeXComment),e.specialCharsDefault={"'":!0,"(":!0,")":!0,",":!0,".":!0,"-":!0,'"':!0,"!":!0,"^":!0,$:!0,"&":!0,"#":!0,"{":!0,"}":!0,"%":!0,"~":!0,"|":!0,"/":!0,":":!0,";":!0,"=":!0,"[":!0,"]":!0,"\\":!0,"`":!0," ":!0},e.isSpecialCharacter=c,e.isNotText=u,e.mathSymbol=k.string("$"),e.commandSymbol=k.string("\\"),e.latexBlockParser=d,e.latexBlockParserTextMode=k.lazy(function(){return k.alt(k.alt(l(e.notTextDefault),e.dolMath,e.comment,l(e.notTextDefaultAndNotClosingBracket),e.environment,g("Paragraph")))}),e.latexBlockParserMathMode=function(t,i){return k.lazy(function(){return k.alt(k.alt(w("Math",t,i),l(e.notTextMathMode),e.dolMath,e.comment,l(e.notTextMathModeAndNotClosingBracket),e.environment,g("Math")))})},e.latexParser=e.latexBlockParserTextMode.many();var j=k.string("{").then(e.latexBlockParserTextMode.many()).skip(k.string("}"));e.env=k.Parser(function(t,i){var n=k.string("\\begin").then(k.string("{")).then(E).then(k.regexp(/[a-zA-Z]+/)).skip(E).skip(k.string("}"))._(t,i);if(b(n))return n;i=S.mustBeNumber(n.index);var a=n.value;return o(e.latexBlockParserTextMode,k.string("\\end").then(k.string("{")).then(E).then(k.string(a)).then(E).then(k.string("}"))).map(function(t){return C.newTeXEnv(a,t)})._(t,i)}),e.environment=k.alt(j,e.env),e.specialChar=k.test(c),e.endCmd=function(t){return!f(t)&&!h(t)};var q=k.string("{"),$=k.string("}");e.fixArg=_,e.optArg=p,e.cmdArg=v,e.cmdArgs=m,e.command=g,e.subOrSuperscriptSymbolParser=function(t,e){return k.alt(k.string(t),k.string(e)).map(function(e){return e===t?C.SubOrSuperSymbol.SUB:C.SubOrSuperSymbol.SUP})},e.shiftedScript=w,e.dolMath=function(t,e,i){return void 0===t&&(t="Dollar"),void 0===e&&(e="$"),void 0===i&&(i="$"),k.string(e).then(d("Math","_").many().map(function(n){return C.newTeXMath(t,e,i,n)})).skip(k.string(i))}(),e.isOk=y,e.isNotOk=b,e.mustBeOk=x},function(t,e,i){"use strict";function n(t){return"string"==typeof t}function a(t,e){var i=t;do{t++}while(h.isTeXChar(e[t]));return{result:e.slice(i,t).map(function(t){return t.string}).join(""),blockIndex:t}}function r(t,e,i,a){var r=d(t,a);if(n(r))return{result:r,blockIndex:e+1};for(var o=[],l=[];o.length<r.argumentCount&&e<i.length-1;){e++;var c=e;if(i.length<c-1)throw new Error("Could not gobble "+r.argumentCount+" arguments for "+a.name);var u=i[c];if(h.isTeXRaw(u)){for(var f=/\s+/g,_=u.text.replace(x,""),p=-1,v=0;o.length<r.argumentCount;){var m=f.exec(_);if(!m){o.push.apply(o,b.convertToTeXCharsDefault(_));break}var g=_.substring(v,m.index);p=m.index,v=m.index+g.length,o.push.apply(o,b.convertToTeXCharsDefault(g))}p>=0&&l.push(_.substring(p))}else o.push(u)}e++;var w=o.map(function(e){return s(t,[e]).result}).map(h.newTeXRaw).map(function(t){return h.newFixArg([t])});if(w.length<r.argumentCount)throw new Error("Could not find enough arguments for command \\"+r.name+". Expected "+r.argumentCount+", but found "+w.length);var y=[r.apply(function(){},w)];return l.length>0&&y.push(l.join("")),{result:y.join(""),blockIndex:e}}function o(t){return void 0!==t&&"string"==typeof t.string&&"number"==typeof t.category}function s(t,e){var i=0;if(e.length<=0)return{result:"",blockIndex:i};for(var n=[];i<e.length;){var l=e[i];try{if(o(l)){var c=a(i,e);i=c.blockIndex,n.push(c.result)}else if(h.isTeXComm(l)){var u=r(t,i,e,l);i=u.blockIndex,n.push(u.result)}else if(h.isFixArg(l)||h.isOptArg(l)){var u=s(t,l.latex);n.push(u.result),i++}else if(h.isTextHaving(l))n.push(l.text),i++;else{if(h.isTeXMath(l))return s(t,l.latex);if(h.isTeXRaw(l))n.push(l.text),i++;else if(h.isSubOrSuperScript(l)){var d=l.arguments?l.arguments:[],u=r(t,i,e,h.newTeXComm.apply(void 0,[l.type===h.SubOrSuperSymbol.SUB?"mathsubscript":"mathsuperscript"].concat(d)));i=u.blockIndex,n.push(u.result)}else{if(!h.isArray(l))throw new Error("Can't handle LaTeX block yet: "+JSON.stringify(l)+". Leave an issue at https://github.com/digitalheir/tex-to-unicode/issues");var u=s(t,l);n.push(u.result),i++}}}catch(e){if(void 0===t.onError)throw e;var f=t.onError(e,l);if(void 0===f)throw e;n.push(f),i++}}return{result:n.join(""),blockIndex:i}}function l(t,e){if(e.arguments.length>0){var i=v.expand1argsCommand(e.name,s(t,[e.arguments[0]]).result||"");return e.arguments.length>1?i+s(t,e.arguments.slice(1)).result:i}return p.createCommandHandler(e.name,0,1,function(i,n){var a=n[0],r=n.slice(1);return v.expand1argsCommand(e.name,s(t,[a]).result)+s(t,r).result})}function c(t,e){if(e.arguments.length>1){var i=w.expand2argsCommand(e.name,s(t,[e.arguments[0]]).result||"",s(t,[e.arguments[1]]).result||"");return e.arguments.length>2?i+s(t,e.arguments.slice(1)).result:i}return p.createCommandHandler(e.name,0,2,function(i,n){var a=n[0],r=n[1],o=n.slice(2);return w.expand2argsCommand(e.name,s(t,[a]).result,s(t,[r]).result)+s(t,o).result})}function u(t,e){for(var i=void 0,n=void 0,a=0;void 0===n&&a<e.arguments.length;){var r=e.arguments[a],o=s(t,[r]).result;h.isOptArg(r)&&!i?i=o:n=o,a++}return n?g.convertSqrtToUnicode(n,i):p.createCommandHandler(e.name,1,1,function(e,i){var n=i[0],a=g.convertSqrtToUnicode(s(t,[n]).result);if(i.length>1){var r=i.slice(1);return a+s(t,r).result}return a})}function d(t,e){var i=e.name,n=_.expand0argsCommand(i);if(n)return e.arguments&&e.arguments.length>0?n+s(t,e.arguments).result:n;if(m.is1argsCommand(i))return l(t,e);if(y.is2argsCommand(i))return c(t,e);if("sqrt"===i)return u(t,e);throw f.unknownCommandError(i)}Object.defineProperty(e,"__esModule",{value:!0});var h=i(28),f=i(47),_=i(96),p=i(48),v=i(103),m=i(51),g=i(128),w=i(129),y=i(132),b=i(45),x=/^\s*/;e.isTeXChar2=o,e.convertLaTeXBlocksToUnicode=s,e.convertCommand=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(97),a=i(98),r=i(99),o=i(100),s=i(101),l=i(102);e.expand0argsCommand=function(t){for(var e=0,i=[r.barredLUnicode,n.spaceUnicode,o.slashedOUnicode,a.characterUnicode,l.specialCharacter,s.cyrillicUnicode];e<i.length;e++){var c=i[e],u=c(t);if(u)return u}}},function(t,e,i){"use strict";function n(t){return e.spaceCharactersUnicode.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.mathSpace="芇",e.spaceCharactersUnicode={",":" ",quad:" ",qquad:"  "," ":" ",space:" ",";":"　",":":"　",hfill:"\t"},e.isSpaceCharactersUnicode=n,e.spaceUnicode=function(t){return n(t)?e.spaceCharactersUnicode[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.characterUnicodeChart.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.characterUnicodeChart={leftrightsquigarrow:"↭",Longleftrightarrow:"⟺",blacktriangleright:"▶",longleftrightarrow:"⟷",blacktriangledown:"▼",blacktriangleleft:"◀",leftrightharpoons:"⇋",rightleftharpoons:"⇌",twoheadrightarrow:"↠",circlearrowright:"↻",downharpoonright:"⇂",rightharpoondown:"⇁",rightrightarrows:"⇉",twoheadleftarrow:"↞",vartriangleright:"⊳",bigtriangledown:"▽",circlearrowleft:"↺",curvearrowright:"↷",downharpoonleft:"⇃",leftharpoondown:"↽",leftrightarrows:"⇆",rightleftarrows:"⇄",rightsquigarrow:"⇝",rightthreetimes:"⋌",trianglerighteq:"⊵",vartriangleleft:"⊲",Leftrightarrow:"⇔",Longrightarrow:"⟹",curvearrowleft:"↶",dashrightarrow:"⇢",doublebarwedge:"⩞",downdownarrows:"⇊",hookrightarrow:"↪",leftleftarrows:"⇇",leftrightarrow:"↔",leftthreetimes:"⋋",longrightarrow:"⟶",looparrowright:"↬",rightarrowtail:"↣",rightharpoonup:"⇀",sphericalangle:"∢",textregistered:"®",trianglelefteq:"⊴",upharpoonright:"↾",Longleftarrow:"⟸",bigtriangleup:"△",blacktriangle:"▲",dashleftarrow:"⇠",divideontimes:"⋇",fallingdotseq:"≒",hookleftarrow:"↩",leftarrowtail:"↢",leftharpoonup:"↼",longleftarrow:"⟵",looparrowleft:"↫",measuredangle:"∡",shortparallel:"∥",smallsetminus:"∖",texttrademark:"™",triangleright:"▷",upharpoonleft:"↿",blacklozenge:"◆",risingdotseq:"≓",triangledown:"▽",triangleleft:"◁",Rrightarrow:"⇛",Updownarrow:"⇕",backepsilon:"∍",blacksquare:"■",circledcirc:"⊚",circleddash:"⊝",curlyeqprec:"⋞",curlyeqsucc:"⋟",diamondsuit:"♢",preccurlyeq:"≼",succcurlyeq:"≽",textgreater:">",thickapprox:"≈",updownarrow:"↕",vartriangle:"△",Lleftarrow:"⇚",Rightarrow:"⇒",circledast:"⊛",complement:"∁",curlywedge:"⋏",longmapsto:"⟼",registered:"®",rightarrow:"→",smallfrown:"⌢",smallsmile:"⌣",sqsubseteq:"⊑",sqsupseteq:"⊒",textlangle:"〈",textrangle:"〉",upuparrows:"⇈",varepsilon:"ε",varnothing:"∅",Downarrow:"⇓",Leftarrow:"⇐",backprime:"‵",bigotimes:"⨂",centerdot:"⋅",copyright:"©",downarrow:"↓",gtreqless:"⋛",heartsuit:"♡",leftarrow:"←",lesseqgtr:"⋚",pitchfork:"⋔",spadesuit:"♠",therefore:"∴",trademark:"™",triangleq:"≜",varpropto:"∝",approxeq:"≊",barwedge:"⊼",bigoplus:"⨁",bigsqcup:"⨆",biguplus:"⨄",bigwedge:"⋀",boxminus:"⊟",boxtimes:"⊠",circledS:"Ⓢ",clubsuit:"♣",curlyvee:"⋎",doteqdot:"≑",emptyset:"∅",intercal:"⊺",leqslant:"⩽",multimap:"⊸",parallel:"∥",setminus:"∖",sqsubset:"⊏",sqsupset:"⊐",subseteq:"⊆",supseteq:"⊇",textless:"<",thicksim:"∼",triangle:"△",varkappa:"ϰ",varsigma:"ς",vartheta:"ϑ",Diamond:"◇",Uparrow:"⇑",Upsilon:"Υ",backsim:"∽",because:"∵",between:"≬",bigodot:"⨀",bigstar:"★",boxplus:"⊞",ddagger:"‡",diamond:"⋄",digamma:"Ϝ",dotplus:"∔",epsilon:"∊",gtrless:"≷",implies:"⇒",leadsto:"↝",lessdot:"⋖",lessgtr:"≶",lesssim:"≲",lozenge:"◊",natural:"♮",nearrow:"↗",nexists:"∄",nwarrow:"↖",partial:"∂",pilcrow:"¶",precsim:"≾",searrow:"↘",section:"§",succsim:"≿",swarrow:"↙",textbar:"|",uparrow:"↑",upsilon:"υ",Bumpeq:"≎",Lambda:"Λ",Subset:"⋐",Supset:"⋑",Vvdash:"⊪",approx:"≈",bigcap:"⋂",bigcup:"⋃",bigvee:"⋁",bowtie:"⋈",boxdot:"⊡",bullet:"∙",bumpeq:"≏",circeq:"≗",coprod:"∐",dagger:"†",daleth:"ד",degree:"°",eqcirc:"≖",exists:"∃",forall:"∀",gtrdot:"⋗",gtrsim:"≳",hslash:"ℏ",lambda:"λ",lfloor:"⌊",ltimes:"⋉",mapsto:"↦",models:"⊨",ominus:"⊖",oslash:"⊘",otimes:"⊗",preceq:"⪯",propto:"∝",rfloor:"⌋",rtimes:"⋊",square:"□",subset:"⊂",succeq:"⪰",supset:"⊃",varphi:"φ",varrho:"ϱ",veebar:"⊻",Delta:"Δ",Gamma:"Γ",Omega:"Ω",Theta:"Θ",Vdash:"⊩",aleph:"ℵ",Alpha:"Α",alpha:"α",angle:"∠",asymp:"≍",cdots:"⋯",cents:"¢",dashv:"⊣",ddots:"⋱",delta:"δ",doteq:"≐",equiv:"≡",frown:"⌢",gamma:"γ",gimel:"ℷ",infty:"∞",kappa:"κ",Kappa:"Κ",lceil:"⌈",nabla:"∇",notin:"∉",omega:"ω",oplus:"⊕",pound:"£",prime:"′",qquad:"  ",rceil:"⌉",sharp:"♯",sigma:"σ",simeq:"≃",smile:"⌣",space:"␣",sqcap:"⊓",sqcup:"⊔",theta:"θ",times:"×",unlhd:"⊴",unrhd:"⊵",uplus:"⊎",vDash:"⊨",varpi:"ϖ",vdash:"⊢",vdots:"⋮",wedge:"∧",Finv:"Ⅎ",Join:"⋈",atop:"¦",beta:"β",Beta:"Β",beth:"ב",cdot:"⋅",circ:"∘",cong:"≅",dots:"…",euro:"€",flat:"♭",geqq:"≧",hbar:"ℏ",iota:"ι",leqq:"≦",odot:"⊙",oint:"∮",perp:"⊥",prec:"≺",prod:"∏",quad:" ",star:"⋆",succ:"≻",surd:"√",zeta:"ζ",Box:"□",Cap:"⋒",Cup:"⋓",Lsh:"↰",Phi:"Φ",Psi:"Ψ",Rsh:"↱",ast:"∗",bot:"⊥",cap:"∩",chi:"χ",Chi:"Χ",cup:"∪",div:"÷",ell:"ℓ",eta:"η",eth:"ð",geq:"≥",ggg:"⋙",int:"∫",leq:"≤",lhd:"⊲",lll:"⋘",mho:"℧",mid:"∣",neg:"¬",neq:"≠",phi:"ϕ",psi:"ψ",rhd:"⊳",rho:"ρ",Rho:"Ρ",sim:"∼",sum:"∑",tau:"τ",Tau:"Τ",top:"⊤",vee:"∨",Im:"ℑ",Pi:"Π",Re:"ℜ",Xi:"Ξ",ge:"≥",gg:"≫",in:"∈",le:"≤",ll:"≪",mp:"∓",mu:"μ",Mu:"Μ",ni:"∋",nu:"ν",Nu:"Ν",pi:"π",pm:"±",wp:"℘",wr:"≀",xi:"ξ",Omicron:"Ο",omicron:"ο",textdollar:"$",textquotesingle:"'",textbackslash:"\\",textasciigrave:"`",lbrace:"{",vert:"|",rbrace:"}",textasciitilde:"~",textexclamdown:"¡",textcent:"¢",textsterling:"£",textcurrency:"¤",textyen:"¥",textbrokenbar:"¦",textsection:"§",textasciidieresis:"¨",textcopyright:"©",textordfeminine:"ª",guillemotleft:"«",lnot:"¬",textasciimacron:"¯",textdegree:"°",textasciiacute:"´",textparagraph:"¶",textordmasculine:"º",guillemotright:"»",textonequarter:"¼",textonehalf:"½",textthreequarters:"¾",textquestiondown:"¿",AA:"Å",AE:"Æ",DH:"Ð",texttimes:"×",TH:"Þ",ss:"ß",aa:"å",ae:"æ",dh:"ð",th:"þ",DJ:"Đ",dj:"đ",Elzxh:"ħ",i:"ı",NG:"Ŋ",ng:"ŋ",OE:"Œ",oe:"œ",texthvlig:"ƕ",textnrleg:"ƞ",textdoublepipe:"ǂ",Elztrna:"ɐ",Elztrnsa:"ɒ",Elzopeno:"ɔ",Elzrtld:"ɖ",Elzschwa:"ə",Elzpgamma:"ɣ",Elzpbgam:"ɤ",Elztrnh:"ɥ",Elzbtdl:"ɬ",Elzrtll:"ɭ",Elztrnm:"ɯ",Elztrnmlr:"ɰ",Elzltlmr:"ɱ",Elzltln:"ɲ",Elzrtln:"ɳ",Elzclomeg:"ɷ",textphi:"ɸ",Elztrnr:"ɹ",Elztrnrl:"ɺ",Elzrttrnr:"ɻ",Elzrl:"ɼ",Elzrtlr:"ɽ",Elzfhr:"ɾ",Elzrtls:"ʂ",Elzesh:"ʃ",Elztrnt:"ʇ",Elzrtlt:"ʈ",Elzpupsil:"ʊ",Elzpscrv:"ʋ",Elzinvv:"ʌ",Elzinvw:"ʍ",Elztrny:"ʎ",Elzrtlz:"ʐ",Elzyogh:"ʒ",Elzglst:"ʔ",Elzreglst:"ʕ",Elzinglst:"ʖ",textturnk:"ʞ",Elzdyogh:"ʤ",Elztesh:"ʧ",textasciicaron:"ˇ",Elzverts:"ˈ",Elzverti:"ˌ",Elzlmrk:"ː",Elzhlmrk:"ˑ",Elzsbrhr:"˒",Elzsblhr:"˓",Elzrais:"˔",Elzlow:"˕",textasciibreve:"˘",textperiodcentered:"˙",texttildelow:"˜",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Iota:"Ι",Sigma:"Σ",texttheta:"θ",textvartheta:"ϑ",Stigma:"Ϛ",Digamma:"Ϝ",Koppa:"Ϟ",Sampi:"Ϡ",textTheta:"ϴ",textendash:"–",textemdash:"—",Vert:"‖",Elzreapos:"‛",textquotedblleft:"“",textquotedblright:"”",textdagger:"†",textdaggerdbl:"‡",textbullet:"•",ldots:"…",textperthousand:"‰",textpertenthousand:"‱",guilsinglleft:"‹",guilsinglright:"›",nolinebreak:"⁠",Elzxrat:"℞",nleftarrow:"↚",nrightarrow:"↛",arrowwaveleft:"↜",arrowwaveright:"↝",nleftrightarrow:"↮",dblarrowupdown:"⇅",nLeftarrow:"⇍",nLeftrightarrow:"⇎",nRightarrow:"⇏",DownArrowUpArrow:"⇵",rightangle:"∟",nmid:"∤",nparallel:"∦",surfintegral:"∯",volintegral:"∰",clwintegral:"∱",Colon:"∷",homothetic:"∻",lazysinv:"∾",NotEqualTilde:"≂",approxnotequal:"≆",tildetrpl:"≋",allequal:"≌",NotHumpDownHump:"≎",NotHumpEqual:"≏",estimates:"≙",starequal:"≛",lneqq:"≨",lvertneqq:"≨",gneqq:"≩",gvertneqq:"≩",NotLessLess:"≪",NotGreaterGreater:"≫",lessequivlnt:"≲",greaterequivlnt:"≳",notlessgreater:"≸",notgreaterless:"≹",precapprox:"≾",NotPrecedesTilde:"≾",succapprox:"≿",NotSucceedsTilde:"≿",subsetneq:"⊊",varsubsetneqq:"⊊",supsetneq:"⊋",varsupsetneq:"⊋",NotSquareSubset:"⊏",NotSquareSuperset:"⊐",truestate:"⊧",forcesextra:"⊨",VDash:"⊫",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",original:"⊶",image:"⊷",hermitconjmatrix:"⊹",rightanglearc:"⊾",backsimeq:"⋍",verymuchless:"⋘",verymuchgreater:"⋙",Elzsqspne:"⋥",lnsim:"⋦",gnsim:"⋧",precedesnotsimilar:"⋨",succnsim:"⋩",ntriangleleft:"⋪",ntriangleright:"⋫",ntrianglelefteq:"⋬",ntrianglerighteq:"⋭",upslopeellipsis:"⋰",downslopeellipsis:"⋱",perspcorrespond:"⌆",recorder:"⌕",ulcorner:"⌜",urcorner:"⌝",llcorner:"⌞",lrcorner:"⌟",langle:"〈",rangle:"〉",Elzdlcorn:"⎣",lmoustache:"⎰",rmoustache:"⎱",textvisiblespace:"␣",Elzdshfnc:"┆",Elzsqfnw:"┙",diagup:"╱",Elzvrecto:"▯",Elzcirfl:"◐",Elzcirfr:"◑",Elzcirfb:"◒",Elzrvbull:"◘",Elzsqfl:"◧",Elzsqfr:"◨",Elzsqfse:"◪",bigcirc:"◯",rightmoon:"☾",mercury:"☿",venus:"♀",male:"♂",jupiter:"♃",saturn:"♄",uranus:"♅",neptune:"♆",pluto:"♇",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpio:"♏",sagittarius:"♐",capricornus:"♑",aquarius:"♒",pisces:"♓",quarternote:"♩",eighthnote:"♪",UpArrowBar:"⤒",DownArrowBar:"⤓",Elolarr:"⥀",Elorarr:"⥁",ElzRlarr:"⥂",ElzrLarr:"⥄",Elzrarrx:"⥇",LeftRightVector:"⥎",RightUpDownVector:"⥏",DownLeftRightVector:"⥐",LeftUpDownVector:"⥑",LeftVectorBar:"⥒",RightVectorBar:"⥓",RightUpVectorBar:"⥔",RightDownVectorBar:"⥕",DownLeftVectorBar:"⥖",DownRightVectorBar:"⥗",LeftUpVectorBar:"⥘",LeftDownVectorBar:"⥙",LeftTeeVector:"⥚",RightTeeVector:"⥛",RightUpTeeVector:"⥜",RightDownTeeVector:"⥝",DownLeftTeeVector:"⥞",DownRightTeeVector:"⥟",LeftUpTeeVector:"⥠",LeftDownTeeVector:"⥡",UpEquilibrium:"⥮",ReverseUpEquilibrium:"⥯",RoundImplies:"⥰",Elztfnc:"⦀",Elroang:"⦆",Elzddfnc:"⦙",Angle:"⦜",Elzlpargt:"⦠",ElzLap:"⧊",Elzdefas:"⧋",LeftTriangleBar:"⧏",NotLeftTriangleBar:"⧏",RightTriangleBar:"⧐",NotRightTriangleBar:"⧐",RuleDelayed:"⧴",Elxuplus:"⨄",ElzThr:"⨅",Elxsqcup:"⨆",ElzInf:"⨇",ElzSup:"⨈",ElzCint:"⨍",clockoint:"⨏",sqrint:"⨖",ElzTimes:"⨯",amalg:"⨿",ElzAnd:"⩓",ElzOr:"⩔",ElOr:"⩖",Elzminhat:"⩟",Equal:"⩵",nleqslant:"⩽",geqslant:"⩾",ngeqslant:"⩾",lessapprox:"⪅",gtrapprox:"⪆",lneq:"⪇",gneq:"⪈",lnapprox:"⪉",gnapprox:"⪊",lesseqqgtr:"⪋",gtreqqless:"⪌",eqslantless:"⪕",eqslantgtr:"⪖",NestedLessLess:"⪡",NotNestedLessLess:"⪡",NestedGreaterGreater:"⪢",NotNestedGreaterGreater:"⪢",precneqq:"⪵",succneqq:"⪶",precnapprox:"⪹",succnapprox:"⪺",subseteqq:"⫅",nsubseteqq:"⫅",supseteqq:"⫆",subsetneqq:"⫋",supsetneqq:"⫌",Elztdcol:"⫶",openbracketleft:"〚",openbracketright:"〛"},e.isCharacterUnicode=n,e.characterUnicode=function(t){return n(t)?e.characterUnicodeChart[t]:void 0}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.barredLUnicodeChart={l:"ł",L:"Ł"},e.barredLUnicode=function(t){return e.barredLUnicodeChart[t]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.slashed_o="ø",e.slashed_O="Ø",e.slashedOUnicodeChart={o:e.slashed_o,O:e.slashed_O},e.slashedOUnicode=function(t){return e.slashedOUnicodeChart[t]}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyrillicUnicodeChart={CYRF:"Ф",CYRII:"І",CYROMEGA:"Ѡ",CYRG:"Г",cyrkvcrs:"ҝ",cyryo:"ё",CYRH:"Х",CYRZHDSC:"Җ",cyrphk:"ҧ",CYRTDSC:"Ҭ",CYRI:"И",cyryi:"ї",CYRDZHE:"Џ",cyriote:"ѥ",CYRK:"К",CYRSHHA:"Һ",CYRL:"Л",CYRM:"М",CYRCHLDSC:"Ӌ",CYRNJE:"Њ",CYRYAT:"Ѣ",CYRA:"А",CYRB:"Б",cyrchrdsc:"ҷ",cyrschwa:"ә",CYRDZE:"Ѕ",CYRIE:"Є",CYRC:"Ц",CYRZH:"Ж",CYRD:"Д",CYRABHCHDSC:"Ҿ",CYRFITA:"Ѳ",CYRE:"Е",CYRABHHA:"Ҩ",cyrya:"я",cyrdzhe:"џ",CYRIOTLYUS:"Ѩ",cyrsemisftsn:"ҍ",CYRV:"В",cyrishrt:"й",cyrdje:"ђ",cyrchldsc:"ӌ",CYRY:"Ү",cyrndsc:"ң",CYRZ:"З",CYRKHCRS:"Ҟ",CYRNG:"Ҥ",CYRCHRDSC:"Ҷ",CYRYHCRS:"Ұ",CYRSHCH:"Щ",CYRUSHRT:"Ў",cyryu:"ю",cyrksi:"ѯ",CYRN:"Н",CYRO:"О",CYRBYUS:"Ѫ",CYRP:"П",CYRZDSC:"Ҙ",CYRAE:"Ӕ",CYRR:"Р",CYRS:"С",CYRT:"Т",CYRABHCH:"Ҽ",cyruk:"ѹ",CYRU:"У",cyrii:"і",CYRSEMISFTSN:"Ҍ",cyrghcrs:"ғ",CYRISHRT:"Й",cyromegatitlo:"ѽ",cyrkbeak:"ҡ",cyrie:"є",cyrzdsc:"ҙ",CYRNDSC:"Ң",CYRGUP:"Ґ",cyrshch:"щ",CYRKHK:"Ӄ",cyrzh:"ж",CYRJE:"Ј",cyrthousands:"҂",cyrabhch:"ҽ",textnumero:"№",cyrng:"ҥ",CYRPSI:"Ѱ",CYRTETSE:"Ҵ",CYRIOTBYUS:"Ѭ",cyrnje:"њ",CYRIOTE:"Ѥ",cyrdze:"ѕ",cyrae:"ӕ",CYRHRDSN:"Ъ",CYRKOPPA:"Ҁ",CYRRTICK:"Ҏ",CYRSCHWA:"Ә",cyrtdsc:"ҭ",CYRGHK:"Ҕ",cyrabhha:"ҩ",cyrshha:"һ",CYRSH:"Ш",cyru:"у",cyrkhcrs:"ҟ",cyrt:"т",CYRERY:"Ы",cyrs:"с",cyrr:"р",CYROT:"Ѿ",cyrlyus:"ѧ",CYRNHK:"Ӈ",CYRSFTSN:"Ь",cyrghk:"ҕ",cyrp:"п",cyrabhdze:"ӡ",cyro:"о",CYRTSHE:"Ћ",cyrn:"н",CYRSDSC:"Ҫ",cyryhcrs:"ұ",cyrpsi:"ѱ",cyrz:"з",cyry:"ү",cyrje:"ј",cyrv:"в",cyrchvcrs:"ҹ",cyrkhk:"ӄ",cyre:"е",cyromega:"ѡ",cyrd:"д",cyrc:"ц",cyrb:"б",CYROTLD:"Ө",cyrgup:"ґ",CYRLJE:"Љ",cyra:"а",CYROMEGATITLO:"Ѽ",CYRGHCRS:"Ғ",CYRCHVCRS:"Ҹ",cyrm:"м",cyrl:"л",cyrsh:"ш",cyrk:"к",cyri:"и",cyrh:"х",CYRHDSC:"Ҳ",CYRIZH:"Ѵ",CYRABHDZE:"Ӡ",cyrkdsc:"қ",cyrg:"г",CYRCH:"Ч",cyrf:"ф",CYRYI:"Ї",cyrmillions:"҉",CYRKSI:"Ѯ",CYROMEGARND:"Ѻ",cyrot:"ѿ",cyrtetse:"ҵ",cyrhdsc:"ҳ",cyrushrt:"ў",cyriotlyus:"ѩ",CYRYA:"Я",cyrlje:"љ",cyrotld:"ө",CYRKDSC:"Қ",cyrhrdsn:"ъ",cyrrtick:"ҏ",cyrkoppa:"ҁ",CYRDJE:"Ђ",cyriotbyus:"ѭ",cyrhundredthousands:"҈",CYRpalochka:"Ӏ",CYRKVCRS:"Ҝ",cyromegarnd:"ѻ",cyrsftsn:"ь",cyrabhchdsc:"ҿ",cyrzhdsc:"җ",cyrerev:"э",CYRLYUS:"Ѧ",CYRKBEAK:"Ҡ",cyrery:"ы",CYREREV:"Э",cyrnhk:"ӈ",cyrsdsc:"ҫ",cyrch:"ч",cyrtshe:"ћ",CYRPHK:"Ҧ",CYRYO:"Ё",CYRYU:"Ю",CYRUK:"Ѹ"},e.cyrillicUnicode=function(t){return e.cyrillicUnicodeChart[t]}},function(t,e,i){"use strict";function n(t){return e.specialCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.specialCharacters={i:"ı",j:"ȷ",oe:"œ",OE:"Œ",ae:"æ",AE:"Æ",aa:"å",AA:"Å",o:"ø",O:"Ø",ss:"ß",l:"ł",L:"Ł"},e.isSpecialCharacter=n,e.specialCharacter=function(t){return n(t)?e.specialCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t,e){switch(t){case"cyrchar":var i=o.translateCharToCyrillic(e);if(i)return i;break;default:for(var n=0,s=[a.diacriticUnicode,r.formattingUnicode];n<s.length;n++){var l=s[n],c=l(t,e);if(c)return c}}throw new Error("No implementation found to expand \\"+t+" with argument {"+e+"}")}Object.defineProperty(e,"__esModule",{value:!0});var a=i(104),r=i(116),o=i(125);e.expand1argsCommand=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(105),a=i(106),r=i(107),o=i(108),s=i(109),l=i(110),c=i(111),u=i(112),d=i(13),h=i(113),f=i(114),_=i(115);e.barUnderLetter=d.simpleSuffix("̱"),e.dotUnderLetter=d.simpleSuffix("̣"),e.breve=d.simpleSuffix("̆"),e.macrron=d.simpleSuffix("̄"),e.dotOverLetter=d.simpleSuffix("̇"),e.longHungarianUmlaut=d.simpleSuffix("̋"),e.modifiersTextModeUnicodeChart={"`":r.graveAccent,"'":a.acuteAccent,"^":o.circumflex,"~":s.tilde,"=":e.macrron,".":e.dotOverLetter,'"':l.dieresis,H:e.longHungarianUmlaut,c:c.cedilla,k:h.ogonek,b:e.barUnderLetter,d:e.dotUnderLetter,r:n.ringOverLetter,u:e.breve,v:u.caron,t:f.tieLetters},e.modifiersMathModeUnicodeChart={check:u.caron,acute:a.acuteAccent,grave:a.acuteAccent,breve:e.breve,vec:_.vectorArrow,mathring:n.ringOverLetter},e.diacriticUnicode=function(t,i){var n=e.modifiersTextModeUnicodeChart[t];return n||(n=e.modifiersMathModeUnicodeChart[t]),n&&n(i)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.ringOverLetter=n.lookupOrAppend({a:"å",A:"Å",y:"ẙ"},"̊")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.acuteAccent=n.lookupOrAppend({e:"é",y:"ý",u:"ú",i:"í",o:"ó",a:"á",E:"É",Y:"Ý",U:"Ú",I:"Í",O:"Ó",A:"Á",cyrk:"ќ",cyrg:"ѓ",CYRK:"Ќ",CYRG:"Ѓ"},"́")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.graveAccent=n.lookupOrAppend({e:"è",u:"ù",i:"ì",o:"ò",a:"à",E:"È",U:"Ù",I:"Ì",O:"Ò",A:"À"},"̀")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.circumflex=n.lookupOrAppend({e:"ê",u:"û",i:"î",o:"ô",a:"â",E:"Ê",U:"Û",I:"Î",O:"Ô",A:"Â"},"̂")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.tilde=n.lookupOrAppend({o:"õ",a:"ã",n:"ñ",O:"Õ",A:"Ã",N:"Ñ"},"̃")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.dieresis=n.lookupOrAppend({e:"ë",y:"ÿ",u:"ü",i:"ï",o:"ö",a:"ä",E:"Ë",Y:"Ÿ",U:"Ü",I:"Ï",O:"Ö",A:"Ä"},"̈")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.cedilla=n.lookupOrAppend({c:"ç"},"̧")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.caron=n.lookupOrAppend({s:"š"},"̌")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(13);e.ogonek=n.simpleSuffix("̨")},function(t,e,i){"use strict";function n(t){return a(t.charAt(0),t.substring(1))}function a(t,e){return t+"͡"+e}function r(t){return"t"===t}Object.defineProperty(e,"__esModule",{value:!0}),e.tieLetters=n,e.tie2Letters=a,e.isTieLetters=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(11);e.vectorArrow=n.lookupOrAppend({},"⃗")},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(117),a=i(118),r=i(119),o=i(120),s=i(121),l=i(122),c=i(49),u=i(123),d=i(50),h=i(124);e.formattingUnicode=function(t,e){var i=void 0;if(c.isBbCmd(t)?i=n.translateCharToBlackboard:c.isBfCmd(t)?i=a.translateCharToBold:c.isFrakCmd(t)?i=r.translateCharToFraktur:c.isItCmd(t)?i=o.translateCharToItalic:c.isTtCmd(t)?i=s.translateCharToMonospace:c.isCalCmd(t)?i=l.translateCharToCalligraphic:c.isSubCmd(t)?i=u.translateCharToSubscript:c.isSupCmd(t)?i=d.translateCharToSuperscript:c.isMonoCmd(t)&&(i=h.translateCharToMono),i){var f=i;return e.split("").map(function(t){return f(t)||t}).join("")}}},function(t,e,i){"use strict";function n(t){return e.blackboardCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.blackboardCharacters={A:"𝔸",B:"𝔹",C:"ℂ",D:"𝔻",E:"𝔼",F:"𝔽",G:"𝔾",H:"ℍ",I:"𝕀",J:"𝕁",K:"𝕂",L:"𝕃",M:"𝕄",N:"ℕ",O:"𝕆",P:"ℙ",Q:"ℚ",R:"ℝ",S:"𝕊",T:"𝕋",U:"𝕌",V:"𝕍",W:"𝕎",X:"𝕏",Y:"𝕐",Z:"ℤ",a:"𝕒",b:"𝕓",c:"𝕔",d:"𝕕",e:"𝕖",f:"𝕗",g:"𝕘",h:"𝕙",i:"𝕚",j:"𝕛",k:"𝕜",l:"𝕝",m:"𝕞",n:"𝕟",o:"𝕠",p:"𝕡",q:"𝕢",r:"𝕣",s:"𝕤",t:"𝕥",u:"𝕦",v:"𝕧",w:"𝕨",x:"𝕩",y:"𝕪",z:"𝕫",0:"𝟘",1:"𝟙",2:"𝟚",3:"𝟛",4:"𝟜",5:"𝟝",6:"𝟞",7:"𝟟",8:"𝟠",9:"𝟡"},e.isBlackboardCharacter=n,e.translateCharToBlackboard=function(t){return n(t)?e.blackboardCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.boldCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.boldCharacters={A:"𝐀",B:"𝐁",C:"𝐂",D:"𝐃",E:"𝐄",F:"𝐅",G:"𝐆",H:"𝐇",I:"𝐈",J:"𝐉",K:"𝐊",L:"𝐋",M:"𝐌",N:"𝐍",O:"𝐎",P:"𝐏",Q:"𝐐",R:"𝐑",S:"𝐒",T:"𝐓",U:"𝐔",V:"𝐕",W:"𝐖",X:"𝐗",Y:"𝐘",Z:"𝐙",a:"𝐚",b:"𝐛",c:"𝐜",d:"𝐝",e:"𝐞",f:"𝐟",g:"𝐠",h:"𝐡",i:"𝐢",j:"𝐣",k:"𝐤",l:"𝐥",m:"𝐦",n:"𝐧",o:"𝐨",p:"𝐩",q:"𝐪",r:"𝐫",s:"𝐬",t:"𝐭",u:"𝐮",v:"𝐯",w:"𝐰",x:"𝐱",y:"𝐲",z:"𝐳","Α":"𝚨","Β":"𝚩","Γ":"𝚪","Δ":"𝚫","Ε":"𝚬","Ζ":"𝚭","Η":"𝚮","Θ":"𝚯","Ι":"𝚰","Κ":"𝚱","Λ":"𝚲","Μ":"𝚳","Ν":"𝚴","Ξ":"𝚵","Ο":"𝚶","Π":"𝚷","Ρ":"𝚸","ϴ":"𝚹","Σ":"𝚺","Τ":"𝚻","Υ":"𝚼","Φ":"𝚽","Χ":"𝚾","Ψ":"𝚿","Ω":"𝛀","∇":"𝛁","α":"𝛂","β":"𝛃","γ":"𝛄","δ":"𝛅","ε":"𝛆","ζ":"𝛇","η":"𝛈","θ":"𝛉","ι":"𝛊","κ":"𝛋","λ":"𝛌","μ":"𝛍","ν":"𝛎","ξ":"𝛏","ο":"𝛐","π":"𝛑","ρ":"𝛒","ς":"𝛓","σ":"𝛔","τ":"𝛕","υ":"𝛖","φ":"𝛗","χ":"𝛘","ψ":"𝛙","ω":"𝛚","∂":"𝛛","ϵ":"𝛜","ϑ":"𝛝","ϰ":"𝛞","ϕ":"𝛟","ϱ":"𝛠","ϖ":"𝛡",0:"𝟎",1:"𝟏",2:"𝟐",3:"𝟑",4:"𝟒",5:"𝟓",6:"𝟔",7:"𝟕",8:"𝟖",9:"𝟗"},e.isBlackboardCharacter=n,e.translateCharToBold=function(t){return n(t)?e.boldCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.frakturCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.frakturCharacters={A:"𝔄",B:"𝔅",C:"ℭ",D:"𝔇",E:"𝔈",F:"𝔉",G:"𝔊",H:"ℌ",I:"ℑ",J:"𝔍",K:"𝔎",L:"𝔏",M:"𝔐",N:"𝔑",O:"𝔒",P:"𝔓",Q:"𝔔",R:"ℜ",S:"𝔖",T:"𝔗",U:"𝔘",V:"𝔙",W:"𝔚",X:"𝔛",Y:"𝔜",Z:"ℨ",a:"𝔞",b:"𝔟",c:"𝔠",d:"𝔡",e:"𝔢",f:"𝔣",g:"𝔤",h:"𝔥",i:"𝔦",j:"𝔧",k:"𝔨",l:"𝔩",m:"𝔪",n:"𝔫",o:"𝔬",p:"𝔭",q:"𝔮",r:"𝔯",s:"𝔰",t:"𝔱",u:"𝔲",v:"𝔳",w:"𝔴",x:"𝔵",y:"𝔶",z:"𝔷"},e.isFrakturCharacter=n,e.translateCharToFraktur=function(t){return n(t)?e.frakturCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.italicCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.italicCharacters={A:"𝐴",B:"𝐵",C:"𝐶",D:"𝐷",E:"𝐸",F:"𝐹",G:"𝐺",H:"𝐻",I:"𝐼",J:"𝐽",K:"𝐾",L:"𝐿",M:"𝑀",N:"𝑁",O:"𝑂",P:"𝑃",Q:"𝑄",R:"𝑅",S:"𝑆",T:"𝑇",U:"𝑈",V:"𝑉",W:"𝑊",X:"𝑋",Y:"𝑌",Z:"𝑍",a:"𝑎",b:"𝑏",c:"𝑐",d:"𝑑",e:"𝑒",f:"𝑓",g:"𝑔",h:"ℎ",i:"𝑖",j:"𝑗",k:"𝑘",l:"𝑙",m:"𝑚",n:"𝑛",o:"𝑜",p:"𝑝",q:"𝑞",r:"𝑟",s:"𝑠",t:"𝑡",u:"𝑢",v:"𝑣",w:"𝑤",x:"𝑥",y:"𝑦",z:"𝑧","Α":"𝛢","Β":"𝛣","Γ":"𝛤","Δ":"𝛥","Ε":"𝛦","Ζ":"𝛧","Η":"𝛨","Θ":"𝛩","Ι":"𝛪","Κ":"𝛫","Λ":"𝛬","Μ":"𝛭","Ν":"𝛮","Ξ":"𝛯","Ο":"𝛰","Π":"𝛱","Ρ":"𝛲","ϴ":"𝛳","Σ":"𝛴","Τ":"𝛵","Υ":"𝛶","Φ":"𝛷","Χ":"𝛸","Ψ":"𝛹","Ω":"𝛺","∇":"𝛻","α":"𝛼","β":"𝛽","γ":"𝛾","δ":"𝛿","ε":"𝜀","ζ":"𝜁","η":"𝜂","θ":"𝜃","ι":"𝜄","κ":"𝜅","λ":"𝜆","μ":"𝜇","ν":"𝜈","ξ":"𝜉","ο":"𝜊","π":"𝜋","ρ":"𝜌","ς":"𝜍","σ":"𝜎","τ":"𝜏","υ":"𝜐","φ":"𝜑","χ":"𝜒","ψ":"𝜓","ω":"𝜔","∂":"𝜕","ϵ":"𝜖","ϑ":"𝜗","ϰ":"𝜘","ϕ":"𝜙","ϱ":"𝜚","ϖ":"𝜛"},e.isItalicCharacter=n,e.translateCharToItalic=function(t){return n(t)?e.italicCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.monospaceCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.monospaceCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},e.isMonospaceCharacter=n,e.translateCharToMonospace=function(t){return n(t)?e.monospaceCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.calligraphicLetters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.calligraphicLetters={A:"𝓐",B:"𝓑",C:"𝓒",D:"𝓓",E:"𝓔",F:"𝓕",G:"𝓖",H:"𝓗",I:"𝓘",J:"𝓙",K:"𝓚",L:"𝓛",M:"𝓜",N:"𝓝",O:"𝓞",P:"𝓟",Q:"𝓠",R:"𝓡",S:"𝓢",T:"𝓣",U:"𝓤",V:"𝓥",W:"𝓦",X:"𝓧",Y:"𝓨",Z:"𝓩",a:"𝓪",b:"𝓫",c:"𝓬",d:"𝓭",e:"𝓮",f:"𝓯",g:"𝓰",h:"𝓱",i:"𝓲",j:"𝓳",k:"𝓴",l:"𝓵",m:"𝓶",n:"𝓷",o:"𝓸",p:"𝓹",q:"𝓺",r:"𝓻",s:"𝓼",t:"𝓽",u:"𝓾",v:"𝓿",w:"𝔀",x:"𝔁",y:"𝔂",z:"𝔃"},e.isCalligraphicLetter=n,e.translateCharToCalligraphic=function(t){return n(t)?e.calligraphicLetters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.subscriptCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.subscriptCharacters={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ","β":"ᵦ","γ":"ᵧ","ρ":"ᵨ","φ":"ᵩ","χ":"ᵪ"},e.isSubscriptCharacter=n,e.translateCharToSubscript=function(t){return n(t)?e.subscriptCharacters[t]:void 0}},function(t,e,i){"use strict";function n(t){return e.monoCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.monoCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},e.isMonoCharacter=n,e.translateCharToMono=function(t){return n(t)?e.monoCharacters[t]:void 0}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyrillicCharacters={"Ф":"Ф","І":"І","Ѡ":"Ѡ","Г":"Г","ҝ":"ҝ","ё":"ё","Х":"Х","Җ":"Җ","ҧ":"ҧ","Ҭ":"Ҭ","И":"И","ї":"ї","Џ":"Џ","ѥ":"ѥ","К":"К","Һ":"Һ","Л":"Л","М":"М","Ӌ":"Ӌ","Њ":"Њ","Ѣ":"Ѣ","А":"А","Б":"Б","ҷ":"ҷ","ә":"ә","Ѕ":"Ѕ","Є":"Є","Ц":"Ц","Ж":"Ж","Д":"Д","Ҿ":"Ҿ","Ѳ":"Ѳ","Е":"Е","Ҩ":"Ҩ","я":"я","џ":"џ","Ѩ":"Ѩ","ҍ":"ҍ","В":"В","й":"й","ђ":"ђ","ӌ":"ӌ","Ү":"Ү","ң":"ң","З":"З","Ҟ":"Ҟ","Ҥ":"Ҥ","Ҷ":"Ҷ","Ұ":"Ұ","Щ":"Щ","Ў":"Ў","ю":"ю","ѯ":"ѯ","Н":"Н","О":"О","Ѫ":"Ѫ","П":"П","Ҙ":"Ҙ","Ӕ":"Ӕ","Р":"Р","С":"С","Т":"Т","Ҽ":"Ҽ","ѹ":"ѹ","У":"У","і":"і","Ҍ":"Ҍ","ғ":"ғ","Й":"Й","ѽ":"ѽ","ҡ":"ҡ","є":"є","ҙ":"ҙ","Ң":"Ң","Ґ":"Ґ","щ":"щ","Ӄ":"Ӄ","ж":"ж","Ј":"Ј","҂":"҂","ҽ":"ҽ","№":"№","ҥ":"ҥ","Ѱ":"Ѱ","Ҵ":"Ҵ","Ѭ":"Ѭ","њ":"њ","Ѥ":"Ѥ","ѕ":"ѕ","ӕ":"ӕ","Ъ":"Ъ","Ҁ":"Ҁ","Ҏ":"Ҏ","Ә":"Ә","ҭ":"ҭ","Ҕ":"Ҕ","ҩ":"ҩ","һ":"һ","Ш":"Ш","у":"у","ҟ":"ҟ","т":"т","Ы":"Ы","с":"с","р":"р","Ѿ":"Ѿ","ѧ":"ѧ","Ӈ":"Ӈ","Ь":"Ь","ҕ":"ҕ","п":"п","ӡ":"ӡ","о":"о","Ћ":"Ћ","н":"н","Ҫ":"Ҫ","ұ":"ұ","ѱ":"ѱ","з":"з","ү":"ү","̏":"̏","ј":"ј","в":"в","ҹ":"ҹ","ӄ":"ӄ","е":"е","ѡ":"ѡ","д":"д","ц":"ц","б":"б","Ө":"Ө","ґ":"ґ","Љ":"Љ","а":"а","Ѽ":"Ѽ","Ғ":"Ғ","Ҹ":"Ҹ","м":"м","л":"л","ш":"ш","к":"к","и":"и","х":"х","Ҳ":"Ҳ","Ѵ":"Ѵ","Ӡ":"Ӡ","қ":"қ","г":"г","Ч":"Ч","ф":"ф","Ї":"Ї","҉":"҉","Ѯ":"Ѯ","Ѻ":"Ѻ","ѿ":"ѿ","ҵ":"ҵ","ҳ":"ҳ","ў":"ў","ѩ":"ѩ","Я":"Я","љ":"љ","ө":"ө","Қ":"Қ","ъ":"ъ","ҏ":"ҏ","ҁ":"ҁ","Ђ":"Ђ","ѭ":"ѭ","҈":"҈","Ӏ":"Ӏ","Ҝ":"Ҝ","ѻ":"ѻ","ь":"ь","ҿ":"ҿ","җ":"җ","э":"э","Ѧ":"Ѧ","Ҡ":"Ҡ","ы":"ы","Э":"Э","ӈ":"ӈ","ҫ":"ҫ","ч":"ч","ћ":"ћ","Ҧ":"Ҧ","Ё":"Ё","Ю":"Ю","Ѹ":"Ѹ","ќ":"ќ","ѓ":"ѓ","Ќ":"Ќ","Ѓ":"Ѓ"},e.isCyrillicCharacter=function(t){return e.cyrillicCharacters.hasOwnProperty(t)},e.translateCharToCyrillic=function(t){return e.isCyrillicCharacter(t)?e.cyrillicCharacters[t]:void 0}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.spaceCmds1arg={kern:!0,hskip:!0,hspace:!0,hphantom:!0}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diacriticsTextMode={"`":!0,"'":!0,"^":!0,"~":!0,"=":!0,".":!0,'"':!0,H:!0,c:!0,k:!0,b:!0,d:!0,r:!0,u:!0,v:!0},e.diacriticsMathMode={hat:!0,widehat:!0,check:!0,tilde:!0,widetilde:!0,acute:!0,grave:!0,dot:!0,ddot:!0,breve:!0,bar:!0,vec:!0,mathring:!0}},function(t,e,i){"use strict";function n(t){var e=t?t.trim():void 0;if(!e)return"√";switch(e){case"2":return"√";case"3":return"∛";case"4":return"∜";default:for(var i=[],n=0;n<e.length;n++){var a=r.translateCharToSuperscript(e.charAt(n));if(!a)throw new Error('Could not translate "'+a+'" to superscript');i.push(a)}return i.join("")+"√"}}function a(t,e){var i=n(e),a=t.trim();return""===a?i:i+"("+a+")"}Object.defineProperty(e,"__esModule",{value:!0});var r=i(50);e.convertSqrtToUnicode=a},function(t,e,i){"use strict";function n(t,e,i){switch(t){case"frac":case"nfrac":case"cfrac":case"xfrac":case"sfrac":return a.convertFracToUnicode(e,i);case"binom":return r.convertBinom(e,i)}throw new Error("No implementation found to expand \\"+t+" with arguments {"+e+", "+i)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(130),r=i(131);e.expand2argsCommand=n},function(t,e,i){"use strict";function n(t,e){return"1"===t&&"2"===e?"½":"1"===t&&"3"===e?"⅓":"1"===t&&"4"===e?"¼":"1"===t&&"5"===e?"⅕":"1"===t&&"6"===e?"⅙":"1"===t&&"8"===e?"⅛":"2"===t&&"3"===e?"⅔":"2"===t&&"5"===e?"⅖":"3"===t&&"4"===e?"¾":"3"===t&&"5"===e?"⅗":"3"===t&&"8"===e?"⅜":"4"===t&&"5"===e?"⅘":"5"===t&&"6"===e?"⅚":"5"===t&&"8"===e?"⅝":"7"===t&&"8"===e?"⅞":o.test(t)&&o.test(e)?r+t+"⁄"+e+r:(t=a.isSingleTerm.test(t)?t:a.addParenthesis(t),e=a.isSingleTerm.test(e)?e:a.addParenthesis(e),"("+t+" / "+e+")")}Object.defineProperty(e,"__esModule",{value:!0});var a=i(13),r="‌",o=/^[0-9]*$/;e.convertFracToUnicode=n},function(t,e,i){"use strict";function n(t,e){return t=r.test(t)?t:a.addParenthesis(t),e=r.test(e)?e:a.addParenthesis(e),"("+t+" ¦ "+e+")"}Object.defineProperty(e,"__esModule",{value:!0});var a=i(13),r=/^.$|^[0-9]+$/;e.convertBinom=n},function(t,e,i){"use strict";function n(t){return e.twoArgsCommands.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=i(133);e.twoArgsCommands=Object.assign({},a.fracCmds,{binom:!0}),e.is2argsCommand=n},function(t,e,i){"use strict";function n(t){return e.fracCmds.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.fracCmds={frac:!0,nfrac:!0,cfrac:!0,xfrac:!0,sfrac:!0},e.isFracCmd=n},function(t,e,i){"use strict";function n(t){return{name:t,optionalArguments:0,argumentCount:0}}Object.defineProperty(e,"__esModule",{value:!0}),e.createKnownCommand=n},function(t,e,i){"use strict";function n(t){return{name:t,optionalArguments:0,argumentCount:1}}Object.defineProperty(e,"__esModule",{value:!0}),e.createKnownCommandWith1Arg=n},function(t,e,i){"use strict";i.d(e,"a",function(){return n}),i.d(e,"b",function(){return a});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"toolForm"},[i("div",{staticClass:"toolFormTitle"},[t._v("\n        Citations\n        "),t.viewRender?i("button",{staticClass:"btn btn-sm btn-secondary citations-to-bibtex",attrs:{type:"button",title:"Show all in BibTeX format."},on:{click:t.toggleViewRender}},[i("i",{staticClass:"fa fa-pencil-square-o"}),t._v("\n            Show BibTeX\n        ")]):i("button",{staticClass:"btn btn-sm btn-secondary citations-to-formatted",attrs:{type:"button",title:"Return to formatted citation list."},on:{click:t.toggleViewRender}},[i("i",{staticClass:"fa fa-times"}),t._v("\n            Hide BibTeX\n        ")])]),t._v(" "),i("div",{staticClass:"citations-bibtex toolFormBody citation-padding"},["histories"===t.source?i("div",{staticClass:"infomessage"},[t._v("\n            When writing up your analysis, remember to include all references that should be cited in order\n            to completely describe your work. Also, please remember to "),i("a",{attrs:{href:"https://galaxyproject.org/citing-galaxy"}},[t._v("cite Galaxy")]),t._v(".\n        ")]):t._e(),t._v(" "),t.viewRender?i("span",{staticClass:"citations-formatted"},[i("p",{domProps:{innerHTML:t._s(t.formattedReferences)}})]):i("textarea",{staticClass:"citations-bibtex-text"},[t._v("            "+t._s(t.content)+"\n        ")])])])},a=[]},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=i(15),a=function(t){return t&&t.__esModule?t:{default:t}}(n),r=i(138),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(r),s=a.default.GenomeDataManager.extend({load_data:function(e,i,n,a){var r=t.Deferred();this.set_data(e,r);var s=Galaxy.root+"datasets/"+this.get("dataset").id+"/display",l=this;new t.Deferred;return t.when(o.makeBwg(s)).then(function(i,n){t.when(i.readWigData(e.get("chrom"),e.get("start"),e.get("end"))).then(function(t){var i=[],n={max:Number.MIN_VALUE};t.forEach(function(t){n.max!==t.min-1&&(i.push([n.max+1,0]),i.push([t.min-2,0])),i.push([t.min-1,t.score]),i.push([t.max,t.score]),n=t});var a={data:i,region:e,dataset_type:"bigwig"};l.set_data(e,a),r.resolve(a)})}),r}});e.default={BBIDataManager:s}}).call(e,i(0))},function(t,e,i){(function(n){var a,r;a=[i(139),i(140),i(141)],void 0!==(r=function(t,e){"use strict";function i(){}function a(t){t&&(this.id=t)}function r(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function o(t,e,i){Math.pow(10,6);return n.ajax({type:"GET",dataType:"native",url:t,timeout:5e3,beforeSend:function(t){t.setRequestHeader("Range","bytes="+e+"-"+(e+(i-1)))},xhrFields:{responseType:"arraybuffer"}})}function s(t,e){return t[e]+t[e+1]*b+t[e+2]*x+t[e+3]*k+t[e+4]*C}function l(){}function c(t,e,i,n){this.bwg=t,this.cirTreeOffset=e,this.cirTreeLength=i,this.isSummary=n}function u(t){var e=n.Deferred(),i=new l;return i.url=t,n.when(o(i.url,0,512)).then(function(t){if(!t)return e.resolve(null,"Couldn't fetch file");var a=t,r=new Uint8Array(a),o=new Int16Array(a),l=new Int32Array(a),c=r[0]+b*r[1]+x*r[2]+k*r[3];if(c==m)i.type="bigwig";else{if(c!=w)return c==g||c==y?e.resolve(null,"Currently don't support big-endian BBI files"):e.resolve(null,"Not a supported format, magic=0x"+c.toString(16));i.type="bigbed"}i.version=o[2],i.numZoomLevels=o[3],i.chromTreeOffset=s(r,8),i.unzoomedDataOffset=s(r,16),i.unzoomedIndexOffset=s(r,24),i.fieldCount=o[16],i.definedFieldCount=o[17],i.asOffset=s(r,36),i.totalSummaryOffset=s(r,44),i.uncompressBufSize=l[13],i.extHeaderOffset=s(r,56),i.zoomLevels=[];for(var u=0;u<i.numZoomLevels;++u){var d=l[6*u+16],h=s(r,24*u+72),f=s(r,24*u+80);i.zoomLevels.push({reduction:d,dataOffset:h,indexOffset:f})}n.when(i.readChromTree()).then(function(){i.getAutoSQL(function(t){return i.schema=t,e.resolve(i)})})}),e}function d(t,e,i,n,a){this.bbi=t,this.type=e,this.fieldCount=i,this.offset=n,this.field=a}var h=t.Range,f=t.union,_=t.intersection,p=e.inflateBuffer,v=e.arrayCopy,m=2291137574,g=654086024,w=2273964779,y=3958540679,b=256,x=65536,k=16777216,C=4294967296,T=new RegExp("^[0-9]+,[0-9]+,[0-9]+");return l.prototype.readChromTree=function(){var t=this;this.chromsToIDs={},this.idsToChroms={},this.maxID=0;var e=this.unzoomedDataOffset;return e=e+4-(e-this.chromTreeOffset&3),n.when(o(this.url,this.chromTreeOffset,e-this.chromTreeOffset)).then(function(e){var i=new Uint8Array(e),n=new Int16Array(e),a=new Int32Array(e),r=(a[0],a[1],a[2]),o=(a[3],s(i,16),function(e){var a=i[e],l=n[e/2+1];e+=4;for(var c=0;c<l;++c)if(0===a){e+=r;var u=s(i,e);e+=8,u-=t.chromTreeOffset,o(u)}else{for(var d="",h=0;h<r;++h){var f=i[e++];0!==f&&(d+=String.fromCharCode(f))}var _=i[e+3]<<24|i[e+2]<<16|i[e+1]<<8|i[e+0];i[e+7],i[e+6],i[e+5],i[e+4],e+=8,t.chromsToIDs[d]=_,0===d.indexOf("chr")&&(t.chromsToIDs[d.substr(3)]=_),t.idsToChroms[_]=d,t.maxID=Math.max(t.maxID,_)}});o(32)})},c.prototype.readWigData=function(t,e,i){var n=this.bwg.chromsToIDs[t];return void 0===n?[]:this.readWigDataById(n,e,i)},c.prototype.readWigDataById=function(t,e,i){var a=this,r=n.Deferred();if(!this.cirHeader)return n.when(o(a.bwg.url,this.cirTreeOffset,48)).then(function(o){a.cirHeader=o;var s=new Int32Array(a.cirHeader);a.cirBlockSize=s[1],n.when(a.readWigDataById(t,e,i)).then(function(t){r.resolve(t)})}),r;var l=[],c=0,u=(Date.now(),function(n,a,r,o){return(t<0||n==t)&&a<=i&&r>=e}),d=function(t,e){if(a.bwg.instrument&&console.log("level="+e+"; offset="+t+"; time="+(0|Date.now())),c+=t.length,1==t.length&&t[0]-a.cirTreeOffset==48&&a.cachedCirRoot)return p(a.cachedCirRoot,0,e),void(0===--c&&n.when(a.fetchFeatures(u,l)).then(function(t){r.resolve(t)}));for(var i,o=4+32*a.cirBlockSize,s=0;s<t.length;++s){var d=new h(t[s],t[s]+o);i=i?f(i,d):d}for(var v=i.ranges(),m=0;m<v.length;++m){var g=v[m];_(t,g,e)}},_=function(t,e,i,s){e.max(),e.min();n.when(o(a.bwg.url,e.min(),e.max()-e.min())).then(function(o){for(var s=0;s<t.length;++s)e.contains(t[s])&&(p(o,t[s]-e.min(),i),t[s]-a.cirTreeOffset==48&&t[s]-e.min()==0&&(a.cachedCirRoot=o),0===--c&&n.when(a.fetchFeatures(u,l)).then(function(t){r.resolve(t)}))})},p=function(n,a,r){var o=new Uint8Array(n),c=new Int16Array(n),u=new Int32Array(n),h=o[a],f=c[a/2+1];if(a+=4,0!==h)for(var _=0;_<f;++_){var p=a/4,v=u[p],m=u[p+1],g=u[p+2],w=u[p+3],y=s(o,a+16),b=s(o,a+24);(t<0||v<t||v==t&&m<=i)&&(t<0||g>t||g==t&&w>=e)&&l.push({offset:y,size:b}),a+=32}else{for(var x=[],_=0;_<f;++_){var p=a/4,v=u[p],m=u[p+1],g=u[p+2],w=u[p+3],y=s(o,a+16);(t<0||v<t||v==t&&m<=i)&&(t<0||g>t||g==t&&w>=e)&&x.push(y),a+=24}x.length>0&&d(x,r+1)}};return d([a.cirTreeOffset+48],1),r},c.prototype.fetchFeatures=function(t,e){var a=this,r=n.Deferred();if(e.sort(function(t,e){return(0|t.offset)-(0|e.offset)}),0===e.length)return[];var s=[],l=function(t,e,n,r){r||(r={});var o=new i;o._chromId=t,o.segment=a.bwg.idsToChroms[t],o.min=e,o.max=n,o.type=a.bwg.type;for(var l in r)o[l]=r[l];s.push(o)},c=function(){if(0===e.length){Date.now();return r.resolve(s)}var i=e[0];if(i.data)a.parseFeatures(i.data,l,t),e.splice(0,1),c();else{for(var u=i.offset,d=i.size,h=1;h<e.length&&e[h].offset==u+d;)d+=e[h].size,++h;n.when(o(a.bwg.url,u,d)).then(function(t){for(var i=0,n=0;i<d;){var r,o=e[n];if(a.bwg.uncompressBufSize>0)r=p(t,i+2,o.size-2);else{var s=new Uint8Array(o.size);v(new Uint8Array(t,i,o.size),0,s,0,o.size),r=s.buffer}o.data=r,i+=o.size,++n}c()})}};return c(),r},c.prototype.parseFeatures=function(t,e,i){var r=new Uint8Array(t);if(this.isSummary)for(var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),c=t.byteLength/32,u=0;u<c;++u){var d=s[8*u],p=s[8*u+1],v=s[8*u+2],m=s[8*u+3],g=(l[8*u+4],l[8*u+5]),w=l[8*u+6];l[8*u+7];if(i(d,p+1,v)){var y={type:"bigwig",score:w/m,maxScore:g};"bigbed"==this.bwg.type&&(y.type="density"),e(d,p+1,v,y)}}else if("bigwig"==this.bwg.type){var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),d=s[0],b=s[1],x=(s[2],s[3]),k=s[4],C=r[20],c=o[11];if(3==C)for(var u=0;u<c;++u){var S=l[u+6],M=b+u*x+1,O=b+u*x+k;i(d,M,O)&&e(d,M,O,{score:S})}else if(2==C)for(var u=0;u<c;++u){var p=s[2*u+6]+1,v=p+k-1,S=l[2*u+7];i(d,p,v)&&e(d,p,v,{score:S})}else if(1==C)for(var u=0;u<c;++u){var p=s[3*u+6]+1,v=s[3*u+7],S=l[3*u+8];p>v&&(p=v),i(d,p,v)&&e(d,p,v,{score:S})}else console.log("Currently not handling bwgType="+C)}else{if("bigbed"!=this.bwg.type)throw Error("Don't know what to do with "+this.bwg.type);for(var z=0,A=this.bwg.definedFieldCount,P=this.bwg.schema;z<r.length;){var d=r[z+3]<<24|r[z+2]<<16|r[z+1]<<8|r[z+0],p=r[z+7]<<24|r[z+6]<<16|r[z+5]<<8|r[z+4],v=r[z+11]<<24|r[z+10]<<16|r[z+9]<<8|r[z+8];z+=12;for(var R="";;){var E=r[z++];if(0==E)break;R+=String.fromCharCode(E)}var j,q={};if(j=R.length>0?R.split("\t"):[],j.length>0&&A>3&&(q.label=j[0]),j.length>1&&A>4){var S=parseInt(j[1]);isNaN(S)||(q.score=S)}if(j.length>2&&A>5&&(q.orientation=j[2]),j.length>5&&A>8){var $=j[5];T.test($)&&(q.itemRgb="rgb("+$+")")}if(j.length>A-3&&P)for(var L=A-3;L<j.length;++L)q[P.fields[L+3].name]=j[L];if(i(d,p+1,v,j))if(A<12)e(d,p+1,v,q);else{var I=0|j[3],D=0|j[4],N=0|j[6],G=j[7].split(","),B=j[8].split(",");if(q.exonFrames){var U=q.exonFrames.split(",");q.exonFrames=void 0}q.type="transcript";var F=new a;for(var V in q)F[V]=q[V];if(F.id=j[0],F.segment=this.bwg.idsToChroms[d],F.min=p+1,F.max=v,F.notes=[],q.groups=[F],j.length>9){var H=q.geneName||j[9],Y=H;j.length>10&&(Y=j[10]),q.geneName2&&(Y=q.geneName2);var X=n.extend({},F);X.id=H,X.label=Y,X.type="gene",q.groups.push(X)}for(var J=[],W=0;W<N;++W){var K=(0|B[W])+p,Z=K+(0|G[W]),Q=new h(K,Z);J.push(Q)}for(var tt=f(J),et=tt.ranges(),it=0;it<et.length;++it){var nt=et[it];e(d,nt.min()+1,nt.max(),q)}if(D>I){var at="+"==q.orientation?new h(I,D+3):new h(I-3,D),rt=_(tt,at);if(rt){q.type="translation";for(var ot=rt.ranges(),st=0,lt=0;ot[0].min()>et[lt].max();)lt++;for(var it=0;it<ot.length;++it){var ct=it;"-"==q.orientation&&(ct=ot.length-it-1);var nt=ot[ct];if(q.readframe=st,U){var ut=parseInt(U[ct+lt]);"number"==typeof ut&&ut>=0&&ut<=2&&(q.readframe=ut,q.readframeExplicit=!0)}var dt=nt.max()-nt.min();st=(st+dt)%3,e(d,nt.min()+1,nt.max(),q)}}}}}}},c.prototype.getFirstAdjacent=function(t,e,i,n){var a=this.bwg.chromsToIDs[t];if(void 0===a)return n([]);this.getFirstAdjacentById(a,e,i,n)},c.prototype.getFirstAdjacentById=function(t,e,i,n){var a=this;if(!this.cirHeader)return void this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(r){a.cirHeader=r;var o=new Int32Array(a.cirHeader);a.cirBlockSize=o[1],a.getFirstAdjacentById(t,e,i,n)});var r=null,o=-1,l=-1,c=0,u=(Date.now(),function(t,e){c+=t.length;for(var i,n=4+32*a.cirBlockSize,r=0;r<t.length;++r){var o=new h(t[r],t[r]+n);i=i?f(i,o):o}for(var s=i.ranges(),l=0;l<s.length;++l){var u=s[l];d(t,u,e)}}),d=function(o,s,l,u){s.max(),s.min();a.bwg.data.slice(s.min(),s.max()-s.min()).fetch(function(u){for(var d=0;d<o.length;++d)if(s.contains(o[d])&&(_(u,o[d]-s.min(),l),0==--c)){if(!r)return i>0&&(0!=t||e>0)?a.getFirstAdjacentById(0,0,i,n):i<0&&(t!=a.bwg.maxID||e<1e9)?a.getFirstAdjacentById(a.bwg.maxID,1e9,i,n):n([]);a.fetchFeatures(function(n,a,r,o){return i<0&&(n<t||r<e)||i>0&&(n>t||a>e)},[r],function(t){for(var e=null,a=-1,r=-1,o=0;o<t.length;++o){var s=t[o],l=s._chromId,c=s.min,u=s.max;(null==e||i<0&&(l>a||u>r)||i>0&&(l<a||c<r))&&(e=s,r=i<0?u:c,a=l)}return n(null!=e?[e]:[])})}})},_=function(n,c,d){var h=new Uint8Array(n),f=new Int16Array(n),_=new Int32Array(n),p=h[c],v=f[c/2+1];if(c+=4,0!=p)for(var m=0;m<v;++m){var g=c/4,w=_[g],y=_[g+1],b=_[g+2],x=_[g+3],k=s(h,c+16),C=s(h,c+24);(i<0&&(w<t||w==t&&y<=e)||i>0&&(b>t||b==t&&x>=e))&&(/_random/.exec(a.bwg.idsToChroms[w])||(null==r||i<0&&(b>o||b==o&&x>l)||i>0&&(w<o||w==o&&y<l))&&(r={offset:k,size:C},l=i<0?x:y,o=i<0?b:w)),c+=32}else{for(var T=-1,S=-1,m=0;m<v;++m){var g=c/4,w=_[g],y=_[g+1],b=_[g+2],x=_[g+3],k=_[g+4]<<32|_[g+5];(i<0&&(w<t||w==t&&y<=e)&&b>=t||i>0&&(b>t||b==t&&x>=e)&&w<=t)&&(T<0||x>S)&&(T=k,S=i<0?x:y,i<0?b:w),c+=24}T>=0&&u([T],d+1)}};u([a.cirTreeOffset+48],1)},l.prototype.readWigData=function(t,e,i){var n,a=i-e;if(a<=25e3||0===this.zoomLevels.length)n=this.getUnzoomedView();else for(var r=0;r<this.zoomLevels.length;r++)if(a/this.zoomLevels[r].reduction<25e3){n=this.getZoomedView(r);break}return n.readWigData(t,e,i)},l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var t=4e3;this.zoomLevels[0]&&(t=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset),this.unzoomedView=new c(this,this.unzoomedIndexOffset,t,!1)}return this.unzoomedView},l.prototype.getZoomedView=function(t){var e=this.zoomLevels[t];return e.view||(e.view=new c(this,e.indexOffset,4e3,!0)),e.view},l.prototype._tsFetch=function(t,e,i,n,a){var r=this;if(!(t>=this.zoomLevels.length-1)){var o;return o=t<0?this.getUnzoomedView():this.getZoomedView(t),o.readWigDataById(e,i,n,a)}if(this.topLevelReductionCache){for(var s=[],l=this.topLevelReductionCache,c=0;c<l.length;++c)l[c]._chromId==e&&s.push(l[c]);return a(s)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3e8,function(o){return r.topLevelReductionCache=o,r._tsFetch(t,e,i,n,a)})},l.prototype.thresholdSearch=function(t,e,i,n,a){function r(){if(0==l.length)return a(null);l.sort(function(t,e){var n=t.zoom-e.zoom;return 0!=n?n:(n=t.chrOrd-e.chrOrd,0!=n?n:t.min-e.min*i)});var t=l.splice(0,1)[0];o._tsFetch(t.zoom,t.chr,t.min,t.max,function(o){var s=i>0?0:3e8;t.fromRef&&(s=e);for(var c=0;c<o.length;++c){var u,d=o[c];if(u=void 0!=d.maxScore?d.maxScore:d.score,i>0){if(u>n)if(t.zoom<0){if(d.min>s)return a(d)}else d.max>s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:d.min,max:d.max,fromRef:t.fromRef})}else if(u>n)if(t.zoom<0){if(d.max<s)return a(d)}else d.min<s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:d.min,max:d.max,fromRef:t.fromRef})}r()})}i=i<0?-1:1;for(var o=this,s=this.chromsToIDs[t],l=[{chrOrd:0,chr:s,zoom:o.zoomLevels.length-4,min:0,max:3e8,fromRef:!0}],c=1;c<=this.maxID+1;++c){var u=(s+i*c)%(this.maxID+1);u<0&&(u+=this.maxID+1),l.push({chrOrd:c,chr:u,zoom:o.zoomLevels.length-1,min:0,max:3e8})}r()},l.prototype.getAutoSQL=function(t){if(!this.asOffset)return t(null);n.when(o(this.url,this.asOffset,2048)).then(function(e){for(var i=new Uint8Array(e),n="",a=0;a<i.length&&0!=i[a];++a)n+=String.fromCharCode(i[a]);var r=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/,o=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,s=r.exec(n);if(s){var l={declType:s[1],name:s[2],comment:s[4],fields:[]};n=n.substring(s[0]);for(var c=o.exec(n);null!=c;c=o.exec(n))l.fields.push({type:c[1],name:c[2],comment:c[4]});return t(l)}})},l.prototype.getExtraIndices=function(t){var e=this;if(this.version<4||0==this.extHeaderOffset||"bigbed"!=this.type)return t(null);this.data.slice(this.extHeaderOffset,64).fetch(function(i){if(!i)return t(null,"Couldn't fetch extension header");var n=new Uint8Array(i),a=new Int16Array(i),r=(new Int32Array(i),a[0],a[1]),o=s(n,4);if(0==r)return t(null);e.data.slice(o,20*r).fetch(function(i){if(!i)return t(null,"Couldn't fetch index info");for(var n=new Uint8Array(i),a=new Int16Array(i),o=(new Int32Array(i),[]),l=0;l<r;++l){var c=a[10*l],u=a[10*l+1],h=s(n,20*l+4),f=a[10*l+8],_=new d(e,c,u,h,f);o.push(_)}t(o)})})},d.prototype.lookup=function(t,e){var i=this;this.bbi.data.slice(this.offset,32).fetch(function(n){function a(n){i.bbi.data.slice(n,4+c*(u+d)).fetch(function(n){var o=new Uint8Array(n),l=new Uint16Array(n),c=(new Uint32Array(n),o[0]),h=l[1],f=4;if(0!=c){for(var _=0;_<h;++_){for(var p="",v=0;v<u;++v){var m=o[f++];0!=m&&(p+=String.fromCharCode(m))}if(p==t){var g=s(o,f),w=r(o,f+8);return i.bbi.getUnzoomedView().fetchFeatures(function(e,n,a,r){if(r&&r.length>i.field-3)return r[i.field-3]==t},[{offset:g,size:w}],e)}f+=d}return e([])}for(var y=null,_=0;_<h;++_){for(var p="",v=0;v<u;++v){var m=o[f++];0!=m&&(p+=String.fromCharCode(m))}var b=s(o,f);if(f+=8,t.localeCompare(p)<0&&y)return void a(y);y=b}a(y)})}var o=new Uint8Array(n),l=(new Int16Array(n),new Int32Array(n)),c=(l[0],l[1]),u=l[2],d=l[3];s(o,16);a(i.offset+32)})},{makeBwg:u}}.apply(e,a))&&(t.exports=r)}).call(e,i(0))},function(t,e,i){var n,a;n=[],void 0!==(a=function(){"use strict";function t(t,e){if("number"!=typeof t||"number"!=typeof e)throw"Bad range "+t+","+e;this._min=t,this._max=e}function e(t){var e=t.sort(o),i=[],n=e.shift();e.forEach(function(t){t._min<=n._max?t._max>n._max&&(n._max=t._max):(i.push(n),n=t)}),i.push(n),this._ranges=i}function i(t,i){return t instanceof e||(t instanceof Array||(t=[t]),t=new e(t)),i&&t.insertRange(i),t}function n(i,n){for(var a=i.ranges(),r=n.ranges(),o=a.length,s=r.length,l=0,c=0,u=[];l<o&&c<s;){var i=a[l],n=r[c],d=Math.max(i.min(),n.min()),h=Math.min(i.max(),n.max());h>=d&&u.push(new t(d,h)),i.max()>n.max()?++c:++l}return 0==u.length?null:1==u.length?u[0]:new e(u)}function a(t){for(var e=0,i=t.ranges(),n=0;n<i.length;++n){var a=i[n];e+=a.max()-a.min()+1}return e}function r(t,e){return t.min()<e.min()?-1:t.min()>e.min()?1:t.max()<e.max()?-1:e.max()>t.max()?1:0}function o(t,e){return t._min<e._min?-1:t._min>e._min?1:t._max<e._max?-1:e._max>t._max?1:0}return t.prototype.min=function(){return this._min},t.prototype.max=function(){return this._max},t.prototype.contains=function(t){return t>=this._min&&t<=this._max},t.prototype.isContiguous=function(){return!0},t.prototype.ranges=function(){return[this]},t.prototype._pushRanges=function(t){t.push(this)},t.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"},e.prototype.min=function(){return this._ranges[0].min()},e.prototype.max=function(){return this._ranges[this._ranges.length-1].max()},e.prototype.lower_bound=function(t){var e=this.ranges();if(t>this.max())return e.length;if(t<this.min())return 0;for(var i=0,n=e.length-1;i<=n;){var a=Math.floor((i+n)/2);if(t>e[a]._max)i=a+1;else{if(!(t<e[a]._min))return a;n=a-1}}return i},e.prototype.contains=function(t){var e=this.lower_bound(t);return!!(e<this._ranges.length&&this._ranges[e].contains(t))},e.prototype.insertRange=function(t){var e=this.lower_bound(t._min);if(e===this._ranges.length)return void this._ranges.push(t);var i=this.ranges();if(t._max<i[e]._min)return void this._ranges.splice(e,0,t);i[e]._min<t._min&&(t._min=i[e]._min);for(var n=e+1;n<i.length&&i[n]._min<=t._max;)n++;n--,i[n]._max>t._max&&(t._max=i[n]._max),this._ranges.splice(e,n-e+1,t)},e.prototype.isContiguous=function(){return this._ranges.length>1},e.prototype.ranges=function(){return this._ranges},e.prototype._pushRanges=function(t){for(var e=0;e<this._ranges.length;++e)t.push(this._ranges[e])},e.prototype.toString=function(){for(var t="",e=0;e<this._ranges.length;++e)e>0&&(t+=","),t+=this._ranges[e].toString();return t},{Range:t,union:i,intersection:n,coverage:a,rangeOver:r,_rangeOrder:o}}.apply(e,n))&&(t.exports=a)},function(t,e,i){var n,a;n=[],void 0!==(a=function(){function t(){}function e(){this.was=[0]}function i(t,e,i){this.hufts=new Int32Array(3*d),this.window=new Uint8Array(i),this.end=i,this.checkfn=e,this.mode=m,this.reset(t,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new n,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new a}function n(){}function a(){}function r(t,e,i,n,a){return t[0]=g,e[0]=w,i[0]=y,n[0]=b,f}function o(t,e,i,n,a){if(0!=a){if(!t)throw"Undef src";if(!i)throw"Undef dest";0==e&&a==t.length?l(t,i,n):z?l(t.subarray(e,e+a),i,n):1==t.BYTES_PER_ELEMENT&&a>100?l(new Uint8Array(t.buffer,t.byteOffset+e,a),i,n):s(t,e,i,n,a)}}function s(t,e,i,n,a){for(var r=0;r<a;++r)i[n+r]=t[e+r]}function l(t,e,i){e.set(t,i)}function c(e,i,n,a){e=i?n?new Uint8Array(e,i,n):new Uint8Array(e,i,e.byteLength-i):new Uint8Array(e);var r=new t;r.inflateInit(u,!0),r.next_in=e,r.next_in_index=0,r.avail_in=e.length;for(var s=[],l=0;;){var c=new Uint8Array(32e3);r.next_out=c,r.next_out_index=0,r.avail_out=c.length;var d=r.inflate(h);if(d!=f&&d!=_&&d!=p)throw r.msg;if(0!=r.avail_out){var v=new Uint8Array(c.length-r.avail_out);o(c,0,v,0,c.length-r.avail_out),c=v}if(s.push(c),l+=c.length,d==_||d==p)break}if(a&&(a[0]=(i||0)+r.next_in_index),1==s.length)return s[0].buffer;for(var m=new Uint8Array(l),g=0,w=0;w<s.length;++w){var y=s[w];o(y,0,m,g,y.length),g+=y.length}return m.buffer}var u=15,d=1440,h=0,f=0,_=1,p=-5,v=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],m=0,g=9,w=5,y=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],b=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];t.prototype.inflateInit=function(t,i){return t||(t=u),i&&(i=!1),this.istate=new e,this.istate.inflateInit(this,i?-t:t)},t.prototype.inflate=function(t){return null==this.istate?-2:this.istate.inflate(this,t)},t.prototype.inflateEnd=function(){if(null==this.istate)return-2;var t=istate.inflateEnd(this);return this.istate=null,t},t.prototype.inflateSync=function(){return istate.inflateSync(this)},t.prototype.inflateSetDictionary=function(t,e){return istate.inflateSetDictionary(this,t,e)},e.prototype.inflateReset=function(t){return null==t||null==t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=0!=t.istate.nowrap?7:0,t.istate.blocks.reset(t,null),f)},e.prototype.inflateEnd=function(t){return null!=this.blocks&&this.blocks.free(t),this.blocks=null,f},e.prototype.inflateInit=function(t,e){return t.msg=null,this.blocks=null,nowrap=0,e<0&&(e=-e,nowrap=1),e<8||e>15?(this.inflateEnd(t),-2):(this.wbits=e,t.istate.blocks=new i(t,0!=t.istate.nowrap?null:this,1<<e),this.inflateReset(t),f)},e.prototype.inflate=function(t,e){var i,n;if(null==t||null==t.istate||null==t.next_in)return-2;for(e=4==e?p:f,i=p;;)switch(t.istate.mode){case 0:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,8!=(15&(t.istate.method=t.next_in[t.next_in_index++]))){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,n=255&t.next_in[t.next_in_index++],((t.istate.method<<8)+n)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if(0==(32&n)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=3;case 3:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=4;case 4:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=5;case 5:return 0==t.avail_in?i:(i=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.adler=t.istate.need,t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if(-3==(i=t.istate.blocks.proc(t,i))){t.istate.mode=13,t.istate.marker=0;break}if(i==f&&(i=e),i!=_)return i;if(i=e,t.istate.blocks.reset(t,t.istate.was),0!=t.istate.nowrap){t.istate.mode=12;break}t.istate.mode=8;case 8:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=9;case 9:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=10;case 10:if(0==t.avail_in)return i;i=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=11;case 11:if(0==t.avail_in)return i;if(i=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.istate.was[0]!=t.istate.need){t.istate.mode=13,t.msg="incorrect data check",t.istate.marker=5;break}t.istate.mode=12;case 12:return _;case 13:return-3;default:return-2}},e.prototype.inflateSetDictionary=function(t,e,i){var n=0,a=i;return null==t||null==t.istate||6!=t.istate.mode?-2:t._adler.adler32(1,e,0,i)!=t.adler?-3:(t.adler=t._adler.adler32(0,null,0,0),a>=1<<t.istate.wbits&&(a=(1<<t.istate.wbits)-1,n=i-a),t.istate.blocks.set_dictionary(e,n,a),t.istate.mode=7,f)};var S=[0,0,255,255];e.prototype.inflateSync=function(t){var e,i,n,a,r;if(null==t||null==t.istate)return-2;if(13!=t.istate.mode&&(t.istate.mode=13,t.istate.marker=0),0==(e=t.avail_in))return p;for(i=t.next_in_index,n=t.istate.marker;0!=e&&n<4;)t.next_in[i]==S[n]?n++:n=0!=t.next_in[i]?0:4-n,i++,e--;return t.total_in+=i-t.next_in_index,t.next_in_index=i,t.avail_in=e,t.istate.marker=n,4!=n?-3:(a=t.total_in,r=t.total_out,this.inflateReset(t),t.total_in=a,t.total_out=r,t.istate.mode=7,f)},e.prototype.inflateSyncPoint=function(t){return null==t||null==t.istate||null==t.istate.blocks?-2:t.istate.blocks.sync_point()};var M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];i.prototype.reset=function(t,e){e&&(e[0]=this.check),6==this.mode&&this.codes.free(t),this.mode=m,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(t.adler=this.check=t._adler.adler32(0,null,0,0))},i.prototype.proc=function(t,e){var i,n,a,s,l,c,u;for(s=t.next_in_index,l=t.avail_in,n=this.bitb,a=this.bitk,c=this.write,u=c<this.read?this.read-c-1:this.end-c;;)switch(this.mode){case m:for(;a<3;){if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,n|=(255&t.next_in[s++])<<a,a+=8}switch(i=7&n,this.last=1&i,i>>>1){case 0:n>>>=3,a-=3,i=7&a,n>>>=i,a-=i,this.mode=1;break;case 1:var d=new Int32Array(1),h=new Int32Array(1),p=[],g=[];r(d,h,p,g,t),this.codes.init(d[0],h[0],p[0],0,g[0],0,t),n>>>=3,a-=3,this.mode=6;break;case 2:n>>>=3,a-=3,this.mode=3;break;case 3:return n>>>=3,a-=3,this.mode=13,t.msg="invalid block type",e=-3,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e)}break;case 1:for(;a<32;){if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,n|=(255&t.next_in[s++])<<a,a+=8}if((~n>>>16&65535)!=(65535&n))return this.mode=13,t.msg="invalid stored block lengths",e=-3,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);this.left=65535&n,n=a=0,this.mode=0!=this.left?2:0!=this.last?7:m;break;case 2:if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=c,this.inflate_flush(t,e);if(0==u&&(c==end&&0!=read&&(c=0,u=c<this.read?this.read-c-1:this.end-c),0==u&&(this.write=c,e=this.inflate_flush(t,e),c=this.write,u=c<this.read?this.read-c-1:this.end-c,c==this.end&&0!=this.read&&(c=0,u=c<this.read?this.read-c-1:this.end-c),0==u)))return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);if(e=f,i=this.left,i>l&&(i=l),i>u&&(i=u),o(t.next_in,s,this.window,c,i),s+=i,l-=i,c+=i,u-=i,0!=(this.left-=i))break;this.mode=0!=this.last?7:m;break;case 3:for(;a<14;){if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,n|=(255&t.next_in[s++])<<a,a+=8}if(this.table=i=16383&n,(31&i)>29||(i>>5&31)>29)return this.mode=9,t.msg="too many length or distance symbols",e=-3,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);if(i=258+(31&i)+(i>>5&31),null==this.blens||this.blens.length<i)this.blens=new Int32Array(i);else for(var w=0;w<i;w++)this.blens[w]=0;n>>>=14,a-=14,this.index=0,mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;a<3;){if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,n|=(255&t.next_in[s++])<<a,a+=8}this.blens[M[this.index++]]=7&n,n>>>=3,a-=3}for(;this.index<19;)this.blens[M[this.index++]]=0;if(this.bb[0]=7,(i=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,t))!=f)return e=i,-3==e&&(this.blens=null,this.mode=9),this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=c,this.inflate_flush(t,e);this.index=0,this.mode=5;case 5:for(;;){if(i=this.table,!(this.index<258+(31&i)+(i>>5&31)))break;var w,y,b;for(i=this.bb[0];a<i;){if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,n|=(255&t.next_in[s++])<<a,a+=8}if(i=this.hufts[3*(this.tb[0]+(n&v[i]))+1],(b=this.hufts[3*(this.tb[0]+(n&v[i]))+2])<16)n>>>=i,a-=i,this.blens[this.index++]=b;else{for(w=18==b?7:b-14,y=18==b?11:3;a<i+w;){if(0==l)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);e=f,l--,n|=(255&t.next_in[s++])<<a,a+=8}if(n>>>=i,a-=i,y+=n&v[w],n>>>=w,a-=w,w=this.index,i=this.table,w+y>258+(31&i)+(i>>5&31)||16==b&&w<1)return this.blens=null,this.mode=9,t.msg="invalid bit length repeat",e=-3,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);b=16==b?this.blens[w-1]:0;do{this.blens[w++]=b}while(0!=--y);this.index=w}}this.tb[0]=-1;var d=new Int32Array(1),h=new Int32Array(1),p=new Int32Array(1),g=new Int32Array(1);if(d[0]=9,h[0]=6,i=this.table,(i=this.inftree.inflate_trees_dynamic(257+(31&i),1+(i>>5&31),this.blens,d,h,p,g,this.hufts,t))!=f)return-3==i&&(this.blens=null,this.mode=13),e=i,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);this.codes.init(d[0],h[0],this.hufts,p[0],this.hufts,g[0],t),this.mode=6;case 6:if(this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,(e=this.codes.proc(this,t,e))!=_)return this.inflate_flush(t,e);if(e=f,this.codes.free(t),s=t.next_in_index,l=t.avail_in,n=this.bitb,a=this.bitk,c=this.write,u=c<this.read?this.read-c-1:this.end-c,0==this.last){this.mode=m;break}this.mode=7;case 7:if(this.write=c,e=this.inflate_flush(t,e),c=this.write,u=c<this.read?this.read-c-1:this.end-c,this.read!=this.write)return this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);mode=12;case 8:return e=_,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);case 9:return e=-3,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e);default:return e=-2,this.bitb=n,this.bitk=a,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=c,this.inflate_flush(t,e)}},i.prototype.free=function(t){this.reset(t,null),this.window=null,this.hufts=null},i.prototype.set_dictionary=function(t,e,i){o(t,e,window,0,i),this.read=this.write=i},i.prototype.sync_point=function(){return 1==this.mode},i.prototype.inflate_flush=function(t,e){var i,n,a;return n=t.next_out_index,a=this.read,i=(a<=this.write?this.write:this.end)-a,i>t.avail_out&&(i=t.avail_out),0!=i&&e==p&&(e=f),t.avail_out-=i,t.total_out+=i,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,a,i)),o(this.window,a,t.next_out,n,i),n+=i,a+=i,a==this.end&&(a=0,this.write==this.end&&(this.write=0),i=this.write-a,i>t.avail_out&&(i=t.avail_out),0!=i&&e==p&&(e=f),t.avail_out-=i,t.total_out+=i,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,a,i)),o(this.window,a,t.next_out,n,i),n+=i,a+=i),t.next_out_index=n,this.read=a,e};n.prototype.init=function(t,e,i,n,a,r,o){this.mode=0,this.lbits=t,this.dbits=e,this.ltree=i,this.ltree_index=n,this.dtree=a,this.dtree_index=r,this.tree=null},n.prototype.proc=function(t,e,i){var n,a,r,o,s,l,c,u=0,d=0,h=0;for(h=e.next_in_index,o=e.avail_in,u=t.bitb,d=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s;;)switch(this.mode){case 0:if(l>=258&&o>=10&&(t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,i=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,t,e),h=e.next_in_index,o=e.avail_in,u=t.bitb,d=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s,i!=f)){this.mode=i==_?7:9;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=1;case 1:for(n=this.need;d<n;){if(0==o)return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);i=f,o--,u|=(255&e.next_in[h++])<<d,d+=8}if(a=3*(this.tree_index+(u&v[n])),u>>>=this.tree[a+1],d-=this.tree[a+1],0==(r=this.tree[a])){this.lit=this.tree[a+2],this.mode=6;break}if(0!=(16&r)){this.get=15&r,this.len=this.tree[a+2],this.mode=2;break}if(0==(64&r)){this.need=r,this.tree_index=a/3+this.tree[a+2];break}if(0!=(32&r)){this.mode=7;break}return this.mode=9,e.msg="invalid literal/length code",i=-3,t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);case 2:for(n=this.get;d<n;){if(0==o)return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);i=f,o--,u|=(255&e.next_in[h++])<<d,d+=8}this.len+=u&v[n],u>>=n,d-=n,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=3;case 3:for(n=this.need;d<n;){if(0==o)return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);i=f,o--,u|=(255&e.next_in[h++])<<d,d+=8}if(a=3*(this.tree_index+(u&v[n])),u>>=this.tree[a+1],d-=this.tree[a+1],0!=(16&(r=this.tree[a]))){this.get=15&r,this.dist=this.tree[a+2],this.mode=4;break}if(0==(64&r)){this.need=r,this.tree_index=a/3+this.tree[a+2];break}return this.mode=9,e.msg="invalid distance code",i=-3,t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);case 4:for(n=this.get;d<n;){if(0==o)return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);i=f,o--,u|=(255&e.next_in[h++])<<d,d+=8}this.dist+=u&v[n],u>>=n,d-=n,this.mode=5;case 5:for(c=s-this.dist;c<0;)c+=t.end;for(;0!=this.len;){if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,i=t.inflate_flush(e,i),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);t.window[s++]=t.window[c++],l--,c==t.end&&(c=0),this.len--}this.mode=0;break;case 6:if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,i=t.inflate_flush(e,i),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);i=f,t.window[s++]=this.lit,l--,this.mode=0;break;case 7:if(d>7&&(d-=8,o++,h--),t.write=s,i=t.inflate_flush(e,i),s=t.write,l=s<t.read?t.read-s-1:t.end-s,t.read!=t.write)return t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);this.mode=8;case 8:return i=_,t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);case 9:return i=-3,t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i);default:return i=-2,t.bitb=u,t.bitk=d,e.avail_in=o,e.total_in+=h-e.next_in_index,e.next_in_index=h,t.write=s,t.inflate_flush(e,i)}},n.prototype.free=function(t){},n.prototype.inflate_fast=function(t,e,i,n,a,r,s,l){var c,u,d,h,p,m,g,w,y,b,x,k,C,T,S,M;g=l.next_in_index,w=l.avail_in,p=s.bitb,m=s.bitk,y=s.write,b=y<s.read?s.read-y-1:s.end-y,x=v[t],k=v[e];do{for(;m<20;)w--,p|=(255&l.next_in[g++])<<m,m+=8;if(c=p&x,u=i,d=n,M=3*(d+c),0!=(h=u[M]))for(;;){if(p>>=u[M+1],m-=u[M+1],0!=(16&h)){for(h&=15,C=u[M+2]+(p&v[h]),p>>=h,m-=h;m<15;)w--,p|=(255&l.next_in[g++])<<m,m+=8;for(c=p&k,u=a,d=r,M=3*(d+c),h=u[M];;){if(p>>=u[M+1],m-=u[M+1],0!=(16&h)){for(h&=15;m<h;)w--,p|=(255&l.next_in[g++])<<m,m+=8;if(T=u[M+2]+(p&v[h]),p>>=h,m-=h,b-=C,y>=T)S=y-T,s.window[y++]=s.window[S++],s.window[y++]=s.window[S++],C-=2;else{S=y-T;do{S+=s.end}while(S<0);if(h=s.end-S,C>h){if(C-=h,y-S>0&&h>y-S)do{s.window[y++]=s.window[S++]}while(0!=--h);else o(s.window,S,s.window,y,h),y+=h,S+=h,h=0;S=0}}do{s.window[y++]=s.window[S++]}while(0!=--C);break}if(0!=(64&h))return l.msg="invalid distance code",C=l.avail_in-w,C=m>>3<C?m>>3:C,w+=C,g-=C,m-=C<<3,s.bitb=p,s.bitk=m,l.avail_in=w,l.total_in+=g-l.next_in_index,l.next_in_index=g,s.write=y,-3;c+=u[M+2],c+=p&v[h],M=3*(d+c),h=u[M]}break}if(0!=(64&h))return 0!=(32&h)?(C=l.avail_in-w,C=m>>3<C?m>>3:C,w+=C,g-=C,m-=C<<3,s.bitb=p,s.bitk=m,l.avail_in=w,l.total_in+=g-l.next_in_index,l.next_in_index=g,s.write=y,_):(l.msg="invalid literal/length code",C=l.avail_in-w,C=m>>3<C?m>>3:C,w+=C,g-=C,m-=C<<3,s.bitb=p,s.bitk=m,l.avail_in=w,l.total_in+=g-l.next_in_index,l.next_in_index=g,s.write=y,-3);if(c+=u[M+2],c+=p&v[h],M=3*(d+c),0==(h=u[M])){p>>=u[M+1],m-=u[M+1],s.window[y++]=u[M+2],b--;break}}else p>>=u[M+1],m-=u[M+1],s.window[y++]=u[M+2],b--}while(b>=258&&w>=10);return C=l.avail_in-w,C=m>>3<C?m>>3:C,w+=C,g-=C,m-=C<<3,s.bitb=p,s.bitk=m,l.avail_in=w,l.total_in+=g-l.next_in_index,l.next_in_index=g,s.write=y,f},a.prototype.huft_build=function(t,e,i,n,a,r,s,l,c,u,h){var _,v,m,g,w,y,b,x,k,C,T,S,M,O,z;C=0,w=i;do{this.c[t[e+C]]++,C++,w--}while(0!=w);if(this.c[0]==i)return s[0]=-1,l[0]=0,f;for(x=l[0],y=1;y<=15&&0==this.c[y];y++);for(b=y,x<y&&(x=y),w=15;0!=w&&0==this.c[w];w--);for(m=w,x>w&&(x=w),l[0]=x,O=1<<y;y<w;y++,O<<=1)if((O-=this.c[y])<0)return-3;if((O-=this.c[w])<0)return-3;for(this.c[w]+=O,this.x[1]=y=0,C=1,M=2;0!=--w;)this.x[M]=y+=this.c[C],M++,C++;w=0,C=0;do{0!=(y=t[e+C])&&(this.v[this.x[y]++]=w),C++}while(++w<i);for(i=this.x[m],this.x[0]=w=0,C=0,g=-1,S=-x,this.u[0]=0,T=0,z=0;b<=m;b++)for(_=this.c[b];0!=_--;){for(;b>S+x;){if(g++,S+=x,z=m-S,z=z>x?x:z,(v=1<<(y=b-S))>_+1&&(v-=_+1,M=b,y<z))for(;++y<z&&!((v<<=1)<=this.c[++M]);)v-=this.c[M];if(z=1<<y,this.hn[0]+z>d)return-3;this.u[g]=T=this.hn[0],this.hn[0]+=z,0!=g?(this.x[g]=w,this.r[0]=y,this.r[1]=x,y=w>>>S-x,this.r[2]=T-this.u[g-1]-y,o(this.r,0,c,3*(this.u[g-1]+y),3)):s[0]=T}for(this.r[1]=b-S,C>=i?this.r[0]=192:h[C]<n?(this.r[0]=this.v[C]<256?0:96,this.r[2]=this.v[C++]):(this.r[0]=r[this.v[C]-n]+16+64,this.r[2]=a[this.v[C++]-n]),v=1<<b-S,y=w>>>S;y<z;y+=v)o(this.r,0,c,3*(T+y),3);for(y=1<<b-1;0!=(w&y);y>>>=1)w^=y;for(w^=y,k=(1<<S)-1;(w&k)!=this.x[g];)g--,S-=x,k=(1<<S)-1}return 0!=O&&1!=m?p:f},a.prototype.inflate_trees_bits=function(t,e,i,n,a){var r;return this.initWorkArea(19),this.hn[0]=0,r=this.huft_build(t,0,19,19,null,null,i,e,n,this.hn,this.v),-3==r?a.msg="oversubscribed dynamic bit lengths tree":r!=p&&0!=e[0]||(a.msg="incomplete dynamic bit lengths tree",r=-3),r},a.prototype.inflate_trees_dynamic=function(t,e,i,n,a,r,o,s,l){var c;return this.initWorkArea(288),this.hn[0]=0,(c=this.huft_build(i,0,t,257,x,k,r,n,s,this.hn,this.v))!=f||0==n[0]?(-3==c?l.msg="oversubscribed literal/length tree":-4!=c&&(l.msg="incomplete literal/length tree",c=-3),c):(this.initWorkArea(288),c=this.huft_build(i,t,e,0,C,T,o,a,s,this.hn,this.v),c!=f||0==a[0]&&t>257?(-3==c?l.msg="oversubscribed distance tree":c==p?(l.msg="incomplete distance tree",c=-3):-4!=c&&(l.msg="empty distance tree with lengths",c=-3),c):f)},a.prototype.initWorkArea=function(t){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(t),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16)),this.v.length<t&&(this.v=new Int32Array(t));for(var e=0;e<t;e++)this.v[e]=0;for(var e=0;e<16;e++)this.c[e]=0;for(var e=0;e<3;e++)this.r[e]=0;o(this.c,0,this.u,0,15),o(this.c,0,this.x,0,16)};var O=new Uint8Array(1),z="function"==typeof O.subarray;return{inflateBuffer:c,arrayCopy:o}}.apply(e,n))&&(t.exports=a)},function(t,e,i){(function(n){var a,r,o;!function(n,s){r=[i(0)],a=s,void 0!==(o="function"==typeof a?a.apply(e,r):a)&&(t.exports=o)}(0,function(t){var e=t.ajaxSettings;e.responseFields.native="responseNative",e.converters["* native"]=!0;var i={},a=0,r={0:200,1223:204},o={},s=n.ajaxSettings.xhr();window.ActiveXObject&&t(window).on("unload",function(){for(var t in o)o[t]()}),i.cors=!!s&&"withCredentials"in s,i.ajax=s=!!s,t.ajaxTransport("native",function(t){var e;if(i.cors||s&&!t.crossDomain)return{send:function(i,n){var s,l=t.xhr(),c=++a,u={};if(l.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)l[s]=t.xhrFields[s];t.mimeType&&l.overrideMimeType&&l.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(s in i)l.setRequestHeader(s,i[s]);e=function(t){return function(){e&&(delete o[c],e=l.onload=l.onerror=null,"abort"===t?l.abort():"error"===t?n(l.status,l.statusText):(l.response&&(u.native=l.response),n(r[l.status]||l.status,l.statusText,u,l.getAllResponseHeaders())))}},l.onload=e(),l.onerror=e("error"),e=o[c]=e("abort");try{l.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}}),t.getNative=function(e,i){return t.ajax({dataType:"native",url:e,xhrFields:{responseType:"arraybuffer"},success:i})}})}).call(e,i(0))},function(t,e,i){"use strict";(function(t){function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(9),o=a(r),s=i(1),l=a(s),c=i(6),u=n(c),d=i(3),h=n(d),f=o.View.extend(u.default.LoggableMixin).extend({_logNamespace:"user",options:{warnAtPercent:85,errorAtPercent:100},initialize:function(t){this.log(this+".initialize:",t),l.extend(this.options,t),this.listenTo(this.model,"change:quota_percent change:total_disk_usage",this.render)},update:function(t){return this.log(this+" updating user data...",t),this.model.loadFromApi(this.model.get("id"),t),this},isOverQuota:function(){return null!==this.model.get("quota_percent")&&this.model.get("quota_percent")>=this.options.errorAtPercent},_render_quota:function(){var e=this.model.toJSON(),i=e.quota_percent,n=t(this._templateQuotaMeter(e)),a=n.find(".progress-bar");return this.isOverQuota()?(a.attr("class","progress-bar bg-danger"),n.find(".quota-meter-text").css("color","white"),this.trigger("quota:over",e)):i>=this.options.warnAtPercent?(a.attr("class","progress-bar bg-warning"),this.trigger("quota:under quota:under:approaching",e)):(a.attr("class","progress-bar bg-success"),this.trigger("quota:under quota:under:ok",e)),n},_render_usage:function(){var e=t(this._templateUsage(this.model.toJSON()));return this.log(this+".rendering usage:",e),e},render:function(){var t=null;return this.log(this+".model.quota_percent:",this.model.get("quota_percent")),t=null===this.model.get("quota_percent")||void 0===this.model.get("quota_percent")?this._render_usage():this._render_quota(),this.$el.html(t),this.$el.find(".quota-meter-text").tooltip(),this},_templateQuotaMeter:function(t){return['<div id="quota-meter" class="quota-meter progress">','<div class="progress-bar" style="width: ',t.quota_percent,'%"></div>','<div class="quota-meter-text" data-placement="left" style="top: 6px"',t.nice_total_disk_usage?' title="Using '+t.nice_total_disk_usage+'. Click for details.">':">",'<a href="https://galaxyproject.org/support/account-quotas/" target="_blank">',(0,h.default)("Using")," ",t.quota_percent,"%","</a>","</div>","</div>"].join("")},_templateUsage:function(t){return['<div id="quota-meter" class="quota-meter" style="background-color: transparent">','<div class="quota-meter-text" data-placement="left" data-original-title="This value is recalculated when you log out." style="top: 6px; color: white">',t.nice_total_disk_usage?(0,h.default)("Using ")+t.nice_total_disk_usage:"","</div>","</div>"].join("")},toString:function(){return"UserQuotaMeter("+this.model+")"}});e.default={UserQuotaMeter:f}}).call(e,i(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";(function(t,n,a){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(73),s=r(o),l=i(168),c=r(l),u=i(17),d=r(u),h=i(5),f=r(h),_=t.View.extend({el:"body",className:"full-content",_panelids:["left","right"],initialize:function(e){var i=this,a=this;this.config=n.defaults(e.config||{},{message_box_visible:!1,message_box_content:"",message_box_class:"info",show_inactivity_warning:!1,inactivity_box_content:"",hide_panels:!1,hide_masthead:!1}),Galaxy.modal=this.modal=new d.default.View,Galaxy.router=this.router=e.Router&&new e.Router(a,e),this.masthead=new s.default.View(this.config),this.center=new c.default.CenterPanel,Galaxy.display=this.display=function(t){t.title?(f.default.setWindowTitle(t.title),t.allow_title_display=!1):(f.default.setWindowTitle(),t.allow_title_display=!0),t.active_tab&&a.masthead.highlight(t.active_tab),a.center.display(t)},this.$el.attr("scroll","no"),this.$el.html(this._template()),this.$masthead=this.$("#masthead"),this.$center=this.$("#center"),this.$messagebox=this.$("#messagebox"),this.$inactivebox=this.$("#inactivebox"),this.config.hide_masthead?(this.$masthead.remove(),this.$center.css("top",0)):this.$masthead.replaceWith(this.masthead.$el),this.$center.append(this.center.$el),this.$el.append(this.masthead.frame.$el),this.$el.append(this.modal.$el),this.panels={},this.config.hide_panels||n.each(this._panelids,function(t){var n=t.charAt(0).toUpperCase()+t.slice(1),r=e[n];if(r){var o=new r(a,e),s=a.$("#"+t);a[o.toString()]=o,a.panels[t]=new c.default.SidePanel({id:t,el:s,view:o}),i.config.hide_masthead&&s.css("top",0)}}),this.render(),this.router&&t.history.start({root:Galaxy.root,pushState:!0})},render:function(){return a(".select2-hidden-accessible").remove(),this.config.hide_masthead||(this.masthead.render(),this.renderMessageBox(),this.renderInactivityBox()),this.renderPanels(),this._checkCommunicationServerOnline(),this},renderMessageBox:function(){if(this.config.message_box_visible){var t=this.config.message_box_content||"",e=this.config.message_box_class||"info";this.$el.addClass("has-message-box"),this.$messagebox.attr("class","panel-"+e+"-message").html(t).toggle(!!t).show()}else this.$el.removeClass("has-message-box"),this.$messagebox.hide();return this},renderInactivityBox:function(){if(this.config.show_inactivity_warning){var t=this.config.inactivity_box_content||"",e=a("<a/>").attr("href",Galaxy.root+"user/resend_verification").text("Resend verification");this.$el.addClass("has-inactivity-box"),this.$inactivebox.html(t+" ").append(e).toggle(!!t).show()}else this.$el.removeClass("has-inactivity-box"),this.$inactivebox.hide();return this},renderPanels:function(){var t=this;return n.each(this._panelids,function(e){var i=t.panels[e];i?i.render():(t.$center.css(e,0),t.$("#"+e).hide())}),this},_template:function(){return['<div id="everything">\n                <div id="background"/>\n                <div id="masthead"/>\n                <div id="messagebox"/>\n                <div id="inactivebox" class="panel-warning-message" />\n                <div id="left" />\n                <div id="center" />\n                <div id="right" />\n            </div>\n            <div id="dd-helper" />'].join("")},toString:function(){return"PageLayoutView"},_checkCommunicationServerOnline:function(){var t=window.Galaxy.config.communication_server_host,e=window.Galaxy.config.communication_server_port,i=window.Galaxy.user.attributes.preferences,n=a("#show-chat-online");i&&-1!=["1","true"].indexOf(i.communication_server)?a.ajax({url:t+":"+e}).success(function(t){null!==window.Galaxy.user.id&&"hidden"===n.css("visibility")&&n.css("visibility","visible")}).error(function(t){n.css("visibility","hidden")}):n.css("visibility","hidden")}});e.default={View:_}}).call(e,i(2),i(1),i(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}var a=i(0),r=n(a),o=i(70),s=n(o),l=i(3),c=n(l),u=i(169),d=n(u),h=r.default;window.app=function(i,n){window.Galaxy=new s.default.GalaxyApp(i,n),Galaxy.debug("login app");var a=encodeURI(i.redirect);if(!i.show_welcome_with_login){var o=r.default.param({use_panels:"True",redirect:a});return void(window.location.href=Galaxy.root+"user/login?"+o)}var l=t.View.extend({initialize:function(e){this.page=e,this.model=new t.Model({title:(0,c.default)("Login required")}),this.setElement(this._template())},render:function(){this.page.$("#galaxy_main").prop("src",i.welcome_url)},_template:function(){return'<iframe src="'+i.root+"user/login?"+h.param({redirect:a})+'" frameborder="0" style="width: 100%; height: 100%;"/>'}});h(function(){Galaxy.page=new d.default.View(e.extend(i,{Right:l}))})}}).call(e,i(2),i(1))}],[425]);
