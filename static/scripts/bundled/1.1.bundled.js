webpackJsonp([1],{11:function(t,e,i){var n,a;(function(o,l,s){n=[i(8),i(24),i(15)],a=function(t,e,i){var n=o.Model.extend({}),a=o.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new n;l.each(l.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var i=e.split("metadata_")[1];t.set(i,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),r=a.extend({defaults:l.extend({},a.prototype.defaults,{chunk_url:null,first_data_chunk:null,chunk_index:-1,at_eof:!1}),initialize:function(t){a.prototype.initialize.call(this),this.attributes.chunk_index=this.attributes.first_data_chunk?1:0,this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=s.Deferred();return s.getJSON(this.attributes.chunk_url,{chunk:t.attributes.chunk_index++}).success(function(i){var n;""!==i.ck_data?n=i:(t.attributes.at_eof=!0,n=null),e.resolve(n)}),e}}),d=o.Collection.extend({model:a}),c=o.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new _({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),s.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=s("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=s("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),i=s("<thead/>").appendTo(t),n=s("<tr/>").appendTo(i);if(e)n.append("<th>"+e.join("</th><th>")+"</th>");else for(var a=1;a<=this.model.get_metadata("columns");a++)n.append("<th>"+a+"</th>");var o=this,l=this.model.get("first_data_chunk");l?this._renderChunk(l):s.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,i){var n=s("<td>").text(t),a=this.model.get_metadata("column_types");return void 0!==i?n.attr("colspan",i).addClass("stringalign"):a&&e<a.length&&("str"!==a[e]&&"list"!==a[e]||n.addClass("stringalign")),n},_renderRow:function(t){var e=t.split("	"),i=s("<tr>"),n=this.model.get_metadata("columns");return this.row_count%2!==0&&i.addClass("dark_row"),e.length===n?l.each(e,function(t,e){i.append(this._renderCell(t,e))},this):e.length>n?(l.each(e.slice(0,n-1),function(t,e){i.append(this._renderCell(t,e))},this),i.append(this._renderCell(e.slice(n-1).join("	"),n-1))):n>5&&e.length===n-1?(l.each(e,function(t,e){i.append(this._renderCell(t,e))},this),i.append(s("<td>"))):i.append(this._renderCell(t,0,n)),this.row_count++,i},_renderChunk:function(t){var e=this.$el.find("table");l.each(t.ck_data.split("\n"),function(t,i){""!==t&&e.append(this._renderRow(t))},this)}}),h=c.extend({initialize:function(t){c.prototype.initialize.call(this,t),scroll_elt=l.find(this.$el.parents(),function(t){return"auto"===s(t).css("overflow")}),scroll_elt||(scroll_elt=window),this.scroll_elt=s(scroll_elt)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),u=c.extend({initialize:function(t){c.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),_=o.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){function e(t,e){for(var i=0;i<e.length;i++)if(e[i].match(t))return i;return-1}var n=parent.Galaxy;if(n&&n.modal&&(this.modal=n.modal),n&&n.frame&&(this.frame=n.frame),this.modal&&this.frame){var a=t.model,o=a.get("metadata");if(a.get("file_ext")){if(this.file_ext=a.get("file_ext"),"bed"==this.file_ext){if(!(o.get("chromCol")&&o.get("startCol")&&o.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=o.get("chromCol")-1,this.col.start=o.get("startCol")-1,this.col.end=o.get("endCol")-1}if("vcf"==this.file_ext&&(this.col.chrom=e("Chrom",o.get("column_names")),this.col.start=e("Pos",o.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start))return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.");if(void 0!==this.col.chrom){if(!a.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=a.id,!a.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=a.get("url_viz"),a.get("genome_build")&&(this.genome_build=a.get("genome_build"));var l=new i.IconButtonView({model:new i.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(l.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){function e(t){return!isNaN(parseFloat(t))&&isFinite(t)}if(null!==this.col.chrom){var i=s(t.target).parent(),n=i.children().eq(this.col.chrom).html(),a=i.children().eq(this.col.start).html(),o=this.col.end?i.children().eq(this.col.end).html():a;if(!n.match("^#")&&""!==n&&e(a)){var l={dataset_id:this.dataset_id,gene_region:n+":"+a+"-"+o},r=i.offset(),d=r.left-10,c=r.top-s(window).scrollTop()+3;s("#btn_viz").css({position:"fixed",top:c+"px",left:d+"px"}),s("#btn_viz").off("click"),s("#btn_viz").click(this.create_trackster_action(this.url_viz,l,this.genome_build)),s("#btn_viz").show()}else s("#btn_viz").hide()}},hide:function(){this.$el.find("#btn_viz").hide()},create_trackster_action:function(t,e,i){var n=this;return function(){var a={};return i&&(a["f-dbkey"]=i),s.ajax({url:t+"/list_tracks?"+s.param(a),dataType:"html",error:function(){n.modal.show({title:"Something went wrong!",body:"Unfortunately we could not add this dataset to the track browser. Please try again or contact us.",buttons:{Cancel:function(){n.modal.hide()}}})},success:function(i){n.modal.show({title:"View Data in a New or Saved Visualization",buttons:{Cancel:function(){n.modal.hide()},"View in saved visualization":function(){n.modal.show({title:"Add Data to Saved Visualization",body:i,buttons:{Cancel:function(){n.modal.hide()},"Add to visualization":function(){n.modal.hide(),n.modal.$el.find("input[name=id]:checked").each(function(){var i=s(this).val();e.id=i,n.frame.add({title:"Trackster",type:"url",content:t+"/trackster?"+s.param(e)})})}}})},"View in new visualization":function(){n.modal.hide(),n.frame.add({title:"Trackster",type:"url",content:t+"/trackster?"+s.param(e)})}}})}}),!1}}}),f=function(t){t.model||(t.model=new r(t.dataset_config));var e=t.parent_elt,i=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var n=i?new u(t):new h(t);return n.render(),e&&(e.append(n.$el),n.expand_to_container()),n};return{Dataset:a,TabularDataset:r,DatasetCollection:d,TabularDatasetChunkedView:c,createTabularDatasetChunkedView:f}}.apply(e,n),!(void 0!==a&&(t.exports=a))}).call(e,i(2),i(3),i(1))},15:function(t,e,i){var n,a;(function(i,o,l){n=[],a=function(){var t=i.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),e=i.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return o.isFunction(this.model.get("on_click"))?(this.model.get("on_click")(t),!1):!0},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",l(e)}}),n=i.Collection.extend({model:t}),a=i.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var i=l("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&i.tooltip(e.attributes.tooltip_config);var n=e.get("options");n&&make_popupmenu(i,n)}),this}}),s=function(e,i){i||(i={});var l=new n(o.map(e,function(e){return new t(o.extend(e,i))}));return new a({collection:l})};return{IconButton:t,IconButtonView:e,IconButtonCollection:n,IconButtonMenuView:a,create_icon_buttons_menu:s}}.apply(e,n),!(void 0!==a&&(t.exports=a))}).call(e,i(2),i(3),i(1))}});
//# sourceMappingURL=1.1.bundled.js.map