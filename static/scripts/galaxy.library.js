define("galaxy.library",["exports","utils/utils","libs/toastr","mvc/base-mvc","mvc/library/library-model","mvc/library/library-folderlist-view","mvc/library/library-librarylist-view","mvc/library/library-librarytoolbar-view","mvc/library/library-foldertoolbar-view","mvc/library/library-dataset-view","mvc/library/library-library-view","mvc/library/library-folder-view"],function(e,r,i,a,l,o,t,s,d,n,b,y){"use strict";function w(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0});w(r);var u=w(i),f=w(a),c=(w(l),w(o)),_=w(t),V=w(s),x=w(d),p=w(n),g=w(b),G=w(y),h=Backbone.Router.extend({initialize:function(){this.routesHit=0,Backbone.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"libraries","page/:show_page":"libraries_page","library/:library_id/permissions":"library_permissions","folders/:folder_id/permissions":"folder_permissions","folders/:id":"folder_content","folders/:id/page/:show_page":"folder_page","folders/:folder_id/datasets/:dataset_id":"dataset_detail","folders/:folder_id/datasets/:dataset_id/permissions":"dataset_permissions","folders/:folder_id/datasets/:dataset_id/versions/:ldda_id":"dataset_version","folders/:folder_id/download/:format":"download","folders/:folder_id/import/:source":"import_datasets"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},trackPageview:function(){var e=Backbone.history.getFragment();/^\//.test(e)||""==e||(e="/"+e),"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"library/list"+e)}}),m=f.default.SessionStorageModel.extend({defaults:{with_deleted:!1,without_restricted:!1,sort_order:"asc",sort_by:"name",library_page_size:20,folder_page_size:15}}),v=Backbone.View.extend({libraryToolbarView:null,libraryListView:null,library_router:null,libraryView:null,folderToolbarView:null,folderListView:null,datasetView:null,initialize:function(){window.Galaxy.config.ga_code&&(!function(e,r,i,a,l,o,t){e.GoogleAnalyticsObject=l,e[l]=e[l]||function(){(e[l].q=e[l].q||[]).push(arguments)},e[l].l=1*new Date,o=r.createElement(i),t=r.getElementsByTagName(i)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",t.parentNode.insertBefore(o,t)}(window,document,"script",0,"ga"),ga("create",window.Galaxy.config.ga_code,"auto"),ga("send","pageview")),Galaxy.libraries=this,this.preferences=new m({id:"global-lib-prefs"}),this.library_router=new h,this.library_router.on("route:libraries",function(){Galaxy.libraries.libraryToolbarView&&Galaxy.libraries.libraryToolbarView.$el.unbind("click"),Galaxy.libraries.libraryToolbarView=new V.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new _.default.LibraryListView}),this.library_router.on("route:libraries_page",function(e){null===Galaxy.libraries.libraryToolbarView?(Galaxy.libraries.libraryToolbarView=new V.default.LibraryToolbarView,Galaxy.libraries.libraryListView=new _.default.LibraryListView({show_page:e})):Galaxy.libraries.libraryListView.render({show_page:e})}),this.library_router.on("route:folder_content",function(e){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderToolbarView.$el.unbind("click"),Galaxy.libraries.folderToolbarView=new x.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new c.default.FolderListView({id:e})}),this.library_router.on("route:folder_page",function(e,r){null===Galaxy.libraries.folderToolbarView?(Galaxy.libraries.folderToolbarView=new x.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new c.default.FolderListView({id:e,show_page:r})):Galaxy.libraries.folderListView.render({id:e,show_page:parseInt(r)})}),this.library_router.on("route:download",function(e,r){0===$("#folder_list_body").find(":checked").length?(u.default.info("You must select at least one dataset to download"),Galaxy.libraries.library_router.navigate("folders/"+e,{trigger:!0,replace:!0})):(Galaxy.libraries.folderToolbarView.download(r),Galaxy.libraries.library_router.navigate("folders/"+e,{trigger:!1,replace:!0}))}),this.library_router.on("route:dataset_detail",function(e,r){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new p.default.LibraryDatasetView({id:r,show_version:!1,show_permissions:!1})}),this.library_router.on("route:dataset_version",function(e,r,i){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new p.default.LibraryDatasetView({id:r,ldda_id:i,show_version:!0})}),this.library_router.on("route:dataset_permissions",function(e,r){Galaxy.libraries.datasetView&&Galaxy.libraries.datasetView.$el.unbind("click"),Galaxy.libraries.datasetView=new p.default.LibraryDatasetView({id:r,show_permissions:!0})}),this.library_router.on("route:library_permissions",function(e){Galaxy.libraries.libraryView&&Galaxy.libraries.libraryView.$el.unbind("click"),Galaxy.libraries.libraryView=new g.default.LibraryView({id:e,show_permissions:!0})}),this.library_router.on("route:folder_permissions",function(e){Galaxy.libraries.folderView&&Galaxy.libraries.folderView.$el.unbind("click"),Galaxy.libraries.folderView=new G.default.FolderView({id:e,show_permissions:!0})}),this.library_router.on("route:import_datasets",function(e,r){Galaxy.libraries.folderToolbarView&&Galaxy.libraries.folderListView?Galaxy.libraries.folderToolbarView.showImportModal({source:r}):(Galaxy.libraries.folderToolbarView=new x.default.FolderToolbarView({id:e}),Galaxy.libraries.folderListView=new c.default.FolderListView({id:e}),Galaxy.libraries.folderToolbarView.showImportModal({source:r}))}),Backbone.history.start({pushState:!1})}});e.default={GalaxyApp:v}});