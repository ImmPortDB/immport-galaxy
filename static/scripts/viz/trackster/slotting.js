define("viz/trackster/slotting",["exports","libs/underscore"],function(t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(t,e){this.slot=t,this.feature=e},s=function(t,e,r,s){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=r,this.measureText=s};(0,function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(e).extend)(s.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),r=Math.ceil(t[2]*this.w_scale),s=t[3];if(void 0!==s&&this.include_label){var i=this.measureText(s).width+7;e-i>=0?e-=i:r+=i}return[e,r]},_find_slot:function(t){for(var e=t[0],r=t[1],s=0;s<=this.max_rows;s++){var i=!1,a=this.start_end_dct[s];if(void 0!==a)for(var o=0,n=a.length;o<n;o++){var l=a[o];if(r>l[0]&&e<l[1]){i=!0;break}}if(!i)return s}return-1},slot_features:function(t){for(var e,s,i=this.start_end_dct,a=[],o=0,n=0,l=t.length;n<l;n++){s=(e=t[n])[0];var h=this.slots[s];if(h){if(e[1]<h.feature[1]||h.feature[2]<e[2])for(var _=this._get_draw_coords(h.feature),d=this._get_draw_coords(e),f=this.start_end_dct[h.slot],u=0;u<f.length;u++){var c=f[u];c[0]===_[0]&&c[1]===_[1]&&(f[u]=d)}o=Math.max(o,this.slots[s].slot)}else a.push(n)}for(var v=0,w=a.length;v<w;v++){s=(e=t[a[v]])[0];var g=this._get_draw_coords(e),p=this._find_slot(g);p>=0&&(void 0===i[p]&&(i[p]=[]),i[p].push(g),this.slots[s]=new r(p,e),o=Math.max(o,p))}return o+1}}),t.default={FeatureSlotter:s}});