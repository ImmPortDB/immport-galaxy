{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","UTILS","BASE_MVC","logNamespace","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","defaults","model_class","id","name","state","deleted","urlRoot","Galaxy","root","initialize","historyJSON","contentsJSON","options","this","logger","log","contents","HistoryContents","historyId","get","_setUpListeners","updateTimeoutId","on","model","xhr","msg","details","errorHandler","listenTo","trigger","apply","concat","jQuery","makeArray","arguments","newId","clearUpdateTimeout","nice_size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","contentsCount","reduce","values","memo","num","numOfUnfinishedJobs","unfinishedJobIds","length","numOfUnfinishedShownContents","running","visibleAndUndeleted","searchAttributes","searchAliases","title","tag","_getSizeAndRunning","fetch","data","$","param","keys","refresh","self","lastUpdateTime","fetchUpdated","done","response","status","serverResponseDatetime","Date","getResponseHeader","err","checkForUpdates","_delayThenUpdate","setTimeout","delay","UPDATE_DELAY","clearTimeout","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","history","post","then","newHistory","setAsCurrent","getJSON","toString","getHistoryData","getHistory","ajax","isEmpty","historyData","empty","getContents","isFunction","detailIdsFn","hdcaDetailIds","v","join","df","Deferred","historyFn","contentsFn","historyXHR","json","notify","fail","reject","contentsXHR","resolve","ControlledFetchMixin","_buildFetchData","traditional","Collection","_fetchOptions","fetchDefaults","_fetchDefaults","pick","filters","has","_buildFetchFilters","filterMap","q","qv","each","k","push","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","asc","update_time-asc","name-dsc","size","size-asc","models","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","url","view","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sort","collection","sortOrder","isUndefined","comparator","a","b","fetchOptions","offset","limit","fetchData","numFetched","isArray","create","hdas","historyOptions","unshift","silent","reset"],"mappings":"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"}