{"version":3,"file":"history-model.js","sources":["../../../src/mvc/history/history-model.js"],"names":["define","HISTORY_CONTENTS","UTILS","BASE_MVC","logNamespace","History","Backbone","Model","extend","LoggableMixin","mixin","SearchableModelMixin","_logNamespace","defaults","model_class","id","name","state","deleted","urlRoot","Galaxy","root","initialize","historyJSON","contentsJSON","options","this","logger","log","contents","HistoryContents","historyId","get","_setUpListeners","updateTimeoutId","on","model","xhr","msg","details","errorHandler","listenTo","trigger","apply","concat","jQuery","makeArray","arguments","newId","clearUpdateTimeout","nice_size","bytesToString","toJSON","_","prototype","call","key","ownedByCurrUser","user","isAnonymous","contentsCount","reduce","values","memo","num","searchAttributes","searchAliases","title","tag","checkForUpdates","onReadyCallback","running","length","setUpdateTimeout","isFunction","delay","UPDATE_DELAY","history","setTimeout","refresh","clearTimeout","detailIds","data","join","fetch","done","_delete","when","save","purge","purged","undelete","copy","current","allDatasets","undefined","Error","postData","history_id","all_datasets","post","then","response","newHistory","setAsCurrent","getJSON","toString","getHistoryData","getHistory","ajax","isEmpty","historyData","empty","getContents","detailIdsFn","hdcaDetailIds","dataset_details","dataset_collection_details","df","Deferred","historyFn","contentsFn","historyXHR","json","notify","status","fail","reject","contentsXHR","resolve","ControlledFetchMixin","_buildFetchData","traditional","Collection","_fetchOptions","fetchDefaults","_fetchDefaults","pick","filters","has","_buildFetchFilters","filterMap","q","qv","each","v","k","push","HistoryCollection","DEFAULT_ORDER","sortOrders","update_time","getter","h","Date","asc","update_time-asc","name-dsc","size","size-asc","models","includeDeleted","setOrder","order","currentHistoryId","allFetched","setUpListeners","url","view","change:deleted","debug","remove","copied","original","newData","setCurrent","set-as-current","oldCurrentId","sort","collection","sortOrder","isUndefined","comparator","a","b","fetchOptions","offset","limit","fetchData","numFetched","isArray","create","hdas","historyOptions","unshift","silent","reset"],"mappings":"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"}